(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.3' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    265558,       6114]
NotebookOptionsPosition[    247659,       5789]
NotebookOutlinePosition[    258358,       5998]
CellTagsIndexPosition[    258315,       5995]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell[BoxData[
 RowBox[{"<<", "SpinorHelicity4D`"}]], "Input",
 CellChangeTimes->{{3.846245086690741*^9, 3.8462450960548763`*^9}},
 CellLabel->"In[1]:=",ExpressionUUID->"d6fe2690-3bb1-4185-bbe3-4aaa9884d5a0"],

Cell[CellGroupData[{

Cell[BoxData["\<\"===============SpinorHelicity4D================\"\>"], \
"Print",
 CellChangeTimes->{3.8462460808281403`*^9, 3.8466675032347717`*^9},
 CellLabel->
  "During evaluation of \
In[1]:=",ExpressionUUID->"b051dbcd-5b56-46f7-85df-1c8aa6229f67"],

Cell[BoxData["\<\"Author: Manuel Accettulli Huber (QMUL)\"\>"], "Print",
 CellChangeTimes->{3.8462460808281403`*^9, 3.84666750323715*^9},
 CellLabel->
  "During evaluation of \
In[1]:=",ExpressionUUID->"1c148b9f-52be-4134-8adc-d6d4d634d1da"],

Cell[BoxData["\<\"Please report any bug to:\"\>"], "Print",
 CellChangeTimes->{3.8462460808281403`*^9, 3.8466675032393312`*^9},
 CellLabel->
  "During evaluation of \
In[1]:=",ExpressionUUID->"e309b2f9-1fd1-4a78-a9a4-82369b7d1dd9"],

Cell[BoxData["\<\"m.accettullihuber@qmul.ac.uk\"\>"], "Print",
 CellChangeTimes->{3.8462460808281403`*^9, 3.846667503241022*^9},
 CellLabel->
  "During evaluation of \
In[1]:=",ExpressionUUID->"170db4b4-8211-4507-89da-7de3a3fdb5ff"],

Cell[BoxData["\<\"Version 1.0 , last update 06/04/2021\"\>"], "Print",
 CellChangeTimes->{3.8462460808281403`*^9, 3.846667503244508*^9},
 CellLabel->
  "During evaluation of \
In[1]:=",ExpressionUUID->"831272e8-ac68-47f2-ada4-75bb42c3a29d"],

Cell[BoxData[
 TemplateBox[{
  "\"Click here for full documentation\"", 
   "https://github.com/accettullihuber"},
  "HyperlinkURL"]], "Print",
 CellChangeTimes->{3.8462460808281403`*^9, 3.846667503299131*^9},
 CellLabel->
  "During evaluation of \
In[1]:=",ExpressionUUID->"9eb8dea0-c0eb-4338-948f-cf4562a610cd"],

Cell[BoxData["\<\"=============================================\"\>"], "Print",
 CellChangeTimes->{3.8462460808281403`*^9, 3.846667503304658*^9},
 CellLabel->
  "During evaluation of \
In[1]:=",ExpressionUUID->"b5f45e9a-a006-4fb5-a6ea-eb2cc8c54c0b"]
}, Open  ]]
}, Open  ]],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "First", " ", "group", " ", "together", " ", "all", " ", "the", " ", 
   "spinor", " ", "invariants", " ", "and", " ", "convert", " ", "them", " ", 
   "to", " ", "something", " ", "we", " ", "can", " ", "handle", " ", 
   RowBox[{"easier", ".", " ", "Then"}], " ", "we", " ", "package", " ", 
   "everything", " ", "appropriately"}], "*)"}]], "Input",
 CellChangeTimes->{{3.846245129976778*^9, 3.846245146487133*^9}, {
  3.846245602691909*^9, 
  3.846245643261817*^9}},ExpressionUUID->"02c4f47a-3eb8-4cd8-b56e-\
c8533ab5fc1c"],

Cell[CellGroupData[{

Cell["Preprocessing", "Subsection",
 CellChangeTimes->{{3.846245675277483*^9, 
  3.846245677621294*^9}},ExpressionUUID->"5cb88fc9-3da6-4eb3-8874-\
9a48338fb3de"],

Cell[BoxData[
 RowBox[{
  RowBox[{"PreChain", "[", "exp_", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "aa", ",", "bb", ",", "ab", ",", "wrapper", ",", "invwrapper", ",", 
      "local", ",", "SpinorAngleBracket", ",", "SpinorSquareBracket", ",", 
      "Chain"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"local", "=", "exp"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Convert", " ", "all", " ", "the", " ", "chains", " ", "and", " ", 
       "spinor", " ", "brackets", " ", "into", " ", "simpler", " ", "objects",
        " ", "and", " ", "wrap", " ", "them", " ", "into", " ", "a", " ", 
       "function", " ", "which", " ", "will", " ", "chain", " ", "them"}], 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"SpinorAngleBracket", "[", "x__", "]"}], ":=", 
      RowBox[{"wrapper", "[", 
       RowBox[{"aa", "[", "x", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"SpinorSquareBracket", "[", "x__", "]"}], ":=", 
      RowBox[{"wrapper", "[", 
       RowBox[{"bb", "[", "x", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Chain", "[", 
       RowBox[{"$angle", ",", "x__", ",", "$angle"}], "]"}], ":=", 
      RowBox[{"wrapper", "[", 
       RowBox[{"aa", "[", 
        RowBox[{"Sequence", "@@", 
         RowBox[{"Flatten", "@", 
          RowBox[{"{", "x", "}"}]}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Chain", "[", 
       RowBox[{"$angle", ",", "x__", ",", "$square"}], "]"}], ":=", 
      RowBox[{"wrapper", "[", 
       RowBox[{"ab", "[", 
        RowBox[{"Sequence", "@@", 
         RowBox[{"Flatten", "@", 
          RowBox[{"{", "x", "}"}]}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Chain", "[", 
       RowBox[{"$square", ",", "x__", ",", "$angle"}], "]"}], ":=", 
      RowBox[{"wrapper", "[", 
       RowBox[{"ab", "[", 
        RowBox[{"Sequence", "@@", 
         RowBox[{"Reverse", "@", 
          RowBox[{"Flatten", "@", 
           RowBox[{"{", "x", "}"}]}]}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Chain", "[", 
       RowBox[{"$square", ",", "x__", ",", "$square"}], "]"}], ":=", 
      RowBox[{"wrapper", "[", 
       RowBox[{"bb", "[", 
        RowBox[{"Sequence", "@@", 
         RowBox[{"Flatten", "@", 
          RowBox[{"{", "x", "}"}]}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
       "Define", " ", "properties", " ", "of", " ", "the", " ", "wrapper", 
        " ", "so", " ", "that", " ", "it", " ", "wraps", " ", "everything", 
        " ", "together"}], ",", " ", 
       RowBox[{"taking", " ", "care", " ", "of", " ", "the", " ", 
        RowBox[{"powers", ".", " ", "Inverse"}], " ", "powers", " ", "are", 
        " ", "the", " ", "reason", " ", "we", " ", "need", " ", "the", " ", 
        "auxiliary", " ", "invwrapper"}], ",", " ", 
       RowBox[{
        RowBox[{
        "this", " ", "would", " ", "be", " ", "needed", " ", "if", " ", "we", 
         " ", "could", " ", "go", " ", "deeper", " ", "with", " ", "the", " ",
          "upvalues", " ", "of", " ", "wrapper"}], "..."}]}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"wrapper", " ", "/:", " ", 
      RowBox[{
       RowBox[{"wrapper", "[", "x_", "]"}], "*", 
       RowBox[{"wrapper", "[", "y_", "]"}]}], ":=", 
      RowBox[{"wrapper", "[", 
       RowBox[{"x", "*", "y"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"wrapper", " ", "/:", " ", 
      RowBox[{"Power", "[", 
       RowBox[{
        RowBox[{"wrapper", "[", "x_", "]"}], ",", 
        RowBox[{"n_", "?", "Positive"}]}], "]"}], ":=", 
      RowBox[{"wrapper", "[", 
       RowBox[{"Power", "[", 
        RowBox[{"x", ",", "n"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"wrapper", " ", "/:", " ", 
      RowBox[{"Power", "[", 
       RowBox[{
        RowBox[{"wrapper", "[", "x_", "]"}], ",", 
        RowBox[{"n_", "?", "Negative"}]}], "]"}], ":=", 
      RowBox[{"invwrapper", "[", 
       RowBox[{"Power", "[", 
        RowBox[{"x", ",", 
         RowBox[{"-", "n"}]}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"invwrapper", " ", "/:", " ", 
      RowBox[{
       RowBox[{"invwrapper", "[", "x_", "]"}], "*", 
       RowBox[{"invwrapper", "[", "y_", "]"}]}], ":=", 
      RowBox[{"invwrapper", "[", 
       RowBox[{"x", "*", "y"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"local", "=", "local"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Reconvert", " ", "the", " ", "inwrapper", " ", "to", " ", "the", " ", 
       "inverse", " ", "power", " ", "of", " ", "a", " ", "wrapper"}], "*)"}],
      "\[IndentingNewLine]", 
     RowBox[{"Clear", "[", "wrapper", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"invwrapper", "[", "x_", "]"}], ":=", 
      RowBox[{"Power", "[", 
       RowBox[{
        RowBox[{"wrapper", "[", "x", "]"}], ",", 
        RowBox[{"-", "1"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"local", "=", "local"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
       "Next", " ", "we", " ", "want", " ", "the", " ", "wrapper", " ", "to", 
        " ", "be", " ", "ready", " ", "to", " ", "actually", " ", "do", " ", 
        "stuff"}], ",", " ", 
       RowBox[{
       "so", " ", "we", " ", "group", " ", "things", " ", "together", " ", 
        "in", " ", 
        RowBox[{"lists", ":", " ", "aa"}]}], ",", "bb", ",", 
       RowBox[{"ab", " ", "and", " ", "ba", " ", "separate"}], ",", " ", 
       RowBox[{
       "along", " ", "with", " ", "the", " ", "product", " ", "of", " ", 
        "already", " ", "used", " ", 
        RowBox[{"stuff", ".", " ", "First"}], " ", "convert", " ", 
        "arguments", " ", "of", " ", "wrapper", " ", "to", " ", "a", " ", 
        "list"}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Clear", "[", "invwrapper", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"wrapper", "[", 
       RowBox[{"f_", "[", "x__", "]"}], "]"}], ":=", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"f", "===", "Times"}], ",", 
        RowBox[{"invwrapper", "[", 
         RowBox[{"List", "[", "x", "]"}], "]"}], ",", 
        RowBox[{"invwrapper", "[", 
         RowBox[{"{", "x", "}"}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
       "Here", " ", "we", " ", "gather", " ", "the", " ", "objects", " ", 
        "by", " ", "head"}], ",", " ", 
       RowBox[{
       "then", " ", "replace", " ", "powers", " ", "by", " ", "arrays", " ", 
        "with", " ", "correct", " ", "multiplicity"}], ",", " ", 
       RowBox[{
       "and", " ", "finally", " ", "make", "  ", "atable", " ", "with", " ", 
        "the", " ", "elements", " ", "of", " ", "each", " ", "type", " ", 
        "putting", " ", "an", " ", "empty", " ", "list", " ", "for", " ", 
        "the", " ", "missing", " ", 
        RowBox[{"ones", ".", " ", "We"}], " ", "keep", " ", "the", " ", 
        "invwrapper", " ", "as", " ", "an", " ", "external", " ", 
        "container"}], ",", " ", 
       RowBox[{
       "so", " ", "that", " ", "once", " ", "wrapper", " ", "has", " ", 
        "done", " ", 
        RowBox[{"it", "'"}], "s", " ", "job"}], ",", " ", 
       RowBox[{
       "invwrapper", " ", "can", " ", "select", " ", "the", " ", "chain", " ",
         "we", " ", "want"}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"local", "=", "local"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Clear", "[", "wrapper", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"invwrapper", "[", "x_List", "]"}], ":=", 
      RowBox[{"invwrapper", "[", 
       RowBox[{"wrapper", "[", 
        RowBox[{"1", ",", "1", ",", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"SelectFirst", "[", 
            RowBox[{
             RowBox[{"GatherBy", "[", 
              RowBox[{
               RowBox[{"Flatten", "[", 
                RowBox[{"x", "/.", 
                 RowBox[{"Power", "->", "ConstantArray"}]}], "]"}], ",", 
               "Head"}], "]"}], ",", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", 
                  RowBox[{"1", ",", "0"}], "]"}], "]"}], "===", "i"}], "&"}], 
              ")"}], ",", 
             RowBox[{"{", "}"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"{", 
              RowBox[{"aa", ",", "ab", ",", "bb"}], "}"}]}], "}"}]}], "]"}]}],
         "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"local", "=", "local"}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
       "Now", " ", "we", " ", "clear", " ", "the", " ", "invwrapper", " ", 
        "and", " ", "make", " ", "the", " ", "wrapper", " ", "do", " ", "the",
         " ", "magic", " ", "of", " ", 
        RowBox[{"combinatorics", ".", " ", "The"}], " ", "aa"}], ",", "bb", 
       ",", "ba", ",", 
       RowBox[{
       "ab", " ", "objects", " ", "get", " ", "some", " ", "specific", " ", 
        "properties", " ", "which", " ", "is", " ", "what", " ", "will", " ", 
        "build", " ", "the", " ", "chains"}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Clear", "[", "invwrapper", "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"THE", " ", "FOLLOWING", " ", "IS", " ", "WRONG"}], ",", 
          " ", 
          RowBox[{
          "WE", " ", "NEED", " ", "THE", " ", "WRAPPER", " ", "TO", " ", "DO",
            " ", "IT", " ", "BECAUSE", " ", "ALSO", " ", "THE", " ", "ORDER", 
           " ", "OF", " ", "THE", " ", "CONTRACTION", " ", "WITH", " ", "THE",
            " ", "EXTREMA", " ", 
           RowBox[{"MATTERS", ":", " ", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"if", " ", "I", " ", "have"}], " ", "<", "1"}], 
                 "..."}], "1"}], ">", " ", 
               RowBox[{
                RowBox[{"and", " ", "[", 
                 RowBox[{"1", ",", "2"}], "]"}], " ", "I", " ", "need", " ", 
                "both"}], " ", "<", "1"}], "..."}], "12"}]}]}]}], "]"}], " ", 
        "and"}], " ", "-", 
       RowBox[{"[", 
        RowBox[{
         RowBox[{
          RowBox[{"21", "..."}], "1"}], ">"}]}]}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"aa", " ", "/:", " ", 
        RowBox[{
         RowBox[{"aa", "[", 
          RowBox[{"x1_", ",", "y1___", ",", "z1_"}], "]"}], "*", 
         RowBox[{"ab", "[", 
          RowBox[{"x2__", ",", "x1_"}], "]"}]}], ":=", 
        RowBox[{"aa", "[", 
         RowBox[{"x2", ",", "x1", ",", "y1", ",", "z1"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"aa", " ", "/:", " ", 
        RowBox[{
         RowBox[{"aa", "[", 
          RowBox[{"x1_", ",", "y1___", ",", "z1_"}], "]"}], "*", 
         RowBox[{"ab", "[", 
          RowBox[{"x2__", ",", "z1_"}], "]"}]}], ":=", 
        RowBox[{"aa", "[", 
         RowBox[{"x1", ",", "y1", ",", "z1", ",", 
          RowBox[{"Sequence", "@@", 
           RowBox[{"Reverse", "@", 
            RowBox[{"{", "x2", "}"}]}]}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"bb", " ", "/:", " ", 
        RowBox[{
         RowBox[{"bb", "[", 
          RowBox[{"x1_", ",", "y1___", ",", "z1_"}], "]"}], "*", 
         RowBox[{"ab", "[", 
          RowBox[{"x1_", ",", "y2__"}], "]"}]}], ":=", 
        RowBox[{"bb", "[", 
         RowBox[{
          RowBox[{"Sequence", "@@", 
           RowBox[{"Reverse", "@", 
            RowBox[{"{", "y2", "}"}]}]}], ",", "x1", ",", "y1", ",", "z1"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"bb", " ", "/:", " ", 
        RowBox[{
         RowBox[{"bb", "[", 
          RowBox[{"x1_", ",", "y1___", ",", "z1_"}], "]"}], "*", 
         RowBox[{"ab", "[", 
          RowBox[{"z1_", ",", "y2__"}], "]"}]}], ":=", 
        RowBox[{"bb", "[", 
         RowBox[{"x1", ",", "y1", ",", "z1", ",", "y2"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"aa", " ", "/:", " ", 
        RowBox[{
         RowBox[{"aa", "[", 
          RowBox[{"x1_", ",", "y1___", ",", "z1_"}], "]"}], "*", 
         RowBox[{"bb", "[", 
          RowBox[{"x1_", ",", "y2__"}], "]"}]}], ":=", 
        RowBox[{"-", 
         RowBox[{"ab", "[", 
          RowBox[{
           RowBox[{"Sequence", "@@", 
            RowBox[{"Reverse", "@", 
             RowBox[{"{", 
              RowBox[{"x1", ",", "y1", ",", "z1"}], "}"}]}]}], ",", "y2"}], 
          "]"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"aa", " ", "/:", " ", 
        RowBox[{
         RowBox[{"aa", "[", 
          RowBox[{"x1_", ",", "y1___", ",", "z1_"}], "]"}], "*", 
         RowBox[{"bb", "[", 
          RowBox[{"x2__", ",", "x1_"}], "]"}]}], ":=", 
        RowBox[{"ab", "[", 
         RowBox[{
          RowBox[{"Sequence", "@@", 
           RowBox[{"Reverse", "@", 
            RowBox[{"{", 
             RowBox[{"x1", ",", "y1", ",", "z1"}], "}"}]}]}], ",", 
          RowBox[{"Sequence", "@@", 
           RowBox[{"Reverse", "@", 
            RowBox[{"{", "x2", "}"}]}]}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"aa", " ", "/:", " ", 
        RowBox[{
         RowBox[{"aa", "[", 
          RowBox[{"x1_", ",", "y1___", ",", "z1_"}], "]"}], "*", 
         RowBox[{"bb", "[", 
          RowBox[{"z1_", ",", "y2__"}], "]"}]}], ":=", 
        RowBox[{"ab", "[", 
         RowBox[{"x1", ",", "y1", ",", "z1", ",", "y2"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"aa", " ", "/:", " ", 
        RowBox[{
         RowBox[{"aa", "[", 
          RowBox[{"x1_", ",", "y1___", ",", "z1_"}], "]"}], "*", 
         RowBox[{"bb", "[", 
          RowBox[{"x2__", ",", "z1_"}], "]"}]}], ":=", 
        RowBox[{"-", 
         RowBox[{"ab", "[", 
          RowBox[{"x1", ",", "y1", ",", "z1", ",", 
           RowBox[{"Sequence", "@@", 
            RowBox[{"Reverse", "@", 
             RowBox[{"{", "x2", "}"}]}]}]}], "]"}]}]}], ";"}], "*)"}], 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Return", " ", "the", " ", "function"}], "*)"}], 
     "\[IndentingNewLine]", "local"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.8462456814201593`*^9, 3.846245825156507*^9}, {
   3.84624588041416*^9, 3.846246059525483*^9}, {3.846246159961267*^9, 
   3.846246506356346*^9}, {3.8462465588496513`*^9, 3.846246776938932*^9}, {
   3.8462468211574593`*^9, 3.846246821357975*^9}, {3.8462469009381323`*^9, 
   3.846247006582032*^9}, {3.846247070132245*^9, 3.846247149644244*^9}, {
   3.846247374359428*^9, 3.8462474663508*^9}, {3.8462475097111187`*^9, 
   3.846247529989496*^9}, 3.846247663407776*^9, {3.846247846840952*^9, 
   3.8462478514860983`*^9}, {3.846247998536194*^9, 3.8462482085672503`*^9}, {
   3.8462483680399227`*^9, 3.8462486484817333`*^9}, {3.8462487027049007`*^9, 
   3.846248724368257*^9}, {3.846248797143999*^9, 3.846248816218581*^9}, {
   3.8462488954114532`*^9, 3.846249049858389*^9}, {3.846249189482415*^9, 
   3.8462493254442596`*^9}, {3.846249385925198*^9, 3.846249487653274*^9}, {
   3.846249544221499*^9, 3.846249546222382*^9}, {3.846249589856963*^9, 
   3.84624967719884*^9}, {3.8462502101602983`*^9, 3.8462502823829317`*^9}, {
   3.8466736897255898`*^9, 
   3.8466737132423563`*^9}},ExpressionUUID->"ba6287bc-50e6-419f-84d2-\
90f26483d92d"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"7", "*", "z", "*", 
   TemplateBox[{"1", "2"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], 
   TemplateBox[{"2", "3"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], 
   TemplateBox[{"3", "4"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], 
   TemplateBox[{"3", "5"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], 
   RowBox[{
    TemplateBox[{"5", "6"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "^", "2"}], 
   RowBox[{
    TemplateBox[{"7", 
      RowBox[{"{", "8", "}"}], "9"},
     "AngleSquareChain",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
     InterpretationFunction->(
      RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
        "$square", "]"}]& )], "/", 
    RowBox[{"(", 
     RowBox[{
      TemplateBox[{"p1", "p2"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], 
      RowBox[{
       TemplateBox[{"p2", "p3"},
        "SpinorSquareBracket",
        DisplayFunction->(RowBox[{"[", 
           RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
        InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
           RowBox[{#, ",", #2}], "]"}]& )], "^", "2"}]}], ")"}]}]}], "//", 
  "PreChain"}]], "Input",
 CellChangeTimes->{{3.846242173509924*^9, 3.846242231112877*^9}, {
  3.846246116586875*^9, 3.846246150278006*^9}, {3.8462461817347727`*^9, 
  3.846246182158164*^9}, {3.846246578013474*^9, 3.846246578378786*^9}, {
  3.846247680110651*^9, 3.846247683789065*^9}},
 CellLabel->"In[5]:=",ExpressionUUID->"ba3f9ba6-bfbe-4ccd-9234-e701af655803"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(", 
   RowBox[{"7", " ", "z", " ", 
    RowBox[{"invwrapper", "[", 
     RowBox[{"wrapper", "[", 
      RowBox[{"1", ",", "1", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"aa", "[", 
            RowBox[{"1", ",", "2"}], "]"}], ",", 
           RowBox[{"aa", "[", 
            RowBox[{"3", ",", "4"}], "]"}], ",", 
           RowBox[{"aa", "[", 
            RowBox[{"3", ",", "5"}], "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"ab", "[", 
           RowBox[{"7", ",", "8", ",", "9"}], "]"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"bb", "[", 
            RowBox[{"2", ",", "3"}], "]"}], ",", 
           RowBox[{"bb", "[", 
            RowBox[{"5", ",", "6"}], "]"}], ",", 
           RowBox[{"bb", "[", 
            RowBox[{"5", ",", "6"}], "]"}]}], "}"}]}], "}"}]}], "]"}], 
     "]"}]}], ")"}], "/", 
  RowBox[{"invwrapper", "[", 
   RowBox[{"wrapper", "[", 
    RowBox[{"1", ",", "1", ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"aa", "[", 
         RowBox[{"p1", ",", "p2"}], "]"}], "}"}], ",", 
       RowBox[{"{", "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"bb", "[", 
          RowBox[{"p2", ",", "p3"}], "]"}], ",", 
         RowBox[{"bb", "[", 
          RowBox[{"p2", ",", "p3"}], "]"}]}], "}"}]}], "}"}]}], "]"}], 
   "]"}]}]], "Output",
 CellChangeTimes->{
  3.84624611997372*^9, 3.846246151308091*^9, 3.846246183552204*^9, 
   3.846246235365589*^9, 3.846246376832349*^9, {3.846246424554968*^9, 
   3.846246439031102*^9}, 3.846246471934087*^9, 3.846246579394256*^9, 
   3.846246688354754*^9, 3.8462470081212587`*^9, {3.8462470922578087`*^9, 
   3.846247121462365*^9}, {3.846247445871354*^9, 3.846247467791078*^9}, {
   3.846247668496654*^9, 3.846247685000882*^9}, {3.846248016852743*^9, 
   3.846248049962275*^9}, 3.8462484455387506`*^9, {3.846248476005752*^9, 
   3.8462484847031097`*^9}, 3.846248535328216*^9, 3.846249757710393*^9, 
   3.846667513813611*^9, 3.846673693242999*^9},
 CellLabel->"Out[5]=",ExpressionUUID->"d7a7aaa4-9e21-48e4-9ed1-18ef1e89ce23"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Preprocessing continued", "Subsection",
 CellChangeTimes->{{3.846245675277483*^9, 3.846245677621294*^9}, {
  3.846673722916071*^9, 
  3.846673724332143*^9}},ExpressionUUID->"6ce3182f-5b23-4073-9124-\
f454d656bbcb"],

Cell[BoxData[
 RowBox[{
  RowBox[{"PreChain", "[", "exp_", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "aa", ",", "bb", ",", "ab", ",", "wrapper", ",", "invwrapper", ",", 
      "local", ",", "SpinorAngleBracket", ",", "SpinorSquareBracket", ",", 
      "Chain"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"local", "=", "exp"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Convert", " ", "all", " ", "the", " ", "chains", " ", "and", " ", 
       "spinor", " ", "brackets", " ", "into", " ", "simpler", " ", "objects",
        " ", "and", " ", "wrap", " ", "them", " ", "into", " ", "a", " ", 
       "function", " ", "which", " ", "will", " ", "chain", " ", "them"}], 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"SpinorAngleBracket", "[", "x__", "]"}], ":=", 
      RowBox[{"wrapper", "[", 
       RowBox[{"aa", "[", "x", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"SpinorSquareBracket", "[", "x__", "]"}], ":=", 
      RowBox[{"wrapper", "[", 
       RowBox[{"bb", "[", "x", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Chain", "[", 
       RowBox[{"$angle", ",", "x__", ",", "$angle"}], "]"}], ":=", 
      RowBox[{"wrapper", "[", 
       RowBox[{"aa", "[", 
        RowBox[{"Sequence", "@@", 
         RowBox[{"Flatten", "@", 
          RowBox[{"{", "x", "}"}]}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Chain", "[", 
       RowBox[{"$angle", ",", "x__", ",", "$square"}], "]"}], ":=", 
      RowBox[{"wrapper", "[", 
       RowBox[{"ab", "[", 
        RowBox[{"Sequence", "@@", 
         RowBox[{"Flatten", "@", 
          RowBox[{"{", "x", "}"}]}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Chain", "[", 
       RowBox[{"$square", ",", "x__", ",", "$angle"}], "]"}], ":=", 
      RowBox[{"wrapper", "[", 
       RowBox[{"ab", "[", 
        RowBox[{"Sequence", "@@", 
         RowBox[{"Reverse", "@", 
          RowBox[{"Flatten", "@", 
           RowBox[{"{", "x", "}"}]}]}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Chain", "[", 
       RowBox[{"$square", ",", "x__", ",", "$square"}], "]"}], ":=", 
      RowBox[{"wrapper", "[", 
       RowBox[{"bb", "[", 
        RowBox[{"Sequence", "@@", 
         RowBox[{"Flatten", "@", 
          RowBox[{"{", "x", "}"}]}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
       "Define", " ", "properties", " ", "of", " ", "the", " ", "wrapper", 
        " ", "so", " ", "that", " ", "it", " ", "wraps", " ", "everything", 
        " ", "together"}], ",", " ", 
       RowBox[{"taking", " ", "care", " ", "of", " ", "the", " ", 
        RowBox[{"powers", ".", " ", "Inverse"}], " ", "powers", " ", "are", 
        " ", "the", " ", "reason", " ", "we", " ", "need", " ", "the", " ", 
        "auxiliary", " ", "invwrapper"}], ",", " ", 
       RowBox[{
        RowBox[{
        "this", " ", "would", " ", "be", " ", "needed", " ", "if", " ", "we", 
         " ", "could", " ", "go", " ", "deeper", " ", "with", " ", "the", " ",
          "upvalues", " ", "of", " ", "wrapper"}], "..."}]}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"wrapper", " ", "/:", " ", 
      RowBox[{
       RowBox[{"wrapper", "[", "x_", "]"}], "*", 
       RowBox[{"wrapper", "[", "y_", "]"}]}], ":=", 
      RowBox[{"wrapper", "[", 
       RowBox[{"x", "*", "y"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"wrapper", " ", "/:", " ", 
      RowBox[{"Power", "[", 
       RowBox[{
        RowBox[{"wrapper", "[", "x_", "]"}], ",", 
        RowBox[{"n_", "?", "Positive"}]}], "]"}], ":=", 
      RowBox[{"wrapper", "[", 
       RowBox[{"Power", "[", 
        RowBox[{"x", ",", "n"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"wrapper", " ", "/:", " ", 
      RowBox[{"Power", "[", 
       RowBox[{
        RowBox[{"wrapper", "[", "x_", "]"}], ",", 
        RowBox[{"n_", "?", "Negative"}]}], "]"}], ":=", 
      RowBox[{"invwrapper", "[", 
       RowBox[{"Power", "[", 
        RowBox[{"x", ",", 
         RowBox[{"-", "n"}]}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"invwrapper", " ", "/:", " ", 
      RowBox[{
       RowBox[{"invwrapper", "[", "x_", "]"}], "*", 
       RowBox[{"invwrapper", "[", "y_", "]"}]}], ":=", 
      RowBox[{"invwrapper", "[", 
       RowBox[{"x", "*", "y"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"local", "=", "local"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Reconvert", " ", "the", " ", "inwrapper", " ", "to", " ", "the", " ", 
       "inverse", " ", "power", " ", "of", " ", "a", " ", "wrapper"}], "*)"}],
      "\[IndentingNewLine]", 
     RowBox[{"Clear", "[", "wrapper", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"invwrapper", "[", "x_", "]"}], ":=", 
      RowBox[{"Power", "[", 
       RowBox[{
        RowBox[{"wrapper", "[", "x", "]"}], ",", 
        RowBox[{"-", "1"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"local", "=", "local"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
       "Next", " ", "we", " ", "want", " ", "the", " ", "wrapper", " ", "to", 
        " ", "be", " ", "ready", " ", "to", " ", "actually", " ", "do", " ", 
        "stuff"}], ",", " ", 
       RowBox[{
       "so", " ", "we", " ", "group", " ", "things", " ", "together", " ", 
        "in", " ", 
        RowBox[{"lists", ":", " ", "aa"}]}], ",", "bb", ",", 
       RowBox[{"ab", " ", "and", " ", "ba", " ", "separate"}], ",", " ", 
       RowBox[{
       "along", " ", "with", " ", "the", " ", "product", " ", "of", " ", 
        "already", " ", "used", " ", 
        RowBox[{"stuff", ".", " ", "First"}], " ", "convert", " ", 
        "arguments", " ", "of", " ", "wrapper", " ", "to", " ", "a", " ", 
        "list"}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Clear", "[", "invwrapper", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"wrapper", "[", 
       RowBox[{"f_", "[", "x__", "]"}], "]"}], ":=", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"f", "===", "Times"}], ",", 
        RowBox[{"invwrapper", "[", 
         RowBox[{"List", "[", "x", "]"}], "]"}], ",", 
        RowBox[{"invwrapper", "[", 
         RowBox[{"{", "x", "}"}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
       "Here", " ", "we", " ", "gather", " ", "the", " ", "objects", " ", 
        "by", " ", "head"}], ",", " ", 
       RowBox[{
       "then", " ", "replace", " ", "powers", " ", "by", " ", "arrays", " ", 
        "with", " ", "correct", " ", "multiplicity"}], ",", " ", 
       RowBox[{
       "and", " ", "finally", " ", "make", "  ", "atable", " ", "with", " ", 
        "the", " ", "elements", " ", "of", " ", "each", " ", "type", " ", 
        "putting", " ", "an", " ", "empty", " ", "list", " ", "for", " ", 
        "the", " ", "missing", " ", 
        RowBox[{"ones", ".", " ", "We"}], " ", "keep", " ", "the", " ", 
        "invwrapper", " ", "as", " ", "an", " ", "external", " ", 
        "container"}], ",", " ", 
       RowBox[{
       "so", " ", "that", " ", "once", " ", "wrapper", " ", "has", " ", 
        "done", " ", 
        RowBox[{"it", "'"}], "s", " ", "job"}], ",", " ", 
       RowBox[{
       "invwrapper", " ", "can", " ", "select", " ", "the", " ", "chain", " ",
         "we", " ", "want"}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"local", "=", "local"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Clear", "[", "wrapper", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"invwrapper", "[", "x_List", "]"}], ":=", 
      RowBox[{"invwrapper", "[", 
       RowBox[{"wrapper", "[", 
        RowBox[{"1", ",", "1", ",", 
         RowBox[{"Sequence", "@@", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"SelectFirst", "[", 
             RowBox[{
              RowBox[{"GatherBy", "[", 
               RowBox[{
                RowBox[{"Flatten", "[", 
                 RowBox[{"x", "/.", 
                  RowBox[{"Power", "->", "ConstantArray"}]}], "]"}], ",", 
                "Head"}], "]"}], ",", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"#", "[", 
                  RowBox[{"[", 
                   RowBox[{"1", ",", "0"}], "]"}], "]"}], "===", "i"}], "&"}],
                ")"}], ",", 
              RowBox[{"{", "}"}]}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", 
              RowBox[{"{", 
               RowBox[{"aa", ",", "ab", ",", "bb"}], "}"}]}], "}"}]}], 
           "]"}]}]}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"local", "=", "local"}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
       "Now", " ", "we", " ", "clear", " ", "the", " ", "invwrapper", " ", 
        "and", " ", "make", " ", "the", " ", "wrapper", " ", "do", " ", "the",
         " ", "magic", " ", "of", " ", 
        RowBox[{"combinatorics", ".", " ", "The"}], " ", "aa"}], ",", "bb", 
       ",", "ba", ",", 
       RowBox[{
       "ab", " ", "objects", " ", "get", " ", "some", " ", "specific", " ", 
        "properties", " ", "which", " ", "is", " ", "what", " ", "will", " ", 
        "build", " ", "the", " ", "chains"}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Clear", "[", "invwrapper", "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"The", " ", "wrapper", " ", "acts", " ", "recursively"}], ",", 
       " ", 
       RowBox[{"testing", " ", "its", " ", "second", " ", 
        RowBox[{"argument", "'"}], "s", " ", "head", " ", "and", " ", 
        "accordingly", " ", "combining", " ", "it", " ", "with", " ", "one", 
        " ", "of", " ", "the", " ", "elements", " ", "in", " ", "the", " ", 
        "lists", " ", "of", " ", 
        RowBox[{"brackets", ".", " ", "If"}], " ", "no", " ", "combination", 
        " ", "is", " ", "possible", " ", "the", " ", "second", " ", 
        "argument", " ", "is", " ", "merged", " ", "with", " ", "the", " ", 
        "first", " ", "one", " ", "and", " ", "a", " ", "new", " ", "cycle", 
        " ", 
        RowBox[{"begins", ".", " ", "Termination"}], " ", "condition", " ", 
        "is", " ", "that", " ", "all", " ", "lists", " ", "are", " ", 
        "empty"}]}], "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Termination", " ", "condition"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"wrapper", "[", 
       RowBox[{"x_", ",", "y_", ",", 
        RowBox[{"{", "}"}], ",", 
        RowBox[{"{", "}"}], ",", 
        RowBox[{"{", "}"}]}], "]"}], ":=", 
      RowBox[{"x", "*", "y"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"The", " ", "starting", " ", "point"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"wrapper", "[", 
       RowBox[{"x_", ",", "1", ",", "a_", ",", "b_", ",", "c_"}], "]"}], ":=", 
      RowBox[{"Which", "[", 
       RowBox[{
        RowBox[{"a", "=!=", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{"wrapper", "[", 
         RowBox[{"x", ",", 
          RowBox[{"First", "@", "a"}], ",", 
          RowBox[{"Rest", "@", "a"}], ",", "b", ",", "c"}], "]"}], ",", 
        RowBox[{"b", "=!=", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{"wrapper", "[", 
         RowBox[{"x", ",", 
          RowBox[{"First", "@", "b"}], ",", "a", ",", 
          RowBox[{"Rest", "@", "b"}], ",", "c"}], "]"}], ",", 
        RowBox[{"c", "=!=", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{"wrapper", "[", 
         RowBox[{"x", ",", 
          RowBox[{"First", "@", "c"}], ",", "a", ",", "b", ",", 
          RowBox[{"Rest", "@", "c"}]}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "If", " ", "any", " ", "two", " ", "of", " ", "the", " ", "lists", " ", 
       "are", " ", "empty", " ", "there", " ", "is", " ", "nothing", " ", 
       "to", " ", "be", " ", 
       RowBox[{"done", "."}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"wrapper", "[", 
       RowBox[{"x_", ",", "y_", ",", 
        RowBox[{"{", "}"}], ",", 
        RowBox[{"{", "}"}], ",", "a_"}], "]"}], ":=", 
      RowBox[{"x", "*", "y", "*", 
       RowBox[{"Times", "@@", "a"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"wrapper", "[", 
       RowBox[{"x_", ",", "y_", ",", 
        RowBox[{"{", "}"}], ",", "a_", ",", 
        RowBox[{"{", "}"}]}], "]"}], ":=", 
      RowBox[{"x", "*", "y", "*", 
       RowBox[{"Times", "@@", "a"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"wrapper", "[", 
       RowBox[{"x_", ",", "y_", ",", "a_", ",", 
        RowBox[{"{", "}"}], ",", 
        RowBox[{"{", "}"}]}], "]"}], ":=", 
      RowBox[{"x", "*", "y", "*", 
       RowBox[{"Times", "@@", "a"}]}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"GENERAL", " ", 
       RowBox[{"QUESTION", ":", " ", 
        RowBox[{"is", " ", "this", " ", "pattern", " ", "matching", " ", 
         RowBox[{"aa", "[", 
          RowBox[{"x_", ",", "y___", ",", "z_"}], "]"}], " ", "faster", " ", 
         "or", " ", "is", " ", 
         RowBox[{"aa", "[", "x__", "]"}], " ", "with", " ", "calling", " ", 
         RowBox[{"First", "@", "x"}], " ", "every", " ", "time", " ", 
         RowBox[{"faster", "?"}]}]}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Entry", " ", "is", " ", "aa"}], "*)"}], "\[IndentingNewLine]", 
     
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
       "If", " ", "upon", " ", "parsing", " ", "the", " ", "lists", " ", "of",
         " ", "objects", " ", "and", " ", "making", " ", "all", " ", "the", 
        " ", "possible", " ", "contractions", " ", "an", " ", "empty", " ", 
        "list", " ", "is", " ", "returned"}], ",", " ", 
       RowBox[{
       "we", " ", "need", " ", "to", " ", "move", " ", "the", " ", "input", 
        " ", "entry", " ", "to", " ", "the", " ", "overall", " ", "product", 
        " ", "but", " ", "and", " ", "start", " ", "a", " ", "new", " ", 
        "iteration"}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"wrapper", "[", 
       RowBox[{"ex_", ",", 
        RowBox[{"aa", "[", 
         RowBox[{"x_", ",", "y___", ",", "z_"}], "]"}], ",", "a_", ",", "b_", 
        ",", "c_"}], "]"}], ":=", 
      RowBox[{
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"#", "===", 
           RowBox[{"{", "}"}]}], ",", 
          RowBox[{"ftest", "[", 
           RowBox[{
            RowBox[{"ex", "*", 
             RowBox[{"aa", "[", 
              RowBox[{"x", ",", "y", ",", "z"}], "]"}]}], ",", "1", ",", "a", 
            ",", "b", ",", "c"}], "]"}], ",", "#"}], "]"}], "&"}], "@", 
       "\[IndentingNewLine]", 
       RowBox[{"Join", "[", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Combining", " ", "the", " ", "last", " ", "entry", " ", "of", " ", 
          "the", " ", "aa", " ", "with", " ", "all", " ", "the", " ", "first",
           " ", "entries", " ", "of", " ", "the", " ", "bb"}], "*)"}], 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"c", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "1"}], "]"}], "]"}], "===", "z"}], ",", 
             RowBox[{"ftest", "[", 
              RowBox[{"ex", ",", 
               RowBox[{"ab", "[", 
                RowBox[{"x", ",", "y", ",", 
                 RowBox[{"Sequence", "@@", 
                  RowBox[{"(", 
                   RowBox[{"List", "@@", 
                    RowBox[{"c", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], ")"}]}]}], "]"}], ",", 
               "a", ",", "b", ",", 
               RowBox[{"Drop", "[", 
                RowBox[{"c", ",", 
                 RowBox[{"{", "i", "}"}]}], "]"}]}], "]"}], ",", 
             RowBox[{"Nothing", "[", "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "@", "c"}]}], "}"}]}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
          "Combining", " ", "the", " ", "last", " ", "entry", " ", "of", " ", 
           "aa", " ", "with", " ", "the", " ", "last", " ", "of", " ", "ab", 
           " ", "and", " ", "bb"}], "*)"}], 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"b", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", 
                 RowBox[{"-", "1"}]}], "]"}], "]"}], "===", "z"}], ",", 
             RowBox[{"ftest", "[", 
              RowBox[{"ex", ",", 
               RowBox[{"aa", "[", 
                RowBox[{"x", ",", "y", ",", 
                 RowBox[{"Sequence", "@@", 
                  RowBox[{"Reverse", "@", 
                   RowBox[{"(", 
                    RowBox[{"b", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ")"}]}]}]}], "]"}], ",", 
               "a", ",", 
               RowBox[{"Drop", "[", 
                RowBox[{"b", ",", 
                 RowBox[{"{", "i", "}"}]}], "]"}], ",", "c"}], "]"}], ",", 
             RowBox[{"Nothing", "[", "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "@", "b"}]}], "}"}]}], "]"}], ",", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"c", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", 
                 RowBox[{"-", "1"}]}], "]"}], "]"}], "===", "z"}], ",", 
             RowBox[{"ftest", "[", 
              RowBox[{
               RowBox[{"-", "ex"}], ",", 
               RowBox[{"ab", "[", 
                RowBox[{"x", ",", "y", ",", 
                 RowBox[{"Sequence", "@@", 
                  RowBox[{"Reverse", "@", 
                   RowBox[{"(", 
                    RowBox[{"c", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ")"}]}]}]}], "]"}], ",", 
               "a", ",", "b", ",", 
               RowBox[{"Drop", "[", 
                RowBox[{"c", ",", 
                 RowBox[{"{", "i", "}"}]}], "]"}]}], "]"}], ",", 
             RowBox[{"Nothing", "[", "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "@", "c"}]}], "}"}]}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
          "First", " ", "entry", " ", "of", " ", "aa", " ", "with", " ", 
           "first", " ", "of", " ", "bb"}], "*)"}], 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"c", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "1"}], "]"}], "]"}], "===", "x"}], ",", 
             RowBox[{"ftest", "[", 
              RowBox[{
               RowBox[{"-", "ex"}], ",", 
               RowBox[{"ab", "[", 
                RowBox[{
                 RowBox[{"Sequence", "@@", 
                  RowBox[{"Reverse", "@", 
                   RowBox[{"{", 
                    RowBox[{"y", ",", "z"}], "}"}]}]}], ",", 
                 RowBox[{"Sequence", "@@", 
                  RowBox[{"(", 
                   RowBox[{"c", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ")"}]}]}], "]"}], ",", 
               "a", ",", "b", ",", 
               RowBox[{"Drop", "[", 
                RowBox[{"c", ",", 
                 RowBox[{"{", "i", "}"}]}], "]"}]}], "]"}], ",", 
             RowBox[{"Nothing", "[", "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "@", "c"}]}], "}"}]}], "]"}], ",", 
         RowBox[{"(*", 
          RowBox[{
          "First", " ", "of", " ", "aa", " ", "with", " ", "last", " ", "of", 
           " ", "ab"}], "*)"}], 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"b", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", 
                 RowBox[{"-", "1"}]}], "]"}], "]"}], "===", "x"}], ",", 
             RowBox[{"ftest", "[", 
              RowBox[{"ex", ",", 
               RowBox[{"aa", "[", 
                RowBox[{
                 RowBox[{"Sequence", "@@", 
                  RowBox[{"(", 
                   RowBox[{"b", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ")"}]}], ",", "y", ",", 
                 "z"}], "]"}], ",", "a", ",", 
               RowBox[{"Drop", "[", 
                RowBox[{"b", ",", 
                 RowBox[{"{", "i", "}"}]}], "]"}], ",", "c"}], "]"}], ",", 
             RowBox[{"Nothing", "[", "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "@", "b"}]}], "}"}]}], "]"}], ",", 
         RowBox[{"(*", 
          RowBox[{"First", " ", "aa", " ", "with", " ", "last", " ", "bb"}], 
          "*)"}], 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"c", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", 
                 RowBox[{"-", "1"}]}], "]"}], "]"}], "===", "x"}], ",", 
             RowBox[{"ftest", "[", 
              RowBox[{"ex", ",", 
               RowBox[{"ab", "[", 
                RowBox[{"Sequence", "@@", 
                 RowBox[{"Reverse", "@", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"Sequence", "@@", 
                    RowBox[{"(", 
                    RowBox[{"c", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ")"}]}], ",", "y", ",", 
                    "z"}], "}"}]}]}], "]"}], ",", "a", ",", "b", ",", 
               RowBox[{"Drop", "[", 
                RowBox[{"c", ",", 
                 RowBox[{"{", "i", "}"}]}], "]"}]}], "]"}], ",", 
             RowBox[{"Nothing", "[", "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "@", "c"}]}], "}"}]}], "]"}]}], "]"}]}]}], ";",
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Entry", " ", "in", " ", "ab"}], "*)"}], "\[IndentingNewLine]", 
     
     RowBox[{
      RowBox[{"wrapper", "[", 
       RowBox[{"ex_", ",", 
        RowBox[{"ab", "[", 
         RowBox[{"x_", ",", "y___", ",", "z_"}], "]"}], ",", "a_", ",", "b_", 
        ",", "c_"}], "]"}], ":=", 
      RowBox[{
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"#", "===", 
           RowBox[{"{", "}"}]}], ",", 
          RowBox[{"ftest", "[", 
           RowBox[{
            RowBox[{"ex", "*", 
             RowBox[{"ab", "[", 
              RowBox[{"x", ",", "y", ",", "z"}], "]"}]}], ",", "1", ",", "a", 
            ",", "b", ",", "c"}], "]"}], ",", "#"}], "]"}], "&"}], "@", 
       RowBox[{"Join", "[", 
        RowBox[{"(*", 
         RowBox[{"Last", " ", "ab", " ", "with", " ", "first", " ", "aa"}], 
         "*)"}], 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"a", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "1"}], "]"}], "]"}], "===", "z"}], ",", 
             RowBox[{"ftest", "[", 
              RowBox[{"ex", ",", 
               RowBox[{"aa", "[", 
                RowBox[{"x", ",", "y", ",", 
                 RowBox[{"Sequence", "@@", 
                  RowBox[{"(", 
                   RowBox[{"a", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ")"}]}]}], "]"}], ",", 
               RowBox[{"Drop", "[", 
                RowBox[{"a", ",", 
                 RowBox[{"{", "i", "}"}]}], "]"}], ",", "b", ",", "c"}], 
              "]"}], ",", 
             RowBox[{"Nothing", "[", "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "@", "a"}]}], "}"}]}], "]"}], ",", 
         RowBox[{"(*", 
          RowBox[{"Last", " ", "ab", " ", "with", " ", "last", " ", "aa"}], 
          "*)"}], 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"a", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", 
                 RowBox[{"-", "1"}]}], "]"}], "]"}], "===", "z"}], ",", 
             RowBox[{"ftest", "[", 
              RowBox[{
               RowBox[{"-", "ex"}], ",", 
               RowBox[{"aa", "[", 
                RowBox[{"x", ",", "y", ",", 
                 RowBox[{"Sequence", "@@", 
                  RowBox[{"Reverse", "@", 
                   RowBox[{"(", 
                    RowBox[{"a", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ")"}]}]}]}], "]"}], ",", 
               RowBox[{"Drop", "[", 
                RowBox[{"a", ",", 
                 RowBox[{"{", "i", "}"}]}], "]"}], ",", "b", ",", "c"}], 
              "]"}], ",", 
             RowBox[{"Nothing", "[", "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "@", "a"}]}], "}"}]}], "]"}], ",", 
         RowBox[{"(*", 
          RowBox[{"First", " ", "ab", " ", "with", " ", "last", " ", "bb"}], 
          "*)"}], 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"c", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", 
                 RowBox[{"-", "1"}]}], "]"}], "]"}], "===", "x"}], ",", 
             RowBox[{"ftest", "[", 
              RowBox[{"ex", ",", 
               RowBox[{"bb", "[", 
                RowBox[{
                 RowBox[{"Sequence", "@@", 
                  RowBox[{"(", 
                   RowBox[{"c", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ")"}]}], ",", "y", ",", 
                 "z"}], "]"}], ",", "a", ",", "b", ",", 
               RowBox[{"Drop", "[", 
                RowBox[{"c", ",", 
                 RowBox[{"{", "i", "}"}]}], "]"}]}], "]"}], ",", 
             RowBox[{"Nothing", "[", "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "@", "c"}]}], "}"}]}], "]"}], ",", 
         RowBox[{"(*", 
          RowBox[{"First", " ", "ab", " ", "with", " ", "first", " ", "bb"}], 
          "*)"}], 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"c", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "1"}], "]"}], "]"}], "===", "x"}], ",", 
             RowBox[{"ftest", "[", 
              RowBox[{
               RowBox[{"-", "ex"}], ",", 
               RowBox[{"bb", "[", 
                RowBox[{
                 RowBox[{"Sequence", "@@", 
                  RowBox[{"Reverse", "@", 
                   RowBox[{"(", 
                    RowBox[{"c", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ")"}]}]}], ",", "y", ",", 
                 "z"}], "]"}], ",", "a", ",", "b", ",", 
               RowBox[{"Drop", "[", 
                RowBox[{"c", ",", 
                 RowBox[{"{", "i", "}"}]}], "]"}]}], "]"}], ",", 
             RowBox[{"Nothing", "[", "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "@", "c"}]}], "}"}]}], "]"}]}], "]"}]}]}], ";",
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"Entry", " ", "in", " ", 
        RowBox[{"bb", ".", " ", "We"}], " ", "simply", " ", "plug", " ", "it",
         " ", "back", " ", "into", " ", "the", " ", "bb", " ", "list", " ", 
        "and", " ", "restart"}], ",", " ", 
       RowBox[{
       "so", " ", "we", " ", "recycle", " ", "definitions", " ", "of", " ", 
        "aa", " ", "and", " ", "ab", " ", "above"}]}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"wrapper", "[", 
       RowBox[{"ex_", ",", 
        RowBox[{"bb", "[", "x__", "]"}], ",", "a_", ",", "b_", ",", "c_"}], 
       "]"}], ":=", 
      RowBox[{"ftest", "[", 
       RowBox[{"ex", ",", "1", ",", "a", ",", "b", ",", 
        RowBox[{"Append", "[", 
         RowBox[{"c", ",", 
          RowBox[{"bb", "[", "x", "]"}]}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"local", "=", 
      RowBox[{"wrapper", "[", 
       RowBox[{"1", ",", 
        RowBox[{"bb", "[", 
         RowBox[{"p5", ",", "p3", ",", "p9"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"aa", "[", 
           RowBox[{"1", ",", "2"}], "]"}], ",", 
          RowBox[{"aa", "[", 
           RowBox[{"4", ",", "9"}], "]"}], ",", 
          RowBox[{"aa", "[", 
           RowBox[{"9", ",", "5"}], "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"ab", "[", 
           RowBox[{"7", ",", "8", ",", "9"}], "]"}], ",", 
          RowBox[{"ab", "[", 
           RowBox[{"1", ",", "2", ",", "9"}], "]"}], ",", 
          RowBox[{"ab", "[", 
           RowBox[{"1", ",", "2", ",", "p1"}], "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"bb", "[", 
           RowBox[{"p1", ",", "3"}], "]"}], ",", 
          RowBox[{"bb", "[", 
           RowBox[{"5", ",", "6"}], "]"}], ",", 
          RowBox[{"bb", "[", 
           RowBox[{"5", ",", "9"}], "]"}], ",", 
          RowBox[{"bb", "[", 
           RowBox[{"2", ",", "4"}], "]"}], ",", 
          RowBox[{"bb", "[", 
           RowBox[{"p2", ",", "p1"}], "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Return", " ", "the", " ", "function"}], "*)"}], 
     "\[IndentingNewLine]", "local"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.8462456814201593`*^9, 3.846245825156507*^9}, {
   3.84624588041416*^9, 3.846246059525483*^9}, {3.846246159961267*^9, 
   3.846246506356346*^9}, {3.8462465588496513`*^9, 3.846246776938932*^9}, {
   3.8462468211574593`*^9, 3.846246821357975*^9}, {3.8462469009381323`*^9, 
   3.846247006582032*^9}, {3.846247070132245*^9, 3.846247149644244*^9}, {
   3.846247374359428*^9, 3.8462474663508*^9}, {3.8462475097111187`*^9, 
   3.846247529989496*^9}, 3.846247663407776*^9, {3.846247846840952*^9, 
   3.8462478514860983`*^9}, {3.846247998536194*^9, 3.8462482085672503`*^9}, {
   3.8462483680399227`*^9, 3.8462486484817333`*^9}, {3.8462487027049007`*^9, 
   3.846248724368257*^9}, {3.846248797143999*^9, 3.846248816218581*^9}, {
   3.8462488954114532`*^9, 3.846249049858389*^9}, {3.846249189482415*^9, 
   3.8462493254442596`*^9}, {3.846249385925198*^9, 3.846249487653274*^9}, {
   3.846249544221499*^9, 3.846249546222382*^9}, {3.846249589856963*^9, 
   3.84624967719884*^9}, {3.8462502101602983`*^9, 3.8462502823829317`*^9}, {
   3.8466736897255898`*^9, 3.8466737132423563`*^9}, {3.846673787513953*^9, 
   3.8466738715461493`*^9}, {3.846673957521954*^9, 3.846673984547014*^9}, {
   3.846674145495881*^9, 3.8466742128864717`*^9}, {3.846674595008449*^9, 
   3.846674630136456*^9}, {3.846674694990931*^9, 3.8466747000636473`*^9}, {
   3.8466747961635733`*^9, 3.846674953065852*^9}, {3.8466749914594097`*^9, 
   3.846675024454584*^9}, {3.846675202987584*^9, 3.846675218898118*^9}, {
   3.846675252620487*^9, 3.8466753463304377`*^9}, {3.846675554571374*^9, 
   3.846675660387985*^9}, {3.8466757145470448`*^9, 3.846675822132268*^9}, {
   3.846676264327422*^9, 3.846676282809916*^9}, {3.846676318013103*^9, 
   3.8466763538782*^9}, 3.8466764126300097`*^9, {3.846676467765717*^9, 
   3.846676558822207*^9}, {3.846676738181177*^9, 3.846676742607403*^9}, {
   3.846676775079438*^9, 3.84667680190305*^9}, {3.846676877605699*^9, 
   3.846677019256134*^9}, {3.846677833092266*^9, 3.846677955482648*^9}, {
   3.846678266914877*^9, 3.8466783138718147`*^9}, {3.846678423487372*^9, 
   3.8466785489015512`*^9}, {3.846678590086501*^9, 3.846678590240883*^9}, {
   3.846737994247161*^9, 3.846738004503858*^9}, {3.84673803926145*^9, 
   3.846738043581056*^9}, {3.846738075204897*^9, 3.8467380767987223`*^9}, {
   3.846738324485396*^9, 3.846738363902405*^9}, {3.846738549976481*^9, 
   3.8467386234799957`*^9}, {3.8467386620800943`*^9, 
   3.8467386667625303`*^9}, {3.846738707330525*^9, 3.846738709144993*^9}, {
   3.8467387719995604`*^9, 3.846738802416275*^9}, {3.846738865026211*^9, 
   3.8467388941297913`*^9}, {3.8467390345762873`*^9, 3.846739145036749*^9}, {
   3.846739185086565*^9, 3.8467393313401337`*^9}, {3.846739689354558*^9, 
   3.846739694756753*^9}, {3.8467400608109426`*^9, 3.846740223107369*^9}, {
   3.846740311305922*^9, 3.8467403137190647`*^9}, {3.84674042257513*^9, 
   3.8467404287644377`*^9}, {3.84674073988706*^9, 3.8467408609842367`*^9}, {
   3.846740898995308*^9, 3.846740902645625*^9}, {3.846741092330057*^9, 
   3.846741223363451*^9}, {3.846741273401784*^9, 3.8467413019477367`*^9}, {
   3.846741527121957*^9, 3.846741527308371*^9}, {3.8467415957943*^9, 
   3.846741645888163*^9}, {3.846741748890009*^9, 3.846741839195334*^9}, {
   3.846741884019949*^9, 3.846741998114798*^9}, {3.846742063810554*^9, 
   3.84674210675229*^9}, {3.846742137695187*^9, 3.846742187767593*^9}, {
   3.846742227202767*^9, 3.846742311862904*^9}, {3.846742434968604*^9, 
   3.8467426301567087`*^9}, {3.846742696026381*^9, 3.846742750778027*^9}},
 CellLabel->
  "In[113]:=",ExpressionUUID->"a85f2d44-0fa4-45e2-b100-951bcc12a0cc"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"7", "*", "z", "*", 
   TemplateBox[{"1", "2"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], 
   TemplateBox[{"2", "3"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], 
   TemplateBox[{"3", "4"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], 
   TemplateBox[{"3", "5"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], 
   RowBox[{
    TemplateBox[{"5", "6"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "^", "2"}], 
   RowBox[{
    TemplateBox[{"7", 
      RowBox[{"{", "8", "}"}], "9"},
     "AngleSquareChain",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
     InterpretationFunction->(
      RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
        "$square", "]"}]& )], "/", 
    RowBox[{"(", 
     RowBox[{
      TemplateBox[{"p1", "p2"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], 
      RowBox[{
       TemplateBox[{"p2", "p3"},
        "SpinorSquareBracket",
        DisplayFunction->(RowBox[{"[", 
           RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
        InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
           RowBox[{#, ",", #2}], "]"}]& )], "^", "2"}]}], ")"}]}]}], "//", 
  "PreChain"}]], "Input",
 CellChangeTimes->{{3.846242173509924*^9, 3.846242231112877*^9}, {
  3.846246116586875*^9, 3.846246150278006*^9}, {3.8462461817347727`*^9, 
  3.846246182158164*^9}, {3.846246578013474*^9, 3.846246578378786*^9}, {
  3.846247680110651*^9, 3.846247683789065*^9}},
 CellLabel->
  "In[114]:=",ExpressionUUID->"92931acd-c407-4adf-b3d5-357469dad063"],

Cell[BoxData[
 RowBox[{"ftest", "[", 
  RowBox[{"1", ",", "1", ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"aa", "[", 
      RowBox[{"1", ",", "2"}], "]"}], ",", 
     RowBox[{"aa", "[", 
      RowBox[{"4", ",", "9"}], "]"}], ",", 
     RowBox[{"aa", "[", 
      RowBox[{"9", ",", "5"}], "]"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"ab", "[", 
      RowBox[{"7", ",", "8", ",", "9"}], "]"}], ",", 
     RowBox[{"ab", "[", 
      RowBox[{"1", ",", "2", ",", "9"}], "]"}], ",", 
     RowBox[{"ab", "[", 
      RowBox[{"1", ",", "2", ",", "p1"}], "]"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"bb", "[", 
      RowBox[{"p1", ",", "3"}], "]"}], ",", 
     RowBox[{"bb", "[", 
      RowBox[{"5", ",", "6"}], "]"}], ",", 
     RowBox[{"bb", "[", 
      RowBox[{"5", ",", "9"}], "]"}], ",", 
     RowBox[{"bb", "[", 
      RowBox[{"2", ",", "4"}], "]"}], ",", 
     RowBox[{"bb", "[", 
      RowBox[{"p2", ",", "p1"}], "]"}], ",", 
     RowBox[{"bb", "[", 
      RowBox[{"p5", ",", "p3", ",", "p9"}], "]"}]}], "}"}]}], "]"}]], "Output",\

 CellChangeTimes->{
  3.84624611997372*^9, 3.846246151308091*^9, 3.846246183552204*^9, 
   3.846246235365589*^9, 3.846246376832349*^9, {3.846246424554968*^9, 
   3.846246439031102*^9}, 3.846246471934087*^9, 3.846246579394256*^9, 
   3.846246688354754*^9, 3.8462470081212587`*^9, {3.8462470922578087`*^9, 
   3.846247121462365*^9}, {3.846247445871354*^9, 3.846247467791078*^9}, {
   3.846247668496654*^9, 3.846247685000882*^9}, {3.846248016852743*^9, 
   3.846248049962275*^9}, 3.8462484455387506`*^9, {3.846248476005752*^9, 
   3.8462484847031097`*^9}, 3.846248535328216*^9, 3.846249757710393*^9, 
   3.846667513813611*^9, 3.846673693242999*^9, 3.846674204087784*^9, {
   3.846674935957589*^9, 3.846674954745063*^9}, 3.846675030390892*^9, 
   3.846675206681568*^9, {3.8466752434827557`*^9, 3.846675291700943*^9}, 
   3.846678483068389*^9, {3.846678522601722*^9, 3.846678550403185*^9}, 
   3.8467380114278393`*^9, 3.8467380456997623`*^9, 3.846738078710441*^9, 
   3.84673862739706*^9, 3.846738669944131*^9, 3.846738940403521*^9, 
   3.846739053551709*^9, 3.8467393053039494`*^9, 3.846739336531863*^9, 
   3.846739696777441*^9, 3.846740190453413*^9, 3.8467402249021387`*^9, 
   3.846740869774839*^9, 3.8467409039996853`*^9, 3.846741537562234*^9, {
   3.8467418142038727`*^9, 3.8467418410786247`*^9}, 3.846742010400065*^9, 
   3.846742202063075*^9, 3.846742487301585*^9, 3.846742636959553*^9, {
   3.846742698989911*^9, 3.846742753065506*^9}},
 CellLabel->
  "Out[114]=",ExpressionUUID->"d6625037-8bbe-4fc5-8af8-79538087e9dc"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Drop", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"a", ",", "b", ",", "c", ",", "d", ",", "e"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"3", ",", "5"}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.846674527522703*^9, 3.8466745616556177`*^9}},
 CellLabel->"In[13]:=",ExpressionUUID->"a94ee9cf-19ce-4daf-8e1d-d879f660293a"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"a", ",", "b"}], "}"}]], "Output",
 CellChangeTimes->{{3.8466745337227583`*^9, 3.846674563130909*^9}},
 CellLabel->"Out[13]=",ExpressionUUID->"d410ff37-5556-41ee-a545-713ea2c70da8"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Table", "[", 
  RowBox[{
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"i", "===", "b"}], ",", "1", ",", "Nothing"}], "]"}], ",", 
   RowBox[{"{", 
    RowBox[{"i", ",", 
     RowBox[{"{", 
      RowBox[{"a", ",", "b", ",", "c"}], "}"}]}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.846675835127018*^9, 3.846675882448163*^9}},
 CellLabel->"In[38]:=",ExpressionUUID->"f8cb976b-03fb-4507-82b4-8406e83c1849"],

Cell[BoxData[
 RowBox[{"{", "1", "}"}]], "Output",
 CellChangeTimes->{{3.846675851771722*^9, 3.846675882680285*^9}},
 CellLabel->"Out[38]=",ExpressionUUID->"81a477e6-0c19-481d-b47b-8d2dc3ca918c"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"i", "===", "5"}], ",", "1", ",", "Nothing"}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", "10000"}], "}"}]}], "]"}], "//", 
  "AbsoluteTiming"}]], "Input",
 CellChangeTimes->{{3.846676138207015*^9, 3.846676179213376*^9}, 
   3.846676213004821*^9},
 CellLabel->"In[42]:=",ExpressionUUID->"7b01f067-c0ac-4b49-85d7-377ea4976069"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.019417`", ",", 
   RowBox[{"{", "1", "}"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.846676174561108*^9, 3.846676179426866*^9}, 
   3.8466762144272623`*^9},
 CellLabel->"Out[42]=",ExpressionUUID->"71fe96c1-3145-43df-b57d-328ea63575f1"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"DeleteCases", "[", 
   RowBox[{
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"i", "===", "5"}], ",", "1"}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", "10000"}], "}"}]}], "]"}], ",", "Null"}], "]"}], "//",
   "AbsoluteTiming"}]], "Input",
 CellChangeTimes->{{3.8466761944431257`*^9, 3.8466762158421307`*^9}},
 CellLabel->"In[43]:=",ExpressionUUID->"2cb4e89e-20ec-4447-8380-90bd7c60b4bc"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.016278`", ",", 
   RowBox[{"{", "1", "}"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.846676205861642*^9, 3.846676216443527*^9}},
 CellLabel->"Out[43]=",ExpressionUUID->"5fa58c5e-9741-4868-8064-5ae5a7d89397"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"{", 
   RowBox[{"f", "[", 
    RowBox[{"1", ",", "2", ",", "3"}], "]"}], "}"}], "[", 
  RowBox[{"[", 
   RowBox[{"1", ",", "1"}], "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.84667834502227*^9, 3.846678382246582*^9}},
 CellLabel->"In[52]:=",ExpressionUUID->"f5c84b15-f36b-432f-a857-db008503701c"],

Cell[BoxData["1"], "Output",
 CellChangeTimes->{{3.846678355156786*^9, 3.846678382987679*^9}},
 CellLabel->"Out[52]=",ExpressionUUID->"10b16e63-0701-4556-80cf-f5798bbc7930"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["\<\
Recursing the previous test, very slow with high powers of brackets\
\>", "Subsection",
 CellChangeTimes->{{3.846245675277483*^9, 3.846245677621294*^9}, {
  3.846673722916071*^9, 3.846673724332143*^9}, {3.8467427791663427`*^9, 
  3.846742783985442*^9}, {3.846744431908648*^9, 
  3.8467444392345448`*^9}},ExpressionUUID->"e9d95bbe-a245-4546-ab91-\
3b551c64daa4"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"Options", "[", "PreChain", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"ChainSelection", "->"}], "}"}]}], "*)"}]], "Input",
 CellChangeTimes->{{3.846743508106366*^9, 3.846743528518509*^9}, {
  3.846743605388595*^9, 
  3.846743661255863*^9}},ExpressionUUID->"abe71767-4bd5-4acb-ad61-\
dfe1ec985742"],

Cell[BoxData[
 RowBox[{
  RowBox[{"PreChain", "[", "exp_", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "aa", ",", "bb", ",", "ab", ",", "wrapper", ",", "invwrapper", ",", 
      "local", ",", "SpinorAngleBracket", ",", "SpinorSquareBracket", ",", 
      "Chain", ",", "ftest"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"local", "=", "exp"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Convert", " ", "all", " ", "the", " ", "chains", " ", "and", " ", 
       "spinor", " ", "brackets", " ", "into", " ", "simpler", " ", "objects",
        " ", "and", " ", "wrap", " ", "them", " ", "into", " ", "a", " ", 
       "function", " ", "which", " ", "will", " ", "chain", " ", "them"}], 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"SpinorAngleBracket", "[", "x__", "]"}], ":=", 
      RowBox[{"wrapper", "[", 
       RowBox[{"aa", "[", "x", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"SpinorSquareBracket", "[", "x__", "]"}], ":=", 
      RowBox[{"wrapper", "[", 
       RowBox[{"bb", "[", "x", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Chain", "[", 
       RowBox[{"$angle", ",", "x__", ",", "$angle"}], "]"}], ":=", 
      RowBox[{"wrapper", "[", 
       RowBox[{"aa", "[", 
        RowBox[{"Sequence", "@@", 
         RowBox[{"Flatten", "@", 
          RowBox[{"{", "x", "}"}]}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Chain", "[", 
       RowBox[{"$angle", ",", "x__", ",", "$square"}], "]"}], ":=", 
      RowBox[{"wrapper", "[", 
       RowBox[{"ab", "[", 
        RowBox[{"Sequence", "@@", 
         RowBox[{"Flatten", "@", 
          RowBox[{"{", "x", "}"}]}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Chain", "[", 
       RowBox[{"$square", ",", "x__", ",", "$angle"}], "]"}], ":=", 
      RowBox[{"wrapper", "[", 
       RowBox[{"ab", "[", 
        RowBox[{"Sequence", "@@", 
         RowBox[{"Reverse", "@", 
          RowBox[{"Flatten", "@", 
           RowBox[{"{", "x", "}"}]}]}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Chain", "[", 
       RowBox[{"$square", ",", "x__", ",", "$square"}], "]"}], ":=", 
      RowBox[{"wrapper", "[", 
       RowBox[{"bb", "[", 
        RowBox[{"Sequence", "@@", 
         RowBox[{"Flatten", "@", 
          RowBox[{"{", "x", "}"}]}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
       "Define", " ", "properties", " ", "of", " ", "the", " ", "wrapper", 
        " ", "so", " ", "that", " ", "it", " ", "wraps", " ", "everything", 
        " ", "together"}], ",", " ", 
       RowBox[{"taking", " ", "care", " ", "of", " ", "the", " ", 
        RowBox[{"powers", ".", " ", "Inverse"}], " ", "powers", " ", "are", 
        " ", "the", " ", "reason", " ", "we", " ", "need", " ", "the", " ", 
        "auxiliary", " ", "invwrapper"}], ",", " ", 
       RowBox[{
        RowBox[{
        "this", " ", "would", " ", "be", " ", "needed", " ", "if", " ", "we", 
         " ", "could", " ", "go", " ", "deeper", " ", "with", " ", "the", " ",
          "upvalues", " ", "of", " ", "wrapper"}], "..."}]}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"wrapper", " ", "/:", " ", 
      RowBox[{
       RowBox[{"wrapper", "[", "x_", "]"}], "*", 
       RowBox[{"wrapper", "[", "y_", "]"}]}], ":=", 
      RowBox[{"wrapper", "[", 
       RowBox[{"x", "*", "y"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"wrapper", " ", "/:", " ", 
      RowBox[{"Power", "[", 
       RowBox[{
        RowBox[{"wrapper", "[", "x_", "]"}], ",", 
        RowBox[{"n_", "?", "Positive"}]}], "]"}], ":=", 
      RowBox[{"wrapper", "[", 
       RowBox[{"Power", "[", 
        RowBox[{"x", ",", "n"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"wrapper", " ", "/:", " ", 
      RowBox[{"Power", "[", 
       RowBox[{
        RowBox[{"wrapper", "[", "x_", "]"}], ",", 
        RowBox[{"n_", "?", "Negative"}]}], "]"}], ":=", 
      RowBox[{"invwrapper", "[", 
       RowBox[{"Power", "[", 
        RowBox[{"x", ",", 
         RowBox[{"-", "n"}]}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"invwrapper", " ", "/:", " ", 
      RowBox[{
       RowBox[{"invwrapper", "[", "x_", "]"}], "*", 
       RowBox[{"invwrapper", "[", "y_", "]"}]}], ":=", 
      RowBox[{"invwrapper", "[", 
       RowBox[{"x", "*", "y"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"local", "=", "local"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Reconvert", " ", "the", " ", "inwrapper", " ", "to", " ", "the", " ", 
       "inverse", " ", "power", " ", "of", " ", "a", " ", "wrapper"}], "*)"}],
      "\[IndentingNewLine]", 
     RowBox[{"Clear", "[", "wrapper", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"invwrapper", "[", "x_", "]"}], ":=", 
      RowBox[{"Power", "[", 
       RowBox[{
        RowBox[{"wrapper", "[", "x", "]"}], ",", 
        RowBox[{"-", "1"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"local", "=", "local"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
       "Next", " ", "we", " ", "want", " ", "the", " ", "wrapper", " ", "to", 
        " ", "be", " ", "ready", " ", "to", " ", "actually", " ", "do", " ", 
        "stuff"}], ",", " ", 
       RowBox[{
       "so", " ", "we", " ", "group", " ", "things", " ", "together", " ", 
        "in", " ", 
        RowBox[{"lists", ":", " ", "aa"}]}], ",", "bb", ",", 
       RowBox[{"ab", " ", "and", " ", "ba", " ", "separate"}], ",", " ", 
       RowBox[{
       "along", " ", "with", " ", "the", " ", "product", " ", "of", " ", 
        "already", " ", "used", " ", 
        RowBox[{"stuff", ".", " ", "First"}], " ", "convert", " ", 
        "arguments", " ", "of", " ", "wrapper", " ", "to", " ", "a", " ", 
        "list"}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Clear", "[", "invwrapper", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"wrapper", "[", 
       RowBox[{"f_", "[", "x__", "]"}], "]"}], ":=", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"f", "===", "Times"}], ",", 
        RowBox[{"invwrapper", "[", 
         RowBox[{"List", "[", "x", "]"}], "]"}], ",", 
        RowBox[{"invwrapper", "[", 
         RowBox[{"{", "x", "}"}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
       "Here", " ", "we", " ", "gather", " ", "the", " ", "objects", " ", 
        "by", " ", "head"}], ",", " ", 
       RowBox[{
       "then", " ", "replace", " ", "powers", " ", "by", " ", "arrays", " ", 
        "with", " ", "correct", " ", "multiplicity"}], ",", " ", 
       RowBox[{
       "and", " ", "finally", " ", "make", "  ", "atable", " ", "with", " ", 
        "the", " ", "elements", " ", "of", " ", "each", " ", "type", " ", 
        "putting", " ", "an", " ", "empty", " ", "list", " ", "for", " ", 
        "the", " ", "missing", " ", 
        RowBox[{"ones", ".", " ", "We"}], " ", "keep", " ", "the", " ", 
        "invwrapper", " ", "as", " ", "an", " ", "external", " ", 
        "container"}], ",", " ", 
       RowBox[{
       "so", " ", "that", " ", "once", " ", "wrapper", " ", "has", " ", 
        "done", " ", 
        RowBox[{"it", "'"}], "s", " ", "job"}], ",", " ", 
       RowBox[{
       "invwrapper", " ", "can", " ", "select", " ", "the", " ", "chain", " ",
         "we", " ", "want"}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"local", "=", "local"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Clear", "[", "wrapper", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"invwrapper", "[", "x_List", "]"}], ":=", 
      RowBox[{"invwrapper", "[", 
       RowBox[{"wrapper", "[", 
        RowBox[{"1", ",", "1", ",", 
         RowBox[{"Sequence", "@@", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"SelectFirst", "[", 
             RowBox[{
              RowBox[{"GatherBy", "[", 
               RowBox[{
                RowBox[{"Flatten", "[", 
                 RowBox[{"x", "/.", 
                  RowBox[{"Power", "->", "ConstantArray"}]}], "]"}], ",", 
                "Head"}], "]"}], ",", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"#", "[", 
                  RowBox[{"[", 
                   RowBox[{"1", ",", "0"}], "]"}], "]"}], "===", "i"}], "&"}],
                ")"}], ",", 
              RowBox[{"{", "}"}]}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", 
              RowBox[{"{", 
               RowBox[{"aa", ",", "ab", ",", "bb"}], "}"}]}], "}"}]}], 
           "]"}]}]}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"local", "=", "local"}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
       "Now", " ", "we", " ", "clear", " ", "the", " ", "invwrapper", " ", 
        "and", " ", "make", " ", "the", " ", "wrapper", " ", "do", " ", "the",
         " ", "magic", " ", "of", " ", 
        RowBox[{"combinatorics", ".", " ", "The"}], " ", "aa"}], ",", "bb", 
       ",", "ba", ",", 
       RowBox[{
       "ab", " ", "objects", " ", "get", " ", "some", " ", "specific", " ", 
        "properties", " ", "which", " ", "is", " ", "what", " ", "will", " ", 
        "build", " ", "the", " ", "chains"}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Clear", "[", "invwrapper", "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"The", " ", "wrapper", " ", "acts", " ", "recursively"}], ",", 
       " ", 
       RowBox[{"testing", " ", "its", " ", "second", " ", 
        RowBox[{"argument", "'"}], "s", " ", "head", " ", "and", " ", 
        "accordingly", " ", "combining", " ", "it", " ", "with", " ", "one", 
        " ", "of", " ", "the", " ", "elements", " ", "in", " ", "the", " ", 
        "lists", " ", "of", " ", 
        RowBox[{"brackets", ".", " ", "If"}], " ", "no", " ", "combination", 
        " ", "is", " ", "possible", " ", "the", " ", "second", " ", 
        "argument", " ", "is", " ", "merged", " ", "with", " ", "the", " ", 
        "first", " ", "one", " ", "and", " ", "a", " ", "new", " ", "cycle", 
        " ", 
        RowBox[{"begins", ".", " ", "Termination"}], " ", "condition", " ", 
        "is", " ", "that", " ", "all", " ", "lists", " ", "are", " ", 
        "empty"}]}], "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Termination", " ", "condition"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"wrapper", "[", 
       RowBox[{"x_", ",", "y_", ",", 
        RowBox[{"{", "}"}], ",", 
        RowBox[{"{", "}"}], ",", 
        RowBox[{"{", "}"}]}], "]"}], ":=", 
      RowBox[{"x", "*", "y"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"The", " ", "starting", " ", "point"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"wrapper", "[", 
       RowBox[{"x_", ",", "1", ",", "a_", ",", "b_", ",", "c_"}], "]"}], ":=", 
      RowBox[{"Which", "[", 
       RowBox[{
        RowBox[{"a", "=!=", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{"wrapper", "[", 
         RowBox[{"x", ",", 
          RowBox[{"First", "@", "a"}], ",", 
          RowBox[{"Rest", "@", "a"}], ",", "b", ",", "c"}], "]"}], ",", 
        RowBox[{"b", "=!=", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{"wrapper", "[", 
         RowBox[{"x", ",", 
          RowBox[{"First", "@", "b"}], ",", "a", ",", 
          RowBox[{"Rest", "@", "b"}], ",", "c"}], "]"}], ",", 
        RowBox[{"c", "=!=", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{"wrapper", "[", 
         RowBox[{"x", ",", 
          RowBox[{"First", "@", "c"}], ",", "a", ",", "b", ",", 
          RowBox[{"Rest", "@", "c"}]}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "If", " ", "any", " ", "two", " ", "of", " ", "the", " ", "lists", " ", 
       "are", " ", "empty", " ", "and", " ", "there", " ", "are", " ", "no", 
       " ", "brackets", " ", "in", " ", "the", " ", "second", " ", "slot", 
       " ", "of", " ", "wrapper", " ", "there", " ", "is", " ", "nothing", 
       " ", "to", " ", "be", " ", 
       RowBox[{"done", "."}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"wrapper", "[", 
       RowBox[{"x_", ",", "1", ",", 
        RowBox[{"{", "}"}], ",", 
        RowBox[{"{", "}"}], ",", "a_"}], "]"}], ":=", 
      RowBox[{"x", "*", 
       RowBox[{"Times", "@@", "a"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"wrapper", "[", 
       RowBox[{"x_", ",", "1", ",", 
        RowBox[{"{", "}"}], ",", "a_", ",", 
        RowBox[{"{", "}"}]}], "]"}], ":=", 
      RowBox[{"x", "*", 
       RowBox[{"Times", "@@", "a"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"wrapper", "[", 
       RowBox[{"x_", ",", "1", ",", "a_", ",", 
        RowBox[{"{", "}"}], ",", 
        RowBox[{"{", "}"}]}], "]"}], ":=", 
      RowBox[{"x", "*", 
       RowBox[{"Times", "@@", "a"}]}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"GENERAL", " ", 
       RowBox[{"QUESTION", ":", " ", 
        RowBox[{"is", " ", "this", " ", "pattern", " ", "matching", " ", 
         RowBox[{"aa", "[", 
          RowBox[{"x_", ",", "y___", ",", "z_"}], "]"}], " ", "faster", " ", 
         "or", " ", "is", " ", 
         RowBox[{"aa", "[", "x__", "]"}], " ", "with", " ", "calling", " ", 
         RowBox[{"First", "@", "x"}], " ", "every", " ", "time", " ", 
         RowBox[{"faster", "?"}]}]}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Entry", " ", "is", " ", "aa"}], "*)"}], "\[IndentingNewLine]", 
     
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
       "If", " ", "upon", " ", "parsing", " ", "the", " ", "lists", " ", "of",
         " ", "objects", " ", "and", " ", "making", " ", "all", " ", "the", 
        " ", "possible", " ", "contractions", " ", "an", " ", "empty", " ", 
        "list", " ", "is", " ", "returned"}], ",", " ", 
       RowBox[{
       "we", " ", "need", " ", "to", " ", "move", " ", "the", " ", "input", 
        " ", "entry", " ", "to", " ", "the", " ", "overall", " ", "product", 
        " ", "but", " ", "and", " ", "start", " ", "a", " ", "new", " ", 
        "iteration"}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"wrapper", "[", 
       RowBox[{"ex_", ",", 
        RowBox[{"aa", "[", 
         RowBox[{"x_", ",", "y___", ",", "z_"}], "]"}], ",", "a_", ",", "b_", 
        ",", "c_"}], "]"}], ":=", 
      RowBox[{
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"#", "===", 
           RowBox[{"{", "}"}]}], ",", 
          RowBox[{"ftest", "[", 
           RowBox[{
            RowBox[{"ex", "*", 
             RowBox[{"aa", "[", 
              RowBox[{"x", ",", "y", ",", "z"}], "]"}]}], ",", "1", ",", "a", 
            ",", "b", ",", "c"}], "]"}], ",", "#"}], "]"}], "&"}], "@", 
       "\[IndentingNewLine]", 
       RowBox[{"Join", "[", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Combining", " ", "the", " ", "last", " ", "entry", " ", "of", " ", 
          "the", " ", "aa", " ", "with", " ", "all", " ", "the", " ", "first",
           " ", "entries", " ", "of", " ", "the", " ", "bb"}], "*)"}], 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"c", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "1"}], "]"}], "]"}], "===", "z"}], ",", 
             RowBox[{"ftest", "[", 
              RowBox[{"ex", ",", 
               RowBox[{"ab", "[", 
                RowBox[{"x", ",", "y", ",", 
                 RowBox[{"Sequence", "@@", 
                  RowBox[{"(", 
                   RowBox[{"List", "@@", 
                    RowBox[{"c", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], ")"}]}]}], "]"}], ",", 
               "a", ",", "b", ",", 
               RowBox[{"Drop", "[", 
                RowBox[{"c", ",", 
                 RowBox[{"{", "i", "}"}]}], "]"}]}], "]"}], ",", 
             RowBox[{"Nothing", "[", "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "@", "c"}]}], "}"}]}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
          "Combining", " ", "the", " ", "last", " ", "entry", " ", "of", " ", 
           "aa", " ", "with", " ", "the", " ", "last", " ", "of", " ", "ab", 
           " ", "and", " ", "bb"}], "*)"}], 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"b", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", 
                 RowBox[{"-", "1"}]}], "]"}], "]"}], "===", "z"}], ",", 
             RowBox[{"ftest", "[", 
              RowBox[{"ex", ",", 
               RowBox[{"aa", "[", 
                RowBox[{"x", ",", "y", ",", 
                 RowBox[{"Sequence", "@@", 
                  RowBox[{"Reverse", "@", 
                   RowBox[{"(", 
                    RowBox[{"b", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ")"}]}]}]}], "]"}], ",", 
               "a", ",", 
               RowBox[{"Drop", "[", 
                RowBox[{"b", ",", 
                 RowBox[{"{", "i", "}"}]}], "]"}], ",", "c"}], "]"}], ",", 
             RowBox[{"Nothing", "[", "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "@", "b"}]}], "}"}]}], "]"}], ",", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"c", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", 
                 RowBox[{"-", "1"}]}], "]"}], "]"}], "===", "z"}], ",", 
             RowBox[{"ftest", "[", 
              RowBox[{
               RowBox[{"-", "ex"}], ",", 
               RowBox[{"ab", "[", 
                RowBox[{"x", ",", "y", ",", 
                 RowBox[{"Sequence", "@@", 
                  RowBox[{"Reverse", "@", 
                   RowBox[{"(", 
                    RowBox[{"c", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ")"}]}]}]}], "]"}], ",", 
               "a", ",", "b", ",", 
               RowBox[{"Drop", "[", 
                RowBox[{"c", ",", 
                 RowBox[{"{", "i", "}"}]}], "]"}]}], "]"}], ",", 
             RowBox[{"Nothing", "[", "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "@", "c"}]}], "}"}]}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
          "First", " ", "entry", " ", "of", " ", "aa", " ", "with", " ", 
           "first", " ", "of", " ", "bb"}], "*)"}], 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"c", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "1"}], "]"}], "]"}], "===", "x"}], ",", 
             RowBox[{"ftest", "[", 
              RowBox[{
               RowBox[{"-", "ex"}], ",", 
               RowBox[{"ab", "[", 
                RowBox[{
                 RowBox[{"Sequence", "@@", 
                  RowBox[{"Reverse", "@", 
                   RowBox[{"{", 
                    RowBox[{"y", ",", "z"}], "}"}]}]}], ",", 
                 RowBox[{"Sequence", "@@", 
                  RowBox[{"(", 
                   RowBox[{"c", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ")"}]}]}], "]"}], ",", 
               "a", ",", "b", ",", 
               RowBox[{"Drop", "[", 
                RowBox[{"c", ",", 
                 RowBox[{"{", "i", "}"}]}], "]"}]}], "]"}], ",", 
             RowBox[{"Nothing", "[", "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "@", "c"}]}], "}"}]}], "]"}], ",", 
         RowBox[{"(*", 
          RowBox[{
          "First", " ", "of", " ", "aa", " ", "with", " ", "last", " ", "of", 
           " ", "ab"}], "*)"}], 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"b", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", 
                 RowBox[{"-", "1"}]}], "]"}], "]"}], "===", "x"}], ",", 
             RowBox[{"ftest", "[", 
              RowBox[{"ex", ",", 
               RowBox[{"aa", "[", 
                RowBox[{
                 RowBox[{"Sequence", "@@", 
                  RowBox[{"(", 
                   RowBox[{"b", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ")"}]}], ",", "y", ",", 
                 "z"}], "]"}], ",", "a", ",", 
               RowBox[{"Drop", "[", 
                RowBox[{"b", ",", 
                 RowBox[{"{", "i", "}"}]}], "]"}], ",", "c"}], "]"}], ",", 
             RowBox[{"Nothing", "[", "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "@", "b"}]}], "}"}]}], "]"}], ",", 
         RowBox[{"(*", 
          RowBox[{"First", " ", "aa", " ", "with", " ", "last", " ", "bb"}], 
          "*)"}], 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"c", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", 
                 RowBox[{"-", "1"}]}], "]"}], "]"}], "===", "x"}], ",", 
             RowBox[{"ftest", "[", 
              RowBox[{"ex", ",", 
               RowBox[{"ab", "[", 
                RowBox[{"Sequence", "@@", 
                 RowBox[{"Reverse", "@", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"Sequence", "@@", 
                    RowBox[{"(", 
                    RowBox[{"c", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ")"}]}], ",", "y", ",", 
                    "z"}], "}"}]}]}], "]"}], ",", "a", ",", "b", ",", 
               RowBox[{"Drop", "[", 
                RowBox[{"c", ",", 
                 RowBox[{"{", "i", "}"}]}], "]"}]}], "]"}], ",", 
             RowBox[{"Nothing", "[", "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "@", "c"}]}], "}"}]}], "]"}]}], "]"}]}]}], ";",
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Entry", " ", "in", " ", "ab"}], "*)"}], "\[IndentingNewLine]", 
     
     RowBox[{
      RowBox[{"wrapper", "[", 
       RowBox[{"ex_", ",", 
        RowBox[{"ab", "[", 
         RowBox[{"x_", ",", "y___", ",", "z_"}], "]"}], ",", "a_", ",", "b_", 
        ",", "c_"}], "]"}], ":=", 
      RowBox[{
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"#", "===", 
           RowBox[{"{", "}"}]}], ",", 
          RowBox[{"ftest", "[", 
           RowBox[{
            RowBox[{"ex", "*", 
             RowBox[{"ab", "[", 
              RowBox[{"x", ",", "y", ",", "z"}], "]"}]}], ",", "1", ",", "a", 
            ",", "b", ",", "c"}], "]"}], ",", "#"}], "]"}], "&"}], "@", 
       RowBox[{"Join", "[", 
        RowBox[{"(*", 
         RowBox[{"Last", " ", "ab", " ", "with", " ", "first", " ", "aa"}], 
         "*)"}], 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"a", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "1"}], "]"}], "]"}], "===", "z"}], ",", 
             RowBox[{"ftest", "[", 
              RowBox[{"ex", ",", 
               RowBox[{"aa", "[", 
                RowBox[{"x", ",", "y", ",", 
                 RowBox[{"Sequence", "@@", 
                  RowBox[{"(", 
                   RowBox[{"a", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ")"}]}]}], "]"}], ",", 
               RowBox[{"Drop", "[", 
                RowBox[{"a", ",", 
                 RowBox[{"{", "i", "}"}]}], "]"}], ",", "b", ",", "c"}], 
              "]"}], ",", 
             RowBox[{"Nothing", "[", "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "@", "a"}]}], "}"}]}], "]"}], ",", 
         RowBox[{"(*", 
          RowBox[{"Last", " ", "ab", " ", "with", " ", "last", " ", "aa"}], 
          "*)"}], 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"a", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", 
                 RowBox[{"-", "1"}]}], "]"}], "]"}], "===", "z"}], ",", 
             RowBox[{"ftest", "[", 
              RowBox[{
               RowBox[{"-", "ex"}], ",", 
               RowBox[{"aa", "[", 
                RowBox[{"x", ",", "y", ",", 
                 RowBox[{"Sequence", "@@", 
                  RowBox[{"Reverse", "@", 
                   RowBox[{"(", 
                    RowBox[{"a", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ")"}]}]}]}], "]"}], ",", 
               RowBox[{"Drop", "[", 
                RowBox[{"a", ",", 
                 RowBox[{"{", "i", "}"}]}], "]"}], ",", "b", ",", "c"}], 
              "]"}], ",", 
             RowBox[{"Nothing", "[", "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "@", "a"}]}], "}"}]}], "]"}], ",", 
         RowBox[{"(*", 
          RowBox[{"First", " ", "ab", " ", "with", " ", "last", " ", "bb"}], 
          "*)"}], 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"c", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", 
                 RowBox[{"-", "1"}]}], "]"}], "]"}], "===", "x"}], ",", 
             RowBox[{"ftest", "[", 
              RowBox[{"ex", ",", 
               RowBox[{"bb", "[", 
                RowBox[{
                 RowBox[{"Sequence", "@@", 
                  RowBox[{"(", 
                   RowBox[{"c", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ")"}]}], ",", "y", ",", 
                 "z"}], "]"}], ",", "a", ",", "b", ",", 
               RowBox[{"Drop", "[", 
                RowBox[{"c", ",", 
                 RowBox[{"{", "i", "}"}]}], "]"}]}], "]"}], ",", 
             RowBox[{"Nothing", "[", "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "@", "c"}]}], "}"}]}], "]"}], ",", 
         RowBox[{"(*", 
          RowBox[{"First", " ", "ab", " ", "with", " ", "first", " ", "bb"}], 
          "*)"}], 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"c", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "1"}], "]"}], "]"}], "===", "x"}], ",", 
             RowBox[{"ftest", "[", 
              RowBox[{
               RowBox[{"-", "ex"}], ",", 
               RowBox[{"bb", "[", 
                RowBox[{
                 RowBox[{"Sequence", "@@", 
                  RowBox[{"Reverse", "@", 
                   RowBox[{"(", 
                    RowBox[{"c", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ")"}]}]}], ",", "y", ",", 
                 "z"}], "]"}], ",", "a", ",", "b", ",", 
               RowBox[{"Drop", "[", 
                RowBox[{"c", ",", 
                 RowBox[{"{", "i", "}"}]}], "]"}]}], "]"}], ",", 
             RowBox[{"Nothing", "[", "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "@", "c"}]}], "}"}]}], "]"}]}], "]"}]}]}], ";",
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"Entry", " ", "in", " ", 
        RowBox[{"bb", ".", " ", "We"}], " ", "simply", " ", "plug", " ", "it",
         " ", "back", " ", "into", " ", "the", " ", "bb", " ", "list", " ", 
        "and", " ", "restart"}], ",", " ", 
       RowBox[{
       "so", " ", "we", " ", "recycle", " ", "definitions", " ", "of", " ", 
        "aa", " ", "and", " ", "ab", " ", "above"}]}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"wrapper", "[", 
       RowBox[{"ex_", ",", 
        RowBox[{"bb", "[", "x__", "]"}], ",", "a_", ",", "b_", ",", "c_"}], 
       "]"}], ":=", 
      RowBox[{"ftest", "[", 
       RowBox[{"ex", ",", "1", ",", "a", ",", "b", ",", 
        RowBox[{"Append", "[", 
         RowBox[{"c", ",", 
          RowBox[{"bb", "[", "x", "]"}]}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ftest", "=", "wrapper"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Finally", ",", " ", 
       RowBox[{
       "invwrapper", " ", "flattens", " ", "out", " ", "the", " ", "nested", 
        " ", "lists", " ", "and", " ", "returns", " ", "the", " ", "one", " ",
         "which", " ", "best", " ", "fits", " ", "the", " ", "selection", " ",
         "criterion"}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"invwrapper", "[", "x_List", "]"}], ":=", 
      RowBox[{"First", "@", 
       RowBox[{"Flatten", "[", "x", "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"local", "=", "local"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"Reconvert", " ", "the", " ", "aa"}], ",", "ab", ",", 
       RowBox[{"bb", " ", "to", " ", "the", " ", "spinor", " ", "objects"}]}],
       "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Clear", "[", 
      RowBox[{
      "SpinorAngleBracket", ",", "SpinorSquareBracket", ",", "Chain"}], "]"}],
      ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"aa", "[", "x__", "]"}], ":=", 
      RowBox[{"Chain", "[", 
       RowBox[{"$angle", ",", 
        RowBox[{"First", "@", 
         RowBox[{"{", "x", "}"}]}], ",", 
        RowBox[{"Most", "@", 
         RowBox[{"Rest", "@", 
          RowBox[{"{", "x", "}"}]}]}], ",", 
        RowBox[{"Last", "@", 
         RowBox[{"{", "x", "}"}]}], ",", "$angle"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"ab", "[", "x__", "]"}], ":=", 
      RowBox[{"Chain", "[", 
       RowBox[{"$angle", ",", 
        RowBox[{"First", "@", 
         RowBox[{"{", "x", "}"}]}], ",", 
        RowBox[{"Most", "@", 
         RowBox[{"Rest", "@", 
          RowBox[{"{", "x", "}"}]}]}], ",", 
        RowBox[{"Last", "@", 
         RowBox[{"{", "x", "}"}]}], ",", "$square"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"bb", "[", "x__", "]"}], ":=", 
      RowBox[{"Chain", "[", 
       RowBox[{"$square", ",", 
        RowBox[{"First", "@", 
         RowBox[{"{", "x", "}"}]}], ",", 
        RowBox[{"Most", "@", 
         RowBox[{"Rest", "@", 
          RowBox[{"{", "x", "}"}]}]}], ",", 
        RowBox[{"Last", "@", 
         RowBox[{"{", "x", "}"}]}], ",", "$square"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Chain", "[", 
       RowBox[{"$angle", ",", "x_", ",", 
        RowBox[{"{", "}"}], ",", "y_", ",", "$angle"}], "]"}], ":=", 
      RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{"x", ",", "y"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Chain", "[", 
       RowBox[{"$square", ",", "x_", ",", 
        RowBox[{"{", "}"}], ",", "y_", ",", "$square"}], "]"}], ":=", 
      RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{"x", ",", "y"}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Return", " ", "the", " ", "function"}], "*)"}], 
     "\[IndentingNewLine]", "local"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.8462456814201593`*^9, 3.846245825156507*^9}, {
   3.84624588041416*^9, 3.846246059525483*^9}, {3.846246159961267*^9, 
   3.846246506356346*^9}, {3.8462465588496513`*^9, 3.846246776938932*^9}, {
   3.8462468211574593`*^9, 3.846246821357975*^9}, {3.8462469009381323`*^9, 
   3.846247006582032*^9}, {3.846247070132245*^9, 3.846247149644244*^9}, {
   3.846247374359428*^9, 3.8462474663508*^9}, {3.8462475097111187`*^9, 
   3.846247529989496*^9}, 3.846247663407776*^9, {3.846247846840952*^9, 
   3.8462478514860983`*^9}, {3.846247998536194*^9, 3.8462482085672503`*^9}, {
   3.8462483680399227`*^9, 3.8462486484817333`*^9}, {3.8462487027049007`*^9, 
   3.846248724368257*^9}, {3.846248797143999*^9, 3.846248816218581*^9}, {
   3.8462488954114532`*^9, 3.846249049858389*^9}, {3.846249189482415*^9, 
   3.8462493254442596`*^9}, {3.846249385925198*^9, 3.846249487653274*^9}, {
   3.846249544221499*^9, 3.846249546222382*^9}, {3.846249589856963*^9, 
   3.84624967719884*^9}, {3.8462502101602983`*^9, 3.8462502823829317`*^9}, {
   3.8466736897255898`*^9, 3.8466737132423563`*^9}, {3.846673787513953*^9, 
   3.8466738715461493`*^9}, {3.846673957521954*^9, 3.846673984547014*^9}, {
   3.846674145495881*^9, 3.8466742128864717`*^9}, {3.846674595008449*^9, 
   3.846674630136456*^9}, {3.846674694990931*^9, 3.8466747000636473`*^9}, {
   3.8466747961635733`*^9, 3.846674953065852*^9}, {3.8466749914594097`*^9, 
   3.846675024454584*^9}, {3.846675202987584*^9, 3.846675218898118*^9}, {
   3.846675252620487*^9, 3.8466753463304377`*^9}, {3.846675554571374*^9, 
   3.846675660387985*^9}, {3.8466757145470448`*^9, 3.846675822132268*^9}, {
   3.846676264327422*^9, 3.846676282809916*^9}, {3.846676318013103*^9, 
   3.8466763538782*^9}, 3.8466764126300097`*^9, {3.846676467765717*^9, 
   3.846676558822207*^9}, {3.846676738181177*^9, 3.846676742607403*^9}, {
   3.846676775079438*^9, 3.84667680190305*^9}, {3.846676877605699*^9, 
   3.846677019256134*^9}, {3.846677833092266*^9, 3.846677955482648*^9}, {
   3.846678266914877*^9, 3.8466783138718147`*^9}, {3.846678423487372*^9, 
   3.8466785489015512`*^9}, {3.846678590086501*^9, 3.846678590240883*^9}, {
   3.846737994247161*^9, 3.846738004503858*^9}, {3.84673803926145*^9, 
   3.846738043581056*^9}, {3.846738075204897*^9, 3.8467380767987223`*^9}, {
   3.846738324485396*^9, 3.846738363902405*^9}, {3.846738549976481*^9, 
   3.8467386234799957`*^9}, {3.8467386620800943`*^9, 
   3.8467386667625303`*^9}, {3.846738707330525*^9, 3.846738709144993*^9}, {
   3.8467387719995604`*^9, 3.846738802416275*^9}, {3.846738865026211*^9, 
   3.8467388941297913`*^9}, {3.8467390345762873`*^9, 3.846739145036749*^9}, {
   3.846739185086565*^9, 3.8467393313401337`*^9}, {3.846739689354558*^9, 
   3.846739694756753*^9}, {3.8467400608109426`*^9, 3.846740223107369*^9}, {
   3.846740311305922*^9, 3.8467403137190647`*^9}, {3.84674042257513*^9, 
   3.8467404287644377`*^9}, {3.84674073988706*^9, 3.8467408609842367`*^9}, {
   3.846740898995308*^9, 3.846740902645625*^9}, {3.846741092330057*^9, 
   3.846741223363451*^9}, {3.846741273401784*^9, 3.8467413019477367`*^9}, {
   3.846741527121957*^9, 3.846741527308371*^9}, {3.8467415957943*^9, 
   3.846741645888163*^9}, {3.846741748890009*^9, 3.846741839195334*^9}, {
   3.846741884019949*^9, 3.846741998114798*^9}, {3.846742063810554*^9, 
   3.84674210675229*^9}, {3.846742137695187*^9, 3.846742187767593*^9}, {
   3.846742227202767*^9, 3.846742311862904*^9}, {3.846742434968604*^9, 
   3.8467426301567087`*^9}, {3.846742696026381*^9, 3.846742750778027*^9}, {
   3.846742802984507*^9, 3.8467428167728453`*^9}, {3.846742890066197*^9, 
   3.8467428911290913`*^9}, {3.846743039834488*^9, 3.846743042779208*^9}, {
   3.8467430826284523`*^9, 3.846743096066346*^9}, {3.846743232096546*^9, 
   3.846743308351609*^9}, {3.846743430005843*^9, 3.846743466618582*^9}, {
   3.846743674642068*^9, 3.8467439478485317`*^9}},
 CellLabel->
  "In[135]:=",ExpressionUUID->"d9c46fa1-22be-4264-9fda-3f0631cd3809"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"7", "*", "z", "*", 
   TemplateBox[{"1", "2"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], 
   TemplateBox[{"2", "3"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], 
   TemplateBox[{"3", "4"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], 
   TemplateBox[{"3", "5"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], 
   RowBox[{
    TemplateBox[{"5", "6"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "^", "2"}], 
   RowBox[{
    TemplateBox[{"7", 
      RowBox[{"{", "8", "}"}], "9"},
     "AngleSquareChain",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
     InterpretationFunction->(
      RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
        "$square", "]"}]& )], "/", 
    RowBox[{"(", 
     RowBox[{
      TemplateBox[{"p1", "p2"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], 
      RowBox[{
       TemplateBox[{"p2", "p3"},
        "SpinorSquareBracket",
        DisplayFunction->(RowBox[{"[", 
           RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
        InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
           RowBox[{#, ",", #2}], "]"}]& )], "^", "2"}]}], ")"}]}]}], "//", 
  "PreChain"}]], "Input",
 CellChangeTimes->{{3.846242173509924*^9, 3.846242231112877*^9}, {
  3.846246116586875*^9, 3.846246150278006*^9}, {3.8462461817347727`*^9, 
  3.846246182158164*^9}, {3.846246578013474*^9, 3.846246578378786*^9}, {
  3.846247680110651*^9, 3.846247683789065*^9}},
 CellLabel->
  "In[136]:=",ExpressionUUID->"c71c2964-1f0e-459b-a3d5-2ae4ac4902d4"],

Cell[BoxData[
 FractionBox[
  RowBox[{"7", " ", "z", " ", 
   TemplateBox[{"1", 
     RowBox[{"{", 
       RowBox[{"2", ",", "3"}], "}"}], "4"},
    "AngleAngleChain",
    DisplayFunction->(
     RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle", 
       "]"}]& )], " ", 
   TemplateBox[{"3", 
     RowBox[{"{", "5", "}"}], "6"},
    "AngleSquareChain",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square",
        "]"}]& )], " ", 
   TemplateBox[{"7", 
     RowBox[{"{", "8", "}"}], "9"},
    "AngleSquareChain",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square",
        "]"}]& )], " ", 
   TemplateBox[{"5", "6"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}], 
  RowBox[{
   TemplateBox[{"p1", 
     RowBox[{"{", "p2", "}"}], "p3"},
    "AngleSquareChain",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square",
        "]"}]& )], " ", 
   TemplateBox[{"p2", "p3"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}]]], "Output",
 CellChangeTimes->{
  3.84624611997372*^9, 3.846246151308091*^9, 3.846246183552204*^9, 
   3.846246235365589*^9, 3.846246376832349*^9, {3.846246424554968*^9, 
   3.846246439031102*^9}, 3.846246471934087*^9, 3.846246579394256*^9, 
   3.846246688354754*^9, 3.8462470081212587`*^9, {3.8462470922578087`*^9, 
   3.846247121462365*^9}, {3.846247445871354*^9, 3.846247467791078*^9}, {
   3.846247668496654*^9, 3.846247685000882*^9}, {3.846248016852743*^9, 
   3.846248049962275*^9}, 3.8462484455387506`*^9, {3.846248476005752*^9, 
   3.8462484847031097`*^9}, 3.846248535328216*^9, 3.846249757710393*^9, 
   3.846667513813611*^9, 3.846673693242999*^9, 3.846674204087784*^9, {
   3.846674935957589*^9, 3.846674954745063*^9}, 3.846675030390892*^9, 
   3.846675206681568*^9, {3.8466752434827557`*^9, 3.846675291700943*^9}, 
   3.846678483068389*^9, {3.846678522601722*^9, 3.846678550403185*^9}, 
   3.8467380114278393`*^9, 3.8467380456997623`*^9, 3.846738078710441*^9, 
   3.84673862739706*^9, 3.846738669944131*^9, 3.846738940403521*^9, 
   3.846739053551709*^9, 3.8467393053039494`*^9, 3.846739336531863*^9, 
   3.846739696777441*^9, 3.846740190453413*^9, 3.8467402249021387`*^9, 
   3.846740869774839*^9, 3.8467409039996853`*^9, 3.846741537562234*^9, {
   3.8467418142038727`*^9, 3.8467418410786247`*^9}, 3.846742010400065*^9, 
   3.846742202063075*^9, 3.846742487301585*^9, 3.846742636959553*^9, {
   3.846742698989911*^9, 3.846742753065506*^9}, 3.846742821663252*^9, 
   3.8467428935453978`*^9, 3.846743044954796*^9, 3.846743099163868*^9, 
   3.8467432608507338`*^9, {3.846743291150421*^9, 3.846743310303846*^9}, 
   3.846743696569893*^9, {3.846743916768108*^9, 3.8467439498985567`*^9}},
 CellLabel->
  "Out[136]=",ExpressionUUID->"eca2e6c6-ca74-4bb6-a078-203b3a2698bf"]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"test", "=", 
   RowBox[{"7", "*", "z", "*", 
    TemplateBox[{"1", "2"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], 
    TemplateBox[{"2", "3"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], 
    TemplateBox[{"3", "4"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], 
    TemplateBox[{"3", "5"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], 
    RowBox[{
     TemplateBox[{"5", "6"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], "^", "2"}], 
    RowBox[{
     TemplateBox[{"7", 
       RowBox[{"{", "8", "}"}], "9"},
      "AngleSquareChain",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], "/", 
     RowBox[{"(", 
      RowBox[{
       TemplateBox[{"p1", "p2"},
        "SpinorAngleBracket",
        DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
           RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
        InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
           RowBox[{#, ",", #2}], "]"}]& )], 
       RowBox[{
        TemplateBox[{"p2", "p3"},
         "SpinorSquareBracket",
         DisplayFunction->(RowBox[{"[", 
            RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
         InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
            RowBox[{#, ",", #2}], "]"}]& )], "^", "2"}]}], ")"}]}]}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.846743970308426*^9, 3.846743972693273*^9}},
 CellLabel->
  "In[137]:=",ExpressionUUID->"594a690f-3a09-4e5d-8e3f-6cb678b80b63"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"Do", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"test", "^", "3"}], "//", "ToChain"}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", "1000"}], "}"}]}], "]"}], "//", 
  "AbsoluteTiming"}]], "Input",
 CellChangeTimes->{{3.846743979401436*^9, 3.84674399624229*^9}, {
  3.8467440327908*^9, 3.8467440333816767`*^9}},
 CellLabel->
  "In[140]:=",ExpressionUUID->"757222ce-073f-4b86-8e34-60b0af19d556"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"1.243207`", ",", "Null"}], "}"}]], "Output",
 CellChangeTimes->{3.84674399739345*^9, 3.846744035412333*^9},
 CellLabel->
  "Out[140]=",ExpressionUUID->"7c5ba756-9c36-49da-937a-4f01786b113d"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"Do", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"test", "^", "2"}], "//", "PreChain"}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", "1000"}], "}"}]}], "]"}], "//", 
  "AbsoluteTiming"}]], "Input",
 CellChangeTimes->{{3.8467440064319487`*^9, 3.8467440081034946`*^9}, {
  3.846744039308696*^9, 3.846744040548047*^9}, {3.846744117268402*^9, 
  3.846744123980432*^9}},
 CellLabel->
  "In[143]:=",ExpressionUUID->"fdc01fda-42b3-4302-a3c2-fbe3b9063ba2"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"23.594525`", ",", "Null"}], "}"}]], "Output",
 CellChangeTimes->{
  3.846744009235771*^9, {3.846744114703321*^9, 3.8467441488409843`*^9}},
 CellLabel->
  "Out[143]=",ExpressionUUID->"b3b442fd-6d5c-4b28-bfc5-d9a386733d8e"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "Combinatorics", " ", "of", " ", "terms", " ", "explodes", " ", "with", " ",
    "the", " ", "number", " ", "of", " ", "powers", " ", "in", " ", "each", 
   " ", "bracket"}], "*)"}]], "Input",
 CellChangeTimes->{{3.846744140018464*^9, 
  3.8467441639582148`*^9}},ExpressionUUID->"fc6b4642-44e5-4721-99a5-\
aa7ffcccc7bb"]
}, Closed]],

Cell[CellGroupData[{

Cell["Recursing the previous test, taking care of combinatorics", "Subsection",
 CellChangeTimes->{{3.846245675277483*^9, 3.846245677621294*^9}, {
  3.846673722916071*^9, 3.846673724332143*^9}, {3.8467427791663427`*^9, 
  3.846742783985442*^9}, {3.846744431908648*^9, 
  3.846744456203334*^9}},ExpressionUUID->"00bcdd66-eed0-4157-bed7-\
04ef14501218"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Options", "[", "PreChain", "]"}], "=", 
  RowBox[{"{", 
   RowBox[{"ChainSelection", "->", "\"\<RandomChain\>\""}], "}"}]}]], "Input",\

 CellChangeTimes->{{3.846743508106366*^9, 3.846743528518509*^9}, {
  3.846743605388595*^9, 3.846743661255863*^9}, {3.846762618647623*^9, 
  3.846762626770125*^9}},ExpressionUUID->"84959906-c38f-4b6e-a23c-\
1015a0668f45"],

Cell[BoxData[
 RowBox[{
  RowBox[{"PreChain", "[", "exp_", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "aa", ",", "bb", ",", "ab", ",", "wrapper", ",", "invwrapper", ",", 
      "local", ",", "SpinorAngleBracket", ",", "SpinorSquareBracket", ",", 
      "Chain", ",", "mult", ",", "tmp"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"local", "=", "exp"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Convert", " ", "all", " ", "the", " ", "chains", " ", "and", " ", 
       "spinor", " ", "brackets", " ", "into", " ", "simpler", " ", "objects",
        " ", "and", " ", "wrap", " ", "them", " ", "into", " ", "a", " ", 
       "function", " ", "which", " ", "will", " ", "chain", " ", "them"}], 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"SpinorAngleBracket", "[", "x__", "]"}], ":=", 
      RowBox[{"wrapper", "[", 
       RowBox[{"aa", "[", "x", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"SpinorSquareBracket", "[", "x__", "]"}], ":=", 
      RowBox[{"wrapper", "[", 
       RowBox[{"bb", "[", "x", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Chain", "[", 
       RowBox[{"$angle", ",", "x__", ",", "$angle"}], "]"}], ":=", 
      RowBox[{"wrapper", "[", 
       RowBox[{"aa", "[", 
        RowBox[{"Sequence", "@@", 
         RowBox[{"Flatten", "@", 
          RowBox[{"{", "x", "}"}]}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Chain", "[", 
       RowBox[{"$angle", ",", "x__", ",", "$square"}], "]"}], ":=", 
      RowBox[{"wrapper", "[", 
       RowBox[{"ab", "[", 
        RowBox[{"Sequence", "@@", 
         RowBox[{"Flatten", "@", 
          RowBox[{"{", "x", "}"}]}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Chain", "[", 
       RowBox[{"$square", ",", "x__", ",", "$angle"}], "]"}], ":=", 
      RowBox[{"wrapper", "[", 
       RowBox[{"ab", "[", 
        RowBox[{"Sequence", "@@", 
         RowBox[{"Reverse", "@", 
          RowBox[{"Flatten", "@", 
           RowBox[{"{", "x", "}"}]}]}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Chain", "[", 
       RowBox[{"$square", ",", "x__", ",", "$square"}], "]"}], ":=", 
      RowBox[{"wrapper", "[", 
       RowBox[{"bb", "[", 
        RowBox[{"Sequence", "@@", 
         RowBox[{"Flatten", "@", 
          RowBox[{"{", "x", "}"}]}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
       "Define", " ", "properties", " ", "of", " ", "the", " ", "wrapper", 
        " ", "so", " ", "that", " ", "it", " ", "wraps", " ", "everything", 
        " ", "together"}], ",", " ", 
       RowBox[{"taking", " ", "care", " ", "of", " ", "the", " ", 
        RowBox[{"powers", ".", " ", "Inverse"}], " ", "powers", " ", "are", 
        " ", "the", " ", "reason", " ", "we", " ", "need", " ", "the", " ", 
        "auxiliary", " ", "invwrapper"}], ",", " ", 
       RowBox[{
        RowBox[{
        "this", " ", "would", " ", "be", " ", "needed", " ", "if", " ", "we", 
         " ", "could", " ", "go", " ", "deeper", " ", "with", " ", "the", " ",
          "upvalues", " ", "of", " ", "wrapper"}], "..."}]}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"wrapper", " ", "/:", " ", 
      RowBox[{
       RowBox[{"wrapper", "[", "x_", "]"}], "*", 
       RowBox[{"wrapper", "[", "y_", "]"}]}], ":=", 
      RowBox[{"wrapper", "[", 
       RowBox[{"x", "*", "y"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"wrapper", " ", "/:", " ", 
      RowBox[{"Power", "[", 
       RowBox[{
        RowBox[{"wrapper", "[", "x_", "]"}], ",", 
        RowBox[{"n_", "?", "Positive"}]}], "]"}], ":=", 
      RowBox[{"wrapper", "[", 
       RowBox[{"Power", "[", 
        RowBox[{"x", ",", "n"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"wrapper", " ", "/:", " ", 
      RowBox[{"Power", "[", 
       RowBox[{
        RowBox[{"wrapper", "[", "x_", "]"}], ",", 
        RowBox[{"n_", "?", "Negative"}]}], "]"}], ":=", 
      RowBox[{"invwrapper", "[", 
       RowBox[{"Power", "[", 
        RowBox[{"x", ",", 
         RowBox[{"-", "n"}]}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"invwrapper", " ", "/:", " ", 
      RowBox[{
       RowBox[{"invwrapper", "[", "x_", "]"}], "*", 
       RowBox[{"invwrapper", "[", "y_", "]"}]}], ":=", 
      RowBox[{"invwrapper", "[", 
       RowBox[{"x", "*", "y"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"local", "=", "local"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Reconvert", " ", "the", " ", "inwrapper", " ", "to", " ", "the", " ", 
       "inverse", " ", "power", " ", "of", " ", "a", " ", "wrapper"}], "*)"}],
      "\[IndentingNewLine]", 
     RowBox[{"Clear", "[", "wrapper", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"invwrapper", "[", "x_", "]"}], ":=", 
      RowBox[{"Power", "[", 
       RowBox[{
        RowBox[{"wrapper", "[", "x", "]"}], ",", 
        RowBox[{"-", "1"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"local", "=", "local"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
       "Next", " ", "we", " ", "want", " ", "the", " ", "wrapper", " ", "to", 
        " ", "be", " ", "ready", " ", "to", " ", "actually", " ", "do", " ", 
        "stuff"}], ",", " ", 
       RowBox[{
       "so", " ", "we", " ", "group", " ", "things", " ", "together", " ", 
        "in", " ", 
        RowBox[{"lists", ":", " ", "aa"}]}], ",", "bb", ",", 
       RowBox[{"ab", " ", "and", " ", "ba", " ", "separate"}], ",", " ", 
       RowBox[{
       "along", " ", "with", " ", "the", " ", "product", " ", "of", " ", 
        "already", " ", "used", " ", 
        RowBox[{"stuff", ".", " ", "First"}], " ", "convert", " ", 
        "arguments", " ", "of", " ", "wrapper", " ", "to", " ", "a", " ", 
        "list"}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Clear", "[", "invwrapper", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"wrapper", "[", 
       RowBox[{"f_", "[", "x__", "]"}], "]"}], ":=", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"f", "===", "Times"}], ",", 
        RowBox[{"invwrapper", "[", 
         RowBox[{"List", "[", "x", "]"}], "]"}], ",", 
        RowBox[{"invwrapper", "[", 
         RowBox[{"{", "x", "}"}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
       "Here", " ", "we", " ", "gather", " ", "the", " ", "objects", " ", 
        "by", " ", "head"}], ",", " ", 
       RowBox[{
       "then", " ", "replace", " ", "powers", " ", "by", " ", "arrays", " ", 
        "with", " ", "correct", " ", "multiplicity"}], ",", " ", 
       RowBox[{
       "and", " ", "finally", " ", "make", "  ", "atable", " ", "with", " ", 
        "the", " ", "elements", " ", "of", " ", "each", " ", "type", " ", 
        "putting", " ", "an", " ", "empty", " ", "list", " ", "for", " ", 
        "the", " ", "missing", " ", 
        RowBox[{"ones", ".", " ", "We"}], " ", "keep", " ", "the", " ", 
        "invwrapper", " ", "as", " ", "an", " ", "external", " ", 
        "container"}], ",", " ", 
       RowBox[{
       "so", " ", "that", " ", "once", " ", "wrapper", " ", "has", " ", 
        "done", " ", 
        RowBox[{"it", "'"}], "s", " ", "job"}], ",", " ", 
       RowBox[{
       "invwrapper", " ", "can", " ", "select", " ", "the", " ", "chain", " ",
         "we", " ", "want"}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"local", "=", "local"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Clear", "[", "wrapper", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"invwrapper", "[", "x_List", "]"}], ":=", 
      RowBox[{"invwrapper", "[", 
       RowBox[{"wrapper", "[", 
        RowBox[{"1", ",", "1", ",", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"SelectFirst", "[", 
            RowBox[{
             RowBox[{"GatherBy", "[", 
              RowBox[{
               RowBox[{"Flatten", "[", 
                RowBox[{"x", "/.", 
                 RowBox[{"Power", "->", "ConstantArray"}]}], "]"}], ",", 
               "Head"}], "]"}], ",", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", 
                  RowBox[{"1", ",", "0"}], "]"}], "]"}], "===", "i"}], "&"}], 
              ")"}], ",", 
             RowBox[{"{", "}"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"{", 
              RowBox[{"aa", ",", "ab", ",", "bb"}], "}"}]}], "}"}]}], "]"}]}],
         "]"}], "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
       "In", " ", "order", " ", "to", " ", "get", " ", "blown", " ", "out", 
        " ", "of", " ", "the", " ", "water", " ", "by", " ", "combinatorics", 
        " ", "we", " ", "need", " ", "to", " ", "take", " ", "into", " ", 
        "account", " ", "the", " ", "multiplicity", " ", "with", " ", "which",
         " ", "each", " ", "bracket", " ", "appears"}], ",", " ", 
       RowBox[{
        RowBox[{"i", ".", "e", ".", " ", "its"}], " ", 
        RowBox[{"power", ".", " ", "To"}], " ", "do", " ", "so", " ", 
        "\"\<efficiently\>\"", " ", "we", " ", "introduce", " ", "another", 
        " ", "auxiliary", " ", "function"}]}], "*)"}], "\[IndentingNewLine]", 
     
     RowBox[{
      RowBox[{"wrapper", "[", 
       RowBox[{"1", ",", "1", ",", 
        RowBox[{"{", 
         RowBox[{"a_", ",", "b_", ",", "c_"}], "}"}]}], "]"}], ":=", 
      RowBox[{"wrapper", "[", 
       RowBox[{"1", ",", "1", ",", 
        RowBox[{"mult", "@@@", 
         RowBox[{"Tally", "@", "a"}]}], ",", 
        RowBox[{"mult", "@@@", 
         RowBox[{"Tally", "@", "b"}]}], ",", 
        RowBox[{"mult", "@@@", 
         RowBox[{"Tally", "@", "c"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"local", "=", "local"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "When", " ", "multiplicity", " ", "reaches", " ", "zero", " ", "mult", 
       " ", "simply", " ", "drops", " ", "out", " ", "of", " ", "the", " ", 
       "game"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"mult", "[", 
       RowBox[{"x_", ",", "0"}], "]"}], ":=", 
      RowBox[{"Nothing", "[", "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
       "Now", " ", "we", " ", "clear", " ", "the", " ", "invwrapper", " ", 
        "and", " ", "make", " ", "the", " ", "wrapper", " ", "do", " ", "the",
         " ", "magic", " ", "of", " ", 
        RowBox[{"combinatorics", ".", " ", "The"}], " ", "aa"}], ",", "bb", 
       ",", "ba", ",", 
       RowBox[{
       "ab", " ", "objects", " ", "get", " ", "some", " ", "specific", " ", 
        "properties", " ", "which", " ", "is", " ", "what", " ", "will", " ", 
        "build", " ", "the", " ", "chains"}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Clear", "[", 
      RowBox[{"invwrapper", ",", "wrapper"}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"The", " ", "wrapper", " ", "acts", " ", "recursively"}], ",", 
       " ", 
       RowBox[{"testing", " ", "its", " ", "second", " ", 
        RowBox[{"argument", "'"}], "s", " ", "head", " ", "and", " ", 
        "accordingly", " ", "combining", " ", "it", " ", "with", " ", "one", 
        " ", "of", " ", "the", " ", "elements", " ", "in", " ", "the", " ", 
        "lists", " ", "of", " ", 
        RowBox[{"brackets", ".", " ", "If"}], " ", "no", " ", "combination", 
        " ", "is", " ", "possible", " ", "the", " ", "second", " ", 
        "argument", " ", "is", " ", "merged", " ", "with", " ", "the", " ", 
        "first", " ", "one", " ", "and", " ", "a", " ", "new", " ", "cycle", 
        " ", 
        RowBox[{"begins", ".", " ", "Termination"}], " ", "condition", " ", 
        "is", " ", "that", " ", "all", " ", "lists", " ", "are", " ", 
        "empty"}]}], "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Termination", " ", "condition"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"wrapper", "[", 
       RowBox[{"x_", ",", "y_", ",", 
        RowBox[{"{", "}"}], ",", 
        RowBox[{"{", "}"}], ",", 
        RowBox[{"{", "}"}]}], "]"}], ":=", 
      RowBox[{"x", "*", "y"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"The", " ", "starting", " ", "point"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"wrapper", "[", 
       RowBox[{"x_", ",", "1", ",", "a_", ",", "b_", ",", "c_"}], "]"}], ":=", 
      RowBox[{"Which", "[", 
       RowBox[{
        RowBox[{"a", "=!=", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{"wrapper", "[", 
         RowBox[{"x", ",", 
          RowBox[{"a", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
          RowBox[{"ReplacePart", "[", 
           RowBox[{"a", ",", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"1", ",", "2"}], "}"}], "->", 
             RowBox[{
              RowBox[{"a", "[", 
               RowBox[{"[", 
                RowBox[{"1", ",", "2"}], "]"}], "]"}], "-", "1"}]}]}], "]"}], 
          ",", "b", ",", "c"}], "]"}], ",", 
        RowBox[{"b", "=!=", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{"wrapper", "[", 
         RowBox[{"x", ",", 
          RowBox[{"b", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", "a", ",", 
          RowBox[{"ReplacePart", "[", 
           RowBox[{"b", ",", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"1", ",", "2"}], "}"}], "->", 
             RowBox[{
              RowBox[{"b", "[", 
               RowBox[{"[", 
                RowBox[{"1", ",", "2"}], "]"}], "]"}], "-", "1"}]}]}], "]"}], 
          ",", "c"}], "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "If", " ", "any", " ", "two", " ", "of", " ", "the", " ", "lists", " ", 
       "are", " ", "empty", " ", "and", " ", "there", " ", "are", " ", "no", 
       " ", "brackets", " ", "in", " ", "the", " ", "second", " ", "slot", 
       " ", "of", " ", "wrapper", " ", "there", " ", "is", " ", "nothing", 
       " ", "to", " ", "be", " ", 
       RowBox[{"done", "."}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"wrapper", "[", 
       RowBox[{"x_", ",", "1", ",", 
        RowBox[{"{", "}"}], ",", 
        RowBox[{"{", "}"}], ",", "a_"}], "]"}], ":=", 
      RowBox[{"x", "*", 
       RowBox[{"Times", "@@", 
        RowBox[{"Power", "@@@", "a"}]}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"wrapper", "[", 
       RowBox[{"x_", ",", "1", ",", 
        RowBox[{"{", "}"}], ",", "a_", ",", 
        RowBox[{"{", "}"}]}], "]"}], ":=", 
      RowBox[{"x", "*", 
       RowBox[{"Times", "@@", 
        RowBox[{"Power", "@@@", "a"}]}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"wrapper", "[", 
       RowBox[{"x_", ",", "1", ",", "a_", ",", 
        RowBox[{"{", "}"}], ",", 
        RowBox[{"{", "}"}]}], "]"}], ":=", 
      RowBox[{"x", "*", 
       RowBox[{"Times", "@@", 
        RowBox[{"Power", "@@@", "a"}]}]}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"GENERAL", " ", 
       RowBox[{"QUESTION", ":", " ", 
        RowBox[{"is", " ", "this", " ", "pattern", " ", "matching", " ", 
         RowBox[{"aa", "[", 
          RowBox[{"x_", ",", "y___", ",", "z_"}], "]"}], " ", "faster", " ", 
         "or", " ", "is", " ", 
         RowBox[{"aa", "[", "x__", "]"}], " ", "with", " ", "calling", " ", 
         RowBox[{"First", "@", "x"}], " ", "every", " ", "time", " ", 
         RowBox[{"faster", "?"}]}]}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Entry", " ", "is", " ", "aa"}], "*)"}], "\[IndentingNewLine]", 
     
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
       "If", " ", "upon", " ", "parsing", " ", "the", " ", "lists", " ", "of",
         " ", "objects", " ", "and", " ", "making", " ", "all", " ", "the", 
        " ", "possible", " ", "contractions", " ", "an", " ", "empty", " ", 
        "list", " ", "is", " ", "returned"}], ",", " ", 
       RowBox[{
       "we", " ", "need", " ", "to", " ", "move", " ", "the", " ", "input", 
        " ", "entry", " ", "to", " ", "the", " ", "overall", " ", "product", 
        " ", "but", " ", "and", " ", "start", " ", "a", " ", "new", " ", 
        "iteration"}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"wrapper", "[", 
       RowBox[{"ex_", ",", 
        RowBox[{"aa", "[", 
         RowBox[{"x_", ",", "y___", ",", "z_"}], "]"}], ",", "a_", ",", "b_", 
        ",", "c_"}], "]"}], ":=", 
      RowBox[{
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"#", "===", 
           RowBox[{"{", "}"}]}], ",", 
          RowBox[{"wrapper", "[", 
           RowBox[{
            RowBox[{"ex", "*", 
             RowBox[{"aa", "[", 
              RowBox[{"x", ",", "y", ",", "z"}], "]"}]}], ",", "1", ",", "a", 
            ",", "b", ",", "c"}], "]"}], ",", "#"}], "]"}], "&"}], "@", 
       "\[IndentingNewLine]", 
       RowBox[{"Join", "[", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Combining", " ", "the", " ", "last", " ", "entry", " ", "of", " ", 
          "the", " ", "aa", " ", "with", " ", "all", " ", "the", " ", "first",
           " ", "entries", " ", "of", " ", "the", " ", "bb"}], "*)"}], 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"c", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "1", ",", "1"}], "]"}], "]"}], "===", "z"}],
              ",", 
             RowBox[{"wrapper", "[", 
              RowBox[{"ex", ",", 
               RowBox[{"ab", "[", 
                RowBox[{"x", ",", "y", ",", 
                 RowBox[{"Sequence", "@@", 
                  RowBox[{"(", 
                   RowBox[{"List", "@@", 
                    RowBox[{"c", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "1"}], "]"}], "]"}]}], ")"}]}]}], "]"}],
                ",", "a", ",", "b", ",", 
               RowBox[{"ReplacePart", "[", 
                RowBox[{"c", ",", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"i", ",", "2"}], "}"}], "->", 
                  RowBox[{
                   RowBox[{"c", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "2"}], "]"}], "]"}], "-", "1"}]}]}], 
                "]"}]}], "]"}], ",", 
             RowBox[{"Nothing", "[", "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "@", "c"}]}], "}"}]}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
          "Combining", " ", "the", " ", "last", " ", "entry", " ", "of", " ", 
           "aa", " ", "with", " ", "the", " ", "last", " ", "of", " ", "ab", 
           " ", "and", " ", "bb"}], "*)"}], 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"b", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "1", ",", 
                 RowBox[{"-", "1"}]}], "]"}], "]"}], "===", "z"}], ",", 
             RowBox[{"wrapper", "[", 
              RowBox[{"ex", ",", 
               RowBox[{"aa", "[", 
                RowBox[{"x", ",", "y", ",", 
                 RowBox[{"Sequence", "@@", 
                  RowBox[{"Reverse", "@", 
                   RowBox[{"(", 
                    RowBox[{"b", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "1"}], "]"}], "]"}], ")"}]}]}]}], "]"}],
                ",", "a", ",", 
               RowBox[{"ReplacePart", "[", 
                RowBox[{"b", ",", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"i", ",", "2"}], "}"}], "->", 
                  RowBox[{
                   RowBox[{"b", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "2"}], "]"}], "]"}], "-", "1"}]}]}], 
                "]"}], ",", "c"}], "]"}], ",", 
             RowBox[{"Nothing", "[", "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "@", "b"}]}], "}"}]}], "]"}], ",", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"c", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "1", ",", 
                 RowBox[{"-", "1"}]}], "]"}], "]"}], "===", "z"}], ",", 
             RowBox[{"wrapper", "[", 
              RowBox[{
               RowBox[{"-", "ex"}], ",", 
               RowBox[{"ab", "[", 
                RowBox[{"x", ",", "y", ",", 
                 RowBox[{"Sequence", "@@", 
                  RowBox[{"Reverse", "@", 
                   RowBox[{"(", 
                    RowBox[{"c", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "1"}], "]"}], "]"}], ")"}]}]}]}], "]"}],
                ",", "a", ",", "b", ",", 
               RowBox[{"ReplacePart", "[", 
                RowBox[{"c", ",", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"i", ",", "2"}], "}"}], "->", 
                  RowBox[{
                   RowBox[{"c", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "2"}], "]"}], "]"}], "-", "1"}]}]}], 
                "]"}]}], "]"}], ",", 
             RowBox[{"Nothing", "[", "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "@", "c"}]}], "}"}]}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
          "First", " ", "entry", " ", "of", " ", "aa", " ", "with", " ", 
           "first", " ", "of", " ", "bb"}], "*)"}], 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"c", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "1", ",", "1"}], "]"}], "]"}], "===", "x"}],
              ",", 
             RowBox[{"wrapper", "[", 
              RowBox[{
               RowBox[{"-", "ex"}], ",", 
               RowBox[{"ab", "[", 
                RowBox[{
                 RowBox[{"Sequence", "@@", 
                  RowBox[{"Reverse", "@", 
                   RowBox[{"{", 
                    RowBox[{"y", ",", "z"}], "}"}]}]}], ",", 
                 RowBox[{"Sequence", "@@", 
                  RowBox[{"(", 
                   RowBox[{"c", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "1"}], "]"}], "]"}], ")"}]}]}], "]"}], 
               ",", "a", ",", "b", ",", 
               RowBox[{"ReplacePart", "[", 
                RowBox[{"c", ",", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"i", ",", "2"}], "}"}], "->", 
                  RowBox[{
                   RowBox[{"c", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "2"}], "]"}], "]"}], "-", "1"}]}]}], 
                "]"}]}], "]"}], ",", 
             RowBox[{"Nothing", "[", "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "@", "c"}]}], "}"}]}], "]"}], ",", 
         RowBox[{"(*", 
          RowBox[{
          "First", " ", "of", " ", "aa", " ", "with", " ", "last", " ", "of", 
           " ", "ab"}], "*)"}], 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"b", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "1", ",", 
                 RowBox[{"-", "1"}]}], "]"}], "]"}], "===", "x"}], ",", 
             RowBox[{"wrapper", "[", 
              RowBox[{"ex", ",", 
               RowBox[{"aa", "[", 
                RowBox[{
                 RowBox[{"Sequence", "@@", 
                  RowBox[{"(", 
                   RowBox[{"b", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "1"}], "]"}], "]"}], ")"}]}], ",", "y", 
                 ",", "z"}], "]"}], ",", "a", ",", 
               RowBox[{"ReplacePart", "[", 
                RowBox[{"b", ",", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"i", ",", "2"}], "}"}], "->", 
                  RowBox[{
                   RowBox[{"b", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "2"}], "]"}], "]"}], "-", "1"}]}]}], 
                "]"}], ",", "c"}], "]"}], ",", 
             RowBox[{"Nothing", "[", "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "@", "b"}]}], "}"}]}], "]"}], ",", 
         RowBox[{"(*", 
          RowBox[{"First", " ", "aa", " ", "with", " ", "last", " ", "bb"}], 
          "*)"}], 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"c", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "1", ",", 
                 RowBox[{"-", "1"}]}], "]"}], "]"}], "===", "x"}], ",", 
             RowBox[{"wrapper", "[", 
              RowBox[{"ex", ",", 
               RowBox[{"ab", "[", 
                RowBox[{"Sequence", "@@", 
                 RowBox[{"Reverse", "@", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"Sequence", "@@", 
                    RowBox[{"(", 
                    RowBox[{"c", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "1"}], "]"}], "]"}], ")"}]}], ",", "y", 
                    ",", "z"}], "}"}]}]}], "]"}], ",", "a", ",", "b", ",", 
               RowBox[{"ReplacePart", "[", 
                RowBox[{"c", ",", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"i", ",", "2"}], "}"}], "->", 
                  RowBox[{
                   RowBox[{"c", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "2"}], "]"}], "]"}], "-", "1"}]}]}], 
                "]"}]}], "]"}], ",", 
             RowBox[{"Nothing", "[", "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "@", "c"}]}], "}"}]}], "]"}]}], "]"}]}]}], ";",
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Entry", " ", "in", " ", "ab"}], "*)"}], "\[IndentingNewLine]", 
     
     RowBox[{
      RowBox[{"wrapper", "[", 
       RowBox[{"ex_", ",", 
        RowBox[{"ab", "[", 
         RowBox[{"x_", ",", "y___", ",", "z_"}], "]"}], ",", "a_", ",", "b_", 
        ",", "c_"}], "]"}], ":=", 
      RowBox[{
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"#", "===", 
           RowBox[{"{", "}"}]}], ",", 
          RowBox[{"wrapper", "[", 
           RowBox[{
            RowBox[{"ex", "*", 
             RowBox[{"ab", "[", 
              RowBox[{"x", ",", "y", ",", "z"}], "]"}]}], ",", "1", ",", "a", 
            ",", "b", ",", "c"}], "]"}], ",", "#"}], "]"}], "&"}], "@", 
       RowBox[{"Join", "[", 
        RowBox[{"(*", 
         RowBox[{"Last", " ", "ab", " ", "with", " ", "first", " ", "aa"}], 
         "*)"}], 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"a", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "1", ",", "1"}], "]"}], "]"}], "===", "z"}],
              ",", 
             RowBox[{"wrapper", "[", 
              RowBox[{"ex", ",", 
               RowBox[{"aa", "[", 
                RowBox[{"x", ",", "y", ",", 
                 RowBox[{"Sequence", "@@", 
                  RowBox[{"(", 
                   RowBox[{"a", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "1"}], "]"}], "]"}], ")"}]}]}], "]"}], 
               ",", 
               RowBox[{"ReplacePart", "[", 
                RowBox[{"a", ",", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"i", ",", "2"}], "}"}], "->", 
                  RowBox[{
                   RowBox[{"a", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "2"}], "]"}], "]"}], "-", "1"}]}]}], 
                "]"}], ",", "b", ",", "c"}], "]"}], ",", 
             RowBox[{"Nothing", "[", "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "@", "a"}]}], "}"}]}], "]"}], ",", 
         RowBox[{"(*", 
          RowBox[{"Last", " ", "ab", " ", "with", " ", "last", " ", "aa"}], 
          "*)"}], 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"a", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "1", ",", 
                 RowBox[{"-", "1"}]}], "]"}], "]"}], "===", "z"}], ",", 
             RowBox[{"wrapper", "[", 
              RowBox[{
               RowBox[{"-", "ex"}], ",", 
               RowBox[{"aa", "[", 
                RowBox[{"x", ",", "y", ",", 
                 RowBox[{"Sequence", "@@", 
                  RowBox[{"Reverse", "@", 
                   RowBox[{"(", 
                    RowBox[{"a", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "1"}], "]"}], "]"}], ")"}]}]}]}], "]"}],
                ",", 
               RowBox[{"ReplacePart", "[", 
                RowBox[{"a", ",", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"i", ",", "2"}], "}"}], "->", 
                  RowBox[{
                   RowBox[{"a", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "2"}], "]"}], "]"}], "-", "1"}]}]}], 
                "]"}], ",", "b", ",", "c"}], "]"}], ",", 
             RowBox[{"Nothing", "[", "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "@", "a"}]}], "}"}]}], "]"}], ",", 
         RowBox[{"(*", 
          RowBox[{"First", " ", "ab", " ", "with", " ", "last", " ", "bb"}], 
          "*)"}], 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"c", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "1", ",", 
                 RowBox[{"-", "1"}]}], "]"}], "]"}], "===", "x"}], ",", 
             RowBox[{"wrapper", "[", 
              RowBox[{"ex", ",", 
               RowBox[{"bb", "[", 
                RowBox[{
                 RowBox[{"Sequence", "@@", 
                  RowBox[{"(", 
                   RowBox[{"c", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "1"}], "]"}], "]"}], ")"}]}], ",", "y", 
                 ",", "z"}], "]"}], ",", "a", ",", "b", ",", 
               RowBox[{"ReplacePart", "[", 
                RowBox[{"c", ",", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"i", ",", "2"}], "}"}], "->", 
                  RowBox[{
                   RowBox[{"c", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "2"}], "]"}], "]"}], "-", "1"}]}]}], 
                "]"}]}], "]"}], ",", 
             RowBox[{"Nothing", "[", "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "@", "c"}]}], "}"}]}], "]"}], ",", 
         RowBox[{"(*", 
          RowBox[{"First", " ", "ab", " ", "with", " ", "first", " ", "bb"}], 
          "*)"}], 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"c", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "1", ",", "1"}], "]"}], "]"}], "===", "x"}],
              ",", 
             RowBox[{"wrapper", "[", 
              RowBox[{
               RowBox[{"-", "ex"}], ",", 
               RowBox[{"bb", "[", 
                RowBox[{
                 RowBox[{"Sequence", "@@", 
                  RowBox[{"Reverse", "@", 
                   RowBox[{"(", 
                    RowBox[{"c", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "1"}], "]"}], "]"}], ")"}]}]}], ",", 
                 "y", ",", "z"}], "]"}], ",", "a", ",", "b", ",", 
               RowBox[{"ReplacePart", "[", 
                RowBox[{"c", ",", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"i", ",", "2"}], "}"}], "->", 
                  RowBox[{
                   RowBox[{"c", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "2"}], "]"}], "]"}], "-", "1"}]}]}], 
                "]"}]}], "]"}], ",", 
             RowBox[{"Nothing", "[", "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "@", "c"}]}], "}"}]}], "]"}]}], "]"}]}]}], ";",
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"Entry", " ", "in", " ", 
        RowBox[{"bb", ".", " ", "We"}], " ", "simply", " ", "plug", " ", "it",
         " ", "back", " ", "into", " ", "the", " ", "bb", " ", "list", " ", 
        "and", " ", "restart"}], ",", " ", 
       RowBox[{
       "so", " ", "we", " ", "recycle", " ", "definitions", " ", "of", " ", 
        "aa", " ", "and", " ", "ab", " ", "above"}]}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"wrapper", "[", 
       RowBox[{"ex_", ",", 
        RowBox[{"bb", "[", "x__", "]"}], ",", "a_", ",", "b_", ",", "c_"}], 
       "]"}], ":=", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"tmp", "=", 
           RowBox[{"Flatten", "[", 
            RowBox[{"Position", "[", 
             RowBox[{"c", ",", 
              RowBox[{"bb", "[", "x", "]"}]}], "]"}], "]"}]}], ")"}], "===", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{"wrapper", "[", 
         RowBox[{"ex", ",", "1", ",", "a", ",", "b", ",", 
          RowBox[{"Append", "[", 
           RowBox[{"c", ",", 
            RowBox[{"mult", "[", 
             RowBox[{
              RowBox[{"bb", "[", "x", "]"}], ",", "1"}], "]"}]}], "]"}]}], 
         "]"}], ",", 
        RowBox[{"wrapper", "[", 
         RowBox[{"ex", ",", "1", ",", "a", ",", "b", ",", 
          RowBox[{"ReplacePart", "[", 
           RowBox[{"c", ",", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"First", "@", "tmp"}], ",", "2"}], "}"}], "->", 
             RowBox[{
              RowBox[{"c", "[", 
               RowBox[{"[", 
                RowBox[{
                 RowBox[{"First", "@", "tmp"}], ",", "2"}], "]"}], "]"}], "+",
               "1"}]}]}], "]"}]}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Finally", ",", " ", 
       RowBox[{
       "invwrapper", " ", "flattens", " ", "out", " ", "the", " ", "nested", 
        " ", "lists", " ", "and", " ", "returns", " ", "the", " ", "one", " ",
         "which", " ", "best", " ", "fits", " ", "the", " ", "selection", " ",
         "criterion"}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"invwrapper", "[", "x_List", "]"}], ":=", 
      RowBox[{"First", "@", 
       RowBox[{"Flatten", "[", "x", "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"local", "=", "local"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"Reconvert", " ", "the", " ", "aa"}], ",", "ab", ",", 
       RowBox[{"bb", " ", "to", " ", "the", " ", "spinor", " ", "objects"}]}],
       "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Clear", "[", 
      RowBox[{
      "SpinorAngleBracket", ",", "SpinorSquareBracket", ",", "Chain"}], "]"}],
      ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"aa", "[", "x__", "]"}], ":=", 
      RowBox[{"Chain", "[", 
       RowBox[{"$angle", ",", 
        RowBox[{"First", "@", 
         RowBox[{"{", "x", "}"}]}], ",", 
        RowBox[{"Most", "@", 
         RowBox[{"Rest", "@", 
          RowBox[{"{", "x", "}"}]}]}], ",", 
        RowBox[{"Last", "@", 
         RowBox[{"{", "x", "}"}]}], ",", "$angle"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"ab", "[", "x__", "]"}], ":=", 
      RowBox[{"Chain", "[", 
       RowBox[{"$angle", ",", 
        RowBox[{"First", "@", 
         RowBox[{"{", "x", "}"}]}], ",", 
        RowBox[{"Most", "@", 
         RowBox[{"Rest", "@", 
          RowBox[{"{", "x", "}"}]}]}], ",", 
        RowBox[{"Last", "@", 
         RowBox[{"{", "x", "}"}]}], ",", "$square"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"bb", "[", "x__", "]"}], ":=", 
      RowBox[{"Chain", "[", 
       RowBox[{"$square", ",", 
        RowBox[{"First", "@", 
         RowBox[{"{", "x", "}"}]}], ",", 
        RowBox[{"Most", "@", 
         RowBox[{"Rest", "@", 
          RowBox[{"{", "x", "}"}]}]}], ",", 
        RowBox[{"Last", "@", 
         RowBox[{"{", "x", "}"}]}], ",", "$square"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Chain", "[", 
       RowBox[{"$angle", ",", "x_", ",", 
        RowBox[{"{", "}"}], ",", "y_", ",", "$angle"}], "]"}], ":=", 
      RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{"x", ",", "y"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Chain", "[", 
       RowBox[{"$square", ",", "x_", ",", 
        RowBox[{"{", "}"}], ",", "y_", ",", "$square"}], "]"}], ":=", 
      RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{"x", ",", "y"}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Return", " ", "the", " ", "function"}], "*)"}], 
     "\[IndentingNewLine]", "local"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.8462456814201593`*^9, 3.846245825156507*^9}, {
   3.84624588041416*^9, 3.846246059525483*^9}, {3.846246159961267*^9, 
   3.846246506356346*^9}, {3.8462465588496513`*^9, 3.846246776938932*^9}, {
   3.8462468211574593`*^9, 3.846246821357975*^9}, {3.8462469009381323`*^9, 
   3.846247006582032*^9}, {3.846247070132245*^9, 3.846247149644244*^9}, {
   3.846247374359428*^9, 3.8462474663508*^9}, {3.8462475097111187`*^9, 
   3.846247529989496*^9}, 3.846247663407776*^9, {3.846247846840952*^9, 
   3.8462478514860983`*^9}, {3.846247998536194*^9, 3.8462482085672503`*^9}, {
   3.8462483680399227`*^9, 3.8462486484817333`*^9}, {3.8462487027049007`*^9, 
   3.846248724368257*^9}, {3.846248797143999*^9, 3.846248816218581*^9}, {
   3.8462488954114532`*^9, 3.846249049858389*^9}, {3.846249189482415*^9, 
   3.8462493254442596`*^9}, {3.846249385925198*^9, 3.846249487653274*^9}, {
   3.846249544221499*^9, 3.846249546222382*^9}, {3.846249589856963*^9, 
   3.84624967719884*^9}, {3.8462502101602983`*^9, 3.8462502823829317`*^9}, {
   3.8466736897255898`*^9, 3.8466737132423563`*^9}, {3.846673787513953*^9, 
   3.8466738715461493`*^9}, {3.846673957521954*^9, 3.846673984547014*^9}, {
   3.846674145495881*^9, 3.8466742128864717`*^9}, {3.846674595008449*^9, 
   3.846674630136456*^9}, {3.846674694990931*^9, 3.8466747000636473`*^9}, {
   3.8466747961635733`*^9, 3.846674953065852*^9}, {3.8466749914594097`*^9, 
   3.846675024454584*^9}, {3.846675202987584*^9, 3.846675218898118*^9}, {
   3.846675252620487*^9, 3.8466753463304377`*^9}, {3.846675554571374*^9, 
   3.846675660387985*^9}, {3.8466757145470448`*^9, 3.846675822132268*^9}, {
   3.846676264327422*^9, 3.846676282809916*^9}, {3.846676318013103*^9, 
   3.8466763538782*^9}, 3.8466764126300097`*^9, {3.846676467765717*^9, 
   3.846676558822207*^9}, {3.846676738181177*^9, 3.846676742607403*^9}, {
   3.846676775079438*^9, 3.84667680190305*^9}, {3.846676877605699*^9, 
   3.846677019256134*^9}, {3.846677833092266*^9, 3.846677955482648*^9}, {
   3.846678266914877*^9, 3.8466783138718147`*^9}, {3.846678423487372*^9, 
   3.8466785489015512`*^9}, {3.846678590086501*^9, 3.846678590240883*^9}, {
   3.846737994247161*^9, 3.846738004503858*^9}, {3.84673803926145*^9, 
   3.846738043581056*^9}, {3.846738075204897*^9, 3.8467380767987223`*^9}, {
   3.846738324485396*^9, 3.846738363902405*^9}, {3.846738549976481*^9, 
   3.8467386234799957`*^9}, {3.8467386620800943`*^9, 
   3.8467386667625303`*^9}, {3.846738707330525*^9, 3.846738709144993*^9}, {
   3.8467387719995604`*^9, 3.846738802416275*^9}, {3.846738865026211*^9, 
   3.8467388941297913`*^9}, {3.8467390345762873`*^9, 3.846739145036749*^9}, {
   3.846739185086565*^9, 3.8467393313401337`*^9}, {3.846739689354558*^9, 
   3.846739694756753*^9}, {3.8467400608109426`*^9, 3.846740223107369*^9}, {
   3.846740311305922*^9, 3.8467403137190647`*^9}, {3.84674042257513*^9, 
   3.8467404287644377`*^9}, {3.84674073988706*^9, 3.8467408609842367`*^9}, {
   3.846740898995308*^9, 3.846740902645625*^9}, {3.846741092330057*^9, 
   3.846741223363451*^9}, {3.846741273401784*^9, 3.8467413019477367`*^9}, {
   3.846741527121957*^9, 3.846741527308371*^9}, {3.8467415957943*^9, 
   3.846741645888163*^9}, {3.846741748890009*^9, 3.846741839195334*^9}, {
   3.846741884019949*^9, 3.846741998114798*^9}, {3.846742063810554*^9, 
   3.84674210675229*^9}, {3.846742137695187*^9, 3.846742187767593*^9}, {
   3.846742227202767*^9, 3.846742311862904*^9}, {3.846742434968604*^9, 
   3.8467426301567087`*^9}, {3.846742696026381*^9, 3.846742750778027*^9}, {
   3.846742802984507*^9, 3.8467428167728453`*^9}, {3.846742890066197*^9, 
   3.8467428911290913`*^9}, {3.846743039834488*^9, 3.846743042779208*^9}, {
   3.8467430826284523`*^9, 3.846743096066346*^9}, {3.846743232096546*^9, 
   3.846743308351609*^9}, {3.846743430005843*^9, 3.846743466618582*^9}, {
   3.846743674642068*^9, 3.8467439478485317`*^9}, {3.846757292491746*^9, 
   3.846757362945348*^9}, {3.8467574294782124`*^9, 3.846757433996887*^9}, {
   3.846757480935882*^9, 3.846757586611937*^9}, {3.846757629917018*^9, 
   3.84675769313622*^9}, {3.846757896979762*^9, 3.846757910077166*^9}, {
   3.846757965876402*^9, 3.846757967126268*^9}, {3.8467580074662857`*^9, 
   3.846758042493403*^9}, {3.8467580851447906`*^9, 3.8467581652888947`*^9}, {
   3.846758283695571*^9, 3.84675830859065*^9}, {3.846759052744413*^9, 
   3.846759201902575*^9}, {3.846759265432683*^9, 3.846759303972077*^9}, {
   3.8467594306671467`*^9, 3.84675944312948*^9}, {3.846759498593891*^9, 
   3.846759580771838*^9}, {3.8467599206609*^9, 3.8467599409392433`*^9}, {
   3.846760047365443*^9, 3.846760301481989*^9}, {3.846760368724524*^9, 
   3.8467603697920437`*^9}, {3.846760465752306*^9, 3.846760595583912*^9}, {
   3.8467606912704678`*^9, 3.846760722904125*^9}, 3.846760861779859*^9, {
   3.84676100367754*^9, 3.846761016091728*^9}, 3.846761054791007*^9, {
   3.8467610993331614`*^9, 3.846761204795373*^9}, {3.8467621585850983`*^9, 
   3.8467621739066877`*^9}, {3.8467622043042917`*^9, 3.846762231589814*^9}, {
   3.8467622809649477`*^9, 3.8467622811161346`*^9}, {3.846762324145405*^9, 
   3.846762333115369*^9}, {3.846762365576317*^9, 3.8467623868763437`*^9}, {
   3.846762459295772*^9, 3.8467624617875357`*^9}, {3.846762521784429*^9, 
   3.846762597208755*^9}},
 CellLabel->
  "In[233]:=",ExpressionUUID->"d03a6935-ab96-4201-b6a0-67a4e93e08ce"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"7", "*", "z", "*", 
   TemplateBox[{"1", "2"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], 
   TemplateBox[{"2", "3"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], 
   TemplateBox[{"3", "4"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], 
   TemplateBox[{"3", "5"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], 
   RowBox[{
    TemplateBox[{"5", "6"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "^", "2"}], 
   RowBox[{
    TemplateBox[{"7", 
      RowBox[{"{", "8", "}"}], "9"},
     "AngleSquareChain",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
     InterpretationFunction->(
      RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
        "$square", "]"}]& )], "/", 
    RowBox[{"(", 
     RowBox[{
      TemplateBox[{"p1", "p2"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], 
      RowBox[{
       TemplateBox[{"p2", "p3"},
        "SpinorSquareBracket",
        DisplayFunction->(RowBox[{"[", 
           RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
        InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
           RowBox[{#, ",", #2}], "]"}]& )], "^", "2"}]}], ")"}]}]}], "//", 
  "PreChain"}]], "Input",
 CellChangeTimes->{{3.846242173509924*^9, 3.846242231112877*^9}, {
  3.846246116586875*^9, 3.846246150278006*^9}, {3.8462461817347727`*^9, 
  3.846246182158164*^9}, {3.846246578013474*^9, 3.846246578378786*^9}, {
  3.846247680110651*^9, 3.846247683789065*^9}, {3.8467594054913588`*^9, 
  3.846759412790703*^9}},
 CellLabel->
  "In[234]:=",ExpressionUUID->"59659eae-029e-498c-bd5d-ae5fc0efbef5"],

Cell[BoxData[
 FractionBox[
  RowBox[{"7", " ", "z", " ", 
   TemplateBox[{"1", 
     RowBox[{"{", 
       RowBox[{"2", ",", "3"}], "}"}], "4"},
    "AngleAngleChain",
    DisplayFunction->(
     RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle", 
       "]"}]& )], " ", 
   TemplateBox[{"3", 
     RowBox[{"{", "5", "}"}], "6"},
    "AngleSquareChain",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square",
        "]"}]& )], " ", 
   TemplateBox[{"7", 
     RowBox[{"{", "8", "}"}], "9"},
    "AngleSquareChain",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square",
        "]"}]& )], " ", 
   TemplateBox[{"5", "6"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}], 
  RowBox[{
   TemplateBox[{"p1", 
     RowBox[{"{", "p2", "}"}], "p3"},
    "AngleSquareChain",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square",
        "]"}]& )], " ", 
   TemplateBox[{"p2", "p3"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}]]], "Output",
 CellChangeTimes->{
  3.84624611997372*^9, 3.846246151308091*^9, 3.846246183552204*^9, 
   3.846246235365589*^9, 3.846246376832349*^9, {3.846246424554968*^9, 
   3.846246439031102*^9}, 3.846246471934087*^9, 3.846246579394256*^9, 
   3.846246688354754*^9, 3.8462470081212587`*^9, {3.8462470922578087`*^9, 
   3.846247121462365*^9}, {3.846247445871354*^9, 3.846247467791078*^9}, {
   3.846247668496654*^9, 3.846247685000882*^9}, {3.846248016852743*^9, 
   3.846248049962275*^9}, 3.8462484455387506`*^9, {3.846248476005752*^9, 
   3.8462484847031097`*^9}, 3.846248535328216*^9, 3.846249757710393*^9, 
   3.846667513813611*^9, 3.846673693242999*^9, 3.846674204087784*^9, {
   3.846674935957589*^9, 3.846674954745063*^9}, 3.846675030390892*^9, 
   3.846675206681568*^9, {3.8466752434827557`*^9, 3.846675291700943*^9}, 
   3.846678483068389*^9, {3.846678522601722*^9, 3.846678550403185*^9}, 
   3.8467380114278393`*^9, 3.8467380456997623`*^9, 3.846738078710441*^9, 
   3.84673862739706*^9, 3.846738669944131*^9, 3.846738940403521*^9, 
   3.846739053551709*^9, 3.8467393053039494`*^9, 3.846739336531863*^9, 
   3.846739696777441*^9, 3.846740190453413*^9, 3.8467402249021387`*^9, 
   3.846740869774839*^9, 3.8467409039996853`*^9, 3.846741537562234*^9, {
   3.8467418142038727`*^9, 3.8467418410786247`*^9}, 3.846742010400065*^9, 
   3.846742202063075*^9, 3.846742487301585*^9, 3.846742636959553*^9, {
   3.846742698989911*^9, 3.846742753065506*^9}, 3.846742821663252*^9, 
   3.8467428935453978`*^9, 3.846743044954796*^9, 3.846743099163868*^9, 
   3.8467432608507338`*^9, {3.846743291150421*^9, 3.846743310303846*^9}, 
   3.846743696569893*^9, {3.846743916768108*^9, 3.8467439498985567`*^9}, 
   3.846757593809761*^9, 3.846758312350493*^9, {3.846759384728903*^9, 
   3.8467594137807007`*^9}, 3.846759539418352*^9, 3.84676074165191*^9, 
   3.846760865426648*^9, 3.846761060071117*^9, {3.846761184868147*^9, 
   3.8467612065858727`*^9}, 3.846762175936771*^9, {3.846762206121325*^9, 
   3.846762232738701*^9}, 3.8467622830487137`*^9, 3.846762336509307*^9, 
   3.846762389967955*^9, 3.846762464782827*^9, 3.846762543120842*^9, 
   3.846762600048937*^9},
 CellLabel->
  "Out[234]=",ExpressionUUID->"ae64e6b0-b362-41a1-bdff-894b9b7fdfe1"]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"test", "=", 
   RowBox[{"7", "*", "z", "*", 
    TemplateBox[{"1", "2"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], 
    TemplateBox[{"2", "3"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], 
    TemplateBox[{"3", "4"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], 
    TemplateBox[{"3", "5"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], 
    RowBox[{
     TemplateBox[{"5", "6"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], "^", "2"}], 
    RowBox[{
     TemplateBox[{"7", 
       RowBox[{"{", "8", "}"}], "9"},
      "AngleSquareChain",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], "/", 
     RowBox[{"(", 
      RowBox[{
       TemplateBox[{"p1", "p2"},
        "SpinorAngleBracket",
        DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
           RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
        InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
           RowBox[{#, ",", #2}], "]"}]& )], 
       RowBox[{
        TemplateBox[{"p2", "p3"},
         "SpinorSquareBracket",
         DisplayFunction->(RowBox[{"[", 
            RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
         InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
            RowBox[{#, ",", #2}], "]"}]& )], "^", "2"}]}], ")"}]}]}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.846743970308426*^9, 3.846743972693273*^9}},
 CellLabel->
  "In[203]:=",ExpressionUUID->"8e855dc2-fa4c-4d99-a710-f6027d1532a6"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"Do", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"test", "^", "3"}], "//", "ToChain"}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", "1000"}], "}"}]}], "]"}], "//", 
  "AbsoluteTiming"}]], "Input",
 CellChangeTimes->{{3.846743979401436*^9, 3.84674399624229*^9}, {
  3.8467440327908*^9, 3.8467440333816767`*^9}, {3.846760882878025*^9, 
  3.8467609251739388`*^9}},
 CellLabel->
  "In[208]:=",ExpressionUUID->"95553f6b-bcbf-41f0-adbc-b73f11d7c5b5"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"1.578293`", ",", "Null"}], "}"}]], "Output",
 CellChangeTimes->{
  3.84674399739345*^9, 3.846744035412333*^9, {3.846760886163323*^9, 
   3.846760927338073*^9}},
 CellLabel->
  "Out[208]=",ExpressionUUID->"a2df510e-138d-4cf1-ac04-43896001a7fc"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"Do", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"test", "^", "3"}], "//", "PreChain"}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", "1000"}], "}"}]}], "]"}], "//", 
  "AbsoluteTiming"}]], "Input",
 CellChangeTimes->{{3.8467440064319487`*^9, 3.8467440081034946`*^9}, {
  3.846744039308696*^9, 3.846744040548047*^9}, {3.846744117268402*^9, 
  3.846744123980432*^9}, {3.8467608939367332`*^9, 3.846760930909863*^9}},
 CellLabel->
  "In[209]:=",ExpressionUUID->"448e777a-ebee-4dcf-8a58-03286bb7d0e6"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"3.601811`", ",", "Null"}], "}"}]], "Output",
 CellChangeTimes->{
  3.846744009235771*^9, {3.846744114703321*^9, 3.8467441488409843`*^9}, {
   3.846760895911515*^9, 3.846760935164515*^9}},
 CellLabel->
  "Out[209]=",ExpressionUUID->"104c8358-9c87-4a16-b5aa-78df5a3537d4"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "Combinatorics", " ", "of", " ", "terms", " ", "explodes", " ", "with", " ",
    "the", " ", "number", " ", "of", " ", "powers", " ", "in", " ", "each", 
   " ", "bracket"}], "*)"}]], "Input",
 CellChangeTimes->{{3.846744140018464*^9, 
  3.8467441639582148`*^9}},ExpressionUUID->"24aa8053-3b2a-43ba-b63c-\
49ec63419239"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"(", 
    RowBox[{"7", "*", "z", "*", 
     TemplateBox[{"1", "2"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], 
     TemplateBox[{"2", "3"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], 
     TemplateBox[{"3", "4"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], 
     TemplateBox[{"3", "5"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], 
     RowBox[{
      TemplateBox[{"5", "6"},
       "SpinorSquareBracket",
       DisplayFunction->(RowBox[{"[", 
          RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], "^", "2"}], 
     RowBox[{
      TemplateBox[{"7", 
        RowBox[{"{", "8", "}"}], "9"},
       "AngleSquareChain",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
       InterpretationFunction->(
        RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
          "$square", "]"}]& )], "/", 
      RowBox[{"(", 
       RowBox[{
        TemplateBox[{"p1", "p2"},
         "SpinorAngleBracket",
         DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
            RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
         InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
            RowBox[{#, ",", #2}], "]"}]& )], 
        RowBox[{
         TemplateBox[{"p2", "p3"},
          "SpinorSquareBracket",
          DisplayFunction->(RowBox[{"[", 
             RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
          InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
             RowBox[{#, ",", #2}], "]"}]& )], "^", "2"}]}], ")"}]}]}], ")"}], 
   "^", "3"}], "//", "PreChain"}]], "Input",
 CellChangeTimes->{{3.846760953438199*^9, 3.84676095793447*^9}},
 CellLabel->
  "In[210]:=",ExpressionUUID->"1eabf1d2-1c36-476b-abc9-e25d6be5db48"],

Cell[BoxData[
 FractionBox[
  RowBox[{"343", " ", 
   SuperscriptBox["z", "3"], " ", 
   SuperscriptBox[
    TemplateBox[{"1", 
      RowBox[{"{", 
        RowBox[{"2", ",", "3"}], "}"}], "4"},
     "AngleAngleChain",
     DisplayFunction->(
      RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(
      RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle",
         "]"}]& )], "3"], " ", 
   SuperscriptBox[
    TemplateBox[{"3", 
      RowBox[{"{", "5", "}"}], "6"},
     "AngleSquareChain",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
     InterpretationFunction->(
      RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
        "$square", "]"}]& )], "3"], " ", 
   SuperscriptBox[
    TemplateBox[{"7", 
      RowBox[{"{", "8", "}"}], "9"},
     "AngleSquareChain",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
     InterpretationFunction->(
      RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
        "$square", "]"}]& )], "3"], " ", 
   SuperscriptBox[
    TemplateBox[{"5", "6"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "3"]}], 
  RowBox[{
   SuperscriptBox[
    TemplateBox[{"p1", 
      RowBox[{"{", "p2", "}"}], "p3"},
     "AngleSquareChain",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
     InterpretationFunction->(
      RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
        "$square", "]"}]& )], "3"], " ", 
   SuperscriptBox[
    TemplateBox[{"p2", "p3"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "3"]}]]], "Output",
 CellChangeTimes->{3.8467609586193542`*^9},
 CellLabel->
  "Out[210]=",ExpressionUUID->"760e189e-7d3e-4a6b-ae42-d3e0ced93e75"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Complete version", "Subsection",
 CellChangeTimes->{{3.846245675277483*^9, 3.846245677621294*^9}, {
  3.846673722916071*^9, 3.846673724332143*^9}, {3.8467427791663427`*^9, 
  3.846742783985442*^9}, {3.846744431908648*^9, 3.846744456203334*^9}, {
  3.846762647055242*^9, 
  3.846762649819271*^9}},ExpressionUUID->"cc73b313-c20a-40ca-a8f5-\
6a296e03e20b"],

Cell[BoxData[
 RowBox[{"ClearAll", "[", "PreChain", "]"}]], "Input",
 CellChangeTimes->{{3.846762785997642*^9, 3.8467627919336576`*^9}},
 CellLabel->
  "In[237]:=",ExpressionUUID->"0f31a181-1666-4060-8076-553724c12f1b"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"Options", "[", "PreChain", "]"}], "=", 
  RowBox[{"{", 
   RowBox[{"ChainSelection", "->", "\"\<RandomChain\>\""}], "}"}]}]], "Input",\

 CellChangeTimes->{{3.846743508106366*^9, 3.846743528518509*^9}, {
  3.846743605388595*^9, 3.846743661255863*^9}, {3.846762618647623*^9, 
  3.846762626770125*^9}},
 CellLabel->
  "In[238]:=",ExpressionUUID->"ce725442-8380-448d-87b9-b5c2e12f8cfe"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"ChainSelection", "\[Rule]", "\<\"RandomChain\"\>"}], 
  "}"}]], "Output",
 CellChangeTimes->{3.846762793367238*^9},
 CellLabel->
  "Out[238]=",ExpressionUUID->"96e5a456-6c3b-407d-9088-f9be861f9394"]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"PreChain", "[", 
   RowBox[{"exp_", ",", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "aa", ",", "bb", ",", "ab", ",", "wrapper", ",", "invwrapper", ",", 
      "local", ",", "mult", ",", "tmp"}], "}"}], ",", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "SpinorAngleBracket", ",", "SpinorSquareBracket", ",", "Chain"}], 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"local", "=", "exp"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Convert", " ", "all", " ", "the", " ", "chains", " ", "and", " ", 
         "spinor", " ", "brackets", " ", "into", " ", "simpler", " ", 
         "objects", " ", "and", " ", "wrap", " ", "them", " ", "into", " ", 
         "a", " ", "function", " ", "which", " ", "will", " ", "chain", " ", 
         "them"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"SpinorAngleBracket", "[", "x__", "]"}], ":=", 
        RowBox[{"wrapper", "[", 
         RowBox[{"aa", "[", "x", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"SpinorSquareBracket", "[", "x__", "]"}], ":=", 
        RowBox[{"wrapper", "[", 
         RowBox[{"bb", "[", "x", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Chain", "[", 
         RowBox[{"$angle", ",", "x__", ",", "$angle"}], "]"}], ":=", 
        RowBox[{"wrapper", "[", 
         RowBox[{"aa", "[", 
          RowBox[{"Sequence", "@@", 
           RowBox[{"Flatten", "@", 
            RowBox[{"{", "x", "}"}]}]}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Chain", "[", 
         RowBox[{"$angle", ",", "x__", ",", "$square"}], "]"}], ":=", 
        RowBox[{"wrapper", "[", 
         RowBox[{"ab", "[", 
          RowBox[{"Sequence", "@@", 
           RowBox[{"Flatten", "@", 
            RowBox[{"{", "x", "}"}]}]}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Chain", "[", 
         RowBox[{"$square", ",", "x__", ",", "$angle"}], "]"}], ":=", 
        RowBox[{"wrapper", "[", 
         RowBox[{"ab", "[", 
          RowBox[{"Sequence", "@@", 
           RowBox[{"Reverse", "@", 
            RowBox[{"Flatten", "@", 
             RowBox[{"{", "x", "}"}]}]}]}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Chain", "[", 
         RowBox[{"$square", ",", "x__", ",", "$square"}], "]"}], ":=", 
        RowBox[{"wrapper", "[", 
         RowBox[{"bb", "[", 
          RowBox[{"Sequence", "@@", 
           RowBox[{"Flatten", "@", 
            RowBox[{"{", "x", "}"}]}]}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "Define", " ", "properties", " ", "of", " ", "the", " ", "wrapper", 
          " ", "so", " ", "that", " ", "it", " ", "wraps", " ", "everything", 
          " ", "together"}], ",", " ", 
         RowBox[{"taking", " ", "care", " ", "of", " ", "the", " ", 
          RowBox[{"powers", ".", " ", "Inverse"}], " ", "powers", " ", "are", 
          " ", "the", " ", "reason", " ", "we", " ", "need", " ", "the", " ", 
          "auxiliary", " ", "invwrapper"}], ",", " ", 
         RowBox[{
          RowBox[{
          "this", " ", "would", " ", "be", " ", "needed", " ", "if", " ", 
           "we", " ", "could", " ", "go", " ", "deeper", " ", "with", " ", 
           "the", " ", "upvalues", " ", "of", " ", "wrapper"}], "..."}]}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"wrapper", " ", "/:", " ", 
        RowBox[{
         RowBox[{"wrapper", "[", "x_", "]"}], "*", 
         RowBox[{"wrapper", "[", "y_", "]"}]}], ":=", 
        RowBox[{"wrapper", "[", 
         RowBox[{"x", "*", "y"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"wrapper", " ", "/:", " ", 
        RowBox[{"Power", "[", 
         RowBox[{
          RowBox[{"wrapper", "[", "x_", "]"}], ",", 
          RowBox[{"n_", "?", "Positive"}]}], "]"}], ":=", 
        RowBox[{"wrapper", "[", 
         RowBox[{"Power", "[", 
          RowBox[{"x", ",", "n"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"wrapper", " ", "/:", " ", 
        RowBox[{"Power", "[", 
         RowBox[{
          RowBox[{"wrapper", "[", "x_", "]"}], ",", 
          RowBox[{"n_", "?", "Negative"}]}], "]"}], ":=", 
        RowBox[{"invwrapper", "[", 
         RowBox[{"Power", "[", 
          RowBox[{"x", ",", 
           RowBox[{"-", "n"}]}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"invwrapper", " ", "/:", " ", 
        RowBox[{
         RowBox[{"invwrapper", "[", "x_", "]"}], "*", 
         RowBox[{"invwrapper", "[", "y_", "]"}]}], ":=", 
        RowBox[{"invwrapper", "[", 
         RowBox[{"x", "*", "y"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"local", "=", "local"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Reconvert", " ", "the", " ", "inwrapper", " ", "to", " ", "the", " ",
          "inverse", " ", "power", " ", "of", " ", "a", " ", "wrapper"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Clear", "[", "wrapper", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"invwrapper", "[", "x_", "]"}], ":=", 
        RowBox[{"Power", "[", 
         RowBox[{
          RowBox[{"wrapper", "[", "x", "]"}], ",", 
          RowBox[{"-", "1"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"local", "=", "local"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "Next", " ", "we", " ", "want", " ", "the", " ", "wrapper", " ", 
          "to", " ", "be", " ", "ready", " ", "to", " ", "actually", " ", 
          "do", " ", "stuff"}], ",", " ", 
         RowBox[{
         "so", " ", "we", " ", "group", " ", "things", " ", "together", " ", 
          "in", " ", 
          RowBox[{"lists", ":", " ", "aa"}]}], ",", "bb", ",", 
         RowBox[{"ab", " ", "and", " ", "ba", " ", "separate"}], ",", " ", 
         RowBox[{
         "along", " ", "with", " ", "the", " ", "product", " ", "of", " ", 
          "already", " ", "used", " ", 
          RowBox[{"stuff", ".", " ", "First"}], " ", "convert", " ", 
          "arguments", " ", "of", " ", "wrapper", " ", "to", " ", "a", " ", 
          "list"}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Clear", "[", "invwrapper", "]"}], ";", "\[IndentingNewLine]", 
       
       RowBox[{
        RowBox[{"wrapper", "[", 
         RowBox[{"f_", "[", "x__", "]"}], "]"}], ":=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"f", "===", "Times"}], ",", 
          RowBox[{"invwrapper", "[", 
           RowBox[{"List", "[", "x", "]"}], "]"}], ",", 
          RowBox[{"invwrapper", "[", 
           RowBox[{"{", "x", "}"}], "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "Here", " ", "we", " ", "gather", " ", "the", " ", "objects", " ", 
          "by", " ", "head"}], ",", " ", 
         RowBox[{
         "then", " ", "replace", " ", "powers", " ", "by", " ", "arrays", " ",
           "with", " ", "correct", " ", "multiplicity"}], ",", " ", 
         RowBox[{
         "and", " ", "finally", " ", "make", "  ", "atable", " ", "with", " ",
           "the", " ", "elements", " ", "of", " ", "each", " ", "type", " ", 
          "putting", " ", "an", " ", "empty", " ", "list", " ", "for", " ", 
          "the", " ", "missing", " ", 
          RowBox[{"ones", ".", " ", "We"}], " ", "keep", " ", "the", " ", 
          "invwrapper", " ", "as", " ", "an", " ", "external", " ", 
          "container"}], ",", " ", 
         RowBox[{
         "so", " ", "that", " ", "once", " ", "wrapper", " ", "has", " ", 
          "done", " ", 
          RowBox[{"it", "'"}], "s", " ", "job"}], ",", " ", 
         RowBox[{
         "invwrapper", " ", "can", " ", "select", " ", "the", " ", "chain", 
          " ", "we", " ", "want"}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"local", "=", "local"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Clear", "[", "wrapper", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"invwrapper", "[", "x_List", "]"}], ":=", 
        RowBox[{"invwrapper", "[", 
         RowBox[{"wrapper", "[", 
          RowBox[{"1", ",", "1", ",", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"SelectFirst", "[", 
              RowBox[{
               RowBox[{"GatherBy", "[", 
                RowBox[{
                 RowBox[{"Flatten", "[", 
                  RowBox[{"x", "/.", 
                   RowBox[{"Power", "->", "ConstantArray"}]}], "]"}], ",", 
                 "Head"}], "]"}], ",", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"#", "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "0"}], "]"}], "]"}], "===", "i"}], 
                 "&"}], ")"}], ",", 
               RowBox[{"{", "}"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", 
               RowBox[{"{", 
                RowBox[{"aa", ",", "ab", ",", "bb"}], "}"}]}], "}"}]}], 
            "]"}]}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "In", " ", "order", " ", "to", " ", "get", " ", "blown", " ", "out", 
          " ", "of", " ", "the", " ", "water", " ", "by", " ", 
          "combinatorics", " ", "we", " ", "need", " ", "to", " ", "take", 
          " ", "into", " ", "account", " ", "the", " ", "multiplicity", " ", 
          "with", " ", "which", " ", "each", " ", "bracket", " ", "appears"}],
          ",", " ", 
         RowBox[{
          RowBox[{"i", ".", "e", ".", " ", "its"}], " ", 
          RowBox[{"power", ".", " ", "To"}], " ", "do", " ", "so", " ", 
          "\"\<efficiently\>\"", " ", "we", " ", "introduce", " ", "another", 
          " ", "auxiliary", " ", "function"}]}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"wrapper", "[", 
         RowBox[{"1", ",", "1", ",", 
          RowBox[{"{", 
           RowBox[{"a_", ",", "b_", ",", "c_"}], "}"}]}], "]"}], ":=", 
        RowBox[{"wrapper", "[", 
         RowBox[{"1", ",", "1", ",", 
          RowBox[{"mult", "@@@", 
           RowBox[{"Tally", "@", "a"}]}], ",", 
          RowBox[{"mult", "@@@", 
           RowBox[{"Tally", "@", "b"}]}], ",", 
          RowBox[{"mult", "@@@", 
           RowBox[{"Tally", "@", "c"}]}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"local", "=", "local"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "When", " ", "multiplicity", " ", "reaches", " ", "zero", " ", "mult",
          " ", "simply", " ", "drops", " ", "out", " ", "of", " ", "the", " ",
          "game"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"mult", "[", 
         RowBox[{"x_", ",", "0"}], "]"}], ":=", 
        RowBox[{"Nothing", "[", "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "Now", " ", "we", " ", "clear", " ", "the", " ", "invwrapper", " ", 
          "and", " ", "make", " ", "the", " ", "wrapper", " ", "do", " ", 
          "the", " ", "magic", " ", "of", " ", 
          RowBox[{"combinatorics", ".", " ", "The"}], " ", "aa"}], ",", "bb", 
         ",", "ba", ",", 
         RowBox[{
         "ab", " ", "objects", " ", "get", " ", "some", " ", "specific", " ", 
          "properties", " ", "which", " ", "is", " ", "what", " ", "will", 
          " ", "build", " ", "the", " ", "chains"}]}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"Clear", "[", 
        RowBox[{"invwrapper", ",", "wrapper"}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"The", " ", "wrapper", " ", "acts", " ", "recursively"}], 
         ",", " ", 
         RowBox[{"testing", " ", "its", " ", "second", " ", 
          RowBox[{"argument", "'"}], "s", " ", "head", " ", "and", " ", 
          "accordingly", " ", "combining", " ", "it", " ", "with", " ", "one",
           " ", "of", " ", "the", " ", "elements", " ", "in", " ", "the", " ",
           "lists", " ", "of", " ", 
          RowBox[{"brackets", ".", " ", "If"}], " ", "no", " ", "combination",
           " ", "is", " ", "possible", " ", "the", " ", "second", " ", 
          "argument", " ", "is", " ", "merged", " ", "with", " ", "the", " ", 
          "first", " ", "one", " ", "and", " ", "a", " ", "new", " ", "cycle",
           " ", 
          RowBox[{"begins", ".", " ", "Termination"}], " ", "condition", " ", 
          "is", " ", "that", " ", "all", " ", "lists", " ", "are", " ", 
          "empty"}]}], "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Termination", " ", "condition"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"wrapper", "[", 
         RowBox[{"x_", ",", "y_", ",", 
          RowBox[{"{", "}"}], ",", 
          RowBox[{"{", "}"}], ",", 
          RowBox[{"{", "}"}]}], "]"}], ":=", 
        RowBox[{"x", "*", "y"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"The", " ", "starting", " ", "point"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"wrapper", "[", 
         RowBox[{"x_", ",", "1", ",", "a_", ",", "b_", ",", "c_"}], "]"}], ":=", 
        RowBox[{"Which", "[", 
         RowBox[{
          RowBox[{"a", "=!=", 
           RowBox[{"{", "}"}]}], ",", 
          RowBox[{"wrapper", "[", 
           RowBox[{"x", ",", 
            RowBox[{"a", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
            RowBox[{"ReplacePart", "[", 
             RowBox[{"a", ",", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"1", ",", "2"}], "}"}], "->", 
               RowBox[{
                RowBox[{"a", "[", 
                 RowBox[{"[", 
                  RowBox[{"1", ",", "2"}], "]"}], "]"}], "-", "1"}]}]}], 
             "]"}], ",", "b", ",", "c"}], "]"}], ",", 
          RowBox[{"b", "=!=", 
           RowBox[{"{", "}"}]}], ",", 
          RowBox[{"wrapper", "[", 
           RowBox[{"x", ",", 
            RowBox[{"b", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", "a", ",", 
            RowBox[{"ReplacePart", "[", 
             RowBox[{"b", ",", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"1", ",", "2"}], "}"}], "->", 
               RowBox[{
                RowBox[{"b", "[", 
                 RowBox[{"[", 
                  RowBox[{"1", ",", "2"}], "]"}], "]"}], "-", "1"}]}]}], 
             "]"}], ",", "c"}], "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "If", " ", "any", " ", "two", " ", "of", " ", "the", " ", "lists", 
         " ", "are", " ", "empty", " ", "and", " ", "there", " ", "are", " ", 
         "no", " ", "brackets", " ", "in", " ", "the", " ", "second", " ", 
         "slot", " ", "of", " ", "wrapper", " ", "there", " ", "is", " ", 
         "nothing", " ", "to", " ", "be", " ", 
         RowBox[{"done", "."}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"wrapper", "[", 
         RowBox[{"x_", ",", "1", ",", 
          RowBox[{"{", "}"}], ",", 
          RowBox[{"{", "}"}], ",", "a_"}], "]"}], ":=", 
        RowBox[{"x", "*", 
         RowBox[{"Times", "@@", 
          RowBox[{"Power", "@@@", "a"}]}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"wrapper", "[", 
         RowBox[{"x_", ",", "1", ",", 
          RowBox[{"{", "}"}], ",", "a_", ",", 
          RowBox[{"{", "}"}]}], "]"}], ":=", 
        RowBox[{"x", "*", 
         RowBox[{"Times", "@@", 
          RowBox[{"Power", "@@@", "a"}]}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"wrapper", "[", 
         RowBox[{"x_", ",", "1", ",", "a_", ",", 
          RowBox[{"{", "}"}], ",", 
          RowBox[{"{", "}"}]}], "]"}], ":=", 
        RowBox[{"x", "*", 
         RowBox[{"Times", "@@", 
          RowBox[{"Power", "@@@", "a"}]}]}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"GENERAL", " ", 
         RowBox[{"QUESTION", ":", " ", 
          RowBox[{"is", " ", "this", " ", "pattern", " ", "matching", " ", 
           RowBox[{"aa", "[", 
            RowBox[{"x_", ",", "y___", ",", "z_"}], "]"}], " ", "faster", " ",
            "or", " ", "is", " ", 
           RowBox[{"aa", "[", "x__", "]"}], " ", "with", " ", "calling", " ", 
           
           RowBox[{"First", "@", "x"}], " ", "every", " ", "time", " ", 
           RowBox[{"faster", "?"}]}]}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Entry", " ", "is", " ", "aa"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "If", " ", "upon", " ", "parsing", " ", "the", " ", "lists", " ", 
          "of", " ", "objects", " ", "and", " ", "making", " ", "all", " ", 
          "the", " ", "possible", " ", "contractions", " ", "an", " ", 
          "empty", " ", "list", " ", "is", " ", "returned"}], ",", " ", 
         RowBox[{
         "we", " ", "need", " ", "to", " ", "move", " ", "the", " ", "input", 
          " ", "entry", " ", "to", " ", "the", " ", "overall", " ", "product",
           " ", "but", " ", "and", " ", "start", " ", "a", " ", "new", " ", 
          "iteration"}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"wrapper", "[", 
         RowBox[{"ex_", ",", 
          RowBox[{"aa", "[", 
           RowBox[{"x_", ",", "y___", ",", "z_"}], "]"}], ",", "a_", ",", 
          "b_", ",", "c_"}], "]"}], ":=", 
        RowBox[{
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"#", "===", 
             RowBox[{"{", "}"}]}], ",", 
            RowBox[{"wrapper", "[", 
             RowBox[{
              RowBox[{"ex", "*", 
               RowBox[{"aa", "[", 
                RowBox[{"x", ",", "y", ",", "z"}], "]"}]}], ",", "1", ",", 
              "a", ",", "b", ",", "c"}], "]"}], ",", "#"}], "]"}], "&"}], "@",
          "\[IndentingNewLine]", 
         RowBox[{"Join", "[", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
           "Combining", " ", "the", " ", "last", " ", "entry", " ", "of", " ",
             "the", " ", "aa", " ", "with", " ", "all", " ", "the", " ", 
            "first", " ", "entries", " ", "of", " ", "the", " ", "bb"}], 
           "*)"}], 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"c", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "1", ",", "1"}], "]"}], "]"}], "===", 
                "z"}], ",", 
               RowBox[{"wrapper", "[", 
                RowBox[{"ex", ",", 
                 RowBox[{"ab", "[", 
                  RowBox[{"x", ",", "y", ",", 
                   RowBox[{"Sequence", "@@", 
                    RowBox[{"(", 
                    RowBox[{"List", "@@", 
                    RowBox[{"c", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "1"}], "]"}], "]"}]}], ")"}]}]}], "]"}],
                  ",", "a", ",", "b", ",", 
                 RowBox[{"ReplacePart", "[", 
                  RowBox[{"c", ",", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{"i", ",", "2"}], "}"}], "->", 
                    RowBox[{
                    RowBox[{"c", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "2"}], "]"}], "]"}], "-", "1"}]}]}], 
                  "]"}]}], "]"}], ",", 
               RowBox[{"Nothing", "[", "]"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", 
               RowBox[{"Length", "@", "c"}]}], "}"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
            "Combining", " ", "the", " ", "last", " ", "entry", " ", "of", 
             " ", "aa", " ", "with", " ", "the", " ", "last", " ", "of", " ", 
             "ab", " ", "and", " ", "bb"}], "*)"}], 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"b", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "1", ",", 
                   RowBox[{"-", "1"}]}], "]"}], "]"}], "===", "z"}], ",", 
               RowBox[{"wrapper", "[", 
                RowBox[{"ex", ",", 
                 RowBox[{"aa", "[", 
                  RowBox[{"x", ",", "y", ",", 
                   RowBox[{"Sequence", "@@", 
                    RowBox[{"Reverse", "@", 
                    RowBox[{"(", 
                    RowBox[{"b", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "1"}], "]"}], "]"}], ")"}]}]}]}], "]"}],
                  ",", "a", ",", 
                 RowBox[{"ReplacePart", "[", 
                  RowBox[{"b", ",", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{"i", ",", "2"}], "}"}], "->", 
                    RowBox[{
                    RowBox[{"b", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "2"}], "]"}], "]"}], "-", "1"}]}]}], 
                  "]"}], ",", "c"}], "]"}], ",", 
               RowBox[{"Nothing", "[", "]"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", 
               RowBox[{"Length", "@", "b"}]}], "}"}]}], "]"}], ",", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"c", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "1", ",", 
                   RowBox[{"-", "1"}]}], "]"}], "]"}], "===", "z"}], ",", 
               RowBox[{"wrapper", "[", 
                RowBox[{
                 RowBox[{"-", "ex"}], ",", 
                 RowBox[{"ab", "[", 
                  RowBox[{"x", ",", "y", ",", 
                   RowBox[{"Sequence", "@@", 
                    RowBox[{"Reverse", "@", 
                    RowBox[{"(", 
                    RowBox[{"c", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "1"}], "]"}], "]"}], ")"}]}]}]}], "]"}],
                  ",", "a", ",", "b", ",", 
                 RowBox[{"ReplacePart", "[", 
                  RowBox[{"c", ",", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{"i", ",", "2"}], "}"}], "->", 
                    RowBox[{
                    RowBox[{"c", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "2"}], "]"}], "]"}], "-", "1"}]}]}], 
                  "]"}]}], "]"}], ",", 
               RowBox[{"Nothing", "[", "]"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", 
               RowBox[{"Length", "@", "c"}]}], "}"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
            "First", " ", "entry", " ", "of", " ", "aa", " ", "with", " ", 
             "first", " ", "of", " ", "bb"}], "*)"}], 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"c", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "1", ",", "1"}], "]"}], "]"}], "===", 
                "x"}], ",", 
               RowBox[{"wrapper", "[", 
                RowBox[{
                 RowBox[{"-", "ex"}], ",", 
                 RowBox[{"ab", "[", 
                  RowBox[{
                   RowBox[{"Sequence", "@@", 
                    RowBox[{"Reverse", "@", 
                    RowBox[{"{", 
                    RowBox[{"y", ",", "z"}], "}"}]}]}], ",", 
                   RowBox[{"Sequence", "@@", 
                    RowBox[{"(", 
                    RowBox[{"c", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "1"}], "]"}], "]"}], ")"}]}]}], "]"}], 
                 ",", "a", ",", "b", ",", 
                 RowBox[{"ReplacePart", "[", 
                  RowBox[{"c", ",", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{"i", ",", "2"}], "}"}], "->", 
                    RowBox[{
                    RowBox[{"c", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "2"}], "]"}], "]"}], "-", "1"}]}]}], 
                  "]"}]}], "]"}], ",", 
               RowBox[{"Nothing", "[", "]"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", 
               RowBox[{"Length", "@", "c"}]}], "}"}]}], "]"}], ",", 
           RowBox[{"(*", 
            RowBox[{
            "First", " ", "of", " ", "aa", " ", "with", " ", "last", " ", 
             "of", " ", "ab"}], "*)"}], 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"b", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "1", ",", 
                   RowBox[{"-", "1"}]}], "]"}], "]"}], "===", "x"}], ",", 
               RowBox[{"wrapper", "[", 
                RowBox[{"ex", ",", 
                 RowBox[{"aa", "[", 
                  RowBox[{
                   RowBox[{"Sequence", "@@", 
                    RowBox[{"(", 
                    RowBox[{"b", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "1"}], "]"}], "]"}], ")"}]}], ",", "y", 
                   ",", "z"}], "]"}], ",", "a", ",", 
                 RowBox[{"ReplacePart", "[", 
                  RowBox[{"b", ",", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{"i", ",", "2"}], "}"}], "->", 
                    RowBox[{
                    RowBox[{"b", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "2"}], "]"}], "]"}], "-", "1"}]}]}], 
                  "]"}], ",", "c"}], "]"}], ",", 
               RowBox[{"Nothing", "[", "]"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", 
               RowBox[{"Length", "@", "b"}]}], "}"}]}], "]"}], ",", 
           RowBox[{"(*", 
            RowBox[{"First", " ", "aa", " ", "with", " ", "last", " ", "bb"}],
             "*)"}], 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"c", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "1", ",", 
                   RowBox[{"-", "1"}]}], "]"}], "]"}], "===", "x"}], ",", 
               RowBox[{"wrapper", "[", 
                RowBox[{"ex", ",", 
                 RowBox[{"ab", "[", 
                  RowBox[{"Sequence", "@@", 
                   RowBox[{"Reverse", "@", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Sequence", "@@", 
                    RowBox[{"(", 
                    RowBox[{"c", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "1"}], "]"}], "]"}], ")"}]}], ",", "y", 
                    ",", "z"}], "}"}]}]}], "]"}], ",", "a", ",", "b", ",", 
                 RowBox[{"ReplacePart", "[", 
                  RowBox[{"c", ",", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{"i", ",", "2"}], "}"}], "->", 
                    RowBox[{
                    RowBox[{"c", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "2"}], "]"}], "]"}], "-", "1"}]}]}], 
                  "]"}]}], "]"}], ",", 
               RowBox[{"Nothing", "[", "]"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", 
               RowBox[{"Length", "@", "c"}]}], "}"}]}], "]"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Entry", " ", "in", " ", "ab"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"wrapper", "[", 
         RowBox[{"ex_", ",", 
          RowBox[{"ab", "[", 
           RowBox[{"x_", ",", "y___", ",", "z_"}], "]"}], ",", "a_", ",", 
          "b_", ",", "c_"}], "]"}], ":=", 
        RowBox[{
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"#", "===", 
             RowBox[{"{", "}"}]}], ",", 
            RowBox[{"wrapper", "[", 
             RowBox[{
              RowBox[{"ex", "*", 
               RowBox[{"ab", "[", 
                RowBox[{"x", ",", "y", ",", "z"}], "]"}]}], ",", "1", ",", 
              "a", ",", "b", ",", "c"}], "]"}], ",", "#"}], "]"}], "&"}], "@", 
         RowBox[{"Join", "[", 
          RowBox[{"(*", 
           RowBox[{"Last", " ", "ab", " ", "with", " ", "first", " ", "aa"}], 
           "*)"}], 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"a", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "1", ",", "1"}], "]"}], "]"}], "===", 
                "z"}], ",", 
               RowBox[{"wrapper", "[", 
                RowBox[{"ex", ",", 
                 RowBox[{"aa", "[", 
                  RowBox[{"x", ",", "y", ",", 
                   RowBox[{"Sequence", "@@", 
                    RowBox[{"(", 
                    RowBox[{"a", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "1"}], "]"}], "]"}], ")"}]}]}], "]"}], 
                 ",", 
                 RowBox[{"ReplacePart", "[", 
                  RowBox[{"a", ",", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{"i", ",", "2"}], "}"}], "->", 
                    RowBox[{
                    RowBox[{"a", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "2"}], "]"}], "]"}], "-", "1"}]}]}], 
                  "]"}], ",", "b", ",", "c"}], "]"}], ",", 
               RowBox[{"Nothing", "[", "]"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", 
               RowBox[{"Length", "@", "a"}]}], "}"}]}], "]"}], ",", 
           RowBox[{"(*", 
            RowBox[{"Last", " ", "ab", " ", "with", " ", "last", " ", "aa"}], 
            "*)"}], 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"a", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "1", ",", 
                   RowBox[{"-", "1"}]}], "]"}], "]"}], "===", "z"}], ",", 
               RowBox[{"wrapper", "[", 
                RowBox[{
                 RowBox[{"-", "ex"}], ",", 
                 RowBox[{"aa", "[", 
                  RowBox[{"x", ",", "y", ",", 
                   RowBox[{"Sequence", "@@", 
                    RowBox[{"Reverse", "@", 
                    RowBox[{"(", 
                    RowBox[{"a", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "1"}], "]"}], "]"}], ")"}]}]}]}], "]"}],
                  ",", 
                 RowBox[{"ReplacePart", "[", 
                  RowBox[{"a", ",", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{"i", ",", "2"}], "}"}], "->", 
                    RowBox[{
                    RowBox[{"a", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "2"}], "]"}], "]"}], "-", "1"}]}]}], 
                  "]"}], ",", "b", ",", "c"}], "]"}], ",", 
               RowBox[{"Nothing", "[", "]"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", 
               RowBox[{"Length", "@", "a"}]}], "}"}]}], "]"}], ",", 
           RowBox[{"(*", 
            RowBox[{"First", " ", "ab", " ", "with", " ", "last", " ", "bb"}],
             "*)"}], 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"c", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "1", ",", 
                   RowBox[{"-", "1"}]}], "]"}], "]"}], "===", "x"}], ",", 
               RowBox[{"wrapper", "[", 
                RowBox[{"ex", ",", 
                 RowBox[{"bb", "[", 
                  RowBox[{
                   RowBox[{"Sequence", "@@", 
                    RowBox[{"(", 
                    RowBox[{"c", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "1"}], "]"}], "]"}], ")"}]}], ",", "y", 
                   ",", "z"}], "]"}], ",", "a", ",", "b", ",", 
                 RowBox[{"ReplacePart", "[", 
                  RowBox[{"c", ",", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{"i", ",", "2"}], "}"}], "->", 
                    RowBox[{
                    RowBox[{"c", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "2"}], "]"}], "]"}], "-", "1"}]}]}], 
                  "]"}]}], "]"}], ",", 
               RowBox[{"Nothing", "[", "]"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", 
               RowBox[{"Length", "@", "c"}]}], "}"}]}], "]"}], ",", 
           RowBox[{"(*", 
            RowBox[{
            "First", " ", "ab", " ", "with", " ", "first", " ", "bb"}], 
            "*)"}], 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"c", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "1", ",", "1"}], "]"}], "]"}], "===", 
                "x"}], ",", 
               RowBox[{"wrapper", "[", 
                RowBox[{
                 RowBox[{"-", "ex"}], ",", 
                 RowBox[{"bb", "[", 
                  RowBox[{
                   RowBox[{"Sequence", "@@", 
                    RowBox[{"Reverse", "@", 
                    RowBox[{"(", 
                    RowBox[{"c", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "1"}], "]"}], "]"}], ")"}]}]}], ",", 
                   "y", ",", "z"}], "]"}], ",", "a", ",", "b", ",", 
                 RowBox[{"ReplacePart", "[", 
                  RowBox[{"c", ",", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{"i", ",", "2"}], "}"}], "->", 
                    RowBox[{
                    RowBox[{"c", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "2"}], "]"}], "]"}], "-", "1"}]}]}], 
                  "]"}]}], "]"}], ",", 
               RowBox[{"Nothing", "[", "]"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", 
               RowBox[{"Length", "@", "c"}]}], "}"}]}], "]"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"Entry", " ", "in", " ", 
          RowBox[{"bb", ".", " ", "We"}], " ", "simply", " ", "plug", " ", 
          "it", " ", "back", " ", "into", " ", "the", " ", "bb", " ", "list", 
          " ", "and", " ", "restart"}], ",", " ", 
         RowBox[{
         "so", " ", "we", " ", "recycle", " ", "definitions", " ", "of", " ", 
          "aa", " ", "and", " ", "ab", " ", "above"}]}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"wrapper", "[", 
         RowBox[{"ex_", ",", 
          RowBox[{"bb", "[", "x__", "]"}], ",", "a_", ",", "b_", ",", "c_"}], 
         "]"}], ":=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"tmp", "=", 
             RowBox[{"Flatten", "[", 
              RowBox[{"Position", "[", 
               RowBox[{"c", ",", 
                RowBox[{"bb", "[", "x", "]"}]}], "]"}], "]"}]}], ")"}], "===", 
           RowBox[{"{", "}"}]}], ",", 
          RowBox[{"wrapper", "[", 
           RowBox[{"ex", ",", "1", ",", "a", ",", "b", ",", 
            RowBox[{"Append", "[", 
             RowBox[{"c", ",", 
              RowBox[{"mult", "[", 
               RowBox[{
                RowBox[{"bb", "[", "x", "]"}], ",", "1"}], "]"}]}], "]"}]}], 
           "]"}], ",", 
          RowBox[{"wrapper", "[", 
           RowBox[{"ex", ",", "1", ",", "a", ",", "b", ",", 
            RowBox[{"ReplacePart", "[", 
             RowBox[{"c", ",", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"First", "@", "tmp"}], ",", "2"}], "}"}], "->", 
               RowBox[{
                RowBox[{"c", "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{"First", "@", "tmp"}], ",", "2"}], "]"}], "]"}], 
                "+", "1"}]}]}], "]"}]}], "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Finally", ",", " ", 
         RowBox[{
         "invwrapper", " ", "flattens", " ", "out", " ", "the", " ", "nested",
           " ", "lists", " ", "and", " ", "returns", " ", "the", " ", "one", 
          " ", "which", " ", "best", " ", "fits", " ", "the", " ", 
          "selection", " ", "criterion"}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Switch", "[", 
        RowBox[{
         RowBox[{"OptionValue", "[", "ChainSelection", "]"}], ",", 
         "\[IndentingNewLine]", "\"\<RandomChain\>\"", ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"invwrapper", "[", "x_List", "]"}], ":=", 
          RowBox[{"First", "@", 
           RowBox[{"Flatten", "[", "x", "]"}]}]}], ",", 
         "\[IndentingNewLine]", "\"\<LongestChain\>\"", ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"invwrapper", "[", "x_List", "]"}], ":=", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"First", "@", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"FirstPosition", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"Min", "@", "#"}]}], "]"}], "&"}], "@", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Total", "@", 
                    RowBox[{"Cases", "[", 
                    RowBox[{
                    RowBox[{"{", "#", "}"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"aa", "[", "y__", "]"}], "|", 
                    RowBox[{"bb", "[", "y__", "]"}], "|", 
                    RowBox[{"ab", "[", "y__", "]"}]}], "/;", 
                    RowBox[{
                    RowBox[{"Length", "@", 
                    RowBox[{"{", "y", "}"}]}], ">", "2"}]}], ":>", 
                    RowBox[{"Length", "@", 
                    RowBox[{"{", "y", "}"}]}]}], ",", "\[Infinity]"}], 
                    "]"}]}], "&"}], "/@", "#"}], ")"}]}], "&"}], "@", "#"}], 
                ")"}]}], "]"}], "]"}], "&"}], "@", 
           RowBox[{"Flatten", "[", "x", "]"}]}]}], ",", 
         "\[IndentingNewLine]", "\"\<ShortestChain\>\"", ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"invwrapper", "[", "x_List", "]"}], ":=", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"First", "@", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"FirstPosition", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"Max", "@", "#"}]}], "]"}], "&"}], "@", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Total", "@", 
                    RowBox[{"Cases", "[", 
                    RowBox[{
                    RowBox[{"{", "#", "}"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"aa", "[", "y__", "]"}], "|", 
                    RowBox[{"bb", "[", "y__", "]"}], "|", 
                    RowBox[{"ab", "[", "y__", "]"}]}], "/;", 
                    RowBox[{
                    RowBox[{"Length", "@", 
                    RowBox[{"{", "y", "}"}]}], ">", "2"}]}], ":>", 
                    RowBox[{"Length", "@", 
                    RowBox[{"{", "y", "}"}]}]}], ",", "\[Infinity]"}], 
                    "]"}]}], "&"}], "/@", "#"}], ")"}]}], "&"}], "@", "#"}], 
                ")"}]}], "]"}], "]"}], "&"}], "@", 
           RowBox[{"Flatten", "[", "x", "]"}]}]}], ",", 
         "\[IndentingNewLine]", "\"\<MostTraces\>\"", ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"invwrapper", "[", "x_List", "]"}], ":=", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"First", "@", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"FirstPosition", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"Max", "@", "#"}], ",", 
                    RowBox[{"{", "1", "}"}]}], "]"}], "&"}], "@", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Count", "[", 
                    RowBox[{
                    RowBox[{"{", "#", "}"}], ",", 
                    RowBox[{"ab", "[", 
                    RowBox[{"y_", ",", "z__", ",", "y_"}], "]"}], ",", 
                    "\[Infinity]"}], "]"}], "&"}], "/@", "#"}], ")"}]}], 
                  "&"}], "@", "#"}], ")"}]}], "]"}], "]"}], "&"}], "@", 
           RowBox[{"Flatten", "[", "x", "]"}]}]}]}], "\[IndentingNewLine]", 
        "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"local", "=", "local"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"Reconvert", " ", "the", " ", "aa"}], ",", "ab", ",", 
         RowBox[{
         "bb", " ", "to", " ", "the", " ", "spinor", " ", "objects"}]}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Clear", "[", 
        RowBox[{
        "SpinorAngleBracket", ",", "SpinorSquareBracket", ",", "Chain"}], 
        "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"aa", "[", "x__", "]"}], ":=", 
        RowBox[{"Chain", "[", 
         RowBox[{"$angle", ",", 
          RowBox[{"First", "@", 
           RowBox[{"{", "x", "}"}]}], ",", 
          RowBox[{"Most", "@", 
           RowBox[{"Rest", "@", 
            RowBox[{"{", "x", "}"}]}]}], ",", 
          RowBox[{"Last", "@", 
           RowBox[{"{", "x", "}"}]}], ",", "$angle"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"ab", "[", "x__", "]"}], ":=", 
        RowBox[{"Chain", "[", 
         RowBox[{"$angle", ",", 
          RowBox[{"First", "@", 
           RowBox[{"{", "x", "}"}]}], ",", 
          RowBox[{"Most", "@", 
           RowBox[{"Rest", "@", 
            RowBox[{"{", "x", "}"}]}]}], ",", 
          RowBox[{"Last", "@", 
           RowBox[{"{", "x", "}"}]}], ",", "$square"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"bb", "[", "x__", "]"}], ":=", 
        RowBox[{"Chain", "[", 
         RowBox[{"$square", ",", 
          RowBox[{"First", "@", 
           RowBox[{"{", "x", "}"}]}], ",", 
          RowBox[{"Most", "@", 
           RowBox[{"Rest", "@", 
            RowBox[{"{", "x", "}"}]}]}], ",", 
          RowBox[{"Last", "@", 
           RowBox[{"{", "x", "}"}]}], ",", "$square"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Chain", "[", 
         RowBox[{"$angle", ",", "x_", ",", 
          RowBox[{"{", "}"}], ",", "y_", ",", "$angle"}], "]"}], ":=", 
        RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{"x", ",", "y"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Chain", "[", 
         RowBox[{"$square", ",", "x_", ",", 
          RowBox[{"{", "}"}], ",", "y_", ",", "$square"}], "]"}], ":=", 
        RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{"x", ",", "y"}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Return", " ", "the", " ", "function"}], "*)"}], 
       "\[IndentingNewLine]", "local"}]}], "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"End", " ", "of", " ", "Block"}], "*)"}], "\[IndentingNewLine]",
      "]"}]}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"End", " ", "of", " ", "Module"}], "*)"}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.8462456814201593`*^9, 3.846245825156507*^9}, {
   3.84624588041416*^9, 3.846246059525483*^9}, {3.846246159961267*^9, 
   3.846246506356346*^9}, {3.8462465588496513`*^9, 3.846246776938932*^9}, {
   3.8462468211574593`*^9, 3.846246821357975*^9}, {3.8462469009381323`*^9, 
   3.846247006582032*^9}, {3.846247070132245*^9, 3.846247149644244*^9}, {
   3.846247374359428*^9, 3.8462474663508*^9}, {3.8462475097111187`*^9, 
   3.846247529989496*^9}, 3.846247663407776*^9, {3.846247846840952*^9, 
   3.8462478514860983`*^9}, {3.846247998536194*^9, 3.8462482085672503`*^9}, {
   3.8462483680399227`*^9, 3.8462486484817333`*^9}, {3.8462487027049007`*^9, 
   3.846248724368257*^9}, {3.846248797143999*^9, 3.846248816218581*^9}, {
   3.8462488954114532`*^9, 3.846249049858389*^9}, {3.846249189482415*^9, 
   3.8462493254442596`*^9}, {3.846249385925198*^9, 3.846249487653274*^9}, {
   3.846249544221499*^9, 3.846249546222382*^9}, {3.846249589856963*^9, 
   3.84624967719884*^9}, {3.8462502101602983`*^9, 3.8462502823829317`*^9}, {
   3.8466736897255898`*^9, 3.8466737132423563`*^9}, {3.846673787513953*^9, 
   3.8466738715461493`*^9}, {3.846673957521954*^9, 3.846673984547014*^9}, {
   3.846674145495881*^9, 3.8466742128864717`*^9}, {3.846674595008449*^9, 
   3.846674630136456*^9}, {3.846674694990931*^9, 3.8466747000636473`*^9}, {
   3.8466747961635733`*^9, 3.846674953065852*^9}, {3.8466749914594097`*^9, 
   3.846675024454584*^9}, {3.846675202987584*^9, 3.846675218898118*^9}, {
   3.846675252620487*^9, 3.8466753463304377`*^9}, {3.846675554571374*^9, 
   3.846675660387985*^9}, {3.8466757145470448`*^9, 3.846675822132268*^9}, {
   3.846676264327422*^9, 3.846676282809916*^9}, {3.846676318013103*^9, 
   3.8466763538782*^9}, 3.8466764126300097`*^9, {3.846676467765717*^9, 
   3.846676558822207*^9}, {3.846676738181177*^9, 3.846676742607403*^9}, {
   3.846676775079438*^9, 3.84667680190305*^9}, {3.846676877605699*^9, 
   3.846677019256134*^9}, {3.846677833092266*^9, 3.846677955482648*^9}, {
   3.846678266914877*^9, 3.8466783138718147`*^9}, {3.846678423487372*^9, 
   3.8466785489015512`*^9}, {3.846678590086501*^9, 3.846678590240883*^9}, {
   3.846737994247161*^9, 3.846738004503858*^9}, {3.84673803926145*^9, 
   3.846738043581056*^9}, {3.846738075204897*^9, 3.8467380767987223`*^9}, {
   3.846738324485396*^9, 3.846738363902405*^9}, {3.846738549976481*^9, 
   3.8467386234799957`*^9}, {3.8467386620800943`*^9, 
   3.8467386667625303`*^9}, {3.846738707330525*^9, 3.846738709144993*^9}, {
   3.8467387719995604`*^9, 3.846738802416275*^9}, {3.846738865026211*^9, 
   3.8467388941297913`*^9}, {3.8467390345762873`*^9, 3.846739145036749*^9}, {
   3.846739185086565*^9, 3.8467393313401337`*^9}, {3.846739689354558*^9, 
   3.846739694756753*^9}, {3.8467400608109426`*^9, 3.846740223107369*^9}, {
   3.846740311305922*^9, 3.8467403137190647`*^9}, {3.84674042257513*^9, 
   3.8467404287644377`*^9}, {3.84674073988706*^9, 3.8467408609842367`*^9}, {
   3.846740898995308*^9, 3.846740902645625*^9}, {3.846741092330057*^9, 
   3.846741223363451*^9}, {3.846741273401784*^9, 3.8467413019477367`*^9}, {
   3.846741527121957*^9, 3.846741527308371*^9}, {3.8467415957943*^9, 
   3.846741645888163*^9}, {3.846741748890009*^9, 3.846741839195334*^9}, {
   3.846741884019949*^9, 3.846741998114798*^9}, {3.846742063810554*^9, 
   3.84674210675229*^9}, {3.846742137695187*^9, 3.846742187767593*^9}, {
   3.846742227202767*^9, 3.846742311862904*^9}, {3.846742434968604*^9, 
   3.8467426301567087`*^9}, {3.846742696026381*^9, 3.846742750778027*^9}, {
   3.846742802984507*^9, 3.8467428167728453`*^9}, {3.846742890066197*^9, 
   3.8467428911290913`*^9}, {3.846743039834488*^9, 3.846743042779208*^9}, {
   3.8467430826284523`*^9, 3.846743096066346*^9}, {3.846743232096546*^9, 
   3.846743308351609*^9}, {3.846743430005843*^9, 3.846743466618582*^9}, {
   3.846743674642068*^9, 3.8467439478485317`*^9}, {3.846757292491746*^9, 
   3.846757362945348*^9}, {3.8467574294782124`*^9, 3.846757433996887*^9}, {
   3.846757480935882*^9, 3.846757586611937*^9}, {3.846757629917018*^9, 
   3.84675769313622*^9}, {3.846757896979762*^9, 3.846757910077166*^9}, {
   3.846757965876402*^9, 3.846757967126268*^9}, {3.8467580074662857`*^9, 
   3.846758042493403*^9}, {3.8467580851447906`*^9, 3.8467581652888947`*^9}, {
   3.846758283695571*^9, 3.84675830859065*^9}, {3.846759052744413*^9, 
   3.846759201902575*^9}, {3.846759265432683*^9, 3.846759303972077*^9}, {
   3.8467594306671467`*^9, 3.84675944312948*^9}, {3.846759498593891*^9, 
   3.846759580771838*^9}, {3.8467599206609*^9, 3.8467599409392433`*^9}, {
   3.846760047365443*^9, 3.846760301481989*^9}, {3.846760368724524*^9, 
   3.8467603697920437`*^9}, {3.846760465752306*^9, 3.846760595583912*^9}, {
   3.8467606912704678`*^9, 3.846760722904125*^9}, 3.846760861779859*^9, {
   3.84676100367754*^9, 3.846761016091728*^9}, 3.846761054791007*^9, {
   3.8467610993331614`*^9, 3.846761204795373*^9}, {3.8467621585850983`*^9, 
   3.8467621739066877`*^9}, {3.8467622043042917`*^9, 3.846762231589814*^9}, {
   3.8467622809649477`*^9, 3.8467622811161346`*^9}, {3.846762324145405*^9, 
   3.846762333115369*^9}, {3.846762365576317*^9, 3.8467623868763437`*^9}, {
   3.846762459295772*^9, 3.8467624617875357`*^9}, {3.846762521784429*^9, 
   3.846762597208755*^9}, {3.8467626638329163`*^9, 3.846762668357471*^9}, {
   3.846762699030611*^9, 3.846762766300453*^9}, {3.8467628086148767`*^9, 
   3.846762915664832*^9}, {3.8467629542789803`*^9, 3.8467629716963253`*^9}, {
   3.8467636497787333`*^9, 3.846763747430653*^9}, {3.8467637844501762`*^9, 
   3.846763840813588*^9}, {3.8467640227083673`*^9, 3.846764034083832*^9}, {
   3.8467641150131683`*^9, 3.846764130892407*^9}, {3.846764170043755*^9, 
   3.846764210445216*^9}, {3.846764352256002*^9, 3.8467644553780937`*^9}, {
   3.84676448592337*^9, 3.8467645298310833`*^9}, {3.846764579838427*^9, 
   3.846764580306511*^9}, {3.84676461410935*^9, 3.846764713165456*^9}, {
   3.846764786233068*^9, 3.846764788258381*^9}},
 CellLabel->
  "In[270]:=",ExpressionUUID->"a02e73ac-140b-4e5c-872a-94d8143d2c7a"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"7", "*", "z", "*", 
   TemplateBox[{"1", "2"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], 
   TemplateBox[{"2", "3"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], 
   TemplateBox[{"3", "4"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], 
   TemplateBox[{"3", "5"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], 
   RowBox[{
    TemplateBox[{"5", "6"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "^", "3"}], 
   RowBox[{
    TemplateBox[{"7", 
      RowBox[{"{", "8", "}"}], "9"},
     "AngleSquareChain",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
     InterpretationFunction->(
      RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
        "$square", "]"}]& )], "/", 
    RowBox[{"(", 
     RowBox[{
      TemplateBox[{"p1", "p2"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], 
      RowBox[{
       TemplateBox[{"p2", "p3"},
        "SpinorSquareBracket",
        DisplayFunction->(RowBox[{"[", 
           RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
        InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
           RowBox[{#, ",", #2}], "]"}]& )], "^", "2"}]}], ")"}]}]}], "//", 
  RowBox[{
   RowBox[{"PreChain", "[", 
    RowBox[{"#", ",", 
     RowBox[{"ChainSelection", "->", "\"\<MostTraces\>\""}]}], "]"}], 
   "&"}]}]], "Input",
 CellChangeTimes->{{3.846242173509924*^9, 3.846242231112877*^9}, {
  3.846246116586875*^9, 3.846246150278006*^9}, {3.8462461817347727`*^9, 
  3.846246182158164*^9}, {3.846246578013474*^9, 3.846246578378786*^9}, {
  3.846247680110651*^9, 3.846247683789065*^9}, {3.8467594054913588`*^9, 
  3.846759412790703*^9}, {3.846763755846171*^9, 3.846763771621814*^9}, {
  3.846763900428853*^9, 3.8467639009081163`*^9}, {3.846764623539383*^9, 
  3.8467646252074957`*^9}, {3.846764797374366*^9, 3.846764799567657*^9}},
 CellLabel->
  "In[271]:=",ExpressionUUID->"68ac1932-0c81-4c3c-86e0-a3f493c530b1"],

Cell[BoxData[
 FractionBox[
  RowBox[{"7", " ", "z", " ", 
   TemplateBox[{"1", 
     RowBox[{"{", 
       RowBox[{"2", ",", "3"}], "}"}], "4"},
    "AngleAngleChain",
    DisplayFunction->(
     RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle", 
       "]"}]& )], " ", 
   TemplateBox[{"3", 
     RowBox[{"{", "5", "}"}], "6"},
    "AngleSquareChain",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square",
        "]"}]& )], " ", 
   TemplateBox[{"7", 
     RowBox[{"{", "8", "}"}], "9"},
    "AngleSquareChain",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square",
        "]"}]& )], " ", 
   SuperscriptBox[
    TemplateBox[{"5", "6"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "2"]}], 
  RowBox[{
   TemplateBox[{"p1", 
     RowBox[{"{", "p2", "}"}], "p3"},
    "AngleSquareChain",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square",
        "]"}]& )], " ", 
   TemplateBox[{"p2", "p3"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}]]], "Output",
 CellChangeTimes->{
  3.84624611997372*^9, 3.846246151308091*^9, 3.846246183552204*^9, 
   3.846246235365589*^9, 3.846246376832349*^9, {3.846246424554968*^9, 
   3.846246439031102*^9}, 3.846246471934087*^9, 3.846246579394256*^9, 
   3.846246688354754*^9, 3.8462470081212587`*^9, {3.8462470922578087`*^9, 
   3.846247121462365*^9}, {3.846247445871354*^9, 3.846247467791078*^9}, {
   3.846247668496654*^9, 3.846247685000882*^9}, {3.846248016852743*^9, 
   3.846248049962275*^9}, 3.8462484455387506`*^9, {3.846248476005752*^9, 
   3.8462484847031097`*^9}, 3.846248535328216*^9, 3.846249757710393*^9, 
   3.846667513813611*^9, 3.846673693242999*^9, 3.846674204087784*^9, {
   3.846674935957589*^9, 3.846674954745063*^9}, 3.846675030390892*^9, 
   3.846675206681568*^9, {3.8466752434827557`*^9, 3.846675291700943*^9}, 
   3.846678483068389*^9, {3.846678522601722*^9, 3.846678550403185*^9}, 
   3.8467380114278393`*^9, 3.8467380456997623`*^9, 3.846738078710441*^9, 
   3.84673862739706*^9, 3.846738669944131*^9, 3.846738940403521*^9, 
   3.846739053551709*^9, 3.8467393053039494`*^9, 3.846739336531863*^9, 
   3.846739696777441*^9, 3.846740190453413*^9, 3.8467402249021387`*^9, 
   3.846740869774839*^9, 3.8467409039996853`*^9, 3.846741537562234*^9, {
   3.8467418142038727`*^9, 3.8467418410786247`*^9}, 3.846742010400065*^9, 
   3.846742202063075*^9, 3.846742487301585*^9, 3.846742636959553*^9, {
   3.846742698989911*^9, 3.846742753065506*^9}, 3.846742821663252*^9, 
   3.8467428935453978`*^9, 3.846743044954796*^9, 3.846743099163868*^9, 
   3.8467432608507338`*^9, {3.846743291150421*^9, 3.846743310303846*^9}, 
   3.846743696569893*^9, {3.846743916768108*^9, 3.8467439498985567`*^9}, 
   3.846757593809761*^9, 3.846758312350493*^9, {3.846759384728903*^9, 
   3.8467594137807007`*^9}, 3.846759539418352*^9, 3.84676074165191*^9, 
   3.846760865426648*^9, 3.846761060071117*^9, {3.846761184868147*^9, 
   3.8467612065858727`*^9}, 3.846762175936771*^9, {3.846762206121325*^9, 
   3.846762232738701*^9}, 3.8467622830487137`*^9, 3.846762336509307*^9, 
   3.846762389967955*^9, 3.846762464782827*^9, 3.846762543120842*^9, 
   3.846762600048937*^9, {3.846762772304195*^9, 3.846762795060376*^9}, {
   3.846763772144313*^9, 3.846763842270924*^9}, 3.846763902706139*^9, 
   3.8467641383784246`*^9, {3.846764411590734*^9, 3.846764425546818*^9}, 
   3.846764459026843*^9, {3.846764500246171*^9, 3.8467645101433277`*^9}, {
   3.846764617963142*^9, 3.84676462631341*^9}, 3.8467648006477747`*^9},
 CellLabel->
  "Out[271]=",ExpressionUUID->"68c986cc-3e8b-4612-81ef-1f1c27fec809"]
}, Open  ]],

Cell[BoxData["`"], "Input",ExpressionUUID->"625859a5-044e-4e1a-ab83-a0152b3507d0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"test", "=", 
   RowBox[{"7", "*", "z", "*", 
    TemplateBox[{"1", "2"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], 
    TemplateBox[{"2", "3"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], 
    TemplateBox[{"3", "4"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], 
    TemplateBox[{"3", "5"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], 
    RowBox[{
     TemplateBox[{"5", "6"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], "^", "2"}], 
    RowBox[{
     TemplateBox[{"7", 
       RowBox[{"{", "8", "}"}], "9"},
      "AngleSquareChain",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], "/", 
     RowBox[{"(", 
      RowBox[{
       TemplateBox[{"p1", "p2"},
        "SpinorAngleBracket",
        DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
           RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
        InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
           RowBox[{#, ",", #2}], "]"}]& )], 
       RowBox[{
        TemplateBox[{"p2", "p3"},
         "SpinorSquareBracket",
         DisplayFunction->(RowBox[{"[", 
            RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
         InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
            RowBox[{#, ",", #2}], "]"}]& )], "^", "2"}]}], ")"}]}]}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.846743970308426*^9, 3.846743972693273*^9}},
 CellLabel->
  "In[203]:=",ExpressionUUID->"7e73e989-6490-4df5-905b-b391efd90356"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"Do", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"test", "^", "3"}], "//", "ToChain"}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", "1000"}], "}"}]}], "]"}], "//", 
  "AbsoluteTiming"}]], "Input",
 CellChangeTimes->{{3.846743979401436*^9, 3.84674399624229*^9}, {
  3.8467440327908*^9, 3.8467440333816767`*^9}, {3.846760882878025*^9, 
  3.8467609251739388`*^9}},
 CellLabel->
  "In[208]:=",ExpressionUUID->"2c37cfaa-3563-4344-b309-b66a416750c9"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"1.578293`", ",", "Null"}], "}"}]], "Output",
 CellChangeTimes->{
  3.84674399739345*^9, 3.846744035412333*^9, {3.846760886163323*^9, 
   3.846760927338073*^9}},
 CellLabel->
  "Out[208]=",ExpressionUUID->"33506d1e-6cb1-400a-a0b1-4d7de88dd436"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"Do", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"test", "^", "3"}], "//", "PreChain"}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", "1000"}], "}"}]}], "]"}], "//", 
  "AbsoluteTiming"}]], "Input",
 CellChangeTimes->{{3.8467440064319487`*^9, 3.8467440081034946`*^9}, {
  3.846744039308696*^9, 3.846744040548047*^9}, {3.846744117268402*^9, 
  3.846744123980432*^9}, {3.8467608939367332`*^9, 3.846760930909863*^9}},
 CellLabel->
  "In[209]:=",ExpressionUUID->"049c0084-c987-4cb4-b91f-94d2978654d9"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"3.601811`", ",", "Null"}], "}"}]], "Output",
 CellChangeTimes->{
  3.846744009235771*^9, {3.846744114703321*^9, 3.8467441488409843`*^9}, {
   3.846760895911515*^9, 3.846760935164515*^9}},
 CellLabel->
  "Out[209]=",ExpressionUUID->"646507d1-f20d-47e2-974b-7386916099fc"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "Combinatorics", " ", "of", " ", "terms", " ", "explodes", " ", "with", " ",
    "the", " ", "number", " ", "of", " ", "powers", " ", "in", " ", "each", 
   " ", "bracket"}], "*)"}]], "Input",
 CellChangeTimes->{{3.846744140018464*^9, 
  3.8467441639582148`*^9}},ExpressionUUID->"730923a7-7e32-43f8-b232-\
0f22fad87378"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"(", 
    RowBox[{"7", "*", "z", "*", 
     TemplateBox[{"1", "2"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], 
     TemplateBox[{"2", "3"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], 
     TemplateBox[{"3", "4"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], 
     TemplateBox[{"3", "5"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], 
     RowBox[{
      TemplateBox[{"5", "6"},
       "SpinorSquareBracket",
       DisplayFunction->(RowBox[{"[", 
          RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], "^", "2"}], 
     RowBox[{
      TemplateBox[{"7", 
        RowBox[{"{", "8", "}"}], "9"},
       "AngleSquareChain",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
       InterpretationFunction->(
        RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
          "$square", "]"}]& )], "/", 
      RowBox[{"(", 
       RowBox[{
        TemplateBox[{"p1", "p2"},
         "SpinorAngleBracket",
         DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
            RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
         InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
            RowBox[{#, ",", #2}], "]"}]& )], 
        RowBox[{
         TemplateBox[{"p2", "p3"},
          "SpinorSquareBracket",
          DisplayFunction->(RowBox[{"[", 
             RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
          InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
             RowBox[{#, ",", #2}], "]"}]& )], "^", "2"}]}], ")"}]}]}], ")"}], 
   "^", "3"}], "//", "PreChain"}]], "Input",
 CellChangeTimes->{{3.846760953438199*^9, 3.84676095793447*^9}},
 CellLabel->
  "In[210]:=",ExpressionUUID->"2446e460-e370-4a2e-bfb3-0fd53f148491"],

Cell[BoxData[
 FractionBox[
  RowBox[{"343", " ", 
   SuperscriptBox["z", "3"], " ", 
   SuperscriptBox[
    TemplateBox[{"1", 
      RowBox[{"{", 
        RowBox[{"2", ",", "3"}], "}"}], "4"},
     "AngleAngleChain",
     DisplayFunction->(
      RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(
      RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle",
         "]"}]& )], "3"], " ", 
   SuperscriptBox[
    TemplateBox[{"3", 
      RowBox[{"{", "5", "}"}], "6"},
     "AngleSquareChain",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
     InterpretationFunction->(
      RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
        "$square", "]"}]& )], "3"], " ", 
   SuperscriptBox[
    TemplateBox[{"7", 
      RowBox[{"{", "8", "}"}], "9"},
     "AngleSquareChain",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
     InterpretationFunction->(
      RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
        "$square", "]"}]& )], "3"], " ", 
   SuperscriptBox[
    TemplateBox[{"5", "6"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "3"]}], 
  RowBox[{
   SuperscriptBox[
    TemplateBox[{"p1", 
      RowBox[{"{", "p2", "}"}], "p3"},
     "AngleSquareChain",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
     InterpretationFunction->(
      RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
        "$square", "]"}]& )], "3"], " ", 
   SuperscriptBox[
    TemplateBox[{"p2", "p3"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "3"]}]]], "Output",
 CellChangeTimes->{3.8467609586193542`*^9},
 CellLabel->
  "Out[210]=",ExpressionUUID->"6841052b-9405-4ce6-98c1-76fffa98f50c"]
}, Open  ]]
}, Open  ]]
},
WindowSize->{759., 605.4},
WindowMargins->{{107.4, Automatic}, {0, Automatic}},
InputAliases->Association["intt" -> RowBox[{"\[Integral]", 
     RowBox[{"\[SelectionPlaceholder]", 
       RowBox[{"\[DifferentialD]", "\[Placeholder]"}]}]}], "dintt" -> 
  RowBox[{
     SubsuperscriptBox[
     "\[Integral]", "\[SelectionPlaceholder]", "\[Placeholder]"], 
     RowBox[{"\[Placeholder]", 
       RowBox[{"\[DifferentialD]", "\[Placeholder]"}]}]}], "rintt" -> 
  RowBox[{
     UnderscriptBox["\[Integral]", 
      RowBox[{"\[SelectionPlaceholder]", "\[Element]", "\[Placeholder]"}]], 
     "\[Placeholder]"}], "sumt" -> RowBox[{
     UnderoverscriptBox["\[Sum]", 
      RowBox[{"\[SelectionPlaceholder]", "=", "\[Placeholder]"}], 
      "\[Placeholder]"], "\[Placeholder]"}], "prodt" -> RowBox[{
     UnderoverscriptBox["\[Product]", 
      RowBox[{"\[SelectionPlaceholder]", "=", "\[Placeholder]"}], 
      "\[Placeholder]"], "\[Placeholder]"}], "dt" -> RowBox[{
     SubscriptBox["\[PartialD]", "\[SelectionPlaceholder]"], 
     "\[Placeholder]"}], "cbrt" -> 
  RadicalBox[
   "\[SelectionPlaceholder]", "3", SurdForm -> True, MultilineFunction -> 
    None], "surd" -> 
  RadicalBox[
   "\[SelectionPlaceholder]", "\[Placeholder]", SurdForm -> True, 
    MultilineFunction -> None], "ket" -> 
  TemplateBox[{"\[SelectionPlaceholder]"}, "Ket"], "bra" -> 
  TemplateBox[{"\[SelectionPlaceholder]"}, "Bra"], "braket" -> 
  TemplateBox[{"\[SelectionPlaceholder]", "\[Placeholder]"}, "BraKet"], 
  "delay" -> TemplateBox[{"\[SelectionPlaceholder]"}, "SystemsModelDelay"], 
  "grad" -> RowBox[{
     SubscriptBox["\[Del]", "\[SelectionPlaceholder]"], "\[Placeholder]"}], 
  "del." -> RowBox[{
     SubscriptBox["\[Del]", "\[SelectionPlaceholder]"], ".", 
     "\[Placeholder]"}], "delx" -> RowBox[{
     SubscriptBox["\[Del]", "\[SelectionPlaceholder]"], "\[Cross]", 
     "\[Placeholder]"}], "del2" -> RowBox[{
     SubsuperscriptBox["\[Del]", "\[SelectionPlaceholder]", 2], 
     "\[Placeholder]"}], "kd" -> 
  TemplateBox[{"\[SelectionPlaceholder]"}, "KroneckerDeltaSeq"], "algs" -> 
  TemplateBox[{}, "Algebraics"], "bools" -> TemplateBox[{}, "Booleans"], 
  "comps" -> TemplateBox[{}, "Complexes"], "ints" -> 
  TemplateBox[{}, "Integers"], "pris" -> TemplateBox[{}, "Primes"], "rats" -> 
  TemplateBox[{}, "Rationals"], "reals" -> TemplateBox[{}, "Reals"], "pints" -> 
  TemplateBox[{}, "PositiveIntegers"], "npints" -> 
  TemplateBox[{}, "NonPositiveIntegers"], "nnints" -> 
  TemplateBox[{}, "NonNegativeIntegers"], "nints" -> 
  TemplateBox[{}, "NegativeIntegers"], "prats" -> 
  TemplateBox[{}, "PositiveRationals"], "nprats" -> 
  TemplateBox[{}, "NonPositiveRationals"], "nnrats" -> 
  TemplateBox[{}, "NonNegativeRationals"], "nrats" -> 
  TemplateBox[{}, "NegativeRationals"], "preals" -> 
  TemplateBox[{}, "PositiveReals"], "npreals" -> 
  TemplateBox[{}, "NonPositiveReals"], "nnreals" -> 
  TemplateBox[{}, "NonNegativeReals"], "nreals" -> 
  TemplateBox[{}, "NegativeReals"], "dlim" -> RowBox[{
     UnderscriptBox["\[Limit]", 
      RowBox[{"\[SelectionPlaceholder]", 
        UnderscriptBox["\[Rule]", 
         TemplateBox[{}, "Integers"]], "\[Infinity]"}]], "\[Placeholder]"}], 
  "dMlim" -> RowBox[{
     UnderscriptBox["\[MaxLimit]", 
      RowBox[{"\[SelectionPlaceholder]", 
        UnderscriptBox["\[Rule]", 
         TemplateBox[{}, "Integers"]], "\[Infinity]"}]], "\[Placeholder]"}], 
  "dmlim" -> RowBox[{
     UnderscriptBox["\[MinLimit]", 
      RowBox[{"\[SelectionPlaceholder]", 
        UnderscriptBox["\[Rule]", 
         TemplateBox[{}, "Integers"]], "\[Infinity]"}]], "\[Placeholder]"}], 
  "tue" -> OverscriptBox["\[UndirectedEdge]", "\[Placeholder]"], "tde" -> 
  OverscriptBox["\[DirectedEdge]", "\[Placeholder]"], "cB" -> 
  TemplateBox[{}, "CombinatorB"], "cC" -> TemplateBox[{}, "CombinatorC"], 
  "cI" -> TemplateBox[{}, "CombinatorI"], "cK" -> 
  TemplateBox[{}, "CombinatorK"], "cS" -> TemplateBox[{}, "CombinatorS"], 
  "cW" -> TemplateBox[{}, "CombinatorW"], "cY" -> 
  TemplateBox[{}, "CombinatorY"], "lu" -> 
  TemplateBox[{"\[SelectionPlaceholder]", "\[SelectionPlaceholder]"}, 
    "SpinorLaUp", DisplayFunction -> (RowBox[{
       SuperscriptBox["\[Lambda]", #2], "[", #, "]"}]& ), 
    InterpretationFunction -> (
     RowBox[{"SpinorUndot", "[", #, "]", "[", "$lam", "]", "[", #2, "]", "[", 
       "Null", "]"}]& )], "ld" -> 
  TemplateBox[{"\[SelectionPlaceholder]", "\[SelectionPlaceholder]"}, 
    "SpinorLaDown", DisplayFunction -> (RowBox[{
       SubscriptBox["\[Lambda]", #2], "[", #, "]"}]& ), 
    InterpretationFunction -> (
     RowBox[{"SpinorUndot", "[", #, "]", "[", "$lam", "]", "[", "Null", "]", 
       "[", #2, "]"}]& )], "muu" -> 
  TemplateBox[{"\[SelectionPlaceholder]", "\[SelectionPlaceholder]"}, 
    "SpinorMuUp", DisplayFunction -> (RowBox[{
       SuperscriptBox["\[Mu]", #2], "[", #, "]"}]& ), 
    InterpretationFunction -> (
     RowBox[{"SpinorUndot", "[", #, "]", "[", "$mu", "]", "[", #2, "]", "[", 
       "Null", "]"}]& )], "mud" -> 
  TemplateBox[{"\[SelectionPlaceholder]", "\[SelectionPlaceholder]"}, 
    "SpinorMuDown", DisplayFunction -> (RowBox[{
       SubscriptBox["\[Mu]", #2], "[", #, "]"}]& ), 
    InterpretationFunction -> (
     RowBox[{"SpinorUndot", "[", #, "]", "[", "$mu", "]", "[", "Null", "]", 
       "[", #2, "]"}]& )], "lp" -> 
  TemplateBox[{"\[SelectionPlaceholder]"}, "SpinorUndotBareL", 
    DisplayFunction -> (RowBox[{"\[Lambda]", "[", #, "]"}]& ), 
    InterpretationFunction -> (
     RowBox[{"SpinorUndotBare", "[", #, "]", "[", "$lam", "]"}]& )], "mp" -> 
  TemplateBox[{"\[SelectionPlaceholder]"}, "SpinorUndotBareM", 
    DisplayFunction -> (RowBox[{"\[Mu]", "[", #, "]"}]& ), 
    InterpretationFunction -> (
     RowBox[{"SpinorUndotBare", "[", #, "]", "[", "$mu", "]"}]& )], "ltu" -> 
  TemplateBox[{"\[SelectionPlaceholder]", "\[SelectionPlaceholder]"}, 
    "SpinorLatUp", DisplayFunction -> (RowBox[{
       SuperscriptBox[
        OverscriptBox["\[Lambda]", "~"], #2], "[", #, "]"}]& ), 
    InterpretationFunction -> (
     RowBox[{"SpinorDot", "[", #, "]", "[", "$lam", "]", "[", #2, "]", "[", 
       "Null", "]"}]& )], "ltd" -> 
  TemplateBox[{"\[SelectionPlaceholder]", "\[SelectionPlaceholder]"}, 
    "SpinorLatDown", DisplayFunction -> (RowBox[{
       SubscriptBox[
        OverscriptBox["\[Lambda]", "~"], #2], "[", #, "]"}]& ), 
    InterpretationFunction -> (
     RowBox[{"SpinorDot", "[", #, "]", "[", "$lam", "]", "[", "Null", "]", 
       "[", #2, "]"}]& )], "mtu" -> 
  TemplateBox[{"\[SelectionPlaceholder]", "\[SelectionPlaceholder]"}, 
    "SpinorMutUp", DisplayFunction -> (RowBox[{
       SuperscriptBox[
        OverscriptBox["\[Mu]", "~"], #2], "[", #, "]"}]& ), 
    InterpretationFunction -> (
     RowBox[{"SpinorDot", "[", #, "]", "[", "$mu", "]", "[", #2, "]", "[", 
       "Null", "]"}]& )], "mtd" -> 
  TemplateBox[{"\[SelectionPlaceholder]", "\[SelectionPlaceholder]"}, 
    "SpinorMutDown", DisplayFunction -> (RowBox[{
       SubscriptBox[
        OverscriptBox["\[Mu]", "~"], #2], "[", #, "]"}]& ), 
    InterpretationFunction -> (
     RowBox[{"SpinorDot", "[", #, "]", "[", "$mu", "]", "[", "Null", "]", 
       "[", #2, "]"}]& )], "ltp" -> 
  TemplateBox[{"\[SelectionPlaceholder]"}, "SpinorDotBareL", 
    DisplayFunction -> (RowBox[{
       OverscriptBox["\[Lambda]", "~"], "[", #, "]"}]& ), 
    InterpretationFunction -> (
     RowBox[{"SpinorDotBare", "[", #, "]", "[", "$lam", "]"}]& )], "mtp" -> 
  TemplateBox[{"\[SelectionPlaceholder]"}, "SpinorDotBareM", 
    DisplayFunction -> (RowBox[{
       OverscriptBox["\[Mu]", "~"], "[", #, "]"}]& ), 
    InterpretationFunction -> (
     RowBox[{"SpinorDotBare", "[", #, "]", "[", "$mu", "]"}]& )], "ab" -> 
  TemplateBox[{"\[SelectionPlaceholder]", "\[Placeholder]"}, 
    "SpinorAngleBracket", DisplayFunction -> (RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ), 
    InterpretationFunction -> (RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], "sb" -> 
  TemplateBox[{"\[SelectionPlaceholder]", "\[Placeholder]"}, 
    "SpinorSquareBracket", DisplayFunction -> (RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ), 
    InterpretationFunction -> (RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], "cas" -> 
  TemplateBox[{"\[SelectionPlaceholder]", 
     RowBox[{"{", "\[SelectionPlaceholder]", "}"}], 
     "\[SelectionPlaceholder]"}, "AngleSquareChain", 
    DisplayFunction -> (RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ), 
    InterpretationFunction -> (
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square",
        "]"}]& )], "csa" -> TemplateBox[{"\[SelectionPlaceholder]", 
     RowBox[{"{", "\[SelectionPlaceholder]", "}"}], 
     "\[SelectionPlaceholder]"}, "SquareAngleChain", 
    DisplayFunction -> (RowBox[{"[", #, #2, #3, "\[RightAngleBracket]"}]& ), 
    InterpretationFunction -> (
     RowBox[{"Chain", "[", "$square", ",", #, ",", #2, ",", #3, ",", "$angle",
        "]"}]& )], "caa" -> TemplateBox[{"\[SelectionPlaceholder]", 
     RowBox[{"{", "\[SelectionPlaceholder]", "}"}], 
     "\[SelectionPlaceholder]"}, "AngleAngleChain", 
    DisplayFunction -> (
     RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ), 
    InterpretationFunction -> (
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle", 
       "]"}]& )], "css" -> TemplateBox[{"\[SelectionPlaceholder]", 
     RowBox[{"{", "\[SelectionPlaceholder]", "}"}], 
     "\[SelectionPlaceholder]"}, "SquareSquareChain", 
    DisplayFunction -> (RowBox[{"[", #, #2, #3, "]"}]& ), 
    InterpretationFunction -> (
     RowBox[{"Chain", "[", "$square", ",", #, ",", #2, ",", #3, ",", 
       "$square", "]"}]& )], "lcup" -> 
  TemplateBox[{"\[SelectionPlaceholder]", "\[SelectionPlaceholder]"}, 
    "LevicivitaSHUp", DisplayFunction -> (SuperscriptBox["\[Epsilon]", 
      RowBox[{#, #2}]]& ), 
    InterpretationFunction -> (
     RowBox[{"LeviCivitaSH", "[", #, ",", #2, "]", "[", "$up", "]"}]& )], 
  "lcd" -> TemplateBox[{"\[SelectionPlaceholder]", "\[SelectionPlaceholder]"},
     "LevicivitaSHDown", DisplayFunction -> (SubscriptBox["\[Epsilon]", 
      RowBox[{#, #2}]]& ), 
    InterpretationFunction -> (
     RowBox[{"LeviCivitaSH", "[", #, ",", #2, "]", "[", "$down", "]"}]& )]],
FrontEndVersion->"12.3 for Linux x86 (64-bit) (May 11, 2021)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"a1e96281-505b-4b40-b0ec-5da2e232b756"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 207, 3, 29, "Input",ExpressionUUID->"d6fe2690-3bb1-4185-bbe3-4aaa9884d5a0"],
Cell[CellGroupData[{
Cell[812, 29, 255, 5, 23, "Print",ExpressionUUID->"b051dbcd-5b56-46f7-85df-1c8aa6229f67"],
Cell[1070, 36, 241, 4, 23, "Print",ExpressionUUID->"1c148b9f-52be-4134-8adc-d6d4d634d1da"],
Cell[1314, 42, 231, 4, 23, "Print",ExpressionUUID->"e309b2f9-1fd1-4a78-a9a4-82369b7d1dd9"],
Cell[1548, 48, 232, 4, 23, "Print",ExpressionUUID->"170db4b4-8211-4507-89da-7de3a3fdb5ff"],
Cell[1783, 54, 240, 4, 23, "Print",ExpressionUUID->"831272e8-ac68-47f2-ada4-75bb42c3a29d"],
Cell[2026, 60, 313, 8, 25, "Print",ExpressionUUID->"9eb8dea0-c0eb-4338-948f-cf4562a610cd"],
Cell[2342, 70, 249, 4, 23, "Print",ExpressionUUID->"b5f45e9a-a006-4fb5-a6ea-eb2cc8c54c0b"]
}, Open  ]]
}, Open  ]],
Cell[2618, 78, 570, 11, 50, "Input",ExpressionUUID->"02c4f47a-3eb8-4cd8-b56e-c8533ab5fc1c"],
Cell[CellGroupData[{
Cell[3213, 93, 161, 3, 54, "Subsection",ExpressionUUID->"5cb88fc9-3da6-4eb3-8874-9a48338fb3de"],
Cell[3377, 98, 15964, 370, 1427, "Input",ExpressionUUID->"ba6287bc-50e6-419f-84d2-90f26483d92d"],
Cell[CellGroupData[{
Cell[19366, 472, 2765, 62, 29, "Input",ExpressionUUID->"ba3f9ba6-bfbe-4ccd-9234-e701af655803"],
Cell[22134, 536, 2181, 55, 74, "Output",ExpressionUUID->"d7a7aaa4-9e21-48e4-9ed1-18ef1e89ce23"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[24364, 597, 220, 4, 38, "Subsection",ExpressionUUID->"6ce3182f-5b23-4073-9124-f454d656bbcb"],
Cell[24587, 603, 34209, 783, 2541, "Input",ExpressionUUID->"a85f2d44-0fa4-45e2-b100-951bcc12a0cc"],
Cell[CellGroupData[{
Cell[58821, 1390, 2770, 63, 29, "Input",ExpressionUUID->"92931acd-c407-4adf-b3d5-357469dad063"],
Cell[61594, 1455, 2600, 56, 54, "Output",ExpressionUUID->"d6625037-8bbe-4fc5-8af8-79538087e9dc"]
}, Open  ]],
Cell[CellGroupData[{
Cell[64231, 1516, 355, 8, 29, "Input",ExpressionUUID->"a94ee9cf-19ce-4daf-8e1d-d879f660293a"],
Cell[64589, 1526, 220, 4, 33, "Output",ExpressionUUID->"d410ff37-5556-41ee-a545-713ea2c70da8"]
}, Open  ]],
Cell[CellGroupData[{
Cell[64846, 1535, 437, 11, 29, "Input",ExpressionUUID->"f8cb976b-03fb-4507-82b4-8406e83c1849"],
Cell[65286, 1548, 195, 3, 33, "Output",ExpressionUUID->"81a477e6-0c19-481d-b47b-8d2dc3ca918c"]
}, Open  ]],
Cell[CellGroupData[{
Cell[65518, 1556, 450, 12, 29, "Input",ExpressionUUID->"7b01f067-c0ac-4b49-85d7-377ea4976069"],
Cell[65971, 1570, 278, 6, 33, "Output",ExpressionUUID->"71fe96c1-3145-43df-b57d-328ea63575f1"]
}, Open  ]],
Cell[CellGroupData[{
Cell[66286, 1581, 491, 13, 29, "Input",ExpressionUUID->"2cb4e89e-20ec-4447-8380-90bd7c60b4bc"],
Cell[66780, 1596, 250, 5, 33, "Output",ExpressionUUID->"5fa58c5e-9741-4868-8064-5ae5a7d89397"]
}, Open  ]],
Cell[CellGroupData[{
Cell[67067, 1606, 332, 8, 29, "Input",ExpressionUUID->"f5c84b15-f36b-432f-a857-db008503701c"],
Cell[67402, 1616, 173, 2, 33, "Output",ExpressionUUID->"10b16e63-0701-4556-80cf-f5798bbc7930"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[67624, 1624, 371, 7, 38, "Subsection",ExpressionUUID->"e9d95bbe-a245-4546-ab91-3b551c64daa4"],
Cell[67998, 1633, 349, 9, 29, "Input",ExpressionUUID->"abe71767-4bd5-4acb-ad61-dfe1ec985742"],
Cell[68350, 1644, 36377, 829, 2784, "Input",ExpressionUUID->"d9c46fa1-22be-4264-9fda-3f0631cd3809"],
Cell[CellGroupData[{
Cell[104752, 2477, 2770, 63, 29, "Input",ExpressionUUID->"c71c2964-1f0e-459b-a3d5-2ae4ac4902d4"],
Cell[107525, 2542, 3564, 71, 51, "Output",ExpressionUUID->"eca2e6c6-ca74-4bb6-a078-203b3a2698bf"]
}, Open  ]],
Cell[111104, 2616, 2643, 61, 29, "Input",ExpressionUUID->"594a690f-3a09-4e5d-8e3f-6cb678b80b63"],
Cell[CellGroupData[{
Cell[113772, 2681, 431, 12, 29, "Input",ExpressionUUID->"757222ce-073f-4b86-8e34-60b0af19d556"],
Cell[114206, 2695, 230, 5, 33, "Output",ExpressionUUID->"7c5ba756-9c36-49da-937a-4f01786b113d"]
}, Open  ]],
Cell[CellGroupData[{
Cell[114473, 2705, 486, 13, 29, "Input",ExpressionUUID->"fdc01fda-42b3-4302-a3c2-fbe3b9063ba2"],
Cell[114962, 2720, 261, 6, 33, "Output",ExpressionUUID->"b3b442fd-6d5c-4b28-bfc5-d9a386733d8e"]
}, Open  ]],
Cell[115238, 2729, 363, 8, 50, "Input",ExpressionUUID->"fc6b4642-44e5-4721-99a5-aa7ffcccc7bb"]
}, Closed]],
Cell[CellGroupData[{
Cell[115638, 2742, 351, 5, 38, "Subsection",ExpressionUUID->"00bcdd66-eed0-4157-bed7-04ef14501218"],
Cell[115992, 2749, 392, 9, 29, "Input",ExpressionUUID->"84959906-c38f-4b6e-a23c-1015a0668f45"],
Cell[116387, 2760, 44317, 1015, 3168, "Input",ExpressionUUID->"d03a6935-ab96-4201-b6a0-67a4e93e08ce"],
Cell[CellGroupData[{
Cell[160729, 3779, 2821, 64, 29, "Input",ExpressionUUID->"59659eae-029e-498c-bd5d-ae5fc0efbef5"],
Cell[163553, 3845, 4021, 78, 74, "Output",ExpressionUUID->"ae64e6b0-b362-41a1-bdff-894b9b7fdfe1"]
}, Open  ]],
Cell[167589, 3926, 2643, 61, 29, "Input",ExpressionUUID->"8e855dc2-fa4c-4d99-a710-f6027d1532a6"],
Cell[CellGroupData[{
Cell[170257, 3991, 482, 13, 29, "Input",ExpressionUUID->"95553f6b-bcbf-41f0-adbc-b73f11d7c5b5"],
Cell[170742, 4006, 283, 7, 33, "Output",ExpressionUUID->"a2df510e-138d-4cf1-ac04-43896001a7fc"]
}, Open  ]],
Cell[CellGroupData[{
Cell[171062, 4018, 534, 13, 29, "Input",ExpressionUUID->"448e777a-ebee-4dcf-8a58-03286bb7d0e6"],
Cell[171599, 4033, 310, 7, 33, "Output",ExpressionUUID->"104c8358-9c87-4a16-b5aa-78df5a3537d4"]
}, Open  ]],
Cell[171924, 4043, 363, 8, 50, "Input",ExpressionUUID->"24aa8053-3b2a-43ba-b63c-49ec63419239"],
Cell[CellGroupData[{
Cell[172312, 4055, 2732, 62, 50, "Input",ExpressionUUID->"1eabf1d2-1c36-476b-abc9-e25d6be5db48"],
Cell[175047, 4119, 2144, 55, 54, "Output",ExpressionUUID->"760e189e-7d3e-4a6b-ae42-d3e0ced93e75"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[177240, 4180, 359, 6, 38, "Subsection",ExpressionUUID->"cc73b313-c20a-40ca-a8f5-6a296e03e20b"],
Cell[177602, 4188, 219, 4, 29, "Input",ExpressionUUID->"0f31a181-1666-4060-8076-553724c12f1b"],
Cell[CellGroupData[{
Cell[177846, 4196, 418, 10, 29, "Input",ExpressionUUID->"ce725442-8380-448d-87b9-b5c2e12f8cfe"],
Cell[178267, 4208, 238, 6, 33, "Output",ExpressionUUID->"96e5a456-6c3b-407d-9088-f9be861f9394"]
}, Open  ]],
Cell[178520, 4217, 51845, 1156, 3655, "Input",ExpressionUUID->"a02e73ac-140b-4e5c-872a-94d8143d2c7a"],
Cell[CellGroupData[{
Cell[230390, 5377, 3145, 70, 50, "Input",ExpressionUUID->"68ac1932-0c81-4c3c-86e0-a3f493c530b1"],
Cell[233538, 5449, 4391, 83, 76, "Output",ExpressionUUID->"68c986cc-3e8b-4612-81ef-1f1c27fec809"]
}, Open  ]],
Cell[237944, 5535, 82, 0, 29, "Input",ExpressionUUID->"625859a5-044e-4e1a-ab83-a0152b3507d0"],
Cell[238029, 5537, 2643, 61, 29, "Input",ExpressionUUID->"7e73e989-6490-4df5-905b-b391efd90356"],
Cell[CellGroupData[{
Cell[240697, 5602, 482, 13, 29, "Input",ExpressionUUID->"2c37cfaa-3563-4344-b309-b66a416750c9"],
Cell[241182, 5617, 283, 7, 33, "Output",ExpressionUUID->"33506d1e-6cb1-400a-a0b1-4d7de88dd436"]
}, Open  ]],
Cell[CellGroupData[{
Cell[241502, 5629, 534, 13, 29, "Input",ExpressionUUID->"049c0084-c987-4cb4-b91f-94d2978654d9"],
Cell[242039, 5644, 310, 7, 33, "Output",ExpressionUUID->"646507d1-f20d-47e2-974b-7386916099fc"]
}, Open  ]],
Cell[242364, 5654, 363, 8, 50, "Input",ExpressionUUID->"730923a7-7e32-43f8-b232-0f22fad87378"],
Cell[CellGroupData[{
Cell[242752, 5666, 2732, 62, 50, "Input",ExpressionUUID->"2446e460-e370-4a2e-bfb3-0fd53f148491"],
Cell[245487, 5730, 2144, 55, 54, "Output",ExpressionUUID->"6841052b-9405-4ce6-98c1-76fffa98f50c"]
}, Open  ]]
}, Open  ]]
}
]
*)

