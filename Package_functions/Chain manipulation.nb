(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.2' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    274288,       6661]
NotebookOptionsPosition[    241989,       6104]
NotebookOutlinePosition[    253071,       6321]
CellTagsIndexPosition[    253028,       6318]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell[BoxData[
 RowBox[{"<<", "SpinorHelicity4D`"}]], "Input",
 CellChangeTimes->{{3.8227408792709336`*^9, 3.8227408859799757`*^9}},
 CellLabel->"In[8]:=",ExpressionUUID->"9147f9b4-17d7-4958-a69a-c065c3c13cf0"],

Cell[CellGroupData[{

Cell[BoxData["\<\"===============SpinorHelicity4D================\"\>"], \
"Print",
 CellChangeTimes->{
  3.8227408906003494`*^9, 3.822741485932785*^9, 3.8227422970859175`*^9, 
   3.8227427763158007`*^9, 3.822743311067181*^9, 3.8227442373624716`*^9, {
   3.8261929244450493`*^9, 3.8261929507785325`*^9}, 3.826193116912387*^9, 
   3.8261946103696084`*^9, 3.8261957751514797`*^9, 3.826196447003767*^9, 
   3.8261964937598114`*^9, 3.8261968050715914`*^9, 3.826197067242917*^9, 
   3.826197124772999*^9, 3.8261978435668287`*^9, 3.8262584926792407`*^9, 
   3.826261661514809*^9, 3.8262626015739007`*^9, 3.8262630752816253`*^9, 
   3.8262668797774115`*^9, 3.826272324916882*^9, 3.8262723595095377`*^9, 
   3.8262795537457366`*^9, 3.8262824984972205`*^9, 3.826282872292614*^9, 
   3.826689639545959*^9, 3.8266901948451896`*^9},
 CellLabel->
  "During evaluation of \
In[8]:=",ExpressionUUID->"bc7b3377-c9f5-4f70-b743-d73c4d2277a8"],

Cell[BoxData["\<\"Author: Manuel Accettulli Huber (QMUL)\"\>"], "Print",
 CellChangeTimes->{
  3.8227408906003494`*^9, 3.822741485932785*^9, 3.8227422970859175`*^9, 
   3.8227427763158007`*^9, 3.822743311067181*^9, 3.8227442373624716`*^9, {
   3.8261929244450493`*^9, 3.8261929507785325`*^9}, 3.826193116912387*^9, 
   3.8261946103696084`*^9, 3.8261957751514797`*^9, 3.826196447003767*^9, 
   3.8261964937598114`*^9, 3.8261968050715914`*^9, 3.826197067242917*^9, 
   3.826197124772999*^9, 3.8261978435668287`*^9, 3.8262584926792407`*^9, 
   3.826261661514809*^9, 3.8262626015739007`*^9, 3.8262630752816253`*^9, 
   3.8262668797774115`*^9, 3.826272324916882*^9, 3.8262723595095377`*^9, 
   3.8262795537457366`*^9, 3.8262824984972205`*^9, 3.826282872292614*^9, 
   3.826689639545959*^9, 3.8266901948501744`*^9},
 CellLabel->
  "During evaluation of \
In[8]:=",ExpressionUUID->"32c92ce0-9900-415a-b602-7508d6e41bfe"],

Cell[BoxData["\<\"Please report any bug to:\"\>"], "Print",
 CellChangeTimes->{
  3.8227408906003494`*^9, 3.822741485932785*^9, 3.8227422970859175`*^9, 
   3.8227427763158007`*^9, 3.822743311067181*^9, 3.8227442373624716`*^9, {
   3.8261929244450493`*^9, 3.8261929507785325`*^9}, 3.826193116912387*^9, 
   3.8261946103696084`*^9, 3.8261957751514797`*^9, 3.826196447003767*^9, 
   3.8261964937598114`*^9, 3.8261968050715914`*^9, 3.826197067242917*^9, 
   3.826197124772999*^9, 3.8261978435668287`*^9, 3.8262584926792407`*^9, 
   3.826261661514809*^9, 3.8262626015739007`*^9, 3.8262630752816253`*^9, 
   3.8262668797774115`*^9, 3.826272324916882*^9, 3.8262723595095377`*^9, 
   3.8262795537457366`*^9, 3.8262824984972205`*^9, 3.826282872292614*^9, 
   3.826689639545959*^9, 3.8266901948551607`*^9},
 CellLabel->
  "During evaluation of \
In[8]:=",ExpressionUUID->"b58aa187-ef0c-42e0-a862-272edb3a49cd"],

Cell[BoxData["\<\"m.accettullihuber@qmul.ac.uk\"\>"], "Print",
 CellChangeTimes->{
  3.8227408906003494`*^9, 3.822741485932785*^9, 3.8227422970859175`*^9, 
   3.8227427763158007`*^9, 3.822743311067181*^9, 3.8227442373624716`*^9, {
   3.8261929244450493`*^9, 3.8261929507785325`*^9}, 3.826193116912387*^9, 
   3.8261946103696084`*^9, 3.8261957751514797`*^9, 3.826196447003767*^9, 
   3.8261964937598114`*^9, 3.8261968050715914`*^9, 3.826197067242917*^9, 
   3.826197124772999*^9, 3.8261978435668287`*^9, 3.8262584926792407`*^9, 
   3.826261661514809*^9, 3.8262626015739007`*^9, 3.8262630752816253`*^9, 
   3.8262668797774115`*^9, 3.826272324916882*^9, 3.8262723595095377`*^9, 
   3.8262795537457366`*^9, 3.8262824984972205`*^9, 3.826282872292614*^9, 
   3.826689639545959*^9, 3.8266901948581524`*^9},
 CellLabel->
  "During evaluation of \
In[8]:=",ExpressionUUID->"e8148c12-9373-43be-9a5a-c4a7338eddac"],

Cell[BoxData["\<\"Version 1.0 , last update 03/08/2020\"\>"], "Print",
 CellChangeTimes->{
  3.8227408906003494`*^9, 3.822741485932785*^9, 3.8227422970859175`*^9, 
   3.8227427763158007`*^9, 3.822743311067181*^9, 3.8227442373624716`*^9, {
   3.8261929244450493`*^9, 3.8261929507785325`*^9}, 3.826193116912387*^9, 
   3.8261946103696084`*^9, 3.8261957751514797`*^9, 3.826196447003767*^9, 
   3.8261964937598114`*^9, 3.8261968050715914`*^9, 3.826197067242917*^9, 
   3.826197124772999*^9, 3.8261978435668287`*^9, 3.8262584926792407`*^9, 
   3.826261661514809*^9, 3.8262626015739007`*^9, 3.8262630752816253`*^9, 
   3.8262668797774115`*^9, 3.826272324916882*^9, 3.8262723595095377`*^9, 
   3.8262795537457366`*^9, 3.8262824984972205`*^9, 3.826282872292614*^9, 
   3.826689639545959*^9, 3.826690194863145*^9},
 CellLabel->
  "During evaluation of \
In[8]:=",ExpressionUUID->"966ea036-97b7-40bb-a49d-8d735ae33407"],

Cell[BoxData[
 TemplateBox[{
  "\"Click here for full documentation\"", 
   "https://github.com/accettullihuber"},
  "HyperlinkURL"]], "Print",
 CellChangeTimes->{
  3.8227408906003494`*^9, 3.822741485932785*^9, 3.8227422970859175`*^9, 
   3.8227427763158007`*^9, 3.822743311067181*^9, 3.8227442373624716`*^9, {
   3.8261929244450493`*^9, 3.8261929507785325`*^9}, 3.826193116912387*^9, 
   3.8261946103696084`*^9, 3.8261957751514797`*^9, 3.826196447003767*^9, 
   3.8261964937598114`*^9, 3.8261968050715914`*^9, 3.826197067242917*^9, 
   3.826197124772999*^9, 3.8261978435668287`*^9, 3.8262584926792407`*^9, 
   3.826261661514809*^9, 3.8262626015739007`*^9, 3.8262630752816253`*^9, 
   3.8262668797774115`*^9, 3.826272324916882*^9, 3.8262723595095377`*^9, 
   3.8262795537457366`*^9, 3.8262824984972205`*^9, 3.826282872292614*^9, 
   3.826689639545959*^9, 3.8266901948681345`*^9},
 CellLabel->
  "During evaluation of \
In[8]:=",ExpressionUUID->"fba1c15a-22aa-44fe-9618-d549fb46ccfa"],

Cell[BoxData["\<\"=============================================\"\>"], "Print",
 CellChangeTimes->{
  3.8227408906003494`*^9, 3.822741485932785*^9, 3.8227422970859175`*^9, 
   3.8227427763158007`*^9, 3.822743311067181*^9, 3.8227442373624716`*^9, {
   3.8261929244450493`*^9, 3.8261929507785325`*^9}, 3.826193116912387*^9, 
   3.8261946103696084`*^9, 3.8261957751514797`*^9, 3.826196447003767*^9, 
   3.8261964937598114`*^9, 3.8261968050715914`*^9, 3.826197067242917*^9, 
   3.826197124772999*^9, 3.8261978435668287`*^9, 3.8262584926792407`*^9, 
   3.826261661514809*^9, 3.8262626015739007`*^9, 3.8262630752816253`*^9, 
   3.8262668797774115`*^9, 3.826272324916882*^9, 3.8262723595095377`*^9, 
   3.8262795537457366`*^9, 3.8262824984972205`*^9, 3.826282872292614*^9, 
   3.826689639545959*^9, 3.8266901948731127`*^9},
 CellLabel->
  "During evaluation of \
In[8]:=",ExpressionUUID->"e40a9b0c-7f22-46d6-b98f-425873ea7d98"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["ChainToSpinors", "Section",
 CellChangeTimes->{{3.826187716586968*^9, 
  3.826187719645814*^9}},ExpressionUUID->"ebe2bd24-62b2-49b8-9fd8-\
ee51f5183c48"],

Cell[CellGroupData[{

Cell["Old version of ToChain", "Subsection",
 CellChangeTimes->{{3.8227408990170493`*^9, 3.8227409005628195`*^9}, {
  3.822741309897335*^9, 
  3.822741313813756*^9}},ExpressionUUID->"995a8f52-76ee-477d-97f3-\
91b8d3753e37"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "ToChain", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"MinimalChains", "->", "True"}], "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ToChain", "[", 
    RowBox[{"exp_", ",", 
     RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ChainPow", ",", "locexp"}], "}"}], ",", "\n", 
     RowBox[{"(*", 
      RowBox[{"Chain", " ", 
       RowBox[{"properties", ":"}]}], "*)"}], "\n", "\n", 
     RowBox[{"(*", "Basics", "*)"}], "\n", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"ChainPow", "[", "x__", "]"}], "[", "0", "]"}], ":=", "1"}], 
      ";", "\n", "\n", 
      RowBox[{"(*", 
       RowBox[{
       "Minus", " ", "signs", " ", "in", " ", "the", " ", "external", " ", 
        "brackest"}], "*)"}], "\n", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"ChainPow", "[", 
          RowBox[{"type1_", ",", 
           RowBox[{"-", "x_"}], ",", 
           RowBox[{"{", "y___", "}"}], ",", "z_", ",", "type2_"}], "]"}], "[",
          "n_", "]"}], "/;", 
        RowBox[{"MemberQ", "[", 
         RowBox[{"MomList", ",", "x"}], "]"}]}], ":=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", "I", ")"}], "^", "n"}], "*", 
        RowBox[{
         RowBox[{"ChainPow", "[", 
          RowBox[{"type1", ",", "x", ",", 
           RowBox[{"{", "y", "}"}], ",", "z", ",", "type2"}], "]"}], "[", "n",
          "]"}]}]}], ";", "\n", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"ChainPow", "[", 
          RowBox[{"type1_", ",", "x_", ",", 
           RowBox[{"{", "y___", "}"}], ",", 
           RowBox[{"-", "z_"}], ",", "type2_"}], "]"}], "[", "n_", "]"}], "/;", 
        RowBox[{"MemberQ", "[", 
         RowBox[{"MomList", ",", "z"}], "]"}]}], ":=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", "I", ")"}], "^", "n"}], "*", 
        RowBox[{
         RowBox[{"ChainPow", "[", 
          RowBox[{"type1", ",", "x", ",", 
           RowBox[{"{", "y", "}"}], ",", "z", ",", "type2"}], "]"}], "[", "n",
          "]"}]}]}], ";", "\n", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"ChainPow", "[", 
          RowBox[{"type1_", ",", 
           RowBox[{"-", "x_"}], ",", 
           RowBox[{"{", "y___", "}"}], ",", 
           RowBox[{"-", "z_"}], ",", "type2_"}], "]"}], "[", "n_", "]"}], "/;", 
        RowBox[{
         RowBox[{"MemberQ", "[", 
          RowBox[{"MomList", ",", "x"}], "]"}], "&&", 
         RowBox[{"MemberQ", "[", 
          RowBox[{"MomList", ",", "z"}], "]"}]}]}], ":=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"-", "1"}], ")"}], "^", "n"}], "*", 
        RowBox[{
         RowBox[{"ChainPow", "[", 
          RowBox[{"type1", ",", "x", ",", 
           RowBox[{"{", "y", "}"}], ",", "z", ",", "type2"}], "]"}], "[", "n",
          "]"}]}]}], ";", "\n", "\n", 
      RowBox[{"(*", 
       RowBox[{"SquareAngle", " ", "as", " ", "AngleSquare"}], "*)"}], "\n", 
      RowBox[{
       RowBox[{
        RowBox[{"ChainPow", "[", 
         RowBox[{"$square", ",", "x_", ",", 
          RowBox[{"{", "y__", "}"}], ",", "z_", ",", "$angle"}], "]"}], "[", 
        "n_", "]"}], ":=", 
       RowBox[{
        RowBox[{"ChainPow", "[", 
         RowBox[{"$angle", ",", "z", ",", 
          RowBox[{"Reverse", "[", 
           RowBox[{"{", "y", "}"}], "]"}], ",", "x", ",", "$square"}], "]"}], 
        "[", "n", "]"}]}], ";", "\n", "\n", 
      RowBox[{"(*", 
       RowBox[{"The", " ", "actual", " ", "contraction", " ", "properties"}], 
       "*)"}], "\n", "\n", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
         RowBox[{" ", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"x", "..."}], "y"}]}], "\[RightAngleBracket]"}], "[", 
         RowBox[{
          RowBox[{"y", "..."}], "z"}]}], ")"}], " ", "*)"}], "\n", 
      RowBox[{"ChainPow", " ", "/:", " ", 
       RowBox[{"Times", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"ChainPow", "[", 
           RowBox[{"type1_", ",", "x_", ",", 
            RowBox[{"{", "k___", "}"}], ",", "y_", ",", "$angle"}], "]"}], 
          "[", 
          RowBox[{"n_", "?", "Positive"}], "]"}], ",", 
         RowBox[{
          RowBox[{"ChainPow", "[", 
           RowBox[{"$square", ",", "y_", ",", 
            RowBox[{"{", "q___", "}"}], ",", "z_", ",", "type2_"}], "]"}], 
          "[", 
          RowBox[{"m_", "?", "Positive"}], "]"}]}], "]"}], ":=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"n", ">=", "m"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"type1", ",", "x", ",", 
             RowBox[{"{", 
              RowBox[{"k", ",", "y", ",", "q"}], "}"}], ",", "z", ",", 
             "type2"}], "]"}], "[", "m", "]"}], 
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"type1", ",", "x", ",", 
             RowBox[{"{", "k", "}"}], ",", "y", ",", "$angle"}], "]"}], "[", 
           RowBox[{"n", "-", "m"}], "]"}]}], ",", "\n", 
         RowBox[{
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"type1", ",", "x", ",", 
             RowBox[{"{", 
              RowBox[{"k", ",", "y", ",", "q"}], "}"}], ",", "z", ",", 
             "type2"}], "]"}], "[", "n", "]"}], 
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"$square", ",", "y", ",", 
             RowBox[{"{", "q", "}"}], ",", "z", ",", "type2"}], "]"}], "[", 
           RowBox[{"m", "-", "n"}], "]"}]}]}], "\n", "]"}]}], ";", "\n", "\n", 
      RowBox[{"ChainPow", " ", "/:", " ", 
       RowBox[{"Times", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"ChainPow", "[", 
           RowBox[{"type1_", ",", "x_", ",", 
            RowBox[{"{", "k___", "}"}], ",", "y_", ",", "$angle"}], "]"}], 
          "[", 
          RowBox[{"n_", "?", "Negative"}], "]"}], ",", 
         RowBox[{
          RowBox[{"ChainPow", "[", 
           RowBox[{"$square", ",", "y_", ",", 
            RowBox[{"{", "q___", "}"}], ",", "z_", ",", "type2_"}], "]"}], 
          "[", 
          RowBox[{"m_", "?", "Negative"}], "]"}]}], "]"}], ":=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"n", "<=", "m"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"type1", ",", "x", ",", 
             RowBox[{"{", 
              RowBox[{"k", ",", "y", ",", "q"}], "}"}], ",", "z", ",", 
             "type2"}], "]"}], "[", "m", "]"}], 
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"type1", ",", "x", ",", 
             RowBox[{"{", "k", "}"}], ",", "y", ",", "$angle"}], "]"}], "[", 
           RowBox[{"n", "-", "m"}], "]"}]}], ",", "\n", 
         RowBox[{
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"type1", ",", "x", ",", 
             RowBox[{"{", 
              RowBox[{"k", ",", "y", ",", "q"}], "}"}], ",", "z", ",", 
             "type2"}], "]"}], "[", "n", "]"}], 
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"$square", ",", "y", ",", 
             RowBox[{"{", "q", "}"}], ",", "z", ",", "type2"}], "]"}], "[", 
           RowBox[{"m", "-", "n"}], "]"}]}]}], "\n", "]"}]}], ";", "\n", "\n", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"\[LeftAngleBracket]", 
           RowBox[{
            RowBox[{"y", "..."}], "x"}]}], ")"}], "[", 
         RowBox[{
          RowBox[{"y", "..."}], "z"}]}], ")"}], " ", "*)"}], "\n", 
      RowBox[{"ChainPow", " ", "/:", " ", 
       RowBox[{"Times", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"ChainPow", "[", 
           RowBox[{"$angle", ",", "y_", ",", 
            RowBox[{"{", "k___", "}"}], ",", "x_", ",", "type1_"}], "]"}], 
          "[", 
          RowBox[{"n_", "?", "Positive"}], "]"}], ",", 
         RowBox[{
          RowBox[{"ChainPow", "[", 
           RowBox[{"$square", ",", "y_", ",", 
            RowBox[{"{", "q___", "}"}], ",", "z_", ",", "type2_"}], "]"}], 
          "[", 
          RowBox[{"m_", "?", "Positive"}], "]"}]}], "]"}], ":=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"n", ">=", "m"}], ",", "\n", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"-", "1"}], ")"}], "^", 
           RowBox[{"(", 
            RowBox[{"m", "*", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Length", "[", 
                RowBox[{"{", "k", "}"}], "]"}], "+", "1"}], ")"}]}], ")"}]}], 
          "*", 
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"type1", ",", "x", ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Sequence", "@@", 
                RowBox[{"Reverse", "[", 
                 RowBox[{"{", "k", "}"}], "]"}]}], ",", "y", ",", "q"}], 
              "}"}], ",", "z", ",", "type2"}], "]"}], "[", "m", "]"}], 
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"$angle", ",", "y", ",", 
             RowBox[{"{", "k", "}"}], ",", "x", ",", "type1"}], "]"}], "[", 
           RowBox[{"n", "-", "m"}], "]"}]}], ",", "\n", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"-", "1"}], ")"}], "^", 
           RowBox[{"(", 
            RowBox[{"n", "*", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Length", "[", 
                RowBox[{"{", "k", "}"}], "]"}], "+", "1"}], ")"}]}], ")"}]}], 
          "*", 
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"type1", ",", "x", ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Sequence", "@@", 
                RowBox[{"Reverse", "[", 
                 RowBox[{"{", "k", "}"}], "]"}]}], ",", "y", ",", "q"}], 
              "}"}], ",", "z", ",", "type2"}], "]"}], "[", "n", "]"}], 
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"$square", ",", "y", ",", 
             RowBox[{"{", "q", "}"}], ",", "z", ",", "type2"}], "]"}], "[", 
           RowBox[{"m", "-", "n"}], "]"}]}]}], "\n", "]"}]}], ";", "\n", "\n", 
      RowBox[{"ChainPow", " ", "/:", " ", 
       RowBox[{"Times", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"ChainPow", "[", 
           RowBox[{"$angle", ",", "y_", ",", 
            RowBox[{"{", "k___", "}"}], ",", "x_", ",", "type1_"}], "]"}], 
          "[", 
          RowBox[{"n_", "?", "Negative"}], "]"}], ",", 
         RowBox[{
          RowBox[{"ChainPow", "[", 
           RowBox[{"$square", ",", "y_", ",", 
            RowBox[{"{", "q___", "}"}], ",", "z_", ",", "type2_"}], "]"}], 
          "[", 
          RowBox[{"m_", "?", "Negative"}], "]"}]}], "]"}], ":=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"n", "<=", "m"}], ",", "\n", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"-", "1"}], ")"}], "^", 
           RowBox[{"(", 
            RowBox[{"m", "*", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Length", "[", 
                RowBox[{"{", "k", "}"}], "]"}], "+", "1"}], ")"}]}], ")"}]}], 
          "*", 
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"type1", ",", "x", ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Sequence", "@@", 
                RowBox[{"Reverse", "[", 
                 RowBox[{"{", "k", "}"}], "]"}]}], ",", "y", ",", "q"}], 
              "}"}], ",", "z", ",", "type2"}], "]"}], "[", "m", "]"}], 
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"$angle", ",", "y", ",", 
             RowBox[{"{", "k", "}"}], ",", "x", ",", "type1"}], "]"}], "[", 
           RowBox[{"n", "-", "m"}], "]"}]}], ",", "\n", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"-", "1"}], ")"}], "^", 
           RowBox[{"(", 
            RowBox[{"n", "*", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Length", "[", 
                RowBox[{"{", "k", "}"}], "]"}], "+", "1"}], ")"}]}], ")"}]}], 
          "*", 
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"type1", ",", "x", ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Sequence", "@@", 
                RowBox[{"Reverse", "[", 
                 RowBox[{"{", "k", "}"}], "]"}]}], ",", "y", ",", "q"}], 
              "}"}], ",", "z", ",", "type2"}], "]"}], "[", "n", "]"}], 
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"$square", ",", "y", ",", 
             RowBox[{"{", "q", "}"}], ",", "z", ",", "type2"}], "]"}], "[", 
           RowBox[{"m", "-", "n"}], "]"}]}]}], "\n", "]"}]}], ";", "\n", "\n", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"x", "..."}], "y"}]}], "\[RightAngleBracket]"}], "[", 
         RowBox[{
          RowBox[{"y", "..."}], "z"}]}], ")"}], "*)"}], "\n", 
      RowBox[{"ChainPow", " ", "/:", " ", 
       RowBox[{"Times", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"ChainPow", "[", 
           RowBox[{"type1_", ",", "x_", ",", 
            RowBox[{"{", "k___", "}"}], ",", "y_", ",", "$angle"}], "]"}], 
          "[", 
          RowBox[{"n_", "?", "Positive"}], "]"}], ",", 
         RowBox[{
          RowBox[{"ChainPow", "[", 
           RowBox[{"type2_", ",", "z_", ",", 
            RowBox[{"{", "q___", "}"}], ",", "y_", ",", "$square"}], "]"}], 
          "[", 
          RowBox[{"m_", "?", "Positive"}], "]"}]}], "]"}], ":=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"n", ">=", "m"}], ",", "\n", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"-", "1"}], ")"}], "^", 
           RowBox[{"(", 
            RowBox[{"m", "*", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Length", "[", 
                RowBox[{"{", "q", "}"}], "]"}], "+", "1"}], ")"}]}], ")"}]}], 
          "*", 
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"type1", ",", "x", ",", 
             RowBox[{"{", 
              RowBox[{"k", ",", "y", ",", 
               RowBox[{"Sequence", "@@", 
                RowBox[{"Reverse", "[", 
                 RowBox[{"{", "q", "}"}], "]"}]}]}], "}"}], ",", "z", ",", 
             "type2"}], "]"}], "[", "m", "]"}], 
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"type1", ",", "x", ",", 
             RowBox[{"{", "k", "}"}], ",", "y", ",", "$angle"}], "]"}], "[", 
           RowBox[{"n", "-", "m"}], "]"}]}], ",", "\n", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"-", "1"}], ")"}], "^", 
           RowBox[{"(", 
            RowBox[{"n", "*", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Length", "[", 
                RowBox[{"{", "q", "}"}], "]"}], "+", "1"}], ")"}]}], ")"}]}], 
          "*", 
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"type1", ",", "x", ",", 
             RowBox[{"{", 
              RowBox[{"k", ",", "y", ",", 
               RowBox[{"Sequence", "@@", 
                RowBox[{"Reverse", "[", 
                 RowBox[{"{", "q", "}"}], "]"}]}]}], "}"}], ",", "z", ",", 
             "type2"}], "]"}], "[", "n", "]"}], 
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"type2", ",", "z", ",", 
             RowBox[{"{", "q", "}"}], ",", "y", ",", "$square"}], "]"}], "[", 
           RowBox[{"m", "-", "n"}], "]"}]}]}], "\n", "]"}]}], ";", "\n", "\n", 
      RowBox[{"ChainPow", " ", "/:", " ", 
       RowBox[{"Times", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"ChainPow", "[", 
           RowBox[{"type1_", ",", "x_", ",", 
            RowBox[{"{", "k___", "}"}], ",", "y_", ",", "$angle"}], "]"}], 
          "[", 
          RowBox[{"n_", "?", "Negative"}], "]"}], ",", 
         RowBox[{
          RowBox[{"ChainPow", "[", 
           RowBox[{"type2_", ",", "z_", ",", 
            RowBox[{"{", "q___", "}"}], ",", "y_", ",", "$square"}], "]"}], 
          "[", 
          RowBox[{"m_", "?", "Negative"}], "]"}]}], "]"}], ":=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"n", "<=", "m"}], ",", "\n", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"-", "1"}], ")"}], "^", 
           RowBox[{"(", 
            RowBox[{"m", "*", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Length", "[", 
                RowBox[{"{", "q", "}"}], "]"}], "+", "1"}], ")"}]}], ")"}]}], 
          "*", 
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"type1", ",", "x", ",", 
             RowBox[{"{", 
              RowBox[{"k", ",", "y", ",", 
               RowBox[{"Sequence", "@@", 
                RowBox[{"Reverse", "[", 
                 RowBox[{"{", "q", "}"}], "]"}]}]}], "}"}], ",", "z", ",", 
             "type2"}], "]"}], "[", "m", "]"}], 
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"type1", ",", "x", ",", 
             RowBox[{"{", "k", "}"}], ",", "y", ",", "$angle"}], "]"}], "[", 
           RowBox[{"n", "-", "m"}], "]"}]}], ",", "\n", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"-", "1"}], ")"}], "^", 
           RowBox[{"(", 
            RowBox[{"n", "*", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Length", "[", 
                RowBox[{"{", "q", "}"}], "]"}], "+", "1"}], ")"}]}], ")"}]}], 
          "*", 
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"type1", ",", "x", ",", 
             RowBox[{"{", 
              RowBox[{"k", ",", "y", ",", 
               RowBox[{"Sequence", "@@", 
                RowBox[{"Reverse", "[", 
                 RowBox[{"{", "q", "}"}], "]"}]}]}], "}"}], ",", "z", ",", 
             "type2"}], "]"}], "[", "n", "]"}], 
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"type2", ",", "z", ",", 
             RowBox[{"{", "q", "}"}], ",", "y", ",", "$square"}], "]"}], "[", 
           RowBox[{"m", "-", "n"}], "]"}]}]}], "\n", "]"}]}], ";", "\n", "\n", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
         RowBox[{" ", 
          RowBox[{"\[LeftAngleBracket]", 
           RowBox[{
            RowBox[{"y", "..."}], "x"}]}], ")"}], 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"z", "..."}], "y"}]}]}], "]"}], " ", "*)"}], "\n", 
      RowBox[{"ChainPow", " ", "/:", " ", 
       RowBox[{"Times", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"ChainPow", "[", 
           RowBox[{"$angle", ",", "y_", ",", 
            RowBox[{"{", "k___", "}"}], ",", "x_", ",", "type1_"}], "]"}], 
          "[", 
          RowBox[{"n_", "?", "Positive"}], "]"}], ",", 
         RowBox[{
          RowBox[{"ChainPow", "[", 
           RowBox[{"type2_", ",", "z_", ",", 
            RowBox[{"{", "q___", "}"}], ",", "y_", ",", "$square"}], "]"}], 
          "[", 
          RowBox[{"m_", "?", "Positive"}], "]"}]}], "]"}], ":=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"n", ">=", "m"}], ",", "\n", 
         RowBox[{
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"type2", ",", "z", ",", 
             RowBox[{"{", 
              RowBox[{"q", ",", "y", ",", "k"}], "}"}], ",", "x", ",", 
             "type1"}], "]"}], "[", "m", "]"}], 
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"$angle", ",", "y", ",", 
             RowBox[{"{", "k", "}"}], ",", "x", ",", "type1"}], "]"}], "[", 
           RowBox[{"n", "-", "m"}], "]"}]}], ",", "\n", 
         RowBox[{
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"type2", ",", "z", ",", 
             RowBox[{"{", 
              RowBox[{"q", ",", "y", ",", "k"}], "}"}], ",", "x", ",", 
             "type1"}], "]"}], "[", "n", "]"}], 
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"type2", ",", "z", ",", 
             RowBox[{"{", "q", "}"}], ",", "y", ",", "$square"}], "]"}], "[", 
           RowBox[{"m", "-", "n"}], "]"}]}]}], "\n", "]"}]}], ";", "\n", "\n", 
      RowBox[{"ChainPow", " ", "/:", " ", 
       RowBox[{"Times", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"ChainPow", "[", 
           RowBox[{"$angle", ",", "y_", ",", 
            RowBox[{"{", "k___", "}"}], ",", "x_", ",", "type1_"}], "]"}], 
          "[", 
          RowBox[{"n_", "?", "Negative"}], "]"}], ",", 
         RowBox[{
          RowBox[{"ChainPow", "[", 
           RowBox[{"type2_", ",", "z_", ",", 
            RowBox[{"{", "q___", "}"}], ",", "y_", ",", "$square"}], "]"}], 
          "[", 
          RowBox[{"m_", "?", "Negative"}], "]"}]}], "]"}], ":=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"n", "<=", "m"}], ",", "\n", 
         RowBox[{
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"type2", ",", "z", ",", 
             RowBox[{"{", 
              RowBox[{"q", ",", "y", ",", "k"}], "}"}], ",", "x", ",", 
             "type1"}], "]"}], "[", "m", "]"}], 
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"$angle", ",", "y", ",", 
             RowBox[{"{", "k", "}"}], ",", "x", ",", "type1"}], "]"}], "[", 
           RowBox[{"n", "-", "m"}], "]"}]}], ",", "\n", 
         RowBox[{
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"type2", ",", "z", ",", 
             RowBox[{"{", 
              RowBox[{"q", ",", "y", ",", "k"}], "}"}], ",", "x", ",", 
             "type1"}], "]"}], "[", "n", "]"}], 
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"type2", ",", "z", ",", 
             RowBox[{"{", "q", "}"}], ",", "y", ",", "$square"}], "]"}], "[", 
           RowBox[{"m", "-", "n"}], "]"}]}]}], "\n", "]"}]}], ";", "\n", "\n", 
      RowBox[{"(*", 
       RowBox[{
       "Applying", " ", "the", " ", "properties", " ", "to", " ", "the", " ", 
        "expression"}], "*)"}], "\n", 
      RowBox[{"(*", 
       RowBox[{
       "Convert", " ", "angle", " ", "and", " ", "square", " ", "brackets", 
        " ", "to", " ", "Chains"}], "*)"}], "\n", 
      RowBox[{"locexp", "=", 
       RowBox[{"exp", "//.", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"SpinorAngleBracket", "[", 
            RowBox[{"x_", ",", "y_"}], "]"}], ":>", 
           RowBox[{"Chain", "[", 
            RowBox[{"$angle", ",", "x", ",", 
             RowBox[{"{", "}"}], ",", "y", ",", "$angle"}], "]"}]}], ",", 
          RowBox[{
           RowBox[{"SpinorSquareBracket", "[", 
            RowBox[{"x_", ",", "y_"}], "]"}], ":>", 
           RowBox[{"Chain", "[", 
            RowBox[{"$square", ",", "x", ",", 
             RowBox[{"{", "}"}], ",", "y", ",", "$square"}], "]"}]}], ",", 
          RowBox[{
           RowBox[{"Chain", "[", "x__", "]"}], ":>", 
           RowBox[{
            RowBox[{"ChainPow", "[", "x", "]"}], "[", "1", "]"}]}], ",", 
          RowBox[{
           RowBox[{"Power", "[", 
            RowBox[{
             RowBox[{"Chain", "[", "x__", "]"}], ",", "n_"}], "]"}], ":>", 
           RowBox[{
            RowBox[{"ChainPow", "[", "x", "]"}], "[", "n", "]"}]}]}], 
         "}"}]}]}], ";", "\n", "\n", 
      RowBox[{"(*", 
       RowBox[{
       "Expand", " ", "part", " ", "of", " ", "the", " ", "expression", " ", 
        "containing", " ", "ChainPow", " ", "in", " ", "order", " ", "for", 
        " ", "the", " ", "contractions", " ", "to", " ", "happen"}], "*)"}], 
      "\n", 
      RowBox[{"locexp", "=", 
       RowBox[{"Expand", "[", 
        RowBox[{"locexp", ",", "ChainPow"}], "]"}]}], ";", "\n", "\n", 
      RowBox[{"(*", 
       RowBox[{
       "Convert", " ", "back", " ", "to", " ", "angle", " ", "and", " ", 
        "square", " ", "brackets"}], "*)"}], "\n", 
      RowBox[{"locexp", "=", 
       RowBox[{"locexp", "//.", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"Chain", "[", 
            RowBox[{"$angle", ",", "x_", ",", 
             RowBox[{"{", "}"}], ",", "y_", ",", "$angle"}], "]"}], ":>", 
           RowBox[{"SpinorAngleBracket", "[", 
            RowBox[{"x", ",", "y"}], "]"}]}], ",", 
          RowBox[{
           RowBox[{"Chain", "[", 
            RowBox[{"$square", ",", "x_", ",", 
             RowBox[{"{", "}"}], ",", "y_", ",", "$square"}], "]"}], ":>", 
           RowBox[{"SpinorSquareBracket", "[", 
            RowBox[{"x", ",", "y"}], "]"}]}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"ChainPow", "[", "x__", "]"}], "[", "n_", "]"}], ":>", 
           RowBox[{"Power", "[", 
            RowBox[{
             RowBox[{"Chain", "[", "x", "]"}], ",", "n"}], "]"}]}]}], 
         "}"}]}]}], ";", "\n", "\n", 
      RowBox[{"(*", 
       RowBox[{
       "Reduce", " ", "the", " ", "chains", " ", "to", " ", "minimal", " ", 
        "form", " ", "if", " ", "required"}], "*)"}], "\n", "\n", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"TrueQ", "[", 
         RowBox[{"OptionValue", "[", "MinimalChains", "]"}], "]"}], ",", "\n", 
        RowBox[{
         RowBox[{"locexp", "=", 
          RowBox[{"locexp", "//.", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"Chain", "[", 
                RowBox[{"$angle", ",", "x_", ",", 
                 RowBox[{"{", 
                  RowBox[{"y__", ",", "x_", ",", "z__"}], "}"}], ",", "k_", 
                 ",", "type2_"}], "]"}], "/;", 
               RowBox[{"OddQ", "[", 
                RowBox[{"Length", "[", 
                 RowBox[{"{", "y", "}"}], "]"}], "]"}]}], ":>", 
              RowBox[{
               RowBox[{"Chain", "[", 
                RowBox[{"$angle", ",", "x", ",", 
                 RowBox[{"{", "y", "}"}], ",", "x", ",", "$square"}], "]"}], 
               "*", 
               RowBox[{"Chain", "[", 
                RowBox[{"$angle", ",", "x", ",", 
                 RowBox[{"{", "z", "}"}], ",", "k", ",", "type2"}], "]"}]}]}],
              ",", "\n", 
             RowBox[{
              RowBox[{
               RowBox[{"Chain", "[", 
                RowBox[{"$square", ",", "x_", ",", 
                 RowBox[{"{", 
                  RowBox[{"y__", ",", "x_", ",", "z__"}], "}"}], ",", "k_", 
                 ",", "type2_"}], "]"}], "/;", 
               RowBox[{"OddQ", "[", 
                RowBox[{"Length", "[", 
                 RowBox[{"{", "y", "}"}], "]"}], "]"}]}], ":>", 
              RowBox[{
               RowBox[{"Chain", "[", 
                RowBox[{"$square", ",", "x", ",", 
                 RowBox[{"{", "y", "}"}], ",", "x", ",", "$angle"}], "]"}], 
               "*", 
               RowBox[{"Chain", "[", 
                RowBox[{"$square", ",", "x", ",", 
                 RowBox[{"{", "z", "}"}], ",", "k", ",", "type2"}], "]"}]}]}],
              ",", "\n", 
             RowBox[{
              RowBox[{
               RowBox[{"Chain", "[", 
                RowBox[{"type1_", ",", "k_", ",", 
                 RowBox[{"{", 
                  RowBox[{"y__", ",", "x_", ",", "z__"}], "}"}], ",", "x_", 
                 ",", "$angle"}], "]"}], "/;", 
               RowBox[{"OddQ", "[", 
                RowBox[{"Length", "[", 
                 RowBox[{"{", "z", "}"}], "]"}], "]"}]}], ":>", 
              RowBox[{
               RowBox[{"Chain", "[", 
                RowBox[{"type1", ",", "k", ",", 
                 RowBox[{"{", "y", "}"}], ",", "x", ",", "$angle"}], "]"}], 
               "*", 
               RowBox[{"Chain", "[", 
                RowBox[{"$square", ",", "x", ",", 
                 RowBox[{"{", "z", "}"}], ",", "x", ",", "$angle"}], 
                "]"}]}]}], ",", "\n", 
             RowBox[{
              RowBox[{
               RowBox[{"Chain", "[", 
                RowBox[{"type1_", ",", "k_", ",", 
                 RowBox[{"{", 
                  RowBox[{"y__", ",", "x_", ",", "z__"}], "}"}], ",", "x_", 
                 ",", "$square"}], "]"}], "/;", 
               RowBox[{"OddQ", "[", 
                RowBox[{"Length", "[", 
                 RowBox[{"{", "z", "}"}], "]"}], "]"}]}], ":>", 
              RowBox[{
               RowBox[{"Chain", "[", 
                RowBox[{"type1", ",", "k", ",", 
                 RowBox[{"{", "y", "}"}], ",", "x", ",", "$square"}], "]"}], 
               "*", 
               RowBox[{"Chain", "[", 
                RowBox[{"$angle", ",", "x", ",", 
                 RowBox[{"{", "z", "}"}], ",", "x", ",", "$square"}], 
                "]"}]}]}]}], "}"}]}]}], ";"}]}], "\n", "]"}], ";", "\n", "\n", 
      RowBox[{"Return", "[", "locexp", "]"}], ";"}]}], "\n", "]"}]}], 
  ";"}]}], "Code",ExpressionUUID->"fff488d2-c9bd-4d1a-85ad-03f94a86822f"]
}, Closed]],

Cell[CellGroupData[{

Cell["Old version of ChainToSpinor", "Subsection",
 CellChangeTimes->{{3.822741322138316*^9, 
  3.8227413280351734`*^9}},ExpressionUUID->"78473574-21be-4363-aa2c-\
87cb65d865f1"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ChainToSpinor", "[", "exp_", "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"locexp", ",", "Chain"}], "}"}], ",", "\n", 
     RowBox[{"(*", 
      RowBox[{
      "Define", " ", "the", " ", "local", " ", "properties", " ", "of", " ", 
       "Chain", " ", "which", " ", "will", " ", "allow", " ", "for", " ", 
       "the", " ", "splitting"}], "*)"}], "\n", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"Chain", "[", 
         RowBox[{"$angle", ",", "a1_", ",", 
          RowBox[{"{", 
           RowBox[{"x___", ",", "y_", ",", "z___"}], "}"}], ",", "a2_", ",", 
          "type_"}], "]"}], "/;", 
        RowBox[{"MasslessQ", "[", "y", "]"}]}], ":=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"OddQ", "[", 
          RowBox[{"Length", "[", 
           RowBox[{"{", 
            RowBox[{"x", ",", "Null"}], "}"}], "]"}], "]"}], ",", "\n", 
         RowBox[{
          RowBox[{"Chain", "[", 
           RowBox[{"$angle", ",", "a1", ",", 
            RowBox[{"{", "x", "}"}], ",", "y", ",", "$angle"}], "]"}], "*", 
          RowBox[{"Chain", "[", 
           RowBox[{"$square", ",", "y", ",", 
            RowBox[{"{", "z", "}"}], ",", "a2", ",", "type"}], "]"}]}], ",", 
         "\n", 
         RowBox[{
          RowBox[{"Chain", "[", 
           RowBox[{"$angle", ",", "a1", ",", 
            RowBox[{"{", "x", "}"}], ",", "y", ",", "$square"}], "]"}], "*", 
          RowBox[{"Chain", "[", 
           RowBox[{"$angle", ",", "y", ",", 
            RowBox[{"{", "z", "}"}], ",", "a2", ",", "type"}], "]"}]}]}], 
        "]"}]}], ";", "\n", 
      RowBox[{
       RowBox[{
        RowBox[{"Chain", "[", 
         RowBox[{"$square", ",", "a1_", ",", 
          RowBox[{"{", 
           RowBox[{"x___", ",", "y_", ",", "z___"}], "}"}], ",", "a2_", ",", 
          "type_"}], "]"}], "/;", 
        RowBox[{"MasslessQ", "[", "y", "]"}]}], ":=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"OddQ", "[", 
          RowBox[{"Length", "[", 
           RowBox[{"{", 
            RowBox[{"x", ",", "Null"}], "}"}], "]"}], "]"}], ",", "\n", 
         RowBox[{
          RowBox[{"Chain", "[", 
           RowBox[{"$square", ",", "a1", ",", 
            RowBox[{"{", "x", "}"}], ",", "y", ",", "$square"}], "]"}], "*", 
          RowBox[{"Chain", "[", 
           RowBox[{"$angle", ",", "y", ",", 
            RowBox[{"{", "z", "}"}], ",", "a2", ",", "type"}], "]"}]}], ",", 
         "\n", 
         RowBox[{
          RowBox[{"Chain", "[", 
           RowBox[{"$square", ",", "a1", ",", 
            RowBox[{"{", "x", "}"}], ",", "y", ",", "$angle"}], "]"}], "*", 
          RowBox[{"Chain", "[", 
           RowBox[{"$square", ",", "y", ",", 
            RowBox[{"{", "z", "}"}], ",", "a2", ",", "type"}], "]"}]}]}], 
        "\n", "]"}]}], ";", "\n", "\n", 
      RowBox[{"(*", 
       RowBox[{
       "Define", " ", "locexp", " ", "and", " ", "let", " ", "the", " ", 
        "definitions", " ", "act"}], "*)"}], "\n", 
      RowBox[{"locexp", "=", "exp"}], ";", "\n", "\n", 
      RowBox[{"(*", 
       RowBox[{
       "Replace", " ", "empty", " ", "chains", " ", "with", " ", "angle", " ",
         "and", " ", "square", " ", "brackets"}], "*)"}], "\n", 
      RowBox[{"locexp", "=", 
       RowBox[{"locexp", "/.", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"Chain", "[", 
            RowBox[{"$angle", ",", "x_", ",", 
             RowBox[{"{", "}"}], ",", "y_", ",", "$angle"}], "]"}], ":>", 
           RowBox[{"SpinorAngleBracket", "[", 
            RowBox[{"x", ",", "y"}], "]"}]}], ",", 
          RowBox[{
           RowBox[{"Chain", "[", 
            RowBox[{"$square", ",", "x_", ",", 
             RowBox[{"{", "}"}], ",", "y_", ",", "$square"}], "]"}], ":>", 
           RowBox[{"SpinorSquareBracket", "[", 
            RowBox[{"x", ",", "y"}], "]"}]}]}], "}"}]}]}], ";", "\n", "\n", 
      RowBox[{"(*", 
       RowBox[{"Return", " ", "output"}], "*)"}], "\n", 
      RowBox[{"Return", "[", "locexp", "]"}], ";"}]}], "\n", "]"}]}], 
  ";"}]], "Code",ExpressionUUID->"2d7bd423-4964-42d0-af05-d77d238a92bc"]
}, Closed]],

Cell[CellGroupData[{

Cell["Tests", "Subsection",
 CellChangeTimes->{{3.82274134191699*^9, 
  3.8227413424933305`*^9}},ExpressionUUID->"825c79bc-d2b8-4567-822a-\
86633231e742"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   TemplateBox[{"1", "2"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], 
   TemplateBox[{"1", "2"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}], "//", "ToChain"}]], "Input",
 CellChangeTimes->{{3.8227414898437276`*^9, 3.8227415115220537`*^9}},
 CellLabel->"In[4]:=",ExpressionUUID->"7dfc6b25-0cdc-4e54-92b7-0a19c8568009"],

Cell[BoxData[
 RowBox[{"-", 
  TemplateBox[{"2", 
    RowBox[{"{", "1", "}"}], "2"},
   "AngleSquareChain",
   DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
   InterpretationFunction->(
    RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square", 
      "]"}]& )]}]], "Output",
 CellChangeTimes->{{3.822741507772069*^9, 3.8227415120840206`*^9}},
 CellLabel->"Out[4]=",ExpressionUUID->"3567cd11-68ad-4d27-9e31-e0099376c4be"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"DeclareMassless", "[", 
  RowBox[{"1", ",", "2"}], "]"}]], "Input",
 CellChangeTimes->{{3.8227415268173*^9, 3.822741531197773*^9}},
 CellLabel->"In[6]:=",ExpressionUUID->"0e4eb29e-4b9d-416c-bd7b-df90fc7ecf39"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"1", ",", "2"}], "}"}]], "Output",
 CellChangeTimes->{3.822741531612982*^9},
 CellLabel->"Out[6]=",ExpressionUUID->"6537dc92-52af-4949-9246-d8190dd7521c"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   TemplateBox[{"1", "2"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], 
   TemplateBox[{"1", "2"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}], "//", "ToChain"}]], "Input",
 CellLabel->"In[28]:=",ExpressionUUID->"22236442-7d99-473e-ad52-c80a7b498e7d"],

Cell[BoxData[
 RowBox[{"-", 
  TemplateBox[{"2", 
    RowBox[{"{", "1", "}"}], "2"},
   "AngleSquareChain",
   DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
   InterpretationFunction->(
    RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square", 
      "]"}]& )]}]], "Output",
 CellChangeTimes->{3.8227415475829477`*^9, 3.8227423392166386`*^9, 
  3.8227423762728214`*^9},
 CellLabel->"Out[28]=",ExpressionUUID->"cd15c529-b638-4481-86f4-84f26736afc2"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"%", "//", "InputForm"}]], "Input",
 CellChangeTimes->{{3.8227423778120246`*^9, 3.8227423806350613`*^9}},
 CellLabel->"In[29]:=",ExpressionUUID->"2c0c344b-a653-40ee-892c-d533c911f9cd"],

Cell["-Chain[$angle, 2, {1}, 2, $square]", "Output",
 CellChangeTimes->{3.8227423809026785`*^9},
 CellLabel->
  "Out[29]//InputForm=",ExpressionUUID->"e640c997-d80e-4960-8513-\
7ac96ee0ab6e"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"%", "//", "ChainToSpinor"}]], "Input",
 CellChangeTimes->{{3.822741520505661*^9, 3.822741523955214*^9}},
 CellLabel->"In[30]:=",ExpressionUUID->"66b6b651-cc54-4462-b66b-732f53c24946"],

Cell[BoxData[
 RowBox[{
  TemplateBox[{"1", "2"},
   "SpinorAngleBracket",
   DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
      RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
   InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
      RowBox[{#, ",", #2}], "]"}]& )], " ", 
  TemplateBox[{"1", "2"},
   "SpinorSquareBracket",
   DisplayFunction->(RowBox[{"[", 
      RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
   InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
      RowBox[{#, ",", #2}], "]"}]& )]}]], "Output",
 CellChangeTimes->{{3.8227415242701693`*^9, 3.8227415483731112`*^9}, 
   3.8227423404791994`*^9, 3.822742387764309*^9},
 CellLabel->"Out[30]=",ExpressionUUID->"ceda1bf9-e998-444d-9d2a-2b1a797ff2f4"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"%", "//", "InputForm"}]], "Input",
 CellChangeTimes->{{3.822742389050742*^9, 3.8227423917017484`*^9}},
 CellLabel->"In[31]:=",ExpressionUUID->"d1b52fc1-d0ad-4ac0-aa64-668da7ae79a3"],

Cell["SpinorAngleBracket[1, 2]*SpinorSquareBracket[1, 2]", "Output",
 CellChangeTimes->{3.8227423920678577`*^9},
 CellLabel->
  "Out[31]//InputForm=",ExpressionUUID->"186f95c0-e6d4-4b58-b0fd-\
78f9867301c7"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"DeclareMom", "[", "]"}]], "Input",
 CellChangeTimes->{{3.822742405091337*^9, 3.8227424080250826`*^9}},
 CellLabel->"In[32]:=",ExpressionUUID->"7da5d810-eecb-4f67-9fb1-8f30d3c95ce2"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"p1", ",", "p2", ",", "p3", ",", "p4"}], "}"}]], "Output",
 CellChangeTimes->{3.822742408495201*^9},
 CellLabel->"Out[32]=",ExpressionUUID->"5ab5c204-d727-497b-8ccd-6d400d4e8243"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"DeclareMassless", "[", 
  RowBox[{"p1", ",", "p2", ",", "p3", ",", "p4"}], "]"}]], "Input",
 CellChangeTimes->{{3.822741625374177*^9, 3.822741632880422*^9}},
 CellLabel->"In[2]:=",ExpressionUUID->"15859a40-ffb1-4eb5-a722-692b0438741e"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"p1", ",", "p2", ",", "p3", ",", "p4"}], "}"}]], "Output",
 CellChangeTimes->{3.822741633995212*^9, 3.8227433154530177`*^9},
 CellLabel->"Out[2]=",ExpressionUUID->"73daabf8-5b27-4c05-b0ba-441711089dae"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"test", "=", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       FractionBox[
        RowBox[{"\[ImaginaryI]", " ", 
         SuperscriptBox[
          TemplateBox[{"p4", 
            RowBox[{"{", "p3", "}"}], "p1"},
           "AngleSquareChain",
           
           DisplayFunction->(
            RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
           
           InterpretationFunction->(
            RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
              "$square", "]"}]& )], "3"]}], 
        RowBox[{"4", " ", 
         TemplateBox[{"p3", 
           RowBox[{"{", "p4", "}"}], "p2"},
          "AngleSquareChain",
          DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
          
          InterpretationFunction->(
           RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
             "$square", "]"}]& )], " ", 
         RowBox[{"S", "[", 
          RowBox[{"p1", ",", "p2"}], "]"}], " ", 
         TemplateBox[{"p3", "p4"},
          "SpinorAngleBracket",
          DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
             RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
          InterpretationFunction->(RowBox[{"Spinoranglebracket", "[", 
             RowBox[{#, ",", #2}], "]"}]& )], " ", 
         TemplateBox[{"p1", "p2"},
          "SpinorSquareBracket",
          DisplayFunction->(RowBox[{"[", 
             RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
          InterpretationFunction->(RowBox[{"Spinorsquarebracket", "[", 
             RowBox[{#, ",", #2}], "]"}]& )]}]], "+", 
       FractionBox[
        RowBox[{"\[ImaginaryI]", " ", 
         SuperscriptBox[
          TemplateBox[{"p2", 
            RowBox[{"{", "p4", "}"}], "p3"},
           "AngleSquareChain",
           
           DisplayFunction->(
            RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
           InterpretationFunction->(
            RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
              "$square", "]"}]& )], "3"]}], 
        RowBox[{"4", " ", 
         TemplateBox[{"p1", 
           RowBox[{"{", "p3", "}"}], "p4"},
          "AngleSquareChain",
          DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
          
          InterpretationFunction->(
           RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
             "$square", "]"}]& )], " ", 
         RowBox[{"S", "[", 
          RowBox[{"p1", ",", "p2"}], "]"}], " ", 
         TemplateBox[{"p1", "p2"},
          "SpinorAngleBracket",
          DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
             RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
          InterpretationFunction->(RowBox[{"Spinoranglebracket", "[", 
             RowBox[{#, ",", #2}], "]"}]& )], " ", 
         TemplateBox[{"p3", "p4"},
          "SpinorSquareBracket",
          DisplayFunction->(RowBox[{"[", 
             RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
          InterpretationFunction->(RowBox[{"Spinorsquarebracket", "[", 
             RowBox[{#, ",", #2}], "]"}]& )]}]]}], ",", 
      FractionBox[
       RowBox[{"\[ImaginaryI]", " ", 
        SuperscriptBox[
         TemplateBox[{"p2", "p4"},
          "SpinorAngleBracket",
          DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
             RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
          InterpretationFunction->(RowBox[{"Spinoranglebracket", "[", 
             RowBox[{#, ",", #2}], "]"}]& )], "3"], " ", 
        SuperscriptBox[
         TemplateBox[{"p1", "p3"},
          "SpinorSquareBracket",
          DisplayFunction->(RowBox[{"[", 
             RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
          InterpretationFunction->(RowBox[{"Spinorsquarebracket", "[", 
             RowBox[{#, ",", #2}], "]"}]& )], "3"]}], 
       RowBox[{"4", " ", 
        TemplateBox[{"p2", 
          RowBox[{"{", "p4", "}"}], "p1"},
         "AngleSquareChain",
         DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
         InterpretationFunction->(
          RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
            "$square", "]"}]& )], " ", 
        TemplateBox[{"p4", 
          RowBox[{"{", "p2", "}"}], "p3"},
         "AngleSquareChain",
         DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
         InterpretationFunction->(
          RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
            "$square", "]"}]& )], " ", 
        RowBox[{"S", "[", 
         RowBox[{"p1", ",", "p3"}], "]"}]}]], ",", "0"}], "}"}], "/.", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Spinoranglebracket", "\[Rule]", "SpinorAngleBracket"}], ",", 
      RowBox[{"Spinorsquarebracket", "\[Rule]", "SpinorSquareBracket"}]}], 
     "}"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"%", "//", "ChainToSpinor"}]}], "Input",
 CellChangeTimes->{{3.822741593397274*^9, 3.8227416615176134`*^9}},
 CellLabel->"In[3]:=",ExpressionUUID->"8294e995-8fe1-45cd-8cf8-0e852b0071b0"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    RowBox[{"-", 
     FractionBox[
      RowBox[{"\[ImaginaryI]", " ", 
       TemplateBox[{"\"p3\"", "\"p4\""},
        "SpinorAngleBracket",
        DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
           RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
        InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
           RowBox[{#, ",", #2}], "]"}]& )], " ", 
       SuperscriptBox[
        TemplateBox[{"\"p1\"", "\"p3\""},
         "SpinorSquareBracket",
         DisplayFunction->(RowBox[{"[", 
            RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
         InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
            RowBox[{#, ",", #2}], "]"}]& )], "3"]}], 
      RowBox[{"4", " ", 
       RowBox[{"S", "[", 
        RowBox[{"p1", ",", "p2"}], "]"}], " ", 
       TemplateBox[{"\"p1\"", "\"p2\""},
        "SpinorSquareBracket",
        DisplayFunction->(RowBox[{"[", 
           RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
        InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
           RowBox[{#, ",", #2}], "]"}]& )], " ", 
       TemplateBox[{"\"p2\"", "\"p4\""},
        "SpinorSquareBracket",
        DisplayFunction->(RowBox[{"[", 
           RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
        InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
           RowBox[{#, ",", #2}], "]"}]& )]}]]}], "-", 
    FractionBox[
     RowBox[{"\[ImaginaryI]", " ", 
      SuperscriptBox[
       TemplateBox[{"\"p2\"", "\"p4\""},
        "SpinorAngleBracket",
        DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
           RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
        InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
           RowBox[{#, ",", #2}], "]"}]& )], "3"], " ", 
      TemplateBox[{"\"p3\"", "\"p4\""},
       "SpinorSquareBracket",
       DisplayFunction->(RowBox[{"[", 
          RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )]}], 
     RowBox[{"4", " ", 
      RowBox[{"S", "[", 
       RowBox[{"p1", ",", "p2"}], "]"}], " ", 
      TemplateBox[{"\"p1\"", "\"p2\""},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], " ", 
      TemplateBox[{"\"p1\"", "\"p3\""},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )]}]]}], ",", 
   FractionBox[
    RowBox[{"\[ImaginaryI]", " ", 
     TemplateBox[{"\"p2\"", "\"p4\""},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], " ", 
     SuperscriptBox[
      TemplateBox[{"\"p1\"", "\"p3\""},
       "SpinorSquareBracket",
       DisplayFunction->(RowBox[{"[", 
          RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], "3"]}], 
    RowBox[{"4", " ", 
     RowBox[{"S", "[", 
      RowBox[{"p1", ",", "p3"}], "]"}], " ", 
     TemplateBox[{"\"p1\"", "\"p4\""},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], " ", 
     TemplateBox[{"\"p2\"", "\"p3\""},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}]], ",", "0"}], "}"}]], "Output",
 CellChangeTimes->{{3.8227415885169725`*^9, 3.8227416133400383`*^9}, {
   3.822741643558902*^9, 3.822741664300703*^9}, 3.8227423046344233`*^9, 
   3.8227433199552374`*^9},
 CellLabel->"Out[4]=",ExpressionUUID->"815614e3-3908-4898-b68a-0a44ea592f29"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  TemplateBox[{"p4", 
    RowBox[{"{", "p3", "}"}], "p1"},
   "AngleSquareChain",
   DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
   InterpretationFunction->(
    RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square", 
      "]"}]& )], "//", "ChainToSpinor"}]], "Input",
 CellChangeTimes->{{3.8227417880521307`*^9, 3.8227418002945743`*^9}},
 CellLabel->"In[18]:=",ExpressionUUID->"f8ff5ae2-5e6f-4af4-8120-01eb3ef96b91"],

Cell[BoxData[
 TemplateBox[{"\"p4\"", 
   RowBox[{"{", "\"p3\"", "}"}], "\"p1\""},
  "AngleSquareChain",
  DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
  InterpretationFunction->(
   RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square", 
     "]"}]& )]], "Output",
 CellChangeTimes->{{3.8227417908190937`*^9, 3.82274180094541*^9}},
 CellLabel->"Out[18]=",ExpressionUUID->"27fd1254-5466-46e2-b59d-4c36b58b24e7"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  TemplateBox[{"p4", 
    RowBox[{"{", "p3", "}"}], "p1"},
   "AngleSquareChain",
   DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
   InterpretationFunction->(
    RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square", 
      "]"}]& )], "//", "InputForm"}]], "Input",
 CellChangeTimes->{{3.822741918222537*^9, 3.8227419222395954`*^9}},
 CellLabel->"In[24]:=",ExpressionUUID->"ea6b31b8-ab65-42fc-92db-30b0d14e1e04"],

Cell["Chain[$angle, \"p4\", {\"p3\"}, \"p1\", $square]", "Output",
 CellChangeTimes->{3.8227419224942207`*^9, 3.822742309566258*^9},
 CellLabel->
  "Out[24]//InputForm=",ExpressionUUID->"aa4bbd94-10d6-4acf-98fd-\
ddfa7721a2f8"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"DeclareMassless", "[", "]"}]], "Input",
 CellChangeTimes->{{3.8227423149495173`*^9, 3.8227423248501024`*^9}},
 CellLabel->"In[25]:=",ExpressionUUID->"4231ce9f-5dc1-4052-86f2-32fbeba61770"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"1", ",", "2", ",", "p1", ",", "p2", ",", "p3", ",", "p4"}], 
  "}"}]], "Output",
 CellChangeTimes->{3.822742325248931*^9},
 CellLabel->"Out[25]=",ExpressionUUID->"f538ec04-04f2-48ec-a968-0642c6bac803"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"MasslessQ", "[", "\"\<p1\>\"", "]"}]], "Input",
 CellChangeTimes->{{3.822742781023696*^9, 3.822742788694872*^9}},
 CellLabel->"In[35]:=",ExpressionUUID->"41056d40-e5a3-41f7-88f5-c34078e2c88f"],

Cell[BoxData["False"], "Output",
 CellChangeTimes->{{3.822742784768015*^9, 3.8227427891882744`*^9}},
 CellLabel->"Out[35]=",ExpressionUUID->"3fe167f9-c812-4868-95ac-18246758f295"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ls", "=", 
  RowBox[{"{", 
   RowBox[{"q1", ",", "\"\<q2\>\"", ",", "\"\<q1\>\""}], "}"}]}]], "Input",
 CellChangeTimes->{{3.822742804181361*^9, 3.8227428205589905`*^9}, {
  3.822742870860794*^9, 3.822742871703347*^9}},
 CellLabel->"In[41]:=",ExpressionUUID->"bb381f56-b91b-42ac-b2f4-f3b827eda3de"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"q1", ",", "\<\"q2\"\>", ",", "\<\"q1\"\>"}], "}"}]], "Output",
 CellChangeTimes->{3.822742821353162*^9, 3.822742872402733*^9},
 CellLabel->"Out[41]=",ExpressionUUID->"447be6e2-ea7f-4099-8548-9f905be44325"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"MemberQ", "[", 
  RowBox[{"ls", ",", 
   RowBox[{"q2", "|", 
    RowBox[{"ToString", "[", "q2", "]"}]}]}], "]"}]], "Input",
 CellChangeTimes->{{3.8227428236972322`*^9, 3.8227428654830627`*^9}},
 CellLabel->"In[42]:=",ExpressionUUID->"270f3f2e-db38-4ac2-bc39-ea8ac853f0f7"],

Cell[BoxData["True"], "Output",
 CellChangeTimes->{{3.8227428320215716`*^9, 3.822742873545144*^9}},
 CellLabel->"Out[42]=",ExpressionUUID->"2ebda9e4-39d6-4727-8d88-efceb051b1fc"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"SpinorBuildingBlocks`Private`MasslessMomentaAll", "//", 
  "InputForm"}]], "Input",
 CellChangeTimes->{{3.8227433861356473`*^9, 3.82274338774811*^9}},
 CellLabel->"In[6]:=",ExpressionUUID->"97fe2021-aedb-4d21-b455-f69c77fa17f8"],

Cell["{p1, p2, p3, p4, \"p1\", \"p2\", \"p3\", \"p4\"}", "Output",
 CellChangeTimes->{{3.822743383920052*^9, 3.8227433880533404`*^9}},
 CellLabel->
  "Out[6]//InputForm=",ExpressionUUID->"a2c0ec66-b71c-4ac7-a176-da656bf708a6"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"DeclareMassless", "[", "]"}]], "Input",
 CellChangeTimes->{{3.8227434375584974`*^9, 3.8227434403796153`*^9}},
 CellLabel->"In[9]:=",ExpressionUUID->"e9e763f2-759c-4e6c-b49e-cadc0cbe6e1e"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"p1", ",", "p2", ",", "p3", ",", "p4"}], "}"}]], "Output",
 CellChangeTimes->{3.822743440918734*^9},
 CellLabel->"Out[9]=",ExpressionUUID->"62fdc27f-d557-472b-9ef7-f3c48dfb0793"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Chain", "[", 
  RowBox[{"$angle", ",", "p1", ",", 
   RowBox[{"{", 
    RowBox[{"p2", ",", "p5"}], "}"}], ",", "p4", ",", "$angle"}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.822743406923547*^9, 3.8227434229575467`*^9}},
 CellLabel->"In[7]:=",ExpressionUUID->"4ee6504d-a9fb-4b94-8a22-ea7fc7a45b5d"],

Cell[BoxData[
 TemplateBox[{"\"p1\"", 
   RowBox[{"{", 
     RowBox[{"\"p2\"", ",", "p5"}], "}"}], "\"p4\""},
  "AngleAngleChain",
  DisplayFunction->(
   RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
  InterpretationFunction->(
   RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle", 
     "]"}]& )]], "Output",
 CellChangeTimes->{3.8227434232749786`*^9},
 CellLabel->"Out[7]=",ExpressionUUID->"5a720822-d898-44fc-be2f-ce85c9a3ca6a"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"%", "//", "ChainToSpinor"}]], "Input",
 CellChangeTimes->{{3.822743424678577*^9, 3.822743427913176*^9}},
 CellLabel->"In[8]:=",ExpressionUUID->"260983e8-cfcf-4735-8927-2b10cdeea709"],

Cell[BoxData[
 RowBox[{
  TemplateBox[{"\"p2\"", 
    RowBox[{"{", "p5", "}"}], "\"p4\""},
   "SquareAngleChain",
   DisplayFunction->(RowBox[{"[", #, #2, #3, "\[RightAngleBracket]"}]& ),
   InterpretationFunction->(
    RowBox[{"Chain", "[", "$square", ",", #, ",", #2, ",", #3, ",", "$angle", 
      "]"}]& )], " ", 
  TemplateBox[{"\"p1\"", "\"p2\""},
   "SpinorAngleBracket",
   DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
      RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
   InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
      RowBox[{#, ",", #2}], "]"}]& )]}]], "Output",
 CellChangeTimes->{3.822743428210419*^9},
 CellLabel->"Out[8]=",ExpressionUUID->"20632c2f-df12-481b-bcf9-cd435bb5136c"]
}, Open  ]]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["ChainMomentumCon", "Section",
 CellChangeTimes->{{3.8261877236830463`*^9, 3.826187726853507*^9}, {
  3.8262584976001*^9, 
  3.8262585016682014`*^9}},ExpressionUUID->"339b6666-88af-461f-a3c5-\
0a037d90bd02"],

Cell[CellGroupData[{

Cell["ChainMomCon old", "Subsection",
 CellChangeTimes->{{3.8261882801892867`*^9, 
  3.8261882845217533`*^9}},ExpressionUUID->"12352be9-3855-4ff4-a132-\
af5ca5bfd65b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "ChainMomCon", "]"}], "=", 
    RowBox[{"{", 
     RowBox[{"MomCon", "->", 
      RowBox[{"{", "}"}]}], "}"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ChainMomCon", "[", 
    RowBox[{"exp_", ",", 
     RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
   RowBox[{"Catch", "[", 
    RowBox[{
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "locexp", ",", "momcon", ",", "Chain", ",", "mom", ",", "mom2"}], 
        "}"}], ",", "\n", 
       RowBox[{
        RowBox[{"momcon", "=", 
         RowBox[{"OptionValue", "[", "MomCon", "]"}]}], ";", "\n", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Head", "[", "momcon", "]"}], "===", "Rule"}], "||", 
           RowBox[{
            RowBox[{"Head", "[", "momcon", "]"}], "==", "RuleDelayed"}]}], 
          ",", 
          RowBox[{"momcon", "=", 
           RowBox[{"{", "momcon", "}"}]}]}], "]"}], ";", "\n", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
          "Before", " ", "applying", " ", "ChainMomCon", " ", "the", " ", 
           "user", " ", "needs", " ", "to", " ", "declare", " ", "which", " ",
            "labels", " ", "are", " ", "momenta"}], ",", " ", 
          RowBox[{
          "which", " ", "will", " ", "be", " ", "used", " ", "to", " ", 
           "impose", " ", "linearity", " ", "for", " ", "the", " ", 
           "Chain"}]}], "*)"}], "\n", 
        RowBox[{"momcon", "=", 
         RowBox[{"momcon", "/.", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"x_", "/;", 
             RowBox[{"MemberQ", "[", 
              RowBox[{"MomList", ",", "x"}], "]"}]}], ":>", 
            RowBox[{"MomPure", "[", "x", "]"}]}], "}"}]}]}], ";", "\n", "\n", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
          "If", " ", "no", " ", "momentum", " ", "conservation", " ", "is", 
           " ", "defined", " ", "return", " ", "the", " ", "original", " ", 
           "expression"}], ",", " ", 
          RowBox[{
          "or", " ", "if", " ", "it", " ", "is", " ", "ill", " ", "defined", 
           " ", "returne", " ", "error", " ", "message", " ", "and", " ", 
           "original", " ", "expression"}]}], "*)"}], "\n", 
        RowBox[{"Which", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "momcon", "]"}], "==", "0"}], ",", "\n", 
          RowBox[{"Throw", "[", "exp", "]"}], ",", "\n", 
          RowBox[{"!", 
           RowBox[{"AllTrue", "[", 
            RowBox[{"momcon", ",", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"Head", "[", "#", "]"}], "===", "Rule"}], "||", 
                RowBox[{
                 RowBox[{"Head", "[", "#", "]"}], "===", "RuleDelayed"}]}], 
               ")"}], "&"}]}], "]"}]}], ",", "\n", 
          RowBox[{
           RowBox[{
           "Print", "[", 
            "\"\<Momentum conservation entered in the wrong format, will \
proceed ignoring it.\>\"", "]"}], ";", "\n", 
           RowBox[{"Throw", "[", "exp", "]"}]}], ",", "\n", "True", ",", "\n", 
          RowBox[{"Null", ";"}]}], "\n", "]"}], ";", "\n", "\n", 
        RowBox[{"(*", 
         RowBox[{
         "Else", " ", "prepare", " ", "the", " ", "chains", " ", "for", " ", 
          "the", " ", "replacements"}], "*)"}], "\n", 
        RowBox[{"locexp", "=", 
         RowBox[{"exp", "/.", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"x_", "/;", 
             RowBox[{"MemberQ", "[", 
              RowBox[{"MomList", ",", "x"}], "]"}]}], ":>", 
            RowBox[{"MomPure", "[", "x", "]"}]}], "}"}]}]}], ";", "\n", "\n", 
        RowBox[{"(*", 
         RowBox[{
         "Define", " ", "the", " ", "linearity", " ", "property", " ", "of", 
          " ", "chains", " ", "with", " ", "respect", " ", "to", " ", "pure", 
          " ", "momenta", " ", "and", " ", "the", " ", "rule", " ", "to", " ",
           "take", " ", "constants", " ", "out", " ", "of", " ", "the", " ", 
          "chains"}], "*)"}], "\n", 
        RowBox[{
         RowBox[{
          RowBox[{"Chain", "[", 
           RowBox[{"type1_", ",", "x1_", ",", 
            RowBox[{"{", 
             RowBox[{"x2___", ",", 
              RowBox[{
               RowBox[{"A_", "*", 
                RowBox[{"MomPure", "[", "y_", "]"}]}], "+", "B_"}], ",", 
              "x3___"}], "}"}], ",", "x4_", ",", "type2_"}], "]"}], "/;", 
          RowBox[{"FreeQ", "[", 
           RowBox[{"A", ",", "MomPure"}], "]"}]}], ":=", 
         RowBox[{
          RowBox[{"A", "*", 
           RowBox[{"Chain", "[", 
            RowBox[{"type1", ",", "x1", ",", 
             RowBox[{"{", 
              RowBox[{"x2", ",", 
               RowBox[{"MomPure", "[", "y", "]"}], ",", "x3"}], "}"}], ",", 
             "x4", ",", "type2"}], "]"}]}], "+", 
          RowBox[{"Chain", "[", 
           RowBox[{"type1", ",", "x1", ",", 
            RowBox[{"{", 
             RowBox[{"x2", ",", "B", ",", "x3"}], "}"}], ",", "x4", ",", 
            "type2"}], "]"}]}]}], ";", "\n", 
        RowBox[{
         RowBox[{"Chain", "[", 
          RowBox[{"type1_", ",", "x1_", ",", 
           RowBox[{"{", 
            RowBox[{"x2___", ",", 
             RowBox[{
              RowBox[{"MomPure", "[", "y_", "]"}], "+", "B_"}], ",", 
             "x3___"}], "}"}], ",", "x4_", ",", "type2_"}], "]"}], ":=", 
         RowBox[{
          RowBox[{"Chain", "[", 
           RowBox[{"type1", ",", "x1", ",", 
            RowBox[{"{", 
             RowBox[{"x2", ",", 
              RowBox[{"MomPure", "[", "y", "]"}], ",", "x3"}], "}"}], ",", 
            "x4", ",", "type2"}], "]"}], "+", 
          RowBox[{"Chain", "[", 
           RowBox[{"type1", ",", "x1", ",", 
            RowBox[{"{", 
             RowBox[{"x2", ",", "B", ",", "x3"}], "}"}], ",", "x4", ",", 
            "type2"}], "]"}]}]}], ";", "\n", 
        RowBox[{
         RowBox[{
          RowBox[{"Chain", "[", 
           RowBox[{"type1_", ",", "x1_", ",", 
            RowBox[{"{", 
             RowBox[{"x2___", ",", 
              RowBox[{"Times", "[", 
               RowBox[{"A_", ",", 
                RowBox[{"MomPure", "[", "y_", "]"}]}], "]"}], ",", "x3___"}], 
             "}"}], ",", "x4_", ",", "type2_"}], "]"}], "/;", 
          RowBox[{"FreeQ", "[", 
           RowBox[{"A", ",", "MomPure"}], "]"}]}], ":=", 
         RowBox[{"A", "*", 
          RowBox[{"Chain", "[", 
           RowBox[{"type1", ",", "x1", ",", 
            RowBox[{"{", 
             RowBox[{"x2", ",", 
              RowBox[{"MomPure", "[", "y", "]"}], ",", "x3"}], "}"}], ",", 
            "x4", ",", "type2"}], "]"}]}]}], ";", "\n", "\n", 
        RowBox[{"(*", 
         RowBox[{
         "Apply", " ", "the", " ", "replacement", " ", "through", " ", 
          "rules"}], "*)"}], "\n", 
        RowBox[{"Do", "[", "\n", 
         RowBox[{
          RowBox[{
           RowBox[{"mom", "=", 
            RowBox[{"First", "[", "i", "]"}]}], ";", "\n", 
           RowBox[{"mom2", "=", 
            RowBox[{"Last", "[", "i", "]"}]}], ";", "\n", "\t\t\t", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{
             "If", " ", "the", " ", "momentum", " ", "to", " ", "be", " ", 
              "replaced", " ", "appears", " ", "at", " ", "the", " ", 
              "extrema", " ", "of", " ", "a", " ", "chain", " ", "which", " ",
               "is", " ", "a", " ", "Dirac", " ", "trace", " ", "we", " ", 
              "can", " ", "move", " ", 
              RowBox[{"it", ".", " ", "Notice"}], " ", "that", " ", "it", " ",
               "must", " ", "be", " ", "replaced", " ", "by", " ", "a", " ", 
              "momentum", " ", "which", " ", "can", " ", "be", " ", "written",
               " ", "in", " ", "terms", " ", "of", " ", "spinors"}], ",", " ", 
             RowBox[{
              RowBox[{"i", ".", "e", ".", " ", "a"}], " ", "massless", " ", 
              "momentum"}]}], "*)"}], "\n", "\t\t", 
           RowBox[{"locexp", "=", 
            RowBox[{"locexp", "/.", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"Chain", "[", 
                 RowBox[{"$angle", ",", "mom", ",", 
                  RowBox[{"{", 
                   RowBox[{"x___", ",", 
                    RowBox[{"y_", "?", "MasslessQ"}], ",", "z___"}], "}"}], 
                  ",", "mom", ",", "$square"}], "]"}], ":>", 
                RowBox[{"Chain", "[", 
                 RowBox[{"$angle", ",", "y", ",", 
                  RowBox[{"{", 
                   RowBox[{"z", ",", "mom", ",", "x"}], "}"}], ",", "y", ",", 
                  "$square"}], "]"}]}], ",", 
               RowBox[{
                RowBox[{"Chain", "[", 
                 RowBox[{"$square", ",", "mom", ",", 
                  RowBox[{"{", 
                   RowBox[{"x___", ",", 
                    RowBox[{"y_", "?", "MasslessQ"}], ",", "z___"}], "}"}], 
                  ",", "mom", ",", "$angle"}], "]"}], ":>", 
                RowBox[{"Chain", "[", 
                 RowBox[{"$square", ",", "y", ",", 
                  RowBox[{"{", 
                   RowBox[{"z", ",", "mom", ",", "x"}], "}"}], ",", "y", ",", 
                  "$angle"}], "]"}]}]}], "}"}]}]}], ";", "\n", 
           RowBox[{"(*", 
            RowBox[{
            "Perform", " ", "the", " ", "actual", " ", "momentum", " ", 
             "conservation", " ", "replacement"}], "*)"}], "\n", 
           RowBox[{"locexp", "=", 
            RowBox[{"locexp", "/.", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"Chain", "[", 
                 RowBox[{"t1_", ",", "x1_", ",", 
                  RowBox[{"{", 
                   RowBox[{"x2___", ",", "mom", ",", "x3___"}], "}"}], ",", 
                  "x4_", ",", "t2_"}], "]"}], ":>", 
                RowBox[{"Chain", "[", 
                 RowBox[{"t1", ",", "x1", ",", 
                  RowBox[{"{", 
                   RowBox[{"x2", ",", "mom2", ",", "x3"}], "}"}], ",", "x4", 
                  ",", "t2"}], "]"}]}], ",", 
               RowBox[{
                RowBox[{"mp", "[", 
                 RowBox[{"mom", ",", "x_"}], "]"}], ":>", 
                RowBox[{"mp", "[", 
                 RowBox[{"mom2", ",", "x"}], "]"}]}]}], "}"}]}]}], ";"}], 
          "\n", "\t\t\t", ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "momcon"}], "}"}]}], "]"}], ";", "\n", "\n", 
        RowBox[{"(*", 
         RowBox[{"Return", " ", "output"}], "*)"}], "\n", 
        RowBox[{"locexp", "=", 
         RowBox[{"locexp", "/.", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"MomPure", "[", "x_", "]"}], ":>", "x"}], "}"}]}]}], ";", 
        "\n", 
        RowBox[{"Return", "[", "locexp", "]"}], ";"}]}], "\n", "]"}], ";"}], 
    "\n", "]"}]}], ";"}]}], "Code",ExpressionUUID->"a5d82bed-4800-48fd-9695-\
68cd8c63331b"]
}, Closed]],

Cell[CellGroupData[{

Cell["ChainMomCon new", "Subsection",
 CellChangeTimes->{{3.8261882801892867`*^9, 3.8261882845217533`*^9}, {
  3.8261890882544985`*^9, 
  3.8261890885287237`*^9}},ExpressionUUID->"9d8e50a3-18b8-4073-9d94-\
7a22842daa6f"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "All", " ", "the", " ", "linearity", " ", "properties", " ", "of", " ", 
   "chains", " ", "are", " ", "by", " ", "now", " ", "incorporated", " ", 
   "in", " ", "their", " ", 
   RowBox[{"definition", ".", " ", "The"}], " ", "only", " ", "real", " ", 
   "thing", " ", "which", " ", "might", " ", "happen", " ", "is", " ", "that",
    " ", "the", " ", "momentum", " ", "to", " ", "be", " ", "replaced", " ", 
   "appears", " ", "as", " ", "the", " ", "extrema", " ", "of", " ", "a", " ",
    "Dirac", " ", 
   RowBox[{"trace", "."}]}], "*)"}]], "Input",
 CellChangeTimes->{{3.8261890913860893`*^9, 
  3.826189157306843*^9}},ExpressionUUID->"5a1fb630-d00c-46dc-8b5b-\
9d00d1b1908e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "ChainMomCon", "]"}], "=", 
    RowBox[{"{", 
     RowBox[{"MomCon", "->", 
      RowBox[{"{", "}"}]}], "}"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ChainMomCon", "[", 
    RowBox[{"exp_", ",", 
     RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
   RowBox[{"Catch", "[", 
    RowBox[{
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "locexp", ",", "momcon", ",", "Chain", ",", "mom", ",", "mom2"}], 
        "}"}], ",", "\n", 
       RowBox[{
        RowBox[{"momcon", "=", 
         RowBox[{"OptionValue", "[", "MomCon", "]"}]}], ";", "\n", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Head", "[", "momcon", "]"}], "===", "Rule"}], "||", 
           RowBox[{
            RowBox[{"Head", "[", "momcon", "]"}], "==", "RuleDelayed"}]}], 
          ",", 
          RowBox[{"momcon", "=", 
           RowBox[{"{", "momcon", "}"}]}]}], "]"}], ";", "\n", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
          "Before", " ", "applying", " ", "ChainMomCon", " ", "the", " ", 
           "user", " ", "needs", " ", "to", " ", "declare", " ", "which", " ",
            "labels", " ", "are", " ", "momenta"}], ",", " ", 
          RowBox[{
          "which", " ", "will", " ", "be", " ", "used", " ", "to", " ", 
           "impose", " ", "linearity", " ", "for", " ", "the", " ", 
           "Chain"}]}], "*)"}], "\n", 
        RowBox[{"momcon", "=", 
         RowBox[{"momcon", "/.", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"x_", "/;", 
             RowBox[{"MemberQ", "[", 
              RowBox[{"MomList", ",", "x"}], "]"}]}], ":>", 
            RowBox[{"MomPure", "[", "x", "]"}]}], "}"}]}]}], ";", "\n", "\n", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
          "If", " ", "no", " ", "momentum", " ", "conservation", " ", "is", 
           " ", "defined", " ", "return", " ", "the", " ", "original", " ", 
           "expression"}], ",", " ", 
          RowBox[{
          "or", " ", "if", " ", "it", " ", "is", " ", "ill", " ", "defined", 
           " ", "returne", " ", "error", " ", "message", " ", "and", " ", 
           "original", " ", "expression"}]}], "*)"}], "\n", 
        RowBox[{"Which", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "momcon", "]"}], "==", "0"}], ",", "\n", 
          RowBox[{"Throw", "[", "exp", "]"}], ",", "\n", 
          RowBox[{"!", 
           RowBox[{"AllTrue", "[", 
            RowBox[{"momcon", ",", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"Head", "[", "#", "]"}], "===", "Rule"}], "||", 
                RowBox[{
                 RowBox[{"Head", "[", "#", "]"}], "===", "RuleDelayed"}]}], 
               ")"}], "&"}]}], "]"}]}], ",", "\n", 
          RowBox[{
           RowBox[{
           "Print", "[", 
            "\"\<Momentum conservation entered in the wrong format, will \
proceed ignoring it.\>\"", "]"}], ";", "\n", 
           RowBox[{"Throw", "[", "exp", "]"}]}], ",", "\n", "True", ",", "\n", 
          RowBox[{"Null", ";"}]}], "\n", "]"}], ";", "\n", "\n", 
        RowBox[{"(*", 
         RowBox[{
         "Else", " ", "prepare", " ", "the", " ", "chains", " ", "for", " ", 
          "the", " ", "replacements"}], "*)"}], "\n", 
        RowBox[{"locexp", "=", 
         RowBox[{"exp", "/.", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"x_", "/;", 
             RowBox[{"MemberQ", "[", 
              RowBox[{"MomList", ",", "x"}], "]"}]}], ":>", 
            RowBox[{"MomPure", "[", "x", "]"}]}], "}"}]}]}], ";", "\n", "\n", 
        RowBox[{"(*", 
         RowBox[{
         "Define", " ", "the", " ", "linearity", " ", "property", " ", "of", 
          " ", "chains", " ", "with", " ", "respect", " ", "to", " ", "pure", 
          " ", "momenta", " ", "and", " ", "the", " ", "rule", " ", "to", " ",
           "take", " ", "constants", " ", "out", " ", "of", " ", "the", " ", 
          "chains"}], "*)"}], "\n", 
        RowBox[{
         RowBox[{
          RowBox[{"Chain", "[", 
           RowBox[{"type1_", ",", "x1_", ",", 
            RowBox[{"{", 
             RowBox[{"x2___", ",", 
              RowBox[{
               RowBox[{"A_", "*", 
                RowBox[{"MomPure", "[", "y_", "]"}]}], "+", "B_"}], ",", 
              "x3___"}], "}"}], ",", "x4_", ",", "type2_"}], "]"}], "/;", 
          RowBox[{"FreeQ", "[", 
           RowBox[{"A", ",", "MomPure"}], "]"}]}], ":=", 
         RowBox[{
          RowBox[{"A", "*", 
           RowBox[{"Chain", "[", 
            RowBox[{"type1", ",", "x1", ",", 
             RowBox[{"{", 
              RowBox[{"x2", ",", 
               RowBox[{"MomPure", "[", "y", "]"}], ",", "x3"}], "}"}], ",", 
             "x4", ",", "type2"}], "]"}]}], "+", 
          RowBox[{"Chain", "[", 
           RowBox[{"type1", ",", "x1", ",", 
            RowBox[{"{", 
             RowBox[{"x2", ",", "B", ",", "x3"}], "}"}], ",", "x4", ",", 
            "type2"}], "]"}]}]}], ";", "\n", 
        RowBox[{
         RowBox[{"Chain", "[", 
          RowBox[{"type1_", ",", "x1_", ",", 
           RowBox[{"{", 
            RowBox[{"x2___", ",", 
             RowBox[{
              RowBox[{"MomPure", "[", "y_", "]"}], "+", "B_"}], ",", 
             "x3___"}], "}"}], ",", "x4_", ",", "type2_"}], "]"}], ":=", 
         RowBox[{
          RowBox[{"Chain", "[", 
           RowBox[{"type1", ",", "x1", ",", 
            RowBox[{"{", 
             RowBox[{"x2", ",", 
              RowBox[{"MomPure", "[", "y", "]"}], ",", "x3"}], "}"}], ",", 
            "x4", ",", "type2"}], "]"}], "+", 
          RowBox[{"Chain", "[", 
           RowBox[{"type1", ",", "x1", ",", 
            RowBox[{"{", 
             RowBox[{"x2", ",", "B", ",", "x3"}], "}"}], ",", "x4", ",", 
            "type2"}], "]"}]}]}], ";", "\n", 
        RowBox[{
         RowBox[{
          RowBox[{"Chain", "[", 
           RowBox[{"type1_", ",", "x1_", ",", 
            RowBox[{"{", 
             RowBox[{"x2___", ",", 
              RowBox[{"Times", "[", 
               RowBox[{"A_", ",", 
                RowBox[{"MomPure", "[", "y_", "]"}]}], "]"}], ",", "x3___"}], 
             "}"}], ",", "x4_", ",", "type2_"}], "]"}], "/;", 
          RowBox[{"FreeQ", "[", 
           RowBox[{"A", ",", "MomPure"}], "]"}]}], ":=", 
         RowBox[{"A", "*", 
          RowBox[{"Chain", "[", 
           RowBox[{"type1", ",", "x1", ",", 
            RowBox[{"{", 
             RowBox[{"x2", ",", 
              RowBox[{"MomPure", "[", "y", "]"}], ",", "x3"}], "}"}], ",", 
            "x4", ",", "type2"}], "]"}]}]}], ";", "\n", "\n", 
        RowBox[{"(*", 
         RowBox[{
         "Apply", " ", "the", " ", "replacement", " ", "through", " ", 
          "rules"}], "*)"}], "\n", 
        RowBox[{"Do", "[", "\n", 
         RowBox[{
          RowBox[{
           RowBox[{"mom", "=", 
            RowBox[{"First", "[", "i", "]"}]}], ";", "\n", 
           RowBox[{"mom2", "=", 
            RowBox[{"Last", "[", "i", "]"}]}], ";", "\n", "\t\t\t", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{
             "If", " ", "the", " ", "momentum", " ", "to", " ", "be", " ", 
              "replaced", " ", "appears", " ", "at", " ", "the", " ", 
              "extrema", " ", "of", " ", "a", " ", "chain", " ", "which", " ",
               "is", " ", "a", " ", "Dirac", " ", "trace", " ", "we", " ", 
              "can", " ", "move", " ", 
              RowBox[{"it", ".", " ", "Notice"}], " ", "that", " ", "it", " ",
               "must", " ", "be", " ", "replaced", " ", "by", " ", "a", " ", 
              "momentum", " ", "which", " ", "can", " ", "be", " ", "written",
               " ", "in", " ", "terms", " ", "of", " ", "spinors"}], ",", " ", 
             RowBox[{
              RowBox[{"i", ".", "e", ".", " ", "a"}], " ", "massless", " ", 
              "momentum"}]}], "*)"}], "\n", "\t\t", 
           RowBox[{"locexp", "=", 
            RowBox[{"locexp", "/.", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"Chain", "[", 
                 RowBox[{"$angle", ",", "mom", ",", 
                  RowBox[{"{", 
                   RowBox[{"x___", ",", 
                    RowBox[{"y_", "?", "MasslessQ"}], ",", "z___"}], "}"}], 
                  ",", "mom", ",", "$square"}], "]"}], ":>", 
                RowBox[{"Chain", "[", 
                 RowBox[{"$angle", ",", "y", ",", 
                  RowBox[{"{", 
                   RowBox[{"z", ",", "mom", ",", "x"}], "}"}], ",", "y", ",", 
                  "$square"}], "]"}]}], ",", 
               RowBox[{
                RowBox[{"Chain", "[", 
                 RowBox[{"$square", ",", "mom", ",", 
                  RowBox[{"{", 
                   RowBox[{"x___", ",", 
                    RowBox[{"y_", "?", "MasslessQ"}], ",", "z___"}], "}"}], 
                  ",", "mom", ",", "$angle"}], "]"}], ":>", 
                RowBox[{"Chain", "[", 
                 RowBox[{"$square", ",", "y", ",", 
                  RowBox[{"{", 
                   RowBox[{"z", ",", "mom", ",", "x"}], "}"}], ",", "y", ",", 
                  "$angle"}], "]"}]}]}], "}"}]}]}], ";", "\n", 
           RowBox[{"(*", 
            RowBox[{
            "Perform", " ", "the", " ", "actual", " ", "momentum", " ", 
             "conservation", " ", "replacement"}], "*)"}], "\n", 
           RowBox[{"locexp", "=", 
            RowBox[{"locexp", "/.", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"Chain", "[", 
                 RowBox[{"t1_", ",", "x1_", ",", 
                  RowBox[{"{", 
                   RowBox[{"x2___", ",", "mom", ",", "x3___"}], "}"}], ",", 
                  "x4_", ",", "t2_"}], "]"}], ":>", 
                RowBox[{"Chain", "[", 
                 RowBox[{"t1", ",", "x1", ",", 
                  RowBox[{"{", 
                   RowBox[{"x2", ",", "mom2", ",", "x3"}], "}"}], ",", "x4", 
                  ",", "t2"}], "]"}]}], ",", 
               RowBox[{
                RowBox[{"mp", "[", 
                 RowBox[{"mom", ",", "x_"}], "]"}], ":>", 
                RowBox[{"mp", "[", 
                 RowBox[{"mom2", ",", "x"}], "]"}]}]}], "}"}]}]}], ";"}], 
          "\n", "\t\t\t", ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "momcon"}], "}"}]}], "]"}], ";", "\n", "\n", 
        RowBox[{"(*", 
         RowBox[{"Return", " ", "output"}], "*)"}], "\n", 
        RowBox[{"locexp", "=", 
         RowBox[{"locexp", "/.", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"MomPure", "[", "x_", "]"}], ":>", "x"}], "}"}]}]}], ";", 
        "\n", 
        RowBox[{"Return", "[", "locexp", "]"}], ";"}]}], "\n", "]"}], ";"}], 
    "\n", "]"}]}], ";"}]}], "Code",ExpressionUUID->"79aa8d99-97d5-46d1-82a3-\
2b40a06449cc"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ChainMomentumCon", "[", 
   RowBox[{"exp_", ",", "rule_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"locexp", ",", "locrule", ",", "mom", ",", "mom2"}], "}"}], ",", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"locexp", "=", "exp"}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Take", " ", "into", " ", "account", " ", "that", " ", "rule", " ", 
       "could", " ", "be", " ", "a", " ", "single", " ", "rule", " ", "or", 
       " ", "a", " ", "list", " ", "of", " ", "rules"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"locrule", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{
        RowBox[{"{", "rule", "}"}], ",", "1"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Convert", " ", "replacements", " ", "into", " ", "lists"}], 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"locrule", "=", 
      RowBox[{
       RowBox[{"List", "@@@", "locrule"}], "//", "Echo"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Perform", " ", "the", " ", "replacements", " ", "sequentially"}], 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Do", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"mom", "=", 
         RowBox[{"First", "@", "i"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"mom2", "=", 
         RowBox[{"Last", "@", "i"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Be", " ", "careful", " ", "that", " ", "extrema", " ", 
          "replacements", " ", "only", " ", "work", " ", "if", " ", "there", 
          " ", "is", " ", "an", " ", "internal", " ", "massless", " ", 
          "momentum", " ", "which", " ", "can", " ", "take", " ", "up", " ", 
          "the", " ", "slot", " ", "of", " ", "extremum"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"locexp", "=", 
         RowBox[{"locexp", "/.", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"Chain", "[", 
              RowBox[{"$angle", ",", "mom", ",", 
               RowBox[{"{", 
                RowBox[{"x___", ",", 
                 RowBox[{"y_", "?", "MasslessQ"}], ",", "z___"}], "}"}], ",", 
               "mom", ",", "$square"}], "]"}], ":>", 
             RowBox[{"Chain", "[", 
              RowBox[{"$angle", ",", "y", ",", 
               RowBox[{"{", 
                RowBox[{"z", ",", "mom", ",", "x"}], "}"}], ",", "y", ",", 
               "$square"}], "]"}]}], ",", 
            RowBox[{
             RowBox[{"Chain", "[", 
              RowBox[{"$square", ",", "mom", ",", 
               RowBox[{"{", 
                RowBox[{"x___", ",", 
                 RowBox[{"y_", "?", "MasslessQ"}], ",", "z___"}], "}"}], ",", 
               "mom", ",", "$angle"}], "]"}], ":>", 
             RowBox[{"Chain", "[", 
              RowBox[{"$square", ",", "y", ",", 
               RowBox[{"{", 
                RowBox[{"z", ",", "mom", ",", "x"}], "}"}], ",", "y", ",", 
               "$angle"}], "]"}]}], ",", 
            RowBox[{
             RowBox[{"Chain", "[", 
              RowBox[{"type1_", ",", "x1_", ",", 
               RowBox[{"{", 
                RowBox[{"y1___", ",", "mom", ",", "y2___"}], "}"}], ",", 
               "x2_", ",", "type2_"}], "]"}], "\[RuleDelayed]", 
             RowBox[{"Chain", "[", 
              RowBox[{"type1", ",", "x1", ",", 
               RowBox[{"{", 
                RowBox[{"y1", ",", "mom2", ",", "y2"}], "}"}], ",", "x2", ",",
                "type2"}], "]"}]}]}], "}"}]}]}], ";"}], "\[IndentingNewLine]",
        "\[IndentingNewLine]", ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "locrule"}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "locexp", "]"}], ";"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.826189161603323*^9, 3.8261891736311355`*^9}, {
   3.8261892065879955`*^9, 3.8261892299415503`*^9}, {3.8261893382834044`*^9, 
   3.8261893848179054`*^9}, {3.8261897850015106`*^9, 3.826190046772176*^9}, {
   3.826190087685199*^9, 3.826190147129974*^9}, {3.8261901964066725`*^9, 
   3.8261903539732428`*^9}, 3.8261904136009455`*^9, {3.8261918302273602`*^9, 
   3.8261918380984974`*^9}, {3.8261920909892735`*^9, 
   3.8261922273507433`*^9}, {3.8261922602049704`*^9, 
   3.8261923349995403`*^9}, {3.826192455332038*^9, 3.8261925055766635`*^9}, {
   3.8261925425417376`*^9, 
   3.8261925788217034`*^9}},ExpressionUUID->"61233cc0-a6ef-45b0-9e19-\
22c38c0f7110"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ChainMomentumCon", "[", 
  RowBox[{
   TemplateBox[{"p1", 
     RowBox[{"{", 
       RowBox[{"p2", ",", "p3", ",", "p5"}], "}"}], "p3"},
    "AngleSquareChain",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square",
        "]"}]& )], ",", 
   RowBox[{"p3", "\[Rule]", 
    RowBox[{"p1", "+", "p2"}]}]}], "]"}]], "Input",
 CellChangeTimes->{{3.8261901512247086`*^9, 3.826190183770132*^9}},
 CellLabel->"In[62]:=",ExpressionUUID->"da4e5c56-149f-4f82-808b-d6e04ef3375c"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"{", 
   RowBox[{"p3", ",", 
    RowBox[{"p1", "+", "p2"}]}], "}"}], "}"}]], "Echo",
 CellChangeTimes->{
  3.826192565080555*^9},ExpressionUUID->"81616a87-0787-455b-9775-\
dbdc496312f8"],

Cell[BoxData["p3"], "Echo",
 CellChangeTimes->{
  3.826192565158143*^9},ExpressionUUID->"ffc09647-6b9b-498b-9e3b-\
d6b5127d1e3c"],

Cell[BoxData[
 RowBox[{"p1", "+", "p2"}]], "Echo",
 CellChangeTimes->{
  3.826192565253129*^9},ExpressionUUID->"44e00c8c-0593-47a6-b9fe-\
f98486a26b7c"],

Cell[BoxData[
 RowBox[{
  TemplateBox[{"\"p1\"", 
    RowBox[{"{", 
      RowBox[{"\"p2\"", ",", "\"p1\"", ",", "p5"}], "}"}], "\"p3\""},
   "AngleSquareChain",
   DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
   InterpretationFunction->(
    RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square", 
      "]"}]& )], "+", 
  TemplateBox[{"\"p1\"", 
    RowBox[{"{", 
      RowBox[{"\"p2\"", ",", "\"p2\"", ",", "p5"}], "}"}], "\"p3\""},
   "AngleSquareChain",
   DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
   InterpretationFunction->(
    RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square", 
      "]"}]& )]}]], "Echo",
 CellChangeTimes->{
  3.8261925653503575`*^9},ExpressionUUID->"3640aa0e-14ee-4c09-9662-\
cfffed85b4ec"]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  TemplateBox[{"\"p1\"", 
    RowBox[{"{", 
      RowBox[{"\"p2\"", ",", "\"p1\"", ",", "p5"}], "}"}], "\"p3\""},
   "AngleSquareChain",
   DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
   InterpretationFunction->(
    RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square", 
      "]"}]& )], "+", 
  TemplateBox[{"\"p1\"", 
    RowBox[{"{", 
      RowBox[{"\"p2\"", ",", "\"p2\"", ",", "p5"}], "}"}], "\"p3\""},
   "AngleSquareChain",
   DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
   InterpretationFunction->(
    RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square", 
      "]"}]& )]}]], "Output",
 CellChangeTimes->{{3.826190184349021*^9, 3.8261903114037304`*^9}, {
   3.8261903439628696`*^9, 3.8261903555061836`*^9}, {3.8261921577124767`*^9, 
   3.8261921813153877`*^9}, {3.8261922200962396`*^9, 3.826192229574374*^9}, {
   3.826192264887314*^9, 3.826192336516646*^9}, 3.8261925654490595`*^9},
 CellLabel->"Out[62]=",ExpressionUUID->"a0766e6d-ac62-4d18-8fee-8ce5561b859f"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Tests", "Subsection",
 CellChangeTimes->{{3.8261932452689943`*^9, 
  3.8261932458813653`*^9}},ExpressionUUID->"83cd5743-cc8e-40d4-aa6c-\
59dc45fc79b4"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"UndeclareMassless", "[", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"UndeclareMom", "[", "]"}], ";"}]}], "Input",
 CellChangeTimes->{{3.826193515419222*^9, 3.826193526051676*^9}},
 CellLabel->"In[18]:=",ExpressionUUID->"df26cdcb-9dbc-458a-b709-847dc22016a8"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "Momentum", " ", "conservation", " ", "is", " ", "applied", " ", "but", " ",
    "if", " ", "the", " ", "momenta", " ", "are", " ", "not", " ", "declared",
    " ", "linearity", " ", "does", " ", "not", " ", "apply"}], 
  "*)"}]], "Input",
 CellChangeTimes->{{3.8261934917008705`*^9, 
  3.826193512831658*^9}},ExpressionUUID->"20eb8d89-b25b-4385-bce5-\
6631ac26a4e3"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ChainMomentumCon", "[", 
  RowBox[{
   TemplateBox[{"p1", 
     RowBox[{"{", 
       RowBox[{"p2", ",", "p3", ",", "p5"}], "}"}], "p3"},
    "AngleSquareChain",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square",
        "]"}]& )], ",", 
   RowBox[{"p3", "\[Rule]", 
    RowBox[{"p1", "+", "p2"}]}]}], "]"}]], "Input",
 CellLabel->"In[20]:=",ExpressionUUID->"f1f48a06-4e77-4d7a-be82-1d6ca9fc1f8e"],

Cell[BoxData[
 TemplateBox[{"p1", 
   RowBox[{"{", 
     RowBox[{"p2", ",", 
       RowBox[{"p1", "+", "p2"}], ",", "p5"}], "}"}], "p3"},
  "AngleSquareChain",
  DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
  InterpretationFunction->(
   RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square", 
     "]"}]& )]], "Output",
 CellChangeTimes->{{3.8261929354646206`*^9, 3.8261929542737017`*^9}, 
   3.8261935281016*^9},
 CellLabel->"Out[20]=",ExpressionUUID->"f0dc35ec-003d-422a-aacb-18219b0b46da"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"DeclareMassless", "[", 
  RowBox[{"p1", ",", "p2", ",", "p3"}], "]"}]], "Input",
 CellChangeTimes->{{3.826192956555971*^9, 3.826192962068795*^9}, {
  3.8261931258978033`*^9, 3.8261931287542057`*^9}, {3.826193534217634*^9, 
  3.826193534834545*^9}},
 CellLabel->"In[21]:=",ExpressionUUID->"9993f243-bafd-4d0f-bb1f-18616cc8f40d"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"p1", ",", "p2", ",", "p3"}], "}"}]], "Output",
 CellChangeTimes->{3.8261929626147313`*^9, 3.8261931300035563`*^9, 
  3.826193540101672*^9},
 CellLabel->"Out[21]=",ExpressionUUID->"fc343393-48b5-4a05-bbd8-7e42cc01406e"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ChainMomentumCon", "[", 
  RowBox[{
   TemplateBox[{"p1", 
     RowBox[{"{", 
       RowBox[{"p2", ",", "p3", ",", "p5"}], "}"}], "p3"},
    "AngleSquareChain",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square",
        "]"}]& )], ",", 
   RowBox[{"p3", "\[Rule]", 
    RowBox[{"p1", "+", "p2"}]}]}], "]"}]], "Input",
 CellLabel->"In[22]:=",ExpressionUUID->"98c82299-c32f-4644-b298-dd80bc6dc4f8"],

Cell[BoxData[
 RowBox[{
  TemplateBox[{"\"p1\"", 
    RowBox[{"{", 
      RowBox[{"\"p2\"", ",", "\"p1\"", ",", "p5"}], "}"}], "\"p3\""},
   "AngleSquareChain",
   DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
   InterpretationFunction->(
    RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square", 
      "]"}]& )], "+", 
  TemplateBox[{"\"p1\"", 
    RowBox[{"{", 
      RowBox[{"\"p2\"", ",", "\"p2\"", ",", "p5"}], "}"}], "\"p3\""},
   "AngleSquareChain",
   DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
   InterpretationFunction->(
    RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square", 
      "]"}]& )]}]], "Output",
 CellChangeTimes->{3.8261929682057576`*^9, 3.8261935421659136`*^9},
 CellLabel->"Out[22]=",ExpressionUUID->"87cf34ea-b86c-43d1-92a3-2544ff02412a"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
   "Replacements", " ", "are", " ", "performed", " ", "also", " ", "when", 
    " ", "the", " ", "omentum", " ", "appears", " ", "as", " ", "an", " ", 
    "extremum", " ", "of", " ", "a", " ", "Dirac", " ", "trace", " ", "in", 
    " ", "chain", " ", "form"}], ",", " ", 
   RowBox[{"upon", " ", "rearranging", " ", "the", " ", "trace"}]}], 
  "*)"}]], "Input",
 CellChangeTimes->{{3.82619355727604*^9, 
  3.8261935923576393`*^9}},ExpressionUUID->"88c0a270-e416-4af7-9309-\
974de219a403"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ChainMomentumCon", "[", 
  RowBox[{
   TemplateBox[{"p1", 
     RowBox[{"{", 
       RowBox[{"p2", ",", "p3", ",", "p5"}], "}"}], "p1"},
    "AngleSquareChain",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square",
        "]"}]& )], ",", 
   RowBox[{"p1", "\[Rule]", 
    RowBox[{"p3", "+", "p5"}]}]}], "]"}]], "Input",
 CellChangeTimes->{{3.8261929825694466`*^9, 3.826192986968149*^9}, {
  3.8261936006958995`*^9, 3.8261936011503983`*^9}},
 CellLabel->"In[23]:=",ExpressionUUID->"b961ab42-ff5c-4bc4-a11e-4f15d90daabc"],

Cell[BoxData[
 RowBox[{
  TemplateBox[{"\"p2\"", 
    RowBox[{"{", 
      RowBox[{"\"p3\"", ",", "p5", ",", "\"p3\""}], "}"}], "\"p2\""},
   "AngleSquareChain",
   DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
   InterpretationFunction->(
    RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square", 
      "]"}]& )], "+", 
  TemplateBox[{"\"p2\"", 
    RowBox[{"{", 
      RowBox[{"\"p3\"", ",", "p5", ",", "p5"}], "}"}], "\"p2\""},
   "AngleSquareChain",
   DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
   InterpretationFunction->(
    RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square", 
      "]"}]& )]}]], "Output",
 CellChangeTimes->{
  3.8261929891981764`*^9, {3.8261931338658805`*^9, 3.826193154070163*^9}, 
   3.8261936018555517`*^9},
 CellLabel->"Out[23]=",ExpressionUUID->"81d98ce3-d1f8-4f49-a9c2-4b4c73fb8db3"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "Rearrangement", " ", "requires", " ", "the", " ", "presence", " ", "of", 
   " ", "amsssless", " ", "momentum", " ", "inside", " ", "the", " ", 
   "chain"}], "*)"}]], "Input",
 CellChangeTimes->{{3.8261936137389*^9, 
  3.826193629739122*^9}},ExpressionUUID->"f4993a4c-46b6-4bcc-8c5b-\
af40097f9eed"],

Cell[BoxData[
 RowBox[{
  RowBox[{"UndeclareMassless", "[", "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.8261936315349245`*^9, 3.8261936370184917`*^9}},
 CellLabel->"In[24]:=",ExpressionUUID->"003ef6dd-3125-4e34-a76f-388d4423b338"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"DeclareMassless", "[", "p1", "]"}]], "Input",
 CellChangeTimes->{{3.8261936384112587`*^9, 3.8261936423678417`*^9}},
 CellLabel->"In[25]:=",ExpressionUUID->"bd457b87-f23e-47cf-b8f1-066584c90109"],

Cell[BoxData[
 RowBox[{"{", "p1", "}"}]], "Output",
 CellChangeTimes->{3.826193642610838*^9},
 CellLabel->"Out[25]=",ExpressionUUID->"0a8c0ed7-71f3-471d-9700-812a9b36f8d8"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ChainMomentumCon", "[", 
  RowBox[{
   TemplateBox[{"p1", 
     RowBox[{"{", 
       RowBox[{"p2", ",", "p3", ",", "p5"}], "}"}], "p1"},
    "AngleSquareChain",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square",
        "]"}]& )], ",", 
   RowBox[{"p1", "\[Rule]", 
    RowBox[{"p3", "+", "p5"}]}]}], "]"}]], "Input",
 CellLabel->"In[26]:=",ExpressionUUID->"48d3f0b3-d1ce-4283-a295-1fc58b0c135e"],

Cell[BoxData[
 TemplateBox[{"\"p1\"", 
   RowBox[{"{", 
     RowBox[{"\"p2\"", ",", "\"p3\"", ",", "p5"}], "}"}], "\"p1\""},
  "AngleSquareChain",
  DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
  InterpretationFunction->(
   RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square", 
     "]"}]& )]], "Output",
 CellChangeTimes->{3.826193650510769*^9},
 CellLabel->"Out[26]=",ExpressionUUID->"6ad178fc-ea8c-45b9-8416-0a9822295057"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"DeclareMassless", "[", "p2", "]"}]], "Input",
 CellChangeTimes->{{3.8261936533148174`*^9, 3.8261936608498526`*^9}},
 CellLabel->"In[27]:=",ExpressionUUID->"57d521e4-469c-472e-bc5e-710f1785f716"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"p1", ",", "p2"}], "}"}]], "Output",
 CellChangeTimes->{3.826193662356659*^9},
 CellLabel->"Out[27]=",ExpressionUUID->"e347e2a8-dc44-4080-ba79-ddd04f8c94df"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
   "Upon", " ", "declaring", " ", "p2", " ", "as", " ", "massless", " ", 
    "this", " ", "is", " ", "now", " ", "suitable", " ", "to", " ", "be", " ",
     "the", " ", "new", " ", "extremum", " ", "of", " ", "the", " ", 
    "chain"}], ",", " ", 
   RowBox[{
   "so", " ", "this", " ", "is", " ", "rearranged", " ", "and", " ", "p1", 
    " ", "replaced"}]}], "*)"}]], "Input",
 CellChangeTimes->{{3.826193673153937*^9, 
  3.8261936995524693`*^9}},ExpressionUUID->"8445c7ab-bb81-4b24-880b-\
e443d0c7e5e1"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ChainMomentumCon", "[", 
  RowBox[{
   TemplateBox[{"p1", 
     RowBox[{"{", 
       RowBox[{"p2", ",", "p3", ",", "p5"}], "}"}], "p1"},
    "AngleSquareChain",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square",
        "]"}]& )], ",", 
   RowBox[{"p1", "\[Rule]", 
    RowBox[{"p3", "+", "p5"}]}]}], "]"}]], "Input",
 CellLabel->"In[28]:=",ExpressionUUID->"9903d5d6-b6f3-416d-acbc-17d63f11f4b8"],

Cell[BoxData[
 RowBox[{
  TemplateBox[{"\"p2\"", 
    RowBox[{"{", 
      RowBox[{"\"p3\"", ",", "p5", ",", "\"p3\""}], "}"}], "\"p2\""},
   "AngleSquareChain",
   DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
   InterpretationFunction->(
    RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square", 
      "]"}]& )], "+", 
  TemplateBox[{"\"p2\"", 
    RowBox[{"{", 
      RowBox[{"\"p3\"", ",", "p5", ",", "p5"}], "}"}], "\"p2\""},
   "AngleSquareChain",
   DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
   InterpretationFunction->(
    RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square", 
      "]"}]& )]}]], "Output",
 CellChangeTimes->{3.826193667918107*^9},
 CellLabel->"Out[28]=",ExpressionUUID->"5682f636-cc7c-4dc9-b1a9-60ace8f9a0b1"]
}, Open  ]]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["ChainSort", "Section",
 CellChangeTimes->{{3.826258519361849*^9, 
  3.8262585217694116`*^9}},ExpressionUUID->"a5fbe05a-325b-41ae-bdd5-\
14ce4be141bb"],

Cell[CellGroupData[{

Cell["ChainOrder", "Subsection",ExpressionUUID->"b0ef0f54-cbec-4d4d-92a6-4338b688977c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Auxiliary", " ", "function", " ", "whivh", " ", "simply", " ", "reorders",
     " ", "the", " ", "momenta", " ", "in", " ", "chains"}], "*)"}], "\n", 
  "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"ChainOrder", "[", "exp_", "]"}], ":=", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"Chain", ",", "locexp"}], "}"}], ",", "\n", 
      RowBox[{"(*", 
       RowBox[{
       "Define", " ", "properties", " ", "which", " ", "reorder", " ", "the", 
        " ", "chains", " ", "with", " ", "momenta", " ", "in", " ", 
        "canonical", " ", "order"}], "*)"}], "\n", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Chain", "[", 
          RowBox[{"type_", ",", "x1_", ",", 
           RowBox[{"{", 
            RowBox[{"y1___", ",", "z1_", ",", "z2_", ",", "y2___"}], "}"}], 
           ",", "x2_", ",", "type2_"}], "]"}], "/;", 
         RowBox[{"OrderedQ", "[", 
          RowBox[{"{", 
           RowBox[{"z2", ",", "z1"}], "}"}], "]"}]}], ":=", 
        RowBox[{
         RowBox[{"2", "*", 
          RowBox[{"mp", "[", 
           RowBox[{"z1", ",", "z2"}], "]"}], "*", 
          RowBox[{"Chain", "[", 
           RowBox[{"type", ",", "x1", ",", 
            RowBox[{"{", 
             RowBox[{"y1", ",", "y2"}], "}"}], ",", "x2", ",", "type2"}], 
           "]"}]}], "-", 
         RowBox[{"Chain", "[", 
          RowBox[{"type", ",", "x1", ",", 
           RowBox[{"{", 
            RowBox[{"y1", ",", "z2", ",", "z1", ",", "y2"}], "}"}], ",", "x2",
            ",", "type2"}], "]"}]}]}], ";", "\n", 
       RowBox[{"(*", 
        RowBox[{
        "Chains", " ", "which", " ", "reduce", " ", "to", " ", "Dirac", " ", 
         "traces", " ", "can", " ", "be", " ", "further", " ", "simplified", 
         " ", "including", " ", "also", " ", "the", " ", "extrema", " ", "in",
          " ", "the", " ", 
         RowBox[{"ordering", ".", " ", "Here"}], " ", "however", " ", "you", 
         " ", "need", " ", "to", " ", "be", " ", "carefull", " ", "because", 
         " ", "the", " ", "traces", " ", "are", " ", "chiral", " ", "so", " ",
          "there", " ", "is", " ", "a", " ", "hidden", " ", 
         RowBox[{"gamma5", "!"}], " ", "In", " ", "other", " ", "words", " ", 
         "if", " ", "y3", " ", "and", " ", "y1", " ", "are", " ", "of", " ", 
         "even", " ", "length", " ", "the", " ", "angle", " ", "and", " ", 
         "square", " ", "brackets", " ", "swap", " ", "roles"}], "*)"}], "\n", 
       RowBox[{
        RowBox[{
         RowBox[{"Chain", "[", 
          RowBox[{"$angle", ",", "x_", ",", 
           RowBox[{"{", 
            RowBox[{"y1___", ",", "y2_", ",", "y3___"}], "}"}], ",", "x_", 
           ",", "$square"}], "]"}], "/;", 
         RowBox[{
          RowBox[{"AnyTrue", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"y1", ",", "y2", ",", "y3"}], "}"}], ",", "MasslessQ"}], 
           "]"}], "&&", 
          RowBox[{
           RowBox[{"First", "[", 
            RowBox[{"Sort", "[", 
             RowBox[{"Select", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"y1", ",", "y2", ",", "y3"}], "}"}], ",", 
               "MasslessQ"}], "]"}], "]"}], "]"}], "===", "y2"}], "&&", 
          RowBox[{"OrderedQ", "[", 
           RowBox[{"{", 
            RowBox[{"y2", ",", "x"}], "}"}], "]"}]}]}], ":=", "\n", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"OddQ", "[", 
           RowBox[{"Length", "[", 
            RowBox[{"{", "y3", "}"}], "]"}], "]"}], ",", "\n", 
          RowBox[{"Chain", "[", 
           RowBox[{"$angle", ",", "y2", ",", 
            RowBox[{"{", 
             RowBox[{"y3", ",", "x", ",", "y1"}], "}"}], ",", "y2", ",", 
            "$square"}], "]"}], ",", "\n", 
          RowBox[{"Chain", "[", 
           RowBox[{"$square", ",", "y2", ",", 
            RowBox[{"{", 
             RowBox[{"y3", ",", "x", ",", "y1"}], "}"}], ",", "y2", ",", 
            "$angle"}], "]"}]}], "]"}]}], ";", "\n", 
       RowBox[{
        RowBox[{
         RowBox[{"Chain", "[", 
          RowBox[{"$square", ",", "x_", ",", 
           RowBox[{"{", 
            RowBox[{"y1___", ",", "y2_", ",", "y3___"}], "}"}], ",", "x_", 
           ",", "$angle"}], "]"}], "/;", 
         RowBox[{
          RowBox[{"AnyTrue", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"y1", ",", "y2", ",", "y3"}], "}"}], ",", "MasslessQ"}], 
           "]"}], "&&", 
          RowBox[{
           RowBox[{"First", "[", 
            RowBox[{"Sort", "[", 
             RowBox[{"Select", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"y1", ",", "y2", ",", "y3"}], "}"}], ",", 
               "MasslessQ"}], "]"}], "]"}], "]"}], "===", "y2"}], "&&", 
          RowBox[{"OrderedQ", "[", 
           RowBox[{"{", 
            RowBox[{"y2", ",", "x"}], "}"}], "]"}]}]}], ":=", "\n", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"OddQ", "[", 
           RowBox[{"Length", "[", 
            RowBox[{"{", "y3", "}"}], "]"}], "]"}], ",", "\n", 
          RowBox[{"Chain", "[", 
           RowBox[{"$square", ",", "y2", ",", 
            RowBox[{"{", 
             RowBox[{"y3", ",", "x", ",", "y1"}], "}"}], ",", "y2", ",", 
            "$angle"}], "]"}], ",", "\n", 
          RowBox[{"Chain", "[", 
           RowBox[{"$angle", ",", "y2", ",", 
            RowBox[{"{", 
             RowBox[{"y3", ",", "x", ",", "y1"}], "}"}], ",", "y2", ",", 
            "$square"}], "]"}]}], "]"}]}], ";", "\n", 
       RowBox[{"locexp", "=", "exp"}], ";", "\n", 
       RowBox[{"Return", "[", "locexp", "]"}], ";"}]}], "\n", "]"}]}], 
   ";"}]}]], "Code",
 CellLabel->"In[18]:=",ExpressionUUID->"04b9025e-6bf4-446d-b8d2-3af5dd131498"]
}, Closed]],

Cell[CellGroupData[{

Cell["ChainOrder new, now ChainSort", "Subsection",
 CellChangeTimes->{{3.8261938226971884`*^9, 3.826193823222538*^9}, {
  3.8261941548172655`*^9, 
  3.826194159656334*^9}},ExpressionUUID->"96843218-e7ab-4611-8e6f-\
c05413a8dba8"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "Only", " ", "removed", " ", "an", " ", "unnecessary", " ", "local", " ", 
   "variable"}], "*)"}]], "Input",
 CellChangeTimes->{{3.826194000027609*^9, 
  3.8261940135370245`*^9}},ExpressionUUID->"ffd214a2-bf1f-4b1e-8738-\
719eff8856e2"],

Cell[BoxData[
 RowBox[{"Clear", "[", "ChainSort2", "]"}]], "Input",
 CellChangeTimes->{{3.8262625128249164`*^9, 3.8262625192459636`*^9}},
 CellLabel->"In[9]:=",ExpressionUUID->"88bb10bf-2cf0-4b26-82c7-4127163d572c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Auxiliary", " ", "function", " ", "whivh", " ", "simply", " ", "reorders",
     " ", "the", " ", "momenta", " ", "in", " ", "chains"}], "*)"}], "\n", 
  "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"ChainSort2", "[", 
     RowBox[{"exp_", ",", 
      RowBox[{"order_List", ":", 
       RowBox[{"{", "}"}]}]}], "]"}], ":=", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"Chain", ",", "SHorderedQ", ",", "SHlistordering"}], "}"}], 
      ",", "\n", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Pick", " ", "sorting", " ", 
         RowBox[{"criterion", ".", " ", "If"}], " ", "a", " ", "non"}], "-", 
        RowBox[{
        "empty", " ", "list", " ", "of", " ", "labels", " ", "is", " ", 
         "given", " ", "we", " ", "use", " ", "this", " ", "to", " ", "sort", 
         " ", "the", " ", "chains"}]}], "*)"}], "\n", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "order", "]"}], ">", "0"}], ",", "\n", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"Custom", " ", "order"}], ",", " ", 
           RowBox[{
           "in", " ", "order", " ", "to", " ", "take", " ", "into", " ", 
            "account", " ", "that", " ", "some", " ", "of", " ", "the", " ", 
            "elements", " ", "in", " ", "the", " ", "chain", " ", "may", " ", 
            "be", " ", "missing", " ", "from", " ", "the", " ", "list", " ", 
            "we", " ", "need", " ", "to", " ", "check", " ", "momenta", " ", 
            "which", " ", "are", " ", "far", " ", "apart"}]}], " ", "*)"}], 
         "\n", 
         RowBox[{
          RowBox[{"SHlistordering", "=", 
           RowBox[{"Flatten", "[", 
            RowBox[{"Transpose", "@", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"ToString", "/@", "order"}], ",", "order"}], "}"}]}], 
            "]"}]}], ";", "\n", 
          RowBox[{"SHorderedQ", "=", 
           RowBox[{
            RowBox[{"OrderedQ", "[", 
             RowBox[{"#", ",", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"First", "@", 
                  RowBox[{"(", 
                   RowBox[{"FirstPosition", "[", 
                    RowBox[{"SHlistordering", ",", "#2"}], "]"}], ")"}]}], 
                 "\[GreaterEqual]", 
                 RowBox[{"First", "@", 
                  RowBox[{"(", 
                   RowBox[{"FirstPosition", "[", 
                    RowBox[{"SHlistordering", ",", "#1"}], "]"}], ")"}]}]}], 
                "&"}], ")"}]}], "]"}], "&"}]}], ";", "\n", "\n", 
          RowBox[{"(*", 
           RowBox[{
           "Define", " ", "properties", " ", "which", " ", "reorder", " ", 
            "the", " ", "chains", " ", "with", " ", "momenta", " ", "in", " ",
             "prescibed", " ", "order"}], "*)"}], "\n", 
          RowBox[{
           RowBox[{
            RowBox[{"Chain", "[", 
             RowBox[{"type_", ",", "x1_", ",", 
              RowBox[{"{", 
               RowBox[{"y1___", ",", 
                RowBox[{"z1_", "?", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"MemberQ", "[", 
                    RowBox[{"SHlistordering", ",", "#"}], "]"}], "&"}], 
                  ")"}]}], ",", 
                RowBox[{"z2_", "?", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"MemberQ", "[", 
                    RowBox[{"SHlistordering", ",", "#"}], "]"}], "&"}], 
                  ")"}]}], ",", "y2___"}], "}"}], ",", "x2_", ",", "type2_"}],
              "]"}], "/;", 
            RowBox[{"!", 
             RowBox[{"SHorderedQ", "[", 
              RowBox[{"{", 
               RowBox[{"z1", ",", "z2"}], "}"}], "]"}]}]}], ":=", 
           RowBox[{
            RowBox[{"2", "*", 
             RowBox[{"mp", "[", 
              RowBox[{"z1", ",", "z2"}], "]"}], "*", 
             RowBox[{"Chain", "[", 
              RowBox[{"type", ",", "x1", ",", 
               RowBox[{"{", 
                RowBox[{"y1", ",", "y2"}], "}"}], ",", "x2", ",", "type2"}], 
              "]"}]}], "-", 
            RowBox[{"Chain", "[", 
             RowBox[{"type", ",", "x1", ",", 
              RowBox[{"{", 
               RowBox[{"y1", ",", "z2", ",", "z1", ",", "y2"}], "}"}], ",", 
              "x2", ",", "type2"}], "]"}]}]}], ";", "\n", 
          RowBox[{
           RowBox[{
            RowBox[{"Chain", "[", 
             RowBox[{"type_", ",", "x1_", ",", 
              RowBox[{"{", 
               RowBox[{"y1___", ",", 
                RowBox[{"z1_", "?", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"MemberQ", "[", 
                    RowBox[{"SHlistordering", ",", "#"}], "]"}], "&"}], 
                  ")"}]}], ",", "y3___", ",", "y4_", ",", 
                RowBox[{"z2_", "?", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"MemberQ", "[", 
                    RowBox[{"SHlistordering", ",", "#"}], "]"}], "&"}], 
                  ")"}]}], ",", "y2___"}], "}"}], ",", "x2_", ",", "type2_"}],
              "]"}], "/;", 
            RowBox[{"!", 
             RowBox[{"SHorderedQ", "[", 
              RowBox[{"{", 
               RowBox[{"z1", ",", "z2"}], "}"}], "]"}]}]}], ":=", 
           RowBox[{
            RowBox[{"2", "*", 
             RowBox[{"mp", "[", 
              RowBox[{"y4", ",", "z2"}], "]"}], "*", 
             RowBox[{"Chain", "[", 
              RowBox[{"type", ",", "x1", ",", 
               RowBox[{"{", 
                RowBox[{"y1", ",", "z1", ",", "y3", ",", "y2"}], "}"}], ",", 
               "x2", ",", "type2"}], "]"}]}], "-", 
            RowBox[{"Chain", "[", 
             RowBox[{"type", ",", "x1", ",", 
              RowBox[{"{", 
               RowBox[{
               "y1", ",", "z1", ",", "y3", ",", "z2", ",", "y4", ",", "y2"}], 
               "}"}], ",", "x2", ",", "type2"}], "]"}]}]}], ";", "\n", "\n", 
          RowBox[{"(*", 
           RowBox[{
           "Dirac", " ", "traces", " ", "can", " ", "also", " ", "have", " ", 
            "the", " ", "extrema", " ", "reordered"}], "*)"}], "\n", "\n", 
          RowBox[{
           RowBox[{
            RowBox[{"Chain", "[", 
             RowBox[{"$angle", ",", 
              RowBox[{"x_", "?", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"MemberQ", "[", 
                  RowBox[{"SHlistordering", ",", "#"}], "]"}], "&"}], ")"}]}],
               ",", 
              RowBox[{"{", 
               RowBox[{"y1___", ",", 
                RowBox[{"y2_", "?", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"MemberQ", "[", 
                    RowBox[{"SHlistordering", ",", "#"}], "]"}], "&&", 
                    RowBox[{"MasslessQ", "[", "#", "]"}]}], ")"}], "&"}], 
                  ")"}]}], ",", "y3___"}], "}"}], ",", "x_", ",", "$square"}],
              "]"}], "/;", " ", 
            RowBox[{"!", 
             RowBox[{"SHorderedQ", "[", 
              RowBox[{"{", 
               RowBox[{"x", ",", "y2"}], "}"}], "]"}]}]}], ":=", 
           RowBox[{"Chain", "[", 
            RowBox[{"$angle", ",", "y2", ",", 
             RowBox[{"{", 
              RowBox[{"y3", ",", "x", ",", "y1"}], "}"}], ",", "y2", ",", 
             "$square"}], "]"}]}], ";", "\n", 
          RowBox[{
           RowBox[{
            RowBox[{"Chain", "[", 
             RowBox[{"$square", ",", 
              RowBox[{"x_", "?", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"MemberQ", "[", 
                  RowBox[{"SHlistordering", ",", "#"}], "]"}], "&"}], ")"}]}],
               ",", 
              RowBox[{"{", 
               RowBox[{"y1___", ",", 
                RowBox[{"y2_", "?", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"MemberQ", "[", 
                    RowBox[{"SHlistordering", ",", "#"}], "]"}], "&&", 
                    RowBox[{"MasslessQ", "[", "#", "]"}]}], ")"}], "&"}], 
                  ")"}]}], ",", "y3___"}], "}"}], ",", "x_", ",", "$angle"}], 
             "]"}], "/;", " ", 
            RowBox[{"!", 
             RowBox[{"SHorderedQ", "[", 
              RowBox[{"{", 
               RowBox[{"x", ",", "y2"}], "}"}], "]"}]}]}], ":=", 
           RowBox[{"Chain", "[", 
            RowBox[{"$square", ",", "y2", ",", 
             RowBox[{"{", 
              RowBox[{"y3", ",", "x", ",", "y1"}], "}"}], ",", "y2", ",", 
             "$angle"}], "]"}]}], ";"}], "\n", "\n", 
         RowBox[{"(*", 
          RowBox[{"(*", 
           RowBox[{
           "Chains", " ", "which", " ", "reduce", " ", "to", " ", "Dirac", 
            " ", "traces", " ", "can", " ", "be", " ", "further", " ", 
            "simplified", " ", "including", " ", "also", " ", "the", " ", 
            "extrema", " ", "in", " ", "the", " ", 
            RowBox[{"ordering", ".", " ", "Here"}], " ", "however", " ", 
            "you", " ", "need", " ", "to", " ", "be", " ", "carefull", " ", 
            "because", " ", "the", " ", "traces", " ", "are", " ", "chiral", 
            " ", "so", " ", "there", " ", "is", " ", "a", " ", "hidden", " ", 
            RowBox[{"gamma5", "!"}], " ", "In", " ", "other", " ", "words", 
            " ", "if", " ", "y3", " ", "and", " ", "y1", " ", "are", " ", 
            "of", " ", "even", " ", "length", " ", "the", " ", "angle", " ", 
            "and", " ", "square", " ", "brackets", " ", "swap", " ", 
            "roles"}], "*)"}], "\n", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Chain", "[", 
              RowBox[{"$angle", ",", 
               RowBox[{"x_", "?", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"MemberQ", "[", 
                   RowBox[{"SHlistordering", ",", "#"}], "]"}], "&"}], 
                 ")"}]}], ",", 
               RowBox[{"{", 
                RowBox[{"y1___", ",", 
                 RowBox[{"y2_", "?", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"MemberQ", "[", 
                    RowBox[{"SHlistordering", ",", "#"}], "]"}], "&"}], 
                   ")"}]}], ",", "y3___"}], "}"}], ",", "x_", ",", 
               "$square"}], "]"}], "/;", 
             RowBox[{
              RowBox[{"AnyTrue", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"y1", ",", "y2", ",", "y3"}], "}"}], ",", 
                "MasslessQ"}], "]"}], "&&", 
              RowBox[{
               RowBox[{"First", "[", 
                RowBox[{"Sort", "[", 
                 RowBox[{"Select", "[", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"y1", ",", "y2", ",", "y3"}], "}"}], ",", 
                   "MasslessQ"}], "]"}], "]"}], "]"}], "===", "y2"}], "&&", 
              RowBox[{"!", 
               RowBox[{"SHorderedQ", "[", 
                RowBox[{"{", 
                 RowBox[{"x", ",", "y2"}], "}"}], "]"}]}]}]}], ":=", "\n", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"OddQ", "[", 
               RowBox[{"Length", "[", 
                RowBox[{"{", "y3", "}"}], "]"}], "]"}], ",", "\n", 
              RowBox[{"Chain", "[", 
               RowBox[{"$angle", ",", "y2", ",", 
                RowBox[{"{", 
                 RowBox[{"y3", ",", "x", ",", "y1"}], "}"}], ",", "y2", ",", 
                "$square"}], "]"}], ",", "\n", 
              RowBox[{"Chain", "[", 
               RowBox[{"$square", ",", "y2", ",", 
                RowBox[{"{", 
                 RowBox[{"y3", ",", "x", ",", "y1"}], "}"}], ",", "y2", ",", 
                "$angle"}], "]"}]}], "]"}]}], ";", "\n", 
           RowBox[{
            RowBox[{
             RowBox[{"Chain", "[", 
              RowBox[{"$square", ",", 
               RowBox[{"x_", "?", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"MemberQ", "[", 
                   RowBox[{"SHlistordering", ",", "#"}], "]"}], "&"}], 
                 ")"}]}], ",", 
               RowBox[{"{", 
                RowBox[{"y1___", ",", 
                 RowBox[{"y2_", "?", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"MemberQ", "[", 
                    RowBox[{"SHlistordering", ",", "#"}], "]"}], "&"}], 
                   ")"}]}], ",", "y3___"}], "}"}], ",", "x_", ",", "$angle"}],
               "]"}], "/;", 
             RowBox[{
              RowBox[{"AnyTrue", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"y1", ",", "y2", ",", "y3"}], "}"}], ",", 
                "MasslessQ"}], "]"}], "&&", 
              RowBox[{
               RowBox[{"First", "[", 
                RowBox[{"Sort", "[", 
                 RowBox[{"Select", "[", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"y1", ",", "y2", ",", "y3"}], "}"}], ",", 
                   "MasslessQ"}], "]"}], "]"}], "]"}], "===", "y2"}], "&&", 
              RowBox[{"!", 
               RowBox[{"SHorderedQ", "[", 
                RowBox[{"{", 
                 RowBox[{"x", ",", "y2"}], "}"}], "]"}]}]}]}], ":=", "\n", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"OddQ", "[", 
               RowBox[{"Length", "[", 
                RowBox[{"{", "y3", "}"}], "]"}], "]"}], ",", "\n", 
              RowBox[{"Chain", "[", 
               RowBox[{"$square", ",", "y2", ",", 
                RowBox[{"{", 
                 RowBox[{"y3", ",", "x", ",", "y1"}], "}"}], ",", "y2", ",", 
                "$angle"}], "]"}], ",", "\n", 
              RowBox[{"Chain", "[", 
               RowBox[{"$angle", ",", "y2", ",", 
                RowBox[{"{", 
                 RowBox[{"y3", ",", "x", ",", "y1"}], "}"}], ",", "y2", ",", 
                "$square"}], "]"}]}], "]"}]}], ";"}], "*)"}], "\n", "\n", 
         "\n", ",", "\n", "\n", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"Canonical", " ", "ordering"}], ",", " ", 
           RowBox[{"easy", " ", "case"}], ",", " ", 
           RowBox[{
           "criteria", " ", "checked", " ", "on", " ", "adjacient", " ", 
            "elements"}]}], "*)"}], "\n", 
         RowBox[{
          RowBox[{"SHorderedQ", "=", "OrderedQ"}], ";", "\n", "\n", 
          RowBox[{"(*", 
           RowBox[{
           "Define", " ", "properties", " ", "which", " ", "reorder", " ", 
            "the", " ", "chains", " ", "with", " ", "momenta", " ", "in", " ",
             "prescibed", " ", "order"}], "*)"}], "\n", 
          RowBox[{
           RowBox[{
            RowBox[{"Chain", "[", 
             RowBox[{"type_", ",", "x1_", ",", 
              RowBox[{"{", 
               RowBox[{"y1___", ",", "z1_", ",", "z2_", ",", "y2___"}], "}"}],
               ",", "x2_", ",", "type2_"}], "]"}], "/;", 
            RowBox[{"!", 
             RowBox[{"OrderedQ", "[", 
              RowBox[{"{", 
               RowBox[{"z1", ",", "z2"}], "}"}], "]"}]}]}], ":=", 
           RowBox[{
            RowBox[{"2", "*", 
             RowBox[{"mp", "[", 
              RowBox[{"z1", ",", "z2"}], "]"}], "*", 
             RowBox[{"Chain", "[", 
              RowBox[{"type", ",", "x1", ",", 
               RowBox[{"{", 
                RowBox[{"y1", ",", "y2"}], "}"}], ",", "x2", ",", "type2"}], 
              "]"}]}], "-", 
            RowBox[{"Chain", "[", 
             RowBox[{"type", ",", "x1", ",", 
              RowBox[{"{", 
               RowBox[{"y1", ",", "z2", ",", "z1", ",", "y2"}], "}"}], ",", 
              "x2", ",", "type2"}], "]"}]}]}], ";", "\n", "\n", "\n", 
          RowBox[{"(*", 
           RowBox[{
           "Dirac", " ", "traces", " ", "can", " ", "also", " ", "have", " ", 
            "the", " ", "extrema", " ", "reordered"}], "*)"}], "\n", "\n", 
          RowBox[{
           RowBox[{
            RowBox[{"Chain", "[", 
             RowBox[{"$angle", ",", "x_", ",", 
              RowBox[{"{", 
               RowBox[{"y1___", ",", 
                RowBox[{"y2_", "?", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"MasslessQ", "[", "#", "]"}], "&"}], ")"}]}], ",", 
                "y3___"}], "}"}], ",", "x_", ",", "$square"}], "]"}], "/;", 
            " ", 
            RowBox[{"!", 
             RowBox[{"SHorderedQ", "[", 
              RowBox[{"{", 
               RowBox[{"x", ",", "y2"}], "}"}], "]"}]}]}], ":=", 
           RowBox[{"Chain", "[", 
            RowBox[{"$angle", ",", "y2", ",", 
             RowBox[{"{", 
              RowBox[{"y3", ",", "x", ",", "y1"}], "}"}], ",", "y2", ",", 
             "$square"}], "]"}]}], ";", "\n", 
          RowBox[{
           RowBox[{
            RowBox[{"Chain", "[", 
             RowBox[{"$square", ",", "x_", ",", 
              RowBox[{"{", 
               RowBox[{"y1___", ",", 
                RowBox[{"y2_", "?", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"MasslessQ", "[", "#", "]"}], "&"}], ")"}]}], ",", 
                "y3___"}], "}"}], ",", "x_", ",", "$angle"}], "]"}], "/;", 
            " ", 
            RowBox[{"!", 
             RowBox[{"SHorderedQ", "[", 
              RowBox[{"{", 
               RowBox[{"x", ",", "y2"}], "}"}], "]"}]}]}], ":=", 
           RowBox[{"Chain", "[", 
            RowBox[{"$square", ",", "y2", ",", 
             RowBox[{"{", 
              RowBox[{"y3", ",", "x", ",", "y1"}], "}"}], ",", "y2", ",", 
             "$angle"}], "]"}]}], ";"}]}], "\n", "\n", 
        RowBox[{"(*", 
         RowBox[{"(*", 
          RowBox[{
          "Chains", " ", "which", " ", "reduce", " ", "to", " ", "Dirac", " ",
            "traces", " ", "can", " ", "be", " ", "further", " ", 
           "simplified", " ", "including", " ", "also", " ", "the", " ", 
           "extrema", " ", "in", " ", "the", " ", 
           RowBox[{"ordering", ".", " ", "Here"}], " ", "however", " ", "you",
            " ", "need", " ", "to", " ", "be", " ", "carefull", " ", 
           "because", " ", "the", " ", "traces", " ", "are", " ", "chiral", 
           " ", "so", " ", "there", " ", "is", " ", "a", " ", "hidden", " ", 
           RowBox[{"gamma5", "!"}], " ", "In", " ", "other", " ", "words", 
           " ", "if", " ", "y3", " ", "and", " ", "y1", " ", "are", " ", "of",
            " ", "even", " ", "length", " ", "the", " ", "angle", " ", "and", 
           " ", "square", " ", "brackets", " ", "swap", " ", "roles"}], 
          "*)"}], "\n", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Chain", "[", 
             RowBox[{"$angle", ",", "x_", ",", 
              RowBox[{"{", 
               RowBox[{"y1___", ",", "y2_", ",", "y3___"}], "}"}], ",", "x_", 
              ",", "$square"}], "]"}], "/;", 
            RowBox[{
             RowBox[{"AnyTrue", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"y1", ",", "y2", ",", "y3"}], "}"}], ",", 
               "MasslessQ"}], "]"}], "&&", 
             RowBox[{
              RowBox[{"First", "[", 
               RowBox[{"Sort", "[", 
                RowBox[{"Select", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"y1", ",", "y2", ",", "y3"}], "}"}], ",", 
                  "MasslessQ"}], "]"}], "]"}], "]"}], "===", "y2"}], "&&", 
             RowBox[{"!", 
              RowBox[{"SHorderedQ", "[", 
               RowBox[{"{", 
                RowBox[{"x", ",", "y2"}], "}"}], "]"}]}]}]}], ":=", "\n", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"OddQ", "[", 
              RowBox[{"Length", "[", 
               RowBox[{"{", "y3", "}"}], "]"}], "]"}], ",", "\n", 
             RowBox[{"Chain", "[", 
              RowBox[{"$angle", ",", "y2", ",", 
               RowBox[{"{", 
                RowBox[{"y3", ",", "x", ",", "y1"}], "}"}], ",", "y2", ",", 
               "$square"}], "]"}], ",", "\n", 
             RowBox[{"Chain", "[", 
              RowBox[{"$square", ",", "y2", ",", 
               RowBox[{"{", 
                RowBox[{"y3", ",", "x", ",", "y1"}], "}"}], ",", "y2", ",", 
               "$angle"}], "]"}]}], "]"}]}], ";", "\n", 
          RowBox[{
           RowBox[{
            RowBox[{"Chain", "[", 
             RowBox[{"$square", ",", "x_", ",", 
              RowBox[{"{", 
               RowBox[{"y1___", ",", "y2_", ",", "y3___"}], "}"}], ",", "x_", 
              ",", "$angle"}], "]"}], "/;", 
            RowBox[{
             RowBox[{"AnyTrue", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"y1", ",", "y2", ",", "y3"}], "}"}], ",", 
               "MasslessQ"}], "]"}], "&&", 
             RowBox[{
              RowBox[{"First", "[", 
               RowBox[{"Sort", "[", 
                RowBox[{"Select", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"y1", ",", "y2", ",", "y3"}], "}"}], ",", 
                  "MasslessQ"}], "]"}], "]"}], "]"}], "===", "y2"}], "&&", 
             RowBox[{"!", 
              RowBox[{"SHorderedQ", "[", 
               RowBox[{"{", 
                RowBox[{"x", ",", "y2"}], "}"}], "]"}]}]}]}], ":=", "\n", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"OddQ", "[", 
              RowBox[{"Length", "[", 
               RowBox[{"{", "y3", "}"}], "]"}], "]"}], ",", "\n", 
             RowBox[{"Chain", "[", 
              RowBox[{"$square", ",", "y2", ",", 
               RowBox[{"{", 
                RowBox[{"y3", ",", "x", ",", "y1"}], "}"}], ",", "y2", ",", 
               "$angle"}], "]"}], ",", "\n", 
             RowBox[{"Chain", "[", 
              RowBox[{"$angle", ",", "y2", ",", 
               RowBox[{"{", 
                RowBox[{"y3", ",", "x", ",", "y1"}], "}"}], ",", "y2", ",", 
               "$square"}], "]"}]}], "]"}]}], ";"}], "*)"}], "\n", "\n", 
        "]"}], ";", "\n", "\n", "\n", 
       RowBox[{
        RowBox[{"Chain", "[", 
         RowBox[{"$angle", ",", "x_", ",", 
          RowBox[{"{", "}"}], ",", "y_", ",", "$angle"}], "]"}], ":=", 
        RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{"x", ",", "y"}], "]"}]}], ";", "\n", 
       RowBox[{
        RowBox[{"Chain", "[", 
         RowBox[{"$square", ",", "x_", ",", 
          RowBox[{"{", "}"}], ",", "y_", ",", "$square"}], "]"}], ":=", 
        RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{"x", ",", "y"}], "]"}]}], ";", "\n", "\n", 
       RowBox[{"Return", "[", "exp", "]"}], ";"}]}], "\n", "]"}]}], 
   ";"}]}]], "Code",
 CellChangeTimes->{{3.8261939855985937`*^9, 3.826193993530828*^9}, {
   3.8261941619468293`*^9, 3.826194187643078*^9}, {3.826194238236395*^9, 
   3.8261944345506725`*^9}, 3.826195912452711*^9, {3.8261960568294005`*^9, 
   3.826196057883588*^9}, {3.8261961391164293`*^9, 3.826196147217043*^9}, 
   3.826196178122053*^9, {3.8261975575682716`*^9, 3.8261975979454827`*^9}, {
   3.8261985569974174`*^9, 3.826198685394687*^9}, {3.826198742163392*^9, 
   3.8261987724213724`*^9}, {3.826198910572173*^9, 3.826198962810289*^9}, {
   3.8261989974197187`*^9, 3.8261990493743176`*^9}, {3.8261991044927416`*^9, 
   3.8261991241743803`*^9}, {3.8262586999726973`*^9, 3.8262587044656725`*^9}, 
   3.826258971580755*^9, {3.8262597211016006`*^9, 3.8262597238479195`*^9}, {
   3.8262605681071205`*^9, 3.82626059598498*^9}, {3.826260817599507*^9, 
   3.8262608179066358`*^9}, 3.8262610198102007`*^9, 3.826261409894916*^9, {
   3.8262615355232515`*^9, 3.8262615384122343`*^9}, {3.826261585012908*^9, 
   3.826261587997321*^9}, {3.826262492022457*^9, 3.8262625008101377`*^9}, {
   3.8262631502864904`*^9, 3.826263174810932*^9}, 3.8262632128905196`*^9, {
   3.8262633763373804`*^9, 3.826263379514326*^9}, {3.826263486833772*^9, 
   3.8262634890321646`*^9}, {3.8262641113457556`*^9, 3.826264182643381*^9}, {
   3.826264821089517*^9, 3.8262649592517605`*^9}, {3.8262722436635313`*^9, 
   3.8262722451919417`*^9}, 3.8262725122921286`*^9, {3.826279032802981*^9, 
   3.826279098664896*^9}, {3.826279146890671*^9, 3.8262791713202143`*^9}, {
   3.82627924788046*^9, 3.826279275155952*^9}, {3.826279317982366*^9, 
   3.826279519603817*^9}},ExpressionUUID->"253d3b18-3da4-4f0b-b67f-\
c7d5529c1817"]
}, Closed]],

Cell[CellGroupData[{

Cell["Tests", "Subsection",
 CellChangeTimes->{{3.8261946137847834`*^9, 
  3.826194614851536*^9}},ExpressionUUID->"a6d14dec-7dec-46fd-ade9-\
79ae1626d0cb"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"UndeclareMassless", "[", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"UndeclareMom", "[", "]"}], ";"}]}], "Input",
 CellChangeTimes->{{3.826279796903934*^9, 3.8262798040455112`*^9}},
 CellLabel->
  "In[105]:=",ExpressionUUID->"18a5ee49-9f06-4108-9c5f-60d4f3f5acbb"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
   "Simple", " ", "reordering", " ", "according", " ", "to", " ", "canonical",
     " ", "order"}], ",", " ", 
   RowBox[{
   "p2", " ", "is", " ", "moved", " ", "left", " ", "of", " ", "p3", " ", 
    "and", " ", "a", " ", "corresponding", " ", "term", " ", "involving", " ", 
    TemplateBox[{"p2", "p3"},
     "ScalarProduct",
     DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
     InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )], " ", 
    "appears"}], ",", " ", 
   RowBox[{
   "due", " ", "to", " ", "the", " ", "anticommutation", " ", "of", " ", 
    "the", " ", "\[Sigma]", " ", "matrices"}]}], "*)"}]], "Input",
 CellChangeTimes->{{3.826194673510893*^9, 
  3.826194742212907*^9}},ExpressionUUID->"089800ad-0ba2-429c-adf6-\
2a7ed9ca33cb"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ChainSort", "[", 
  RowBox[{"Chain", "[", 
   RowBox[{"$angle", ",", "p1", ",", 
    RowBox[{"{", 
     RowBox[{"p3", ",", "p2", ",", "p5"}], "}"}], ",", "p1", ",", "$square"}],
    "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.826194631201232*^9, 3.8261946596168156`*^9}},
 CellLabel->
  "In[107]:=",ExpressionUUID->"b9d6490d-5795-4725-bf37-d3503f364cb1"],

Cell[BoxData[
 RowBox[{
  RowBox[{"-", 
   TemplateBox[{"p1", 
     RowBox[{"{", 
       RowBox[{"p2", ",", "p3", ",", "p5"}], "}"}], "p1"},
    "AngleSquareChain",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square",
        "]"}]& )]}], "+", 
  RowBox[{"2", " ", 
   TemplateBox[{"p1", 
     RowBox[{"{", "p5", "}"}], "p1"},
    "AngleSquareChain",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square",
        "]"}]& )], " ", 
   TemplateBox[{"p2", "p3"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(
     RowBox[{"mp", "[", #, ",", #2, "]"}]& )]}]}]], "Output",
 CellChangeTimes->{3.8261946611094093`*^9, 3.826279813821548*^9},
 CellLabel->
  "Out[107]=",ExpressionUUID->"66b2d7dd-9177-4a77-b634-b624ca3d32d3"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"More", " ", "complicated", " ", "reordering"}], ",", " ", 
   RowBox[{
   "notice", " ", "that", " ", "it", " ", "is", " ", "not", " ", "necessary", 
    " ", "for", " ", "momenta", " ", "to", " ", "be", " ", "declared", " ", 
    "as", " ", "such", " ", "for", " ", "the", " ", "reordering", " ", "to", 
    " ", "happen"}]}], "*)"}]], "Input",
 CellChangeTimes->{{3.826195122319684*^9, 3.8261951586852055`*^9}, {
  3.8261962138737803`*^9, 
  3.8261962208709784`*^9}},ExpressionUUID->"02bded40-1a1b-4034-b9c7-\
48cd215857be"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ChainSort", "[", 
  RowBox[{"Chain", "[", 
   RowBox[{"$angle", ",", "p1", ",", 
    RowBox[{"{", 
     RowBox[{"p3", ",", "p2", ",", "p5", ",", "p6", ",", "p4"}], "}"}], ",", 
    "p1", ",", "$square"}], "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.826195167350678*^9, 3.826195177129999*^9}},
 CellLabel->
  "In[108]:=",ExpressionUUID->"bd148c42-bee9-4992-9110-b6b58e32de24"],

Cell[BoxData[
 RowBox[{
  RowBox[{"-", 
   TemplateBox[{"p1", 
     RowBox[{"{", 
       RowBox[{"p2", ",", "p3", ",", "p4", ",", "p5", ",", "p6"}], "}"}], 
     "p1"},
    "AngleSquareChain",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square",
        "]"}]& )]}], "+", 
  RowBox[{"2", " ", 
   TemplateBox[{"p1", 
     RowBox[{"{", 
       RowBox[{"p2", ",", "p3", ",", "p6"}], "}"}], "p1"},
    "AngleSquareChain",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square",
        "]"}]& )], " ", 
   TemplateBox[{"p4", "p5"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )]}], "-", 
  RowBox[{"2", " ", 
   TemplateBox[{"p1", 
     RowBox[{"{", 
       RowBox[{"p2", ",", "p3", ",", "p5"}], "}"}], "p1"},
    "AngleSquareChain",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square",
        "]"}]& )], " ", 
   TemplateBox[{"p4", "p6"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )]}], "+", 
  RowBox[{"2", " ", 
   TemplateBox[{"p2", "p3"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )], " ", 
   RowBox[{"(", 
    RowBox[{
     TemplateBox[{"p1", 
       RowBox[{"{", 
         RowBox[{"p4", ",", "p5", ",", "p6"}], "}"}], "p1"},
      "AngleSquareChain",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], "-", 
     RowBox[{"2", " ", 
      TemplateBox[{"p1", 
        RowBox[{"{", "p6", "}"}], "p1"},
       "AngleSquareChain",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
       InterpretationFunction->(
        RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
          "$square", "]"}]& )], " ", 
      TemplateBox[{"p4", "p5"},
       "ScalarProduct",
       DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
       InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )]}], 
     "+", 
     RowBox[{"2", " ", 
      TemplateBox[{"p1", 
        RowBox[{"{", "p5", "}"}], "p1"},
       "AngleSquareChain",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
       InterpretationFunction->(
        RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
          "$square", "]"}]& )], " ", 
      TemplateBox[{"p4", "p6"},
       "ScalarProduct",
       DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
       InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )]}]}], 
    ")"}]}]}]], "Output",
 CellChangeTimes->{3.8261951779719954`*^9, 3.8262798198902626`*^9},
 CellLabel->
  "Out[108]=",ExpressionUUID->"e99f452e-845b-4b39-ba91-59f983968ba7"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"ChainSort", "[", 
   RowBox[{"Chain", "[", 
    RowBox[{"$angle", ",", "p1", ",", 
     RowBox[{"{", 
      RowBox[{"p3", ",", "p2", ",", "p5", ",", "p6", ",", "p4"}], "}"}], ",", 
     "p1", ",", "$square"}], "]"}], "]"}], "//", "RepeatedTiming"}]], "Input",
 CellChangeTimes->{{3.826279829998783*^9, 3.826279832766486*^9}},
 CellLabel->
  "In[109]:=",ExpressionUUID->"cb94b18e-9f79-4e6e-9b37-9a3c31155acd"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.000205288916015625`", ",", 
   RowBox[{
    RowBox[{"-", 
     TemplateBox[{"p1", 
       RowBox[{"{", 
         RowBox[{"p2", ",", "p3", ",", "p4", ",", "p5", ",", "p6"}], "}"}], 
       "p1"},
      "AngleSquareChain",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )]}], "+", 
    RowBox[{"2", " ", 
     TemplateBox[{"p1", 
       RowBox[{"{", 
         RowBox[{"p2", ",", "p3", ",", "p6"}], "}"}], "p1"},
      "AngleSquareChain",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], " ", 
     TemplateBox[{"p4", "p5"},
      "ScalarProduct",
      DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
      InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )]}], 
    "-", 
    RowBox[{"2", " ", 
     TemplateBox[{"p1", 
       RowBox[{"{", 
         RowBox[{"p2", ",", "p3", ",", "p5"}], "}"}], "p1"},
      "AngleSquareChain",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], " ", 
     TemplateBox[{"p4", "p6"},
      "ScalarProduct",
      DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
      InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )]}], 
    "+", 
    RowBox[{"2", " ", 
     TemplateBox[{"p2", "p3"},
      "ScalarProduct",
      DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
      InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )], " ", 
     RowBox[{"(", 
      RowBox[{
       TemplateBox[{"p1", 
         RowBox[{"{", 
           RowBox[{"p4", ",", "p5", ",", "p6"}], "}"}], "p1"},
        "AngleSquareChain",
        DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
        InterpretationFunction->(
         RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
           "$square", "]"}]& )], "-", 
       RowBox[{"2", " ", 
        TemplateBox[{"p1", 
          RowBox[{"{", "p6", "}"}], "p1"},
         "AngleSquareChain",
         DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
         InterpretationFunction->(
          RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
            "$square", "]"}]& )], " ", 
        TemplateBox[{"p4", "p5"},
         "ScalarProduct",
         DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
         InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )]}], 
       "+", 
       RowBox[{"2", " ", 
        TemplateBox[{"p1", 
          RowBox[{"{", "p5", "}"}], "p1"},
         "AngleSquareChain",
         DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
         InterpretationFunction->(
          RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
            "$square", "]"}]& )], " ", 
        TemplateBox[{"p4", "p6"},
         "ScalarProduct",
         DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
         InterpretationFunction->(
          RowBox[{"mp", "[", #, ",", #2, "]"}]& )]}]}], ")"}]}]}]}], 
  "}"}]], "Output",
 CellChangeTimes->{3.826279834939578*^9},
 CellLabel->
  "Out[109]=",ExpressionUUID->"27fd6da2-5721-4b13-b146-51494aad43c7"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "Customise", " ", "the", " ", "ordering", " ", "by", " ", "specifying", " ",
    "an", " ", "ordered", " ", "list", " ", "of", " ", "labels"}], 
  "*)"}]], "Input",
 CellChangeTimes->{{3.8261951941410027`*^9, 
  3.8261952253496227`*^9}},ExpressionUUID->"ff67ddae-fbe1-4228-a314-\
98915f346ce4"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ChainSort", "[", 
  RowBox[{
   RowBox[{"Chain", "[", 
    RowBox[{"$angle", ",", "p1", ",", 
     RowBox[{"{", 
      RowBox[{"p2", ",", "p3", ",", "p2", ",", "p1"}], "}"}], ",", "p4", ",", 
     "$angle"}], "]"}], ",", 
   RowBox[{"{", 
    RowBox[{"p1", ",", "p3", ",", "p2"}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.8261952356251135`*^9, 3.8261952453199816`*^9}, {
  3.826195307053855*^9, 3.8261953092289495`*^9}, {3.8261959798000154`*^9, 
  3.8261959829060364`*^9}, {3.8261960974878902`*^9, 3.8261961108672695`*^9}, {
  3.826196197090121*^9, 3.826196197615272*^9}, {3.82619650410579*^9, 
  3.8261965223108573`*^9}, {3.8261968280192313`*^9, 3.8261968575003724`*^9}},
 CellLabel->
  "In[110]:=",ExpressionUUID->"c6b90bf5-b990-433e-849d-d2a044e21a15"],

Cell[BoxData[
 RowBox[{
  TemplateBox[{"p1", 
    RowBox[{"{", 
      RowBox[{"p1", ",", "p3", ",", "p2", ",", "p2"}], "}"}], "p4"},
   "AngleAngleChain",
   DisplayFunction->(
    RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
   InterpretationFunction->(
    RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle", 
      "]"}]& )], "-", 
  RowBox[{"2", " ", 
   TemplateBox[{"p1", 
     RowBox[{"{", 
       RowBox[{"p2", ",", "p2"}], "}"}], "p4"},
    "AngleAngleChain",
    DisplayFunction->(
     RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle", 
       "]"}]& )], " ", 
   TemplateBox[{"p1", "p3"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )]}], "+", 
  RowBox[{"2", " ", 
   TemplateBox[{"p2", "p3"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )], " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"-", 
      TemplateBox[{"p1", 
        RowBox[{"{", 
          RowBox[{"p1", ",", "p2"}], "}"}], "p4"},
       "AngleAngleChain",
       DisplayFunction->(
        RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(
        RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
          "$angle", "]"}]& )]}], "+", 
     RowBox[{"2", " ", 
      TemplateBox[{"p1", "p2"},
       "ScalarProduct",
       DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
       InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )], " ", 
      TemplateBox[{"p1", "p4"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )]}]}], ")"}]}]}]], "Output",
 CellChangeTimes->{
  3.8261952481417685`*^9, 3.8261953105082197`*^9, 3.8261957805529237`*^9, 
   3.8261959847954636`*^9, {3.826196100019912*^9, 3.8261961123290467`*^9}, 
   3.826196198783641*^9, 3.8261964533814774`*^9, {3.8261964966047363`*^9, 
   3.826196522895571*^9}, {3.8261968103404627`*^9, 3.82619685852065*^9}, 
   3.8262798742096148`*^9},
 CellLabel->
  "Out[110]=",ExpressionUUID->"11964ca0-7084-406d-a51e-6c59667116d0"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
   "It", " ", "is", " ", "not", " ", "necessary", " ", "for", " ", "all", " ",
     "the", " ", "labels", " ", "to", " ", "have", " ", "a", " ", "specific", 
    " ", "order"}], ",", " ", 
   RowBox[{
   "for", " ", "example", " ", "we", " ", "could", " ", "specify", " ", 
    "only", " ", "the", " ", "order", " ", "of", " ", "two", " ", 
    "labels"}]}], "*)"}]], "Input",
 CellChangeTimes->{{3.8262798935478997`*^9, 
  3.826279921507758*^9}},ExpressionUUID->"6de8ff03-35e2-41b9-82d4-\
fc8818e473df"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ChainSort", "[", 
  RowBox[{
   RowBox[{"Chain", "[", 
    RowBox[{"$angle", ",", "p1", ",", 
     RowBox[{"{", 
      RowBox[{"p2", ",", "p3", ",", "p2", ",", "p1"}], "}"}], ",", "p4", ",", 
     "$angle"}], "]"}], ",", 
   RowBox[{"{", 
    RowBox[{"p1", ",", "p3"}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.826279927674835*^9, 3.826279928012171*^9}},
 CellLabel->
  "In[111]:=",ExpressionUUID->"04ea4ded-8929-4f8b-ad9e-6eed2cdc1342"],

Cell[BoxData[
 RowBox[{
  TemplateBox[{"p1", 
    RowBox[{"{", 
      RowBox[{"p2", ",", "p1", ",", "p3", ",", "p2"}], "}"}], "p4"},
   "AngleAngleChain",
   DisplayFunction->(
    RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
   InterpretationFunction->(
    RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle", 
      "]"}]& )], "+", 
  RowBox[{"2", " ", 
   TemplateBox[{"p1", 
     RowBox[{"{", 
       RowBox[{"p2", ",", "p3"}], "}"}], "p4"},
    "AngleAngleChain",
    DisplayFunction->(
     RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle", 
       "]"}]& )], " ", 
   TemplateBox[{"p1", "p2"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )]}], "-", 
  RowBox[{"2", " ", 
   TemplateBox[{"p1", 
     RowBox[{"{", 
       RowBox[{"p2", ",", "p2"}], "}"}], "p4"},
    "AngleAngleChain",
    DisplayFunction->(
     RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle", 
       "]"}]& )], " ", 
   TemplateBox[{"p1", "p3"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(
     RowBox[{"mp", "[", #, ",", #2, "]"}]& )]}]}]], "Output",
 CellChangeTimes->{3.8262799288058023`*^9},
 CellLabel->
  "Out[111]=",ExpressionUUID->"850d0781-af7d-4cfb-a781-4189e3a28d37"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "If", " ", "we", " ", "have", " ", "Dirac", " ", "traces", " ", "then", " ",
    "ealso", " ", "the", " ", "extrama", " ", "of", " ", "the", " ", "chain", 
   " ", "can", " ", "be", " ", 
   RowBox[{"reordered", ".", " ", "For"}], " ", "this", " ", "to", " ", "be", 
   " ", "possible", " ", "there", " ", "must", " ", "be", " ", "an", " ", 
   "internal", " ", "massless", " ", "momentum", " ", "to", " ", "replace", 
   " ", "the", " ", "external", " ", "one"}], "*)"}]], "Input",
 CellChangeTimes->{{3.826279950408595*^9, 3.826279976447603*^9}, {
  3.82628001009811*^9, 
  3.8262800275521545`*^9}},ExpressionUUID->"97fae555-6bf0-4d1b-9457-\
5d87a1f9d971"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"DeclareMassless", "[", "p4", "]"}]], "Input",
 CellChangeTimes->{{3.826280029475423*^9, 3.8262800361085596`*^9}},
 CellLabel->
  "In[112]:=",ExpressionUUID->"59813a73-ccd8-478b-9e7b-c6c9ed26aacf"],

Cell[BoxData[
 RowBox[{"{", "p4", "}"}]], "Output",
 CellChangeTimes->{3.8262800370945272`*^9},
 CellLabel->
  "Out[112]=",ExpressionUUID->"4e862e69-4e33-4864-80b5-b7ca9d4aefb4"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ChainSort", "[", 
  RowBox[{"Chain", "[", 
   RowBox[{"$angle", ",", "p4", ",", 
    RowBox[{"{", 
     RowBox[{"p2", ",", "p1", ",", "p3"}], "}"}], ",", "p4", ",", "$square"}],
    "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.826279989503975*^9, 3.8262800058711367`*^9}, {
  3.826280045463893*^9, 3.826280048144188*^9}},
 CellLabel->
  "In[114]:=",ExpressionUUID->"b3ee5f4d-8e32-4e6f-9060-0cfd28b37011"],

Cell[BoxData[
 RowBox[{
  RowBox[{"-", 
   TemplateBox[{"\"p4\"", 
     RowBox[{"{", 
       RowBox[{"p1", ",", "p2", ",", "p3"}], "}"}], "\"p4\""},
    "AngleSquareChain",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square",
        "]"}]& )]}], "+", 
  RowBox[{"2", " ", 
   TemplateBox[{"\"p4\"", 
     RowBox[{"{", "p3", "}"}], "\"p4\""},
    "AngleSquareChain",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square",
        "]"}]& )], " ", 
   TemplateBox[{"p1", "p2"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(
     RowBox[{"mp", "[", #, ",", #2, "]"}]& )]}]}]], "Output",
 CellChangeTimes->{{3.8262800396971793`*^9, 3.826280049350808*^9}},
 CellLabel->
  "Out[114]=",ExpressionUUID->"feac9c01-06b8-4c9f-9b20-a37647783f3f"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"DeclareMassless", "[", "p1", "]"}]], "Input",
 CellChangeTimes->{{3.8262800557098217`*^9, 3.826280061702407*^9}},
 CellLabel->
  "In[115]:=",ExpressionUUID->"7a41f550-07f3-4d2b-927b-7e5bc7195667"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"p1", ",", "p4"}], "}"}]], "Output",
 CellChangeTimes->{3.8262800679247446`*^9},
 CellLabel->
  "Out[115]=",ExpressionUUID->"d4c32e69-e88a-402f-b560-87e20f355c71"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ChainSort", "[", 
  RowBox[{"Chain", "[", 
   RowBox[{"$angle", ",", "p4", ",", 
    RowBox[{"{", 
     RowBox[{"p2", ",", "p1", ",", "p3"}], "}"}], ",", "p4", ",", "$square"}],
    "]"}], "]"}]], "Input",
 CellLabel->
  "In[116]:=",ExpressionUUID->"127c0e99-2ba6-45f8-ba9a-c86355544df7"],

Cell[BoxData[
 RowBox[{
  RowBox[{"-", 
   TemplateBox[{"\"p1\"", 
     RowBox[{"{", 
       RowBox[{"\"p4\"", ",", "p2", ",", "p3"}], "}"}], "\"p1\""},
    "AngleSquareChain",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square",
        "]"}]& )]}], "+", 
  RowBox[{"2", " ", 
   TemplateBox[{"\"p4\"", 
     RowBox[{"{", "p3", "}"}], "\"p4\""},
    "AngleSquareChain",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square",
        "]"}]& )], " ", 
   TemplateBox[{"\"p1\"", "p2"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )]}], "+", 
  RowBox[{"2", " ", 
   TemplateBox[{"\"p1\"", 
     RowBox[{"{", "p3", "}"}], "\"p1\""},
    "AngleSquareChain",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square",
        "]"}]& )], " ", 
   TemplateBox[{"\"p4\"", "p2"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )]}], "-", 
  RowBox[{"2", " ", 
   TemplateBox[{"\"p1\"", 
     RowBox[{"{", "p2", "}"}], "\"p1\""},
    "AngleSquareChain",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square",
        "]"}]& )], " ", 
   TemplateBox[{"\"p4\"", "p3"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(
     RowBox[{"mp", "[", #, ",", #2, "]"}]& )]}]}]], "Output",
 CellChangeTimes->{3.826280074788205*^9},
 CellLabel->
  "Out[116]=",ExpressionUUID->"6dcac98c-09f1-4ae0-b29e-41267a1cc8db"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"And", " ", "with", " ", "custom", " ", "ordering"}], 
  "*)"}]], "Input",
 CellChangeTimes->{{3.826280095282136*^9, 
  3.8262801023412867`*^9}},ExpressionUUID->"03ec63d4-c582-4d66-be40-\
0201e68f8b40"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ChainSort", "[", 
  RowBox[{
   RowBox[{"Chain", "[", 
    RowBox[{"$angle", ",", "p4", ",", 
     RowBox[{"{", 
      RowBox[{"p2", ",", "p1", ",", "p3"}], "}"}], ",", "p4", ",", 
     "$square"}], "]"}], ",", 
   RowBox[{"{", 
    RowBox[{"p1", ",", "p4", ",", "p3", ",", "p2"}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.8262801084165745`*^9, 3.8262801172027683`*^9}},
 CellLabel->
  "In[117]:=",ExpressionUUID->"42c86160-6ed1-4b7e-8b76-7c7dc960b195"],

Cell[BoxData[
 RowBox[{
  TemplateBox[{"\"p1\"", 
    RowBox[{"{", 
      RowBox[{"\"p4\"", ",", "p3", ",", "p2"}], "}"}], "\"p1\""},
   "AngleSquareChain",
   DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
   InterpretationFunction->(
    RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square", 
      "]"}]& )], "+", 
  RowBox[{"2", " ", 
   TemplateBox[{"\"p4\"", 
     RowBox[{"{", "p3", "}"}], "\"p4\""},
    "AngleSquareChain",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square",
        "]"}]& )], " ", 
   TemplateBox[{"\"p1\"", "p2"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )]}], "+", 
  RowBox[{"2", " ", 
   TemplateBox[{"\"p1\"", 
     RowBox[{"{", "p3", "}"}], "\"p1\""},
    "AngleSquareChain",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square",
        "]"}]& )], " ", 
   TemplateBox[{"\"p4\"", "p2"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )]}], "-", 
  RowBox[{"2", " ", 
   TemplateBox[{"\"p1\"", 
     RowBox[{"{", "p2", "}"}], "\"p1\""},
    "AngleSquareChain",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square",
        "]"}]& )], " ", 
   TemplateBox[{"\"p4\"", "p3"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )]}], "-", 
  RowBox[{"2", " ", 
   TemplateBox[{"\"p1\"", 
     RowBox[{"{", "\"p4\"", "}"}], "\"p1\""},
    "AngleSquareChain",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square",
        "]"}]& )], " ", 
   TemplateBox[{"p2", "p3"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(
     RowBox[{"mp", "[", #, ",", #2, "]"}]& )]}]}]], "Output",
 CellChangeTimes->{3.826280118949329*^9},
 CellLabel->
  "Out[117]=",ExpressionUUID->"0c70602b-4578-449b-993f-d14f9d42cfee"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"Further", " ", "examples"}], "*)"}]], "Input",
 CellChangeTimes->{{3.826282596658373*^9, 
  3.8262826024534893`*^9}},ExpressionUUID->"53b2fd12-38db-4c01-8df8-\
3c0cf42dd5f3"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ChainSort", "[", 
  RowBox[{
   RowBox[{"Chain", "[", 
    RowBox[{"$angle", ",", "p1", ",", 
     RowBox[{"{", 
      RowBox[{"p2", ",", "p3", ",", "p2", ",", "p1"}], "}"}], ",", "p4", ",", 
     "$angle"}], "]"}], ",", 
   RowBox[{"{", 
    RowBox[{"p1", ",", "p3", ",", "p2"}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{
  3.8262594484562407`*^9, {3.8262597544481893`*^9, 3.8262597721605873`*^9}, 
   3.82626034689167*^9, {3.8262608308741713`*^9, 3.8262608543523912`*^9}, {
   3.826261043588998*^9, 3.826261066173412*^9}, {3.8262611155673056`*^9, 
   3.8262611164040213`*^9}, 3.826282579658476*^9},
 CellLabel->"In[2]:=",ExpressionUUID->"057f9349-1109-4a02-9bee-aa8cf7fb3ce9"],

Cell[BoxData[
 RowBox[{
  TemplateBox[{"p1", 
    RowBox[{"{", 
      RowBox[{"p1", ",", "p3", ",", "p2", ",", "p2"}], "}"}], "p4"},
   "AngleAngleChain",
   DisplayFunction->(
    RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
   InterpretationFunction->(
    RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle", 
      "]"}]& )], "-", 
  RowBox[{"2", " ", 
   TemplateBox[{"p1", 
     RowBox[{"{", 
       RowBox[{"p2", ",", "p2"}], "}"}], "p4"},
    "AngleAngleChain",
    DisplayFunction->(
     RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle", 
       "]"}]& )], " ", 
   TemplateBox[{"p1", "p3"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )]}], "+", 
  RowBox[{"2", " ", 
   TemplateBox[{"p2", "p3"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )], " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"-", 
      TemplateBox[{"p1", 
        RowBox[{"{", 
          RowBox[{"p1", ",", "p2"}], "}"}], "p4"},
       "AngleAngleChain",
       DisplayFunction->(
        RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(
        RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
          "$angle", "]"}]& )]}], "+", 
     RowBox[{"2", " ", 
      TemplateBox[{"p1", "p2"},
       "ScalarProduct",
       DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
       InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )], " ", 
      TemplateBox[{"p1", "p4"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )]}]}], ")"}]}]}]], "Output",
 CellChangeTimes->{{3.8262594463109584`*^9, 3.8262594499004145`*^9}, {
   3.8262597377109137`*^9, 3.8262597727190957`*^9}, 3.82626034732745*^9, 
   3.826260600727139*^9, {3.826260821380521*^9, 3.8262608549138455`*^9}, {
   3.826261044603177*^9, 3.82626106668004*^9}, 3.82626111721286*^9, 
   3.82628258042607*^9},
 CellLabel->"Out[2]=",ExpressionUUID->"7a012c50-7db5-41e8-b3b7-314b1e139db3"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ChainSort", "[", 
  RowBox[{
   RowBox[{"Chain", "[", 
    RowBox[{"$angle", ",", "p1", ",", 
     RowBox[{"{", 
      RowBox[{"p2", ",", "p3", ",", "p2", ",", "p1"}], "}"}], ",", "p4", ",", 
     "$angle"}], "]"}], ",", 
   RowBox[{"{", 
    RowBox[{"p1", ",", "p3"}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.826261147859404*^9, 3.826261148189477*^9}, 
   3.8262825839103403`*^9},
 CellLabel->"In[3]:=",ExpressionUUID->"7b9c5a44-90f1-4dcb-8c08-6de6255bafe3"],

Cell[BoxData[
 RowBox[{
  TemplateBox[{"p1", 
    RowBox[{"{", 
      RowBox[{"p2", ",", "p1", ",", "p3", ",", "p2"}], "}"}], "p4"},
   "AngleAngleChain",
   DisplayFunction->(
    RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
   InterpretationFunction->(
    RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle", 
      "]"}]& )], "+", 
  RowBox[{"2", " ", 
   TemplateBox[{"p1", 
     RowBox[{"{", 
       RowBox[{"p2", ",", "p3"}], "}"}], "p4"},
    "AngleAngleChain",
    DisplayFunction->(
     RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle", 
       "]"}]& )], " ", 
   TemplateBox[{"p1", "p2"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )]}], "-", 
  RowBox[{"2", " ", 
   TemplateBox[{"p1", 
     RowBox[{"{", 
       RowBox[{"p2", ",", "p2"}], "}"}], "p4"},
    "AngleAngleChain",
    DisplayFunction->(
     RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle", 
       "]"}]& )], " ", 
   TemplateBox[{"p1", "p3"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(
     RowBox[{"mp", "[", #, ",", #2, "]"}]& )]}]}]], "Output",
 CellChangeTimes->{3.826261148630289*^9, 3.826282584383199*^9},
 CellLabel->"Out[3]=",ExpressionUUID->"3a4e6675-bf30-4135-9f71-ffe5f09b77db"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ChainSort", "[", 
  RowBox[{
   RowBox[{"Chain", "[", 
    RowBox[{"$angle", ",", "p1", ",", 
     RowBox[{"{", 
      RowBox[{"p2", ",", "p3", ",", "p2", ",", "p1"}], "}"}], ",", "p4", ",", 
     "$angle"}], "]"}], ",", 
   RowBox[{"{", 
    RowBox[{"p3", ",", "p2"}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.826261151899604*^9, 3.8262611522476687`*^9}, 
   3.826282585715402*^9},
 CellLabel->"In[4]:=",ExpressionUUID->"bee69a88-6990-4c0b-8891-8b6a5c20f61c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"-", 
   TemplateBox[{"p1", 
     RowBox[{"{", 
       RowBox[{"p3", ",", "p2", ",", "p2", ",", "p1"}], "}"}], "p4"},
    "AngleAngleChain",
    DisplayFunction->(
     RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle", 
       "]"}]& )]}], "+", 
  RowBox[{"2", " ", 
   TemplateBox[{"p1", 
     RowBox[{"{", 
       RowBox[{"p2", ",", "p1"}], "}"}], "p4"},
    "AngleAngleChain",
    DisplayFunction->(
     RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle", 
       "]"}]& )], " ", 
   TemplateBox[{"p2", "p3"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(
     RowBox[{"mp", "[", #, ",", #2, "]"}]& )]}]}]], "Output",
 CellChangeTimes->{3.8262611527373123`*^9, 3.826282586263762*^9},
 CellLabel->"Out[4]=",ExpressionUUID->"ef7d7151-f683-48e8-b96b-f807a73515c1"]
}, Open  ]]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["ChainSimplify", "Section",
 CellChangeTimes->{{3.826258533336477*^9, 
  3.82625853562735*^9}},ExpressionUUID->"aa61789c-7ec6-4c36-a881-\
f7adb1e97829"],

Cell[CellGroupData[{

Cell["ChainSimplify old", "Subsection",
 CellChangeTimes->{{3.826187936053359*^9, 
  3.826187939467272*^9}},ExpressionUUID->"a7a353da-63a6-4ad5-80e4-\
1f3b7b28d5ea"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "ChainSimplify", "]"}], "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"MomCon", "->", 
       RowBox[{"{", "}"}]}], ",", 
      RowBox[{"ReduceComplete", "->", "False"}]}], "}"}]}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ChainSimplify", "[", 
    RowBox[{"exp_", ",", 
     RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"Chain", ",", "locexp"}], "}"}], ",", "\n", 
     RowBox[{
      RowBox[{
       RowBox[{"Chain", "[", 
        RowBox[{"type_", ",", "x_", ",", 
         RowBox[{"{", 
          RowBox[{"x_", ",", "y___"}], "}"}], ",", "z_", ",", "type2_"}], 
        "]"}], ":=", "0"}], ";", "\n", "\t", 
      RowBox[{
       RowBox[{"Chain", "[", 
        RowBox[{"type_", ",", "x_", ",", 
         RowBox[{"{", 
          RowBox[{"y___", ",", "z_"}], "}"}], ",", "z_", ",", "type2_"}], 
        "]"}], ":=", "0"}], ";", "\n", "\t", 
      RowBox[{
       RowBox[{"Chain", "[", 
        RowBox[{"type_", ",", "x_", ",", 
         RowBox[{"{", 
          RowBox[{"y___", ",", "z_", ",", "z_", ",", "k___"}], "}"}], ",", 
         "l_", ",", "type2_"}], "]"}], ":=", 
       RowBox[{
        RowBox[{"mp", "[", 
         RowBox[{"z", ",", "z"}], "]"}], "*", 
        RowBox[{"Chain", "[", 
         RowBox[{"type", ",", "x", ",", 
          RowBox[{"{", 
           RowBox[{"y", ",", "k"}], "}"}], ",", "l", ",", "type2"}], 
         "]"}]}]}], ";", "\n", 
      RowBox[{
       RowBox[{"Chain", "[", 
        RowBox[{"type1_", ",", "p1_", ",", 
         RowBox[{"{", 
          RowBox[{
          "x___", ",", "y_", ",", "l___", ",", "z_", ",", "y_", ",", "k___"}],
           "}"}], ",", "p2_", ",", "type2_"}], "]"}], ":=", 
       RowBox[{
        RowBox[{"2", "*", 
         RowBox[{"mp", "[", 
          RowBox[{
           RowBox[{"MomPure", "[", "y", "]"}], ",", 
           RowBox[{"MomPure", "[", "z", "]"}]}], "]"}], "*", 
         RowBox[{"Chain", "[", 
          RowBox[{"type1", ",", "p1", ",", 
           RowBox[{"{", 
            RowBox[{"x", ",", "y", ",", "l", ",", "k"}], "}"}], ",", "p2", 
           ",", "type2"}], "]"}]}], "-", 
        RowBox[{"Chain", "[", 
         RowBox[{"type1", ",", "p1", ",", 
          RowBox[{"{", 
           RowBox[{"x", ",", "y", ",", "l", ",", "y", ",", "z", ",", "k"}], 
           "}"}], ",", "p2", ",", "type2"}], "]"}]}]}], ";", "\n", 
      RowBox[{
       RowBox[{"Chain", "[", 
        RowBox[{"t1_", ",", "x_", ",", 
         RowBox[{"{", 
          RowBox[{"y___", ",", "z_", ",", "x_", ",", "k___"}], "}"}], ",", 
         "p2_", ",", "t2_"}], "]"}], ":=", 
       RowBox[{
        RowBox[{"2", "*", 
         RowBox[{"mp", "[", 
          RowBox[{
           RowBox[{"MomPure", "[", "z", "]"}], ",", 
           RowBox[{"MomPure", "[", "x", "]"}]}], "]"}], 
         RowBox[{"Chain", "[", 
          RowBox[{"t1", ",", "x", ",", 
           RowBox[{"{", 
            RowBox[{"y", ",", "k"}], "}"}], ",", "p2", ",", "t2"}], "]"}]}], 
        "-", 
        RowBox[{"Chain", "[", 
         RowBox[{"t1", ",", "x", ",", 
          RowBox[{"{", 
           RowBox[{"y", ",", "x", ",", "z", ",", "k"}], "}"}], ",", "p2", ",",
           "t2"}], "]"}]}]}], ";", "\n", 
      RowBox[{
       RowBox[{"Chain", "[", 
        RowBox[{"$angle", ",", "x_", ",", 
         RowBox[{"{", "y_", "}"}], ",", "x_", ",", "$square"}], "]"}], ":=", 
       RowBox[{"2", "*", 
        RowBox[{"mp", "[", 
         RowBox[{
          RowBox[{"MomPure", "[", "x", "]"}], ",", 
          RowBox[{"MomPure", "[", "y", "]"}]}], "]"}]}]}], ";", "\n", 
      RowBox[{
       RowBox[{"Chain", "[", 
        RowBox[{"$square", ",", "x_", ",", 
         RowBox[{"{", "y_", "}"}], ",", "x_", ",", "$angle"}], "]"}], ":=", 
       RowBox[{"2", "*", 
        RowBox[{"mp", "[", 
         RowBox[{
          RowBox[{"MomPure", "[", "x", "]"}], ",", 
          RowBox[{"MomPure", "[", "y", "]"}]}], "]"}]}]}], ";", "\n", "\n", 
      RowBox[{"(*", 
       RowBox[{"Apply", " ", "momentum", " ", "conservation"}], "*)"}], "\n", 
      RowBox[{"locexp", "=", 
       RowBox[{"ChainMomCon", "[", 
        RowBox[{"exp", ",", 
         RowBox[{"{", 
          RowBox[{"MomCon", "->", 
           RowBox[{"OptionValue", "[", "MomCon", "]"}]}], "}"}]}], "]"}]}], 
      ";", "\n", "\n", 
      RowBox[{"(*", 
       RowBox[{
       "If", " ", "ReduceComplete", " ", "is", " ", "et", " ", "to", " ", 
        "True", " ", "then", " ", "reduce", " ", "the", " ", "structures", 
        " ", "as", " ", "much", " ", "as", " ", "possible", " ", "by", " ", 
        "also", " ", "ordering", " ", 
        RowBox[{"things", ":"}]}], "*)"}], "\n", "\n", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"OptionValue", "[", "ReduceComplete", "]"}], ",", "\n", 
        RowBox[{
         RowBox[{"locexp", "=", 
          RowBox[{"ChainOrder", "[", "locexp", "]"}]}], ";"}]}], "\n", "]"}], 
      ";", "\n", "\n", 
      RowBox[{"locexp", "=", 
       RowBox[{"locexp", "/.", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"Chain", "[", 
            RowBox[{"$angle", ",", "x_", ",", 
             RowBox[{"{", "}"}], ",", "y_", ",", "$angle"}], "]"}], ":>", 
           RowBox[{"SpinorAngleBracket", "[", 
            RowBox[{"x", ",", "y"}], "]"}]}], ",", 
          RowBox[{
           RowBox[{"Chain", "[", 
            RowBox[{"$square", ",", "x_", ",", 
             RowBox[{"{", "}"}], ",", "y_", ",", "$square"}], "]"}], ":>", 
           RowBox[{"SpinorSquareBracket", "[", 
            RowBox[{"x", ",", "y"}], "]"}]}]}], "}"}]}]}], ";", "\n", 
      RowBox[{"Return", "[", "locexp", "]"}], ";"}]}], "\n", "]"}]}], 
  ";"}]}], "Input",ExpressionUUID->"25552cd9-6b9c-4c54-80b8-1fb1459ca726"]
}, Closed]],

Cell[CellGroupData[{

Cell["ChainSimplify new", "Subsection",
 CellChangeTimes->{{3.826187936053359*^9, 3.826187939467272*^9}, {
  3.8262803561699514`*^9, 
  3.826280356445464*^9}},ExpressionUUID->"5b2325dc-a7a3-45da-a6b4-\
213c83138354"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ChainSimplify", "::", "momcon"}], "=", 
   "\"\<Unknown form of momentum conservation, option MomCon ignored.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ChainSimplify", "::", "sort"}], "=", 
  "\"\<Unknown form of ordering, option ReduceBySorting ignored\>\""}]}], \
"Input",
 CellChangeTimes->{{3.826281232968834*^9, 
  3.826281361793891*^9}},ExpressionUUID->"9a2c2400-cc99-444d-b78c-\
d997aa70c180"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "ChainSimplify", "]"}], "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"MomCon", "->", 
       RowBox[{"{", "}"}]}], ",", 
      RowBox[{"ReduceBySorting", "->", "False"}]}], "}"}]}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ChainSimplify", "[", 
    RowBox[{"exp_", ",", 
     RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "locexp", "}"}], ",", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"locexp", "=", "exp"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Apply", " ", "momentum", " ", "conservation"}], ",", " ", 
        RowBox[{"if", " ", 
         RowBox[{"needed", ".", " ", "This"}], " ", "needs", " ", "to", " ", 
         "be", " ", "done", " ", "outside", " ", "the", " ", "Block", " ", 
         "below", " ", "because", " ", "it", " ", "requires", " ", 
         "linearity", " ", "properties", " ", "of", " ", "chains", " ", "to", 
         " ", "appropriately", " ", 
         RowBox[{"work", "."}]}]}], "*)"}], "\n", 
      RowBox[{"Which", "[", "\n", "\t", 
       RowBox[{
        RowBox[{"MatchQ", "[", 
         RowBox[{
          RowBox[{"OptionValue", "[", "MomCon", "]"}], ",", 
          RowBox[{"{", "}"}]}], "]"}], ",", "\n", "\t", "Null", ",", "\n", 
        "\t", 
        RowBox[{"AllTrue", "[", 
         RowBox[{
          RowBox[{"OptionValue", "[", "MomCon", "]"}], ",", 
          RowBox[{
           RowBox[{"MatchQ", "[", 
            RowBox[{"#", ",", 
             RowBox[{"_Rule", "|", "_RuleDelayed"}]}], "]"}], "&"}]}], "]"}], 
        ",", "\n", "\t", 
        RowBox[{"locexp", "=", 
         RowBox[{"ChainMomentumCon", "[", 
          RowBox[{"locexp", ",", 
           RowBox[{"OptionValue", "[", "MomCon", "]"}]}], "]"}]}], ",", "\n", 
        "\t", "True", ",", "\n", "\t", 
        RowBox[{"Message", "[", 
         RowBox[{"ChainSimplify", "::", "momcon"}], "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Define", " ", "local", " ", "properties", " ", "of", " ", "chains", 
        " ", "for", " ", "the", " ", "simplification"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", "Chain", "}"}], ",", "\n", "\t", 
        RowBox[{
         RowBox[{
          RowBox[{"Chain", "[", 
           RowBox[{"type_", ",", "x_", ",", 
            RowBox[{"{", 
             RowBox[{"x_", ",", "y___"}], "}"}], ",", "z_", ",", "type2_"}], 
           "]"}], ":=", "0"}], ";", "\n", "\t", 
         RowBox[{
          RowBox[{"Chain", "[", 
           RowBox[{"type_", ",", "x_", ",", 
            RowBox[{"{", 
             RowBox[{"y___", ",", "z_"}], "}"}], ",", "z_", ",", "type2_"}], 
           "]"}], ":=", "0"}], ";", "\n", "\t", 
         RowBox[{
          RowBox[{"Chain", "[", 
           RowBox[{"type_", ",", "x_", ",", 
            RowBox[{"{", 
             RowBox[{"y___", ",", "z_", ",", "z_", ",", "k___"}], "}"}], ",", 
            "l_", ",", "type2_"}], "]"}], ":=", 
          RowBox[{
           RowBox[{"mp", "[", 
            RowBox[{"z", ",", "z"}], "]"}], "*", 
           RowBox[{"Chain", "[", 
            RowBox[{"type", ",", "x", ",", 
             RowBox[{"{", 
              RowBox[{"y", ",", "k"}], "}"}], ",", "l", ",", "type2"}], 
            "]"}]}]}], ";", "\n", "\t", 
         RowBox[{
          RowBox[{"Chain", "[", 
           RowBox[{"type1_", ",", "p1_", ",", 
            RowBox[{"{", 
             RowBox[{
             "x___", ",", "y_", ",", "l___", ",", "z_", ",", "y_", ",", 
              "k___"}], "}"}], ",", "p2_", ",", "type2_"}], "]"}], ":=", 
          RowBox[{
           RowBox[{"2", "*", 
            RowBox[{"mp", "[", 
             RowBox[{"y", ",", "z"}], "]"}], "*", 
            RowBox[{"Chain", "[", 
             RowBox[{"type1", ",", "p1", ",", 
              RowBox[{"{", 
               RowBox[{"x", ",", "y", ",", "l", ",", "k"}], "}"}], ",", "p2", 
              ",", "type2"}], "]"}]}], "-", 
           RowBox[{"Chain", "[", 
            RowBox[{"type1", ",", "p1", ",", 
             RowBox[{"{", 
              RowBox[{"x", ",", "y", ",", "l", ",", "y", ",", "z", ",", "k"}],
               "}"}], ",", "p2", ",", "type2"}], "]"}]}]}], ";", "\n", "\t", 
         RowBox[{
          RowBox[{"Chain", "[", 
           RowBox[{"t1_", ",", "x_", ",", 
            RowBox[{"{", 
             RowBox[{"y___", ",", "z_", ",", "x_", ",", "k___"}], "}"}], ",", 
            "p2_", ",", "t2_"}], "]"}], ":=", 
          RowBox[{
           RowBox[{"2", "*", 
            RowBox[{"mp", "[", 
             RowBox[{"z", ",", "x"}], "]"}], 
            RowBox[{"Chain", "[", 
             RowBox[{"t1", ",", "x", ",", 
              RowBox[{"{", 
               RowBox[{"y", ",", "k"}], "}"}], ",", "p2", ",", "t2"}], 
             "]"}]}], "-", 
           RowBox[{"Chain", "[", 
            RowBox[{"t1", ",", "x", ",", 
             RowBox[{"{", 
              RowBox[{"y", ",", "x", ",", "z", ",", "k"}], "}"}], ",", "p2", 
             ",", "t2"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Chain", "[", 
           RowBox[{"t1_", ",", "p1_", ",", 
            RowBox[{"{", 
             RowBox[{"y___", ",", "z_", ",", "x_", ",", "k___"}], "}"}], ",", 
            "z_", ",", "t2_"}], "]"}], ":=", 
          RowBox[{
           RowBox[{"2", "*", 
            RowBox[{"mp", "[", 
             RowBox[{"z", ",", "x"}], "]"}], 
            RowBox[{"Chain", "[", 
             RowBox[{"t1", ",", "p1", ",", 
              RowBox[{"{", 
               RowBox[{"y", ",", "k"}], "}"}], ",", "z", ",", "t2"}], "]"}]}],
            "-", 
           RowBox[{"Chain", "[", 
            RowBox[{"t1", ",", "p1", ",", 
             RowBox[{"{", 
              RowBox[{"y", ",", "x", ",", "z", ",", "k"}], "}"}], ",", "z", 
             ",", "t2"}], "]"}]}]}], ";", "\n", "\t", 
         RowBox[{
          RowBox[{"Chain", "[", 
           RowBox[{"$angle", ",", "x_", ",", 
            RowBox[{"{", "y_", "}"}], ",", "x_", ",", "$square"}], "]"}], ":=", 
          RowBox[{"2", "*", 
           RowBox[{"mp", "[", 
            RowBox[{"x", ",", "y"}], "]"}]}]}], ";", "\n", "\t", 
         RowBox[{
          RowBox[{"Chain", "[", 
           RowBox[{"$square", ",", "x_", ",", 
            RowBox[{"{", "y_", "}"}], ",", "x_", ",", "$angle"}], "]"}], ":=", 
          RowBox[{"2", "*", 
           RowBox[{"mp", "[", 
            RowBox[{"x", ",", "y"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
         " ", 
         RowBox[{
          RowBox[{"Chain", "[", 
           RowBox[{"$angle", ",", "x_", ",", 
            RowBox[{"{", "}"}], ",", "y_", ",", "$angle"}], "]"}], ":=", 
          RowBox[{"SpinorAngleBracket", "[", 
           RowBox[{"x", ",", "y"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Chain", "[", 
           RowBox[{"$square", ",", "x_", ",", 
            RowBox[{"{", "}"}], ",", "y_", ",", "$square"}], "]"}], ":=", 
          RowBox[{"SpinorSquareBracket", "[", 
           RowBox[{"x", ",", "y"}], "]"}]}], ";", "\n", "\n", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "@", 
               RowBox[{"OptionValue", "[", "MomCon", "]"}]}], ">", "0"}], ",",
              "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"locexp", "=", 
               RowBox[{"ChainMomentumCon", "[", 
                RowBox[{"locexp", ",", 
                 RowBox[{"OptionValue", "[", "MomCon", "]"}]}], "]"}]}], 
              ";"}]}], "\[IndentingNewLine]", "]"}], ";"}], "*)"}], "\n", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{"Reorder", " ", "chains", " ", "if", " ", 
           RowBox[{"necessary", ":"}]}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"Switch", "[", 
          RowBox[{
           RowBox[{"OptionValue", "[", "ReduceBySorting", "]"}], ",", 
           "\[IndentingNewLine]", "\t", "False", ",", "\[IndentingNewLine]", 
           "\t", "Null", ",", "\[IndentingNewLine]", "\t", "True", ",", 
           "\[IndentingNewLine]", "\t", 
           RowBox[{"locexp", "=", 
            RowBox[{"ChainSort", "[", "locexp", "]"}]}], ",", 
           "\[IndentingNewLine]", "\t", "_List", ",", "\[IndentingNewLine]", 
           "\t", 
           RowBox[{"locexp", "=", 
            RowBox[{"ChainSort", "[", 
             RowBox[{"locexp", ",", 
              RowBox[{"OptionValue", "[", "ReduceBySorting", "]"}]}], "]"}]}],
            ",", "\[IndentingNewLine]", "\t", "_", ",", "\[IndentingNewLine]",
            "\t", 
           RowBox[{"Message", "[", 
            RowBox[{"ChainSimplify", "::", "sort"}], "]"}]}], "]"}], ";", 
         "\n", "\n", "\n", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"OptionValue", "[", "ReduceComplete", "]"}], ",", "\n", 
             RowBox[{
              RowBox[{"locexp", "=", 
               RowBox[{"ChainOrder", "[", "locexp", "]"}]}], ";"}]}], "\n", 
            "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"Return", "[", "locexp", "]"}], ";"}]}], "\n", "]"}], 
      ";"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.8262806190585346`*^9, 3.8262808567395024`*^9}, {
  3.8262808956570206`*^9, 3.8262809821896563`*^9}, {3.8262810769281588`*^9, 
  3.826281224359787*^9}, {3.826281350602812*^9, 3.826281495364644*^9}, {
  3.826281615788093*^9, 3.826281669681241*^9}, {3.8262819864120755`*^9, 
  3.8262820650053596`*^9}, {3.82628218674751*^9, 3.8262822072130136`*^9}, {
  3.8262827815117264`*^9, 3.826282838073475*^9}, {3.826690237149147*^9, 
  3.826690246288741*^9}},ExpressionUUID->"39be02b8-303f-4965-a297-\
39a568679bba"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Tests", "Subsection",
 CellChangeTimes->{{3.8262825055243263`*^9, 
  3.8262825061157875`*^9}},ExpressionUUID->"da0f6e61-a258-4156-a721-\
844b7f52b948"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
       "Apply", " ", "identities", " ", "to", " ", "simplify", " ", "the", 
        " ", "chains"}], ",", " ", 
       RowBox[{
        RowBox[{
        "in", " ", "particular", " ", "use", " ", "the", " ", "Clifford", " ",
          "algebra", " ", "to", " ", "move", " ", "internal", " ", "momenta", 
         " ", "and", " ", "Dirac", " ", "equation", " ", "to", " ", "kill", 
         " ", "terms", " ", "like", " ", "p"}], "|", "p"}]}], 
      "\[RightAngleBracket]"}], " ", "and", " ", "p"}], "|", "p"}], "]"}], 
  "*)"}]], "Input",
 CellChangeTimes->{{3.8262826668281684`*^9, 3.826282697306368*^9}, {
  3.8262829422544737`*^9, 
  3.8262829691252995`*^9}},ExpressionUUID->"a3725ff1-ce36-4a6d-bcff-\
4aead49d0a46"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"Chain", "[", 
  RowBox[{"$angle", ",", "p1", ",", 
   RowBox[{"{", 
    RowBox[{"p4", ",", "p2"}], "}"}], ",", "p4", ",", "$angle"}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"ChainSimplify", "[", "%", "]"}]}], "Input",
 CellChangeTimes->{{3.826282904740925*^9, 3.826282909585232*^9}},
 CellLabel->"In[11]:=",ExpressionUUID->"e7b251c6-9d23-472a-9976-76ec45eb9ec0"],

Cell[BoxData[
 TemplateBox[{"p1", 
   RowBox[{"{", 
     RowBox[{"p4", ",", "p2"}], "}"}], "p4"},
  "AngleAngleChain",
  DisplayFunction->(
   RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
  InterpretationFunction->(
   RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle", 
     "]"}]& )]], "Output",
 CellChangeTimes->{{3.82628261126646*^9, 3.8262826193895855`*^9}, 
   3.826282912878395*^9},
 CellLabel->"Out[11]=",ExpressionUUID->"7c2d1bd6-b5da-493b-ac08-4e9919ebe5e4"],

Cell[BoxData[
 RowBox[{"2", " ", 
  TemplateBox[{"p2", "p4"},
   "ScalarProduct",
   DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
   InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )], " ", 
  TemplateBox[{"p1", "p4"},
   "SpinorAngleBracket",
   DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
      RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
   InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
      RowBox[{#, ",", #2}], "]"}]& )]}]], "Output",
 CellChangeTimes->{{3.82628261126646*^9, 3.8262826193895855`*^9}, 
   3.826282912890365*^9},
 CellLabel->"Out[12]=",ExpressionUUID->"eec64512-2a3a-4dc7-8107-27f05e7215df"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"Chain", "[", 
  RowBox[{"$angle", ",", "p1", ",", 
   RowBox[{"{", 
    RowBox[{"p2", ",", "p3", ",", "p2", ",", "p1"}], "}"}], ",", "p4", ",", 
   "$angle"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"ChainSimplify", "[", "%", "]"}]}], "Input",
 CellChangeTimes->{{3.826282613830306*^9, 3.8262826190133877`*^9}},
 CellLabel->"In[13]:=",ExpressionUUID->"5dfaa9ea-7a1a-4083-bc75-2355e10b0ffd"],

Cell[BoxData[
 TemplateBox[{"p1", 
   RowBox[{"{", 
     RowBox[{"p2", ",", "p3", ",", "p2", ",", "p1"}], "}"}], "p4"},
  "AngleAngleChain",
  DisplayFunction->(
   RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
  InterpretationFunction->(
   RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle", 
     "]"}]& )]], "Output",
 CellChangeTimes->{{3.82628261126646*^9, 3.8262826193746257`*^9}, 
   3.826282975784027*^9},
 CellLabel->"Out[13]=",ExpressionUUID->"dd429cc9-086d-42f1-a7c9-1ce106489f82"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"-", "2"}], " ", 
   TemplateBox[{"p1", "p3"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )], " ", 
   TemplateBox[{"p2"},
    "ScalarProduct2",
    DisplayFunction->(SuperscriptBox[
      RowBox[{"(", #, ")"}], "2"]& ),
    InterpretationFunction->(RowBox[{"mp", "[", #, ",", #, "]"}]& )], " ", 
   TemplateBox[{"p1", "p4"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}], "+", 
  RowBox[{"4", " ", 
   TemplateBox[{"p1", "p2"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )], " ", 
   TemplateBox[{"p2", "p3"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )], " ", 
   TemplateBox[{"p1", "p4"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}]}]], "Output",
 CellChangeTimes->{{3.82628261126646*^9, 3.8262826193746257`*^9}, 
   3.826282975796977*^9},
 CellLabel->"Out[14]=",ExpressionUUID->"831a0492-9a6d-48da-bd6f-748e52d08808"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "Unless", " ", "explicitly", " ", "specified", " ", "momenta", " ", "are", 
   " ", "not", " ", "reordered"}], "*)"}]], "Input",
 CellChangeTimes->{{3.8262829842690225`*^9, 
  3.826283034034622*^9}},ExpressionUUID->"88ab4bec-e906-44a2-966f-\
837c440f6e29"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"Chain", "[", 
  RowBox[{"$angle", ",", "p1", ",", 
   RowBox[{"{", 
    RowBox[{"p2", ",", "p3", ",", "p2", ",", "p1", ",", "p6", ",", "p5"}], 
    "}"}], ",", "p4", ",", "$angle"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"ChainSimplify", "[", "%", "]"}]}], "Input",
 CellChangeTimes->{{3.8262826540864687`*^9, 3.826282655590268*^9}, {
  3.8262829944067044`*^9, 3.8262829980390496`*^9}},
 CellLabel->"In[17]:=",ExpressionUUID->"ea8ac9f7-a9d8-43ca-9cd6-8f6abda9cbc6"],

Cell[BoxData[
 TemplateBox[{"p1", 
   RowBox[{"{", 
     RowBox[{"p2", ",", "p3", ",", "p2", ",", "p1", ",", "p6", ",", "p5"}], 
     "}"}], "p4"},
  "AngleAngleChain",
  DisplayFunction->(
   RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
  InterpretationFunction->(
   RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle", 
     "]"}]& )]], "Output",
 CellChangeTimes->{
  3.826282656918936*^9, {3.8262830109761705`*^9, 3.8262830378046513`*^9}},
 CellLabel->"Out[17]=",ExpressionUUID->"f9e9aa6a-17b3-4430-b536-4a797db1a3c0"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"-", "2"}], " ", 
   TemplateBox[{"p1", 
     RowBox[{"{", 
       RowBox[{"p6", ",", "p5"}], "}"}], "p4"},
    "AngleAngleChain",
    DisplayFunction->(
     RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle", 
       "]"}]& )], " ", 
   TemplateBox[{"p1", "p3"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )], " ", 
   TemplateBox[{"p2"},
    "ScalarProduct2",
    DisplayFunction->(SuperscriptBox[
      RowBox[{"(", #, ")"}], "2"]& ),
    InterpretationFunction->(RowBox[{"mp", "[", #, ",", #, "]"}]& )]}], "+", 
  RowBox[{"4", " ", 
   TemplateBox[{"p1", 
     RowBox[{"{", 
       RowBox[{"p6", ",", "p5"}], "}"}], "p4"},
    "AngleAngleChain",
    DisplayFunction->(
     RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle", 
       "]"}]& )], " ", 
   TemplateBox[{"p1", "p2"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )], " ", 
   TemplateBox[{"p2", "p3"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(
     RowBox[{"mp", "[", #, ",", #2, "]"}]& )]}]}]], "Output",
 CellChangeTimes->{
  3.826282656918936*^9, {3.8262830109761705`*^9, 3.8262830378246875`*^9}},
 CellLabel->"Out[18]=",ExpressionUUID->"637149a7-07dc-4d30-98cd-593c8c275d89"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "If", " ", "ReduceBySorting", " ", "is", " ", "set", " ", "to", " ", "True",
    " ", "then", " ", "the", " ", "momenta", " ", "are", " ", "reordered", 
   " ", "following", " ", 
   RowBox[{"Mathematica", "'"}], "s", " ", "canonical", " ", "ordering"}], 
  "*)"}]], "Input",
 CellChangeTimes->{{3.8262830444882135`*^9, 
  3.8262830753153963`*^9}},ExpressionUUID->"230b1ae0-332c-4e33-aaed-\
f731d4df58b2"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"Chain", "[", 
  RowBox[{"$angle", ",", "p1", ",", 
   RowBox[{"{", 
    RowBox[{"p2", ",", "p3", ",", "p2", ",", "p1", ",", "p6", ",", "p5"}], 
    "}"}], ",", "p4", ",", "$angle"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"ChainSimplify", "[", 
  RowBox[{"%", ",", 
   RowBox[{"ReduceBySorting", "\[Rule]", "True"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.826283079988284*^9, 3.826283086929185*^9}},
 CellLabel->"In[19]:=",ExpressionUUID->"9e8ce819-d680-4e08-a1cd-11cfc641580a"],

Cell[BoxData[
 TemplateBox[{"p1", 
   RowBox[{"{", 
     RowBox[{"p2", ",", "p3", ",", "p2", ",", "p1", ",", "p6", ",", "p5"}], 
     "}"}], "p4"},
  "AngleAngleChain",
  DisplayFunction->(
   RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
  InterpretationFunction->(
   RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle", 
     "]"}]& )]], "Output",
 CellChangeTimes->{3.8262830879497538`*^9},
 CellLabel->"Out[19]=",ExpressionUUID->"04dd1355-2888-47fe-96a6-9774ec0701e9"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"-", "2"}], " ", 
   TemplateBox[{"p1", "p3"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )], " ", 
   TemplateBox[{"p2"},
    "ScalarProduct2",
    DisplayFunction->(SuperscriptBox[
      RowBox[{"(", #, ")"}], "2"]& ),
    InterpretationFunction->(RowBox[{"mp", "[", #, ",", #, "]"}]& )], " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"-", 
      TemplateBox[{"p1", 
        RowBox[{"{", 
          RowBox[{"p5", ",", "p6"}], "}"}], "p4"},
       "AngleAngleChain",
       DisplayFunction->(
        RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(
        RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
          "$angle", "]"}]& )]}], "+", 
     RowBox[{"2", " ", 
      TemplateBox[{"p5", "p6"},
       "ScalarProduct",
       DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
       InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )], " ", 
      TemplateBox[{"p1", "p4"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )]}]}], ")"}]}], "+", 
  RowBox[{"4", " ", 
   TemplateBox[{"p1", "p2"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )], " ", 
   TemplateBox[{"p2", "p3"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )], " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"-", 
      TemplateBox[{"p1", 
        RowBox[{"{", 
          RowBox[{"p5", ",", "p6"}], "}"}], "p4"},
       "AngleAngleChain",
       DisplayFunction->(
        RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(
        RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
          "$angle", "]"}]& )]}], "+", 
     RowBox[{"2", " ", 
      TemplateBox[{"p5", "p6"},
       "ScalarProduct",
       DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
       InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )], " ", 
      TemplateBox[{"p1", "p4"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )]}]}], ")"}]}]}]], "Output",
 CellChangeTimes->{3.826283087988513*^9},
 CellLabel->"Out[20]=",ExpressionUUID->"312cf99d-4f00-460c-a445-7f901bdf42ab"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "It", " ", "is", " ", "possible", " ", "to", " ", "specify", " ", "the", 
   " ", "order", " ", "as", " ", "a", " ", "list", " ", "of", " ", 
   RowBox[{"labels", ".", " ", "For"}], " ", "further", " ", "examples", " ", 
   "and", " ", "explanations", " ", "of", " ", "sorting", " ", "see", " ", 
   "ChainSort"}], "*)"}]], "Input",
 CellChangeTimes->{{3.8262831005441036`*^9, 3.8262831165923557`*^9}, {
  3.826283219303158*^9, 
  3.8262832397155294`*^9}},ExpressionUUID->"7d703d9e-43da-4cff-80bd-\
e39de850333b"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"Chain", "[", 
  RowBox[{"$angle", ",", "p1", ",", 
   RowBox[{"{", 
    RowBox[{"p2", ",", "p3", ",", "p7", ",", "p1", ",", "p6", ",", "p5"}], 
    "}"}], ",", "p4", ",", "$angle"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"ChainSimplify", "[", 
  RowBox[{"%", ",", 
   RowBox[{"ReduceBySorting", "\[Rule]", "False"}]}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"ChainSimplify", "[", 
  RowBox[{"%", ",", 
   RowBox[{"ReduceBySorting", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{"p7", ",", "p5", ",", "p6"}], "}"}]}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.8262831496643114`*^9, 3.826283198293521*^9}},
 CellLabel->"In[25]:=",ExpressionUUID->"7031b234-3c46-491f-a027-bbbdb04217f9"],

Cell[BoxData[
 TemplateBox[{"p1", 
   RowBox[{"{", 
     RowBox[{"p2", ",", "p3", ",", "p7", ",", "p1", ",", "p6", ",", "p5"}], 
     "}"}], "p4"},
  "AngleAngleChain",
  DisplayFunction->(
   RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
  InterpretationFunction->(
   RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle", 
     "]"}]& )]], "Output",
 CellChangeTimes->{{3.82628316628899*^9, 3.826283202407516*^9}},
 CellLabel->"Out[25]=",ExpressionUUID->"4ae9f2cf-5ea8-4c7b-a8a1-e92cbacd6b66"],

Cell[BoxData[
 RowBox[{
  RowBox[{"2", " ", 
   TemplateBox[{"p1", 
     RowBox[{"{", 
       RowBox[{"p3", ",", "p7", ",", "p6", ",", "p5"}], "}"}], "p4"},
    "AngleAngleChain",
    DisplayFunction->(
     RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle", 
       "]"}]& )], " ", 
   TemplateBox[{"p1", "p2"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )]}], "-", 
  RowBox[{"2", " ", 
   TemplateBox[{"p1", 
     RowBox[{"{", 
       RowBox[{"p2", ",", "p7", ",", "p6", ",", "p5"}], "}"}], "p4"},
    "AngleAngleChain",
    DisplayFunction->(
     RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle", 
       "]"}]& )], " ", 
   TemplateBox[{"p1", "p3"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )]}], "+", 
  RowBox[{"2", " ", 
   TemplateBox[{"p1", 
     RowBox[{"{", 
       RowBox[{"p2", ",", "p3", ",", "p6", ",", "p5"}], "}"}], "p4"},
    "AngleAngleChain",
    DisplayFunction->(
     RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle", 
       "]"}]& )], " ", 
   TemplateBox[{"p1", "p7"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(
     RowBox[{"mp", "[", #, ",", #2, "]"}]& )]}]}]], "Output",
 CellChangeTimes->{{3.82628316628899*^9, 3.826283202427864*^9}},
 CellLabel->"Out[26]=",ExpressionUUID->"c6aa577f-1100-468f-b21b-b0be3d02eee2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"2", " ", 
   TemplateBox[{"p1", "p7"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )], " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"-", 
      TemplateBox[{"p1", 
        RowBox[{"{", 
          RowBox[{"p2", ",", "p3", ",", "p5", ",", "p6"}], "}"}], "p4"},
       "AngleAngleChain",
       DisplayFunction->(
        RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(
        RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
          "$angle", "]"}]& )]}], "+", 
     RowBox[{"2", " ", 
      TemplateBox[{"p1", 
        RowBox[{"{", 
          RowBox[{"p2", ",", "p3"}], "}"}], "p4"},
       "AngleAngleChain",
       DisplayFunction->(
        RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(
        RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
          "$angle", "]"}]& )], " ", 
      TemplateBox[{"p5", "p6"},
       "ScalarProduct",
       DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
       InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )]}]}], 
    ")"}]}], "-", 
  RowBox[{"2", " ", 
   TemplateBox[{"p1", "p3"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )], " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"-", 
      TemplateBox[{"p1", 
        RowBox[{"{", 
          RowBox[{"p2", ",", "p7", ",", "p5", ",", "p6"}], "}"}], "p4"},
       "AngleAngleChain",
       DisplayFunction->(
        RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(
        RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
          "$angle", "]"}]& )]}], "+", 
     RowBox[{"2", " ", 
      TemplateBox[{"p1", 
        RowBox[{"{", 
          RowBox[{"p2", ",", "p7"}], "}"}], "p4"},
       "AngleAngleChain",
       DisplayFunction->(
        RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(
        RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
          "$angle", "]"}]& )], " ", 
      TemplateBox[{"p5", "p6"},
       "ScalarProduct",
       DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
       InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )]}]}], 
    ")"}]}], "+", 
  RowBox[{"2", " ", 
   TemplateBox[{"p1", "p2"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )], " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"-", 
      TemplateBox[{"p1", 
        RowBox[{"{", 
          RowBox[{"p3", ",", "p7", ",", "p5", ",", "p6"}], "}"}], "p4"},
       "AngleAngleChain",
       DisplayFunction->(
        RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(
        RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
          "$angle", "]"}]& )]}], "+", 
     RowBox[{"2", " ", 
      TemplateBox[{"p1", 
        RowBox[{"{", 
          RowBox[{"p3", ",", "p7"}], "}"}], "p4"},
       "AngleAngleChain",
       DisplayFunction->(
        RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(
        RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
          "$angle", "]"}]& )], " ", 
      TemplateBox[{"p5", "p6"},
       "ScalarProduct",
       DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
       InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )]}]}], 
    ")"}]}]}]], "Output",
 CellChangeTimes->{{3.82628316628899*^9, 3.8262832024617496`*^9}},
 CellLabel->"Out[27]=",ExpressionUUID->"a037a2fc-786b-4629-bb10-dd38bef4df97"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
   "In", " ", "the", " ", "case", " ", "of", " ", "Dirac", " ", "traces", " ",
     "also", " ", "the", " ", "extrema", " ", "are", " ", "taken", " ", 
    "into", " ", "account", " ", "for", " ", "the", " ", "sorting"}], ",", 
   " ", 
   RowBox[{"if", " ", "necessary", " ", "the", " ", "chains", " ", "are", " ", 
    RowBox[{"rearranged", ".", " ", "For"}], " ", "this", " ", "to", " ", 
    "happen", " ", "it", " ", "is", " ", "necessary", " ", "for", " ", "an", 
    " ", "internal", " ", "momentum", " ", "to", " ", "be", " ", "massless", 
    " ", "and", " ", "to", " ", "be", " ", "able", " ", "to", " ", "replace", 
    " ", "the", " ", "external", " ", "one"}]}], "*)"}]], "Input",
 CellChangeTimes->{{3.826283570357356*^9, 
  3.826283627710628*^9}},ExpressionUUID->"fe81ce04-ecd0-4089-93ad-\
59dcf3d27a35"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"UndeclareMassless", "[", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"UndeclareMom", "[", "]"}], ";"}]}], "Input",
 CellChangeTimes->{{3.826283629168301*^9, 3.8262836368713284`*^9}},
 CellLabel->"In[45]:=",ExpressionUUID->"d890a552-1d77-450f-a527-e3a604169408"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"Chain", "[", 
  RowBox[{"$angle", ",", "p4", ",", 
   RowBox[{"{", 
    RowBox[{"p2", ",", "p3", ",", "p1"}], "}"}], ",", "p4", ",", "$square"}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"ChainSimplify", "[", 
  RowBox[{"%", ",", 
   RowBox[{"ReduceBySorting", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{"p1", ",", "p4"}], "}"}]}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.826283647553398*^9, 3.8262836778926754`*^9}},
 CellLabel->"In[47]:=",ExpressionUUID->"a74e376c-ec93-4ff4-a036-9c857724c96b"],

Cell[BoxData[
 TemplateBox[{"p4", 
   RowBox[{"{", 
     RowBox[{"p2", ",", "p3", ",", "p1"}], "}"}], "p4"},
  "AngleSquareChain",
  DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
  InterpretationFunction->(
   RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square", 
     "]"}]& )]], "Output",
 CellChangeTimes->{3.8262836786656713`*^9},
 CellLabel->"Out[47]=",ExpressionUUID->"4d0c6311-2f11-4c35-be3c-bda37afba149"],

Cell[BoxData[
 TemplateBox[{"p4", 
   RowBox[{"{", 
     RowBox[{"p2", ",", "p3", ",", "p1"}], "}"}], "p4"},
  "AngleSquareChain",
  DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
  InterpretationFunction->(
   RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square", 
     "]"}]& )]], "Output",
 CellChangeTimes->{3.826283678688604*^9},
 CellLabel->"Out[48]=",ExpressionUUID->"47e39fdd-908d-4e88-bd0a-0b9492306d06"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"Upon", " ", "declaring", " ", "p1", " ", "as", " ", 
   RowBox[{"massless", ":"}]}], "*)"}]], "Input",
 CellChangeTimes->{{3.826283681318239*^9, 
  3.8262836907964697`*^9}},ExpressionUUID->"760c2991-b32f-4c86-ad91-\
6ce33c1ca8f2"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"DeclareMassless", "[", 
  RowBox[{"p1", ",", "p4"}], "]"}]], "Input",
 CellChangeTimes->{{3.826283692001402*^9, 3.8262836972437944`*^9}},
 CellLabel->"In[49]:=",ExpressionUUID->"cfb40174-0bd3-4313-9139-e54f083da78c"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"p1", ",", "p4"}], "}"}]], "Output",
 CellChangeTimes->{3.8262836982232428`*^9},
 CellLabel->"Out[49]=",ExpressionUUID->"b934002b-4329-4439-a164-8d08f963afd4"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"Chain", "[", 
  RowBox[{"$angle", ",", "p4", ",", 
   RowBox[{"{", 
    RowBox[{"p2", ",", "p3", ",", "p1"}], "}"}], ",", "p4", ",", "$square"}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"ChainSimplify", "[", 
  RowBox[{"%", ",", 
   RowBox[{"ReduceBySorting", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{"p1", ",", "p4"}], "}"}]}]}], "]"}]}], "Input",
 CellLabel->"In[50]:=",ExpressionUUID->"244b38c3-6cf9-42fa-8443-0736748ddf4e"],

Cell[BoxData[
 TemplateBox[{"\"p4\"", 
   RowBox[{"{", 
     RowBox[{"p2", ",", "p3", ",", "\"p1\""}], "}"}], "\"p4\""},
  "AngleSquareChain",
  DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
  InterpretationFunction->(
   RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square", 
     "]"}]& )]], "Output",
 CellChangeTimes->{3.8262837044348335`*^9},
 CellLabel->"Out[50]=",ExpressionUUID->"63201b11-333d-4b69-b3f2-88da31763ee9"],

Cell[BoxData[
 TemplateBox[{"\"p1\"", 
   RowBox[{"{", 
     RowBox[{"\"p4\"", ",", "p2", ",", "p3"}], "}"}], "\"p1\""},
  "AngleSquareChain",
  DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
  InterpretationFunction->(
   RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square", 
     "]"}]& )]], "Output",
 CellChangeTimes->{3.8262837044435043`*^9},
 CellLabel->"Out[51]=",ExpressionUUID->"8ced51ca-8244-44e2-ace1-76f6e2bd7264"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
   "One", " ", "can", " ", "also", " ", "apply", " ", "momentum", " ", 
    "conservation", " ", "in", " ", "the", " ", "simplification", " ", 
    "process"}], ",", " ", 
   RowBox[{
   "recall", " ", "that", " ", "in", " ", "order", " ", "for", " ", 
    "linearity", " ", "to", " ", "apply", " ", "inside", " ", "chains", " ", 
    "it", " ", "is", " ", "necessary", " ", "to", " ", "declare", " ", 
    "momentum", " ", "labels", " ", "as", " ", 
    RowBox[{"such", "."}]}]}], "*)"}]], "Input",
 CellChangeTimes->{{3.8262832727451725`*^9, 3.826283294751561*^9}, {
  3.82628335485667*^9, 
  3.8262833793557177`*^9}},ExpressionUUID->"db898a10-45d3-4b3e-8251-\
04fa61723642"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"UndeclareMassless", "[", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"UndeclareMom", "[", "]"}], ";"}]}], "Input",
 CellChangeTimes->{{3.826283400980982*^9, 3.8262834131211395`*^9}},
 CellLabel->"In[33]:=",ExpressionUUID->"9db9deba-3ec9-44bc-ba75-9d97cfdd8a1c"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"Chain", "[", 
  RowBox[{"$angle", ",", "p1", ",", 
   RowBox[{"{", 
    RowBox[{"p2", ",", "p3", ",", "p2", ",", "p1", ",", "p6", ",", "p5"}], 
    "}"}], ",", "p4", ",", "$angle"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"ChainSimplify", "[", "%", "]"}], "\[IndentingNewLine]", 
 RowBox[{"ChainSimplify", "[", 
  RowBox[{"%", ",", 
   RowBox[{"MomCon", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{"p5", "\[Rule]", 
      RowBox[{"p6", "+", "p7"}]}], "}"}]}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.8262833036618814`*^9, 3.826283330024583*^9}},
 CellLabel->"In[35]:=",ExpressionUUID->"6aaf4cb4-1076-41f4-80c3-aae24f8f3f6a"],

Cell[BoxData[
 TemplateBox[{"p1", 
   RowBox[{"{", 
     RowBox[{"p2", ",", "p3", ",", "p2", ",", "p1", ",", "p6", ",", "p5"}], 
     "}"}], "p4"},
  "AngleAngleChain",
  DisplayFunction->(
   RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
  InterpretationFunction->(
   RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle", 
     "]"}]& )]], "Output",
 CellChangeTimes->{{3.8262833051412945`*^9, 3.8262833333742533`*^9}, 
   3.826283414527525*^9},
 CellLabel->"Out[35]=",ExpressionUUID->"e384409d-a117-4e7f-9a66-0ad4a119495e"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"-", "2"}], " ", 
   TemplateBox[{"p1", 
     RowBox[{"{", 
       RowBox[{"p6", ",", "p5"}], "}"}], "p4"},
    "AngleAngleChain",
    DisplayFunction->(
     RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle", 
       "]"}]& )], " ", 
   TemplateBox[{"p1", "p3"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )], " ", 
   TemplateBox[{"p2"},
    "ScalarProduct2",
    DisplayFunction->(SuperscriptBox[
      RowBox[{"(", #, ")"}], "2"]& ),
    InterpretationFunction->(RowBox[{"mp", "[", #, ",", #, "]"}]& )]}], "+", 
  RowBox[{"4", " ", 
   TemplateBox[{"p1", 
     RowBox[{"{", 
       RowBox[{"p6", ",", "p5"}], "}"}], "p4"},
    "AngleAngleChain",
    DisplayFunction->(
     RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle", 
       "]"}]& )], " ", 
   TemplateBox[{"p1", "p2"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )], " ", 
   TemplateBox[{"p2", "p3"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(
     RowBox[{"mp", "[", #, ",", #2, "]"}]& )]}]}]], "Output",
 CellChangeTimes->{{3.8262833051412945`*^9, 3.8262833333742533`*^9}, 
   3.8262834145477076`*^9},
 CellLabel->"Out[36]=",ExpressionUUID->"9aad2848-8690-4429-ade7-d1c092690e45"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"-", "2"}], " ", 
   TemplateBox[{"p1", 
     RowBox[{"{", 
       RowBox[{"p6", ",", 
         RowBox[{"p6", "+", "p7"}]}], "}"}], "p4"},
    "AngleAngleChain",
    DisplayFunction->(
     RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle", 
       "]"}]& )], " ", 
   TemplateBox[{"p1", "p3"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )], " ", 
   TemplateBox[{"p2"},
    "ScalarProduct2",
    DisplayFunction->(SuperscriptBox[
      RowBox[{"(", #, ")"}], "2"]& ),
    InterpretationFunction->(RowBox[{"mp", "[", #, ",", #, "]"}]& )]}], "+", 
  RowBox[{"4", " ", 
   TemplateBox[{"p1", 
     RowBox[{"{", 
       RowBox[{"p6", ",", 
         RowBox[{"p6", "+", "p7"}]}], "}"}], "p4"},
    "AngleAngleChain",
    DisplayFunction->(
     RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle", 
       "]"}]& )], " ", 
   TemplateBox[{"p1", "p2"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )], " ", 
   TemplateBox[{"p2", "p3"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(
     RowBox[{"mp", "[", #, ",", #2, "]"}]& )]}]}]], "Output",
 CellChangeTimes->{{3.8262833051412945`*^9, 3.8262833333742533`*^9}, 
   3.8262834145617046`*^9},
 CellLabel->"Out[37]=",ExpressionUUID->"a496d017-46bd-49a9-b7fd-6136b862a19c"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "Repeat", " ", "but", " ", "declaring", " ", "momentum", " ", "labels"}], 
  "*)"}]], "Input",
 CellChangeTimes->{{3.826283382005054*^9, 
  3.82628339572791*^9}},ExpressionUUID->"45604e05-bdc0-4ef0-9b94-\
b51b9bf4ae2d"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"DeclareMom", "[", 
  RowBox[{"p6", ",", "p7"}], "]"}]], "Input",
 CellChangeTimes->{{3.826283417334352*^9, 3.826283436957899*^9}},
 CellLabel->"In[2]:=",ExpressionUUID->"9579e984-fef1-48d6-abde-401ae104646c"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"p6", ",", "p7"}], "}"}]], "Output",
 CellChangeTimes->{3.8262834378612037`*^9, 3.8266896824980927`*^9},
 CellLabel->"Out[2]=",ExpressionUUID->"a814c277-2b4f-4447-913b-e6c3caaea377"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"Chain", "[", 
  RowBox[{"$angle", ",", "p1", ",", 
   RowBox[{"{", 
    RowBox[{"p2", ",", "p3", ",", "p2", ",", "p1", ",", "p6", ",", "p5"}], 
    "}"}], ",", "p4", ",", "$angle"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"ChainSimplify", "[", "%", "]"}], "\[IndentingNewLine]", 
 RowBox[{"ChainSimplify", "[", 
  RowBox[{"%%", ",", 
   RowBox[{"MomCon", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{"p5", "\[Rule]", 
      RowBox[{"p6", "+", "p7"}]}], "}"}]}]}], "]"}]}], "Input",
 CellChangeTimes->{3.8262835347855062`*^9},
 CellLabel->"In[9]:=",ExpressionUUID->"ac514019-0f86-4a2b-8532-375c6fcc1911"],

Cell[BoxData[
 TemplateBox[{"p1", 
   RowBox[{"{", 
     RowBox[{
      "p2", ",", "p3", ",", "p2", ",", "p1", ",", "\"p6\"", ",", "p5"}], 
     "}"}], "p4"},
  "AngleAngleChain",
  DisplayFunction->(
   RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
  InterpretationFunction->(
   RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle", 
     "]"}]& )]], "Output",
 CellChangeTimes->{3.8262834441292095`*^9, 3.826283535708521*^9, 
  3.8266896838554587`*^9, 3.826690200406315*^9},
 CellLabel->"Out[9]=",ExpressionUUID->"935d2b73-ca42-4055-873b-2ee58d66bf7c"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"-", "2"}], " ", 
   TemplateBox[{"p1", 
     RowBox[{"{", 
       RowBox[{"\"p6\"", ",", "p5"}], "}"}], "p4"},
    "AngleAngleChain",
    DisplayFunction->(
     RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle", 
       "]"}]& )], " ", 
   TemplateBox[{"p1", "p3"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )], " ", 
   TemplateBox[{"p2"},
    "ScalarProduct2",
    DisplayFunction->(SuperscriptBox[
      RowBox[{"(", #, ")"}], "2"]& ),
    InterpretationFunction->(RowBox[{"mp", "[", #, ",", #, "]"}]& )]}], "+", 
  RowBox[{"4", " ", 
   TemplateBox[{"p1", 
     RowBox[{"{", 
       RowBox[{"\"p6\"", ",", "p5"}], "}"}], "p4"},
    "AngleAngleChain",
    DisplayFunction->(
     RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle", 
       "]"}]& )], " ", 
   TemplateBox[{"p1", "p2"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )], " ", 
   TemplateBox[{"p2", "p3"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(
     RowBox[{"mp", "[", #, ",", #2, "]"}]& )]}]}]], "Output",
 CellChangeTimes->{3.8262834441292095`*^9, 3.826283535708521*^9, 
  3.8266896838554587`*^9, 3.8266902004162917`*^9},
 CellLabel->"Out[10]=",ExpressionUUID->"eb3fd98e-1e8b-45d1-a73e-8bad6e2eebfb"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"-", "2"}], " ", 
   TemplateBox[{"p1", 
     RowBox[{"{", 
       RowBox[{"\"p6\"", ",", "\"p7\""}], "}"}], "p4"},
    "AngleAngleChain",
    DisplayFunction->(
     RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle", 
       "]"}]& )], " ", 
   TemplateBox[{"p1", "p3"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )], " ", 
   TemplateBox[{"p2"},
    "ScalarProduct2",
    DisplayFunction->(SuperscriptBox[
      RowBox[{"(", #, ")"}], "2"]& ),
    InterpretationFunction->(RowBox[{"mp", "[", #, ",", #, "]"}]& )]}], "+", 
  RowBox[{"4", " ", 
   TemplateBox[{"p1", 
     RowBox[{"{", 
       RowBox[{"\"p6\"", ",", "\"p7\""}], "}"}], "p4"},
    "AngleAngleChain",
    DisplayFunction->(
     RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle", 
       "]"}]& )], " ", 
   TemplateBox[{"p1", "p2"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )], " ", 
   TemplateBox[{"p2", "p3"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )]}], "+", 
  RowBox[{
   TemplateBox[{"\"p6\""},
    "ScalarProduct2",
    DisplayFunction->(SuperscriptBox[
      RowBox[{"(", #, ")"}], "2"]& ),
    InterpretationFunction->(RowBox[{"mp", "[", #, ",", #, "]"}]& )], " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "2"}], " ", 
      TemplateBox[{"p1", "p3"},
       "ScalarProduct",
       DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
       InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )], " ", 
      TemplateBox[{"p2"},
       "ScalarProduct2",
       DisplayFunction->(SuperscriptBox[
         RowBox[{"(", #, ")"}], "2"]& ),
       InterpretationFunction->(RowBox[{"mp", "[", #, ",", #, "]"}]& )], " ", 
      TemplateBox[{"p1", "p4"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )]}], "+", 
     RowBox[{"4", " ", 
      TemplateBox[{"p1", "p2"},
       "ScalarProduct",
       DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
       InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )], " ", 
      TemplateBox[{"p2", "p3"},
       "ScalarProduct",
       DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
       InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )], " ", 
      TemplateBox[{"p1", "p4"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )]}]}], ")"}]}]}]], "Output",
 CellChangeTimes->{3.8262834441292095`*^9, 3.826283535708521*^9, 
  3.8266896838554587`*^9, 3.8266902004252973`*^9},
 CellLabel->"Out[11]=",ExpressionUUID->"64a64dd4-afa6-4c5b-8a74-a92021b3a87c"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"Combining", " ", "with", " ", "the", " ", 
   RowBox[{"ordering", ":"}]}], "*)"}]], "Input",
 CellChangeTimes->{{3.8266902546643047`*^9, 
  3.826690266381968*^9}},ExpressionUUID->"6a7a9f45-cccf-4707-99a9-\
719958c38294"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"Chain", "[", 
  RowBox[{"$angle", ",", "p1", ",", 
   RowBox[{"{", 
    RowBox[{"p2", ",", "p3", ",", "p2", ",", "p1", ",", "p6", ",", "p5"}], 
    "}"}], ",", "p4", ",", "$angle"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"ChainSimplify", "[", "%", "]"}], "\[IndentingNewLine]", 
 RowBox[{"ChainSimplify", "[", 
  RowBox[{"%%", ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"MomCon", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"p5", "\[Rule]", 
        RowBox[{"p6", "+", "p7"}]}], "}"}]}], ",", 
     RowBox[{"ReduceBySorting", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"p7", ",", "p6"}], "}"}]}]}], "}"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.8266902723579826`*^9, 3.8266903044459996`*^9}},
 CellLabel->"In[12]:=",ExpressionUUID->"724690e2-5ce7-4a3a-a69f-1b6f230e49a7"],

Cell[BoxData[
 TemplateBox[{"p1", 
   RowBox[{"{", 
     RowBox[{
      "p2", ",", "p3", ",", "p2", ",", "p1", ",", "\"p6\"", ",", "p5"}], 
     "}"}], "p4"},
  "AngleAngleChain",
  DisplayFunction->(
   RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
  InterpretationFunction->(
   RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle", 
     "]"}]& )]], "Output",
 CellChangeTimes->{3.826690306005828*^9},
 CellLabel->"Out[12]=",ExpressionUUID->"a5a97747-e524-4530-a430-24a45c960ec6"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"-", "2"}], " ", 
   TemplateBox[{"p1", 
     RowBox[{"{", 
       RowBox[{"\"p6\"", ",", "p5"}], "}"}], "p4"},
    "AngleAngleChain",
    DisplayFunction->(
     RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle", 
       "]"}]& )], " ", 
   TemplateBox[{"p1", "p3"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )], " ", 
   TemplateBox[{"p2"},
    "ScalarProduct2",
    DisplayFunction->(SuperscriptBox[
      RowBox[{"(", #, ")"}], "2"]& ),
    InterpretationFunction->(RowBox[{"mp", "[", #, ",", #, "]"}]& )]}], "+", 
  RowBox[{"4", " ", 
   TemplateBox[{"p1", 
     RowBox[{"{", 
       RowBox[{"\"p6\"", ",", "p5"}], "}"}], "p4"},
    "AngleAngleChain",
    DisplayFunction->(
     RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle", 
       "]"}]& )], " ", 
   TemplateBox[{"p1", "p2"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )], " ", 
   TemplateBox[{"p2", "p3"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(
     RowBox[{"mp", "[", #, ",", #2, "]"}]& )]}]}]], "Output",
 CellChangeTimes->{3.826690306014802*^9},
 CellLabel->"Out[13]=",ExpressionUUID->"7b69dfd8-152f-4bf3-a837-83f4f271ead3"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"-", "2"}], " ", 
   TemplateBox[{"p1", "p3"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )], " ", 
   TemplateBox[{"p2"},
    "ScalarProduct2",
    DisplayFunction->(SuperscriptBox[
      RowBox[{"(", #, ")"}], "2"]& ),
    InterpretationFunction->(RowBox[{"mp", "[", #, ",", #, "]"}]& )], " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"-", 
      TemplateBox[{"p1", 
        RowBox[{"{", 
          RowBox[{"\"p7\"", ",", "\"p6\""}], "}"}], "p4"},
       "AngleAngleChain",
       DisplayFunction->(
        RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(
        RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
          "$angle", "]"}]& )]}], "+", 
     RowBox[{"2", " ", 
      TemplateBox[{"\"p6\"", "\"p7\""},
       "ScalarProduct",
       DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
       InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )], " ", 
      TemplateBox[{"p1", "p4"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )]}]}], ")"}]}], "+", 
  RowBox[{"4", " ", 
   TemplateBox[{"p1", "p2"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )], " ", 
   TemplateBox[{"p2", "p3"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )], " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"-", 
      TemplateBox[{"p1", 
        RowBox[{"{", 
          RowBox[{"\"p7\"", ",", "\"p6\""}], "}"}], "p4"},
       "AngleAngleChain",
       DisplayFunction->(
        RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(
        RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
          "$angle", "]"}]& )]}], "+", 
     RowBox[{"2", " ", 
      TemplateBox[{"\"p6\"", "\"p7\""},
       "ScalarProduct",
       DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
       InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )], " ", 
      TemplateBox[{"p1", "p4"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )]}]}], ")"}]}], "+", 
  RowBox[{
   TemplateBox[{"\"p6\""},
    "ScalarProduct2",
    DisplayFunction->(SuperscriptBox[
      RowBox[{"(", #, ")"}], "2"]& ),
    InterpretationFunction->(RowBox[{"mp", "[", #, ",", #, "]"}]& )], " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "2"}], " ", 
      TemplateBox[{"p1", "p3"},
       "ScalarProduct",
       DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
       InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )], " ", 
      TemplateBox[{"p2"},
       "ScalarProduct2",
       DisplayFunction->(SuperscriptBox[
         RowBox[{"(", #, ")"}], "2"]& ),
       InterpretationFunction->(RowBox[{"mp", "[", #, ",", #, "]"}]& )], " ", 
      TemplateBox[{"p1", "p4"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )]}], "+", 
     RowBox[{"4", " ", 
      TemplateBox[{"p1", "p2"},
       "ScalarProduct",
       DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
       InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )], " ", 
      TemplateBox[{"p2", "p3"},
       "ScalarProduct",
       DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
       InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )], " ", 
      TemplateBox[{"p1", "p4"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )]}]}], ")"}]}]}]], "Output",
 CellChangeTimes->{3.826690306027769*^9},
 CellLabel->"Out[14]=",ExpressionUUID->"47449294-6978-4314-8993-6d7680e910f0"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "Errors", " ", "messages", " ", "are", " ", "generated", " ", "if", " ", 
   "unacceptable", " ", "options", " ", "are", " ", "given"}], 
  "*)"}]], "Input",
 CellChangeTimes->{{3.8266903737795753`*^9, 
  3.8266903921404777`*^9}},ExpressionUUID->"a5e0b4fb-ecbe-49cf-9f98-\
076edb6f2896"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"Chain", "[", 
  RowBox[{"$angle", ",", "p1", ",", 
   RowBox[{"{", 
    RowBox[{"p2", ",", "p3", ",", "p2", ",", "p1", ",", "p6", ",", "p5"}], 
    "}"}], ",", "p4", ",", "$angle"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"ChainSimplify", "[", 
  RowBox[{"%", ",", 
   RowBox[{"MomCon", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{"p5", ",", 
      RowBox[{"p6", "+", "p7"}]}], "}"}]}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.8266903972109175`*^9, 3.8266904125987625`*^9}},
 CellLabel->"In[15]:=",ExpressionUUID->"9d770be1-78a2-4f08-8582-03b70f0f58df"],

Cell[BoxData[
 TemplateBox[{"p1", 
   RowBox[{"{", 
     RowBox[{
      "p2", ",", "p3", ",", "p2", ",", "p1", ",", "\"p6\"", ",", "p5"}], 
     "}"}], "p4"},
  "AngleAngleChain",
  DisplayFunction->(
   RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
  InterpretationFunction->(
   RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle", 
     "]"}]& )]], "Output",
 CellChangeTimes->{3.826690414181577*^9},
 CellLabel->"Out[15]=",ExpressionUUID->"981e4db9-7059-4d4b-bd92-f480ac1f8a3f"],

Cell[BoxData[
 TemplateBox[{
  "ChainSimplify", "momcon", 
   "\"Unknown form of momentum conservation, option MomCon ignored.\"", 2, 16,
    1, 25266693280912241651, "Local", "SpinorHelicity4D`ChainSimplify"},
  "MessageTemplate2"]], "Message", "MSG",
 CellChangeTimes->{3.826690414347087*^9},
 CellLabel->
  "During evaluation of \
In[15]:=",ExpressionUUID->"058bbaac-063a-4f85-88ed-39ecdb260ece"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"-", "2"}], " ", 
   TemplateBox[{"p1", 
     RowBox[{"{", 
       RowBox[{"\"p6\"", ",", "p5"}], "}"}], "p4"},
    "AngleAngleChain",
    DisplayFunction->(
     RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle", 
       "]"}]& )], " ", 
   TemplateBox[{"p1", "p3"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )], " ", 
   TemplateBox[{"p2"},
    "ScalarProduct2",
    DisplayFunction->(SuperscriptBox[
      RowBox[{"(", #, ")"}], "2"]& ),
    InterpretationFunction->(RowBox[{"mp", "[", #, ",", #, "]"}]& )]}], "+", 
  RowBox[{"4", " ", 
   TemplateBox[{"p1", 
     RowBox[{"{", 
       RowBox[{"\"p6\"", ",", "p5"}], "}"}], "p4"},
    "AngleAngleChain",
    DisplayFunction->(
     RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle", 
       "]"}]& )], " ", 
   TemplateBox[{"p1", "p2"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )], " ", 
   TemplateBox[{"p2", "p3"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(
     RowBox[{"mp", "[", #, ",", #2, "]"}]& )]}]}]], "Output",
 CellChangeTimes->{3.8266904144278684`*^9},
 CellLabel->"Out[16]=",ExpressionUUID->"2e4da1a4-58cb-49c3-b476-9a4c9f951a96"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"Chain", "[", 
  RowBox[{"$angle", ",", "p1", ",", 
   RowBox[{"{", 
    RowBox[{"p2", ",", "p3", ",", "p2", ",", "p1", ",", "p6", ",", "p5"}], 
    "}"}], ",", "p4", ",", "$angle"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"ChainSimplify", "[", 
  RowBox[{"%", ",", 
   RowBox[{"ReduceBySorting", "\[Rule]", "5"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.8266904317724886`*^9, 3.826690455625698*^9}},
 CellLabel->"In[17]:=",ExpressionUUID->"b3bad7c1-33e6-453f-97e4-abde2b51fae9"],

Cell[BoxData[
 TemplateBox[{"p1", 
   RowBox[{"{", 
     RowBox[{
      "p2", ",", "p3", ",", "p2", ",", "p1", ",", "\"p6\"", ",", "p5"}], 
     "}"}], "p4"},
  "AngleAngleChain",
  DisplayFunction->(
   RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
  InterpretationFunction->(
   RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle", 
     "]"}]& )]], "Output",
 CellChangeTimes->{3.826690456194172*^9},
 CellLabel->"Out[17]=",ExpressionUUID->"607e181f-4a68-4302-b7fb-7b91207ef358"],

Cell[BoxData[
 TemplateBox[{
  "ChainSimplify", "sort", 
   "\"Unknown form of ordering, option ReduceBySorting ignored\"", 2, 18, 2, 
   25266693280912241651, "Local", "SpinorHelicity4D`ChainSimplify"},
  "MessageTemplate2"]], "Message", "MSG",
 CellChangeTimes->{3.8266904562001553`*^9},
 CellLabel->
  "During evaluation of \
In[17]:=",ExpressionUUID->"dd89554a-6bb9-495e-88dd-7a79d14c0b58"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"-", "2"}], " ", 
   TemplateBox[{"p1", 
     RowBox[{"{", 
       RowBox[{"\"p6\"", ",", "p5"}], "}"}], "p4"},
    "AngleAngleChain",
    DisplayFunction->(
     RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle", 
       "]"}]& )], " ", 
   TemplateBox[{"p1", "p3"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )], " ", 
   TemplateBox[{"p2"},
    "ScalarProduct2",
    DisplayFunction->(SuperscriptBox[
      RowBox[{"(", #, ")"}], "2"]& ),
    InterpretationFunction->(RowBox[{"mp", "[", #, ",", #, "]"}]& )]}], "+", 
  RowBox[{"4", " ", 
   TemplateBox[{"p1", 
     RowBox[{"{", 
       RowBox[{"\"p6\"", ",", "p5"}], "}"}], "p4"},
    "AngleAngleChain",
    DisplayFunction->(
     RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle", 
       "]"}]& )], " ", 
   TemplateBox[{"p1", "p2"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(RowBox[{"mp", "[", #, ",", #2, "]"}]& )], " ", 
   TemplateBox[{"p2", "p3"},
    "ScalarProduct",
    DisplayFunction->(RowBox[{"(", #, "\[CenterDot]", #2, ")"}]& ),
    InterpretationFunction->(
     RowBox[{"mp", "[", #, ",", #2, "]"}]& )]}]}]], "Output",
 CellChangeTimes->{3.8266904562151146`*^9},
 CellLabel->"Out[18]=",ExpressionUUID->"f25ee265-e8c1-45da-9989-b6047b25db28"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
},
WindowSize->{959.0999999999999, 526.8},
WindowMargins->{{87.6, Automatic}, {Automatic, 13.5}},
InputAliases->{"intt" -> RowBox[{"\[Integral]", 
     RowBox[{"\[SelectionPlaceholder]", 
       RowBox[{"\[DifferentialD]", "\[Placeholder]"}]}]}], "dintt" -> RowBox[{
     SubsuperscriptBox[
     "\[Integral]", "\[SelectionPlaceholder]", "\[Placeholder]"], 
     RowBox[{"\[Placeholder]", 
       RowBox[{"\[DifferentialD]", "\[Placeholder]"}]}]}], "rintt" -> RowBox[{
     UnderscriptBox["\[Integral]", 
      RowBox[{"\[SelectionPlaceholder]", "\[Element]", "\[Placeholder]"}]], 
     "\[Placeholder]"}], "sumt" -> RowBox[{
     UnderoverscriptBox["\[Sum]", 
      RowBox[{"\[SelectionPlaceholder]", "=", "\[Placeholder]"}], 
      "\[Placeholder]"], "\[Placeholder]"}], "prodt" -> RowBox[{
     UnderoverscriptBox["\[Product]", 
      RowBox[{"\[SelectionPlaceholder]", "=", "\[Placeholder]"}], 
      "\[Placeholder]"], "\[Placeholder]"}], "dt" -> RowBox[{
     SubscriptBox["\[PartialD]", "\[Placeholder]"], " ", 
     "\[SelectionPlaceholder]"}], "cbrt" -> 
  RadicalBox[
   "\[SelectionPlaceholder]", "3", SurdForm -> True, MultilineFunction -> 
    None], "surd" -> 
  RadicalBox[
   "\[SelectionPlaceholder]", "\[Placeholder]", SurdForm -> True, 
    MultilineFunction -> None], "ket" -> 
  TemplateBox[{"\[SelectionPlaceholder]"}, "Ket"], "bra" -> 
  TemplateBox[{"\[SelectionPlaceholder]"}, "Bra"], "braket" -> 
  TemplateBox[{"\[SelectionPlaceholder]", "\[Placeholder]"}, "BraKet"], 
  "delay" -> TemplateBox[{"\[SelectionPlaceholder]"}, "SystemsModelDelay"], 
  "grad" -> RowBox[{
     SubscriptBox["\[Del]", "\[SelectionPlaceholder]"], "\[Placeholder]"}], 
  "del." -> RowBox[{
     SubscriptBox["\[Del]", "\[SelectionPlaceholder]"], ".", 
     "\[Placeholder]"}], "delx" -> RowBox[{
     SubscriptBox["\[Del]", "\[SelectionPlaceholder]"], "\[Cross]", 
     "\[Placeholder]"}], "del2" -> RowBox[{
     SubsuperscriptBox["\[Del]", "\[SelectionPlaceholder]", 2], 
     "\[Placeholder]"}], "kd" -> 
  TemplateBox[{"\[SelectionPlaceholder]"}, "KroneckerDeltaSeq"], "algs" -> 
  TemplateBox[{}, "Algebraics"], "bools" -> TemplateBox[{}, "Booleans"], 
  "comps" -> TemplateBox[{}, "Complexes"], "ints" -> 
  TemplateBox[{}, "Integers"], "pris" -> TemplateBox[{}, "Primes"], "rats" -> 
  TemplateBox[{}, "Rationals"], "reals" -> TemplateBox[{}, "Reals"], "dlim" -> 
  RowBox[{
     UnderscriptBox["\[Limit]", 
      RowBox[{"\[SelectionPlaceholder]", 
        UnderscriptBox["\[Rule]", 
         TemplateBox[{}, "Integers"]], "\[Infinity]"}]], "\[Placeholder]"}], 
  "dMlim" -> RowBox[{
     UnderscriptBox["\[MaxLimit]", 
      RowBox[{"\[SelectionPlaceholder]", 
        UnderscriptBox["\[Rule]", 
         TemplateBox[{}, "Integers"]], "\[Infinity]"}]], "\[Placeholder]"}], 
  "dmlim" -> RowBox[{
     UnderscriptBox["\[MinLimit]", 
      RowBox[{"\[SelectionPlaceholder]", 
        UnderscriptBox["\[Rule]", 
         TemplateBox[{}, "Integers"]], "\[Infinity]"}]], "\[Placeholder]"}], 
  "notation" -> RowBox[{"Notation", "[", 
     RowBox[{
       TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
       "\[DoubleLongLeftRightArrow]", " ", 
       TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
  "notation>" -> RowBox[{"Notation", "[", 
     RowBox[{
       TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
       "\[DoubleLongRightArrow]", " ", 
       TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
  "notation<" -> RowBox[{"Notation", "[", 
     RowBox[{
       TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
       "\[DoubleLongLeftArrow]", " ", 
       TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
  "symb" -> RowBox[{"Symbolize", "[", 
     TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
  "infixnotation" -> RowBox[{"InfixNotation", "[", 
     RowBox[{
       TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
       "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
     RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
       TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
  "pattwraper" -> 
  TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
  "madeboxeswraper" -> 
  TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"], "lu" -> 
  TemplateBox[{"\[SelectionPlaceholder]", "\[SelectionPlaceholder]"}, 
    "SpinorLaUp", DisplayFunction -> (RowBox[{
       SuperscriptBox["\[Lambda]", #2], "[", #, "]"}]& ), 
    InterpretationFunction -> (
     RowBox[{"SpinorUndot", "[", #, "]", "[", "$lam", "]", "[", #2, "]", "[", 
       "Null", "]"}]& )], "ld" -> 
  TemplateBox[{"\[SelectionPlaceholder]", "\[SelectionPlaceholder]"}, 
    "SpinorLaDown", DisplayFunction -> (RowBox[{
       SubscriptBox["\[Lambda]", #2], "[", #, "]"}]& ), 
    InterpretationFunction -> (
     RowBox[{"SpinorUndot", "[", #, "]", "[", "$lam", "]", "[", "Null", "]", 
       "[", #2, "]"}]& )], "muu" -> 
  TemplateBox[{"\[SelectionPlaceholder]", "\[SelectionPlaceholder]"}, 
    "SpinorMuUp", DisplayFunction -> (RowBox[{
       SuperscriptBox["\[Mu]", #2], "[", #, "]"}]& ), 
    InterpretationFunction -> (
     RowBox[{"SpinorUndot", "[", #, "]", "[", "$mu", "]", "[", #2, "]", "[", 
       "Null", "]"}]& )], "mud" -> 
  TemplateBox[{"\[SelectionPlaceholder]", "\[SelectionPlaceholder]"}, 
    "SpinorMuDown", DisplayFunction -> (RowBox[{
       SubscriptBox["\[Mu]", #2], "[", #, "]"}]& ), 
    InterpretationFunction -> (
     RowBox[{"SpinorUndot", "[", #, "]", "[", "$mu", "]", "[", "Null", "]", 
       "[", #2, "]"}]& )], "lp" -> 
  TemplateBox[{"\[SelectionPlaceholder]"}, "SpinorUndotBareL", 
    DisplayFunction -> (RowBox[{"\[Lambda]", "[", #, "]"}]& ), 
    InterpretationFunction -> (
     RowBox[{"SpinorUndotBare", "[", #, "]", "[", "$lam", "]"}]& )], "mp" -> 
  TemplateBox[{"\[SelectionPlaceholder]"}, "SpinorUndotBareM", 
    DisplayFunction -> (RowBox[{"\[Mu]", "[", #, "]"}]& ), 
    InterpretationFunction -> (
     RowBox[{"SpinorUndotBare", "[", #, "]", "[", "$mu", "]"}]& )], "ltu" -> 
  TemplateBox[{"\[SelectionPlaceholder]", "\[SelectionPlaceholder]"}, 
    "SpinorLatUp", DisplayFunction -> (RowBox[{
       SuperscriptBox[
        OverscriptBox["\[Lambda]", "~"], #2], "[", #, "]"}]& ), 
    InterpretationFunction -> (
     RowBox[{"SpinorDot", "[", #, "]", "[", "$lam", "]", "[", #2, "]", "[", 
       "Null", "]"}]& )], "ltd" -> 
  TemplateBox[{"\[SelectionPlaceholder]", "\[SelectionPlaceholder]"}, 
    "SpinorLatDown", DisplayFunction -> (RowBox[{
       SubscriptBox[
        OverscriptBox["\[Lambda]", "~"], #2], "[", #, "]"}]& ), 
    InterpretationFunction -> (
     RowBox[{"SpinorDot", "[", #, "]", "[", "$lam", "]", "[", "Null", "]", 
       "[", #2, "]"}]& )], "mtu" -> 
  TemplateBox[{"\[SelectionPlaceholder]", "\[SelectionPlaceholder]"}, 
    "SpinorMutUp", DisplayFunction -> (RowBox[{
       SuperscriptBox[
        OverscriptBox["\[Mu]", "~"], #2], "[", #, "]"}]& ), 
    InterpretationFunction -> (
     RowBox[{"SpinorDot", "[", #, "]", "[", "$mu", "]", "[", #2, "]", "[", 
       "Null", "]"}]& )], "mtd" -> 
  TemplateBox[{"\[SelectionPlaceholder]", "\[SelectionPlaceholder]"}, 
    "SpinorMutDown", DisplayFunction -> (RowBox[{
       SubscriptBox[
        OverscriptBox["\[Mu]", "~"], #2], "[", #, "]"}]& ), 
    InterpretationFunction -> (
     RowBox[{"SpinorDot", "[", #, "]", "[", "$mu", "]", "[", "Null", "]", 
       "[", #2, "]"}]& )], "ltp" -> 
  TemplateBox[{"\[SelectionPlaceholder]"}, "SpinorDotBareL", 
    DisplayFunction -> (RowBox[{
       OverscriptBox["\[Lambda]", "~"], "[", #, "]"}]& ), 
    InterpretationFunction -> (
     RowBox[{"SpinorDotBare", "[", #, "]", "[", "$lam", "]"}]& )], "mtp" -> 
  TemplateBox[{"\[SelectionPlaceholder]"}, "SpinorDotBareM", 
    DisplayFunction -> (RowBox[{
       OverscriptBox["\[Mu]", "~"], "[", #, "]"}]& ), 
    InterpretationFunction -> (
     RowBox[{"SpinorDotBare", "[", #, "]", "[", "$mu", "]"}]& )], "ab" -> 
  TemplateBox[{"\[SelectionPlaceholder]", "\[Placeholder]"}, 
    "SpinorAngleBracket", DisplayFunction -> (RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ), 
    InterpretationFunction -> (RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], "sb" -> 
  TemplateBox[{"\[SelectionPlaceholder]", "\[Placeholder]"}, 
    "SpinorSquareBracket", DisplayFunction -> (RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ), 
    InterpretationFunction -> (RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], "cas" -> 
  TemplateBox[{"\[SelectionPlaceholder]", 
     RowBox[{"{", "\[SelectionPlaceholder]", "}"}], 
     "\[SelectionPlaceholder]"}, "AngleSquareChain", 
    DisplayFunction -> (RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ), 
    InterpretationFunction -> (
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square",
        "]"}]& )], "csa" -> TemplateBox[{"\[SelectionPlaceholder]", 
     RowBox[{"{", "\[SelectionPlaceholder]", "}"}], 
     "\[SelectionPlaceholder]"}, "SquareAngleChain", 
    DisplayFunction -> (RowBox[{"[", #, #2, #3, "\[RightAngleBracket]"}]& ), 
    InterpretationFunction -> (
     RowBox[{"Chain", "[", "$square", ",", #, ",", #2, ",", #3, ",", "$angle",
        "]"}]& )], "caa" -> TemplateBox[{"\[SelectionPlaceholder]", 
     RowBox[{"{", "\[SelectionPlaceholder]", "}"}], 
     "\[SelectionPlaceholder]"}, "AngleAngleChain", 
    DisplayFunction -> (
     RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ), 
    InterpretationFunction -> (
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle", 
       "]"}]& )], "css" -> TemplateBox[{"\[SelectionPlaceholder]", 
     RowBox[{"{", "\[SelectionPlaceholder]", "}"}], 
     "\[SelectionPlaceholder]"}, "SquareSquareChain", 
    DisplayFunction -> (RowBox[{"[", #, #2, #3, "]"}]& ), 
    InterpretationFunction -> (
     RowBox[{"Chain", "[", "$square", ",", #, ",", #2, ",", #3, ",", 
       "$square", "]"}]& )], "lcup" -> 
  TemplateBox[{"\[SelectionPlaceholder]", "\[SelectionPlaceholder]"}, 
    "LevicivitaSHUp", DisplayFunction -> (SuperscriptBox["\[Epsilon]", 
      RowBox[{#, #2}]]& ), 
    InterpretationFunction -> (
     RowBox[{"LeviCivitaSH", "[", #, ",", #2, "]", "[", "$up", "]"}]& )], 
  "lcd" -> TemplateBox[{"\[SelectionPlaceholder]", "\[SelectionPlaceholder]"},
     "LevicivitaSHDown", DisplayFunction -> (SubscriptBox["\[Epsilon]", 
      RowBox[{#, #2}]]& ), 
    InterpretationFunction -> (
     RowBox[{"LeviCivitaSH", "[", #, ",", #2, "]", "[", "$down", "]"}]& )]},
Magnification:>0.9 Inherited,
FrontEndVersion->"12.2 for Microsoft Windows (64-bit) (December 12, 2020)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"3f52fc21-9a99-4d35-a42b-0f541fc67db7"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 209, 3, 25, "Input",ExpressionUUID->"9147f9b4-17d7-4958-a69a-c065c3c13cf0"],
Cell[CellGroupData[{
Cell[814, 29, 924, 15, 19, "Print",ExpressionUUID->"bc7b3377-c9f5-4f70-b743-d73c4d2277a8"],
Cell[1741, 46, 913, 14, 19, "Print",ExpressionUUID->"32c92ce0-9900-415a-b602-7508d6e41bfe"],
Cell[2657, 62, 900, 14, 19, "Print",ExpressionUUID->"b58aa187-ef0c-42e0-a862-272edb3a49cd"],
Cell[3560, 78, 903, 14, 19, "Print",ExpressionUUID->"e8148c12-9373-43be-9a5a-c4a7338eddac"],
Cell[4466, 94, 909, 14, 19, "Print",ExpressionUUID->"966ea036-97b7-40bb-a49d-8d735ae33407"],
Cell[5378, 110, 984, 18, 22, "Print",ExpressionUUID->"fba1c15a-22aa-44fe-9618-d549fb46ccfa"],
Cell[6365, 130, 920, 14, 19, "Print",ExpressionUUID->"e40a9b0c-7f22-46d6-b98f-425873ea7d98"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[7334, 150, 159, 3, 59, "Section",ExpressionUUID->"ebe2bd24-62b2-49b8-9fd8-ee51f5183c48"],
Cell[CellGroupData[{
Cell[7518, 157, 223, 4, 48, "Subsection",ExpressionUUID->"995a8f52-76ee-477d-97f3-91b8d3753e37"],
Cell[7744, 163, 29125, 740, 1298, "Code",ExpressionUUID->"fff488d2-c9bd-4d1a-85ad-03f94a86822f"]
}, Closed]],
Cell[CellGroupData[{
Cell[36906, 908, 178, 3, 34, "Subsection",ExpressionUUID->"78473574-21be-4363-aa2c-87cb65d865f1"],
Cell[37087, 913, 4192, 102, 330, "Code",ExpressionUUID->"2d7bd423-4964-42d0-af05-d77d238a92bc"]
}, Closed]],
Cell[CellGroupData[{
Cell[41316, 1020, 154, 3, 34, "Subsection",ExpressionUUID->"825c79bc-d2b8-4567-822a-86633231e742"],
Cell[CellGroupData[{
Cell[41495, 1027, 745, 16, 24, "Input",ExpressionUUID->"7dfc6b25-0cdc-4e54-92b7-0a19c8568009"],
Cell[42243, 1045, 464, 10, 28, "Output",ExpressionUUID->"3567cd11-68ad-4d27-9e31-e0099376c4be"]
}, Open  ]],
Cell[CellGroupData[{
Cell[42744, 1060, 233, 4, 24, "Input",ExpressionUUID->"0e4eb29e-4b9d-416c-bd7b-df90fc7ecf39"],
Cell[42980, 1066, 193, 4, 28, "Output",ExpressionUUID->"6537dc92-52af-4949-9246-d8190dd7521c"]
}, Open  ]],
Cell[CellGroupData[{
Cell[43210, 1075, 676, 15, 24, "Input",ExpressionUUID->"22236442-7d99-473e-ad52-c80a7b498e7d"],
Cell[43889, 1092, 492, 11, 28, "Output",ExpressionUUID->"cd15c529-b638-4481-86f4-84f26736afc2"]
}, Open  ]],
Cell[CellGroupData[{
Cell[44418, 1108, 207, 3, 24, "Input",ExpressionUUID->"2c0c344b-a653-40ee-892c-d533c911f9cd"],
Cell[44628, 1113, 191, 4, 39, "Output",ExpressionUUID->"e640c997-d80e-4960-8513-7ac96ee0ab6e"]
}, Open  ]],
Cell[CellGroupData[{
Cell[44856, 1122, 207, 3, 24, "Input",ExpressionUUID->"66b6b651-cc54-4462-b66b-732f53c24946"],
Cell[45066, 1127, 760, 16, 28, "Output",ExpressionUUID->"ceda1bf9-e998-444d-9d2a-2b1a797ff2f4"]
}, Open  ]],
Cell[CellGroupData[{
Cell[45863, 1148, 205, 3, 24, "Input",ExpressionUUID->"d1b52fc1-d0ad-4ac0-aa64-668da7ae79a3"],
Cell[46071, 1153, 207, 4, 39, "Output",ExpressionUUID->"186f95c0-e6d4-4b58-b0fd-78f9867301c7"]
}, Open  ]],
Cell[CellGroupData[{
Cell[46315, 1162, 205, 3, 24, "Input",ExpressionUUID->"7da5d810-eecb-4f67-9fb1-8f30d3c95ce2"],
Cell[46523, 1167, 218, 4, 28, "Output",ExpressionUUID->"5ab5c204-d727-497b-8ccd-6d400d4e8243"]
}, Open  ]],
Cell[CellGroupData[{
Cell[46778, 1176, 259, 4, 24, "Input",ExpressionUUID->"15859a40-ffb1-4eb5-a722-692b0438741e"],
Cell[47040, 1182, 241, 4, 28, "Output",ExpressionUUID->"73daabf8-5b27-4c05-b0ba-441711089dae"]
}, Open  ]],
Cell[CellGroupData[{
Cell[47318, 1191, 5117, 118, 201, "Input",ExpressionUUID->"8294e995-8fe1-45cd-8cf8-0e852b0071b0"],
Cell[52438, 1311, 4455, 98, 91, "Output",ExpressionUUID->"815614e3-3908-4898-b68a-0a44ea592f29"]
}, Open  ]],
Cell[CellGroupData[{
Cell[56930, 1414, 487, 10, 24, "Input",ExpressionUUID->"f8ff5ae2-5e6f-4af4-8120-01eb3ef96b91"],
Cell[57420, 1426, 455, 9, 28, "Output",ExpressionUUID->"27fd1254-5466-46e2-b59d-4c36b58b24e7"]
}, Open  ]],
Cell[CellGroupData[{
Cell[57912, 1440, 481, 10, 24, "Input",ExpressionUUID->"ea6b31b8-ab65-42fc-92db-30b0d14e1e04"],
Cell[58396, 1452, 227, 4, 39, "Output",ExpressionUUID->"aa4bbd94-10d6-4acf-98fd-ddfa7721a2f8"]
}, Open  ]],
Cell[CellGroupData[{
Cell[58660, 1461, 212, 3, 24, "Input",ExpressionUUID->"4231ce9f-5dc1-4052-86f2-32fbeba61770"],
Cell[58875, 1466, 241, 5, 28, "Output",ExpressionUUID->"f538ec04-04f2-48ec-a968-0642c6bac803"]
}, Open  ]],
Cell[CellGroupData[{
Cell[59153, 1476, 216, 3, 24, "Input",ExpressionUUID->"41056d40-e5a3-41f7-88f5-c34078e2c88f"],
Cell[59372, 1481, 179, 2, 28, "Output",ExpressionUUID->"3fe167f9-c812-4868-95ac-18246758f295"]
}, Open  ]],
Cell[CellGroupData[{
Cell[59588, 1488, 322, 6, 24, "Input",ExpressionUUID->"bb381f56-b91b-42ac-b2f4-f3b827eda3de"],
Cell[59913, 1496, 245, 4, 28, "Output",ExpressionUUID->"447be6e2-ea7f-4099-8548-9f905be44325"]
}, Open  ]],
Cell[CellGroupData[{
Cell[60195, 1505, 296, 6, 27, "Input",ExpressionUUID->"270f3f2e-db38-4ac2-bc39-ea8ac853f0f7"],
Cell[60494, 1513, 178, 2, 28, "Output",ExpressionUUID->"2ebda9e4-39d6-4727-8d88-efceb051b1fc"]
}, Open  ]],
Cell[CellGroupData[{
Cell[60709, 1520, 252, 4, 24, "Input",ExpressionUUID->"97fe2021-aedb-4d21-b455-f69c77fa17f8"],
Cell[60964, 1526, 226, 3, 39, "Output",ExpressionUUID->"a2c0ec66-b71c-4ac7-a176-da656bf708a6"]
}, Open  ]],
Cell[CellGroupData[{
Cell[61227, 1534, 211, 3, 24, "Input",ExpressionUUID->"e9e763f2-759c-4e6c-b49e-cadc0cbe6e1e"],
Cell[61441, 1539, 217, 4, 28, "Output",ExpressionUUID->"62fdc27f-d557-472b-9ef7-f3c48dfb0793"]
}, Open  ]],
Cell[CellGroupData[{
Cell[61695, 1548, 323, 7, 24, "Input",ExpressionUUID->"4ee6504d-a9fb-4b94-8a22-ea7fc7a45b5d"],
Cell[62021, 1557, 479, 11, 28, "Output",ExpressionUUID->"5a720822-d898-44fc-be2f-ce85c9a3ca6a"]
}, Open  ]],
Cell[CellGroupData[{
Cell[62537, 1573, 206, 3, 24, "Input",ExpressionUUID->"260983e8-cfcf-4735-8927-2b10cdeea709"],
Cell[62746, 1578, 738, 16, 28, "Output",ExpressionUUID->"20632c2f-df12-481b-bcf9-cd435bb5136c"]
}, Open  ]]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[63545, 1601, 212, 4, 59, "Section",ExpressionUUID->"339b6666-88af-461f-a3c5-0a037d90bd02"],
Cell[CellGroupData[{
Cell[63782, 1609, 167, 3, 48, "Subsection",ExpressionUUID->"12352be9-3855-4ff4-a132-af5ca5bfd65b"],
Cell[63952, 1614, 11030, 259, 678, "Code",ExpressionUUID->"a5d82bed-4800-48fd-9695-68cd8c63331b"]
}, Closed]],
Cell[CellGroupData[{
Cell[75019, 1878, 220, 4, 34, "Subsection",ExpressionUUID->"9d8e50a3-18b8-4073-9d94-7a22842daa6f"],
Cell[75242, 1884, 725, 14, 77, "Input",ExpressionUUID->"5a1fb630-d00c-46dc-8b5b-9d00d1b1908e"],
Cell[75970, 1900, 11030, 259, 678, "Code",ExpressionUUID->"79aa8d99-97d5-46d1-82a3-2b40a06449cc"],
Cell[87003, 2161, 4685, 103, 526, "Input",ExpressionUUID->"61233cc0-a6ef-45b0-9e19-22c38c0f7110"],
Cell[CellGroupData[{
Cell[91713, 2268, 620, 14, 24, "Input",ExpressionUUID->"da4e5c56-149f-4f82-808b-d6e04ef3375c"],
Cell[CellGroupData[{
Cell[92358, 2286, 225, 7, 21, "Echo",ExpressionUUID->"81616a87-0787-455b-9775-dbdc496312f8"],
Cell[92586, 2295, 129, 3, 21, "Echo",ExpressionUUID->"ffc09647-6b9b-498b-9e3b-d6b5127d1e3c"],
Cell[92718, 2300, 152, 4, 21, "Echo",ExpressionUUID->"44e00c8c-0593-47a6-b9fe-f98486a26b7c"],
Cell[92873, 2306, 814, 20, 21, "Echo",ExpressionUUID->"3640aa0e-14ee-4c09-9662-cfffed85b4ec"]
}, Open  ]],
Cell[93702, 2329, 1089, 22, 28, "Output",ExpressionUUID->"a0766e6d-ac62-4d18-8fee-8ce5561b859f"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[94840, 2357, 157, 3, 34, "Subsection",ExpressionUUID->"83cd5743-cc8e-40d4-aa6c-59dc45fc79b4"],
Cell[95000, 2362, 309, 6, 43, "Input",ExpressionUUID->"df26cdcb-9dbc-458a-b709-847dc22016a8"],
Cell[95312, 2370, 410, 9, 25, "Input",ExpressionUUID->"20eb8d89-b25b-4385-bce5-6631ac26a4e3"],
Cell[CellGroupData[{
Cell[95747, 2383, 552, 13, 25, "Input",ExpressionUUID->"f1f48a06-4e77-4d7a-be82-1d6ca9fc1f8e"],
Cell[96302, 2398, 537, 12, 29, "Output",ExpressionUUID->"f0dc35ec-003d-422a-aacb-18219b0b46da"]
}, Open  ]],
Cell[CellGroupData[{
Cell[96876, 2415, 351, 6, 25, "Input",ExpressionUUID->"9993f243-bafd-4d0f-bb1f-18616cc8f40d"],
Cell[97230, 2423, 258, 5, 29, "Output",ExpressionUUID->"fc343393-48b5-4a05-bbd8-7e42cc01406e"]
}, Open  ]],
Cell[CellGroupData[{
Cell[97525, 2433, 552, 13, 25, "Input",ExpressionUUID->"98c82299-c32f-4644-b298-dd80bc6dc4f8"],
Cell[98080, 2448, 859, 19, 29, "Output",ExpressionUUID->"87cf34ea-b86c-43d1-92a3-2544ff02412a"]
}, Open  ]],
Cell[98954, 2470, 542, 12, 43, "Input",ExpressionUUID->"88c0a270-e416-4af7-9309-974de219a403"],
Cell[CellGroupData[{
Cell[99521, 2486, 673, 15, 25, "Input",ExpressionUUID->"b961ab42-ff5c-4bc4-a11e-4f15d90daabc"],
Cell[100197, 2503, 910, 21, 29, "Output",ExpressionUUID->"81d98ce3-d1f8-4f49-a9c2-4b4c73fb8db3"]
}, Open  ]],
Cell[101122, 2527, 344, 8, 25, "Input",ExpressionUUID->"f4993a4c-46b6-4bcc-8c5b-af40097f9eed"],
Cell[101469, 2537, 232, 4, 25, "Input",ExpressionUUID->"003ef6dd-3125-4e34-a76f-388d4423b338"],
Cell[CellGroupData[{
Cell[101726, 2545, 218, 3, 25, "Input",ExpressionUUID->"bd457b87-f23e-47cf-b8f1-066584c90109"],
Cell[101947, 2550, 172, 3, 29, "Output",ExpressionUUID->"0a8c0ed7-71f3-471d-9700-812a9b36f8d8"]
}, Open  ]],
Cell[CellGroupData[{
Cell[102156, 2558, 552, 13, 25, "Input",ExpressionUUID->"48d3f0b3-d1ce-4283-a295-1fc58b0c135e"],
Cell[102711, 2573, 472, 10, 29, "Output",ExpressionUUID->"6ad178fc-ea8c-45b9-8416-0a9822295057"]
}, Open  ]],
Cell[CellGroupData[{
Cell[103220, 2588, 218, 3, 25, "Input",ExpressionUUID->"57d521e4-469c-472e-bc5e-710f1785f716"],
Cell[103441, 2593, 196, 4, 29, "Output",ExpressionUUID->"e347e2a8-dc44-4080-ba79-ddd04f8c94df"]
}, Open  ]],
Cell[103652, 2600, 560, 13, 43, "Input",ExpressionUUID->"8445c7ab-bb81-4b24-880b-e443d0c7e5e1"],
Cell[CellGroupData[{
Cell[104237, 2617, 552, 13, 25, "Input",ExpressionUUID->"9903d5d6-b6f3-416d-acbc-17d63f11f4b8"],
Cell[104792, 2632, 829, 19, 29, "Output",ExpressionUUID->"5682f636-cc7c-4dc9-b1a9-60ace8f9a0b1"]
}, Open  ]]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[105682, 2658, 156, 3, 59, "Section",ExpressionUUID->"a5fbe05a-325b-41ae-bdd5-14ce4be141bb"],
Cell[CellGroupData[{
Cell[105863, 2665, 87, 0, 48, "Subsection",ExpressionUUID->"b0ef0f54-cbec-4d4d-92a6-4338b688977c"],
Cell[105953, 2667, 5819, 139, 299, "Code",ExpressionUUID->"04b9025e-6bf4-446d-b8d2-3af5dd131498"]
}, Closed]],
Cell[CellGroupData[{
Cell[111809, 2811, 230, 4, 34, "Subsection",ExpressionUUID->"96843218-e7ab-4611-8e6f-c05413a8dba8"],
Cell[112042, 2817, 280, 7, 25, "Input",ExpressionUUID->"ffd214a2-bf1f-4b1e-8738-719eff8856e2"],
Cell[112325, 2826, 215, 3, 25, "Input",ExpressionUUID->"88bb10bf-2cf0-4b26-82c7-4127163d572c"],
Cell[112543, 2831, 24542, 554, 996, "Code",ExpressionUUID->"253d3b18-3da4-4f0b-b67f-c7d5529c1817"]
}, Closed]],
Cell[CellGroupData[{
Cell[137122, 3390, 155, 3, 34, "Subsection",ExpressionUUID->"a6d14dec-7dec-46fd-ade9-79ae1626d0cb"],
Cell[137280, 3395, 315, 7, 43, "Input",ExpressionUUID->"18a5ee49-9f06-4108-9c5f-60d4f3f5acbb"],
Cell[137598, 3404, 836, 19, 43, "Input",ExpressionUUID->"089800ad-0ba2-429c-adf6-2a7ed9ca33cb"],
Cell[CellGroupData[{
Cell[138459, 3427, 380, 9, 25, "Input",ExpressionUUID->"b9d6490d-5795-4725-bf37-d3503f364cb1"],
Cell[138842, 3438, 1047, 26, 29, "Output",ExpressionUUID->"66b2d7dd-9177-4a77-b634-b624ca3d32d3"]
}, Open  ]],
Cell[139904, 3467, 579, 12, 43, "Input",ExpressionUUID->"02bded40-1a1b-4034-b9c7-48cd215857be"],
Cell[CellGroupData[{
Cell[140508, 3483, 401, 9, 25, "Input",ExpressionUUID->"bd148c42-bee9-4992-9110-b6b58e32de24"],
Cell[140912, 3494, 3373, 81, 47, "Output",ExpressionUUID->"e99f452e-845b-4b39-ba91-59f983968ba7"]
}, Open  ]],
Cell[CellGroupData[{
Cell[144322, 3580, 443, 10, 25, "Input",ExpressionUUID->"cb94b18e-9f79-4e6e-9b37-9a3c31155acd"],
Cell[144768, 3592, 3585, 86, 47, "Output",ExpressionUUID->"27fd6da2-5721-4b13-b146-51494aad43c7"]
}, Open  ]],
Cell[148368, 3681, 337, 8, 25, "Input",ExpressionUUID->"ff67ddae-fbe1-4228-a314-98915f346ce4"],
Cell[CellGroupData[{
Cell[148730, 3693, 786, 16, 25, "Input",ExpressionUUID->"c6b90bf5-b990-433e-849d-d2a044e21a15"],
Cell[149519, 3711, 2574, 60, 29, "Output",ExpressionUUID->"11964ca0-7084-406d-a51e-6c59667116d0"]
}, Open  ]],
Cell[152108, 3774, 557, 13, 43, "Input",ExpressionUUID->"6de8ff03-35e2-41b9-82d4-fc8818e473df"],
Cell[CellGroupData[{
Cell[152690, 3791, 468, 12, 25, "Input",ExpressionUUID->"04ea4ded-8929-4f8b-ad9e-6eed2cdc1342"],
Cell[153161, 3805, 1647, 42, 29, "Output",ExpressionUUID->"850d0781-af7d-4cfb-a781-4189e3a28d37"]
}, Open  ]],
Cell[154823, 3850, 701, 13, 43, "Input",ExpressionUUID->"97fae555-6bf0-4d1b-9457-5d87a1f9d971"],
Cell[CellGroupData[{
Cell[155549, 3867, 220, 4, 25, "Input",ExpressionUUID->"59813a73-ccd8-478b-9e7b-c6c9ed26aacf"],
Cell[155772, 3873, 178, 4, 29, "Output",ExpressionUUID->"4e862e69-4e33-4864-80b5-b7ca9d4aefb4"]
}, Open  ]],
Cell[CellGroupData[{
Cell[155987, 3882, 429, 10, 25, "Input",ExpressionUUID->"b3ee5f4d-8e32-4e6f-9060-0cfd28b37011"],
Cell[156419, 3894, 1065, 26, 29, "Output",ExpressionUUID->"feac9c01-06b8-4c9f-9b20-a37647783f3f"]
}, Open  ]],
Cell[CellGroupData[{
Cell[157521, 3925, 220, 4, 25, "Input",ExpressionUUID->"7a41f550-07f3-4d2b-927b-7e5bc7195667"],
Cell[157744, 3931, 202, 5, 29, "Output",ExpressionUUID->"d4c32e69-e88a-402f-b560-87e20f355c71"]
}, Open  ]],
Cell[CellGroupData[{
Cell[157983, 3941, 312, 8, 25, "Input",ExpressionUUID->"127c0e99-2ba6-45f8-ba9a-c86355544df7"],
Cell[158298, 3951, 2093, 50, 29, "Output",ExpressionUUID->"6dcac98c-09f1-4ae0-b29e-41267a1cc8db"]
}, Open  ]],
Cell[160406, 4004, 242, 6, 25, "Input",ExpressionUUID->"03ec63d4-c582-4d66-be40-0201e68f8b40"],
Cell[CellGroupData[{
Cell[160673, 4014, 484, 12, 25, "Input",ExpressionUUID->"42c86160-6ed1-4b7e-8b76-7c7dc960b195"],
Cell[161160, 4028, 2590, 61, 29, "Output",ExpressionUUID->"0c70602b-4578-449b-993f-d14f9d42cfee"]
}, Open  ]],
Cell[163765, 4092, 215, 5, 25, "Input",ExpressionUUID->"53b2fd12-38db-4c01-8df8-3c0cf42dd5f3"],
Cell[CellGroupData[{
Cell[164005, 4101, 706, 15, 25, "Input",ExpressionUUID->"057f9349-1109-4a02-9bee-aa8cf7fb3ce9"],
Cell[164714, 4118, 2535, 58, 29, "Output",ExpressionUUID->"7a012c50-7db5-41e8-b3b7-314b1e139db3"]
}, Open  ]],
Cell[CellGroupData[{
Cell[167286, 4181, 491, 12, 25, "Input",ExpressionUUID->"7b9c5a44-90f1-4dcb-8c08-6de6255bafe3"],
Cell[167780, 4195, 1662, 41, 29, "Output",ExpressionUUID->"3a4e6675-bf30-4135-9f71-ffe5f09b77db"]
}, Open  ]],
Cell[CellGroupData[{
Cell[169479, 4241, 491, 12, 25, "Input",ExpressionUUID->"bee69a88-6990-4c0b-8891-8b6a5c20f61c"],
Cell[169973, 4255, 1128, 28, 29, "Output",ExpressionUUID->"ef7d7151-f683-48e8-b96b-f807a73515c1"]
}, Open  ]]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[171162, 4290, 157, 3, 59, "Section",ExpressionUUID->"aa61789c-7ec6-4c36-a881-f7adb1e97829"],
Cell[CellGroupData[{
Cell[171344, 4297, 165, 3, 48, "Subsection",ExpressionUUID->"a7a353da-63a6-4ad5-80e4-1f3b7b28d5ea"],
Cell[171512, 4302, 5842, 150, 457, "Input",ExpressionUUID->"25552cd9-6b9c-4c54-80b8-1fb1459ca726"]
}, Closed]],
Cell[CellGroupData[{
Cell[177391, 4457, 216, 4, 34, "Subsection",ExpressionUUID->"5b2325dc-a7a3-45da-a6b4-213c83138354"],
Cell[177610, 4463, 469, 12, 43, "Input",ExpressionUUID->"9a2c2400-cc99-444d-b78c-d997aa70c180"],
Cell[178082, 4477, 10176, 237, 993, "Input",ExpressionUUID->"39be02b8-303f-4965-a297-39a568679bba"]
}, Open  ]],
Cell[CellGroupData[{
Cell[188295, 4719, 157, 3, 48, "Subsection",ExpressionUUID->"da0f6e61-a258-4156-a721-844b7f52b948"],
Cell[188455, 4724, 830, 21, 44, "Input",ExpressionUUID->"a3725ff1-ce36-4a6d-bcff-4aead49d0a46"],
Cell[CellGroupData[{
Cell[189310, 4749, 391, 8, 43, "Input",ExpressionUUID->"e7b251c6-9d23-472a-9976-76ec45eb9ec0"],
Cell[189704, 4759, 517, 12, 29, "Output",ExpressionUUID->"7c2d1bd6-b5da-493b-ac08-4e9919ebe5e4"],
Cell[190224, 4773, 688, 14, 29, "Output",ExpressionUUID->"eec64512-2a3a-4dc7-8107-27f05e7215df"]
}, Open  ]],
Cell[CellGroupData[{
Cell[190949, 4792, 416, 8, 43, "Input",ExpressionUUID->"5dfaa9ea-7a1a-4083-bc75-2355e10b0ffd"],
Cell[191368, 4802, 539, 12, 29, "Output",ExpressionUUID->"dd429cc9-086d-42f1-a7c9-1ce106489f82"],
Cell[191910, 4816, 1631, 36, 30, "Output",ExpressionUUID->"831a0492-9a6d-48da-bd6f-748e52d08808"]
}, Open  ]],
Cell[193556, 4855, 299, 7, 25, "Input",ExpressionUUID->"88ab4bec-e906-44a2-966f-837c440f6e29"],
Cell[CellGroupData[{
Cell[193880, 4866, 492, 9, 43, "Input",ExpressionUUID->"ea8ac9f7-a9d8-43ca-9cd6-8f6abda9cbc6"],
Cell[194375, 4877, 569, 13, 29, "Output",ExpressionUUID->"f9e9aa6a-17b3-4430-b536-4a797db1a3c0"],
Cell[194947, 4892, 1747, 43, 30, "Output",ExpressionUUID->"637149a7-07dc-4d30-98cd-593c8c275d89"]
}, Open  ]],
Cell[196709, 4938, 448, 10, 25, "Input",ExpressionUUID->"230b1ae0-332c-4e33-aaed-f731d4df58b2"],
Cell[CellGroupData[{
Cell[197182, 4952, 507, 10, 43, "Input",ExpressionUUID->"9e8ce819-d680-4e08-a1cd-11cfc641580a"],
Cell[197692, 4964, 518, 12, 29, "Output",ExpressionUUID->"04dd1355-2888-47fe-96a6-9774ec0701e9"],
Cell[198213, 4978, 2946, 69, 30, "Output",ExpressionUUID->"312cf99d-4f00-460c-a445-7f901bdf42ab"]
}, Open  ]],
Cell[201174, 5050, 556, 11, 43, "Input",ExpressionUUID->"7d703d9e-43da-4cff-80bd-e39de850333b"],
Cell[CellGroupData[{
Cell[201755, 5065, 711, 16, 61, "Input",ExpressionUUID->"7031b234-3c46-491f-a027-bbbdb04217f9"],
Cell[202469, 5083, 539, 12, 29, "Output",ExpressionUUID->"4ae9f2cf-5ea8-4c7b-a8a1-e92cbacd6b66"],
Cell[203011, 5097, 1935, 46, 29, "Output",ExpressionUUID->"c6aa577f-1100-468f-b21b-b0be3d02eee2"],
Cell[204949, 5145, 4022, 99, 47, "Output",ExpressionUUID->"a037a2fc-786b-4629-bb10-dd38bef4df97"]
}, Open  ]],
Cell[208986, 5247, 872, 16, 61, "Input",ExpressionUUID->"fe81ce04-ecd0-4089-93ad-59dcf3d27a35"],
Cell[209861, 5265, 311, 6, 43, "Input",ExpressionUUID->"d890a552-1d77-450f-a527-e3a604169408"],
Cell[CellGroupData[{
Cell[210197, 5275, 525, 12, 43, "Input",ExpressionUUID->"a74e376c-ec93-4ff4-a036-9c857724c96b"],
Cell[210725, 5289, 458, 10, 29, "Output",ExpressionUUID->"4d0c6311-2f11-4c35-be3c-bda37afba149"],
Cell[211186, 5301, 456, 10, 29, "Output",ExpressionUUID->"47e39fdd-908d-4e88-bd0a-0b9492306d06"]
}, Open  ]],
Cell[211657, 5314, 271, 6, 25, "Input",ExpressionUUID->"760c2991-b32f-4c86-ad91-6ce33c1ca8f2"],
Cell[CellGroupData[{
Cell[211953, 5324, 240, 4, 25, "Input",ExpressionUUID->"cfb40174-0bd3-4313-9139-e54f083da78c"],
Cell[212196, 5330, 198, 4, 29, "Output",ExpressionUUID->"b934002b-4329-4439-a164-8d08f963afd4"]
}, Open  ]],
Cell[CellGroupData[{
Cell[212431, 5339, 457, 11, 43, "Input",ExpressionUUID->"244b38c3-6cf9-42fa-8443-0736748ddf4e"],
Cell[212891, 5352, 470, 10, 29, "Output",ExpressionUUID->"63201b11-333d-4b69-b3f2-88da31763ee9"],
Cell[213364, 5364, 470, 10, 29, "Output",ExpressionUUID->"8ced51ca-8244-44e2-ace1-76f6e2bd7264"]
}, Open  ]],
Cell[213849, 5377, 730, 16, 43, "Input",ExpressionUUID->"db898a10-45d3-4b3e-8251-04fa61723642"],
Cell[214582, 5395, 311, 6, 43, "Input",ExpressionUUID->"9db9deba-3ec9-44bc-ba75-9d97cfdd8a1c"],
Cell[CellGroupData[{
Cell[214918, 5405, 651, 14, 61, "Input",ExpressionUUID->"6aaf4cb4-1076-41f4-80c3-aae24f8f3f6a"],
Cell[215572, 5421, 570, 13, 29, "Output",ExpressionUUID->"e384409d-a117-4e7f-9a66-0ad4a119495e"],
Cell[216145, 5436, 1750, 43, 30, "Output",ExpressionUUID->"9aad2848-8690-4429-ade7-d1c092690e45"],
Cell[217898, 5481, 1812, 45, 30, "Output",ExpressionUUID->"a496d017-46bd-49a9-b7fd-6136b862a19c"]
}, Open  ]],
Cell[219725, 5529, 262, 7, 25, "Input",ExpressionUUID->"45604e05-bdc0-4ef0-9b94-b51b9bf4ae2d"],
Cell[CellGroupData[{
Cell[220012, 5540, 232, 4, 25, "Input",ExpressionUUID->"9579e984-fef1-48d6-abde-401ae104646c"],
Cell[220247, 5546, 221, 4, 29, "Output",ExpressionUUID->"a814c277-2b4f-4447-913b-e6c3caaea377"]
}, Open  ]],
Cell[CellGroupData[{
Cell[220505, 5555, 627, 14, 61, "Input",ExpressionUUID->"ac514019-0f86-4a2b-8532-375c6fcc1911"],
Cell[221135, 5571, 599, 14, 29, "Output",ExpressionUUID->"935d2b73-ca42-4055-873b-2ee58d66bf7c"],
Cell[221737, 5587, 1777, 43, 30, "Output",ExpressionUUID->"eb3fd98e-1e8b-45d1-a73e-8bad6e2eebfb"],
Cell[223517, 5632, 3557, 82, 33, "Output",ExpressionUUID->"64a64dd4-afa6-4c5b-8a74-a92021b3a87c"]
}, Open  ]],
Cell[227089, 5717, 261, 6, 25, "Input",ExpressionUUID->"6a7a9f45-cccf-4707-99a9-719958c38294"],
Cell[CellGroupData[{
Cell[227375, 5727, 814, 19, 61, "Input",ExpressionUUID->"724690e2-5ce7-4a3a-a69f-1b6f230e49a7"],
Cell[228192, 5748, 527, 13, 29, "Output",ExpressionUUID->"a5a97747-e524-4530-a430-24a45c960ec6"],
Cell[228722, 5763, 1702, 42, 30, "Output",ExpressionUUID->"7b69dfd8-152f-4bf3-a837-83f4f271ead3"],
Cell[230427, 5807, 4756, 109, 51, "Output",ExpressionUUID->"47449294-6978-4314-8993-6d7680e910f0"]
}, Open  ]],
Cell[235198, 5919, 330, 8, 25, "Input",ExpressionUUID->"a5e0b4fb-ecbe-49cf-9f98-076edb6f2896"],
Cell[CellGroupData[{
Cell[235553, 5931, 580, 13, 43, "Input",ExpressionUUID->"9d770be1-78a2-4f08-8582-03b70f0f58df"],
Cell[236136, 5946, 527, 13, 29, "Output",ExpressionUUID->"981e4db9-7059-4d4b-bd92-f480ac1f8a3f"],
Cell[236666, 5961, 399, 9, 23, "Message",ExpressionUUID->"058bbaac-063a-4f85-88ed-39ecdb260ece"],
Cell[237068, 5972, 1704, 42, 30, "Output",ExpressionUUID->"2e4da1a4-58cb-49c3-b476-9a4c9f951a96"]
}, Open  ]],
Cell[CellGroupData[{
Cell[238809, 6019, 506, 10, 43, "Input",ExpressionUUID->"b3bad7c1-33e6-453f-97e4-abde2b51fae9"],
Cell[239318, 6031, 527, 13, 29, "Output",ExpressionUUID->"607e181f-4a68-4302-b7fb-7b91207ef358"],
Cell[239848, 6046, 394, 9, 23, "Message",ExpressionUUID->"dd89554a-6bb9-495e-88dd-7a79d14c0b58"],
Cell[240245, 6057, 1704, 42, 30, "Output",ExpressionUUID->"f25ee265-e8c1-45da-9989-b6047b25db28"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}
]
*)

