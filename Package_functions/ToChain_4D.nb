(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.2' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[   1471420,      37188]
NotebookOptionsPosition[   1368619,      35568]
NotebookOutlinePosition[   1379722,      35786]
CellTagsIndexPosition[   1379679,      35783]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell[BoxData[
 RowBox[{"<<", "SpinorHelicity4D`"}]], "Input",
 CellChangeTimes->{{3.8249904609912305`*^9, 3.824990466785639*^9}},
 CellLabel->"In[28]:=",ExpressionUUID->"506cb47d-39ed-4a38-898a-605bf6517c76"],

Cell[CellGroupData[{

Cell[BoxData["\<\"===============SpinorHelicity4D================\"\>"], \
"Print",
 CellChangeTimes->{3.8249909257807035`*^9, 3.8249912954225893`*^9, 
  3.8250485819010506`*^9, 3.8251343051622057`*^9, 3.8253930808780766`*^9, 
  3.825480286300015*^9, 3.825762466267127*^9, 3.8260026339199257`*^9, 
  3.8260824956555634`*^9, 3.826085855927064*^9, 3.82610424198376*^9, 
  3.826104971736287*^9},
 CellLabel->
  "During evaluation of \
In[28]:=",ExpressionUUID->"0fb71339-63a4-41d5-8404-70391e363404"],

Cell[BoxData["\<\"Author: Manuel Accettulli Huber (QMUL)\"\>"], "Print",
 CellChangeTimes->{3.8249909257807035`*^9, 3.8249912954225893`*^9, 
  3.8250485819010506`*^9, 3.8251343051622057`*^9, 3.8253930808780766`*^9, 
  3.825480286300015*^9, 3.825762466267127*^9, 3.8260026339199257`*^9, 
  3.8260824956555634`*^9, 3.826085855927064*^9, 3.82610424198376*^9, 
  3.82610497174327*^9},
 CellLabel->
  "During evaluation of \
In[28]:=",ExpressionUUID->"f4e99b36-8555-4ee5-bb2c-9c81bface823"],

Cell[BoxData["\<\"Please report any bug to:\"\>"], "Print",
 CellChangeTimes->{3.8249909257807035`*^9, 3.8249912954225893`*^9, 
  3.8250485819010506`*^9, 3.8251343051622057`*^9, 3.8253930808780766`*^9, 
  3.825480286300015*^9, 3.825762466267127*^9, 3.8260026339199257`*^9, 
  3.8260824956555634`*^9, 3.826085855927064*^9, 3.82610424198376*^9, 
  3.826104971750251*^9},
 CellLabel->
  "During evaluation of \
In[28]:=",ExpressionUUID->"ad3cf54d-a4a4-4c5b-b5ed-9afc03a244c9"],

Cell[BoxData["\<\"m.accettullihuber@qmul.ac.uk\"\>"], "Print",
 CellChangeTimes->{3.8249909257807035`*^9, 3.8249912954225893`*^9, 
  3.8250485819010506`*^9, 3.8251343051622057`*^9, 3.8253930808780766`*^9, 
  3.825480286300015*^9, 3.825762466267127*^9, 3.8260026339199257`*^9, 
  3.8260824956555634`*^9, 3.826085855927064*^9, 3.82610424198376*^9, 
  3.8261049717582293`*^9},
 CellLabel->
  "During evaluation of \
In[28]:=",ExpressionUUID->"bbc260b7-1a6d-4c00-bffa-bee66dcc46d3"],

Cell[BoxData["\<\"Version 1.0 , last update 03/08/2020\"\>"], "Print",
 CellChangeTimes->{3.8249909257807035`*^9, 3.8249912954225893`*^9, 
  3.8250485819010506`*^9, 3.8251343051622057`*^9, 3.8253930808780766`*^9, 
  3.825480286300015*^9, 3.825762466267127*^9, 3.8260026339199257`*^9, 
  3.8260824956555634`*^9, 3.826085855927064*^9, 3.82610424198376*^9, 
  3.826104971765178*^9},
 CellLabel->
  "During evaluation of \
In[28]:=",ExpressionUUID->"98b3b544-0fac-4645-8cbf-0af9815382aa"],

Cell[BoxData[
 TemplateBox[{
  "\"Click here for full documentation\"", 
   "https://github.com/accettullihuber"},
  "HyperlinkURL"]], "Print",
 CellChangeTimes->{3.8249909257807035`*^9, 3.8249912954225893`*^9, 
  3.8250485819010506`*^9, 3.8251343051622057`*^9, 3.8253930808780766`*^9, 
  3.825480286300015*^9, 3.825762466267127*^9, 3.8260026339199257`*^9, 
  3.8260824956555634`*^9, 3.826085855927064*^9, 3.82610424198376*^9, 
  3.8261049717731905`*^9},
 CellLabel->
  "During evaluation of \
In[28]:=",ExpressionUUID->"878b7500-e788-44a1-800f-4ed127843cfd"],

Cell[BoxData["\<\"=============================================\"\>"], "Print",
 CellChangeTimes->{3.8249909257807035`*^9, 3.8249912954225893`*^9, 
  3.8250485819010506`*^9, 3.8251343051622057`*^9, 3.8253930808780766`*^9, 
  3.825480286300015*^9, 3.825762466267127*^9, 3.8260026339199257`*^9, 
  3.8260824956555634`*^9, 3.826085855927064*^9, 3.82610424198376*^9, 
  3.8261049717801695`*^9},
 CellLabel->
  "During evaluation of \
In[28]:=",ExpressionUUID->"1e769453-da0e-49b8-bb0b-92c4d3a05fda"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["ToChain old", "Subsection",
 CellChangeTimes->{{3.8249904944493628`*^9, 
  3.8249904954972568`*^9}},ExpressionUUID->"9f319fe4-d15e-446d-b3e6-\
d4eda036544d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "ToChain0", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"MinimalChains", "->", "True"}], "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ToChain0", "[", 
    RowBox[{"exp_", ",", 
     RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ChainPow", ",", "locexp"}], "}"}], ",", "\n", 
     RowBox[{"(*", 
      RowBox[{"Chain", " ", 
       RowBox[{"properties", ":"}]}], "*)"}], "\n", "\n", 
     RowBox[{"(*", "Basics", "*)"}], "\n", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"ChainPow", "[", "x__", "]"}], "[", "0", "]"}], ":=", "1"}], 
      ";", "\n", "\n", 
      RowBox[{"(*", 
       RowBox[{
       "Minus", " ", "signs", " ", "in", " ", "the", " ", "external", " ", 
        "brackest"}], "*)"}], "\n", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"ChainPow", "[", 
          RowBox[{"type1_", ",", 
           RowBox[{"-", "x_"}], ",", 
           RowBox[{"{", "y___", "}"}], ",", "z_", ",", "type2_"}], "]"}], "[",
          "n_", "]"}], "/;", 
        RowBox[{"MemberQ", "[", 
         RowBox[{"MomList", ",", "x"}], "]"}]}], ":=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", "I", ")"}], "^", "n"}], "*", 
        RowBox[{
         RowBox[{"ChainPow", "[", 
          RowBox[{"type1", ",", "x", ",", 
           RowBox[{"{", "y", "}"}], ",", "z", ",", "type2"}], "]"}], "[", "n",
          "]"}]}]}], ";", "\n", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"ChainPow", "[", 
          RowBox[{"type1_", ",", "x_", ",", 
           RowBox[{"{", "y___", "}"}], ",", 
           RowBox[{"-", "z_"}], ",", "type2_"}], "]"}], "[", "n_", "]"}], "/;", 
        RowBox[{"MemberQ", "[", 
         RowBox[{"MomList", ",", "z"}], "]"}]}], ":=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", "I", ")"}], "^", "n"}], "*", 
        RowBox[{
         RowBox[{"ChainPow", "[", 
          RowBox[{"type1", ",", "x", ",", 
           RowBox[{"{", "y", "}"}], ",", "z", ",", "type2"}], "]"}], "[", "n",
          "]"}]}]}], ";", "\n", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"ChainPow", "[", 
          RowBox[{"type1_", ",", 
           RowBox[{"-", "x_"}], ",", 
           RowBox[{"{", "y___", "}"}], ",", 
           RowBox[{"-", "z_"}], ",", "type2_"}], "]"}], "[", "n_", "]"}], "/;", 
        RowBox[{
         RowBox[{"MemberQ", "[", 
          RowBox[{"MomList", ",", "x"}], "]"}], "&&", 
         RowBox[{"MemberQ", "[", 
          RowBox[{"MomList", ",", "z"}], "]"}]}]}], ":=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"-", "1"}], ")"}], "^", "n"}], "*", 
        RowBox[{
         RowBox[{"ChainPow", "[", 
          RowBox[{"type1", ",", "x", ",", 
           RowBox[{"{", "y", "}"}], ",", "z", ",", "type2"}], "]"}], "[", "n",
          "]"}]}]}], ";", "\n", "\n", 
      RowBox[{"(*", 
       RowBox[{"SquareAngle", " ", "as", " ", "AngleSquare"}], "*)"}], "\n", 
      RowBox[{
       RowBox[{
        RowBox[{"ChainPow", "[", 
         RowBox[{"$square", ",", "x_", ",", 
          RowBox[{"{", "y__", "}"}], ",", "z_", ",", "$angle"}], "]"}], "[", 
        "n_", "]"}], ":=", 
       RowBox[{
        RowBox[{"ChainPow", "[", 
         RowBox[{"$angle", ",", "z", ",", 
          RowBox[{"Reverse", "[", 
           RowBox[{"{", "y", "}"}], "]"}], ",", "x", ",", "$square"}], "]"}], 
        "[", "n", "]"}]}], ";", "\n", "\n", 
      RowBox[{"(*", 
       RowBox[{"The", " ", "actual", " ", "contraction", " ", "properties"}], 
       "*)"}], "\n", "\n", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
         RowBox[{" ", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"x", "..."}], "y"}]}], "\[RightAngleBracket]"}], "[", 
         RowBox[{
          RowBox[{"y", "..."}], "z"}]}], ")"}], " ", "*)"}], "\n", 
      RowBox[{"ChainPow", " ", "/:", " ", 
       RowBox[{"Times", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"ChainPow", "[", 
           RowBox[{"type1_", ",", "x_", ",", 
            RowBox[{"{", "k___", "}"}], ",", "y_", ",", "$angle"}], "]"}], 
          "[", 
          RowBox[{"n_", "?", "Positive"}], "]"}], ",", 
         RowBox[{
          RowBox[{"ChainPow", "[", 
           RowBox[{"$square", ",", "y_", ",", 
            RowBox[{"{", "q___", "}"}], ",", "z_", ",", "type2_"}], "]"}], 
          "[", 
          RowBox[{"m_", "?", "Positive"}], "]"}]}], "]"}], ":=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"n", ">=", "m"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"type1", ",", "x", ",", 
             RowBox[{"{", 
              RowBox[{"k", ",", "y", ",", "q"}], "}"}], ",", "z", ",", 
             "type2"}], "]"}], "[", "m", "]"}], 
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"type1", ",", "x", ",", 
             RowBox[{"{", "k", "}"}], ",", "y", ",", "$angle"}], "]"}], "[", 
           RowBox[{"n", "-", "m"}], "]"}]}], ",", "\n", 
         RowBox[{
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"type1", ",", "x", ",", 
             RowBox[{"{", 
              RowBox[{"k", ",", "y", ",", "q"}], "}"}], ",", "z", ",", 
             "type2"}], "]"}], "[", "n", "]"}], 
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"$square", ",", "y", ",", 
             RowBox[{"{", "q", "}"}], ",", "z", ",", "type2"}], "]"}], "[", 
           RowBox[{"m", "-", "n"}], "]"}]}]}], "\n", "]"}]}], ";", "\n", "\n", 
      RowBox[{"ChainPow", " ", "/:", " ", 
       RowBox[{"Times", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"ChainPow", "[", 
           RowBox[{"type1_", ",", "x_", ",", 
            RowBox[{"{", "k___", "}"}], ",", "y_", ",", "$angle"}], "]"}], 
          "[", 
          RowBox[{"n_", "?", "Negative"}], "]"}], ",", 
         RowBox[{
          RowBox[{"ChainPow", "[", 
           RowBox[{"$square", ",", "y_", ",", 
            RowBox[{"{", "q___", "}"}], ",", "z_", ",", "type2_"}], "]"}], 
          "[", 
          RowBox[{"m_", "?", "Negative"}], "]"}]}], "]"}], ":=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"n", "<=", "m"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"type1", ",", "x", ",", 
             RowBox[{"{", 
              RowBox[{"k", ",", "y", ",", "q"}], "}"}], ",", "z", ",", 
             "type2"}], "]"}], "[", "m", "]"}], 
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"type1", ",", "x", ",", 
             RowBox[{"{", "k", "}"}], ",", "y", ",", "$angle"}], "]"}], "[", 
           RowBox[{"n", "-", "m"}], "]"}]}], ",", "\n", 
         RowBox[{
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"type1", ",", "x", ",", 
             RowBox[{"{", 
              RowBox[{"k", ",", "y", ",", "q"}], "}"}], ",", "z", ",", 
             "type2"}], "]"}], "[", "n", "]"}], 
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"$square", ",", "y", ",", 
             RowBox[{"{", "q", "}"}], ",", "z", ",", "type2"}], "]"}], "[", 
           RowBox[{"m", "-", "n"}], "]"}]}]}], "\n", "]"}]}], ";", "\n", "\n", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"\[LeftAngleBracket]", 
           RowBox[{
            RowBox[{"y", "..."}], "x"}]}], ")"}], "[", 
         RowBox[{
          RowBox[{"y", "..."}], "z"}]}], ")"}], " ", "*)"}], "\n", 
      RowBox[{"ChainPow", " ", "/:", " ", 
       RowBox[{"Times", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"ChainPow", "[", 
           RowBox[{"$angle", ",", "y_", ",", 
            RowBox[{"{", "k___", "}"}], ",", "x_", ",", "type1_"}], "]"}], 
          "[", 
          RowBox[{"n_", "?", "Positive"}], "]"}], ",", 
         RowBox[{
          RowBox[{"ChainPow", "[", 
           RowBox[{"$square", ",", "y_", ",", 
            RowBox[{"{", "q___", "}"}], ",", "z_", ",", "type2_"}], "]"}], 
          "[", 
          RowBox[{"m_", "?", "Positive"}], "]"}]}], "]"}], ":=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"n", ">=", "m"}], ",", "\n", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"-", "1"}], ")"}], "^", 
           RowBox[{"(", 
            RowBox[{"m", "*", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Length", "[", 
                RowBox[{"{", "k", "}"}], "]"}], "+", "1"}], ")"}]}], ")"}]}], 
          "*", 
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"type1", ",", "x", ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Sequence", "@@", 
                RowBox[{"Reverse", "[", 
                 RowBox[{"{", "k", "}"}], "]"}]}], ",", "y", ",", "q"}], 
              "}"}], ",", "z", ",", "type2"}], "]"}], "[", "m", "]"}], 
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"$angle", ",", "y", ",", 
             RowBox[{"{", "k", "}"}], ",", "x", ",", "type1"}], "]"}], "[", 
           RowBox[{"n", "-", "m"}], "]"}]}], ",", "\n", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"-", "1"}], ")"}], "^", 
           RowBox[{"(", 
            RowBox[{"n", "*", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Length", "[", 
                RowBox[{"{", "k", "}"}], "]"}], "+", "1"}], ")"}]}], ")"}]}], 
          "*", 
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"type1", ",", "x", ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Sequence", "@@", 
                RowBox[{"Reverse", "[", 
                 RowBox[{"{", "k", "}"}], "]"}]}], ",", "y", ",", "q"}], 
              "}"}], ",", "z", ",", "type2"}], "]"}], "[", "n", "]"}], 
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"$square", ",", "y", ",", 
             RowBox[{"{", "q", "}"}], ",", "z", ",", "type2"}], "]"}], "[", 
           RowBox[{"m", "-", "n"}], "]"}]}]}], "\n", "]"}]}], ";", "\n", "\n", 
      RowBox[{"ChainPow", " ", "/:", " ", 
       RowBox[{"Times", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"ChainPow", "[", 
           RowBox[{"$angle", ",", "y_", ",", 
            RowBox[{"{", "k___", "}"}], ",", "x_", ",", "type1_"}], "]"}], 
          "[", 
          RowBox[{"n_", "?", "Negative"}], "]"}], ",", 
         RowBox[{
          RowBox[{"ChainPow", "[", 
           RowBox[{"$square", ",", "y_", ",", 
            RowBox[{"{", "q___", "}"}], ",", "z_", ",", "type2_"}], "]"}], 
          "[", 
          RowBox[{"m_", "?", "Negative"}], "]"}]}], "]"}], ":=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"n", "<=", "m"}], ",", "\n", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"-", "1"}], ")"}], "^", 
           RowBox[{"(", 
            RowBox[{"m", "*", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Length", "[", 
                RowBox[{"{", "k", "}"}], "]"}], "+", "1"}], ")"}]}], ")"}]}], 
          "*", 
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"type1", ",", "x", ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Sequence", "@@", 
                RowBox[{"Reverse", "[", 
                 RowBox[{"{", "k", "}"}], "]"}]}], ",", "y", ",", "q"}], 
              "}"}], ",", "z", ",", "type2"}], "]"}], "[", "m", "]"}], 
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"$angle", ",", "y", ",", 
             RowBox[{"{", "k", "}"}], ",", "x", ",", "type1"}], "]"}], "[", 
           RowBox[{"n", "-", "m"}], "]"}]}], ",", "\n", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"-", "1"}], ")"}], "^", 
           RowBox[{"(", 
            RowBox[{"n", "*", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Length", "[", 
                RowBox[{"{", "k", "}"}], "]"}], "+", "1"}], ")"}]}], ")"}]}], 
          "*", 
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"type1", ",", "x", ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Sequence", "@@", 
                RowBox[{"Reverse", "[", 
                 RowBox[{"{", "k", "}"}], "]"}]}], ",", "y", ",", "q"}], 
              "}"}], ",", "z", ",", "type2"}], "]"}], "[", "n", "]"}], 
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"$square", ",", "y", ",", 
             RowBox[{"{", "q", "}"}], ",", "z", ",", "type2"}], "]"}], "[", 
           RowBox[{"m", "-", "n"}], "]"}]}]}], "\n", "]"}]}], ";", "\n", "\n", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"x", "..."}], "y"}]}], "\[RightAngleBracket]"}], "[", 
         RowBox[{
          RowBox[{"y", "..."}], "z"}]}], ")"}], "*)"}], "\n", 
      RowBox[{"ChainPow", " ", "/:", " ", 
       RowBox[{"Times", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"ChainPow", "[", 
           RowBox[{"type1_", ",", "x_", ",", 
            RowBox[{"{", "k___", "}"}], ",", "y_", ",", "$angle"}], "]"}], 
          "[", 
          RowBox[{"n_", "?", "Positive"}], "]"}], ",", 
         RowBox[{
          RowBox[{"ChainPow", "[", 
           RowBox[{"type2_", ",", "z_", ",", 
            RowBox[{"{", "q___", "}"}], ",", "y_", ",", "$square"}], "]"}], 
          "[", 
          RowBox[{"m_", "?", "Positive"}], "]"}]}], "]"}], ":=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"n", ">=", "m"}], ",", "\n", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"-", "1"}], ")"}], "^", 
           RowBox[{"(", 
            RowBox[{"m", "*", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Length", "[", 
                RowBox[{"{", "q", "}"}], "]"}], "+", "1"}], ")"}]}], ")"}]}], 
          "*", 
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"type1", ",", "x", ",", 
             RowBox[{"{", 
              RowBox[{"k", ",", "y", ",", 
               RowBox[{"Sequence", "@@", 
                RowBox[{"Reverse", "[", 
                 RowBox[{"{", "q", "}"}], "]"}]}]}], "}"}], ",", "z", ",", 
             "type2"}], "]"}], "[", "m", "]"}], 
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"type1", ",", "x", ",", 
             RowBox[{"{", "k", "}"}], ",", "y", ",", "$angle"}], "]"}], "[", 
           RowBox[{"n", "-", "m"}], "]"}]}], ",", "\n", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"-", "1"}], ")"}], "^", 
           RowBox[{"(", 
            RowBox[{"n", "*", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Length", "[", 
                RowBox[{"{", "q", "}"}], "]"}], "+", "1"}], ")"}]}], ")"}]}], 
          "*", 
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"type1", ",", "x", ",", 
             RowBox[{"{", 
              RowBox[{"k", ",", "y", ",", 
               RowBox[{"Sequence", "@@", 
                RowBox[{"Reverse", "[", 
                 RowBox[{"{", "q", "}"}], "]"}]}]}], "}"}], ",", "z", ",", 
             "type2"}], "]"}], "[", "n", "]"}], 
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"type2", ",", "z", ",", 
             RowBox[{"{", "q", "}"}], ",", "y", ",", "$square"}], "]"}], "[", 
           RowBox[{"m", "-", "n"}], "]"}]}]}], "\n", "]"}]}], ";", "\n", "\n", 
      RowBox[{"ChainPow", " ", "/:", " ", 
       RowBox[{"Times", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"ChainPow", "[", 
           RowBox[{"type1_", ",", "x_", ",", 
            RowBox[{"{", "k___", "}"}], ",", "y_", ",", "$angle"}], "]"}], 
          "[", 
          RowBox[{"n_", "?", "Negative"}], "]"}], ",", 
         RowBox[{
          RowBox[{"ChainPow", "[", 
           RowBox[{"type2_", ",", "z_", ",", 
            RowBox[{"{", "q___", "}"}], ",", "y_", ",", "$square"}], "]"}], 
          "[", 
          RowBox[{"m_", "?", "Negative"}], "]"}]}], "]"}], ":=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"n", "<=", "m"}], ",", "\n", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"-", "1"}], ")"}], "^", 
           RowBox[{"(", 
            RowBox[{"m", "*", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Length", "[", 
                RowBox[{"{", "q", "}"}], "]"}], "+", "1"}], ")"}]}], ")"}]}], 
          "*", 
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"type1", ",", "x", ",", 
             RowBox[{"{", 
              RowBox[{"k", ",", "y", ",", 
               RowBox[{"Sequence", "@@", 
                RowBox[{"Reverse", "[", 
                 RowBox[{"{", "q", "}"}], "]"}]}]}], "}"}], ",", "z", ",", 
             "type2"}], "]"}], "[", "m", "]"}], 
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"type1", ",", "x", ",", 
             RowBox[{"{", "k", "}"}], ",", "y", ",", "$angle"}], "]"}], "[", 
           RowBox[{"n", "-", "m"}], "]"}]}], ",", "\n", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"-", "1"}], ")"}], "^", 
           RowBox[{"(", 
            RowBox[{"n", "*", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Length", "[", 
                RowBox[{"{", "q", "}"}], "]"}], "+", "1"}], ")"}]}], ")"}]}], 
          "*", 
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"type1", ",", "x", ",", 
             RowBox[{"{", 
              RowBox[{"k", ",", "y", ",", 
               RowBox[{"Sequence", "@@", 
                RowBox[{"Reverse", "[", 
                 RowBox[{"{", "q", "}"}], "]"}]}]}], "}"}], ",", "z", ",", 
             "type2"}], "]"}], "[", "n", "]"}], 
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"type2", ",", "z", ",", 
             RowBox[{"{", "q", "}"}], ",", "y", ",", "$square"}], "]"}], "[", 
           RowBox[{"m", "-", "n"}], "]"}]}]}], "\n", "]"}]}], ";", "\n", "\n", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
         RowBox[{" ", 
          RowBox[{"\[LeftAngleBracket]", 
           RowBox[{
            RowBox[{"y", "..."}], "x"}]}], ")"}], 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"z", "..."}], "y"}]}]}], "]"}], " ", "*)"}], "\n", 
      RowBox[{"ChainPow", " ", "/:", " ", 
       RowBox[{"Times", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"ChainPow", "[", 
           RowBox[{"$angle", ",", "y_", ",", 
            RowBox[{"{", "k___", "}"}], ",", "x_", ",", "type1_"}], "]"}], 
          "[", 
          RowBox[{"n_", "?", "Positive"}], "]"}], ",", 
         RowBox[{
          RowBox[{"ChainPow", "[", 
           RowBox[{"type2_", ",", "z_", ",", 
            RowBox[{"{", "q___", "}"}], ",", "y_", ",", "$square"}], "]"}], 
          "[", 
          RowBox[{"m_", "?", "Positive"}], "]"}]}], "]"}], ":=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"n", ">=", "m"}], ",", "\n", 
         RowBox[{
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"type2", ",", "z", ",", 
             RowBox[{"{", 
              RowBox[{"q", ",", "y", ",", "k"}], "}"}], ",", "x", ",", 
             "type1"}], "]"}], "[", "m", "]"}], 
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"$angle", ",", "y", ",", 
             RowBox[{"{", "k", "}"}], ",", "x", ",", "type1"}], "]"}], "[", 
           RowBox[{"n", "-", "m"}], "]"}]}], ",", "\n", 
         RowBox[{
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"type2", ",", "z", ",", 
             RowBox[{"{", 
              RowBox[{"q", ",", "y", ",", "k"}], "}"}], ",", "x", ",", 
             "type1"}], "]"}], "[", "n", "]"}], 
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"type2", ",", "z", ",", 
             RowBox[{"{", "q", "}"}], ",", "y", ",", "$square"}], "]"}], "[", 
           RowBox[{"m", "-", "n"}], "]"}]}]}], "\n", "]"}]}], ";", "\n", "\n", 
      RowBox[{"ChainPow", " ", "/:", " ", 
       RowBox[{"Times", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"ChainPow", "[", 
           RowBox[{"$angle", ",", "y_", ",", 
            RowBox[{"{", "k___", "}"}], ",", "x_", ",", "type1_"}], "]"}], 
          "[", 
          RowBox[{"n_", "?", "Negative"}], "]"}], ",", 
         RowBox[{
          RowBox[{"ChainPow", "[", 
           RowBox[{"type2_", ",", "z_", ",", 
            RowBox[{"{", "q___", "}"}], ",", "y_", ",", "$square"}], "]"}], 
          "[", 
          RowBox[{"m_", "?", "Negative"}], "]"}]}], "]"}], ":=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"n", "<=", "m"}], ",", "\n", 
         RowBox[{
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"type2", ",", "z", ",", 
             RowBox[{"{", 
              RowBox[{"q", ",", "y", ",", "k"}], "}"}], ",", "x", ",", 
             "type1"}], "]"}], "[", "m", "]"}], 
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"$angle", ",", "y", ",", 
             RowBox[{"{", "k", "}"}], ",", "x", ",", "type1"}], "]"}], "[", 
           RowBox[{"n", "-", "m"}], "]"}]}], ",", "\n", 
         RowBox[{
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"type2", ",", "z", ",", 
             RowBox[{"{", 
              RowBox[{"q", ",", "y", ",", "k"}], "}"}], ",", "x", ",", 
             "type1"}], "]"}], "[", "n", "]"}], 
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"type2", ",", "z", ",", 
             RowBox[{"{", "q", "}"}], ",", "y", ",", "$square"}], "]"}], "[", 
           RowBox[{"m", "-", "n"}], "]"}]}]}], "\n", "]"}]}], ";", "\n", "\n", 
      RowBox[{"(*", 
       RowBox[{
       "Applying", " ", "the", " ", "properties", " ", "to", " ", "the", " ", 
        "expression"}], "*)"}], "\n", 
      RowBox[{"(*", 
       RowBox[{
       "Convert", " ", "angle", " ", "and", " ", "square", " ", "brackets", 
        " ", "to", " ", "Chains"}], "*)"}], "\n", 
      RowBox[{"locexp", "=", 
       RowBox[{"exp", "//.", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"SpinorAngleBracket", "[", 
            RowBox[{"x_", ",", "y_"}], "]"}], ":>", 
           RowBox[{"Chain", "[", 
            RowBox[{"$angle", ",", "x", ",", 
             RowBox[{"{", "}"}], ",", "y", ",", "$angle"}], "]"}]}], ",", 
          RowBox[{
           RowBox[{"SpinorSquareBracket", "[", 
            RowBox[{"x_", ",", "y_"}], "]"}], ":>", 
           RowBox[{"Chain", "[", 
            RowBox[{"$square", ",", "x", ",", 
             RowBox[{"{", "}"}], ",", "y", ",", "$square"}], "]"}]}], ",", 
          RowBox[{
           RowBox[{"Chain", "[", "x__", "]"}], ":>", 
           RowBox[{
            RowBox[{"ChainPow", "[", "x", "]"}], "[", "1", "]"}]}], ",", 
          RowBox[{
           RowBox[{"Power", "[", 
            RowBox[{
             RowBox[{"Chain", "[", "x__", "]"}], ",", "n_"}], "]"}], ":>", 
           RowBox[{
            RowBox[{"ChainPow", "[", "x", "]"}], "[", "n", "]"}]}]}], 
         "}"}]}]}], ";", "\n", "\n", 
      RowBox[{"(*", 
       RowBox[{
       "Expand", " ", "part", " ", "of", " ", "the", " ", "expression", " ", 
        "containing", " ", "ChainPow", " ", "in", " ", "order", " ", "for", 
        " ", "the", " ", "contractions", " ", "to", " ", "happen"}], "*)"}], 
      "\n", 
      RowBox[{"locexp", "=", 
       RowBox[{"Expand", "[", 
        RowBox[{"locexp", ",", "ChainPow"}], "]"}]}], ";", "\n", "\n", 
      RowBox[{"(*", 
       RowBox[{
       "Convert", " ", "back", " ", "to", " ", "angle", " ", "and", " ", 
        "square", " ", "brackets"}], "*)"}], "\n", 
      RowBox[{"locexp", "=", 
       RowBox[{"locexp", "//.", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"Chain", "[", 
            RowBox[{"$angle", ",", "x_", ",", 
             RowBox[{"{", "}"}], ",", "y_", ",", "$angle"}], "]"}], ":>", 
           RowBox[{"SpinorAngleBracket", "[", 
            RowBox[{"x", ",", "y"}], "]"}]}], ",", 
          RowBox[{
           RowBox[{"Chain", "[", 
            RowBox[{"$square", ",", "x_", ",", 
             RowBox[{"{", "}"}], ",", "y_", ",", "$square"}], "]"}], ":>", 
           RowBox[{"SpinorSquareBracket", "[", 
            RowBox[{"x", ",", "y"}], "]"}]}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"ChainPow", "[", "x__", "]"}], "[", "n_", "]"}], ":>", 
           RowBox[{"Power", "[", 
            RowBox[{
             RowBox[{"Chain", "[", "x", "]"}], ",", "n"}], "]"}]}]}], 
         "}"}]}]}], ";", "\n", "\n", 
      RowBox[{"(*", 
       RowBox[{
       "Reduce", " ", "the", " ", "chains", " ", "to", " ", "minimal", " ", 
        "form", " ", "if", " ", "required"}], "*)"}], "\n", "\n", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"TrueQ", "[", 
         RowBox[{"OptionValue", "[", "MinimalChains", "]"}], "]"}], ",", "\n", 
        RowBox[{
         RowBox[{"locexp", "=", 
          RowBox[{"locexp", "//.", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"Chain", "[", 
                RowBox[{"$angle", ",", "x_", ",", 
                 RowBox[{"{", 
                  RowBox[{"y__", ",", "x_", ",", "z__"}], "}"}], ",", "k_", 
                 ",", "type2_"}], "]"}], "/;", 
               RowBox[{"OddQ", "[", 
                RowBox[{"Length", "[", 
                 RowBox[{"{", "y", "}"}], "]"}], "]"}]}], ":>", 
              RowBox[{
               RowBox[{"Chain", "[", 
                RowBox[{"$angle", ",", "x", ",", 
                 RowBox[{"{", "y", "}"}], ",", "x", ",", "$square"}], "]"}], 
               "*", 
               RowBox[{"Chain", "[", 
                RowBox[{"$angle", ",", "x", ",", 
                 RowBox[{"{", "z", "}"}], ",", "k", ",", "type2"}], "]"}]}]}],
              ",", "\n", 
             RowBox[{
              RowBox[{
               RowBox[{"Chain", "[", 
                RowBox[{"$square", ",", "x_", ",", 
                 RowBox[{"{", 
                  RowBox[{"y__", ",", "x_", ",", "z__"}], "}"}], ",", "k_", 
                 ",", "type2_"}], "]"}], "/;", 
               RowBox[{"OddQ", "[", 
                RowBox[{"Length", "[", 
                 RowBox[{"{", "y", "}"}], "]"}], "]"}]}], ":>", 
              RowBox[{
               RowBox[{"Chain", "[", 
                RowBox[{"$square", ",", "x", ",", 
                 RowBox[{"{", "y", "}"}], ",", "x", ",", "$angle"}], "]"}], 
               "*", 
               RowBox[{"Chain", "[", 
                RowBox[{"$square", ",", "x", ",", 
                 RowBox[{"{", "z", "}"}], ",", "k", ",", "type2"}], "]"}]}]}],
              ",", "\n", 
             RowBox[{
              RowBox[{
               RowBox[{"Chain", "[", 
                RowBox[{"type1_", ",", "k_", ",", 
                 RowBox[{"{", 
                  RowBox[{"y__", ",", "x_", ",", "z__"}], "}"}], ",", "x_", 
                 ",", "$angle"}], "]"}], "/;", 
               RowBox[{"OddQ", "[", 
                RowBox[{"Length", "[", 
                 RowBox[{"{", "z", "}"}], "]"}], "]"}]}], ":>", 
              RowBox[{
               RowBox[{"Chain", "[", 
                RowBox[{"type1", ",", "k", ",", 
                 RowBox[{"{", "y", "}"}], ",", "x", ",", "$angle"}], "]"}], 
               "*", 
               RowBox[{"Chain", "[", 
                RowBox[{"$square", ",", "x", ",", 
                 RowBox[{"{", "z", "}"}], ",", "x", ",", "$angle"}], 
                "]"}]}]}], ",", "\n", 
             RowBox[{
              RowBox[{
               RowBox[{"Chain", "[", 
                RowBox[{"type1_", ",", "k_", ",", 
                 RowBox[{"{", 
                  RowBox[{"y__", ",", "x_", ",", "z__"}], "}"}], ",", "x_", 
                 ",", "$square"}], "]"}], "/;", 
               RowBox[{"OddQ", "[", 
                RowBox[{"Length", "[", 
                 RowBox[{"{", "z", "}"}], "]"}], "]"}]}], ":>", 
              RowBox[{
               RowBox[{"Chain", "[", 
                RowBox[{"type1", ",", "k", ",", 
                 RowBox[{"{", "y", "}"}], ",", "x", ",", "$square"}], "]"}], 
               "*", 
               RowBox[{"Chain", "[", 
                RowBox[{"$angle", ",", "x", ",", 
                 RowBox[{"{", "z", "}"}], ",", "x", ",", "$square"}], 
                "]"}]}]}]}], "}"}]}]}], ";"}]}], "\n", "]"}], ";", "\n", "\n", 
      RowBox[{"Return", "[", "locexp", "]"}], ";"}]}], "\n", "]"}]}], 
  ";"}]}], "Code",
 CellChangeTimes->{{3.8249918786158314`*^9, 3.8249918826049857`*^9}},
 CellLabel->
  "In[124]:=",ExpressionUUID->"b5811434-59f5-462a-8a1d-040f2559a2ef"]
}, Closed]],

Cell[CellGroupData[{

Cell["\<\
ToChain with some improvements, old version, slightly faster than the new one\
\>", "Subsection",
 CellChangeTimes->{{3.824990984252784*^9, 3.8249909896642876`*^9}, {
  3.826092583998701*^9, 
  3.8260925979085064`*^9}},ExpressionUUID->"02045f03-8150-4912-bbef-\
fdc457ed31ae"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
   "This", " ", "algorithm", " ", "produces", " ", "chains", " ", "of", " ", 
    "random", " ", 
    RowBox[{"structure", ".", " ", "It"}], " ", "is", " ", "slightly", " ", 
    "faster", " ", "than", " ", "the", " ", "new", " ", "version"}], ",", " ", 
   RowBox[{
   "but", " ", "the", " ", "latter", " ", "provides", " ", "full", " ", 
    "control", " ", "over", " ", "the", " ", "generated", " ", "chains"}]}], 
  "*)"}]], "Input",
 CellChangeTimes->{{3.8260926013351526`*^9, 
  3.82609264468902*^9}},ExpressionUUID->"903ecb15-a75d-494c-95e1-\
8e9621543c61"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "Use", " ", "a", " ", "double", " ", "Block", " ", "structure", " ", "to", 
   " ", "bypass", " ", "replacements"}], "*)"}]], "Input",
 CellChangeTimes->{{3.8249913659006023`*^9, 
  3.824991384195984*^9}},ExpressionUUID->"42d86ccd-58b6-466e-88b8-\
00a66467eddf"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "ToChain2", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"MinimalChains", "->", "True"}], "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ToChain2", "[", 
    RowBox[{"exp_", ",", 
     RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "locexp", "}"}], ",", "\n", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "ChainPow", ",", "SpinorAngleBracket", ",", "SpinorSquareBracket", 
          ",", "Chain"}], "}"}], ",", "\[IndentingNewLine]", "\n", 
        RowBox[{"(*", 
         RowBox[{"ChainPow", " ", 
          RowBox[{"properties", ":"}]}], "*)"}], "\n", "\n", 
        RowBox[{"(*", "Basics", "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"ChainPow", "[", "x__", "]"}], "[", "0", "]"}], ":=", 
          "1"}], ";", "\n", "\n", 
         RowBox[{"(*", 
          RowBox[{"SquareAngle", " ", "as", " ", "AngleSquare"}], "*)"}], 
         "\n", 
         RowBox[{
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"$square", ",", "x_", ",", 
             RowBox[{"{", "y__", "}"}], ",", "z_", ",", "$angle"}], "]"}], 
           "[", "n_", "]"}], ":=", 
          RowBox[{
           RowBox[{"ChainPow", "[", 
            RowBox[{"$angle", ",", "z", ",", 
             RowBox[{"Reverse", "[", 
              RowBox[{"{", "y", "}"}], "]"}], ",", "x", ",", "$square"}], 
            "]"}], "[", "n", "]"}]}], ";", "\n", "\n", 
         RowBox[{"(*", 
          RowBox[{
          "The", " ", "actual", " ", "contraction", " ", "properties"}], 
          "*)"}], "\n", "\n", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{
            RowBox[{" ", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"x", "..."}], "y"}]}], "\[RightAngleBracket]"}], "[", 
            RowBox[{
             RowBox[{"y", "..."}], "z"}]}], ")"}], " ", "*)"}], "\n", 
         RowBox[{"ChainPow", " ", "/:", " ", 
          RowBox[{"Times", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"ChainPow", "[", 
              RowBox[{"type1_", ",", "x_", ",", 
               RowBox[{"{", "k___", "}"}], ",", "y_", ",", "$angle"}], "]"}], 
             "[", 
             RowBox[{"n_", "?", "Positive"}], "]"}], ",", 
            RowBox[{
             RowBox[{"ChainPow", "[", 
              RowBox[{"$square", ",", "y_", ",", 
               RowBox[{"{", "q___", "}"}], ",", "z_", ",", "type2_"}], "]"}], 
             "[", 
             RowBox[{"m_", "?", "Positive"}], "]"}]}], "]"}], ":=", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"n", ">=", "m"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"ChainPow", "[", 
               RowBox[{"type1", ",", "x", ",", 
                RowBox[{"{", 
                 RowBox[{"k", ",", "y", ",", "q"}], "}"}], ",", "z", ",", 
                "type2"}], "]"}], "[", "m", "]"}], 
             RowBox[{
              RowBox[{"ChainPow", "[", 
               RowBox[{"type1", ",", "x", ",", 
                RowBox[{"{", "k", "}"}], ",", "y", ",", "$angle"}], "]"}], 
              "[", 
              RowBox[{"n", "-", "m"}], "]"}]}], ",", "\n", 
            RowBox[{
             RowBox[{
              RowBox[{"ChainPow", "[", 
               RowBox[{"type1", ",", "x", ",", 
                RowBox[{"{", 
                 RowBox[{"k", ",", "y", ",", "q"}], "}"}], ",", "z", ",", 
                "type2"}], "]"}], "[", "n", "]"}], 
             RowBox[{
              RowBox[{"ChainPow", "[", 
               RowBox[{"$square", ",", "y", ",", 
                RowBox[{"{", "q", "}"}], ",", "z", ",", "type2"}], "]"}], "[", 
              RowBox[{"m", "-", "n"}], "]"}]}]}], "\n", "]"}]}], ";", "\n", 
         "\n", 
         RowBox[{"ChainPow", " ", "/:", " ", 
          RowBox[{"Times", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"ChainPow", "[", 
              RowBox[{"type1_", ",", "x_", ",", 
               RowBox[{"{", "k___", "}"}], ",", "y_", ",", "$angle"}], "]"}], 
             "[", 
             RowBox[{"n_", "?", "Negative"}], "]"}], ",", 
            RowBox[{
             RowBox[{"ChainPow", "[", 
              RowBox[{"$square", ",", "y_", ",", 
               RowBox[{"{", "q___", "}"}], ",", "z_", ",", "type2_"}], "]"}], 
             "[", 
             RowBox[{"m_", "?", "Negative"}], "]"}]}], "]"}], ":=", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"n", "<=", "m"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"ChainPow", "[", 
               RowBox[{"type1", ",", "x", ",", 
                RowBox[{"{", 
                 RowBox[{"k", ",", "y", ",", "q"}], "}"}], ",", "z", ",", 
                "type2"}], "]"}], "[", "m", "]"}], 
             RowBox[{
              RowBox[{"ChainPow", "[", 
               RowBox[{"type1", ",", "x", ",", 
                RowBox[{"{", "k", "}"}], ",", "y", ",", "$angle"}], "]"}], 
              "[", 
              RowBox[{"n", "-", "m"}], "]"}]}], ",", "\n", 
            RowBox[{
             RowBox[{
              RowBox[{"ChainPow", "[", 
               RowBox[{"type1", ",", "x", ",", 
                RowBox[{"{", 
                 RowBox[{"k", ",", "y", ",", "q"}], "}"}], ",", "z", ",", 
                "type2"}], "]"}], "[", "n", "]"}], 
             RowBox[{
              RowBox[{"ChainPow", "[", 
               RowBox[{"$square", ",", "y", ",", 
                RowBox[{"{", "q", "}"}], ",", "z", ",", "type2"}], "]"}], "[", 
              RowBox[{"m", "-", "n"}], "]"}]}]}], "\n", "]"}]}], ";", "\n", 
         "\n", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"\[LeftAngleBracket]", 
              RowBox[{
               RowBox[{"y", "..."}], "x"}]}], ")"}], "[", 
            RowBox[{
             RowBox[{"y", "..."}], "z"}]}], ")"}], " ", "*)"}], "\n", 
         RowBox[{"ChainPow", " ", "/:", " ", 
          RowBox[{"Times", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"ChainPow", "[", 
              RowBox[{"$angle", ",", "y_", ",", 
               RowBox[{"{", "k___", "}"}], ",", "x_", ",", "type1_"}], "]"}], 
             "[", 
             RowBox[{"n_", "?", "Positive"}], "]"}], ",", 
            RowBox[{
             RowBox[{"ChainPow", "[", 
              RowBox[{"$square", ",", "y_", ",", 
               RowBox[{"{", "q___", "}"}], ",", "z_", ",", "type2_"}], "]"}], 
             "[", 
             RowBox[{"m_", "?", "Positive"}], "]"}]}], "]"}], ":=", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"n", ">=", "m"}], ",", "\n", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"-", "1"}], ")"}], "^", 
              RowBox[{"(", 
               RowBox[{"m", "*", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"Length", "[", 
                   RowBox[{"{", "k", "}"}], "]"}], "+", "1"}], ")"}]}], 
               ")"}]}], "*", 
             RowBox[{
              RowBox[{"ChainPow", "[", 
               RowBox[{"type1", ",", "x", ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Sequence", "@@", 
                   RowBox[{"Reverse", "[", 
                    RowBox[{"{", "k", "}"}], "]"}]}], ",", "y", ",", "q"}], 
                 "}"}], ",", "z", ",", "type2"}], "]"}], "[", "m", "]"}], 
             RowBox[{
              RowBox[{"ChainPow", "[", 
               RowBox[{"$angle", ",", "y", ",", 
                RowBox[{"{", "k", "}"}], ",", "x", ",", "type1"}], "]"}], "[", 
              RowBox[{"n", "-", "m"}], "]"}]}], ",", "\n", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"-", "1"}], ")"}], "^", 
              RowBox[{"(", 
               RowBox[{"n", "*", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"Length", "[", 
                   RowBox[{"{", "k", "}"}], "]"}], "+", "1"}], ")"}]}], 
               ")"}]}], "*", 
             RowBox[{
              RowBox[{"ChainPow", "[", 
               RowBox[{"type1", ",", "x", ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Sequence", "@@", 
                   RowBox[{"Reverse", "[", 
                    RowBox[{"{", "k", "}"}], "]"}]}], ",", "y", ",", "q"}], 
                 "}"}], ",", "z", ",", "type2"}], "]"}], "[", "n", "]"}], 
             RowBox[{
              RowBox[{"ChainPow", "[", 
               RowBox[{"$square", ",", "y", ",", 
                RowBox[{"{", "q", "}"}], ",", "z", ",", "type2"}], "]"}], "[", 
              RowBox[{"m", "-", "n"}], "]"}]}]}], "\n", "]"}]}], ";", "\n", 
         "\n", 
         RowBox[{"ChainPow", " ", "/:", " ", 
          RowBox[{"Times", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"ChainPow", "[", 
              RowBox[{"$angle", ",", "y_", ",", 
               RowBox[{"{", "k___", "}"}], ",", "x_", ",", "type1_"}], "]"}], 
             "[", 
             RowBox[{"n_", "?", "Negative"}], "]"}], ",", 
            RowBox[{
             RowBox[{"ChainPow", "[", 
              RowBox[{"$square", ",", "y_", ",", 
               RowBox[{"{", "q___", "}"}], ",", "z_", ",", "type2_"}], "]"}], 
             "[", 
             RowBox[{"m_", "?", "Negative"}], "]"}]}], "]"}], ":=", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"n", "<=", "m"}], ",", "\n", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"-", "1"}], ")"}], "^", 
              RowBox[{"(", 
               RowBox[{"m", "*", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"Length", "[", 
                   RowBox[{"{", "k", "}"}], "]"}], "+", "1"}], ")"}]}], 
               ")"}]}], "*", 
             RowBox[{
              RowBox[{"ChainPow", "[", 
               RowBox[{"type1", ",", "x", ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Sequence", "@@", 
                   RowBox[{"Reverse", "[", 
                    RowBox[{"{", "k", "}"}], "]"}]}], ",", "y", ",", "q"}], 
                 "}"}], ",", "z", ",", "type2"}], "]"}], "[", "m", "]"}], 
             RowBox[{
              RowBox[{"ChainPow", "[", 
               RowBox[{"$angle", ",", "y", ",", 
                RowBox[{"{", "k", "}"}], ",", "x", ",", "type1"}], "]"}], "[", 
              RowBox[{"n", "-", "m"}], "]"}]}], ",", "\n", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"-", "1"}], ")"}], "^", 
              RowBox[{"(", 
               RowBox[{"n", "*", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"Length", "[", 
                   RowBox[{"{", "k", "}"}], "]"}], "+", "1"}], ")"}]}], 
               ")"}]}], "*", 
             RowBox[{
              RowBox[{"ChainPow", "[", 
               RowBox[{"type1", ",", "x", ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Sequence", "@@", 
                   RowBox[{"Reverse", "[", 
                    RowBox[{"{", "k", "}"}], "]"}]}], ",", "y", ",", "q"}], 
                 "}"}], ",", "z", ",", "type2"}], "]"}], "[", "n", "]"}], 
             RowBox[{
              RowBox[{"ChainPow", "[", 
               RowBox[{"$square", ",", "y", ",", 
                RowBox[{"{", "q", "}"}], ",", "z", ",", "type2"}], "]"}], "[", 
              RowBox[{"m", "-", "n"}], "]"}]}]}], "\n", "]"}]}], ";", "\n", 
         "\n", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"x", "..."}], "y"}]}], "\[RightAngleBracket]"}], "[", 
            RowBox[{
             RowBox[{"y", "..."}], "z"}]}], ")"}], "*)"}], "\n", 
         RowBox[{"ChainPow", " ", "/:", " ", 
          RowBox[{"Times", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"ChainPow", "[", 
              RowBox[{"type1_", ",", "x_", ",", 
               RowBox[{"{", "k___", "}"}], ",", "y_", ",", "$angle"}], "]"}], 
             "[", 
             RowBox[{"n_", "?", "Positive"}], "]"}], ",", 
            RowBox[{
             RowBox[{"ChainPow", "[", 
              RowBox[{"type2_", ",", "z_", ",", 
               RowBox[{"{", "q___", "}"}], ",", "y_", ",", "$square"}], "]"}],
              "[", 
             RowBox[{"m_", "?", "Positive"}], "]"}]}], "]"}], ":=", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"n", ">=", "m"}], ",", "\n", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"-", "1"}], ")"}], "^", 
              RowBox[{"(", 
               RowBox[{"m", "*", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"Length", "[", 
                   RowBox[{"{", "q", "}"}], "]"}], "+", "1"}], ")"}]}], 
               ")"}]}], "*", 
             RowBox[{
              RowBox[{"ChainPow", "[", 
               RowBox[{"type1", ",", "x", ",", 
                RowBox[{"{", 
                 RowBox[{"k", ",", "y", ",", 
                  RowBox[{"Sequence", "@@", 
                   RowBox[{"Reverse", "[", 
                    RowBox[{"{", "q", "}"}], "]"}]}]}], "}"}], ",", "z", ",", 
                "type2"}], "]"}], "[", "m", "]"}], 
             RowBox[{
              RowBox[{"ChainPow", "[", 
               RowBox[{"type1", ",", "x", ",", 
                RowBox[{"{", "k", "}"}], ",", "y", ",", "$angle"}], "]"}], 
              "[", 
              RowBox[{"n", "-", "m"}], "]"}]}], ",", "\n", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"-", "1"}], ")"}], "^", 
              RowBox[{"(", 
               RowBox[{"n", "*", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"Length", "[", 
                   RowBox[{"{", "q", "}"}], "]"}], "+", "1"}], ")"}]}], 
               ")"}]}], "*", 
             RowBox[{
              RowBox[{"ChainPow", "[", 
               RowBox[{"type1", ",", "x", ",", 
                RowBox[{"{", 
                 RowBox[{"k", ",", "y", ",", 
                  RowBox[{"Sequence", "@@", 
                   RowBox[{"Reverse", "[", 
                    RowBox[{"{", "q", "}"}], "]"}]}]}], "}"}], ",", "z", ",", 
                "type2"}], "]"}], "[", "n", "]"}], 
             RowBox[{
              RowBox[{"ChainPow", "[", 
               RowBox[{"type2", ",", "z", ",", 
                RowBox[{"{", "q", "}"}], ",", "y", ",", "$square"}], "]"}], 
              "[", 
              RowBox[{"m", "-", "n"}], "]"}]}]}], "\n", "]"}]}], ";", "\n", 
         "\n", 
         RowBox[{"ChainPow", " ", "/:", " ", 
          RowBox[{"Times", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"ChainPow", "[", 
              RowBox[{"type1_", ",", "x_", ",", 
               RowBox[{"{", "k___", "}"}], ",", "y_", ",", "$angle"}], "]"}], 
             "[", 
             RowBox[{"n_", "?", "Negative"}], "]"}], ",", 
            RowBox[{
             RowBox[{"ChainPow", "[", 
              RowBox[{"type2_", ",", "z_", ",", 
               RowBox[{"{", "q___", "}"}], ",", "y_", ",", "$square"}], "]"}],
              "[", 
             RowBox[{"m_", "?", "Negative"}], "]"}]}], "]"}], ":=", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"n", "<=", "m"}], ",", "\n", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"-", "1"}], ")"}], "^", 
              RowBox[{"(", 
               RowBox[{"m", "*", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"Length", "[", 
                   RowBox[{"{", "q", "}"}], "]"}], "+", "1"}], ")"}]}], 
               ")"}]}], "*", 
             RowBox[{
              RowBox[{"ChainPow", "[", 
               RowBox[{"type1", ",", "x", ",", 
                RowBox[{"{", 
                 RowBox[{"k", ",", "y", ",", 
                  RowBox[{"Sequence", "@@", 
                   RowBox[{"Reverse", "[", 
                    RowBox[{"{", "q", "}"}], "]"}]}]}], "}"}], ",", "z", ",", 
                "type2"}], "]"}], "[", "m", "]"}], 
             RowBox[{
              RowBox[{"ChainPow", "[", 
               RowBox[{"type1", ",", "x", ",", 
                RowBox[{"{", "k", "}"}], ",", "y", ",", "$angle"}], "]"}], 
              "[", 
              RowBox[{"n", "-", "m"}], "]"}]}], ",", "\n", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"-", "1"}], ")"}], "^", 
              RowBox[{"(", 
               RowBox[{"n", "*", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"Length", "[", 
                   RowBox[{"{", "q", "}"}], "]"}], "+", "1"}], ")"}]}], 
               ")"}]}], "*", 
             RowBox[{
              RowBox[{"ChainPow", "[", 
               RowBox[{"type1", ",", "x", ",", 
                RowBox[{"{", 
                 RowBox[{"k", ",", "y", ",", 
                  RowBox[{"Sequence", "@@", 
                   RowBox[{"Reverse", "[", 
                    RowBox[{"{", "q", "}"}], "]"}]}]}], "}"}], ",", "z", ",", 
                "type2"}], "]"}], "[", "n", "]"}], 
             RowBox[{
              RowBox[{"ChainPow", "[", 
               RowBox[{"type2", ",", "z", ",", 
                RowBox[{"{", "q", "}"}], ",", "y", ",", "$square"}], "]"}], 
              "[", 
              RowBox[{"m", "-", "n"}], "]"}]}]}], "\n", "]"}]}], ";", "\n", 
         "\n", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{
            RowBox[{" ", 
             RowBox[{"\[LeftAngleBracket]", 
              RowBox[{
               RowBox[{"y", "..."}], "x"}]}], ")"}], 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"z", "..."}], "y"}]}]}], "]"}], " ", "*)"}], "\n", 
         RowBox[{"ChainPow", " ", "/:", " ", 
          RowBox[{"Times", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"ChainPow", "[", 
              RowBox[{"$angle", ",", "y_", ",", 
               RowBox[{"{", "k___", "}"}], ",", "x_", ",", "type1_"}], "]"}], 
             "[", 
             RowBox[{"n_", "?", "Positive"}], "]"}], ",", 
            RowBox[{
             RowBox[{"ChainPow", "[", 
              RowBox[{"type2_", ",", "z_", ",", 
               RowBox[{"{", "q___", "}"}], ",", "y_", ",", "$square"}], "]"}],
              "[", 
             RowBox[{"m_", "?", "Positive"}], "]"}]}], "]"}], ":=", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"n", ">=", "m"}], ",", "\n", 
            RowBox[{
             RowBox[{
              RowBox[{"ChainPow", "[", 
               RowBox[{"type2", ",", "z", ",", 
                RowBox[{"{", 
                 RowBox[{"q", ",", "y", ",", "k"}], "}"}], ",", "x", ",", 
                "type1"}], "]"}], "[", "m", "]"}], 
             RowBox[{
              RowBox[{"ChainPow", "[", 
               RowBox[{"$angle", ",", "y", ",", 
                RowBox[{"{", "k", "}"}], ",", "x", ",", "type1"}], "]"}], "[", 
              RowBox[{"n", "-", "m"}], "]"}]}], ",", "\n", 
            RowBox[{
             RowBox[{
              RowBox[{"ChainPow", "[", 
               RowBox[{"type2", ",", "z", ",", 
                RowBox[{"{", 
                 RowBox[{"q", ",", "y", ",", "k"}], "}"}], ",", "x", ",", 
                "type1"}], "]"}], "[", "n", "]"}], 
             RowBox[{
              RowBox[{"ChainPow", "[", 
               RowBox[{"type2", ",", "z", ",", 
                RowBox[{"{", "q", "}"}], ",", "y", ",", "$square"}], "]"}], 
              "[", 
              RowBox[{"m", "-", "n"}], "]"}]}]}], "\n", "]"}]}], ";", "\n", 
         "\n", 
         RowBox[{"ChainPow", " ", "/:", " ", 
          RowBox[{"Times", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"ChainPow", "[", 
              RowBox[{"$angle", ",", "y_", ",", 
               RowBox[{"{", "k___", "}"}], ",", "x_", ",", "type1_"}], "]"}], 
             "[", 
             RowBox[{"n_", "?", "Negative"}], "]"}], ",", 
            RowBox[{
             RowBox[{"ChainPow", "[", 
              RowBox[{"type2_", ",", "z_", ",", 
               RowBox[{"{", "q___", "}"}], ",", "y_", ",", "$square"}], "]"}],
              "[", 
             RowBox[{"m_", "?", "Negative"}], "]"}]}], "]"}], ":=", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"n", "<=", "m"}], ",", "\n", 
            RowBox[{
             RowBox[{
              RowBox[{"ChainPow", "[", 
               RowBox[{"type2", ",", "z", ",", 
                RowBox[{"{", 
                 RowBox[{"q", ",", "y", ",", "k"}], "}"}], ",", "x", ",", 
                "type1"}], "]"}], "[", "m", "]"}], 
             RowBox[{
              RowBox[{"ChainPow", "[", 
               RowBox[{"$angle", ",", "y", ",", 
                RowBox[{"{", "k", "}"}], ",", "x", ",", "type1"}], "]"}], "[", 
              RowBox[{"n", "-", "m"}], "]"}]}], ",", "\n", 
            RowBox[{
             RowBox[{
              RowBox[{"ChainPow", "[", 
               RowBox[{"type2", ",", "z", ",", 
                RowBox[{"{", 
                 RowBox[{"q", ",", "y", ",", "k"}], "}"}], ",", "x", ",", 
                "type1"}], "]"}], "[", "n", "]"}], 
             RowBox[{
              RowBox[{"ChainPow", "[", 
               RowBox[{"type2", ",", "z", ",", 
                RowBox[{"{", "q", "}"}], ",", "y", ",", "$square"}], "]"}], 
              "[", 
              RowBox[{"m", "-", "n"}], "]"}]}]}], "\n", "]"}]}], ";", "\n", 
         "\n", 
         RowBox[{"(*", 
          RowBox[{
          "Applying", " ", "the", " ", "properties", " ", "to", " ", "the", 
           " ", "expression"}], "*)"}], "\n", 
         RowBox[{"(*", 
          RowBox[{
          "Convert", " ", "angle", " ", "and", " ", "square", " ", "brackets",
            " ", "to", " ", "Chains", " ", "and", " ", "Chains", " ", "to", 
           " ", "ChainPow"}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{
            RowBox[{"SpinorAngleBracket", "[", 
             RowBox[{"x_", ",", "y_"}], "]"}], ":=", 
            RowBox[{"Chain", "[", 
             RowBox[{"$angle", ",", "x", ",", 
              RowBox[{"{", "}"}], ",", "y", ",", "$angle"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"SpinorSquareBracket", "[", 
             RowBox[{"x_", ",", "y_"}], "]"}], ":=", 
            RowBox[{"Chain", "[", 
             RowBox[{"$square", ",", "x", ",", 
              RowBox[{"{", "}"}], ",", "y", ",", "$square"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"Chain", " ", "/:", " ", 
            RowBox[{"Power", "[", 
             RowBox[{
              RowBox[{"Chain", "[", "x__", "]"}], ",", "n_"}], "]"}], ":=", 
            RowBox[{
             RowBox[{"ChainPow", "[", "x", "]"}], "[", "n", "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Chain", "[", "x__", "]"}], ":=", 
            RowBox[{
             RowBox[{"ChainPow", "[", "x", "]"}], "[", "1", "]"}]}], ";"}], 
          "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"SpinorAngleBracket", "[", 
           RowBox[{"x_", ",", "y_"}], "]"}], ":=", 
          RowBox[{"Chain", "[", 
           RowBox[{"$angle", ",", "x", ",", 
            RowBox[{"{", "}"}], ",", "y", ",", "$angle"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"SpinorSquareBracket", "[", 
           RowBox[{"x_", ",", "y_"}], "]"}], ":=", 
          RowBox[{"Chain", "[", 
           RowBox[{"$square", ",", "x", ",", 
            RowBox[{"{", "}"}], ",", "y", ",", "$square"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"ChainPow", " ", "/:", " ", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"ChainPow", "[", "x__", "]"}], "[", "p_", "]"}], ",", 
            "n_"}], "]"}], ":=", 
          RowBox[{
           RowBox[{"ChainPow", "[", "x", "]"}], "[", 
           RowBox[{"p", "*", "n"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Chain", "[", "x__", "]"}], ":=", 
          RowBox[{
           RowBox[{"ChainPow", "[", "x", "]"}], "[", "1", "]"}]}], ";", 
         "\[IndentingNewLine]", "\n", 
         RowBox[{"locexp", "=", "exp"}], ";", "\n", "\n", 
         RowBox[{"(*", 
          RowBox[{
          "Expand", " ", "part", " ", "of", " ", "the", " ", "expression", 
           " ", "containing", " ", "ChainPow", " ", "in", " ", "order", " ", 
           "for", " ", "the", " ", "contractions", " ", "to", " ", "happen"}],
           "*)"}], "\n", 
         RowBox[{"locexp", "=", 
          RowBox[{"Expand", "[", 
           RowBox[{"locexp", ",", "ChainPow"}], "]"}]}], ";"}]}], "\n", "]"}],
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"ChainPow", ",", "Chain"}], "}"}], ",", 
        "\[IndentingNewLine]", "\n", 
        RowBox[{"(*", 
         RowBox[{
         "Convert", " ", "back", " ", "to", " ", "angle", " ", "and", " ", 
          "square", " ", "brackets"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"Chain", "[", 
           RowBox[{"$angle", ",", "x_", ",", 
            RowBox[{"{", "}"}], ",", "y_", ",", "$angle"}], "]"}], ":=", 
          RowBox[{"SpinorAngleBracket", "[", 
           RowBox[{"x", ",", "y"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Chain", "[", 
           RowBox[{"$square", ",", "x_", ",", 
            RowBox[{"{", "}"}], ",", "y_", ",", "$square"}], "]"}], ":=", 
          RowBox[{"SpinorSquareBracket", "[", 
           RowBox[{"x", ",", "y"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"ChainPow", "[", "x__", "]"}], "[", "n_", "]"}], ":=", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Chain", "[", "x", "]"}], ",", "n"}], "]"}]}], ";", "\n", 
         RowBox[{"locexp", "=", "locexp"}], ";"}]}], "\n", "]"}], ";", "\n", 
      "\n", 
      RowBox[{"(*", 
       RowBox[{
       "Reduce", " ", "the", " ", "chains", " ", "to", " ", "minimal", " ", 
        "form", " ", "if", " ", "required"}], "*)"}], "\n", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"TrueQ", "[", 
         RowBox[{"OptionValue", "[", "MinimalChains", "]"}], "]"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Block", "[", 
          RowBox[{
           RowBox[{"{", "Chain", "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
            "Splitting", " ", "chains", " ", "into", " ", "smaller", " ", 
             "chains"}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Chain", "[", 
               RowBox[{"$angle", ",", "x_", ",", 
                RowBox[{"{", 
                 RowBox[{"y___", ",", "x_", ",", "z___"}], "}"}], ",", "k_", 
                ",", "type2_"}], "]"}], "/;", 
              RowBox[{"OddQ", "[", 
               RowBox[{"Length", "[", 
                RowBox[{"{", "y", "}"}], "]"}], "]"}]}], ":=", 
             RowBox[{
              RowBox[{"Chain", "[", 
               RowBox[{"$angle", ",", "x", ",", 
                RowBox[{"{", "y", "}"}], ",", "x", ",", "$square"}], "]"}], 
              "*", 
              RowBox[{"Chain", "[", 
               RowBox[{"$angle", ",", "x", ",", 
                RowBox[{"{", "z", "}"}], ",", "k", ",", "type2"}], "]"}]}]}], 
            ";", "\n", "\t", 
            RowBox[{
             RowBox[{
              RowBox[{"Chain", "[", 
               RowBox[{"$square", ",", "x_", ",", 
                RowBox[{"{", 
                 RowBox[{"y___", ",", "x_", ",", "z___"}], "}"}], ",", "k_", 
                ",", "type2_"}], "]"}], "/;", 
              RowBox[{"OddQ", "[", 
               RowBox[{"Length", "[", 
                RowBox[{"{", "y", "}"}], "]"}], "]"}]}], ":=", 
             RowBox[{
              RowBox[{"Chain", "[", 
               RowBox[{"$square", ",", "x", ",", 
                RowBox[{"{", "y", "}"}], ",", "x", ",", "$angle"}], "]"}], 
              "*", 
              RowBox[{"Chain", "[", 
               RowBox[{"$square", ",", "x", ",", 
                RowBox[{"{", "z", "}"}], ",", "k", ",", "type2"}], "]"}]}]}], 
            ";", "\n", "\t", 
            RowBox[{
             RowBox[{
              RowBox[{"Chain", "[", 
               RowBox[{"type1_", ",", "k_", ",", 
                RowBox[{"{", 
                 RowBox[{"y___", ",", "x_", ",", "z___"}], "}"}], ",", "x_", 
                ",", "$angle"}], "]"}], "/;", 
              RowBox[{"OddQ", "[", 
               RowBox[{"Length", "[", 
                RowBox[{"{", "z", "}"}], "]"}], "]"}]}], ":=", 
             RowBox[{
              RowBox[{"Chain", "[", 
               RowBox[{"type1", ",", "k", ",", 
                RowBox[{"{", "y", "}"}], ",", "x", ",", "$angle"}], "]"}], 
              "*", 
              RowBox[{"Chain", "[", 
               RowBox[{"$square", ",", "x", ",", 
                RowBox[{"{", "z", "}"}], ",", "x", ",", "$angle"}], "]"}]}]}],
             ";", "\n", "\t", 
            RowBox[{
             RowBox[{
              RowBox[{"Chain", "[", 
               RowBox[{"type1_", ",", "k_", ",", 
                RowBox[{"{", 
                 RowBox[{"y___", ",", "x_", ",", "z___"}], "}"}], ",", "x_", 
                ",", "$square"}], "]"}], "/;", 
              RowBox[{"OddQ", "[", 
               RowBox[{"Length", "[", 
                RowBox[{"{", "z", "}"}], "]"}], "]"}]}], ":=", 
             RowBox[{
              RowBox[{"Chain", "[", 
               RowBox[{"type1", ",", "k", ",", 
                RowBox[{"{", "y", "}"}], ",", "x", ",", "$square"}], "]"}], 
              "*", 
              RowBox[{"Chain", "[", 
               RowBox[{"$angle", ",", "x", ",", 
                RowBox[{"{", "z", "}"}], ",", "x", ",", "$square"}], 
               "]"}]}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{
             "Converting", " ", "emty", " ", "chains", " ", "into", " ", 
              "brackets"}], "*)"}], "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Chain", "[", 
              RowBox[{"$angle", ",", "x_", ",", 
               RowBox[{"{", "}"}], ",", "y_", ",", "$angle"}], "]"}], ":=", 
             RowBox[{"SpinorAngleBracket", "[", 
              RowBox[{"x", ",", "y"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Chain", "[", 
              RowBox[{"$square", ",", "x_", ",", 
               RowBox[{"{", "}"}], ",", "y_", ",", "$square"}], "]"}], ":=", 
             RowBox[{"SpinorAngleBracket", "[", 
              RowBox[{"x", ",", "y"}], "]"}]}], ";", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{"locexp", "=", "locexp"}], ";"}]}], "\[IndentingNewLine]",
           "]"}], ";"}]}], "\[IndentingNewLine]", "\n", "]"}], ";", "\n", 
      "\n", 
      RowBox[{"Return", "[", "locexp", "]"}], ";"}]}], "\n", "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.824990851385706*^9, 3.8249908582377815`*^9}, {
  3.8249914099018936`*^9, 3.824991479300292*^9}, {3.8249915129215727`*^9, 
  3.8249915157374744`*^9}, {3.8249915959154987`*^9, 3.824991871369195*^9}, {
  3.8249921063635883`*^9, 3.8249921095141644`*^9}, {3.8260918242947173`*^9, 
  3.8260918275706863`*^9}, {3.826092030693178*^9, 3.8260920843348274`*^9}, {
  3.826093399436197*^9, 3.826093577044801*^9}},
 CellLabel->
  "In[145]:=",ExpressionUUID->"f7de764f-1974-4378-a779-6fbdd1a36778"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"Speed", " ", "comparison"}], "*)"}]], "Input",
 CellChangeTimes->{{3.824991901287288*^9, 
  3.8249919058387566`*^9}},ExpressionUUID->"5be9a473-686a-4fec-a99d-\
725b7f0842dc"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"Do", "[", 
   RowBox[{
    RowBox[{
     RowBox[{
      TemplateBox[{"1", "2"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], 
      TemplateBox[{"4", "3"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], 
      TemplateBox[{"2", "3"},
       "SpinorSquareBracket",
       DisplayFunction->(RowBox[{"[", 
          RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], 
      TemplateBox[{"2", "4"},
       "SpinorSquareBracket",
       DisplayFunction->(RowBox[{"[", 
          RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], 
      TemplateBox[{"4", "1"},
       "SpinorSquareBracket",
       DisplayFunction->(RowBox[{"[", 
          RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )]}], "//", "ToChain0"}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", "10000"}], "}"}]}], "]"}], "//", 
  "AbsoluteTiming"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Do", "[", 
   RowBox[{
    RowBox[{
     RowBox[{
      TemplateBox[{"1", "2"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], 
      TemplateBox[{"4", "3"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], 
      TemplateBox[{"2", "3"},
       "SpinorSquareBracket",
       DisplayFunction->(RowBox[{"[", 
          RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], 
      TemplateBox[{"2", "4"},
       "SpinorSquareBracket",
       DisplayFunction->(RowBox[{"[", 
          RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], 
      TemplateBox[{"4", "1"},
       "SpinorSquareBracket",
       DisplayFunction->(RowBox[{"[", 
          RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )]}], "//", "ToChain2"}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", "10000"}], "}"}]}], "]"}], "//", 
  "AbsoluteTiming"}]}], "Input",
 CellChangeTimes->{{3.8249919423406076`*^9, 3.8249919776127453`*^9}, {
  3.8249921448373785`*^9, 3.8249921817653837`*^9}},
 CellLabel->"In[30]:=",ExpressionUUID->"bff91f32-56c0-4fd9-876b-c4c56ef5d5e9"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"6.7555266`", ",", "Null"}], "}"}]], "Output",
 CellChangeTimes->{{3.8249919601665125`*^9, 3.8249919781385307`*^9}, {
  3.824992114786422*^9, 3.8249921179496565`*^9}, {3.824992161580353*^9, 
  3.8249921889037466`*^9}},
 CellLabel->"Out[30]=",ExpressionUUID->"9c846ba2-6c33-46f4-90b7-c6b8f4513485"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"5.9225275`", ",", "Null"}], "}"}]], "Output",
 CellChangeTimes->{{3.8249919601665125`*^9, 3.8249919781385307`*^9}, {
  3.824992114786422*^9, 3.8249921179496565`*^9}, {3.824992161580353*^9, 
  3.8249921948263464`*^9}},
 CellLabel->"Out[31]=",ExpressionUUID->"e5c4b270-bd4a-42db-8cb5-64c7a0859713"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"Faster", " ", "but", " ", "not", " ", "enormously"}], ",", " ", 
   RowBox[{
   "I", " ", "expect", " ", "this", " ", "discrepancy", " ", "to", " ", 
    "increase", " ", "with", " ", "increasing", " ", "difficulty", " ", "of", 
    " ", "the", " ", "expressions"}]}], "*)"}]], "Input",
 CellChangeTimes->{{3.8249922044585915`*^9, 
  3.824992235773102*^9}},ExpressionUUID->"342ed152-5aca-4f84-b7a9-\
7ef3dafb2ac8"]
}, Closed]],

Cell[CellGroupData[{

Cell["Tests", "Subsection",
 CellChangeTimes->{{3.8249911069294786`*^9, 
  3.8249911074972477`*^9}},ExpressionUUID->"087e8b18-ee52-4e35-b97b-\
505caf757186"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   TemplateBox[{"1", "2"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], 
   TemplateBox[{"4", "3"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], 
   TemplateBox[{"2", "3"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], 
   TemplateBox[{"2", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], 
   TemplateBox[{"4", "1"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}], "//", "ToChain2"}]], "Input",
 CellLabel->"In[32]:=",ExpressionUUID->"00e2790c-fc8b-4ba1-99b0-4f7d3f93ceac"],

Cell[BoxData[
 RowBox[{"-", 
  TemplateBox[{"2", 
    RowBox[{"{", 
      RowBox[{"4", ",", "3", ",", "2", ",", "1"}], "}"}], "4"},
   "SquareSquareChain",
   DisplayFunction->(RowBox[{"[", #, #2, #3, "]"}]& ),
   InterpretationFunction->(
    RowBox[{"Chain", "[", "$square", ",", #, ",", #2, ",", #3, ",", "$square",
       "]"}]& )]}]], "Output",
 CellChangeTimes->{3.824992342221531*^9},
 CellLabel->"Out[32]=",ExpressionUUID->"c21544d1-9ee0-43ab-a95b-4bb1144262c2"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"prova", "=", 
  FractionBox[
   RowBox[{"3", " ", "a", " ", 
    TemplateBox[{"1", "2"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], " ", 
    TemplateBox[{"3", "4"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], " ", 
    TemplateBox[{"5", "6"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], " ", 
    SuperscriptBox[
     TemplateBox[{"9", "10"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], "3"], " ", 
    TemplateBox[{"1", "4"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], " ", 
    TemplateBox[{"2", "3"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], " ", 
    TemplateBox[{"2", "4"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )]}], 
   RowBox[{
    SuperscriptBox[
     TemplateBox[{"6", "7"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], "2"], " ", 
    TemplateBox[{"7", "8"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )]}]]}]], "Input",
 CellLabel->
  "In[148]:=",ExpressionUUID->"40b49974-2be4-4ab2-84c4-7428f32afa09"],

Cell[BoxData[
 FractionBox[
  RowBox[{"3", " ", "a", " ", 
   TemplateBox[{"1", "2"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], " ", 
   TemplateBox[{"3", "4"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], " ", 
   TemplateBox[{"5", "6"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], " ", 
   SuperscriptBox[
    TemplateBox[{"9", "10"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "3"], " ", 
   TemplateBox[{"1", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], " ", 
   TemplateBox[{"2", "3"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], " ", 
   TemplateBox[{"2", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}], 
  RowBox[{
   SuperscriptBox[
    TemplateBox[{"6", "7"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "2"], " ", 
   TemplateBox[{"7", "8"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}]]], "Output",
 CellChangeTimes->{3.826091717288786*^9, 3.826093592203641*^9},
 CellLabel->
  "Out[148]=",ExpressionUUID->"cce3051c-126a-4174-8b75-2c8ebc7403ea"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"prova", "//", "ToChain0"}]], "Input",
 CellChangeTimes->{{3.826091718750729*^9, 3.8260917436135597`*^9}},
 CellLabel->
  "In[126]:=",ExpressionUUID->"3b8f27a4-6d6b-453a-99df-61d6792d7f51"],

Cell[BoxData[
 RowBox[{"-", 
  FractionBox[
   RowBox[{"3", " ", "a", " ", 
    TemplateBox[{"2", 
      RowBox[{"{", 
        RowBox[{"4", ",", "3", ",", "2", ",", "1"}], "}"}], "4"},
     "SquareSquareChain",
     DisplayFunction->(RowBox[{"[", #, #2, #3, "]"}]& ),
     InterpretationFunction->(
      RowBox[{"Chain", "[", "$square", ",", #, ",", #2, ",", #3, ",", 
        "$square", "]"}]& )], " ", 
    TemplateBox[{"5", "6"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], " ", 
    SuperscriptBox[
     TemplateBox[{"9", "10"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], "3"]}], 
   RowBox[{
    TemplateBox[{"6", 
      RowBox[{"{", "7", "}"}], "8"},
     "AngleSquareChain",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
     InterpretationFunction->(
      RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
        "$square", "]"}]& )], " ", 
    TemplateBox[{"6", "7"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )]}]]}]], "Output",
 CellChangeTimes->{3.8260917439907722`*^9},
 CellLabel->
  "Out[126]=",ExpressionUUID->"a5680ad4-b1c2-4666-b49f-65eee4090276"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"prova", "//", "ToChain2"}]], "Input",
 CellChangeTimes->{{3.8260917459963074`*^9, 3.8260917500037513`*^9}},
 CellLabel->
  "In[149]:=",ExpressionUUID->"b18b8014-5b6b-43bf-af43-683919eb30e3"],

Cell[BoxData[
 RowBox[{"-", 
  FractionBox[
   RowBox[{"3", " ", "a", " ", 
    TemplateBox[{"4", 
      RowBox[{"{", 
        RowBox[{"3", ",", "2", ",", "1"}], "}"}], "4"},
     "AngleSquareChain",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
     InterpretationFunction->(
      RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
        "$square", "]"}]& )], " ", 
    TemplateBox[{"2", "4"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], " ", 
    TemplateBox[{"5", "6"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], " ", 
    SuperscriptBox[
     TemplateBox[{"9", "10"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], "3"]}], 
   RowBox[{
    TemplateBox[{"6", 
      RowBox[{"{", "7", "}"}], "8"},
     "AngleSquareChain",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
     InterpretationFunction->(
      RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
        "$square", "]"}]& )], " ", 
    TemplateBox[{"6", "7"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )]}]]}]], "Output",
 CellChangeTimes->{
  3.8260917505991573`*^9, 3.826091835704156*^9, {3.8260920719320807`*^9, 
   3.826092093704536*^9}, {3.8260935874716473`*^9, 3.8260935938775635`*^9}},
 CellLabel->
  "Out[149]=",ExpressionUUID->"c42d3971-3f00-4b6c-a906-f218c4a5cd59"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Minimal chains", "Subsection",
 CellChangeTimes->{{3.825048586414443*^9, 
  3.825048588787038*^9}},ExpressionUUID->"4639e365-1b27-4556-ac7b-\
1973d0f7f38c"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"test", "=", 
  RowBox[{"List", "@@", 
   RowBox[{"(", 
    RowBox[{
     TemplateBox[{"1", "2"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], 
     TemplateBox[{"4", "3"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], 
     TemplateBox[{"2", "3"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], 
     TemplateBox[{"2", "4"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], 
     TemplateBox[{"4", "1"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], ")"}]}]}]], "Input",
 CellLabel->"In[16]:=",ExpressionUUID->"5c10abe9-dd0d-4049-bda5-d22927182a75"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   TemplateBox[{"1", "2"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"3", "4"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"1", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"2", "3"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"2", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]], "Output",
 CellChangeTimes->{3.825134989505452*^9},
 CellLabel->"Out[16]=",ExpressionUUID->"24d629f7-3372-4bfe-aba8-6635e8c8c781"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Lets try with graphs, some tests", "Subsubsection",
 CellChangeTimes->{{3.8250485935425496`*^9, 3.825048600518742*^9}, {
  3.8250523740650167`*^9, 
  3.825052375457822*^9}},ExpressionUUID->"6307244f-0d9c-4f78-9596-\
f6ab2026485c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"partitionsRojo", "[", 
    RowBox[{"list_", ",", "l_"}], "]"}], ":=", 
   RowBox[{"Join", "@@", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"x", ",", "##"}], "}"}], "&"}], "@@@", 
       RowBox[{"partitionsRojo", "[", 
        RowBox[{
         RowBox[{"list", "~", "Complement", "~", "x"}], ",", "l"}], "]"}]}], 
      ",", 
      RowBox[{"{", 
       RowBox[{"x", ",", 
        RowBox[{"Subsets", "[", 
         RowBox[{"list", ",", 
          RowBox[{"{", "l", "}"}], ",", 
          RowBox[{"Binomial", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", "list", "]"}], "-", "1"}], ",", 
            RowBox[{"l", "-", "1"}]}], "]"}]}], "]"}]}], "}"}]}], "]"}]}]}], 
  "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"partitionsRojo", "[", 
    RowBox[{"list_", ",", "l_"}], "]"}], "/;", 
   RowBox[{
    RowBox[{"Length", "[", "list", "]"}], "===", "l"}]}], ":=", 
  RowBox[{"{", 
   RowBox[{"{", "list", "}"}], "}"}]}]}], "Input",
 CellChangeTimes->{{3.825050586936861*^9, 3.82505062580722*^9}},
 CellLabel->"In[24]:=",ExpressionUUID->"c69d2502-bbc4-4a62-a322-3c95ac2f8b11"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
   "The", " ", "idea", " ", "is", " ", "that", " ", "every", " ", "single", 
    " ", "term", " ", "in", " ", "a", " ", "bracket", " ", "is", " ", "a", 
    " ", "node", " ", "in", " ", "a", " ", "graph"}], ",", " ", 
   RowBox[{
   "the", " ", "graph", " ", "will", " ", "have", " ", "several", " ", 
    "paths", " ", "connecting", " ", "the", " ", "nodes", " ", "among", " ", 
    "each", " ", "other", " ", "and", " ", "we", " ", "need", " ", "to", " ", 
    "pick", " ", "the", " ", "Shortest", " ", "paths", " ", "up", " ", "to", 
    " ", "saturating", " ", "all", " ", "nodes"}]}], "*)"}]], "Input",
 CellChangeTimes->{{3.825048601641464*^9, 
  3.825048663995677*^9}},ExpressionUUID->"9c6dc402-8b7f-409a-a0bf-\
f68d54b48b47"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "Convert", " ", "a", " ", "list", " ", "of", " ", "brackets", " ", "into", 
   " ", "an", " ", "appropriate", " ", "graph"}], "*)"}]], "Input",
 CellChangeTimes->{{3.8250486798421183`*^9, 
  3.825048738863719*^9}},ExpressionUUID->"3227516f-4df5-4de4-a9a9-\
037a37952cbf"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"test", "=", 
  RowBox[{"List", "@@", 
   RowBox[{"(", 
    RowBox[{
     TemplateBox[{"1", "2"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], 
     TemplateBox[{"4", "3"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], 
     TemplateBox[{"2", "3"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], 
     TemplateBox[{"2", "4"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], 
     TemplateBox[{"4", "1"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.8250487457557955`*^9, 3.825048801069578*^9}},
 CellLabel->"In[6]:=",ExpressionUUID->"98707538-178f-417f-b529-bcb492c4aa9b"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   TemplateBox[{"1", "2"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"3", "4"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"1", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"2", "3"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"2", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]], "Output",
 CellChangeTimes->{{3.8250487776471205`*^9, 3.825048802074373*^9}},
 CellLabel->"Out[6]=",ExpressionUUID->"4623f3a3-df96-41f4-b5e0-2d7725c969d3"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Block", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
    "exp", ",", "ag", ",", "sq", ",", "len", ",", "lenag", ",", "lensq", ",", 
     "graph", ",", "allpartitions", ",", "range"}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"exp", "=", "test"}], ";", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{"Split", " ", "square", " ", "from", " ", 
      RowBox[{"angles", ".", " ", "The"}], " ", "expression", " ", "comes", 
      " ", "from", " ", "a", " ", "Times", " ", "so", " ", "it", " ", "will", 
      " ", "already", " ", "be", " ", "ordered", " ", "with", " ", "angles", 
      " ", "first"}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ag", ",", "sq"}], "}"}], "=", 
     RowBox[{"SplitBy", "[", 
      RowBox[{"exp", ",", "Head"}], "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"len", "=", 
     RowBox[{"Length", "[", "exp", "]"}]}], ";", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
     "lenag", " ", "and", " ", "lensq", " ", "will", " ", "be", " ", "used", 
      " ", "as", " ", "an", " ", "offset", " ", "later"}], "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{"lenag", "=", 
     RowBox[{"Length", "[", "ag", "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"lensq", "=", 
     RowBox[{"Length", "[", "sq", "]"}]}], ";", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"graph", "=", 
     RowBox[{
      RowBox[{"AdjacencyGraph", "@", 
       RowBox[{"(", 
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"PadLeft", "[", 
             RowBox[{"#", ",", "len"}], "]"}], "&"}], "/@", 
           RowBox[{"(", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"FreeQ", "[", 
                 RowBox[{"sq", ",", 
                  RowBox[{"Alternatives", "@@", "j"}]}], "]"}], ",", "0", ",",
                 "1"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"j", ",", "ag"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "sq"}], "}"}]}], "]"}], ")"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"PadRight", "[", 
             RowBox[{"#", ",", "len"}], "]"}], "&"}], "/@", 
           RowBox[{"(", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"FreeQ", "[", 
                 RowBox[{"ag", ",", 
                  RowBox[{"Alternatives", "@@", "j"}]}], "]"}], ",", "0", ",",
                 "1"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"j", ",", "sq"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "ag"}], "}"}]}], "]"}], ")"}]}]}], "]"}], 
        ")"}]}], "//", "Echo"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"range", "=", 
     RowBox[{"Range", "[", "len", "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"FindShortestPath", "[", 
       RowBox[{"graph", ",", 
        RowBox[{"Sequence", "@@", "#"}]}], "]"}], "&"}], "/@", 
     RowBox[{"Subsets", "[", 
      RowBox[{
       RowBox[{"Range", "[", "len", "]"}], ",", 
       RowBox[{"{", "2", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"allpartitions", "=", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"OddQ", "[", "len", "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "If", " ", "there", " ", "are", " ", "an", " ", "odd", " ", "number", 
         " ", "of", " ", "brackets", " ", "we", " ", "must", " ", "first", 
         " ", "isolate", " ", "some", " ", "to", " ", "make", " ", "it", " ", 
         "even", " ", "and", " ", "apply", " ", 
         RowBox[{"Rojo", "'"}], "s", " ", "partition", " ", 
         RowBox[{"function", ".", " ", "Then"}], " ", "map", " ", 
         "FindShortestPath", " ", "on", " ", "the", " ", "outcome"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", "i", "}"}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"partitionsRojo", "[", 
              RowBox[{"#", ",", "2"}], "]"}], "&"}], "@", 
            RowBox[{"(", 
             RowBox[{"Drop", "[", 
              RowBox[{"range", ",", 
               RowBox[{"{", "i", "}"}]}], "]"}], ")"}]}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "len"}], "}"}]}], "]"}]}], "\[IndentingNewLine]", 
      "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"HighlightGraph", "[", 
     RowBox[{"graph", ",", 
      RowBox[{"PathGraph", "@", 
       RowBox[{"Echo", "@", 
        RowBox[{"FindHamiltonianPath", "[", "graph", "]"}]}]}]}], "]"}]}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGAQBWIQLRn0YO3m+jeOLNcK14HoJ3uubQXRj04H7gPR+5XZ
T4DodV6bz4Hoo8K7n4DohDXHpLYAaen5M+VBdDTfAQUQbX6rWx1Eb3E9pA2i
C17zGoDoe43JRiB6f5SPNYiuLO+xA9ET1sc7geg/yTlg+tJMGw8QHWDn4Q2i
l3dXNoPoNYVe/SA6OMxmKoiWm90/HURrPFs6B0Q/l1CfB6JfhYYtAdGaq8vA
tM+qp2vA5k15vw5EH7ovdBJET44vuAiif68Wvg6iv1hn3gfRQlt//wLROUxb
foPoK7fO820F0j0iLvwg+ljyZFEQzfz9sASY/2CpEoiWevwRTAMAxk+7HQ==

  "],
 CellLabel->"In[35]:=",ExpressionUUID->"51703f57-3f3c-4265-9d0c-4c567bd8f352"],

Cell[CellGroupData[{

Cell[BoxData[
 GraphicsBox[
  NamespaceBox["NetworkGraphics",
   DynamicModuleBox[{Typeset`graph = HoldComplete[
     Graph[{1, 2, 3, 4, 5}, {Null, 
       SparseArray[
       Automatic, {5, 5}, 0, {
        1, {{0, 3, 6, 8, 10, 12}, {{3}, {4}, {5}, {3}, {4}, {5}, {1}, {2}, {
          1}, {2}, {1}, {2}}}, Pattern}]}]]}, 
    TagBox[
     GraphicsGroupBox[
      GraphicsComplexBox[{{0.9319886632888627, 0.9500291778062808}, {
       0.9309630625745587, 0.26670502944411556`}, {1.6531984111753333`, 0.}, {
       1.6521923265216456`, 1.2180609008634637`}, {0., 0.6089078298680417}}, {
        {Hue[0.6, 0.7, 0.5], Opacity[0.7], Arrowheads[0.], 
         ArrowBox[{{1, 3}, {1, 4}, {1, 5}, {2, 3}, {2, 4}, {2, 5}}, 
          0.019733983340941258`]}, 
        {Hue[0.6, 0.2, 0.8], EdgeForm[{GrayLevel[0], Opacity[0.7]}], 
         DiskBox[1, 0.019733983340941258], DiskBox[2, 0.019733983340941258], 
         DiskBox[3, 0.019733983340941258], DiskBox[4, 0.019733983340941258], 
         DiskBox[5, 0.019733983340941258]}}]],
     MouseAppearanceTag["NetworkGraphics"]],
    AllowKernelInitialization->False]],
  DefaultBaseStyle->{
   "NetworkGraphics", FrontEnd`GraphicsHighlightColor -> Hue[0.8, 1., 0.6]},
  FormatType->TraditionalForm,
  FrameTicks->None]], "Echo",
 CellChangeTimes->{
  3.825051928117711*^9},ExpressionUUID->"f91d3e45-d755-4361-a0e8-\
739660614e06"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"3", ",", "1", ",", "4", ",", "2", ",", "5"}], "}"}]], "Echo",
 CellChangeTimes->{
  3.825051928189357*^9},ExpressionUUID->"cc23bbf7-ad08-4848-965f-\
34821304a783"]
}, Open  ]],

Cell[BoxData[
 GraphicsBox[
  NamespaceBox["NetworkGraphics",
   DynamicModuleBox[{Typeset`graph = HoldComplete[
     Graph[{1, 2, 3, 4, 5}, {Null, 
       SparseArray[
       Automatic, {5, 5}, 0, {
        1, {{0, 3, 6, 8, 10, 12}, {{3}, {4}, {5}, {3}, {4}, {5}, {1}, {2}, {
          1}, {2}, {1}, {2}}}, Pattern}]}, {GraphHighlight -> {1, 5, 
         UndirectedEdge[4, 2], 
         UndirectedEdge[1, 4], 
         UndirectedEdge[3, 1], 2, 
         UndirectedEdge[2, 5], 4, 3}}]]}, 
    TagBox[
     GraphicsGroupBox[
      GraphicsComplexBox[{{0.9319886632888627, 0.9500291778062808}, {
       0.9309630625745587, 0.26670502944411556`}, {1.6531984111753333`, 0.}, {
       1.6521923265216456`, 1.2180609008634637`}, {0., 0.6089078298680417}}, {
        {Hue[0.6, 0.7, 0.5], Opacity[0.7], 
         {Hue[1, 1, 0.7], Opacity[1], 
          {Arrowheads[0.], 
           ArrowBox[{{0.9319886632888627, 0.9500291778062808}, {
            1.6531984111753333`, 0.}}, 0.019733983340941258`]}}, 
         {Hue[1, 1, 0.7], Opacity[1], 
          {Arrowheads[0.], 
           ArrowBox[{{0.9319886632888627, 0.9500291778062808}, {
            1.6521923265216456`, 1.2180609008634637`}}, 
            0.019733983340941258`]}}, 
         {Arrowheads[0.], 
          ArrowBox[{{0.9319886632888627, 0.9500291778062808}, {0., 
           0.6089078298680417}}, 0.019733983340941258`]}, 
         {Arrowheads[0.], 
          ArrowBox[{{0.9309630625745587, 0.26670502944411556`}, {
           1.6531984111753333`, 0.}}, 0.019733983340941258`]}, 
         {Hue[1, 1, 0.7], Opacity[1], 
          {Arrowheads[0.], 
           ArrowBox[{{0.9309630625745587, 0.26670502944411556`}, {
            1.6521923265216456`, 1.2180609008634637`}}, 
            0.019733983340941258`]}}, 
         {Hue[1, 1, 0.7], Opacity[1], 
          {Arrowheads[0.], 
           ArrowBox[{{0.9309630625745587, 0.26670502944411556`}, {0., 
            0.6089078298680417}}, 0.019733983340941258`]}}}, 
        {Hue[0.6, 0.2, 0.8], EdgeForm[{GrayLevel[0], Opacity[0.7]}], 
         {Hue[1, 1, 0.7], EdgeForm[{Hue[1, 1, 0.7], Opacity[1]}], 
          DiskBox[1, 0.019733983340941258]}, 
         {Hue[1, 1, 0.7], EdgeForm[{Hue[1, 1, 0.7], Opacity[1]}], 
          DiskBox[2, 0.019733983340941258]}, 
         {Hue[1, 1, 0.7], EdgeForm[{Hue[1, 1, 0.7], Opacity[1]}], 
          DiskBox[3, 0.019733983340941258]}, 
         {Hue[1, 1, 0.7], EdgeForm[{Hue[1, 1, 0.7], Opacity[1]}], 
          DiskBox[4, 0.019733983340941258]}, 
         {Hue[1, 1, 0.7], EdgeForm[{Hue[1, 1, 0.7], Opacity[1]}], 
          DiskBox[5, 0.019733983340941258]}}}]],
     MouseAppearanceTag["NetworkGraphics"]],
    AllowKernelInitialization->False]],
  DefaultBaseStyle->{
   "NetworkGraphics", FrontEnd`GraphicsHighlightColor -> Hue[0.8, 1., 0.6]},
  FormatType->TraditionalForm,
  FrameTicks->None]], "Output",
 CellChangeTimes->{
  3.8250491628190517`*^9, 3.8250495127937326`*^9, 3.8250495873601527`*^9, {
   3.825049622203163*^9, 3.8250496544823503`*^9}, {3.8250497076622767`*^9, 
   3.82504972996935*^9}, 3.82504976124998*^9, 3.825049814737402*^9, 
   3.8250499511734114`*^9, 3.825050004372717*^9, 3.825050132539259*^9, 
   3.825050202913306*^9, {3.825051216817891*^9, 3.825051230622869*^9}, {
   3.8250512689988775`*^9, 3.825051276190587*^9}, 3.8250516141270494`*^9, 
   3.8250517707155886`*^9, {3.8250518313206453`*^9, 3.825051846849638*^9}, 
   3.825051928278758*^9},
 CellLabel->"Out[35]=",ExpressionUUID->"132b1441-3ab0-44d7-9fe3-11a02f4a4d3e"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Again with Garphs", "Subsubsection",
 CellChangeTimes->{{3.825052363277486*^9, 
  3.825052371351208*^9}},ExpressionUUID->"912249ee-fc72-4ed0-ab86-\
cff0394ddc94"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Block", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
    "exp", ",", "ag", ",", "sq", ",", "len", ",", "lenag", ",", "lensq", ",", 
     "graph", ",", "allpartitions", ",", "range"}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"exp", "=", "test"}], ";", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{"Split", " ", "square", " ", "from", " ", 
      RowBox[{"angles", ".", " ", "The"}], " ", "expression", " ", "comes", 
      " ", "from", " ", "a", " ", "Times", " ", "so", " ", "it", " ", "will", 
      " ", "already", " ", "be", " ", "ordered", " ", "with", " ", "angles", 
      " ", "first"}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ag", ",", "sq"}], "}"}], "=", 
     RowBox[{"SplitBy", "[", 
      RowBox[{"exp", ",", "Head"}], "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"len", "=", 
     RowBox[{"Length", "[", "exp", "]"}]}], ";", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
     "lenag", " ", "and", " ", "lensq", " ", "will", " ", "be", " ", "used", 
      " ", "as", " ", "an", " ", "offset", " ", "later"}], "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{"lenag", "=", 
     RowBox[{"Length", "[", "ag", "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"lensq", "=", 
     RowBox[{"Length", "[", "sq", "]"}]}], ";", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"graph", "=", 
     RowBox[{"(", 
      RowBox[{"(", 
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"PadLeft", "[", 
            RowBox[{"#", ",", "len"}], "]"}], "&"}], "/@", 
          RowBox[{"(", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"FreeQ", "[", 
                RowBox[{"sq", ",", 
                 RowBox[{"Alternatives", "@@", "j"}]}], "]"}], ",", "0", ",", 
               "1"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"j", ",", "ag"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "sq"}], "}"}]}], "]"}], ")"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{"0", ",", 
           RowBox[{"{", 
            RowBox[{"lensq", ",", "len"}], "}"}]}], "]"}]}], "]"}], ")"}], 
      ")"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"graph", "=", 
     RowBox[{
      RowBox[{"AdjacencyGraph", "@", 
       RowBox[{"Echo", "@", 
        RowBox[{"(", 
         RowBox[{"graph", "+", 
          RowBox[{"Transpose", "[", "graph", "]"}]}], ")"}]}]}], "//", 
      "Echo"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"globalgraph", "=", "graph"}], ";", "\[IndentingNewLine]", 
    RowBox[{"range", "=", 
     RowBox[{"Range", "[", "len", "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"FindShortestPath", "[", 
       RowBox[{"graph", ",", "1", ",", "i"}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", "len"}], "}"}]}], "]"}]}]}], "\[IndentingNewLine]", 
  "]"}]], "Input",
 CellChangeTimes->CompressedData["
1:eJwdzE0owwEABfC1KSdbtinmcxxGHMTKwVoRWtsUlhFp2lBYGQfaicVty9Tm
Y23NxaJtpvZBIdPMmpQhTY1sMRQiUcoc7P0Pr1/vHR5bPtYxSCaRSIXpwLyO
xKZn+q0hIzrugsn9qA/en7YfQH9ZZhi6hJ4zeMzYS8J+Z4jlTZu/aiqGvdTD
ElgX03KgtzlQCVWvWdXwTqOogf4ecT1UT+n4cGFL1gj/FErCSxNPANv4AhFc
16pnoXNcqIcSKW8RFpn1y7D8yWaBz7kcK3zplK7BCsckodj+6CT+jB8uGIjT
T6BBprqAKQfjGn7XD8ch3Zf6hUqyNwWvYhGqL62O2USDIYUhB1J+jnKJnrCV
QtbDJ2HiXdsF2QPUbjg/TOuDTN4ZISVolxP7XNUQtEi4I3DCyh2F4a8Z93Za
91L2DjTunu9Deq0+CFdcz2G4IYpEYItZcwMLwq238B+CbwG3
  "],
 CellLabel->"In[71]:=",ExpressionUUID->"af5f0a87-f30f-47ac-9370-1b3f2b346e9d"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"0", ",", "0", ",", "1", ",", "1", ",", "1"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "0", ",", "1", ",", "1", ",", "1"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "1", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "1", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "1", ",", "0", ",", "0", ",", "0"}], "}"}]}], 
  "}"}]], "Echo",
 CellChangeTimes->{
  3.8250554592688007`*^9},ExpressionUUID->"1cad9b93-0c47-4b76-b9ef-\
63f6e056002a"],

Cell[BoxData[
 GraphicsBox[
  NamespaceBox["NetworkGraphics",
   DynamicModuleBox[{Typeset`graph = HoldComplete[
     Graph[{1, 2, 3, 4, 5}, {Null, 
       SparseArray[
       Automatic, {5, 5}, 0, {
        1, {{0, 3, 6, 8, 10, 12}, {{3}, {4}, {5}, {3}, {4}, {5}, {1}, {2}, {
          1}, {2}, {1}, {2}}}, Pattern}]}]]}, 
    TagBox[
     GraphicsGroupBox[
      GraphicsComplexBox[{{0.9319886632888627, 0.9500291778062808}, {
       0.9309630625745587, 0.26670502944411556`}, {1.6531984111753333`, 0.}, {
       1.6521923265216456`, 1.2180609008634637`}, {0., 0.6089078298680417}}, {
        {Hue[0.6, 0.7, 0.5], Opacity[0.7], Arrowheads[0.], 
         ArrowBox[{{1, 3}, {1, 4}, {1, 5}, {2, 3}, {2, 4}, {2, 5}}, 
          0.019733983340941258`]}, 
        {Hue[0.6, 0.2, 0.8], EdgeForm[{GrayLevel[0], Opacity[0.7]}], 
         DiskBox[1, 0.019733983340941258], DiskBox[2, 0.019733983340941258], 
         DiskBox[3, 0.019733983340941258], DiskBox[4, 0.019733983340941258], 
         DiskBox[5, 0.019733983340941258]}}]],
     MouseAppearanceTag["NetworkGraphics"]],
    AllowKernelInitialization->False]],
  DefaultBaseStyle->{
   "NetworkGraphics", FrontEnd`GraphicsHighlightColor -> Hue[0.8, 1., 0.6]},
  FormatType->TraditionalForm,
  FrameTicks->None]], "Echo",
 CellChangeTimes->{
  3.825055459348583*^9},ExpressionUUID->"3c9b4830-f3ac-41fd-9fa7-\
e5523fb63016"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", "1", "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "3", ",", "2"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "3"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "4"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "5"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{3.825055360958771*^9, 3.8250554594197025`*^9},
 CellLabel->"Out[71]=",ExpressionUUID->"f1ba2773-1ccf-4122-a5d3-b740a9246d84"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"HighlightGraph", "[", 
    RowBox[{"globalgraph", ",", 
     RowBox[{"PathGraph", "@", "#"}]}], "]"}], "&"}], "/@", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"FindShortestPath", "[", 
           RowBox[{"#3", ",", "#1", ",", "i"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "#2"}], "}"}]}], "]"}], "&"}], "@@", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"First", "@", 
          RowBox[{"VertexList", "[", "#", "]"}]}], ",", 
         RowBox[{"VertexList", "[", "#", "]"}], ",", "#"}], "}"}]}], "&"}], 
     ")"}], "@", "globalgraph"}], ")"}]}]], "Input",
 CellChangeTimes->{{3.825052509159007*^9, 3.8250525747724032`*^9}, {
  3.8250526138041043`*^9, 3.825052758547783*^9}},
 CellLabel->"In[42]:=",ExpressionUUID->"0cbe7b52-8257-4376-95b1-c7e7a7c56614"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   GraphicsBox[
    NamespaceBox["NetworkGraphics",
     DynamicModuleBox[{Typeset`graph = HoldComplete[
       Graph[{1, 2, 3, 4, 5}, {Null, 
         SparseArray[
         Automatic, {5, 5}, 0, {
          1, {{0, 3, 6, 8, 10, 12}, {{3}, {4}, {5}, {3}, {4}, {5}, {1}, {2}, {
            1}, {2}, {1}, {2}}}, Pattern}]}, {GraphHighlight -> {1}}]]}, 
      TagBox[
       GraphicsGroupBox[
        GraphicsComplexBox[{{0.9319886632888627, 0.9500291778062808}, {
         0.9309630625745587, 0.26670502944411556`}, {1.6531984111753333`, 
         0.}, {1.6521923265216456`, 1.2180609008634637`}, {0., 
         0.6089078298680417}}, {
          {Hue[0.6, 0.7, 0.5], Opacity[0.7], Arrowheads[0.], 
           ArrowBox[{{1, 3}, {1, 4}, {1, 5}, {2, 3}, {2, 4}, {2, 5}}, 
            0.019733983340941258`]}, 
          {Hue[0.6, 0.2, 0.8], EdgeForm[{GrayLevel[0], Opacity[0.7]}], 
           {Hue[1, 1, 0.7], EdgeForm[{Hue[1, 1, 0.7], Opacity[1]}], 
            DiskBox[1, 0.019733983340941258]}, 
           DiskBox[2, 0.019733983340941258], DiskBox[3, 0.019733983340941258],
            DiskBox[4, 0.019733983340941258], 
           DiskBox[5, 0.019733983340941258]}}]],
       MouseAppearanceTag["NetworkGraphics"]],
      AllowKernelInitialization->False]],
    DefaultBaseStyle->{
     "NetworkGraphics", FrontEnd`GraphicsHighlightColor -> Hue[0.8, 1., 0.6]},
    FormatType->TraditionalForm,
    FrameTicks->None], ",", 
   GraphicsBox[
    NamespaceBox["NetworkGraphics",
     DynamicModuleBox[{Typeset`graph = HoldComplete[
       Graph[{1, 2, 3, 4, 5}, {Null, 
         SparseArray[
         Automatic, {5, 5}, 0, {
          1, {{0, 3, 6, 8, 10, 12}, {{3}, {4}, {5}, {3}, {4}, {5}, {1}, {2}, {
            1}, {2}, {1}, {2}}}, Pattern}]}, {GraphHighlight -> {1, 
           UndirectedEdge[1, 3], 
           UndirectedEdge[3, 2], 2, 3}}]]}, 
      TagBox[
       GraphicsGroupBox[
        GraphicsComplexBox[{{0.9319886632888627, 0.9500291778062808}, {
         0.9309630625745587, 0.26670502944411556`}, {1.6531984111753333`, 
         0.}, {1.6521923265216456`, 1.2180609008634637`}, {0., 
         0.6089078298680417}}, {
          {Hue[0.6, 0.7, 0.5], Opacity[0.7], 
           {Hue[1, 1, 0.7], Opacity[1], 
            {Arrowheads[0.], 
             ArrowBox[{{0.9319886632888627, 0.9500291778062808}, {
              1.6531984111753333`, 0.}}, 0.019733983340941258`]}}, 
           {Arrowheads[0.], 
            ArrowBox[{{0.9319886632888627, 0.9500291778062808}, {
             1.6521923265216456`, 1.2180609008634637`}}, 
             0.019733983340941258`]}, 
           {Arrowheads[0.], 
            ArrowBox[{{0.9319886632888627, 0.9500291778062808}, {0., 
             0.6089078298680417}}, 0.019733983340941258`]}, 
           {Hue[1, 1, 0.7], Opacity[1], 
            {Arrowheads[0.], 
             ArrowBox[{{0.9309630625745587, 0.26670502944411556`}, {
              1.6531984111753333`, 0.}}, 0.019733983340941258`]}}, 
           {Arrowheads[0.], 
            ArrowBox[{{0.9309630625745587, 0.26670502944411556`}, {
             1.6521923265216456`, 1.2180609008634637`}}, 
             0.019733983340941258`]}, 
           {Arrowheads[0.], 
            ArrowBox[{{0.9309630625745587, 0.26670502944411556`}, {0., 
             0.6089078298680417}}, 0.019733983340941258`]}}, 
          {Hue[0.6, 0.2, 0.8], EdgeForm[{GrayLevel[0], Opacity[0.7]}], 
           {Hue[1, 1, 0.7], EdgeForm[{Hue[1, 1, 0.7], Opacity[1]}], 
            DiskBox[1, 0.019733983340941258]}, 
           {Hue[1, 1, 0.7], EdgeForm[{Hue[1, 1, 0.7], Opacity[1]}], 
            DiskBox[2, 0.019733983340941258]}, 
           {Hue[1, 1, 0.7], EdgeForm[{Hue[1, 1, 0.7], Opacity[1]}], 
            DiskBox[3, 0.019733983340941258]}, 
           DiskBox[4, 0.019733983340941258], 
           DiskBox[5, 0.019733983340941258]}}]],
       MouseAppearanceTag["NetworkGraphics"]],
      AllowKernelInitialization->False]],
    DefaultBaseStyle->{
     "NetworkGraphics", FrontEnd`GraphicsHighlightColor -> Hue[0.8, 1., 0.6]},
    FormatType->TraditionalForm,
    FrameTicks->None], ",", 
   GraphicsBox[
    NamespaceBox["NetworkGraphics",
     DynamicModuleBox[{Typeset`graph = HoldComplete[
       Graph[{1, 2, 3, 4, 5}, {Null, 
         SparseArray[
         Automatic, {5, 5}, 0, {
          1, {{0, 3, 6, 8, 10, 12}, {{3}, {4}, {5}, {3}, {4}, {5}, {1}, {2}, {
            1}, {2}, {1}, {2}}}, Pattern}]}, {GraphHighlight -> {1, 
           UndirectedEdge[1, 3], 3}}]]}, 
      TagBox[
       GraphicsGroupBox[
        GraphicsComplexBox[{{0.9319886632888627, 0.9500291778062808}, {
         0.9309630625745587, 0.26670502944411556`}, {1.6531984111753333`, 
         0.}, {1.6521923265216456`, 1.2180609008634637`}, {0., 
         0.6089078298680417}}, {
          {Hue[0.6, 0.7, 0.5], Opacity[0.7], 
           {Hue[1, 1, 0.7], Opacity[1], 
            {Arrowheads[0.], 
             ArrowBox[{{0.9319886632888627, 0.9500291778062808}, {
              1.6531984111753333`, 0.}}, 0.019733983340941258`]}}, 
           {Arrowheads[0.], 
            ArrowBox[{{0.9319886632888627, 0.9500291778062808}, {
             1.6521923265216456`, 1.2180609008634637`}}, 
             0.019733983340941258`]}, 
           {Arrowheads[0.], 
            ArrowBox[{{0.9319886632888627, 0.9500291778062808}, {0., 
             0.6089078298680417}}, 0.019733983340941258`]}, 
           {Arrowheads[0.], 
            ArrowBox[{{0.9309630625745587, 0.26670502944411556`}, {
             1.6531984111753333`, 0.}}, 0.019733983340941258`]}, 
           {Arrowheads[0.], 
            ArrowBox[{{0.9309630625745587, 0.26670502944411556`}, {
             1.6521923265216456`, 1.2180609008634637`}}, 
             0.019733983340941258`]}, 
           {Arrowheads[0.], 
            ArrowBox[{{0.9309630625745587, 0.26670502944411556`}, {0., 
             0.6089078298680417}}, 0.019733983340941258`]}}, 
          {Hue[0.6, 0.2, 0.8], EdgeForm[{GrayLevel[0], Opacity[0.7]}], 
           {Hue[1, 1, 0.7], EdgeForm[{Hue[1, 1, 0.7], Opacity[1]}], 
            DiskBox[1, 0.019733983340941258]}, 
           DiskBox[2, 0.019733983340941258], 
           {Hue[1, 1, 0.7], EdgeForm[{Hue[1, 1, 0.7], Opacity[1]}], 
            DiskBox[3, 0.019733983340941258]}, 
           DiskBox[4, 0.019733983340941258], 
           DiskBox[5, 0.019733983340941258]}}]],
       MouseAppearanceTag["NetworkGraphics"]],
      AllowKernelInitialization->False]],
    DefaultBaseStyle->{
     "NetworkGraphics", FrontEnd`GraphicsHighlightColor -> Hue[0.8, 1., 0.6]},
    FormatType->TraditionalForm,
    FrameTicks->None], ",", 
   GraphicsBox[
    NamespaceBox["NetworkGraphics",
     DynamicModuleBox[{Typeset`graph = HoldComplete[
       Graph[{1, 2, 3, 4, 5}, {Null, 
         SparseArray[
         Automatic, {5, 5}, 0, {
          1, {{0, 3, 6, 8, 10, 12}, {{3}, {4}, {5}, {3}, {4}, {5}, {1}, {2}, {
            1}, {2}, {1}, {2}}}, Pattern}]}, {GraphHighlight -> {1, 
           UndirectedEdge[1, 4], 4}}]]}, 
      TagBox[
       GraphicsGroupBox[
        GraphicsComplexBox[{{0.9319886632888627, 0.9500291778062808}, {
         0.9309630625745587, 0.26670502944411556`}, {1.6531984111753333`, 
         0.}, {1.6521923265216456`, 1.2180609008634637`}, {0., 
         0.6089078298680417}}, {
          {Hue[0.6, 0.7, 0.5], Opacity[0.7], 
           {Arrowheads[0.], 
            ArrowBox[{{0.9319886632888627, 0.9500291778062808}, {
             1.6531984111753333`, 0.}}, 0.019733983340941258`]}, 
           {Hue[1, 1, 0.7], Opacity[1], 
            {Arrowheads[0.], 
             ArrowBox[{{0.9319886632888627, 0.9500291778062808}, {
              1.6521923265216456`, 1.2180609008634637`}}, 
              0.019733983340941258`]}}, 
           {Arrowheads[0.], 
            ArrowBox[{{0.9319886632888627, 0.9500291778062808}, {0., 
             0.6089078298680417}}, 0.019733983340941258`]}, 
           {Arrowheads[0.], 
            ArrowBox[{{0.9309630625745587, 0.26670502944411556`}, {
             1.6531984111753333`, 0.}}, 0.019733983340941258`]}, 
           {Arrowheads[0.], 
            ArrowBox[{{0.9309630625745587, 0.26670502944411556`}, {
             1.6521923265216456`, 1.2180609008634637`}}, 
             0.019733983340941258`]}, 
           {Arrowheads[0.], 
            ArrowBox[{{0.9309630625745587, 0.26670502944411556`}, {0., 
             0.6089078298680417}}, 0.019733983340941258`]}}, 
          {Hue[0.6, 0.2, 0.8], EdgeForm[{GrayLevel[0], Opacity[0.7]}], 
           {Hue[1, 1, 0.7], EdgeForm[{Hue[1, 1, 0.7], Opacity[1]}], 
            DiskBox[1, 0.019733983340941258]}, 
           DiskBox[2, 0.019733983340941258], DiskBox[3, 0.019733983340941258], 
           {Hue[1, 1, 0.7], EdgeForm[{Hue[1, 1, 0.7], Opacity[1]}], 
            DiskBox[4, 0.019733983340941258]}, 
           DiskBox[5, 0.019733983340941258]}}]],
       MouseAppearanceTag["NetworkGraphics"]],
      AllowKernelInitialization->False]],
    DefaultBaseStyle->{
     "NetworkGraphics", FrontEnd`GraphicsHighlightColor -> Hue[0.8, 1., 0.6]},
    FormatType->TraditionalForm,
    FrameTicks->None], ",", 
   GraphicsBox[
    NamespaceBox["NetworkGraphics",
     DynamicModuleBox[{Typeset`graph = HoldComplete[
       Graph[{1, 2, 3, 4, 5}, {Null, 
         SparseArray[
         Automatic, {5, 5}, 0, {
          1, {{0, 3, 6, 8, 10, 12}, {{3}, {4}, {5}, {3}, {4}, {5}, {1}, {2}, {
            1}, {2}, {1}, {2}}}, Pattern}]}, {GraphHighlight -> {
           UndirectedEdge[1, 5], 1, 5}}]]}, 
      TagBox[
       GraphicsGroupBox[
        GraphicsComplexBox[{{0.9319886632888627, 0.9500291778062808}, {
         0.9309630625745587, 0.26670502944411556`}, {1.6531984111753333`, 
         0.}, {1.6521923265216456`, 1.2180609008634637`}, {0., 
         0.6089078298680417}}, {
          {Hue[0.6, 0.7, 0.5], Opacity[0.7], 
           {Arrowheads[0.], 
            ArrowBox[{{0.9319886632888627, 0.9500291778062808}, {
             1.6531984111753333`, 0.}}, 0.019733983340941258`]}, 
           {Arrowheads[0.], 
            ArrowBox[{{0.9319886632888627, 0.9500291778062808}, {
             1.6521923265216456`, 1.2180609008634637`}}, 
             0.019733983340941258`]}, 
           {Hue[1, 1, 0.7], Opacity[1], 
            {Arrowheads[0.], 
             ArrowBox[{{0.9319886632888627, 0.9500291778062808}, {0., 
              0.6089078298680417}}, 0.019733983340941258`]}}, 
           {Arrowheads[0.], 
            ArrowBox[{{0.9309630625745587, 0.26670502944411556`}, {
             1.6531984111753333`, 0.}}, 0.019733983340941258`]}, 
           {Arrowheads[0.], 
            ArrowBox[{{0.9309630625745587, 0.26670502944411556`}, {
             1.6521923265216456`, 1.2180609008634637`}}, 
             0.019733983340941258`]}, 
           {Arrowheads[0.], 
            ArrowBox[{{0.9309630625745587, 0.26670502944411556`}, {0., 
             0.6089078298680417}}, 0.019733983340941258`]}}, 
          {Hue[0.6, 0.2, 0.8], EdgeForm[{GrayLevel[0], Opacity[0.7]}], 
           {Hue[1, 1, 0.7], EdgeForm[{Hue[1, 1, 0.7], Opacity[1]}], 
            DiskBox[1, 0.019733983340941258]}, 
           DiskBox[2, 0.019733983340941258], DiskBox[3, 0.019733983340941258],
            DiskBox[4, 0.019733983340941258], 
           {Hue[1, 1, 0.7], EdgeForm[{Hue[1, 1, 0.7], Opacity[1]}], 
            DiskBox[5, 0.019733983340941258]}}}]],
       MouseAppearanceTag["NetworkGraphics"]],
      AllowKernelInitialization->False]],
    DefaultBaseStyle->{
     "NetworkGraphics", FrontEnd`GraphicsHighlightColor -> Hue[0.8, 1., 0.6]},
    FormatType->TraditionalForm,
    FrameTicks->None]}], "}"}]], "Output",
 CellChangeTimes->{3.8250525107172194`*^9, 3.825052616815943*^9, 
  3.8250527160180244`*^9, 3.825052759171379*^9},
 CellLabel->"Out[42]=",ExpressionUUID->"6dec06d3-89d7-45f3-9b76-3e3f5f89cafd"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"#", ",", 
     RowBox[{"VertexDelete", "[", 
      RowBox[{"globalgraph", ",", "#"}], "]"}]}], "}"}], "&"}], "/@", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"FindShortestPath", "[", 
           RowBox[{"#3", ",", "#1", ",", "i"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "#2"}], "}"}]}], "]"}], "&"}], "@@", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"First", "@", 
          RowBox[{"VertexList", "[", "#", "]"}]}], ",", 
         RowBox[{"VertexList", "[", "#", "]"}], ",", "#"}], "}"}]}], "&"}], 
     ")"}], "@", "globalgraph"}], ")"}]}]], "Input",
 CellChangeTimes->{{3.82505283450185*^9, 3.8250528418217745`*^9}, 
   3.8250529111499395`*^9, {3.8250529467519517`*^9, 3.8250529730478964`*^9}},
 CellLabel->"In[45]:=",ExpressionUUID->"ba7427e0-13d9-499c-b82d-17ca9eaac853"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", "1", "}"}], ",", 
     GraphicsBox[
      NamespaceBox["NetworkGraphics",
       DynamicModuleBox[{Typeset`graph = HoldComplete[
         Graph[{2, 3, 4, 5}, {Null, 
           SparseArray[
           Automatic, {4, 4}, 0, {
            1, {{0, 3, 4, 5, 6}, {{2}, {3}, {4}, {1}, {1}, {1}}}, 
             Pattern}]}]]}, 
        TagBox[
         GraphicsGroupBox[
          GraphicsComplexBox[{{0.7745966692414834, 0.7745966692414834}, {0., 
           0.}, {0.7745966692414834, 0.}, {1.5491933384829668`, 0.}}, {
            {Hue[0.6, 0.7, 0.5], Opacity[0.7], Arrowheads[0.], 
             ArrowBox[{{1, 2}, {1, 3}, {1, 4}}, 0.018845521490452433`]}, 
            {Hue[0.6, 0.2, 0.8], EdgeForm[{GrayLevel[0], Opacity[0.7]}], 
             DiskBox[1, 0.018845521490452433], 
             DiskBox[2, 0.018845521490452433], 
             DiskBox[3, 0.018845521490452433], 
             DiskBox[4, 0.018845521490452433]}}]],
         MouseAppearanceTag["NetworkGraphics"]],
        AllowKernelInitialization->False]],
      DefaultBaseStyle->{
       "NetworkGraphics", FrontEnd`GraphicsHighlightColor -> 
        Hue[0.8, 1., 0.6]},
      FormatType->TraditionalForm,
      FrameTicks->None]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "3", ",", "2"}], "}"}], ",", 
     GraphicsBox[
      NamespaceBox["NetworkGraphics",
       DynamicModuleBox[{Typeset`graph = HoldComplete[
         Graph[{4, 5}, {}]]}, 
        TagBox[
         GraphicsGroupBox[
          GraphicsComplexBox[{{0.00001, -0.000030000000000000004`}, {
           0.00001, -0.00001}}, {{}, 
            {Hue[0.6, 0.2, 0.8], EdgeForm[{GrayLevel[0], Opacity[0.7]}], 
             DiskBox[1, 2.5460000000000007*^-7], 
             DiskBox[2, 2.5460000000000007*^-7]}}]],
         MouseAppearanceTag["NetworkGraphics"]],
        AllowKernelInitialization->False]],
      DefaultBaseStyle->{
       "NetworkGraphics", FrontEnd`GraphicsHighlightColor -> 
        Hue[0.8, 1., 0.6]},
      FormatType->TraditionalForm,
      FrameTicks->None]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "3"}], "}"}], ",", 
     GraphicsBox[
      NamespaceBox["NetworkGraphics",
       DynamicModuleBox[{Typeset`graph = HoldComplete[
         Graph[{2, 4, 5}, {Null, 
           SparseArray[
           Automatic, {3, 3}, 0, {
            1, {{0, 2, 3, 4}, {{2}, {3}, {1}, {1}}}, Pattern}]}]]}, 
        TagBox[
         GraphicsGroupBox[
          GraphicsComplexBox[{{1., 2.4492935982947064`*^-16}, {0., 
           3.6739403974420594`*^-16}, {2., 0.}}, {
            {Hue[0.6, 0.7, 0.5], Opacity[0.7], Arrowheads[0.], 
             ArrowBox[{{1, 2}, {1, 3}}, 0.02261146496815286]}, 
            {Hue[0.6, 0.2, 0.8], EdgeForm[{GrayLevel[0], Opacity[0.7]}], 
             DiskBox[1, 0.02261146496815286], DiskBox[2, 0.02261146496815286],
              DiskBox[3, 0.02261146496815286]}}]],
         MouseAppearanceTag["NetworkGraphics"]],
        AllowKernelInitialization->False]],
      DefaultBaseStyle->{
       "NetworkGraphics", FrontEnd`GraphicsHighlightColor -> 
        Hue[0.8, 1., 0.6]},
      FormatType->TraditionalForm,
      FrameTicks->None]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "4"}], "}"}], ",", 
     GraphicsBox[
      NamespaceBox["NetworkGraphics",
       DynamicModuleBox[{Typeset`graph = HoldComplete[
         Graph[{2, 3, 5}, {Null, 
           SparseArray[
           Automatic, {3, 3}, 0, {
            1, {{0, 2, 3, 4}, {{2}, {3}, {1}, {1}}}, Pattern}]}]]}, 
        TagBox[
         GraphicsGroupBox[
          GraphicsComplexBox[{{1., 2.4492935982947064`*^-16}, {0., 
           3.6739403974420594`*^-16}, {2., 0.}}, {
            {Hue[0.6, 0.7, 0.5], Opacity[0.7], Arrowheads[0.], 
             ArrowBox[{{1, 2}, {1, 3}}, 0.02261146496815286]}, 
            {Hue[0.6, 0.2, 0.8], EdgeForm[{GrayLevel[0], Opacity[0.7]}], 
             DiskBox[1, 0.02261146496815286], DiskBox[2, 0.02261146496815286],
              DiskBox[3, 0.02261146496815286]}}]],
         MouseAppearanceTag["NetworkGraphics"]],
        AllowKernelInitialization->False]],
      DefaultBaseStyle->{
       "NetworkGraphics", FrontEnd`GraphicsHighlightColor -> 
        Hue[0.8, 1., 0.6]},
      FormatType->TraditionalForm,
      FrameTicks->None]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "5"}], "}"}], ",", 
     GraphicsBox[
      NamespaceBox["NetworkGraphics",
       DynamicModuleBox[{Typeset`graph = HoldComplete[
         Graph[{2, 3, 4}, {Null, 
           SparseArray[
           Automatic, {3, 3}, 0, {
            1, {{0, 2, 3, 4}, {{2}, {3}, {1}, {1}}}, Pattern}]}]]}, 
        TagBox[
         GraphicsGroupBox[
          GraphicsComplexBox[{{1., 2.4492935982947064`*^-16}, {0., 
           3.6739403974420594`*^-16}, {2., 0.}}, {
            {Hue[0.6, 0.7, 0.5], Opacity[0.7], Arrowheads[0.], 
             ArrowBox[{{1, 2}, {1, 3}}, 0.02261146496815286]}, 
            {Hue[0.6, 0.2, 0.8], EdgeForm[{GrayLevel[0], Opacity[0.7]}], 
             DiskBox[1, 0.02261146496815286], DiskBox[2, 0.02261146496815286],
              DiskBox[3, 0.02261146496815286]}}]],
         MouseAppearanceTag["NetworkGraphics"]],
        AllowKernelInitialization->False]],
      DefaultBaseStyle->{
       "NetworkGraphics", FrontEnd`GraphicsHighlightColor -> 
        Hue[0.8, 1., 0.6]},
      FormatType->TraditionalForm,
      FrameTicks->None]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{3.82505284222985*^9, 3.82505291178374*^9, 
  3.825052974627605*^9},
 CellLabel->"Out[45]=",ExpressionUUID->"4a13cd87-d37c-4dd3-b3a2-6f2183b44884"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ftest", "=", 
  RowBox[{"FindShortestPath", "[", 
   RowBox[{"globalgraph", ",", "1", ",", "All"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.825053137760502*^9, 3.825053144469677*^9}, {
  3.8250532124385185`*^9, 3.825053265508643*^9}},
 CellLabel->"In[50]:=",ExpressionUUID->"55e1fa99-7819-4cf7-be8c-bdbee147eaac"],

Cell[BoxData[
 TagBox[
  RowBox[{"ShortestPathFunction", "[", 
   TagBox[
    RowBox[{"{", 
     RowBox[{"1", ",", "All"}], "}"}],
    Identity,
    Editable->False,
    Selectable->True], ",", 
   RowBox[{"\[LeftSkeleton]", "\[RightSkeleton]"}], "]"}],
  InterpretTemplate[
  ShortestPathFunction[#, {
    1, {1, 2, 3, 4, 5}, {{1, 2, 3, 4, 5}}, {{{0, 0, 1, 1, 1}, {0, 0, 1, 0, 
     0}, {0, 0, 0, 0, 0}, {0, 0, 0, 0, 0}, {0, 0, 0, 0, 0}}}}]& ],
  Editable->False,
  SelectWithContents->True,
  Selectable->True]], "Output",
 CellChangeTimes->{{3.8250532245547605`*^9, 3.8250532658244925`*^9}},
 CellLabel->"Out[50]=",ExpressionUUID->"4daf376b-92cd-4d57-a8fb-7a25163bbc43"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ftest", "/@", 
  RowBox[{"VertexList", "[", "globalgraph", "]"}]}]], "Input",
 CellChangeTimes->{{3.825053267327324*^9, 3.8250532781827784`*^9}},
 CellLabel->"In[51]:=",ExpressionUUID->"c6145724-4aa6-4f93-9600-9ec95cbfcf06"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", "1", "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "3", ",", "2"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "3"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "4"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "5"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{3.8250532787163687`*^9},
 CellLabel->"Out[51]=",ExpressionUUID->"1813f673-1e6b-4e48-8147-e229636765f4"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"FindShortestPath", "[", 
   RowBox[{"globalgraph", ",", "1", ",", "All"}], "]"}], "/@", 
  RowBox[{"VertexList", "[", "globalgraph", "]"}]}]], "Input",
 CellChangeTimes->{3.825053295406648*^9},
 CellLabel->"In[52]:=",ExpressionUUID->"23f72dc8-57fb-412b-847e-ba12062d4603"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", "1", "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "3", ",", "2"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "3"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "4"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "5"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{3.825053296392245*^9},
 CellLabel->"Out[52]=",ExpressionUUID->"031d82c9-e8c5-471e-86c2-be41ca357d35"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"FindShortestPath", "[", 
      RowBox[{"#", ",", "i", ",", "j"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", 
       RowBox[{"VertexList", "[", "#", "]"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", 
       RowBox[{"VertexList", "[", "#", "]"}]}], "}"}]}], "]"}], "&"}], "@", 
  "globalgraph"}]], "Input",
 CellChangeTimes->{{3.825053419826663*^9, 3.8250534633695116`*^9}},
 CellLabel->"In[54]:=",ExpressionUUID->"f9256f8b-c36a-4d85-a45e-462ed8c55f5f"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", "1", "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "3", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "3"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "4"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "5"}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"2", ",", "3", ",", "1"}], "}"}], ",", 
     RowBox[{"{", "2", "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"2", ",", "3"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"2", ",", "4"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"2", ",", "5"}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"3", ",", "1"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "2"}], "}"}], ",", 
     RowBox[{"{", "3", "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "1", ",", "4"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "1", ",", "5"}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"4", ",", "1"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"4", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"4", ",", "1", ",", "3"}], "}"}], ",", 
     RowBox[{"{", "4", "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"4", ",", "1", ",", "5"}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"5", ",", "1"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"5", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"5", ",", "1", ",", "3"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"5", ",", "1", ",", "4"}], "}"}], ",", 
     RowBox[{"{", "5", "}"}]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{3.8250534636690826`*^9},
 CellLabel->"Out[54]=",ExpressionUUID->"b37f0950-dbe1-47e1-afe0-bcd771d1ebd2"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"FindHamiltonianCycle", "[", "globalgraph", "]"}]], "Input",
 CellChangeTimes->{{3.8250545351684756`*^9, 3.825054543344762*^9}},
 CellLabel->"In[56]:=",ExpressionUUID->"c7a79331-08a9-47f1-a690-f6ca8a81972a"],

Cell[BoxData[
 RowBox[{"{", "}"}]], "Output",
 CellChangeTimes->{3.8250545436105127`*^9},
 CellLabel->"Out[56]=",ExpressionUUID->"929dccdd-58b6-40b8-be53-0719fbca76c3"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"AdjacencyMatrix", "@", "globalgraph"}], "//", "Normal"}], "//", 
  "MatrixForm"}]], "Input",
 CellChangeTimes->{{3.825054828488126*^9, 3.8250548460911546`*^9}, {
  3.8250550621039143`*^9, 3.825055064557308*^9}},
 CellLabel->"In[63]:=",ExpressionUUID->"ba94c573-dba9-4526-b350-bdd4b40ff2d6"],

Cell[BoxData[
 TagBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {"0", "0", "1", "1", "1"},
     {"0", "0", "1", "1", "1"},
     {"1", "1", "0", "0", "0"},
     {"1", "1", "0", "0", "0"},
     {"1", "1", "0", "0", "0"}
    },
    GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}}], "\[NoBreak]", ")"}],
  Function[BoxForm`e$, 
   MatrixForm[BoxForm`e$]]]], "Output",
 CellChangeTimes->{{3.825054834877595*^9, 3.8250548463509197`*^9}, 
   3.82505506484191*^9},
 CellLabel->
  "Out[63]//MatrixForm=",ExpressionUUID->"ffef1553-f6ae-44e9-899b-\
0f1a1157c5cb"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"Subsets", "[", 
   RowBox[{
    RowBox[{"Range", "[", "10", "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"1", ",", "9"}], "}"}]}], "]"}], "//", "Length"}]], "Input",
 CellChangeTimes->{{3.825054904035839*^9, 3.8250549435724106`*^9}},
 CellLabel->"In[62]:=",ExpressionUUID->"b4212992-f5ed-47f0-a267-ca216df77dc9"],

Cell[BoxData["1022"], "Output",
 CellChangeTimes->{{3.825054916228986*^9, 3.825054943864671*^9}},
 CellLabel->"Out[62]=",ExpressionUUID->"c57672ee-57ee-43bc-ad0a-86c1971239ad"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ConstantArray", "[", 
  RowBox[{"0", ",", 
   RowBox[{"{", 
    RowBox[{"3", ",", "5"}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.825055187587507*^9, 3.8250551987444763`*^9}},
 CellLabel->"In[66]:=",ExpressionUUID->"b4c36b18-6cad-4f26-8332-93108dcbbb9b"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0"}], "}"}]}], 
  "}"}]], "Output",
 CellChangeTimes->{{3.8250551946778593`*^9, 3.825055199252652*^9}},
 CellLabel->"Out[66]=",ExpressionUUID->"a9c1819f-c761-4549-aaa3-1e05b38a440a"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"GraphPlot", "[", 
  RowBox[{"globalgraph", ",", 
   RowBox[{"VertexLabels", "\[Rule]", "\"\<Name\>\""}]}], "]"}]], "Input",
 CellChangeTimes->{{3.8250562437685757`*^9, 3.8250562596788473`*^9}},
 CellLabel->"In[74]:=",ExpressionUUID->"2a9c5a6e-0ad8-405b-ac05-d99506333af0"],

Cell[BoxData[
 GraphicsBox[{
   {Hue[0.6, 0.7, 0.5], Opacity[0.7], Arrowheads[0.], 
    ArrowBox[{{{0.9319886632888627, 0.9500291778062808}, {1.6531984111753333`,
      0.}}, {{0.9319886632888627, 0.9500291778062808}, {1.6521923265216456`, 
     1.2180609008634637`}}, {{0.9319886632888627, 0.9500291778062808}, {0., 
     0.6089078298680417}}, {{0.9309630625745587, 0.26670502944411556`}, {
     1.6531984111753333`, 0.}}, {{0.9309630625745587, 0.26670502944411556`}, {
     1.6521923265216456`, 1.2180609008634637`}}, {{0.9309630625745587, 
     0.26670502944411556`}, {0., 0.6089078298680417}}}, 
     0.019733983340941258`]}, 
   {Hue[0.6, 0.2, 0.8], EdgeForm[{GrayLevel[0], Opacity[
    0.7]}], {DiskBox[{0.9319886632888627, 0.9500291778062808}, 
      0.019733983340941258], 
     InsetBox["1", Offset[{2, 2}, {0.9517226466298039, 0.969763161147222}], 
      ImageScaled[{0, 0}],
      BaseStyle->"Graphics"]}, {
     DiskBox[{0.9309630625745587, 0.26670502944411556}, 0.019733983340941258],
      InsetBox["2", Offset[{2, 2}, {0.9506970459155, 0.2864390127850568}], 
      ImageScaled[{0, 0}],
      BaseStyle->"Graphics"]}, {
     DiskBox[{1.6531984111753333, 0.}, 0.019733983340941258], 
     InsetBox["3", Offset[{2, 2}, {1.6729323945162746, 0.019733983340941258}],
       ImageScaled[{0, 0}],
      BaseStyle->"Graphics"]}, {
     DiskBox[{1.6521923265216456, 1.2180609008634637}, 0.019733983340941258], 
     InsetBox["4", Offset[{2, 2}, {1.671926309862587, 1.237794884204405}], 
      ImageScaled[{0, 0}],
      BaseStyle->"Graphics"]}, {
     DiskBox[{0., 0.6089078298680417}, 0.019733983340941258], 
     InsetBox["5", Offset[{2, 2}, {0.019733983340941258, 0.6286418132089829}],
       ImageScaled[{0, 0}],
      BaseStyle->"Graphics"]}}},
  FormatType->TraditionalForm,
  FrameTicks->None]], "Output",
 CellChangeTimes->{{3.8250562523747654`*^9, 3.825056260286315*^9}},
 CellLabel->"Out[74]=",ExpressionUUID->"75f08936-97cc-4a7f-9168-6e73fa40e25a"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["And again", "Subsubsection",
 CellChangeTimes->{{3.8250568742234583`*^9, 
  3.8250568758547144`*^9}},ExpressionUUID->"7492f296-7fec-4e4a-bd74-\
debbda1683b0"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Block", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
    "exp", ",", "ag", ",", "sq", ",", "len", ",", "lenag", ",", "lensq", ",", 
     "graph", ",", "agconnections"}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"exp", "=", "test"}], ";", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{"Split", " ", "square", " ", "from", " ", 
      RowBox[{"angles", ".", " ", "The"}], " ", "expression", " ", "comes", 
      " ", "from", " ", "a", " ", "Times", " ", "so", " ", "it", " ", "will", 
      " ", "already", " ", "be", " ", "ordered", " ", "with", " ", "angles", 
      " ", "first"}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ag", ",", "sq"}], "}"}], "=", 
     RowBox[{"SplitBy", "[", 
      RowBox[{"exp", ",", "Head"}], "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"len", "=", 
     RowBox[{"Length", "[", "exp", "]"}]}], ";", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
     "lenag", " ", "and", " ", "lensq", " ", "will", " ", "be", " ", "used", 
      " ", "as", " ", "an", " ", "offset", " ", "later"}], "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{"lenag", "=", 
     RowBox[{"Length", "[", "ag", "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"lensq", "=", 
     RowBox[{"Length", "[", "sq", "]"}]}], ";", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
     "For", " ", "each", " ", "angle", " ", "bracket", " ", "we", " ", "find",
       " ", "with", " ", "which", " ", "square", " ", "brackect", " ", "it", 
      " ", "can", " ", "be", " ", "connected", " ", "and", " ", "select", " ",
       "a", " ", "type", " ", "of", " ", 
      RowBox[{"connection", ":", " ", 
       RowBox[{"1", "-", 
        RowBox[{
         RowBox[{
          RowBox[{"\[LeftAngleBracket]", "i_", "\[RightAngleBracket]"}], "[", 
          "i_", "]"}], " ", "2"}], "-", 
        RowBox[{
         RowBox[{
          RowBox[{"\[LeftAngleBracket]", "_i", "\[RightAngleBracket]"}], "[", 
          "i_", "]"}], " ", "3"}], "-", 
        RowBox[{
         RowBox[{
          RowBox[{"\[LeftAngleBracket]", "i_", "\[RightAngleBracket]"}], "[", 
          "_i", "]"}], " ", "4"}], "-", 
        RowBox[{
         RowBox[{"\[LeftAngleBracket]", "_i", "\[RightAngleBracket]"}], "[", 
         "_i", "]"}]}]}]}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{"agconnections", "=", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"i", ",", "j"}], "}"}], ",", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"FreeQ", "[", 
            RowBox[{"i", ",", 
             RowBox[{"Alternatives", "@@", "j"}]}], "]"}], ",", "0", ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Which", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"First", "@@", "i"}], "===", 
              RowBox[{"First", "@@", "j"}]}], ",", "\[IndentingNewLine]", "1",
              ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Last", "@@", "i"}], "===", 
              RowBox[{"First", "@@", "j"}]}], ",", "\[IndentingNewLine]", "2",
              ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"First", "@@", "i"}], "===", 
              RowBox[{"Last", "@@", "j"}]}], ",", "\[IndentingNewLine]", "3", 
             ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Last", "@@", "i"}], "===", 
              RowBox[{"Last", "@@", "j"}]}], ",", "\[IndentingNewLine]", 
             "4"}], "]"}]}], "]"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "ag"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"j", ",", "sq"}], "}"}]}], "]"}]}]}]}], "\[IndentingNewLine]",
   "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}]], "Input",
 CellChangeTimes->{{3.8250489430100217`*^9, 3.825048947557375*^9}, {
   3.825049006710558*^9, 3.825049074556138*^9}, {3.8250491522231135`*^9, 
   3.825049205602866*^9}, {3.8250493818461633`*^9, 3.825049814208542*^9}, {
   3.825049852800672*^9, 3.8250498620017524`*^9}, {3.8250499163703876`*^9, 
   3.8250499500710087`*^9}, {3.82504998443499*^9, 3.825050003109603*^9}, {
   3.8250500743860774`*^9, 3.825050100389584*^9}, {3.825050130990181*^9, 
   3.825050131387205*^9}, {3.825050177893777*^9, 3.8250502022576065`*^9}, {
   3.8250506517982974`*^9, 3.825050746326376*^9}, {3.8250507938855376`*^9, 
   3.825050812487685*^9}, {3.8250508531843452`*^9, 3.82505086522179*^9}, {
   3.8250509146979876`*^9, 3.8250509157083936`*^9}, {3.825050983177038*^9, 
   3.8250509994868546`*^9}, {3.825051208589814*^9, 3.825051275511667*^9}, {
   3.8250513206147437`*^9, 3.8250513872885685`*^9}, {3.8250516078658533`*^9, 
   3.8250516136252956`*^9}, {3.8250517664954624`*^9, 3.825051770127508*^9}, {
   3.8250518206059294`*^9, 3.825051846123903*^9}, {3.825051925183688*^9, 
   3.8250519275589724`*^9}, {3.8250523483729095`*^9, 3.825052352449723*^9}, {
   3.825052392481635*^9, 3.8250523984448338`*^9}, {3.825052437336427*^9, 
   3.825052465391181*^9}, {3.825052497635206*^9, 3.8250525056443415`*^9}, {
   3.8250551240297585`*^9, 3.8250551605496454`*^9}, {3.8250552065227757`*^9, 
   3.825055268474984*^9}, {3.8250553032400627`*^9, 3.8250553584779854`*^9}, {
   3.8250554520502043`*^9, 3.8250554584306774`*^9}, {3.8250568876223726`*^9, 
   3.8250569216665773`*^9}, {3.8250569521675706`*^9, 
   3.8250572563337326`*^9}, {3.825057292260063*^9, 3.8250573347399244`*^9}, {
   3.8250573988193245`*^9, 3.825057426549227*^9}, {3.8250575039894767`*^9, 
   3.825057547678561*^9}, {3.8250584744833565`*^9, 3.8250585884666815`*^9}, {
   3.8250586195851507`*^9, 3.8250586803500257`*^9}, {3.8250587510630064`*^9, 
   3.8250587826576185`*^9}, {3.8250588587907867`*^9, 3.825058975926443*^9}, {
   3.8250590102593994`*^9, 3.8250590420204487`*^9}, {3.825059072835971*^9, 
   3.825059151716*^9}, {3.8250592213129067`*^9, 3.8250592218494177`*^9}, 
   3.8250592921943245`*^9},
 CellLabel->"In[93]:=",ExpressionUUID->"0399fcfc-8836-4525-ae74-153f9da49bc4"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         TemplateBox[{"1", "2"},
          "SpinorAngleBracket",
          DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
             RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
          InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
             RowBox[{#, ",", #2}], "]"}]& )], ",", 
         TemplateBox[{"1", "4"},
          "SpinorSquareBracket",
          DisplayFunction->(RowBox[{"[", 
             RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
          InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
             RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", "Null"}], "}"}], 
     ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         TemplateBox[{"1", "2"},
          "SpinorAngleBracket",
          DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
             RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
          InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
             RowBox[{#, ",", #2}], "]"}]& )], ",", 
         TemplateBox[{"2", "3"},
          "SpinorSquareBracket",
          DisplayFunction->(RowBox[{"[", 
             RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
          InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
             RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", "Null"}], "}"}], 
     ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         TemplateBox[{"1", "2"},
          "SpinorAngleBracket",
          DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
             RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
          InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
             RowBox[{#, ",", #2}], "]"}]& )], ",", 
         TemplateBox[{"2", "4"},
          "SpinorSquareBracket",
          DisplayFunction->(RowBox[{"[", 
             RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
          InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
             RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", "Null"}], "}"}]}],
     "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         TemplateBox[{"3", "4"},
          "SpinorAngleBracket",
          DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
             RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
          InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
             RowBox[{#, ",", #2}], "]"}]& )], ",", 
         TemplateBox[{"1", "4"},
          "SpinorSquareBracket",
          DisplayFunction->(RowBox[{"[", 
             RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
          InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
             RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", "1"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         TemplateBox[{"3", "4"},
          "SpinorAngleBracket",
          DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
             RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
          InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
             RowBox[{#, ",", #2}], "]"}]& )], ",", 
         TemplateBox[{"2", "3"},
          "SpinorSquareBracket",
          DisplayFunction->(RowBox[{"[", 
             RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
          InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
             RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", "Null"}], "}"}], 
     ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         TemplateBox[{"3", "4"},
          "SpinorAngleBracket",
          DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
             RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
          InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
             RowBox[{#, ",", #2}], "]"}]& )], ",", 
         TemplateBox[{"2", "4"},
          "SpinorSquareBracket",
          DisplayFunction->(RowBox[{"[", 
             RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
          InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
             RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", "1"}], "}"}]}], 
    "}"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.8250570975301065`*^9, 3.825057120904808*^9}, 
   3.8250572587099886`*^9, 3.8250573048645315`*^9, 3.8250574274958754`*^9, {
   3.8250575096190147`*^9, 3.8250575486257763`*^9}, 3.8250590428202524`*^9, {
   3.8250591294755154`*^9, 3.825059152710371*^9}, 3.825059240533489*^9, 
   3.8250592932115803`*^9},
 CellLabel->"Out[93]=",ExpressionUUID->"f4d826a4-5c1f-47cc-9bc1-d43d57d261e8"]
}, Open  ]],

Cell[BoxData[{
 RowBox[{"graph", "=", 
  RowBox[{"(", 
   RowBox[{"(", 
    RowBox[{"Join", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"PadLeft", "[", 
         RowBox[{"#", ",", 
          RowBox[{"2", "*", "len"}]}], "]"}], "&"}], "/@", 
       RowBox[{"(", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"FreeQ", "[", 
             RowBox[{"sq", ",", 
              RowBox[{"Alternatives", "@@", "j"}]}], "]"}], ",", "0", ",", 
            "1"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"j", ",", "ag"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "sq"}], "}"}]}], "]"}], ")"}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0", ",", 
        RowBox[{"{", 
         RowBox[{"lensq", ",", "len"}], "}"}]}], "]"}]}], "]"}], ")"}], 
   ")"}]}], "\[IndentingNewLine]", 
 RowBox[{"graph", "=", 
  RowBox[{
   RowBox[{"AdjacencyGraph", "@", 
    RowBox[{"Echo", "@", 
     RowBox[{"(", 
      RowBox[{"graph", "+", 
       RowBox[{"Transpose", "[", "graph", "]"}]}], ")"}]}]}], "//", 
   "Echo"}]}]}], "Input",
 CellChangeTimes->{{3.8250569549532084`*^9, 
  3.8250569747430162`*^9}},ExpressionUUID->"d636984d-00c9-4589-bc6a-\
fcb5dc25d27d"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Table", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"i", ",", "j"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"i", ",", "2"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"j", ",", 
     RowBox[{"{", 
      RowBox[{"a", ",", "b"}], "}"}]}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.825057338805893*^9, 3.8250573570244403`*^9}},
 CellLabel->"In[81]:=",ExpressionUUID->"ab71000f-b0d9-4454-8cb4-f2f31fc98e9d"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "a"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "b"}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"2", ",", "a"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"2", ",", "b"}], "}"}]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{3.8250573575686827`*^9},
 CellLabel->"Out[81]=",ExpressionUUID->"fd55b94e-f1f7-479f-94cb-c1bd1998a97e"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Which", "[", 
  RowBox[{
  "False", ",", "\[IndentingNewLine]", "1", ",", "\[IndentingNewLine]", 
   "True", ",", "\[IndentingNewLine]", "2"}], "\[IndentingNewLine]", 
  "]"}]], "Input",
 CellChangeTimes->{{3.8250592488950834`*^9, 3.8250592644843845`*^9}},
 CellLabel->"In[91]:=",ExpressionUUID->"2977a116-b1aa-4785-9339-41aa2fa0074d"],

Cell[BoxData["2"], "Output",
 CellChangeTimes->{3.8250592590529118`*^9},
 CellLabel->"Out[91]=",ExpressionUUID->"8aa86add-49db-4d96-a7cd-c6bd389d3395"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Table", "[", 
  RowBox[{
   RowBox[{"Which", "[", 
    RowBox[{
    "False", ",", "\[IndentingNewLine]", "1", ",", "\[IndentingNewLine]", 
     "True", ",", "\[IndentingNewLine]", "2"}], "\[IndentingNewLine]", "]"}], 
   ",", 
   RowBox[{"{", 
    RowBox[{"i", ",", "4"}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.8250592683041697`*^9, 3.825059275853033*^9}},
 CellLabel->"In[92]:=",ExpressionUUID->"c9edb925-f131-48ab-933e-a930d863b390"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"2", ",", "2", ",", "2", ",", "2"}], "}"}]], "Output",
 CellChangeTimes->{3.8250592762120514`*^9},
 CellLabel->"Out[92]=",ExpressionUUID->"26556fbe-50f2-4801-8556-185850b0e61d"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Block", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
    "exp", ",", "ag", ",", "sq", ",", "len", ",", "lenag", ",", "lensq", ",", 
     "graph", ",", "agconnections", ",", "aglabs", ",", "sqlabs"}], "}"}], 
   ",", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"exp", "=", "test"}], ";", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{"Split", " ", "square", " ", "from", " ", 
      RowBox[{"angles", ".", " ", "The"}], " ", "expression", " ", "comes", 
      " ", "from", " ", "a", " ", "Times", " ", "so", " ", "it", " ", "will", 
      " ", "already", " ", "be", " ", "ordered", " ", "with", " ", "angles", 
      " ", "first"}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ag", ",", "sq"}], "}"}], "=", 
     RowBox[{"SplitBy", "[", 
      RowBox[{"exp", ",", "Head"}], "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"len", "=", 
     RowBox[{"Length", "[", "exp", "]"}]}], ";", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
     "lenag", " ", "and", " ", "lensq", " ", "will", " ", "be", " ", "used", 
      " ", "as", " ", "an", " ", "offset", " ", "later"}], "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{"lenag", "=", 
     RowBox[{"Length", "[", "ag", "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"lensq", "=", 
     RowBox[{"Length", "[", "sq", "]"}]}], ";", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"aglabs", "=", 
     RowBox[{"Flatten", "[", 
      RowBox[{"List", "@@@", "ag"}], "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"sqlabs", "=", 
     RowBox[{"Flatten", "[", 
      RowBox[{"List", "@@@", "sq"}], "]"}]}], ";", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"i", ",", "j"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "ag"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"j", ",", "sq"}], "}"}]}], "]"}], "//", "Echo"}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"aglabs", ",", "sqlabs"}], "}"}], "//", "Echo"}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"Partition", "[", 
       RowBox[{"#", ",", "2"}], "]"}], "&"}], "@", 
     RowBox[{"Echo", "@", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"Partition", "[", 
          RowBox[{"#", ",", "2"}], "]"}], "&"}], "/@", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"PadLeft", "[", 
            RowBox[{"#", ",", 
             RowBox[{"2", "*", "len"}]}], "]"}], "&"}], "/@", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"i", "===", "j"}], ",", "1", ",", "0"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "aglabs"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "sqlabs"}], "}"}]}], "]"}]}], ")"}]}], 
       ")"}]}]}]}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "]"}]], "Input",
 CellChangeTimes->{{3.8250489430100217`*^9, 3.825048947557375*^9}, {
   3.825049006710558*^9, 3.825049074556138*^9}, {3.8250491522231135`*^9, 
   3.825049205602866*^9}, {3.8250493818461633`*^9, 3.825049814208542*^9}, {
   3.825049852800672*^9, 3.8250498620017524`*^9}, {3.8250499163703876`*^9, 
   3.8250499500710087`*^9}, {3.82504998443499*^9, 3.825050003109603*^9}, {
   3.8250500743860774`*^9, 3.825050100389584*^9}, {3.825050130990181*^9, 
   3.825050131387205*^9}, {3.825050177893777*^9, 3.8250502022576065`*^9}, {
   3.8250506517982974`*^9, 3.825050746326376*^9}, {3.8250507938855376`*^9, 
   3.825050812487685*^9}, {3.8250508531843452`*^9, 3.82505086522179*^9}, {
   3.8250509146979876`*^9, 3.8250509157083936`*^9}, {3.825050983177038*^9, 
   3.8250509994868546`*^9}, {3.825051208589814*^9, 3.825051275511667*^9}, {
   3.8250513206147437`*^9, 3.8250513872885685`*^9}, {3.8250516078658533`*^9, 
   3.8250516136252956`*^9}, {3.8250517664954624`*^9, 3.825051770127508*^9}, {
   3.8250518206059294`*^9, 3.825051846123903*^9}, {3.825051925183688*^9, 
   3.8250519275589724`*^9}, {3.8250523483729095`*^9, 3.825052352449723*^9}, {
   3.825052392481635*^9, 3.8250523984448338`*^9}, {3.825052437336427*^9, 
   3.825052465391181*^9}, {3.825052497635206*^9, 3.8250525056443415`*^9}, {
   3.8250551240297585`*^9, 3.8250551605496454`*^9}, {3.8250552065227757`*^9, 
   3.825055268474984*^9}, {3.8250553032400627`*^9, 3.8250553584779854`*^9}, {
   3.8250554520502043`*^9, 3.8250554584306774`*^9}, {3.8250568876223726`*^9, 
   3.8250569216665773`*^9}, {3.8250569521675706`*^9, 
   3.8250572563337326`*^9}, {3.825057292260063*^9, 3.8250573347399244`*^9}, {
   3.8250573988193245`*^9, 3.825057426549227*^9}, {3.8250575039894767`*^9, 
   3.825057547678561*^9}, {3.8250584744833565`*^9, 3.8250585884666815`*^9}, {
   3.8250586195851507`*^9, 3.8250586803500257`*^9}, {3.8250587510630064`*^9, 
   3.8250587826576185`*^9}, {3.8250588587907867`*^9, 3.825058975926443*^9}, {
   3.8250590102593994`*^9, 3.8250590420204487`*^9}, {3.825059072835971*^9, 
   3.825059151716*^9}, {3.8250592213129067`*^9, 3.8250592218494177`*^9}, 
   3.8250592921943245`*^9, {3.825059371246891*^9, 3.82505952998129*^9}, {
   3.8250595739407206`*^9, 3.825059661283098*^9}, {3.8250632939359894`*^9, 
   3.8250633046154227`*^9}, {3.825063602080234*^9, 3.8250636044698462`*^9}, {
   3.825063637255968*^9, 3.8250636958213286`*^9}},
 CellLabel->
  "In[109]:=",ExpressionUUID->"81fa904d-2fd0-4a4a-b982-29a007b78313"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       TemplateBox[{"1", "2"},
        "SpinorAngleBracket",
        DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
           RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
        InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
           RowBox[{#, ",", #2}], "]"}]& )], ",", 
       TemplateBox[{"1", "4"},
        "SpinorSquareBracket",
        DisplayFunction->(RowBox[{"[", 
           RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
        InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
           RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       TemplateBox[{"1", "2"},
        "SpinorAngleBracket",
        DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
           RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
        InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
           RowBox[{#, ",", #2}], "]"}]& )], ",", 
       TemplateBox[{"2", "3"},
        "SpinorSquareBracket",
        DisplayFunction->(RowBox[{"[", 
           RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
        InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
           RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       TemplateBox[{"1", "2"},
        "SpinorAngleBracket",
        DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
           RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
        InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
           RowBox[{#, ",", #2}], "]"}]& )], ",", 
       TemplateBox[{"2", "4"},
        "SpinorSquareBracket",
        DisplayFunction->(RowBox[{"[", 
           RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
        InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
           RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       TemplateBox[{"3", "4"},
        "SpinorAngleBracket",
        DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
           RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
        InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
           RowBox[{#, ",", #2}], "]"}]& )], ",", 
       TemplateBox[{"1", "4"},
        "SpinorSquareBracket",
        DisplayFunction->(RowBox[{"[", 
           RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
        InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
           RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       TemplateBox[{"3", "4"},
        "SpinorAngleBracket",
        DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
           RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
        InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
           RowBox[{#, ",", #2}], "]"}]& )], ",", 
       TemplateBox[{"2", "3"},
        "SpinorSquareBracket",
        DisplayFunction->(RowBox[{"[", 
           RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
        InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
           RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       TemplateBox[{"3", "4"},
        "SpinorAngleBracket",
        DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
           RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
        InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
           RowBox[{#, ",", #2}], "]"}]& )], ",", 
       TemplateBox[{"2", "4"},
        "SpinorSquareBracket",
        DisplayFunction->(RowBox[{"[", 
           RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
        InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
           RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.825063696374884*^9},ExpressionUUID->"f611ebf3-5b12-4c5e-99ec-\
1e1670463b33"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"1", ",", "2", ",", "3", ",", "4"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "4", ",", "2", ",", "3", ",", "2", ",", "4"}], "}"}]}], 
  "}"}]], "Echo",
 CellChangeTimes->{
  3.825063696448651*^9},ExpressionUUID->"ed373433-3758-41ae-83fd-\
d7a3909cb381"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"0", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0"}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"0", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "0"}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"0", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "1"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0"}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"0", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "1"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "1"}], "}"}]}], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.825063696521454*^9},ExpressionUUID->"026e2f3a-317c-421f-84e3-\
cf78c66ee8a3"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"0", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"0", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "0"}], "}"}]}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"0", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"0", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "1"}], "}"}]}], "}"}]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.8250596432812386`*^9, 3.8250596617977133`*^9}, 
   3.8250633055878153`*^9, 3.8250636053684225`*^9, {3.82506364640054*^9, 
   3.8250636965673723`*^9}},
 CellLabel->
  "Out[109]=",ExpressionUUID->"bb856093-e364-42f9-9406-40e5616ffbe9"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["With weighted graphs", "Subsubsection",
 CellChangeTimes->{{3.8250643762387094`*^9, 
  3.8250643806719017`*^9}},ExpressionUUID->"c83b9bc8-a889-43db-b670-\
8aef81875226"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "Use", " ", "weighted", " ", "adjaciency", " ", "matrices", " ", "with", 
   " ", "weight", " ", "corresponding", " ", "to", " ", "type", " ", "of", 
   " ", "connection"}], "*)"}]], "Input",
 CellChangeTimes->{{3.825064386948063*^9, 3.825064397076027*^9}, {
  3.8250644714757333`*^9, 
  3.825064484828019*^9}},ExpressionUUID->"66da2c89-867b-4535-b1a4-\
c325a408131b"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
   "I", " ", "do", " ", "not", " ", "know", " ", "why", " ", "but", " ", 
    "when", " ", "building", " ", "the", " ", "graph", " ", "from", " ", 
    "the", " ", "weighted", " ", "adjaciency", " ", "matrix"}], ",", " ", 
   RowBox[{
    RowBox[{
    "you", " ", "need", " ", "to", " ", "put", " ", "\[Infinity]", " ", 
     "where", " ", "I", " ", "wuold", " ", "usually", " ", "put", " ", 
     "zero"}], "..."}]}], "*)"}]], "Input",
 CellChangeTimes->{{3.8250762678514533`*^9, 
  3.8250763098169603`*^9}},ExpressionUUID->"37f5f5a3-5ebf-4f62-a618-\
0525010afe2f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"weight", "[", 
   RowBox[{
    RowBox[{"SpinorAngleBracket", "[", 
     RowBox[{"i_", ",", "j_"}], "]"}], ",", 
    RowBox[{"SpinorSquareBracket", "[", 
     RowBox[{"k_", ",", "l_"}], "]"}]}], "]"}], ":=", 
  RowBox[{"Which", "[", 
   RowBox[{
    RowBox[{"i", "===", "k"}], ",", "1", ",", 
    RowBox[{"j", "===", "k"}], ",", "2", ",", 
    RowBox[{"i", "===", "l"}], ",", "3", ",", 
    RowBox[{"j", "===", "l"}], ",", "4", ",", "True", ",", "0"}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.8250644946716385`*^9, 3.8250645200995827`*^9}, {
  3.8250645558758936`*^9, 3.8250645630097585`*^9}, {3.825064598189665*^9, 
  3.8250646008386283`*^9}, {3.825064667152217*^9, 3.82506468399123*^9}, {
  3.825066619028162*^9, 3.8250666221787367`*^9}},
 CellLabel->
  "In[115]:=",ExpressionUUID->"79721707-eb73-40b9-a830-995d55f3d369"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"weight", "[", 
  RowBox[{
   TemplateBox[{"1", "4"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"2", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}], "]"}]], "Input",
 CellChangeTimes->{{3.825064688281702*^9, 3.825064711684161*^9}, {
  3.8250647549474483`*^9, 3.8250647708977857`*^9}},
 CellLabel->
  "In[114]:=",ExpressionUUID->"996b7989-76e6-4183-873d-58212c93e04c"],

Cell[BoxData["4"], "Output",
 CellChangeTimes->{{3.82506470125504*^9, 3.825064713155203*^9}, {
  3.825064755797165*^9, 3.8250647712707343`*^9}},
 CellLabel->
  "Out[114]=",ExpressionUUID->"3f2af635-7f27-4a15-906f-e3ae1f44c762"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"weight", "[", 
   RowBox[{
    TemplateBox[{"1", "2"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"3", "4"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )]}], "]"}], "//", 
  "RepeatedTiming"}]], "Input",
 CellChangeTimes->{{3.8250666257811007`*^9, 3.825066629866088*^9}, {
  3.8250717011601768`*^9, 3.8250717183961334`*^9}},
 CellLabel->
  "In[117]:=",ExpressionUUID->"33c4c1ec-2c72-4db9-82a6-da91682611b2"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"1.6633695602416993`*^-6", ",", "0"}], "}"}]], "Output",
 CellChangeTimes->{{3.8250717145384507`*^9, 3.8250717204934683`*^9}},
 CellLabel->
  "Out[117]=",ExpressionUUID->"f76af337-ca56-4379-a2d2-01156f7cc90a"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Block", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
    "exp", ",", "ag", ",", "sq", ",", "len", ",", "lenag", ",", "lensq", ",", 
     "graph", ",", "allpartitions", ",", "range"}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"exp", "=", "test"}], ";", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{"Split", " ", "square", " ", "from", " ", 
      RowBox[{"angles", ".", " ", "The"}], " ", "expression", " ", "comes", 
      " ", "from", " ", "a", " ", "Times", " ", "so", " ", "it", " ", "will", 
      " ", "already", " ", "be", " ", "ordered", " ", "with", " ", "angles", 
      " ", "first"}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ag", ",", "sq"}], "}"}], "=", 
     RowBox[{"SplitBy", "[", 
      RowBox[{"exp", ",", "Head"}], "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"len", "=", 
     RowBox[{"Length", "[", "exp", "]"}]}], ";", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
     "lenag", " ", "and", " ", "lensq", " ", "will", " ", "be", " ", "used", 
      " ", "as", " ", "an", " ", "offset", " ", "later"}], "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{"lenag", "=", 
     RowBox[{"Length", "[", "ag", "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"lensq", "=", 
     RowBox[{"Length", "[", "sq", "]"}]}], ";", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"graph", "=", 
     RowBox[{"(", 
      RowBox[{"(", 
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"PadLeft", "[", 
            RowBox[{"#", ",", "len"}], "]"}], "&"}], "/@", 
          RowBox[{"(", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"weight", "[", 
              RowBox[{"j", ",", "i"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"j", ",", "ag"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "sq"}], "}"}]}], "]"}], ")"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{"0", ",", 
           RowBox[{"{", 
            RowBox[{"lensq", ",", "len"}], "}"}]}], "]"}]}], "]"}], ")"}], 
      ")"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"graph", "=", 
     RowBox[{
      RowBox[{"WeightedAdjacencyGraph", "@", 
       RowBox[{"Echo", "@", 
        RowBox[{"(", 
         RowBox[{"graph", "+", 
          RowBox[{"Transpose", "[", "graph", "]"}]}], ")"}]}]}], "//", 
      "Echo"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"globalgraph", "=", "graph"}], ";", "\[IndentingNewLine]", 
    RowBox[{"range", "=", 
     RowBox[{"Range", "[", "len", "]"}]}], ";"}]}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellChangeTimes->{{3.8250489430100217`*^9, 3.825048947557375*^9}, {
   3.825049006710558*^9, 3.825049074556138*^9}, {3.8250491522231135`*^9, 
   3.825049205602866*^9}, {3.8250493818461633`*^9, 3.825049814208542*^9}, {
   3.825049852800672*^9, 3.8250498620017524`*^9}, {3.8250499163703876`*^9, 
   3.8250499500710087`*^9}, {3.82504998443499*^9, 3.825050003109603*^9}, {
   3.8250500743860774`*^9, 3.825050100389584*^9}, {3.825050130990181*^9, 
   3.825050131387205*^9}, {3.825050177893777*^9, 3.8250502022576065`*^9}, {
   3.8250506517982974`*^9, 3.825050746326376*^9}, {3.8250507938855376`*^9, 
   3.825050812487685*^9}, {3.8250508531843452`*^9, 3.82505086522179*^9}, {
   3.8250509146979876`*^9, 3.8250509157083936`*^9}, {3.825050983177038*^9, 
   3.8250509994868546`*^9}, {3.825051208589814*^9, 3.825051275511667*^9}, {
   3.8250513206147437`*^9, 3.8250513872885685`*^9}, {3.8250516078658533`*^9, 
   3.8250516136252956`*^9}, {3.8250517664954624`*^9, 3.825051770127508*^9}, {
   3.8250518206059294`*^9, 3.825051846123903*^9}, {3.825051925183688*^9, 
   3.8250519275589724`*^9}, {3.8250523483729095`*^9, 3.825052352449723*^9}, {
   3.825052392481635*^9, 3.8250523984448338`*^9}, {3.825052437336427*^9, 
   3.825052465391181*^9}, {3.825052497635206*^9, 3.8250525056443415`*^9}, {
   3.8250551240297585`*^9, 3.8250551605496454`*^9}, {3.8250552065227757`*^9, 
   3.825055268474984*^9}, {3.8250553032400627`*^9, 3.8250553584779854`*^9}, {
   3.8250554520502043`*^9, 3.8250554584306774`*^9}, {3.8250717449311457`*^9, 
   3.8250717647580194`*^9}, {3.8250763235261602`*^9, 
   3.8250763491618614`*^9}, {3.8250764189852667`*^9, 3.825076423588516*^9}, 
   3.825076764288974*^9},
 CellLabel->
  "In[155]:=",ExpressionUUID->"be5312eb-5d8c-42c2-bc48-e0bd48051e5d"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"0", ",", "0", ",", "1", ",", "2", ",", "2"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "0", ",", "4", ",", "3", ",", "4"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "4", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"2", ",", "3", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"2", ",", "4", ",", "0", ",", "0", ",", "0"}], "}"}]}], 
  "}"}]], "Echo",
 CellChangeTimes->{
  3.8250764277967033`*^9},ExpressionUUID->"16fa7437-c8df-49ff-9201-\
d9c532351125"],

Cell[BoxData[
 GraphicsBox[
  NamespaceBox["NetworkGraphics",
   DynamicModuleBox[{Typeset`graph = HoldComplete[
     Graph[{1, 2, 3, 4, 5}, {
      Null, SparseArray[
       Automatic, {5, 5}, 0, {
        1, {{0, 5, 9, 12, 14, 15}, {{1}, {2}, {3}, {4}, {5}, {2}, {3}, {4}, {
          5}, {3}, {4}, {5}, {4}, {5}, {5}}}, {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 
         1, 1, 1, 1, 1}}]}, {
      EdgeWeight -> {0, 0, 1, 2, 2, 0, 4, 3, 4, 0, 0, 0, 0, 0, 0}}]]}, 
    TagBox[GraphicsGroupBox[GraphicsComplexBox[CompressedData["
1:eJw9lHk01XkDxg3DqMiSrWSpbqEuTahk3uZB3hSjSE0qIyNbk2gxk0FN2Un2
VBSNLTW3DSnr13IzJS9usovrZnfx6y5ctzC957znfc55znPO59/nOc8ad/8D
npISEhKBX/zftDJ0t4yJm0a1fKHhNrVY6E/rZLgvbYbE/+RcFGy+AD60XFlS
pYYj/+f6odoe4xeGcdvLZIOBiINRwki57cWDy1sPh6j8aSj+xUg52RoPz2Jh
rHcrBZ/jXtEaxQVQVpGS8pz+iN3zD2i+0k9wvVo9NUCRj8B+i63eax+iy/Ze
tpeOAIMVf5LgbXdxYJ99/B8yQlAMhwSnqkhS1v5RuLVICFeTqEQF76fkihnv
yGP1GdyXlcxvNKkhy6YPpfZumoH91nRF2vcN5Ph02SGdKSHiyoxif41jkRvW
rW6nTgiRZpBZohfVRr4zXN7NThNg3Cw++lxlJ2mpDmsduclHo9+kwG2ymwjY
O3z6L/Jgy5C3XTLeQ4rSk3yDXT7ix6B0P72sHtLkc8WSZ0chU+OOTKVyN5Gp
M3a1YE5B0sRTK82jg4QzC6SunZhEiDllVvGmlfixj3aqJHNRc0HBV4PWTN4c
0liT58ZFiZKsXsrqevJG9c2iaSsXb34scMoJKCOP9LNkUtmTKFDcsnaxKZfI
nF4+tuH8NCSUrAOOrY/AWcaxiLxzzagOX+ayssedhAiDDE99egtnPZbUC9cH
5F2Z4ZC8eRtohvmqvMkKYnkmz2adTTt4ZkyLezZ/k9TgaEpVvh2BGU+6jm5s
IYPzdtxrie+Ql5LYQTv3jnBlYlcpUSwY0n65+sO6TkL/rNyuW9cIYb36Ekle
N1kVzf1N34WJfRMeu7Jye4ml/O4XoY9LoEIlNdtovCdmc9o7cgNTIHnMqaJ4
Vy/R54VdK83IJ6E2Bkr87d3EQTtxRXD0CzI86PJIWqeD0F8EOMoMVBPb6fU5
kWatZLn4J9dk7ToiN7l4eNX9/xDeeJIPu6mWFERUbQ1NZxJzq5CW+xQhK+u0
911aeE6qmwNzTz94RgTnqlvoutlE8foGD/XATEIdSfFvXB2GskLGOgP9bHQe
0xG2crIhG8x9LKdaDrMsb9rXSvdQG9NRdPP3egQ8Z9pxP93F0Npnrk1ZTbh8
eFhP5xt3sKQzYsTmfNw7b2pj+8MIXBsXIq7I8qF3/GbD6agxeB/sbdTW52Og
fkf4zN8TYERPbdl7gw9p6rv2vP5JbNPaI61mL4CfgT0VljON7l176ZS5EMlx
sQr3L1AwCspIqrOfQZ2mfNSOdxQiSsNHwv1n4TlemivDphC3fL3DTLQIe5Pv
qminU/ANLb4dHjaHIAbLWVOWQuLcaI+anRhc5uyek6emYBrTKPtXsxiFkaqV
qd5c7JKnSKbMJzi8XkZfaTQOY6bFnZgJMb6yc/fJ5Y5A3S626sZlMZY2tSxE
sYZgrKup/1PTHBJaZ1dKyg6CrhCatf6DCEFpDvEvizlY9dBdq5k1i+N4YCPL
H4Cugo377iczkB2hxR58O4C3R8prmNeFKBVId+49xMGsqZ0F/6YAmboDKt5n
P+CCIrFe2cRHSYmmGUdhCOkBNptD/s3HZE+2ZYjCCC6//8VnvtiJfK2retX2
yDD0jwpKd1+6S1RTPxsN7R/Ek9V7OG7+xcScrrUiO5uD6o2OKdm8GuJiuqRi
+vwAfot7bsR42kCKyne+VO1lw6/AeF86m0VCWDRHqxE2RiXt9G6YtJPARwJu
QuoA5BQLs76a6yIzj01F6u0cLGlIqTn5oZfc2jWvqpg8CEnnp4Qq6SOdDrm1
PbnDqOhnHFbb10+iO/akjHwYxZnNPX1lt/uIaKr4woo1E+Ce3b9V42kvORgY
0udpNAkVF/q9O4VdxDcwt7Z8YAqzovyN9X1txHlvnUBF7kvfeSemDMJZZLHh
k8DDhYKM6PGMm+g1CbNJrXA5RmFVkXL5a5saYhWlclFpyZc96Kgd/OxYRM7v
jFQ375zCt/b+E9V1d0igSQeDvnYSEpnaHlk5gLVtbZXWigm0LFe+ZbsuEqZH
rMRObaOQ+HbCev6lI/w6b6S3pQ1jfS49ar6Dg8TtcovxX/48yXhpQsotNqzM
c9wfxvPgd4AnOqH0Hmfkjl96Js0H01S9LSarC0Hpf6zWrOXDVKKBHKR14Fni
VUZNsQC3K/NpL962gaj2JBo3CBEfGZP86mUbfBe3vKJzZxDmknk/YaEd6w4U
Dp6WEiGgb75x5kQXFLpfFyTMiVDFOWzfwOzF91VV4tayOfC01N+3nWZj8YyB
bdl2MViJrXqODzhI2z/C2eklRpt0Q9bE2CA8IqTzcqzESHp6ue73hWF02Hv+
Wd88h92szTLWlaPwd/n463u1OcxuSZs9LzmOnZahWpUbROh9SekLisYxtt3C
rUB5FtLltFdRdeNwcvY6wKSEaM8ZE09tHsdMfFW6Y6cAiRkPIyWkx/CvPFNx
Uz8fuik/l5QcHcHo5JTbJk0+esVKC1ZOQ0hau3CHns5DheBi936ND9C7GHNp
kzcP/wDvCOSC
       "], {
        {Hue[0.6, 0.7, 0.5], Opacity[0.7], Arrowheads[0.], 
         ArrowBox[BezierCurveBox[{1, 9, 12, 14, 20, 22, 25, 1},
          SplineDegree->7], 0.015799942848996912`], 
         ArrowBox[{1, 2}, 0.015799942848996912`], 
         ArrowBox[{1, 3}, 0.015799942848996912`], 
         ArrowBox[{1, 4}, 0.015799942848996912`], 
         ArrowBox[{1, 5}, 0.015799942848996912`], 
         ArrowBox[BezierCurveBox[{2, 32, 35, 37, 43, 45, 48, 2},
          SplineDegree->7], 0.015799942848996912`], 
         ArrowBox[{2, 3}, 0.015799942848996912`], 
         ArrowBox[{2, 4}, 0.015799942848996912`], 
         ArrowBox[{2, 5}, 0.015799942848996912`], 
         ArrowBox[BezierCurveBox[{3, 55, 58, 60, 66, 68, 71, 3},
          SplineDegree->7], 0.015799942848996912`], 
         ArrowBox[{3, 4}, 0.015799942848996912`], 
         ArrowBox[{3, 5}, 0.015799942848996912`], 
         ArrowBox[BezierCurveBox[{4, 78, 81, 83, 89, 91, 94, 4},
          SplineDegree->7], 0.015799942848996912`], 
         ArrowBox[{4, 5}, 0.015799942848996912`], 
         ArrowBox[BezierCurveBox[{5, 101, 104, 106, 112, 114, 117, 5},
          SplineDegree->7], 0.015799942848996912`]}, 
        {Hue[0.6, 0.2, 0.8], EdgeForm[{GrayLevel[0], Opacity[0.7]}], 
         DiskBox[1, 0.015799942848996912], DiskBox[2, 0.015799942848996912], 
         DiskBox[3, 0.015799942848996912], DiskBox[4, 0.015799942848996912], 
         DiskBox[5, 0.015799942848996912]}}]],
     MouseAppearanceTag["NetworkGraphics"]],
    AllowKernelInitialization->False]],
  DefaultBaseStyle->{
   "NetworkGraphics", FrontEnd`GraphicsHighlightColor -> Hue[0.8, 1., 0.6]},
  FormatType->TraditionalForm,
  FrameTicks->None]], "Echo",
 CellChangeTimes->{
  3.82507642797606*^9},ExpressionUUID->"966da4b3-37c4-41c0-b33c-6072a09cf28a"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"GraphPlot", "[", 
  RowBox[{
   RowBox[{"WeightedAdjacencyGraph", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "1", ",", "2", ",", "2"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "4", ",", "3", ",", "4"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"1", ",", "4", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"2", ",", "3", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"2", ",", "4", ",", "0", ",", "0", ",", "0"}], "}"}]}], "}"}], 
    "]"}], ",", 
   RowBox[{"EdgeLabels", "\[Rule]", "\"\<Name\>\""}], ",", 
   RowBox[{"VertexLabels", "\[Rule]", "\"\<Name\>\""}]}], "]"}]], "Input",
 CellChangeTimes->{{3.8250718392634945`*^9, 3.825071874826806*^9}},
 CellLabel->
  "In[122]:=",ExpressionUUID->"f7240d0c-ddaa-4c74-8af0-529670ab2d75"],

Cell[BoxData[
 GraphicsBox[{
   {Hue[0.6, 0.7, 0.5], Opacity[0.7], {
     {Arrowheads[0.], 
      ArrowBox[BezierCurveBox[{{0.9859052922269387, 0.012737677831188843`}, {
       1.1915174279093084`, 0.05690310025278128}, {
       1.35625263282911, -0.0679788329936861}, {
       1.3857084078180744`, -0.20502138910925752`}, {
       1.0850786438910915`, -0.4315889911758054}, {
       0.9614564742861098, -0.3655143057883806}, {
       0.8867974897754548, -0.17274703412853193`}, {0.9859052922269387, 
       0.012737677831188843`}},
       SplineDegree->7], 0.015799942848996912`]}, InsetBox[
      RowBox[{"1", "\[UndirectedEdge]", "1"}], {1.286835529116458, -0.38656295142653957},
       ImageScaled[{0.5, 0.5}],
      BaseStyle->"Graphics"]}, {
     {Arrowheads[0.], 
      ArrowBox[{{0.9859052922269387, 0.012737677831188843`}, {
       0.2425044305272135, 0.}}, 0.015799942848996912`]}, InsetBox[
      RowBox[{"1", "\[UndirectedEdge]", "2"}], {0.6142048613770761, 0.006368838915594421},
       ImageScaled[{0.5, 0.5}],
      BaseStyle->"Graphics"]}, {
     {Arrowheads[0.], 
      ArrowBox[{{0.9859052922269387, 0.012737677831188843`}, {
       1.2031233105182846`, 0.724331386048053}}, 0.015799942848996912`]}, 
     InsetBox[
      RowBox[{"1", "\[UndirectedEdge]", "3"}], {1.0945143013726115, 0.36853453193962094},
       ImageScaled[{0.5, 0.5}],
      BaseStyle->"Graphics"]}, {
     {Arrowheads[0.], 
      ArrowBox[{{0.9859052922269387, 0.012737677831188843`}, {0., 
       0.7021381335690124}}, 0.015799942848996912`]}, InsetBox[
      RowBox[{"1", "\[UndirectedEdge]", "4"}], {0.49295264611346934, 0.35743790570010064},
       ImageScaled[{0.5, 0.5}],
      BaseStyle->"Graphics"]}, {
     {Arrowheads[0.], 
      ArrowBox[{{0.9859052922269387, 0.012737677831188843`}, {
       0.5927930589779922, 1.1500516670748713`}}, 0.015799942848996912`]}, 
     InsetBox[
      RowBox[{"1", "\[UndirectedEdge]", "5"}], {0.7893491756024654, 0.5813946724530301},
       ImageScaled[{0.5, 0.5}],
      BaseStyle->"Graphics"]}, {
     {Arrowheads[0.], 
      ArrowBox[BezierCurveBox[{{0.2425044305272135, 0.}, {
       0.3480919074697831, -0.1818741861574789}, {
       0.2802775153323711, -0.37715448012073943`}, {
       0.1590624409373625, -0.4475477369448314}, {-0.14937047584312818`, \
-0.23172311112271193`}, {-0.12476598110175355`, -0.09372701079588487}, {
       0.035462651829538186`, 0.036886809990100466`}, {0.2425044305272135, 
       0.}},
       SplineDegree->7], 0.015799942848996912`]}, InsetBox[
      RowBox[{"2", "\[UndirectedEdge]", "2"}], {-0.04415683605654808, -0.4096648852911287},
       ImageScaled[{0.5, 0.5}],
      BaseStyle->"Graphics"]}, {
     {Arrowheads[0.], 
      ArrowBox[{{0.2425044305272135, 0.}, {1.2031233105182846`, 
       0.724331386048053}}, 0.015799942848996912`]}, InsetBox[
      RowBox[{"2", "\[UndirectedEdge]", "3"}], {0.722813870522749, 0.3621656930240265},
       ImageScaled[{0.5, 0.5}],
      BaseStyle->"Graphics"]}, {
     {Arrowheads[0.], 
      ArrowBox[{{0.2425044305272135, 0.}, {0., 0.7021381335690124}}, 
       0.015799942848996912`]}, InsetBox[
      RowBox[{"2", "\[UndirectedEdge]", "4"}], {0.12125221526360674, 0.3510690667845062},
       ImageScaled[{0.5, 0.5}],
      BaseStyle->"Graphics"]}, {
     {Arrowheads[0.], 
      ArrowBox[{{0.2425044305272135, 0.}, {0.5927930589779922, 
       1.1500516670748713`}}, 0.015799942848996912`]}, InsetBox[
      RowBox[{"2", "\[UndirectedEdge]", "5"}], {0.41764874475260283, 0.5750258335374356},
       ImageScaled[{0.5, 0.5}],
      BaseStyle->"Graphics"]}, {
     {Arrowheads[0.], 
      ArrowBox[BezierCurveBox[{{1.2031233105182846`, 0.724331386048053}, {
       1.224435038610447, 0.9335507568607687}, {1.3939853370462845`, 
       1.0518126750409784`}, {1.5334380274443076`, 1.03762634332192}, {
       1.6563947146393667`, 0.6818275429599805}, {1.5554558020384759`, 
       0.5845668582521306}, {1.349064594998357, 0.5729111880497363}, {
       1.2031233105182846`, 0.724331386048053}},
       SplineDegree->7], 0.015799942848996912`]}, InsetBox[
      RowBox[{"3", "\[UndirectedEdge]", "3"}], {1.6757002204618179, 0.8876441662834705},
       ImageScaled[{0.5, 0.5}],
      BaseStyle->"Graphics"]}, {
     {Arrowheads[0.], 
      ArrowBox[{{1.2031233105182846`, 0.724331386048053}, {0., 
       0.7021381335690124}}, 0.015799942848996912`]}, InsetBox[
      RowBox[{"3", "\[UndirectedEdge]", "4"}], {0.6015616552591423, 0.7132347598085327},
       ImageScaled[{0.5, 0.5}],
      BaseStyle->"Graphics"]}, {
     {Arrowheads[0.], 
      ArrowBox[{{1.2031233105182846`, 0.724331386048053}, {0.5927930589779922,
        1.1500516670748713`}}, 0.015799942848996912`]}, InsetBox[
      RowBox[{"3", "\[UndirectedEdge]", "5"}], {0.8979581847481384, 0.9371915265614621},
       ImageScaled[{0.5, 0.5}],
      BaseStyle->"Graphics"]}, {
     {Arrowheads[0.], 
      ArrowBox[BezierCurveBox[{{0., 
       0.7021381335690124}, {-0.14021713441100836`, 
       0.5454024002625704}, {-0.34689883076866446`, 
       0.5493850353281706}, {-0.45138019470246654`, 
       0.6428299359778179}, {-0.34172205128915273`, 
       1.0029496727989535`}, {-0.202892418339559, 
       1.022305237424434}, {-0.029067053193853443`, 0.9104216934007203}, {0., 
       0.7021381335690124}},
       SplineDegree->7], 0.015799942848996912`]}, InsetBox[
      RowBox[{"4", "\[UndirectedEdge]", "4"}], {-0.47831603778171594, 0.847787603189743},
       ImageScaled[{0.5, 0.5}],
      BaseStyle->"Graphics"]}, {
     {Arrowheads[0.], 
      ArrowBox[{{0., 0.7021381335690124}, {0.5927930589779922, 
       1.1500516670748713`}}, 0.015799942848996912`]}, InsetBox[
      RowBox[{"4", "\[UndirectedEdge]", "5"}], {0.2963965294889961, 0.9260949003219419},
       ImageScaled[{0.5, 0.5}],
      BaseStyle->"Graphics"]}, {
     {Arrowheads[0.], 
      ArrowBox[BezierCurveBox[{{0.5927930589779922, 1.1500516670748713`}, {
       0.40036245164521866`, 1.2348891366215455`}, {0.34019674597048144`, 
       1.4326598949555445`}, {0.3967263223525841, 1.5609280198383464`}, {
       0.7731037255130466, 1.5680822951451565`}, {0.8344670104617609, 
       1.4420551070975256`}, {0.781860602420112, 1.2421407483728464`}, {
       0.5927930589779922, 1.1500516670748713`}},
       SplineDegree->7], 0.015799942848996912`]}, InsetBox[
      RowBox[{"5", "\[UndirectedEdge]", "5"}], {0.5832906511173184, 1.6499613631649246},
       ImageScaled[{0.5, 0.5}],
      BaseStyle->"Graphics"]}}, 
   {Hue[0.6, 0.2, 0.8], EdgeForm[{GrayLevel[0], Opacity[
    0.7]}], {DiskBox[{0.9859052922269387, 0.012737677831188843}, 
      0.015799942848996912], 
     InsetBox["1", Offset[{2, 2}, {1.0017052350759357, 0.028537620680185755}],
       ImageScaled[{0, 0}],
      BaseStyle->"Graphics"]}, {
     DiskBox[{0.2425044305272135, 0.}, 0.015799942848996912], 
     InsetBox["2", 
      Offset[{2, 2}, {0.25830437337621037, 0.015799942848996912}], 
      ImageScaled[{0, 0}],
      BaseStyle->"Graphics"]}, {
     DiskBox[{1.2031233105182846, 0.724331386048053}, 0.015799942848996912], 
     InsetBox["3", Offset[{2, 2}, {1.2189232533672816, 0.7401313288970499}], 
      ImageScaled[{0, 0}],
      BaseStyle->"Graphics"]}, {
     DiskBox[{0., 0.7021381335690124}, 0.015799942848996912], 
     InsetBox["4", Offset[{2, 2}, {0.015799942848996912, 0.7179380764180093}],
       ImageScaled[{0, 0}],
      BaseStyle->"Graphics"]}, {
     DiskBox[{0.5927930589779922, 1.1500516670748713}, 0.015799942848996912], 
     InsetBox["5", Offset[{2, 2}, {0.608593001826989, 1.1658516099238683}], 
      ImageScaled[{0, 0}],
      BaseStyle->"Graphics"]}}},
  FormatType->TraditionalForm,
  FrameTicks->None]], "Output",
 CellChangeTimes->{{3.8250718474101095`*^9, 3.8250718752037377`*^9}},
 CellLabel->
  "Out[122]=",ExpressionUUID->"c13a2e76-a508-4d52-ab7d-2b4bbf05e239"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"globalgraph", "//", "WeightedAdjacencyMatrix"}], "//", 
  "Normal"}]], "Input",
 CellChangeTimes->{{3.8250763767341595`*^9, 3.8250763962393093`*^9}},
 CellLabel->
  "In[154]:=",ExpressionUUID->"f46d6d15-b804-4dbf-8509-288290b2364e"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"0", ",", "0", ",", "1", ",", "2", ",", "2"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "0", ",", "4", ",", "3", ",", "4"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "4", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"2", ",", "3", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"2", ",", "4", ",", "0", ",", "0", ",", "0"}], "}"}]}], 
  "}"}]], "Output",
 CellChangeTimes->{{3.825076378950387*^9, 3.825076396500785*^9}},
 CellLabel->
  "Out[154]=",ExpressionUUID->"4ba6560b-fb44-44a5-86cd-4918e3ddba9a"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Other tests", "Subsubsection",
 CellChangeTimes->{{3.825076704540451*^9, 
  3.825076706094879*^9}},ExpressionUUID->"de860586-2cb6-41d1-acb6-\
ed069be5e8af"],

Cell[BoxData[
 RowBox[{
  RowBox[{"weight", "[", 
   RowBox[{
    RowBox[{"SpinorAngleBracket", "[", 
     RowBox[{"i_", ",", "j_"}], "]"}], ",", 
    RowBox[{"SpinorSquareBracket", "[", 
     RowBox[{"k_", ",", "l_"}], "]"}]}], "]"}], ":=", 
  RowBox[{"Which", "[", 
   RowBox[{
    RowBox[{"i", "===", "k"}], ",", "1", ",", 
    RowBox[{"j", "===", "k"}], ",", "2", ",", 
    RowBox[{"i", "===", "l"}], ",", "3", ",", 
    RowBox[{"j", "===", "l"}], ",", "4", ",", "True", ",", "0"}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.8250644946716385`*^9, 3.8250645200995827`*^9}, {
  3.8250645558758936`*^9, 3.8250645630097585`*^9}, {3.825064598189665*^9, 
  3.8250646008386283`*^9}, {3.825064667152217*^9, 3.82506468399123*^9}, {
  3.825066619028162*^9, 3.8250666221787367`*^9}},
 CellLabel->"In[17]:=",ExpressionUUID->"424c7295-37e3-41a5-b5ff-d3b004cdb64d"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
   "Modified", " ", "weight", " ", "function", " ", "swapping", " ", "cases", 
    " ", "1", " ", "and", " ", "3"}], ",", " ", 
   RowBox[{
   "so", " ", "that", " ", "angle", " ", "test", " ", "still", " ", "forbids",
     " ", "even", " ", "cases", " ", "and", " ", "square", " ", "test", " ", 
    "forbids", " ", "summing", " ", "to", " ", "5", " ", 
    RowBox[{"i", ".", "e", ".", " ", "the"}], " ", "cobination", " ", "of", 
    " ", "1", " ", "with", " ", "4", " ", "and", " ", "2", " ", "with", " ", 
    "3"}]}], "*)"}]], "Input",
 CellChangeTimes->{{3.8251432012240033`*^9, 
  3.8251432910807285`*^9}},ExpressionUUID->"34940c78-0672-462d-b43e-\
649f9bc10ff5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"weight", "[", 
   RowBox[{
    RowBox[{"SpinorAngleBracket", "[", 
     RowBox[{"i_", ",", "j_"}], "]"}], ",", 
    RowBox[{"SpinorSquareBracket", "[", 
     RowBox[{"k_", ",", "l_"}], "]"}]}], "]"}], ":=", 
  RowBox[{"Which", "[", 
   RowBox[{
    RowBox[{"i", "===", "k"}], ",", "3", ",", 
    RowBox[{"j", "===", "k"}], ",", "2", ",", 
    RowBox[{"i", "===", "l"}], ",", "1", ",", 
    RowBox[{"j", "===", "l"}], ",", "4", ",", "True", ",", "0"}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.825143302413413*^9, 3.8251433054851465`*^9}},
 CellLabel->
  "In[235]:=",ExpressionUUID->"914dd246-b2c7-4d65-b69b-e05bb3654750"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "sqtest", " ", "checks", " ", "whther", " ", "all", " ", "the", " ", 
   "contractions", " ", "with", " ", "the", " ", "square", " ", "brackets", 
   " ", "are", " ", 
   RowBox[{"possible", ".", " ", "In"}], " ", "particular", " ", "you", " ", 
   "cannot", " ", "have", " ", "the", " ", "same", " ", "square", " ", 
   "bracket", " ", "whose", " ", "first", " ", "label", " ", "contract", " ", 
   "more", " ", "than", " ", "one", " ", "angle", " ", 
   RowBox[{"bracket", ".", " ", "This"}], " ", "is", " ", "checked", " ", 
   "by", " ", "looking", " ", "at", " ", "the", " ", 
   RowBox[{"labels", ".", " ", "The"}], " ", "implemented", " ", "test", " ", 
   "condition", " ", "proved", " ", "to", " ", "be", " ", "the", " ", 
   "fasted", " ", "I", " ", "could", " ", "find"}], "*)"}]], "Input",
 CellChangeTimes->{{3.825144134234501*^9, 3.82514417318128*^9}, {
  3.82514424038459*^9, 3.825144265550265*^9}, {3.825144692019476*^9, 
  3.825144705975103*^9}},ExpressionUUID->"6da8ceea-beb8-487a-8446-\
a584ecae7714"],

Cell[BoxData[
 RowBox[{
  RowBox[{"sqtest", "[", "exp_List", "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"Equal", "[", 
       RowBox[{
        RowBox[{"Length", "@", "#"}], ",", 
        RowBox[{"Length", "@", 
         RowBox[{"DeleteCases", "[", 
          RowBox[{"#", ",", 
           RowBox[{"_", "?", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"!", 
               RowBox[{"MatchQ", "[", 
                RowBox[{"#", ",", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"i_", ",", "j_"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"k_", ",", "l_"}], "}"}]}], "}"}], "/;", 
                    RowBox[{
                    RowBox[{"j", "\[NotEqual]", "l"}], "&&", 
                    RowBox[{
                    RowBox[{"j", "+", "l"}], "\[NotEqual]", "5"}]}]}], ")"}], 
                  "|", 
                  RowBox[{"{", 
                   RowBox[{"{", 
                    RowBox[{"_", ",", "_"}], "}"}], "}"}]}]}], "]"}]}], "&"}],
              ")"}]}]}], "]"}]}]}], "]"}], "&"}], "@", 
     RowBox[{"GatherBy", "[", 
      RowBox[{"#", ",", "First"}], "]"}]}], "&"}], "@", 
   RowBox[{"Flatten", "[", 
    RowBox[{"exp", ",", "1"}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.8251437337165213`*^9, 3.825143777064777*^9}, {
   3.825143925944586*^9, 3.825143993529765*^9}, {3.8251440566290536`*^9, 
   3.825144065285857*^9}, 3.8251446706525793`*^9, {3.825152291782591*^9, 
   3.82515229470875*^9}},
 CellLabel->
  "In[312]:=",ExpressionUUID->"fa28bb1f-6886-4a2c-a696-2016b74652e3"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Block", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
    "exp", ",", "ag", ",", "sq", ",", "len", ",", "lenag", ",", "lensq", ",", 
     "allcontractions"}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"exp", "=", "test"}], ";", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{"Split", " ", "square", " ", "from", " ", 
      RowBox[{"angles", ".", " ", "The"}], " ", "expression", " ", "comes", 
      " ", "from", " ", "a", " ", "Times", " ", "so", " ", "it", " ", "will", 
      " ", "already", " ", "be", " ", "ordered", " ", "with", " ", "angles", 
      " ", "first"}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ag", ",", "sq"}], "}"}], "=", 
     RowBox[{"SplitBy", "[", 
      RowBox[{"exp", ",", "Head"}], "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"len", "=", 
     RowBox[{"Length", "[", "exp", "]"}]}], ";", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
     "lenag", " ", "and", " ", "lensq", " ", "will", " ", "be", " ", "used", 
      " ", "as", " ", "an", " ", "offset", " ", "later"}], "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{"lenag", "=", 
     RowBox[{"Length", "[", "ag", "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"lensq", "=", 
     RowBox[{"Length", "[", "sq", "]"}]}], ";", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{
      "allcontractions", " ", "gives", " ", "all", " ", "the", " ", 
       "possible", " ", "contractions", " ", "of", " ", "the", " ", "angles", 
       " ", "with", " ", "the", " ", 
       RowBox[{"squares", ".", " ", "Angles"}], " ", "are", " ", "labelled", 
       " ", "by", " ", "row", " ", "in", " ", "matrix"}], ",", " ", 
      RowBox[{"squares", " ", "by", " ", "explicit", " ", "label", " ", 
       RowBox[{"(", 
        RowBox[{
        "in", " ", "order", " ", "to", " ", "avoid", " ", "gigantic", " ", 
         "matrices"}], ")"}], " ", "and", " ", "second", " ", "label", " ", 
       "is", " ", 
       RowBox[{"weight", ".", " ", "We"}], " ", "remove", " ", "all", " ", 
       "the", " ", "terms", " ", "signaling", " ", "no", " ", "possible", " ",
        "contraction"}]}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{"allcontractions", "=", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"DeleteCases", "[", 
         RowBox[{"#", ",", 
          RowBox[{"{", 
           RowBox[{"_", ",", "0"}], "}"}]}], "]"}], "&"}], "/@", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"j", ",", 
           RowBox[{"weight", "[", 
            RowBox[{"i", ",", 
             RowBox[{"sq", "[", 
              RowBox[{"[", "j", "]"}], "]"}]}], "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "ag"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", "lensq"}], "}"}]}], "]"}]}], "//", "Echo"}]}], 
    ";", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{
      "Next", " ", "out", " ", "of", " ", "the", " ", "possible", " ", 
       "contractions", " ", "on", " ", "the", " ", "single", " ", "row", " ", 
       "we", " ", "take", " ", "pairs", " ", "of", " ", "compatibel", " ", 
       "contractions"}], ",", " ", 
      RowBox[{
      "so", " ", "first", " ", "take", " ", "Subsets", " ", "grouping", " ", 
       "by", " ", "2"}], ",", " ", 
      RowBox[{
      "then", " ", "delete", " ", "those", " ", "whose", " ", "associated", 
       " ", "weight", " ", "sum", " ", "is", " ", 
       RowBox[{"even", ".", " ", "The"}], " ", "weights", " ", "have", " ", 
       "been", " ", "assigned", " ", "exactly", " ", "in", " ", "such", " ", 
       "a", " ", "way", " ", "that", " ", "these", " ", "are", " ", "the", 
       " ", "forbidden", " ", 
       RowBox[{"cases", ".", " ", "Then"}], " ", "take", " ", "all", " ", 
       "the", " ", "possible", " ", "combinations", " ", "of", " ", "the", 
       " ", "allowed", " ", "contractions"}]}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{"Tuples", "@", 
     RowBox[{"Echo", "@", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"DeleteCases", "[", 
            RowBox[{"#", ",", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"i_", ",", "j_"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"k_", ",", "l_"}], "}"}]}], "}"}], "/;", 
              RowBox[{"EvenQ", "[", 
               RowBox[{"j", "+", "l"}], "]"}]}]}], "]"}], "&"}], "@", 
          RowBox[{"Subsets", "[", 
           RowBox[{"#", ",", 
            RowBox[{"{", "2", "}"}]}], "]"}]}], "&"}], "/@", 
        "allcontractions"}], ")"}]}]}]}]}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "Next", " ", "we", " ", "need", " ", "to", " ", "combine", " ", "these", 
    " ", "data", " ", "back", " ", "into", " ", "chains"}], "*)"}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellChangeTimes->CompressedData["
1:eJwd0FtIk3EYBvDhAm90w2mwLHXTC5WUDg66+ObQUFkehjkyNWLmSpgKzi5S
bzIp8mLiah5SHPNmw3CHYH5TUdlKbSwEZ6M2mOKGTQUPhZo0mkTf8794+fG8
8D4Xr7CpveZJHIvFymUGXqoJW6d7Dosv+DtsMLLod8Dt1btO6MqK90Bb+fQa
/Jy8EIGNFncqzXh5YiwDPuB8FMBbQU02pEuXrkL1QeJ1uNWrvAldDZUU7O7s
l8A3HxS34bmyjegbE0thtURaASc13S+hpaNcC+W14mGYPq59B3N2TXq4x882
wP17tUaYa35GrJzasZC+oV82uBTifYGDCvVXGDMnB+BvShWCPEfsL2yLo2Pw
W9DLcTD2p5RwoVs5eBGy/yzzSQ6bMmHqj2Ni+KfmPhQ+5tTBARX3IUwRrxHZ
K1NNZP8qrxnq5aIW+NQgaoWe0xf2GUb7SNIsHJpfX4S8Au0KHLXteeD7Cq8X
lo33bsArnqpNeLKatu7EffGoD8r86oRPjNF8ExfK+hR8KPh+QlT3PS+F+7tF
dyB9o0QGjdIgMdIokEOnMFAP7Y9cGpjgZuugr6p5BA7rX1uhrkvlhNTZ22XY
Wmg4g3MFO1EoyVCxt/FfoZGop+hr8B91JIL/Ac0Va7Q=
  "],
 CellLabel->
  "In[273]:=",ExpressionUUID->"9e257902-84b3-4683-bd15-1cc52d2d6339"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "3"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"2", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "2"}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "4"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"2", ",", "1"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "4"}], "}"}]}], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.8251446757808957`*^9},ExpressionUUID->"5af38f11-61ef-40a5-b8cf-\
de6286959677"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "3"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "3"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "2"}], "}"}]}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "4"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"2", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "4"}], "}"}]}], "}"}]}], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.825144675879636*^9},ExpressionUUID->"9b30e6f1-cc03-4608-b773-\
6c35f9168de7"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "3"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "4"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "1"}], "}"}]}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "3"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"2", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "4"}], "}"}]}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "3"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "2"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "4"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "1"}], "}"}]}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "3"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "2"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"2", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "4"}], "}"}]}], "}"}]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.8250769205954804`*^9, 3.825076943387351*^9}, {
   3.8250773657303705`*^9, 3.825077392739108*^9}, 3.8250774297801957`*^9, 
   3.8250776157161093`*^9, {3.825077749841179*^9, 3.8250777674085407`*^9}, 
   3.825134998604106*^9, 3.825143307379079*^9, 3.8251438388165655`*^9, 
   3.825144009618763*^9, {3.825144073304471*^9, 3.8251440823073626`*^9}, 
   3.8251446759743834`*^9},
 CellLabel->
  "Out[273]=",ExpressionUUID->"6555ec82-b4f7-43dc-bed6-69abdff1bd76"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"sqtest", "/@", "%"}], "//", "RepeatedTiming"}]], "Input",
 CellChangeTimes->{{3.825144011761014*^9, 3.8251440243842535`*^9}, {
  3.825144084225256*^9, 3.825144087355874*^9}},
 CellLabel->
  "In[274]:=",ExpressionUUID->"e7f54559-4c53-499a-8848-0accc6cb9773"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.00005429932861328125`", ",", 
   RowBox[{"{", 
    RowBox[{"True", ",", "True", ",", "True", ",", "True"}], "}"}]}], 
  "}"}]], "Output",
 CellChangeTimes->{
  3.825144025065432*^9, {3.825144074906126*^9, 3.8251440890453444`*^9}, 
   3.8251446817648563`*^9},
 CellLabel->
  "Out[274]=",ExpressionUUID->"cd02e435-618c-4ea4-a0f1-c91542941c8b"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"DeleteCases", "[", 
     RowBox[{"#", ",", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"i_", ",", "j_"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"k_", ",", "l_"}], "}"}]}], "}"}], "/;", 
       RowBox[{"EvenQ", "[", 
        RowBox[{"j", "+", "l"}], "]"}]}]}], "]"}], "&"}], "@", 
   RowBox[{"Subsets", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "2"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", "2", "}"}]}], "]"}]}], "//", "RepeatedTiming"}]], "Input",
 CellChangeTimes->{{3.8250770037665014`*^9, 3.8250771428564234`*^9}},
 CellLabel->
  "In[169]:=",ExpressionUUID->"89635a87-a60e-40f0-a0cb-ac768243d94c"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"5.1397750854492185`*^-6", ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "2"}], "}"}]}], "}"}]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.825077010801673*^9, {3.8250771270803595`*^9, 3.82507714457101*^9}, 
   3.8250772926250534`*^9},
 CellLabel->
  "Out[169]=",ExpressionUUID->"59372551-d8d1-4191-8781-52364b6b0b9e"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"DeleteCases", "[", 
     RowBox[{"#", ",", 
      RowBox[{"_", "?", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"EvenQ", "[", 
          RowBox[{"Total", "@", 
           RowBox[{"Last", "@", 
            RowBox[{"Transpose", "@", "#"}]}]}], "]"}], "&"}], ")"}]}]}], 
     "]"}], "&"}], "@", 
   RowBox[{"Subsets", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "2"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", "2", "}"}]}], "]"}]}], "//", "RepeatedTiming"}]], "Input",
 CellChangeTimes->{{3.8250771947521906`*^9, 3.825077225332732*^9}, {
  3.825077268133168*^9, 3.8250772699045506`*^9}},
 CellLabel->
  "In[168]:=",ExpressionUUID->"159f63dd-cb26-4b39-a278-30901e037bfa"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.000022525979614257814`", ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "2"}], "}"}]}], "}"}]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.82507722886813*^9, {3.825077271779621*^9, 3.8250772816509037`*^9}},
 CellLabel->
  "Out[168]=",ExpressionUUID->"765c0dbe-bf2a-4cfd-9409-cf6c73b838bb"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"First", " ", "option", " ", "is", " ", "faster"}], "*)"}]], "Input",
 CellChangeTimes->{{3.8250772997121925`*^9, 
  3.8250773061810703`*^9}},ExpressionUUID->"76043a0c-1fbe-4be2-84ae-\
142a64b6154e"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Tuples", "[", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "2"}], "}"}]}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "4"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "3"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"2", ",", "3"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "4"}], "}"}]}], "}"}]}], "}"}]}], "}"}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.8250776451853733`*^9, 3.8250776601587367`*^9}},
 CellLabel->
  "In[176]:=",ExpressionUUID->"0fa0fbbb-f430-45b6-885d-5cb1c69cd2bb"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "4"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "3"}], "}"}]}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"2", ",", "3"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "4"}], "}"}]}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "2"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "4"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "3"}], "}"}]}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "2"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"2", ",", "3"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "4"}], "}"}]}], "}"}]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.8250776491768093`*^9, 3.8250776723343782`*^9}},
 CellLabel->
  "Out[176]=",ExpressionUUID->"2281ac4e-b53b-49ca-91a4-05ecc8e7a680"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData["test"], "Input",
 CellChangeTimes->{{3.8250779550492625`*^9, 3.825077956330064*^9}},
 CellLabel->
  "In[179]:=",ExpressionUUID->"5d01a676-f252-4464-9c07-ef9288225849"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   TemplateBox[{"1", "2"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"3", "4"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"1", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"2", "3"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"2", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]], "Output",
 CellChangeTimes->{3.82507795675167*^9},
 CellLabel->
  "Out[179]=",ExpressionUUID->"58dc5d5d-191d-42ca-a971-5803e178a2d7"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"DeleteDuplicatesBy", "[", 
    RowBox[{"#", ",", 
     RowBox[{"_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"Abs", "[", 
          RowBox[{
           RowBox[{"Last", "@", "#1"}], "-", 
           RowBox[{"Last", "@", "#2"}]}], "]"}], "\[Equal]", "1"}], "&"}], 
       ")"}]}]}], "]"}], "&"}], "@", 
  RowBox[{"Flatten", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "4"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "3"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", "}"}], ",", 
      RowBox[{"{", "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"5", ",", "3"}], "}"}]}], "}"}]}], "}"}], ",", "1"}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.8251362819279327`*^9, 3.8251362984657*^9}, {
  3.825136487941924*^9, 3.8251365782520924`*^9}},
 CellLabel->"In[22]:=",ExpressionUUID->"63354793-4a39-4f37-aa9c-0529a0889ded"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"1", ",", "1"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"2", ",", "2"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "4"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"2", ",", "3"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "2"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"5", ",", "3"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.8251362990880337`*^9, {3.825136514922514*^9, 3.8251365209393797`*^9}, 
   3.8251365796493545`*^9},
 CellLabel->"Out[22]=",ExpressionUUID->"4fdcf6e5-4fe1-4f93-889f-2ed0eb332cfe"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"DeleteCases", "[", 
       RowBox[{"#", ",", 
        RowBox[{"_", "?", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "#", "]"}], ">", "2"}], "&"}], ")"}]}]}], 
       "]"}], "&"}], "@", 
     RowBox[{"GatherBy", "[", 
      RowBox[{"#", ",", "First"}], "]"}]}], "&"}], "@", 
   RowBox[{"Flatten", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "4"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "3"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", "}"}], ",", 
       RowBox[{"{", "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"5", ",", "3"}], "}"}]}], "}"}]}], "}"}], ",", "1"}], 
    "]"}]}], "//", "RepeatedTiming"}]], "Input",
 CellChangeTimes->{{3.8251368642398033`*^9, 3.8251368739296503`*^9}, {
  3.8251379321101713`*^9, 3.8251380248981695`*^9}, {3.8251433482159066`*^9, 
  3.8251434053929844`*^9}},
 CellLabel->
  "In[239]:=",ExpressionUUID->"003a66d2-b4c8-48d5-8725-92245b44fd07"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"7.210487365722656`*^-6", ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"2", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "3"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{"5", ",", "3"}], "}"}], "}"}]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.8251368744402823`*^9, {3.8251379593160753`*^9, 3.8251380264729548`*^9}, {
   3.8251433921024747`*^9, 3.82514340775066*^9}},
 CellLabel->
  "Out[239]=",ExpressionUUID->"9f0be8fa-f5aa-477c-b141-adb716489698"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"DeleteCases", "[", 
       RowBox[{"#", ",", 
        RowBox[{"_", "?", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"MatchQ", "[", 
            RowBox[{
             RowBox[{"Plus", "@@", "#"}], ",", 
             RowBox[{"{", 
              RowBox[{"_", ",", "5"}], "}"}]}], "]"}], "&"}], ")"}]}]}], 
       "]"}], "&"}], "@", 
     RowBox[{"GatherBy", "[", 
      RowBox[{"#", ",", "First"}], "]"}]}], "&"}], "@", 
   RowBox[{"Flatten", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "4"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "3"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", "}"}], ",", 
       RowBox[{"{", "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"5", ",", "3"}], "}"}]}], "}"}]}], "}"}], ",", "1"}], 
    "]"}]}], "//", "RepeatedTiming"}]], "Input",
 CellChangeTimes->{{3.82514345151861*^9, 3.825143454112675*^9}, {
  3.8251435046425257`*^9, 3.8251435383042297`*^9}},
 CellLabel->
  "In[241]:=",ExpressionUUID->"84f2f7ba-5ff1-4697-af4b-117cd9974405"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"9.970783996582031`*^-6", ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "4"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "2"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{"5", ",", "3"}], "}"}], "}"}]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{3.8251434569869785`*^9, 3.8251435427144265`*^9},
 CellLabel->
  "Out[241]=",ExpressionUUID->"f7d89159-cb86-427e-a109-3c6c29e9c8c9"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"DeleteCases", "[", 
       RowBox[{"#", ",", 
        RowBox[{"_", "?", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", "#", "]"}], ">", "2"}], "||", 
            RowBox[{"MatchQ", "[", 
             RowBox[{
              RowBox[{"Plus", "@@", "#"}], ",", 
              RowBox[{"{", 
               RowBox[{"_", ",", "5"}], "}"}]}], "]"}]}], "&"}], ")"}]}]}], 
       "]"}], "&"}], "@", 
     RowBox[{"GatherBy", "[", 
      RowBox[{"#", ",", "First"}], "]"}]}], "&"}], "@", 
   RowBox[{"Flatten", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "4"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "3"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", "}"}], ",", 
       RowBox[{"{", "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"5", ",", "3"}], "}"}]}], "}"}]}], "}"}], ",", "1"}], 
    "]"}]}], "//", "RepeatedTiming"}]], "Input",
 CellChangeTimes->{{3.82514345151861*^9, 3.825143454112675*^9}, {
  3.8251435046425257`*^9, 3.825143565392723*^9}},
 CellLabel->
  "In[243]:=",ExpressionUUID->"85894413-1be8-4cfe-ade6-d07e5a5b7713"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.00001099580078125`", ",", 
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{"5", ",", "3"}], "}"}], "}"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.8251434569869785`*^9, {3.8251435427144265`*^9, 3.825143572952534*^9}},
 CellLabel->
  "Out[243]=",ExpressionUUID->"eb013b74-137c-4055-b27b-9004a92331cd"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"DeleteCases", "[", 
         RowBox[{"#", ",", 
          RowBox[{"_", "?", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"MatchQ", "[", 
              RowBox[{
               RowBox[{"Plus", "@@", "#"}], ",", 
               RowBox[{"{", 
                RowBox[{"_", ",", "5"}], "}"}]}], "]"}], "&"}], ")"}]}]}], 
         "]"}], "&"}], "@", 
       RowBox[{"DeleteCases", "[", 
        RowBox[{"#", ",", 
         RowBox[{"_", "?", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", "#", "]"}], ">", "2"}], "&"}], ")"}]}]}], 
        "]"}]}], "&"}], "@", 
     RowBox[{"GatherBy", "[", 
      RowBox[{"#", ",", "First"}], "]"}]}], "&"}], "@", 
   RowBox[{"Flatten", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "4"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "3"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", "}"}], ",", 
       RowBox[{"{", "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"5", ",", "3"}], "}"}]}], "}"}]}], "}"}], ",", "1"}], 
    "]"}]}], "//", "RepeatedTiming"}]], "Input",
 CellChangeTimes->{
  3.825143444011692*^9, {3.825143604490196*^9, 3.8251436285807652`*^9}},
 CellLabel->
  "In[245]:=",ExpressionUUID->"cb53338c-8231-4dfd-954e-22a1e61b5a41"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.000011513084411621093`", ",", 
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{"5", ",", "3"}], "}"}], "}"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.8251436330078754`*^9, 3.825143639979231*^9}},
 CellLabel->
  "Out[245]=",ExpressionUUID->"a9fbd3e2-3683-4401-acb1-8e4ccb21d6a6"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"GatherBy", "[", 
    RowBox[{"#", ",", "First"}], "]"}], "&"}], "@", 
  RowBox[{"Flatten", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "4"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "3"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", "}"}], ",", 
      RowBox[{"{", "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"5", ",", "3"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"6", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"6", ",", "2"}], "}"}]}], "}"}]}], "}"}], ",", "1"}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.825144604880557*^9, 3.8251446191254516`*^9}},
 CellLabel->
  "In[270]:=",ExpressionUUID->"ec5eb01c-64f5-4110-8138-28e63ac8806e"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "1"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "4"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "2"}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"2", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"2", ",", "3"}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{"5", ",", "3"}], "}"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"6", ",", "1"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"6", ",", "2"}], "}"}]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{3.8251445783624587`*^9, 3.825144620488778*^9},
 CellLabel->
  "Out[270]=",ExpressionUUID->"9698f1a3-bb6c-4774-b534-05a1b710f398"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"DeleteCases", "[", 
       RowBox[{"#", ",", 
        RowBox[{"_", "?", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"!", 
            RowBox[{"MatchQ", "[", 
             RowBox[{"#", ",", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"i_", ",", "j_"}], "}"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"k_", ",", "l_"}], "}"}]}], "}"}], "/;", 
                 RowBox[{
                  RowBox[{"j", "+", "l"}], "\[NotEqual]", "5"}]}], ")"}], "|", 
               RowBox[{"{", 
                RowBox[{"{", 
                 RowBox[{"_", ",", "_"}], "}"}], "}"}]}]}], "]"}]}], "&"}], 
          ")"}]}]}], "]"}], "&"}], "@", 
     RowBox[{"GatherBy", "[", 
      RowBox[{"#", ",", "First"}], "]"}]}], "&"}], "@", 
   RowBox[{"Flatten", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "4"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "3"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", "}"}], ",", 
       RowBox[{"{", "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"5", ",", "3"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"6", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"6", ",", "2"}], "}"}]}], "}"}]}], "}"}], ",", "1"}], 
    "]"}]}], "//", "RepeatedTiming"}]], "Input",
 CellChangeTimes->{{3.825144307439187*^9, 3.825144346660289*^9}, {
   3.825144407907526*^9, 3.825144449156002*^9}, {3.8251444937956576`*^9, 
   3.825144548993973*^9}, 3.825144631000671*^9},
 CellLabel->
  "In[271]:=",ExpressionUUID->"1dc08f35-a252-49db-b6ff-70423b06a875"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.00001147144775390625`", ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{"5", ",", "3"}], "}"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"6", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"6", ",", "2"}], "}"}]}], "}"}]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.825144352816819*^9, 3.825144360178131*^9}, 
   3.825144419904128*^9, 3.8251444513401566`*^9, {3.825144517459312*^9, 
   3.825144559026172*^9}, 3.8251446341971207`*^9},
 CellLabel->
  "Out[271]=",ExpressionUUID->"62f74efb-17ed-4a33-8c1b-02d02fc3d159"]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"sqtest", "[", "exp_List", "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"Equal", "[", 
       RowBox[{
        RowBox[{"Length", "@", "#"}], ",", 
        RowBox[{"Length", "@", 
         RowBox[{"DeleteCases", "[", 
          RowBox[{"#", ",", 
           RowBox[{"_", "?", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"Length", "[", "#", "]"}], ">", "2"}], "||", 
               RowBox[{"MatchQ", "[", 
                RowBox[{
                 RowBox[{"Plus", "@@", "#"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"_", ",", "5"}], "}"}]}], "]"}]}], "&"}], ")"}]}]}],
           "]"}]}]}], "]"}], "&"}], "@", 
     RowBox[{"GatherBy", "[", 
      RowBox[{"#", ",", "First"}], "]"}]}], "&"}], "@", 
   RowBox[{"Flatten", "[", 
    RowBox[{"exp", ",", "1"}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.8251437337165213`*^9, 3.825143777064777*^9}, {
  3.825143925944586*^9, 3.825143993529765*^9}, {3.8251440566290536`*^9, 
  3.825144065285857*^9}},
 CellLabel->
  "In[252]:=",ExpressionUUID->"14637ad8-abe3-4eaa-ae63-67794bc30e80"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"Now", " ", "the", " ", "pairing"}], "*)"}]], "Input",
 CellChangeTimes->{{3.825144758348028*^9, 
  3.8251447628709292`*^9}},ExpressionUUID->"bc001efb-ae95-421a-a715-\
1ca4858ecab0"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "3"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "3"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "2"}], "}"}]}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "4"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"2", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "4"}], "}"}]}], "}"}]}], "}"}]}], "}"}]], "Input",Ex\
pressionUUID->"9edb1ad8-a3f2-45d4-92d2-31f08e66eb81"],

Cell[BoxData[
 RowBox[{
  RowBox[{"pairing", "[", 
   RowBox[{"x_", ",", "y_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"sqtest", "[", "#", "]"}], ",", "#", ",", 
      RowBox[{"Nothing", "[", "]"}]}], "]"}], "&"}], "@", 
   RowBox[{"Join", "[", 
    RowBox[{"x", ",", 
     RowBox[{"{", "y", "}"}]}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.82514478020856*^9, 3.8251447833053293`*^9}, {
  3.825144817546748*^9, 3.8251448402901435`*^9}, {3.8251449372617846`*^9, 
  3.8251449992519736`*^9}, {3.825150697782158*^9, 3.825150698843295*^9}},
 CellLabel->
  "In[275]:=",ExpressionUUID->"2dc3eeb3-74b6-43ee-8e61-53646af4bffa"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"pairing", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "3"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"2", ",", "2"}], "}"}]}], "}"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "4"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"2", ",", "1"}], "}"}]}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.8251508695075617`*^9, 3.825150897362691*^9}},
 CellLabel->
  "In[276]:=",ExpressionUUID->"5d30cf46-dbee-45f7-8d90-b03f998ea3f3"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "3"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "4"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"2", ",", "1"}], "}"}]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{3.8251508984616957`*^9},
 CellLabel->
  "Out[276]=",ExpressionUUID->"bf7713b7-a018-40da-ba38-eaea1cf5aa3e"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"Length", "@", 
   RowBox[{"Fold", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Flatten", "[", 
       RowBox[{
        RowBox[{"Outer", "[", 
         RowBox[{"pairing", ",", "#1", ",", "#2", ",", "1"}], "]"}], ",", 
        "1"}], "]"}], "&"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"1", ",", "3"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "2"}], "}"}]}], "}"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"1", ",", "3"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"3", ",", "2"}], "}"}]}], "}"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"1", ",", "4"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"2", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"3", ",", "4"}], "}"}]}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"1", ",", "3"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"6", ",", "1"}], "}"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"6", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"6", ",", "3"}], "}"}]}], "}"}]}], "}"}]}], "}"}]}], 
    "]"}]}], "//", "RepeatedTiming"}]], "Input",
 CellChangeTimes->{{3.825150701355605*^9, 3.825150746897194*^9}, {
  3.825151319161661*^9, 3.8251514701198654`*^9}, {3.825151551578039*^9, 
  3.82515155744933*^9}, {3.8251515943406143`*^9, 3.825151625992012*^9}, {
  3.825151686192997*^9, 3.8251516992598248`*^9}, {3.8251525450124245`*^9, 
  3.825152567071475*^9}, {3.825152645997379*^9, 3.8251526484487743`*^9}},
 CellLabel->
  "In[321]:=",ExpressionUUID->"0fcf4268-41dc-446b-8b9f-bf7f6a8aaf65"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.0001660941162109375`", ",", "4"}], "}"}]], "Output",
 CellChangeTimes->{{3.82515145263663*^9, 3.8251514710124784`*^9}, 
   3.8251515579988112`*^9, 3.825151628424497*^9, {3.825151690686757*^9, 
   3.825151700499549*^9}, 3.8251523092677755`*^9, {3.8251525468764334`*^9, 
   3.8251525696116724`*^9}, 3.825152651129633*^9},
 CellLabel->
  "Out[321]=",ExpressionUUID->"75331d55-c619-4aa2-bad4-419208b785a9"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"Length", "@", 
   RowBox[{"Tuples", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"1", ",", "3"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"1", ",", "3"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"3", ",", "2"}], "}"}]}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"1", ",", "4"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"2", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"3", ",", "4"}], "}"}]}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"1", ",", "3"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"6", ",", "1"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"6", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"6", ",", "3"}], "}"}]}], "}"}]}], "}"}]}], "}"}], "]"}]}],
   "//", "RepeatedTiming"}]], "Input",
 CellChangeTimes->{{3.825152579707675*^9, 3.825152662633882*^9}},
 CellLabel->
  "In[323]:=",ExpressionUUID->"a1bd5938-b898-4b57-8f53-5fa8729f5dbe"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"2.533863830566406`*^-6", ",", "8"}], "}"}]], "Output",
 CellChangeTimes->{{3.8251526365047493`*^9, 3.8251526645945807`*^9}},
 CellLabel->
  "Out[323]=",ExpressionUUID->"e638ebfd-9497-4629-9a7f-db50363e621b"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Outer", "[", 
  RowBox[{"pairing", ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "4"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "1"}], "}"}]}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"2", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "4"}], "}"}]}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "2"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "4"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "1"}], "}"}]}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "2"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"2", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "4"}], "}"}]}], "}"}]}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "3"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"6", ",", "1"}], "}"}]}], "}"}], "}"}], ",", "1"}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.825151999957468*^9, 3.8251520278867226`*^9}},
 CellLabel->
  "In[304]:=",ExpressionUUID->"5e449ccd-a4f7-4b92-9e52-c6786643667b"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "3"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"2", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "4"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "3"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"6", ",", "1"}], "}"}]}], "}"}]}], "}"}], "}"}], ",", 
   RowBox[{"{", "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "3"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "2"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"2", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "4"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "3"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"6", ",", "1"}], "}"}]}], "}"}]}], "}"}], "}"}]}], 
  "}"}]], "Output",
 CellChangeTimes->{3.825152028443222*^9},
 CellLabel->
  "Out[304]=",ExpressionUUID->"1d945931-109b-4c05-9138-52ba149e566c"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"pairing", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "3"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"2", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "4"}], "}"}]}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "3"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"6", ",", "1"}], "}"}]}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.8251519462869787`*^9, 3.8251519564198766`*^9}, 
   3.825152057019802*^9},
 CellLabel->
  "In[305]:=",ExpressionUUID->"c0e52826-7bd8-4568-9427-9284c4b3a276"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "3"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"2", ",", "1"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "4"}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "3"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"6", ",", "1"}], "}"}]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{3.8251519570023146`*^9, 3.8251520581956034`*^9},
 CellLabel->
  "Out[305]=",ExpressionUUID->"1c625335-bbe8-4dae-98a9-8699e369a990"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"sqtest", "[", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "3"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"2", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"3", ",", "4"}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "3"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"6", ",", "1"}], "}"}]}], "}"}]}], "}"}], "]"}]], "Input",
 CellChangeTimes->{{3.8251520651410303`*^9, 3.825152090227759*^9}},
 CellLabel->
  "In[306]:=",ExpressionUUID->"ab70e3bd-cc8f-4402-b654-ab8c2f687290"],

Cell[BoxData["True"], "Output",
 CellChangeTimes->{3.825152091285925*^9},
 CellLabel->
  "Out[306]=",ExpressionUUID->"bc65d35f-bab6-45fa-958d-b455a37e8e45"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"Equal", "[", 
      RowBox[{
       RowBox[{"Length", "@", "#"}], ",", 
       RowBox[{"Length", "@", 
        RowBox[{"DeleteCases", "[", 
         RowBox[{"#", ",", 
          RowBox[{"_", "?", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"!", 
              RowBox[{"MatchQ", "[", 
               RowBox[{"#", ",", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"i_", ",", "j_"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"k_", ",", "l_"}], "}"}]}], "}"}], "/;", 
                   RowBox[{
                    RowBox[{"j", "\[NotEqual]", "l"}], "&&", 
                    RowBox[{
                    RowBox[{"j", "+", "l"}], "\[NotEqual]", "5"}]}]}], ")"}], 
                 "|", 
                 RowBox[{"{", 
                  RowBox[{"{", 
                   RowBox[{"_", ",", "_"}], "}"}], "}"}]}]}], "]"}]}], "&"}], 
            ")"}]}]}], "]"}]}]}], "]"}], "&"}], "@", 
    RowBox[{"Echo", "@", 
     RowBox[{"GatherBy", "[", 
      RowBox[{"#", ",", "First"}], "]"}]}]}], "&"}], "@", 
  RowBox[{"Flatten", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "3"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"2", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "4"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"6", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"6", ",", "3"}], "}"}]}], "}"}]}], "}"}], ",", "1"}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.825152151067089*^9, 3.825152191248473*^9}, {
  3.8251522505837345`*^9, 3.825152256599675*^9}, {3.825152500363839*^9, 
  3.8251525382854586`*^9}},
 CellLabel->
  "In[316]:=",ExpressionUUID->"55f7af87-74a7-445d-bf9a-08d3233891ab"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{"1", ",", "3"}], "}"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"2", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{"3", ",", "4"}], "}"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"6", ",", "1"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"6", ",", "3"}], "}"}]}], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.825152538783114*^9},ExpressionUUID->"1d76d568-5655-4eee-9feb-\
f602efd6a850"],

Cell[BoxData["True"], "Output",
 CellChangeTimes->{{3.825152153313032*^9, 3.825152192774352*^9}, 
   3.825152258787791*^9, {3.8251525016723785`*^9, 3.825152538870885*^9}},
 CellLabel->
  "Out[316]=",ExpressionUUID->"f085ff66-5eba-449f-979d-b40206625993"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"FoldList", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Flatten", "[", 
      RowBox[{
       RowBox[{"Outer", "[", 
        RowBox[{"pairing", ",", "#1", ",", "#2", ",", "1"}], "]"}], ",", 
       "1"}], "]"}], "&"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "2"}], "}"}]}], "}"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "2"}], "}"}]}], "}"}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "4"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"2", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "4"}], "}"}]}], "}"}]}], "}"}], "}"}]}], "]"}], "//",
   "RepeatedTiming"}]], "Input",
 CellChangeTimes->{{3.825151723242687*^9, 3.8251517304113617`*^9}},
 CellLabel->
  "In[301]:=",ExpressionUUID->"a068d1d7-3c2e-4a62-b371-3e31995c3e08"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.000049903131103515624`", ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"1", ",", "3"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "2"}], "}"}]}], "}"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"1", ",", "3"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"3", ",", "2"}], "}"}]}], "}"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"1", ",", "3"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"1", ",", "4"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"2", ",", "1"}], "}"}]}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"1", ",", "3"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"2", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"3", ",", "4"}], "}"}]}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"1", ",", "3"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"3", ",", "2"}], "}"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"1", ",", "4"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"2", ",", "1"}], "}"}]}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"1", ",", "3"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"3", ",", "2"}], "}"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"2", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"3", ",", "4"}], "}"}]}], "}"}]}], "}"}]}], "}"}]}], 
    "}"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.8251517238490925`*^9, 3.825151732412053*^9}},
 CellLabel->
  "Out[301]=",ExpressionUUID->"d2e12810-ce7a-442d-ad61-88d087581a7c"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"Tuples", "@", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "2"}], "}"}]}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "4"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"2", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "4"}], "}"}]}], "}"}]}], "}"}]}], "}"}]}], "//", 
  "RepeatedTiming"}]], "Input",
 CellChangeTimes->{{3.8251517546275897`*^9, 3.8251517613595886`*^9}},
 CellLabel->
  "In[302]:=",ExpressionUUID->"595330d4-d25c-4057-b820-5ca88d10da27"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"1.8140264511108398`*^-6", ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "4"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "1"}], "}"}]}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"2", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "4"}], "}"}]}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "2"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "4"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "1"}], "}"}]}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "2"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"2", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "4"}], "}"}]}], "}"}]}], "}"}]}], "}"}]}], 
  "}"}]], "Output",
 CellChangeTimes->{3.825151763640521*^9},
 CellLabel->
  "Out[302]=",ExpressionUUID->"92256532-92d6-48b1-bfbc-cd9333cbdcc7"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"FoldList", "[", 
  RowBox[{
   RowBox[{
    RowBox[{"Outer", "[", 
     RowBox[{"g", ",", "#1", ",", "#2", ",", "1"}], "]"}], "&"}], ",", 
   RowBox[{"{", 
    RowBox[{"{", "x", "}"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", "y", "}"}], ",", 
     RowBox[{"{", "z", "}"}]}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.825150928859433*^9, 3.8251511177711263`*^9}, {
  3.8251512903756714`*^9, 3.825151300663102*^9}},
 CellLabel->
  "In[292]:=",ExpressionUUID->"7775cfdd-1a4c-46e1-971f-3a57898fade7"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"{", "x", "}"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{"g", "[", 
      RowBox[{
       RowBox[{"{", "x", "}"}], ",", "y"}], "]"}], "}"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{"g", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"g", "[", 
         RowBox[{
          RowBox[{"{", "x", "}"}], ",", "y"}], "]"}], "}"}], ",", "z"}], 
      "]"}], "}"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.8251509557783985`*^9, 3.825150979708432*^9}, {
   3.825151034724243*^9, 3.8251511185221505`*^9}, 3.825151302695695*^9},
 CellLabel->
  "Out[292]=",ExpressionUUID->"59cf02d0-81e5-429d-97e6-1ace45518a73"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Outer", "[", 
  RowBox[{"g", ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "2"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", "a", "}"}], ",", "b"}], "}"}], ",", "1"}], "]"}]], "Input",
 CellChangeTimes->{{3.8251511572844706`*^9, 3.82515116278485*^9}, {
  3.8251512291663313`*^9, 3.825151281687856*^9}},
 CellLabel->
  "In[291]:=",ExpressionUUID->"3fea89de-95e3-4e3d-af1d-9d94532bb6f5"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"g", "[", 
      RowBox[{"1", ",", 
       RowBox[{"{", "a", "}"}]}], "]"}], ",", 
     RowBox[{"g", "[", 
      RowBox[{"1", ",", "b"}], "]"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"g", "[", 
      RowBox[{"2", ",", 
       RowBox[{"{", "a", "}"}]}], "]"}], ",", 
     RowBox[{"g", "[", 
      RowBox[{"2", ",", "b"}], "]"}]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.825151240799214*^9, 3.825151282173587*^9}},
 CellLabel->
  "Out[291]=",ExpressionUUID->"f0e0c5bb-5f3f-4d77-bcb2-3005cea9f1f7"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"Fold", "[", 
  RowBox[{
   RowBox[{
    RowBox[{"Flatten", "[", 
     RowBox[{
      RowBox[{"Outer", "[", 
       RowBox[{"pairing", ",", "#1", ",", "#2", ",", "1"}], "]"}], ",", "1"}],
      "]"}], "&"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "3"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "2"}], "}"}]}], "}"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "3"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "2"}], "}"}]}], "}"}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "4"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"2", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "4"}], "}"}]}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"6", ",", "1"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"6", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"6", ",", "3"}], "}"}]}], "}"}]}], "}"}]}], "}"}]}], 
  "]"}]], "Input",ExpressionUUID->"10aa6790-a49d-4ba2-805b-298f99b9549c"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"g", "[", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"{", "#", "}"}], "&"}], "/@", 
      RowBox[{"(", 
       RowBox[{"First", "@", "#"}], ")"}]}], ",", 
     RowBox[{"#", "[", 
      RowBox[{"[", 
       RowBox[{"2", ";;"}], "]"}], "]"}]}], "]"}], "&"}], "@", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "3"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "3"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "2"}], "}"}]}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "4"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"2", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "4"}], "}"}]}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "3"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"6", ",", "1"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"6", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"6", ",", "3"}], "}"}]}], "}"}]}], "}"}]}], "}"}]}]], "Input",
 CellChangeTimes->{{3.825152771863733*^9, 3.8251528172152553`*^9}},
 CellLabel->
  "In[325]:=",ExpressionUUID->"5d4f8e2b-99a3-47a9-9600-a9d704da6768"],

Cell[BoxData[
 RowBox[{"g", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "3"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "2"}], "}"}]}], "}"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "3"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "2"}], "}"}]}], "}"}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "4"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"2", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "4"}], "}"}]}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"6", ",", "1"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"6", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"6", ",", "3"}], "}"}]}], "}"}]}], "}"}]}], "}"}]}], 
  "]"}]], "Output",
 CellChangeTimes->{3.8251527868234887`*^9, 3.8251528179931192`*^9},
 CellLabel->
  "Out[325]=",ExpressionUUID->"b103c22b-23b0-4993-81f0-b5492b99083c"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"1", ",", "3"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"1", ",", "3"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"3", ",", "2"}], "}"}]}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"1", ",", "4"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"2", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"3", ",", "4"}], "}"}]}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"1", ",", "3"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"6", ",", "1"}], "}"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"6", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"6", ",", "3"}], "}"}]}], "}"}]}], "}"}]}], "}"}], 
     RowBox[{"Fold", "[", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{
           RowBox[{"Outer", "[", 
            RowBox[{"pairing", ",", "#1", ",", "#2", ",", "1"}], "]"}], ",", 
           "1"}], "]"}], "&"}], ")"}], ",", 
       RowBox[{
        RowBox[{
         RowBox[{"{", "#", "}"}], "&"}], "/@", 
        RowBox[{"(", 
         RowBox[{"First", "@", "#"}], ")"}]}], ",", 
       RowBox[{"#", "[", 
        RowBox[{"[", 
         RowBox[{"2", ";;"}], "]"}], "]"}]}], "]"}]}], "&"}], "@", 
   "%"}]}]], "Input",
 CellChangeTimes->{{3.8251528645366354`*^9, 3.8251528789641004`*^9}, {
  3.8251529159033017`*^9, 3.8251529256322265`*^9}},
 CellLabel->
  "In[327]:=",ExpressionUUID->"e73f1c67-580c-42e6-a3d0-3f9f229561c3"],

Cell[BoxData[
 TemplateBox[{
  "Thread", "tdlen", 
   "\"Objects of unequal length in \\!\\(\\*RowBox[{RowBox[{\\\"{\\\", \
RowBox[{RowBox[{\\\"{\\\", RowBox[{RowBox[{\\\"{\\\", RowBox[{RowBox[{\\\"{\\\
\", RowBox[{\\\"1\\\", \\\",\\\", \\\"3\\\"}], \\\"}\\\"}], \\\",\\\", \
RowBox[{\\\"{\\\", RowBox[{\\\"2\\\", \\\",\\\", \\\"2\\\"}], \\\"}\\\"}]}], \
\\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", RowBox[{RowBox[{\\\"{\\\", \
RowBox[{\\\"1\\\", \\\",\\\", \\\"3\\\"}], \\\"}\\\"}], \\\",\\\", RowBox[{\\\
\"{\\\", RowBox[{\\\"3\\\", \\\",\\\", \\\"2\\\"}], \\\"}\\\"}]}], \
\\\"}\\\"}]}], \\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \
RowBox[{RowBox[{\\\"{\\\", RowBox[{RowBox[{\\\"{\\\", RowBox[{\\\"1\\\", \
\\\",\\\", \\\"4\\\"}], \\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", RowBox[{\\\
\"2\\\", \\\",\\\", \\\"1\\\"}], \\\"}\\\"}]}], \\\"}\\\"}], \\\",\\\", \
RowBox[{\\\"{\\\", RowBox[{RowBox[{\\\"{\\\", RowBox[{\\\"2\\\", \\\",\\\", \
\\\"1\\\"}], \\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", RowBox[{\\\"3\\\", \\\
\",\\\", \\\"4\\\"}], \\\"}\\\"}]}], \\\"}\\\"}]}], \\\"}\\\"}], \\\",\\\", \
RowBox[{\\\"{\\\", RowBox[{RowBox[{\\\"{\\\", RowBox[{RowBox[{\\\"{\\\", \
RowBox[{\\\"1\\\", \\\",\\\", \\\"3\\\"}], \\\"}\\\"}], \\\",\\\", RowBox[{\\\
\"{\\\", RowBox[{\\\"6\\\", \\\",\\\", \\\"1\\\"}], \\\"}\\\"}]}], \
\\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", RowBox[{RowBox[{\\\"{\\\", \
RowBox[{\\\"6\\\", \\\",\\\", \\\"1\\\"}], \\\"}\\\"}], \\\",\\\", RowBox[{\\\
\"{\\\", RowBox[{\\\"6\\\", \\\",\\\", \\\"3\\\"}], \\\"}\\\"}]}], \
\\\"}\\\"}]}], \\\"}\\\"}]}], \\\"}\\\"}], \\\" \\\", RowBox[{\\\"{\\\", \
\\\"}\\\"}]}]\\) cannot be combined.\"", 2, 327, 17, 25256500263930684636, 
   "Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{3.825152880400203*^9, 3.825152926917822*^9},
 CellLabel->
  "During evaluation of \
In[327]:=",ExpressionUUID->"5ede203a-d14f-4313-b974-9db8545cb3ff"],

Cell[BoxData[
 RowBox[{
  RowBox[{"{", "}"}], " ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "3"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "3"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "2"}], "}"}]}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "4"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"2", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "4"}], "}"}]}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "3"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"6", ",", "1"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"6", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"6", ",", "3"}], "}"}]}], "}"}]}], "}"}]}], 
   "}"}]}]], "Output",
 CellChangeTimes->{3.8251528804231415`*^9, 3.825152926935776*^9},
 CellLabel->
  "Out[327]=",ExpressionUUID->"b8c5af05-fb52-435d-aee6-67e55eae1299"]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"allpairings", "[", "exp_List", "]"}], ":=", 
  RowBox[{"Fold", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Flatten", "[", 
      RowBox[{
       RowBox[{"Outer", "[", 
        RowBox[{"pairing", ",", "#1", ",", "#2", ",", "1"}], "]"}], ",", 
       "1"}], "]"}], "&"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"{", "#", "}"}], "&"}], "/@", 
     RowBox[{"(", 
      RowBox[{"First", "@", "exp"}], ")"}]}], ",", 
    RowBox[{"exp", "[", 
     RowBox[{"[", 
      RowBox[{"2", ";;"}], "]"}], "]"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.82515294362909*^9, 3.825152985796472*^9}},
 CellLabel->
  "In[328]:=",ExpressionUUID->"746802a6-17a9-43dd-b40d-c412ce29ab4c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"prova", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "2"}], "}"}]}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "4"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"2", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "4"}], "}"}]}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"6", ",", "1"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"6", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"6", ",", "3"}], "}"}]}], "}"}]}], "}"}]}], "}"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.825152990080043*^9, 3.825153000909192*^9}},
 CellLabel->
  "In[329]:=",ExpressionUUID->"931afd0e-46ba-4ad9-b991-37bcb5e5f5d9"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"allpairings", "[", "prova", "]"}], "//", 
  "RepeatedTiming"}]], "Input",
 CellChangeTimes->{{3.8251530090863204`*^9, 3.825153040076459*^9}},
 CellLabel->
  "In[331]:=",ExpressionUUID->"d811694a-8be0-4cf1-8c32-174a72c7958e"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.0001751177490234375`", ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "4"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"6", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"6", ",", "3"}], "}"}]}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"2", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "4"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"6", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"6", ",", "3"}], "}"}]}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "2"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "4"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"6", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"6", ",", "3"}], "}"}]}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "2"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"2", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "4"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"6", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"6", ",", "3"}], "}"}]}], "}"}]}], "}"}]}], "}"}]}], 
  "}"}]], "Output",
 CellChangeTimes->{{3.8251530168247004`*^9, 3.825153041931546*^9}},
 CellLabel->
  "Out[331]=",ExpressionUUID->"e9cb199e-68db-480b-892a-52df74a572bd"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Auxiliary", "Subsubsection",
 CellChangeTimes->{{3.82515320816692*^9, 
  3.8251532097774906`*^9}},ExpressionUUID->"47697295-4836-4330-99a0-\
eb43c2dec756"],

Cell[BoxData[
 RowBox[{
  RowBox[{"weight", "[", 
   RowBox[{
    RowBox[{"SpinorAngleBracket", "[", 
     RowBox[{"i_", ",", "j_"}], "]"}], ",", 
    RowBox[{"SpinorSquareBracket", "[", 
     RowBox[{"k_", ",", "l_"}], "]"}]}], "]"}], ":=", 
  RowBox[{"Which", "[", 
   RowBox[{
    RowBox[{"i", "===", "k"}], ",", "1", ",", 
    RowBox[{"j", "===", "k"}], ",", "2", ",", 
    RowBox[{"i", "===", "l"}], ",", "3", ",", 
    RowBox[{"j", "===", "l"}], ",", "4", ",", "True", ",", "0"}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.8250644946716385`*^9, 3.8250645200995827`*^9}, {
  3.8250645558758936`*^9, 3.8250645630097585`*^9}, {3.825064598189665*^9, 
  3.8250646008386283`*^9}, {3.825064667152217*^9, 3.82506468399123*^9}, {
  3.825066619028162*^9, 3.8250666221787367`*^9}},
 CellLabel->"In[2]:=",ExpressionUUID->"56c3bab5-2018-48e3-ac9c-9be2f4c087cf"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
   "Modified", " ", "weight", " ", "function", " ", "swapping", " ", "cases", 
    " ", "1", " ", "and", " ", "3"}], ",", " ", 
   RowBox[{
   "so", " ", "that", " ", "angle", " ", "test", " ", "still", " ", "forbids",
     " ", "even", " ", "cases", " ", "and", " ", "square", " ", "test", " ", 
    "forbids", " ", "summing", " ", "to", " ", "5", " ", 
    RowBox[{"i", ".", "e", ".", " ", "the"}], " ", "cobination", " ", "of", 
    " ", "1", " ", "with", " ", "4", " ", "and", " ", "2", " ", "with", " ", 
    "3"}]}], "*)"}]], "Input",
 CellChangeTimes->{{3.8251432012240033`*^9, 3.8251432910807285`*^9}},
 CellLabel->"In[3]:=",ExpressionUUID->"91f012a2-2e45-41f2-a57b-44a6d32d3176"],

Cell[BoxData[
 RowBox[{
  RowBox[{"weight", "[", 
   RowBox[{
    RowBox[{"SpinorAngleBracket", "[", 
     RowBox[{"i_", ",", "j_"}], "]"}], ",", 
    RowBox[{"SpinorSquareBracket", "[", 
     RowBox[{"k_", ",", "l_"}], "]"}]}], "]"}], ":=", 
  RowBox[{"Which", "[", 
   RowBox[{
    RowBox[{"i", "===", "k"}], ",", "3", ",", 
    RowBox[{"j", "===", "k"}], ",", "2", ",", 
    RowBox[{"i", "===", "l"}], ",", "1", ",", 
    RowBox[{"j", "===", "l"}], ",", "4", ",", "True", ",", "0"}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.825143302413413*^9, 3.8251433054851465`*^9}},
 CellLabel->"In[4]:=",ExpressionUUID->"c11719b0-8546-46e3-be5b-74ceda5deda1"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "sqtest", " ", "checks", " ", "whther", " ", "all", " ", "the", " ", 
   "contractions", " ", "with", " ", "the", " ", "square", " ", "brackets", 
   " ", "are", " ", 
   RowBox[{"possible", ".", " ", "In"}], " ", "particular", " ", "you", " ", 
   "cannot", " ", "have", " ", "the", " ", "same", " ", "square", " ", 
   "bracket", " ", "whose", " ", "first", " ", "label", " ", "contract", " ", 
   "more", " ", "than", " ", "one", " ", "angle", " ", 
   RowBox[{"bracket", ".", " ", "This"}], " ", "is", " ", "checked", " ", 
   "by", " ", "looking", " ", "at", " ", "the", " ", 
   RowBox[{"labels", ".", " ", "The"}], " ", "implemented", " ", "test", " ", 
   "condition", " ", "proved", " ", "to", " ", "be", " ", "the", " ", 
   "fasted", " ", "I", " ", "could", " ", "find"}], "*)"}]], "Input",
 CellChangeTimes->{{3.825144134234501*^9, 3.82514417318128*^9}, {
  3.82514424038459*^9, 3.825144265550265*^9}, {3.825144692019476*^9, 
  3.825144705975103*^9}},
 CellLabel->"In[5]:=",ExpressionUUID->"4a7ef930-c8ec-49e4-8187-cd04adf2d8e8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"sqtest", "[", "exp_List", "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"Equal", "[", 
       RowBox[{
        RowBox[{"Length", "@", "#"}], ",", 
        RowBox[{"Length", "@", 
         RowBox[{"DeleteCases", "[", 
          RowBox[{"#", ",", 
           RowBox[{"_", "?", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"!", 
               RowBox[{"MatchQ", "[", 
                RowBox[{"#", ",", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"i_", ",", "j_"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"k_", ",", "l_"}], "}"}]}], "}"}], "/;", 
                    RowBox[{
                    RowBox[{"j", "\[NotEqual]", "l"}], "&&", 
                    RowBox[{
                    RowBox[{"j", "+", "l"}], "\[NotEqual]", "5"}]}]}], ")"}], 
                  "|", 
                  RowBox[{"{", 
                   RowBox[{"{", 
                    RowBox[{"_", ",", "_"}], "}"}], "}"}]}]}], "]"}]}], "&"}],
              ")"}]}]}], "]"}]}]}], "]"}], "&"}], "@", 
     RowBox[{"GatherBy", "[", 
      RowBox[{"#", ",", "First"}], "]"}]}], "&"}], "@", 
   RowBox[{"Flatten", "[", 
    RowBox[{"exp", ",", "1"}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.8251437337165213`*^9, 3.825143777064777*^9}, {
   3.825143925944586*^9, 3.825143993529765*^9}, {3.8251440566290536`*^9, 
   3.825144065285857*^9}, 3.8251446706525793`*^9, {3.825152291782591*^9, 
   3.82515229470875*^9}, {3.825163530430661*^9, 3.825163549741288*^9}},
 CellLabel->"In[6]:=",ExpressionUUID->"b9d9497f-8ba8-4cca-a971-8c6bd8a2d052"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "The", " ", "next", " ", "functions", " ", "build", " ", "all", " ", "the", 
   " ", "possible", " ", "pairings", " ", "of", " ", "contractions", " ", 
   "testing", " ", "the", " ", "square", " ", 
   RowBox[{"brackets", ".", " ", "I"}], " ", "use", " ", "Outer", " ", 
   "instead", " ", "of", " ", "Tuples", " ", "because", " ", "like", " ", 
   "this", " ", "I", " ", "can", " ", "perform", " ", "the", " ", "test", " ",
    "at", " ", "each", " ", "step", " ", "and", " ", "not", " ", "just", " ", 
   "at", " ", "the", " ", 
   RowBox[{"end", ".", " ", "For"}], " ", "large", " ", "number", " ", "of", 
   " ", "possible", " ", "contractions", " ", "with", " ", "many", " ", 
   "cancellations", " ", "this", " ", "should", " ", "speed", " ", "up", " ", 
   "the", " ", 
   RowBox[{"process", ".", " ", "In"}], " ", "simple", " ", "cases", " ", 
   "it", " ", "might", " ", "be", " ", "slower"}], "*)"}]], "Input",
 CellChangeTimes->{{3.8251532734611387`*^9, 3.825153351078512*^9}, {
  3.825153525268777*^9, 3.825153530183632*^9}},
 CellLabel->"In[7]:=",ExpressionUUID->"c6cbf0bb-0536-4ace-8337-f3cd2d47f6aa"],

Cell[BoxData[
 RowBox[{
  RowBox[{"pairing", "[", 
   RowBox[{"x_", ",", "y_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"sqtest", "[", "#", "]"}], ",", "#", ",", 
      RowBox[{"Nothing", "[", "]"}]}], "]"}], "&"}], "@", 
   RowBox[{"Join", "[", 
    RowBox[{"x", ",", 
     RowBox[{"{", "y", "}"}]}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.82514478020856*^9, 3.8251447833053293`*^9}, {
  3.825144817546748*^9, 3.8251448402901435`*^9}, {3.8251449372617846`*^9, 
  3.8251449992519736`*^9}, {3.825150697782158*^9, 3.825150698843295*^9}},
 CellLabel->"In[8]:=",ExpressionUUID->"affe3a6d-127d-4a53-bb28-fa36416aa146"],

Cell[BoxData[
 RowBox[{
  RowBox[{"allpairings", "[", "exp_List", "]"}], ":=", 
  RowBox[{"Fold", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Flatten", "[", 
      RowBox[{
       RowBox[{"Outer", "[", 
        RowBox[{"pairing", ",", "#1", ",", "#2", ",", "1"}], "]"}], ",", 
       "1"}], "]"}], "&"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"{", "#", "}"}], "&"}], "/@", 
     RowBox[{"(", 
      RowBox[{"First", "@", "exp"}], ")"}]}], ",", 
    RowBox[{"exp", "[", 
     RowBox[{"[", 
      RowBox[{"2", ";;"}], "]"}], "]"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.82515294362909*^9, 3.825152985796472*^9}},
 CellLabel->"In[9]:=",ExpressionUUID->"d749cb31-c9f3-4724-a541-fc7b5c92fd7c"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "allpairings", " ", "again", " ", "with", " ", "Tuples", " ", "an", " ", 
   "dcheck", " ", "at", " ", "the", " ", "end"}], "*)"}]], "Input",
 CellChangeTimes->{{3.825153269438916*^9, 3.82515327089896*^9}, {
  3.8251533804978204`*^9, 3.825153392141677*^9}},
 CellLabel->"In[10]:=",ExpressionUUID->"071df639-1c8a-4327-b2f7-6eb7beeb7d8f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"allpairingsTuples", "[", "exp_List", "]"}], ":=", 
  RowBox[{"DeleteCases", "[", 
   RowBox[{
    RowBox[{"Tuples", "@", "exp"}], ",", 
    RowBox[{"_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"!", 
        RowBox[{"sqtest", "[", "#", "]"}]}], "&"}], ")"}]}]}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.825153395367054*^9, 3.8251534576026335`*^9}, 
   3.8251534900530086`*^9},
 CellLabel->"In[11]:=",ExpressionUUID->"602629d7-4dae-470b-8d75-c88092fd4753"],

Cell[BoxData[
 RowBox[{
  RowBox[{"prova", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "2"}], "}"}]}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "4"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"2", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "4"}], "}"}]}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"6", ",", "1"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"6", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"6", ",", "3"}], "}"}]}], "}"}]}], "}"}]}], "}"}]}], 
  ";"}]], "Input",
 CellLabel->"In[12]:=",ExpressionUUID->"7947deff-53ce-472f-9d80-fb7c6b503376"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"allpairings", "[", "prova", "]"}], "//", 
  "RepeatedTiming"}]], "Input",
 CellChangeTimes->{{3.8251534691547556`*^9, 3.8251534734024973`*^9}, {
  3.8251535044175987`*^9, 3.825153509051197*^9}},
 CellLabel->"In[13]:=",ExpressionUUID->"4babc9ec-eb76-45d2-9330-5aef7e8710bf"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.000179067041015625`", ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "4"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"6", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"6", ",", "3"}], "}"}]}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"2", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "4"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"6", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"6", ",", "3"}], "}"}]}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "2"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "4"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"6", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"6", ",", "3"}], "}"}]}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "2"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"2", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "4"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"6", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"6", ",", "3"}], "}"}]}], "}"}]}], "}"}]}], "}"}]}], 
  "}"}]], "Output",
 CellChangeTimes->{3.825153474104622*^9, 3.825153511067807*^9, 
  3.825164773195465*^9, 3.8253931048000927`*^9},
 CellLabel->"Out[13]=",ExpressionUUID->"96a4b8d0-5008-4c7c-aefc-47e511d56f21"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"allpairingsTuples", "[", "prova", "]"}], "//", 
  "RepeatedTiming"}]], "Input",
 CellChangeTimes->{{3.825153475729328*^9, 3.8251534796129417`*^9}, {
  3.8251535133127985`*^9, 3.825153515169789*^9}},
 CellLabel->"In[14]:=",ExpressionUUID->"ab7cd208-6a52-47bf-968d-859d09c7a39b"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.0001491181396484375`", ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "4"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"6", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"6", ",", "3"}], "}"}]}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"2", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "4"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"6", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"6", ",", "3"}], "}"}]}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "2"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "4"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"6", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"6", ",", "3"}], "}"}]}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "2"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"2", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "4"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"6", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"6", ",", "3"}], "}"}]}], "}"}]}], "}"}]}], "}"}]}], 
  "}"}]], "Output",
 CellChangeTimes->{{3.8251534799839325`*^9, 3.825153517052747*^9}, 
   3.8251647746376033`*^9, 3.8253931061165743`*^9},
 CellLabel->"Out[14]=",ExpressionUUID->"0537d1e0-bbd0-4dc4-9dbe-1b4743bb8c62"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"test", "=", 
  RowBox[{"{", 
   RowBox[{
    TemplateBox[{"1", "2"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"3", "4"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"1", "4"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"2", "3"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"2", "4"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}]], "Input",
 CellChangeTimes->{{3.8251636674315357`*^9, 3.825163681442933*^9}, {
   3.8251637681189113`*^9, 3.825163770492757*^9}, 3.8251647781773605`*^9},
 CellLabel->"In[15]:=",ExpressionUUID->"93619ea9-8a8e-456b-bb5e-f07249f90412"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   TemplateBox[{"1", "2"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"3", "4"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"1", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"2", "3"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"2", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]], "Output",
 CellChangeTimes->{
  3.8251634573225718`*^9, 3.825163560467765*^9, {3.8251636682528763`*^9, 
   3.8251636837758813`*^9}, 3.8251637711720915`*^9, 3.8251647786792912`*^9, 
   3.825393106207359*^9},
 CellLabel->"Out[15]=",ExpressionUUID->"1f51b806-48c7-4d93-a3d6-61e6247a516d"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Block", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
    "exp", ",", "ag", ",", "sq", ",", "len", ",", "lenag", ",", "lensq", ",", 
     "allchains", ",", "local", ",", "array"}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"exp", "=", "test"}], ";", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{"Split", " ", "square", " ", "from", " ", 
      RowBox[{"angles", ".", " ", "The"}], " ", "expression", " ", "comes", 
      " ", "from", " ", "a", " ", "Times", " ", "so", " ", "it", " ", "will", 
      " ", "already", " ", "be", " ", "ordered", " ", "with", " ", "angles", 
      " ", "first"}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ag", ",", "sq"}], "}"}], "=", 
     RowBox[{"SplitBy", "[", 
      RowBox[{"exp", ",", "Head"}], "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"len", "=", 
     RowBox[{"Length", "[", "exp", "]"}]}], ";", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
     "lenag", " ", "and", " ", "lensq", " ", "will", " ", "be", " ", "used", 
      " ", "as", " ", "an", " ", "offset", " ", "later"}], "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{"lenag", "=", 
     RowBox[{"Length", "[", "ag", "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"lensq", "=", 
     RowBox[{"Length", "[", "sq", "]"}]}], ";", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{
      "allcontractions", " ", "gives", " ", "all", " ", "the", " ", 
       "possible", " ", "contractions", " ", "of", " ", "the", " ", "angles", 
       " ", "with", " ", "the", " ", 
       RowBox[{"squares", ".", " ", "Angles"}], " ", "are", " ", "labelled", 
       " ", "by", " ", "row", " ", "in", " ", "matrix"}], ",", " ", 
      RowBox[{"squares", " ", "by", " ", "explicit", " ", "label", " ", 
       RowBox[{"(", 
        RowBox[{
        "in", " ", "order", " ", "to", " ", "avoid", " ", "gigantic", " ", 
         "matrices"}], ")"}], " ", "and", " ", "second", " ", "label", " ", 
       "is", " ", 
       RowBox[{"weight", ".", " ", "We"}], " ", "remove", " ", "all", " ", 
       "the", " ", "terms", " ", "signaling", " ", "no", " ", "possible", " ",
        "contraction"}]}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{"allcontractions", "=", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"DeleteCases", "[", 
         RowBox[{"#", ",", 
          RowBox[{"{", 
           RowBox[{"_", ",", "0"}], "}"}]}], "]"}], "&"}], "/@", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"j", ",", 
           RowBox[{"weight", "[", 
            RowBox[{"i", ",", 
             RowBox[{"sq", "[", 
              RowBox[{"[", "j", "]"}], "]"}]}], "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "ag"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", "lensq"}], "}"}]}], "]"}]}], "//", "Echo"}]}], 
    ";", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{
      "Next", " ", "out", " ", "of", " ", "the", " ", "possible", " ", 
       "contractions", " ", "on", " ", "the", " ", "single", " ", "row", " ", 
       "we", " ", "take", " ", "pairs", " ", "of", " ", "compatibel", " ", 
       "contractions"}], ",", " ", 
      RowBox[{
      "so", " ", "first", " ", "take", " ", "Subsets", " ", "grouping", " ", 
       "by", " ", "2"}], ",", " ", 
      RowBox[{
      "then", " ", "delete", " ", "those", " ", "whose", " ", "associated", 
       " ", "weight", " ", "sum", " ", "is", " ", 
       RowBox[{"even", ".", " ", "The"}], " ", "weights", " ", "have", " ", 
       "been", " ", "assigned", " ", "exactly", " ", "in", " ", "such", " ", 
       "a", " ", "way", " ", "that", " ", "these", " ", "are", " ", "the", 
       " ", "forbidden", " ", 
       RowBox[{"cases", ".", " ", "Then"}], " ", "take", " ", "all", " ", 
       "the", " ", "possible", " ", "combinations", " ", "of", " ", "the", 
       " ", "allowed", " ", "contractions"}]}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{"allchains", "=", 
     RowBox[{"allpairings", "@", 
      RowBox[{"Echo", "@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"DeleteCases", "[", 
             RowBox[{"#", ",", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"i_", ",", "j_"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"k_", ",", "l_"}], "}"}]}], "}"}], "/;", 
               RowBox[{"EvenQ", "[", 
                RowBox[{"j", "+", "l"}], "]"}]}]}], "]"}], "&"}], "@", 
           RowBox[{"Subsets", "[", 
            RowBox[{"#", ",", 
             RowBox[{"{", "2", "}"}]}], "]"}]}], "&"}], "/@", 
         "allcontractions"}], ")"}]}]}]}]}]}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "Next", " ", "we", " ", "need", " ", "to", " ", "combine", " ", "these", 
    " ", "data", " ", "back", " ", "into", " ", "chains"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"local", "=", 
     RowBox[{"First", "@", "allchains"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"array", "=", 
     RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"Do", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"array", "=", 
        RowBox[{"Join", "[", 
         RowBox[{"array", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"i", ",", 
              RowBox[{"First", "@", "j"}]}], "}"}], "\[Rule]", 
            RowBox[{"Last", "@", "j"}]}], "}"}]}], "]"}]}], ";"}], 
      "\[IndentingNewLine]", "\[IndentingNewLine]", ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", 
        RowBox[{"Length", "[", "local", "]"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"j", ",", 
        RowBox[{"local", "[", 
         RowBox[{"[", "i", "]"}], "]"}]}], "}"}]}], "]"}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"WeightedAdjacencyGraph", "[", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"Normal", "@", 
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"PadRight", "[", 
              RowBox[{"#", ",", "5"}], "]"}], "&"}], "/@", 
            RowBox[{"SparseArray", "@", "array"}]}], ")"}], ",", 
          RowBox[{"ConstantArray", "[", 
           RowBox[{"0", ",", 
            RowBox[{"{", 
             RowBox[{"3", ",", "5"}], "}"}]}], "]"}]}], "]"}]}], ")"}], "/.", 
      RowBox[{"{", 
       RowBox[{"0", "\[Rule]", "\[Infinity]"}], "}"}]}], "]"}]}], "*)"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}]], "Input",
 CellChangeTimes->CompressedData["
1:eJwd0FtIE1AYB/DhwkBsy2nk5kpnopVJ6YQeNi3DDXM6vKBdxGbOxKXR9CHz
oVIyfZg075dcE2Oi6Jwwp5bKZs5kZamJaVio6LykdpklSbNo//Nw+HG+7zsf
hz8n/XbCDScKhcJ3HMhMWOzsfrAVsW8mVwetgzM9cGks3ghNx/ZboC66exy+
ch+wwjTtKMvg0KupwRum0IZ84Nk5RQA0CIYDoXzzwBk4XyQNgaarMTxYkF8W
Dsu7JBfgnjSHONXAj4Jx4VEi2KooeAi1udFKmJjMr4FHG5V18PhqiwqueQao
4UZSsgae6LhDjGlf0ZJ91d91cHiB8RpWSeTvob3DfRb+4skWIKPH/gfmOBns
cHpugtbjsMwjkg5HpVWHIPW32ZPcF1t8IWvZRlz8prgEORm0y/CxjJ4KPfjj
ROpIezqpF5/KhKrE0JswTx2aDS0/C/W9DvW1bn2wun9yEDK4yhFYr1uzwDbR
xAQUNhZ9gmxL7Ge4PXZk0oj3EfVTUDwjd33pcDeohQ7FpRJP6PNhmygvvS+A
G6vnL0JDcKQYaqLmiNY0n0Ro5MxegfrrJgV0HaVWwqnYzFpYoyrphJV3ZUbI
26kww+ww9Q58zl3ZheHeMuoS8uVoiCqe4TT8x/saCjUslnkVuaor30BBgItt
3WFGkt4OUzbdKF+Qc12JE/T/8dYZcv+aXaDKIqdDpjCbAZ80uxyG17z8mHDS
PcsXtvmm+sFnouCTpM+MDIFNwkAenB7jhsFy24CAzJ9zE8KQoD0pbC1azoBx
nX1Z0M++RZTkD9yCB0VDhTCPvfsIlq7cU0BTsVIJadaCchij6a2Dmnl2I9zK
71qAzuvzy2Q/52nHJv79Ll4L/SuGX8CPNnE//A9EixbK
  "],
 CellLabel->"In[16]:=",ExpressionUUID->"0f44609a-e7c8-4719-bff3-90fa1a6aa2d9"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "3"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"2", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "2"}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "4"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"2", ",", "1"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "4"}], "}"}]}], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.8253931062960577`*^9},ExpressionUUID->"f3ac5989-452c-4c04-9201-\
b69a8dad9c8b"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "3"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "3"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "2"}], "}"}]}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "4"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"2", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "4"}], "}"}]}], "}"}]}], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.8253931063290014`*^9},ExpressionUUID->"0efbe208-6fae-49a5-99e6-\
d2a287eddf93"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "3"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "4"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "1"}], "}"}]}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "3"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"2", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "4"}], "}"}]}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "3"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "2"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "4"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "1"}], "}"}]}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "3"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "2"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"2", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "4"}], "}"}]}], "}"}]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.8251599676102467`*^9, 3.825163458446469*^9, {3.8251635423006167`*^9, 
   3.82516356182518*^9}, 3.825163619574745*^9, 3.825163669722364*^9, {
   3.8251637109893055`*^9, 3.8251637316955423`*^9}, 3.825163772439803*^9, 
   3.825164780082508*^9, 3.825393106423764*^9},
 CellLabel->"Out[16]=",ExpressionUUID->"3c7ccc92-50e0-4e25-a04b-d4739fbbace4"]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"prova", "=", "%"}], ";"}]], "Input",
 CellChangeTimes->{{3.8251572307401285`*^9, 3.8251572328335743`*^9}},
 CellLabel->"In[17]:=",ExpressionUUID->"4f52a366-20cd-4679-806e-17c33a99114e"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Backcontracting lists into chains", "Subsubsection",
 CellChangeTimes->{{3.825157198695879*^9, 
  3.825157207535244*^9}},ExpressionUUID->"da8b10d0-786b-4cc2-b28d-\
a51a2bc08eb7"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"test", "=", 
  RowBox[{"{", 
   RowBox[{
    TemplateBox[{"1", "2"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"3", "4"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"5", "6"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"1", "4"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"2", "3"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"2", "4"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}]], "Input",
 CellChangeTimes->{{3.82515721001365*^9, 3.8251572166059856`*^9}, {
  3.8251633864662237`*^9, 3.8251633973733234`*^9}, {3.825163443039357*^9, 
  3.82516344635137*^9}},
 CellLabel->
  "In[398]:=",ExpressionUUID->"fad77fac-0ba8-4bdc-af9d-0a080890ed9c"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   TemplateBox[{"1", "2"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"3", "4"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"5", "6"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"1", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"2", "3"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"2", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]], "Output",
 CellChangeTimes->{{3.825157211720998*^9, 3.825157217567396*^9}, 
   3.8251633984759917`*^9, 3.8251634476704407`*^9},
 CellLabel->
  "Out[398]=",ExpressionUUID->"f1bb113c-db42-40f9-b3f7-31b8faafc9ff"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"prova", "[", 
  RowBox[{"[", "1", "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.825157245687153*^9, 3.825157246984681*^9}, {
  3.8251579994447446`*^9, 3.8251580109839993`*^9}, {3.8251596586055984`*^9, 
  3.8251596645220413`*^9}},
 CellLabel->
  "In[380]:=",ExpressionUUID->"f1360857-9435-4618-92b8-605f1aa40388"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "3"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "4"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"2", ",", "1"}], "}"}]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{3.825157247330752*^9, 3.8251580014333677`*^9, 
  3.825159664972301*^9},
 CellLabel->
  "Out[380]=",ExpressionUUID->"86020955-0164-4ed5-959a-db5fef796d97"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Block", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
    "ang", ",", "squ", ",", "exp", ",", "locexp", ",", "locexp2", ",", 
     "start", ",", "chain"}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ang", "=", 
     RowBox[{"{", 
      RowBox[{
       TemplateBox[{"1", "2"},
        "SpinorAngleBracket",
        DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
           RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
        InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
           RowBox[{#, ",", #2}], "]"}]& )], ",", 
       TemplateBox[{"3", "4"},
        "SpinorAngleBracket",
        DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
           RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
        InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
           RowBox[{#, ",", #2}], "]"}]& )], ",", 
       TemplateBox[{"5", "6"},
        "SpinorAngleBracket",
        DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
           RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
        InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
           RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"squ", "=", 
     RowBox[{"{", 
      RowBox[{
       TemplateBox[{"1", "4"},
        "SpinorSquareBracket",
        DisplayFunction->(RowBox[{"[", 
           RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
        InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
           RowBox[{#, ",", #2}], "]"}]& )], ",", 
       TemplateBox[{"2", "3"},
        "SpinorSquareBracket",
        DisplayFunction->(RowBox[{"[", 
           RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
        InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
           RowBox[{#, ",", #2}], "]"}]& )], ",", 
       TemplateBox[{"2", "4"},
        "SpinorSquareBracket",
        DisplayFunction->(RowBox[{"[", 
           RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
        InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
           RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"exp", "=", 
     RowBox[{"prova", "[", 
      RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
     "Add", " ", "in", " ", "the", " ", "labels", " ", "for", " ", "the", " ",
       "angle", " ", "brackets", " ", "and", " ", "flatten"}], "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{"locexp", "=", 
     RowBox[{
      RowBox[{"Flatten", "[", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Join", "[", 
             RowBox[{
              RowBox[{"{", "i", "}"}], ",", "#"}], "]"}], "&"}], "/@", 
           RowBox[{"exp", "[", 
            RowBox[{"[", "i", "]"}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"Length", "[", "exp", "]"}]}], "}"}]}], "]"}], ",", "1"}],
        "]"}], "//", "Echo"}]}], ";", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{"Find", " ", "a", " ", "starting", " ", 
       RowBox[{"point", ".", " ", "If"}], " ", "there", " ", "is", " ", "a", 
       " ", "list", " ", "with", " ", "single", " ", "contraction", " ", 
       "then", " ", "start", " ", "with", " ", "that", " ", "angle"}], ",", 
      " ", 
      RowBox[{
      "else", " ", "look", " ", "for", " ", "a", " ", "square", " ", "with", 
       " ", "single", " ", "contraction"}], ",", " ", 
      RowBox[{
      "if", " ", "neither", " ", "is", " ", "found", " ", "then", " ", "this",
        " ", "is", " ", "a", " ", "trace", " ", "and", " ", "we", " ", "pick",
        " ", "as", " ", "starting", " ", "point", " ", "the", " ", "first", 
       " ", "angle", " ", "in", " ", "the", " ", "bracket", " ", 
       RowBox[{"list", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{"Which", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Length", "@", 
        RowBox[{"(", 
         RowBox[{"start", "=", 
          RowBox[{"Position", "[", 
           RowBox[{"exp", ",", 
            RowBox[{"_", "?", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"Length", "[", "#", "]"}], "\[Equal]", "1"}], "&"}], 
              ")"}]}]}], "]"}]}], ")"}]}], ">", "1"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
         RowBox[{"There", " ", "is", " ", "a", " ", "non"}], "-", 
         RowBox[{"empty", " ", "angle", " ", "starting", " ", "point"}]}], 
        ",", " ", 
        RowBox[{
        "we", " ", "pick", " ", "the", " ", "first", " ", "of", " ", 
         "them"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"start", "=", 
        RowBox[{"start", "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";"}]}], 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}]], "Input",
 CellChangeTimes->{{3.8251597313176966`*^9, 3.825159742883895*^9}, {
   3.8251598739695387`*^9, 3.825159882067398*^9}, 3.825159921135315*^9, {
   3.8251599718024435`*^9, 3.825160001812622*^9}, {3.825160033694445*^9, 
   3.8251600815435996`*^9}, {3.825160173814666*^9, 3.8251602112288027`*^9}, {
   3.8251619088028545`*^9, 3.8251620733991294`*^9}, {3.825162130299917*^9, 
   3.825162149569343*^9}, {3.825162527748564*^9, 3.8251625301733875`*^9}, {
   3.8251627265204964`*^9, 3.8251627849575605`*^9}, {3.825162868461754*^9, 
   3.8251628726736975`*^9}, {3.8251629117182136`*^9, 
   3.8251629130718307`*^9}, {3.825162952017905*^9, 3.825163076391425*^9}, {
   3.8251631266599293`*^9, 3.8251631783687706`*^9}, {3.825163210248768*^9, 
   3.8251632409921393`*^9}, {3.8251632795067234`*^9, 
   3.8251632800356064`*^9}, {3.8251634062901926`*^9, 
   3.825163431334097*^9}},ExpressionUUID->"9567b47e-0ef8-42af-ad66-\
6d4479cfc1ae"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "2", ",", "2"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"2", ",", "1", ",", "4"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"2", ",", "2", ",", "1"}], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.8251632810186167`*^9},ExpressionUUID->"090fe2a2-2765-4f65-bfe2-\
63e84f6863ce"]
}, Open  ]],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.8251621098436403`*^9, 
  3.8251621273926625`*^9}},ExpressionUUID->"3553c785-41d5-4df5-a98d-\
0c9d46e4757a"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Position", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "3"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "4"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{"5", ",", "2"}], "}"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{"6", ",", "1"}], "}"}], "}"}]}], "}"}], ",", 
   RowBox[{"_", "?", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"Length", "[", "#", "]"}], "\[Equal]", "1"}], "&"}], ")"}]}]}],
   "]"}]], "Input",
 CellChangeTimes->{{3.8251627941732655`*^9, 3.825162840114855*^9}, {
  3.8251630600708213`*^9, 3.825163066389043*^9}},
 CellLabel->
  "In[394]:=",ExpressionUUID->"6cb4bf00-f8b1-4b5b-9c3f-26b4de9e6f11"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", "3", "}"}], ",", 
   RowBox[{"{", "4", "}"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.825162821811305*^9, 3.8251628405198298`*^9}, 
   3.825163066978759*^9},
 CellLabel->
  "Out[394]=",ExpressionUUID->"d9e65f77-a534-417e-bb36-36e438664e73"]
}, Open  ]]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Minimal Chains", "Subsection",
 CellChangeTimes->{{3.8251639975225277`*^9, 
  3.8251639996558323`*^9}},ExpressionUUID->"79e49348-546f-4c0b-a877-\
63124877de7c"],

Cell[CellGroupData[{

Cell["Auxiliary", "Subsubsection",
 CellChangeTimes->{{3.8251640036608715`*^9, 
  3.825164005188548*^9}},ExpressionUUID->"7349799a-8cf2-4e39-baa0-\
89990c4a5d29"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
   "Modified", " ", "weight", " ", "function", " ", "swapping", " ", "cases", 
    " ", "1", " ", "and", " ", "3"}], ",", " ", 
   RowBox[{
   "so", " ", "that", " ", "angle", " ", "test", " ", "still", " ", "forbids",
     " ", "even", " ", "cases", " ", "and", " ", "square", " ", "test", " ", 
    "forbids", " ", "summing", " ", "to", " ", "5", " ", 
    RowBox[{"i", ".", "e", ".", " ", "the"}], " ", "cobination", " ", "of", 
    " ", "1", " ", "with", " ", "4", " ", "and", " ", "2", " ", "with", " ", 
    "3"}]}], "*)"}]], "Input",
 CellChangeTimes->{{3.8251432012240033`*^9, 3.8251432910807285`*^9}},
 CellLabel->"In[2]:=",ExpressionUUID->"f0b89020-eb87-489f-b2a6-bde74138c29d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"weight", "[", 
   RowBox[{
    RowBox[{"SpinorAngleBracket", "[", 
     RowBox[{"i_", ",", "j_"}], "]"}], ",", 
    RowBox[{"SpinorSquareBracket", "[", 
     RowBox[{"k_", ",", "l_"}], "]"}]}], "]"}], ":=", 
  RowBox[{"Which", "[", 
   RowBox[{
    RowBox[{"i", "===", "k"}], ",", "3", ",", 
    RowBox[{"j", "===", "k"}], ",", "2", ",", 
    RowBox[{"i", "===", "l"}], ",", "1", ",", 
    RowBox[{"j", "===", "l"}], ",", "4", ",", "True", ",", "0"}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.825143302413413*^9, 3.8251433054851465`*^9}},
 CellLabel->"In[3]:=",ExpressionUUID->"9e47bf8f-f8b5-4586-8109-148afb9caa98"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "sqtest", " ", "checks", " ", "whther", " ", "all", " ", "the", " ", 
   "contractions", " ", "with", " ", "the", " ", "square", " ", "brackets", 
   " ", "are", " ", 
   RowBox[{"possible", ".", " ", "In"}], " ", "particular", " ", "you", " ", 
   "cannot", " ", "have", " ", "the", " ", "same", " ", "square", " ", 
   "bracket", " ", "whose", " ", "first", " ", "label", " ", "contract", " ", 
   "more", " ", "than", " ", "one", " ", "angle", " ", 
   RowBox[{"bracket", ".", " ", "This"}], " ", "is", " ", "checked", " ", 
   "by", " ", "looking", " ", "at", " ", "the", " ", 
   RowBox[{"labels", ".", " ", "The"}], " ", "implemented", " ", "test", " ", 
   "condition", " ", "proved", " ", "to", " ", "be", " ", "the", " ", 
   "fasted", " ", "I", " ", "could", " ", "find"}], "*)"}]], "Input",
 CellChangeTimes->{{3.825144134234501*^9, 3.82514417318128*^9}, {
  3.82514424038459*^9, 3.825144265550265*^9}, {3.825144692019476*^9, 
  3.825144705975103*^9}},
 CellLabel->"In[4]:=",ExpressionUUID->"f1d32236-018d-43b1-81b0-d29ada18b7c8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"sqtest", "[", "exp_List", "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"Equal", "[", 
       RowBox[{
        RowBox[{"Length", "@", "#"}], ",", 
        RowBox[{"Length", "@", 
         RowBox[{"DeleteCases", "[", 
          RowBox[{"#", ",", 
           RowBox[{"_", "?", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"!", 
               RowBox[{"MatchQ", "[", 
                RowBox[{"#", ",", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"_", ",", "i_", ",", "j_"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"_", ",", "k_", ",", "l_"}], "}"}]}], "}"}], "/;", 
                    RowBox[{
                    RowBox[{"j", "\[NotEqual]", "l"}], "&&", 
                    RowBox[{
                    RowBox[{"j", "+", "l"}], "\[NotEqual]", "5"}]}]}], ")"}], 
                  "|", 
                  RowBox[{"{", 
                   RowBox[{"{", 
                    RowBox[{"_", ",", "_", ",", "_"}], "}"}], "}"}]}]}], 
                "]"}]}], "&"}], ")"}]}]}], "]"}]}]}], "]"}], "&"}], "@", 
     RowBox[{"GatherBy", "[", 
      RowBox[{"#", ",", 
       RowBox[{
        RowBox[{"Part", "[", 
         RowBox[{"#", ",", "2"}], "]"}], "&"}]}], "]"}]}], "&"}], "@", 
   RowBox[{"Flatten", "[", 
    RowBox[{"exp", ",", "1"}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.8251649220877457`*^9, 3.8251649884554443`*^9}},
 CellLabel->"In[5]:=",ExpressionUUID->"09ef332f-33cc-4cfd-b9e4-ad4e9a5cc9de"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "The", " ", "next", " ", "functions", " ", "build", " ", "all", " ", "the", 
   " ", "possible", " ", "pairings", " ", "of", " ", "contractions", " ", 
   "testing", " ", "the", " ", "square", " ", 
   RowBox[{"brackets", ".", " ", "I"}], " ", "use", " ", "Outer", " ", 
   "instead", " ", "of", " ", "Tuples", " ", "because", " ", "like", " ", 
   "this", " ", "I", " ", "can", " ", "perform", " ", "the", " ", "test", " ",
    "at", " ", "each", " ", "step", " ", "and", " ", "not", " ", "just", " ", 
   "at", " ", "the", " ", 
   RowBox[{"end", ".", " ", "For"}], " ", "large", " ", "number", " ", "of", 
   " ", "possible", " ", "contractions", " ", "with", " ", "many", " ", 
   "cancellations", " ", "this", " ", "should", " ", "speed", " ", "up", " ", 
   "the", " ", 
   RowBox[{"process", ".", " ", "In"}], " ", "simple", " ", "cases", " ", 
   "it", " ", "might", " ", "be", " ", "slower"}], "*)"}]], "Input",
 CellChangeTimes->{{3.8251532734611387`*^9, 3.825153351078512*^9}, {
  3.825153525268777*^9, 3.825153530183632*^9}},
 CellLabel->"In[6]:=",ExpressionUUID->"e9a61ed0-c242-41b3-a360-66f26bfcca20"],

Cell[BoxData[
 RowBox[{
  RowBox[{"pairing", "[", 
   RowBox[{"x_", ",", "y_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"sqtest", "[", "#", "]"}], ",", "#", ",", 
      RowBox[{"Nothing", "[", "]"}]}], "]"}], "&"}], "@", 
   RowBox[{"Join", "[", 
    RowBox[{"x", ",", 
     RowBox[{"{", "y", "}"}]}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.82514478020856*^9, 3.8251447833053293`*^9}, {
  3.825144817546748*^9, 3.8251448402901435`*^9}, {3.8251449372617846`*^9, 
  3.8251449992519736`*^9}, {3.825150697782158*^9, 3.825150698843295*^9}},
 CellLabel->"In[7]:=",ExpressionUUID->"9cbf6444-75be-43dd-93e9-3dee8f7dd8bb"],

Cell[BoxData[
 RowBox[{
  RowBox[{"allpairings", "[", "exp_List", "]"}], ":=", 
  RowBox[{"Fold", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Flatten", "[", 
      RowBox[{
       RowBox[{"Outer", "[", 
        RowBox[{"pairing", ",", "#1", ",", "#2", ",", "1"}], "]"}], ",", 
       "1"}], "]"}], "&"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"{", "#", "}"}], "&"}], "/@", 
     RowBox[{"(", 
      RowBox[{"First", "@", "exp"}], ")"}]}], ",", 
    RowBox[{"exp", "[", 
     RowBox[{"[", 
      RowBox[{"2", ";;"}], "]"}], "]"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.82515294362909*^9, 3.825152985796472*^9}},
 CellLabel->"In[8]:=",ExpressionUUID->"6915ba72-a6c7-4387-8eb2-2d49187e538d"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "allpairings", " ", "again", " ", "with", " ", "Tuples", " ", "an", " ", 
   "dcheck", " ", "at", " ", "the", " ", "end"}], "*)"}]], "Input",
 CellChangeTimes->{{3.825153269438916*^9, 3.82515327089896*^9}, {
  3.8251533804978204`*^9, 3.825153392141677*^9}},
 CellLabel->"In[9]:=",ExpressionUUID->"02fad05c-d511-489f-b263-c963bbee73cb"],

Cell[BoxData[
 RowBox[{
  RowBox[{"allpairingsTuples", "[", "exp_List", "]"}], ":=", 
  RowBox[{"DeleteCases", "[", 
   RowBox[{
    RowBox[{"Tuples", "@", "exp"}], ",", 
    RowBox[{"_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"!", 
        RowBox[{"sqtest", "[", "#", "]"}]}], "&"}], ")"}]}]}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.825153395367054*^9, 3.8251534576026335`*^9}, 
   3.8251534900530086`*^9},
 CellLabel->"In[10]:=",ExpressionUUID->"9fee38d5-44c5-4da9-973a-2d300fc123e9"]
}, Closed]],

Cell[CellGroupData[{

Cell["Chains in list form", "Subsubsection",
 CellChangeTimes->{{3.8251651362062316`*^9, 
  3.825165138985119*^9}},ExpressionUUID->"7f839706-9bf5-4180-834d-\
5539779c8d99"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"test", "=", 
  RowBox[{"{", 
   RowBox[{
    TemplateBox[{"1", "2"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"5", "6"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"3", "4"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"1", "4"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"2", "3"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"2", "4"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}]], "Input",
 CellLabel->"In[27]:=",ExpressionUUID->"9dc83312-1bcb-4361-9c25-66a71a73e659"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   TemplateBox[{"1", "2"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"5", "6"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"3", "4"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"1", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"2", "3"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"2", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]], "Output",
 CellChangeTimes->{3.825164820237111*^9, 3.825393134779908*^9},
 CellLabel->"Out[27]=",ExpressionUUID->"491f9ab4-753e-4e56-b158-baab2c1a8ce7"]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"chainLists", "[", "exp_List", "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "ag", ",", "sq", ",", "len", ",", "lenag", ",", "lensq", ",", 
       "allchains", ",", "local"}], "}"}], ",", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Split", " ", "square", " ", "from", " ", 
       RowBox[{"angles", ".", " ", "The"}], " ", "expression", " ", "comes", 
       " ", "from", " ", "a", " ", "Times", " ", "so", " ", "it", " ", "will",
        " ", "already", " ", "be", " ", "ordered", " ", "with", " ", "angles",
        " ", "first"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"ag", ",", "sq"}], "}"}], "=", 
       RowBox[{"SplitBy", "[", 
        RowBox[{"exp", ",", "Head"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"len", "=", 
       RowBox[{"Length", "[", "exp", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "lenag", " ", "and", " ", "lensq", " ", "will", " ", "be", " ", "used",
         " ", "as", " ", "an", " ", "offset", " ", "later"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"lenag", "=", 
       RowBox[{"Length", "[", "ag", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"lensq", "=", 
       RowBox[{"Length", "[", "sq", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "allcontractions", " ", "gives", " ", "all", " ", "the", " ", 
         "possible", " ", "contractions", " ", "of", " ", "the", " ", 
         "angles", " ", "with", " ", "the", " ", 
         RowBox[{"squares", ".", " ", "Angles"}], " ", "are", " ", "labelled",
          " ", "by", " ", "row", " ", "in", " ", "matrix"}], ",", " ", 
        RowBox[{"squares", " ", "by", " ", "explicit", " ", "label", " ", 
         RowBox[{"(", 
          RowBox[{
          "in", " ", "order", " ", "to", " ", "avoid", " ", "gigantic", " ", 
           "matrices"}], ")"}], " ", "and", " ", "second", " ", "label", " ", 
         "is", " ", 
         RowBox[{"weight", ".", " ", "We"}], " ", "remove", " ", "all", " ", 
         "the", " ", "terms", " ", "signaling", " ", "no", " ", "possible", 
         " ", "contraction"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"allchains", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"DeleteCases", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", "}"}]}], "]"}], "&"}], "@", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"DeleteCases", "[", 
            RowBox[{"#", ",", 
             RowBox[{"{", 
              RowBox[{"_", ",", "_", ",", "0"}], "}"}]}], "]"}], "&"}], "/@", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"i", ",", "j", ",", 
              RowBox[{"weight", "[", 
               RowBox[{
                RowBox[{"ag", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], ",", 
                RowBox[{"sq", "[", 
                 RowBox[{"[", "j", "]"}], "]"}]}], "]"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "lenag"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "lensq"}], "}"}]}], "]"}]}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Next", " ", "out", " ", "of", " ", "the", " ", "possible", " ", 
         "contractions", " ", "on", " ", "the", " ", "single", " ", "row", 
         " ", "we", " ", "take", " ", "pairs", " ", "of", " ", "compatibel", 
         " ", "contractions"}], ",", " ", 
        RowBox[{
        "so", " ", "first", " ", "take", " ", "Subsets", " ", "grouping", " ",
          "by", " ", "2"}], ",", " ", 
        RowBox[{
        "then", " ", "delete", " ", "those", " ", "whose", " ", "associated", 
         " ", "weight", " ", "sum", " ", "is", " ", 
         RowBox[{"even", ".", " ", "The"}], " ", "weights", " ", "have", " ", 
         "been", " ", "assigned", " ", "exactly", " ", "in", " ", "such", " ",
          "a", " ", "way", " ", "that", " ", "these", " ", "are", " ", "the", 
         " ", "forbidden", " ", 
         RowBox[{"cases", ".", " ", "Then"}], " ", "take", " ", "all", " ", 
         "the", " ", "possible", " ", "combinations", " ", "of", " ", "the", 
         " ", "allowed", " ", "contractions"}]}], "*)"}], 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"allchains", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "#", "]"}], ">", "1"}], ",", 
           RowBox[{"Subsets", "[", 
            RowBox[{"#", ",", 
             RowBox[{"{", "2", "}"}]}], "]"}], ",", 
           RowBox[{"{", "#", "}"}]}], "]"}], "&"}], "/@", "allchains"}]}], 
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"allchains", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{"#", ",", "1"}], "]"}], "&"}], "/@", 
        RowBox[{"allpairings", "@", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"DeleteCases", "[", 
             RowBox[{"#", ",", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"_", ",", "_", ",", "j_"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"_", ",", "_", ",", "l_"}], "}"}]}], "}"}], "/;", 
               RowBox[{"EvenQ", "[", 
                RowBox[{"j", "+", "l"}], "]"}]}]}], "]"}], "&"}], "/@", 
           "allchains"}], ")"}]}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "allchains", "]"}], ";"}]}], 
    "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellChangeTimes->CompressedData["
1:eJwd0H0s1HEcB3DRkOnksDwVh6VSU8fW2nlIYeShdEvJdOouc5SOP0gpjPjj
rPPYFZdWnWUezuI85MzTyS6ETDQa5s7jncsp69bRuvfvj+9e+34+n+9n370p
t+9fuWNoYGAQqj/Q7spCY0u2KmDvVKoIKrqmWuHicFQ37HE1kUHRxZZR+MlK
ooDxDYP2Yr0Or186wVhSrzM8M8N1h+Kgfg/IUe4/BedymVTYcyOcBjMzivxg
cRPjPNxh3iWceOkTAi/7hYTB99zMPNiQepEH6dE+FfBwFY8Pjy7XCOCKrXs1
XL8aLYTH6tMJw+uWGoh95T9FsH+e/BmWMThfoa7eahr+prHnIblV9xfeNRTr
4OTMGKlVb5F1oAUcZJbZQKM/UlvivlDjAu3lGsIFNfcapLBI1+EztkUctPYZ
JTQaqLtN1PNPJEAB3TsJplV7J0PZr5zmNr3Nzy3bYXnneBcke/EG4AvRigzW
ho2NweCq3FnoKIv4AbeGD413433AiwkYOcUx79OrPVljASMLGbbQ+dsWIafw
SRBcXz4XCsWnAyOhMGSGUBHvTIfdlOkY2HyrhwvNB41K4UREwnNYIShohKUP
2N2Qtl0ihcm+1duww2tJC/2c2EaLyJciJBTQxJ7wH23DGwrt7aXLyLW6dAgG
uZtpVvWyrjbrYKzS0mANOfMLDOGRzRFj6LUrNYMCGccC2gUnk2HlG7OD8KaD
mx0ct0p0gbUucW7wbdjp40TfLpAKXwd70ODksJcvLNZIgoh5f8tgSD25w4Tv
c+UseLmxPRG66VSEjAzJPXggrDcHpjlqn8LCpcdc2JPP40GSIrMYhgvb+FA4
51gFVRlN89B4dU5O7Ke8qlfi31+iGuCRkv6P8LsmshMmyVuU0NxzSAsLZrNM
VXqlVY/2wUZxjBXcy1LbwHTJbjws2tSwYHbeu074MIU0Auv8FXI4E2urgB/6
LqzCrrNphCGdoSq4FcdWw0oyVQtTGK6GG8i/IMcE0i/NmsIEY64S8rNkakLR
2B41cjfuMIXUr/UOUOK65gT/A1UlkDA=
  "],
 CellLabel->"In[28]:=",ExpressionUUID->"73820956-7205-4744-83fa-714bba676f0c"],

Cell[CellGroupData[{

Cell[BoxData["test"], "Input",
 CellChangeTimes->{{3.8251684042907324`*^9, 3.8251684046717625`*^9}},
 CellLabel->"In[29]:=",ExpressionUUID->"f188a48b-9903-4a3d-a45c-65e237c3b66e"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   TemplateBox[{"1", "2"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"5", "6"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"3", "4"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"1", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"2", "3"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"2", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]], "Output",
 CellChangeTimes->{{3.825168405821635*^9, 3.8251684251532993`*^9}, 
   3.8251684558701878`*^9, 3.8251686099031587`*^9, 3.8253931349354925`*^9},
 CellLabel->"Out[29]=",ExpressionUUID->"678ff485-9c0e-489b-970c-6cdf0ccfe6de"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"chainLists", "[", "test", "]"}]], "Input",
 CellChangeTimes->{{3.825165910110802*^9, 3.825165914695469*^9}},
 CellLabel->"In[30]:=",ExpressionUUID->"5c2206c0-61d3-4270-8ea1-310a513b20a3"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "2", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "1", ",", "4"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "2", ",", "1"}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "2", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "2", ",", "1"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "3", ",", "4"}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "3", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "1", ",", "4"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "2", ",", "1"}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "3", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "2", ",", "1"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "3", ",", "4"}], "}"}]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.825165915533532*^9, 3.82516592201421*^9}, {
   3.825168407214944*^9, 3.8251684260638695`*^9}, 3.825168456778751*^9, 
   3.825168611101992*^9, 3.8251686422376757`*^9, 3.8253931350142465`*^9},
 CellLabel->"Out[30]=",ExpressionUUID->"2bc04dcb-180f-4713-93c3-ed373f95cfb4"]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"prova", "=", "%"}], ";"}]], "Input",
 CellChangeTimes->{{3.825165175453541*^9, 3.8251651780322256`*^9}},
 CellLabel->"In[31]:=",ExpressionUUID->"cbc60f29-7613-48e7-b9cd-626a5ffa76da"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"test1", "=", 
  RowBox[{"{", 
   RowBox[{
    TemplateBox[{"1", "2"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"5", "6"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"2", "3"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"6", "7"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}], "\[IndentingNewLine]", 
 RowBox[{"prova", "=", 
  RowBox[{"chainLists", "[", "%", "]"}]}]}], "Input",
 CellLabel->"In[32]:=",ExpressionUUID->"820d4616-ce44-4a4e-9947-a6a495108348"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   TemplateBox[{"1", "2"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"5", "6"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"2", "3"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"6", "7"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]], "Output",
 CellChangeTimes->{
  3.825166376061287*^9, 3.8251664115695224`*^9, {3.8251682279242444`*^9, 
   3.825168252288084*^9}, 3.825168616869527*^9, 3.8251686490973287`*^9, 
   3.8253931351109896`*^9},
 CellLabel->"Out[32]=",ExpressionUUID->"c7b040d1-a120-49a3-9fa3-6f18ed95ba79"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"1", ",", "1", ",", "2"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"2", ",", "2", ",", "2"}], "}"}]}], "}"}], "}"}]], "Output",
 CellChangeTimes->{
  3.825166376061287*^9, 3.8251664115695224`*^9, {3.8251682279242444`*^9, 
   3.825168252288084*^9}, 3.825168616869527*^9, 3.8251686490973287`*^9, 
   3.825393135117007*^9},
 CellLabel->"Out[33]=",ExpressionUUID->"41ef3ad6-3fd7-4715-a5a4-ff86659a0ee3"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData["test"], "Input",
 CellChangeTimes->{{3.8251683418534937`*^9, 3.8251683422484894`*^9}},
 CellLabel->"In[34]:=",ExpressionUUID->"aef50401-f602-4e9f-b9f9-84f3bb73bdd5"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   TemplateBox[{"1", "2"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"5", "6"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"3", "4"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"1", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"2", "3"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"2", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]], "Output",
 CellChangeTimes->{3.8251683434612226`*^9, 3.8253931351977587`*^9},
 CellLabel->"Out[34]=",ExpressionUUID->"1cb7119c-e632-4437-8924-172d9db16a39"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"chainLists", "[", "test", "]"}], "//", "RepeatedTiming"}]], "Input",
 CellChangeTimes->{{3.825168173917036*^9, 3.8251681778520217`*^9}, {
  3.8251682870390987`*^9, 3.8251682958525686`*^9}, {3.825169345131594*^9, 
  3.82516934776055*^9}},
 CellLabel->"In[35]:=",ExpressionUUID->"c135a4f8-0363-4692-b33c-426a1ba5df7b"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.000156035205078125`", ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "2", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "1", ",", "4"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "2", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "2", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "2", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "3", ",", "4"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "3", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "1", ",", "4"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "2", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "3", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "2", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "3", ",", "4"}], "}"}]}], "}"}]}], "}"}]}], 
  "}"}]], "Output",
 CellChangeTimes->{
  3.8251681787307067`*^9, 3.8251682593371906`*^9, {3.825168291563995*^9, 
   3.82516829647491*^9}, {3.825169337633634*^9, 3.8251693494410553`*^9}, 
   3.825393136515266*^9},
 CellLabel->"Out[35]=",ExpressionUUID->"2bb01e87-2454-4914-83a0-3ba35d745dea"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["From lists to actual chains", "Subsubsection",
 CellChangeTimes->{{3.8251651460490255`*^9, 
  3.82516515155346*^9}},ExpressionUUID->"66422402-52ed-4dca-bd7b-\
28a0c26163e2"],

Cell[CellGroupData[{

Cell[BoxData["test"], "Input",
 CellChangeTimes->{{3.8251651942373724`*^9, 3.82516519553053*^9}},
 CellLabel->
  "In[460]:=",ExpressionUUID->"91883e36-d022-4335-a9ec-56c28972c02b"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   TemplateBox[{"1", "2"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"5", "6"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"3", "4"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"1", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"2", "3"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"2", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]], "Output",
 CellChangeTimes->{3.82516519625334*^9},
 CellLabel->
  "Out[460]=",ExpressionUUID->"023ac98b-c3ef-44e6-b81f-c5f706204454"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"test1", "=", 
  RowBox[{"{", 
   RowBox[{
    TemplateBox[{"1", "2"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"5", "6"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"2", "3"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"6", "7"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}], "\[IndentingNewLine]", 
 RowBox[{"prova", "=", 
  RowBox[{"chainLists", "[", "%", "]"}]}]}], "Input",
 CellChangeTimes->{{3.8251659296286077`*^9, 3.8251659437839336`*^9}, {
  3.825166006895773*^9, 3.82516603739062*^9}, {3.8251660832153482`*^9, 
  3.825166091263855*^9}},
 CellLabel->
  "In[534]:=",ExpressionUUID->"15fab165-a8f9-4038-97e7-f974e2c98d32"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   TemplateBox[{"1", "2"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"5", "6"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"2", "3"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"6", "7"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]], "Output",
 CellChangeTimes->{
  3.825166038905334*^9, {3.825166091978799*^9, 3.825166121926569*^9}, 
   3.8251661529587297`*^9, 3.8251661851900406`*^9, 3.825166332748014*^9, 
   3.8251686560377984`*^9},
 CellLabel->
  "Out[534]=",ExpressionUUID->"86cd1233-29f5-4073-a592-05402398db50"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"1", ",", "1", ",", "2"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"2", ",", "2", ",", "2"}], "}"}]}], "}"}], "}"}]], "Output",
 CellChangeTimes->{
  3.825166038905334*^9, {3.825166091978799*^9, 3.825166121926569*^9}, 
   3.8251661529587297`*^9, 3.8251661851900406`*^9, 3.825166332748014*^9, 
   3.8251686560447817`*^9},
 CellLabel->
  "Out[535]=",ExpressionUUID->"46e64888-552c-4312-a8bf-ad4bdea25e32"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Block", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
    "ang", ",", "squ", ",", "exp", ",", "agstart", ",", "sqstart", ",", 
     "localstart", ",", "chains", ",", "localchain", ",", "next", ",", "sign",
      ",", "type"}], "}"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]",
    "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"exp", "=", 
     RowBox[{
      RowBox[{"prova", "[", 
       RowBox[{"[", "1", "]"}], "]"}], "//", "Echo"}]}], ";", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{"Not", " ", "external", " ", "data"}], ",", " ", 
      RowBox[{"get", " ", "modified", " ", "later", " ", "on"}]}], "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ang", ",", "squ"}], "}"}], "=", 
     RowBox[{"GatherBy", "[", 
      RowBox[{"test1", ",", "Head"}], "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
     "Convert", " ", "brackets", " ", "into", " ", "lists", " ", "of", " ", 
      "arguments"}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{"ang", "=", 
     RowBox[{"List", "@@@", "ang"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"squ", "=", 
     RowBox[{"List", "@@@", "squ"}]}], ";", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{"Find", " ", "a", " ", "starting", " ", 
       RowBox[{"point", ".", " ", "If"}], " ", "there", " ", "is", " ", "a", 
       " ", "list", " ", "with", " ", "single", " ", "contraction", " ", 
       "then", " ", "start", " ", "with", " ", "that", " ", "angle"}], ",", 
      " ", 
      RowBox[{
      "else", " ", "look", " ", "for", " ", "a", " ", "square", " ", "with", 
       " ", "single", " ", "contraction"}], ",", " ", 
      RowBox[{
      "if", " ", "neither", " ", "is", " ", "found", " ", "then", " ", "this",
        " ", "is", " ", "a", " ", "trace", " ", "and", " ", "we", " ", "pick",
        " ", "as", " ", "starting", " ", "point", " ", "the", " ", "first", 
       " ", "angle", " ", "in", " ", "the", " ", "bracket", " ", 
       RowBox[{"list", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"agstart", ",", "sqstart"}], "}"}], "=", 
     RowBox[{
      RowBox[{
       RowBox[{"Map", "[", 
        RowBox[{"First", ",", "#", ",", 
         RowBox[{"{", "2", "}"}]}], "]"}], "&"}], "@", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"Select", "[", 
          RowBox[{"#", ",", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"Last", "[", "#", "]"}], "\[Equal]", "1"}], "&"}], 
            ")"}]}], "]"}], "&"}], "/@", 
        RowBox[{"(", 
         RowBox[{"Tally", "/@", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"Transpose", "@", "exp"}], ")"}], "[", 
            RowBox[{"[", 
             RowBox[{";;", "2"}], "]"}], "]"}], ")"}]}], ")"}]}], ")"}]}]}], 
    ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{
      "First", " ", "we", " ", "address", " ", "the", " ", "angle", " ", 
       "starting", " ", "points"}], ",", " ", 
      RowBox[{"then", " ", "the", " ", "squares"}], ",", " ", 
      RowBox[{
      "and", " ", "once", " ", "all", " ", "those", " ", "are", " ", "done", 
       " ", "we", " ", "build", " ", "the", " ", "traces", " ", 
       RowBox[{"(", 
        RowBox[{
        "what", " ", "is", " ", "left", " ", "has", " ", "the", " ", "no", 
         " ", "helicity", " ", "so", " ", "must", " ", "be", " ", "traces"}], 
        ")"}]}]}], "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"chains", "=", 
     RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{"TO", " ", "BE", " ", "LOOPED"}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{"While", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Length", "[", "agstart", "]"}], ">", "0"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"localstart", "=", 
        RowBox[{
         RowBox[{"First", "@", "agstart"}], "//", "Echo"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"next", "=", 
        RowBox[{
         RowBox[{"First", "@", 
          RowBox[{"Cases", "[", 
           RowBox[{"exp", ",", 
            RowBox[{"{", 
             RowBox[{"localstart", ",", "_", ",", "_"}], "}"}], ",", "1", ",",
             "1"}], "]"}]}], "//", "Echo"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"sign", "=", "1"}], ";", "\[IndentingNewLine]", 
       RowBox[{"localchain", "=", 
        RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "As", " ", "long", " ", "as", " ", "there", " ", "is", " ", "a", " ", 
         "next", " ", "bracket", " ", "keep", " ", "looping"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"While", "[", 
        RowBox[{"True", ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"type", "=", 
           RowBox[{"Last", "@", "next"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{
            "THIS", " ", "SELECTION", " ", "OF", " ", "THE", " ", "ORDERING", 
             " ", "IS", " ", "PROBABLY", " ", "WRONG"}], ",", " ", 
            RowBox[{
            "THE", " ", "ORDERING", " ", "DEPENDS", " ", "ON", " ", "WHETHER",
              " ", "WE", " ", "ARE", " ", "LOOKING", " ", "FOR", " ", "AN", 
             " ", "ANGLE", " ", "OR", " ", "SQUARE", " ", "BRACKET", " ", 
             "NEXT"}]}], "*)"}], "\[IndentingNewLine]", 
          RowBox[{"Which", "[", 
           RowBox[{
            RowBox[{"type", "\[Equal]", "1"}], ",", "\[IndentingNewLine]", 
            RowBox[{"localchain", "=", 
             RowBox[{"Join", "[", 
              RowBox[{"localchain", ",", 
               RowBox[{"Reverse", "[", 
                RowBox[{"ang", "[", 
                 RowBox[{"[", 
                  RowBox[{"First", "@", "next"}], "]"}], "]"}], "]"}]}], 
              "]"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"type", "\[Equal]", "2"}], ",", "\[IndentingNewLine]", 
            RowBox[{"localchain", "=", 
             RowBox[{"Join", "[", 
              RowBox[{"localchain", ",", 
               RowBox[{"ang", "[", 
                RowBox[{"[", 
                 RowBox[{"First", "@", "next"}], "]"}], "]"}]}], "]"}]}], ",",
             "\[IndentingNewLine]", 
            RowBox[{"type", "\[Equal]", "3"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"localchain", "=", 
              RowBox[{"Join", "[", 
               RowBox[{"localchain", ",", 
                RowBox[{"Reverse", "[", 
                 RowBox[{"ang", "[", 
                  RowBox[{"[", 
                   RowBox[{"First", "@", "next"}], "]"}], "]"}], "]"}]}], 
               "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"sign", "=", 
              RowBox[{
               RowBox[{"-", "1"}], "*", "sign"}]}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"type", "\[Equal]", "4"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"localchain", "=", 
              RowBox[{"Join", "[", 
               RowBox[{"localchain", ",", 
                RowBox[{"ang", "[", 
                 RowBox[{"[", 
                  RowBox[{"First", "@", "next"}], "]"}], "]"}]}], "]"}]}], 
             ";", "\[IndentingNewLine]", 
             RowBox[{"sign", "=", 
              RowBox[{
               RowBox[{"-", "1"}], "*", "sign"}]}], ";"}]}], 
           "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
           "Now", " ", "we", " ", "need", " ", "to", " ", "select", " ", 
            "the", " ", "next", " ", 
            RowBox[{"bracket", ".", " ", "This"}], " ", "depends", " ", "on", 
            " ", "whether", " ", "we", " ", "are", " ", "looking", " ", "for",
             " ", "an", " ", "angle", " ", "or", " ", "a", " ", 
            RowBox[{"square", "."}]}], "*)"}], "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"OddQ", "[", 
             RowBox[{"Length", "[", "localchain", "]"}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{
             "On", " ", "the", " ", "odd", " ", "iterations", " ", "we", " ", 
              "are", " ", "looking", " ", "for", " ", "a", " ", "next", " ", 
              "angle", " ", "bracket"}], "*)"}], "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"localstart", "=", "next"}], ";", "\[IndentingNewLine]", 
             RowBox[{"next", "=", 
              RowBox[{"First", "@", 
               RowBox[{"Cases", "[", 
                RowBox[{"exp", ",", 
                 RowBox[{"{", 
                  RowBox[{"_", ",", 
                   RowBox[{"next", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ",", "_"}], "}"}], ",", 
                 "1", ",", "1"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{
              "If", " ", "there", " ", "is", " ", "no", " ", "bracket", " ", 
               "break", " ", "the", " ", "While", " ", "and", " ", "build", 
               " ", "the", " ", "chain"}], "*)"}], "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Length", "[", "next", "]"}], "\[Equal]", "0"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"localchain", "=", 
                 RowBox[{"Flatten", "[", "localchain", "]"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"(*", 
                 RowBox[{"build", " ", "the", " ", 
                  RowBox[{"chain", ".", " ", "Sign"}], " ", "of", " ", 
                  "possible", " ", "reordering", " ", "already", " ", 
                  "accounted", " ", "for"}], "*)"}], "\[IndentingNewLine]", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"Equal", "[", 
                   RowBox[{
                    RowBox[{"Last", "@", "localstart"}], ",", 
                    RowBox[{"1", "|", "4"}]}], "]"}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"chains", "=", 
                    RowBox[{"Join", "[", 
                    RowBox[{"chains", ",", 
                    RowBox[{"{", 
                    RowBox[{"sign", "*", 
                    RowBox[{"Chain", "[", 
                    RowBox[{"$angle", ",", 
                    RowBox[{"First", "@", "localchain"}], ",", 
                    RowBox[{"localchain", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ";;"}], "]"}], "]"}], ",", 
                    RowBox[{"Last", "@", 
                    RowBox[{"squ", "[", 
                    RowBox[{"[", 
                    RowBox[{"localstart", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}]}], ",", 
                    "$square"}], "]"}]}], "}"}]}], "]"}]}], ";"}], 
                  "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"chains", "=", 
                    RowBox[{"Join", "[", 
                    RowBox[{"chains", ",", 
                    RowBox[{"{", 
                    RowBox[{"sign", "*", 
                    RowBox[{"Chain", "[", 
                    RowBox[{"$angle", ",", 
                    RowBox[{"First", "@", "localchain"}], ",", 
                    RowBox[{"localchain", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ";;"}], "]"}], "]"}], ",", 
                    RowBox[{"First", "@", 
                    RowBox[{"squ", "[", 
                    RowBox[{"[", 
                    RowBox[{"localstart", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}]}], ",", 
                    "$square"}], "]"}]}], "}"}]}], "]"}]}], ";"}]}], 
                 "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
                "\[IndentingNewLine]", 
                RowBox[{"Break", "[", "]"}], ";"}]}], "\[IndentingNewLine]", 
              "]"}], ";"}], "\[IndentingNewLine]", ","}], 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
            "On", " ", "the", " ", "even", " ", "iterations", " ", "we", " ", 
             "look"}], "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
           "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"Break", "[", "]"}]}]}], "\[IndentingNewLine]", "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Break", "[", "]"}]}]}], "\[IndentingNewLine]", "\n", "]"}], 
    ";"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "This", " ", "must", " ", "be", " ", "looped", " ", "until", " ", "no", 
    " ", "chains", " ", "can", " ", "be", " ", "possibly", " ", "made"}], 
   "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellChangeTimes->{{3.8251597313176966`*^9, 3.825159742883895*^9}, {
   3.8251598739695387`*^9, 3.825159882067398*^9}, 3.825159921135315*^9, {
   3.8251599718024435`*^9, 3.825160001812622*^9}, {3.825160033694445*^9, 
   3.8251600815435996`*^9}, {3.825160173814666*^9, 3.8251602112288027`*^9}, {
   3.8251619088028545`*^9, 3.8251620733991294`*^9}, {3.825162130299917*^9, 
   3.825162149569343*^9}, {3.825162527748564*^9, 3.8251625301733875`*^9}, {
   3.8251627265204964`*^9, 3.8251627849575605`*^9}, {3.825162868461754*^9, 
   3.8251628726736975`*^9}, {3.8251629117182136`*^9, 
   3.8251629130718307`*^9}, {3.825162952017905*^9, 3.825163076391425*^9}, {
   3.8251631266599293`*^9, 3.8251631783687706`*^9}, {3.825163210248768*^9, 
   3.8251632409921393`*^9}, {3.8251632795067234`*^9, 
   3.8251632800356064`*^9}, {3.8251634062901926`*^9, 3.825163431334097*^9}, {
   3.8251652005505714`*^9, 3.825165451938518*^9}, {3.8251654916881404`*^9, 
   3.825165543174811*^9}, {3.8251655861875257`*^9, 3.825165661287017*^9}, {
   3.8251660583954782`*^9, 3.8251660803511515`*^9}, {3.825168670453084*^9, 
   3.8251687338817034`*^9}, {3.8251687714571877`*^9, 
   3.8251688796966667`*^9}, {3.825168941843418*^9, 3.8251689419840775`*^9}, {
   3.8251690054448814`*^9, 3.8251690118418293`*^9}, {3.8251691059227123`*^9, 
   3.825169113517365*^9}, {3.8251691504456315`*^9, 3.8251691696968503`*^9}, {
   3.825169260578786*^9, 3.8251692840370255`*^9}, {3.825393308308804*^9, 
   3.825393310581687*^9}, {3.8253934454127045`*^9, 3.825393480257964*^9}, {
   3.825393525680462*^9, 3.8253935999319096`*^9}, {3.825394743526125*^9, 
   3.825394833284596*^9}, {3.8253949397448564`*^9, 3.825395000888319*^9}, {
   3.825395374876413*^9, 3.825395436564458*^9}, {3.8253960887144403`*^9, 
   3.8253961391932154`*^9}, {3.8253961756108108`*^9, 
   3.8253962528621173`*^9}, {3.825396307172258*^9, 3.825396317006035*^9}, {
   3.825396357263356*^9, 3.825396395145028*^9}, {3.825396448580668*^9, 
   3.82539647737763*^9}, {3.825396563614452*^9, 3.825396563755084*^9}, {
   3.8253965990626755`*^9, 3.8253966218626966`*^9}, {3.8253967685263696`*^9, 
   3.825396781708165*^9}, {3.8253974896817236`*^9, 3.8253975506735487`*^9}, {
   3.8253976137827606`*^9, 3.82539761428347*^9}, {3.8253980185531435`*^9, 
   3.8253980455439806`*^9}, {3.825398077134465*^9, 3.825398077761837*^9}, {
   3.825398479449423*^9, 3.8253985100735493`*^9}, {3.825398567387273*^9, 
   3.8253985975232553`*^9}, {3.8253986352992268`*^9, 
   3.8253987716582828`*^9}, {3.825398856287985*^9, 3.82539896299356*^9}, {
   3.8253989981485004`*^9, 3.8253991044830956`*^9}, {3.8254008132358646`*^9, 
   3.8254008150799913`*^9}, 3.82540085194932*^9, {3.8254009260232573`*^9, 
   3.8254009406061945`*^9}, {3.8254018436153173`*^9, 
   3.8254020987949567`*^9}, {3.825402208440734*^9, 3.8254025066888027`*^9}, {
   3.8254025483164644`*^9, 3.8254027206009645`*^9}, {3.825402797981058*^9, 
   3.8254028274412594`*^9}, {3.82540288682139*^9, 
   3.825402922685497*^9}},ExpressionUUID->"93c33be6-d962-40b5-8910-\
03adf08f5e91"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"1", ",", "1", ",", "2"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"2", ",", "2", ",", "2"}], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.8254009339340453`*^9},ExpressionUUID->"6da3516a-ff62-41df-b479-\
b7de56ab8c6d"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"1", ",", "2"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "2"}], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.825400934004862*^9},ExpressionUUID->"cc0bf77c-c872-4932-92f1-\
32a57c72ab73"],

Cell[BoxData["1"], "Echo",
 CellChangeTimes->{
  3.8254009340856357`*^9},ExpressionUUID->"bf0eb77f-e6bc-48df-a365-\
2c81a312c3d6"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"1", ",", "1", ",", "2"}], "}"}]], "Echo",
 CellChangeTimes->{
  3.8254009341514993`*^9},ExpressionUUID->"64351556-df69-4783-82a4-\
bef81f1e2f6d"]
}, Open  ]]
}, Open  ]],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"DIFFERENT", " ", 
    RowBox[{"APPROACH", ":", " ", 
     RowBox[{
     "I", " ", "COULD", " ", "JUST", " ", "START", " ", "FROM", " ", "A", " ",
       "GIVEN", " ", "BRACKET"}]}]}], ",", " ", 
   RowBox[{
   "PUT", " ", "IT", " ", "INTO", " ", "A", " ", "LIST", " ", "AND", " ", 
    "THEN", " ", "APPEND", " ", "BRACKETS", " ", "LEFT", " ", "AND", " ", 
    "RIGHT", " ", "BASED", " ", "ON", " ", "WHERE", " ", "THESE", " ", "ARE", 
    " ", "ATTACHED", " ", "AND", " ", "SEUBSEQUENTLY", " ", "REMOVING", " ", 
    "THE", " ", "PERFORMED", " ", "CONTRACTION", " ", "FROM", " ", "THE", " ",
     "LIST", " ", "OF", " ", "CONTRACTIONS"}]}], "*)"}]], "Input",
 CellChangeTimes->{{3.825169489249177*^9, 
  3.825169590640935*^9}},ExpressionUUID->"046dfe26-1d5f-4a75-90cc-\
c795282d5b01"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Take", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"1", ",", "2", ",", "3"}], "}"}], ",", 
   RowBox[{"UpTo", "[", "5", "]"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.8253934986398005`*^9, 3.825393515446836*^9}},
 CellLabel->"In[37]:=",ExpressionUUID->"9f3d9c57-4905-4f40-96b5-253c5a83dfe2"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"1", ",", "2", ",", "3"}], "}"}]], "Output",
 CellChangeTimes->{{3.825393513282652*^9, 3.8253935157630196`*^9}},
 CellLabel->"Out[37]=",ExpressionUUID->"6ee57057-9a69-4399-90f6-320f85f1afa9"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"Range", "[", "10", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"DeleteCases", "[", 
   RowBox[{"%", ",", "3"}], "]"}], "//", "RepeatedTiming"}]}], "Input",
 CellChangeTimes->{{3.8253942866647325`*^9, 3.8253943168429675`*^9}, {
  3.8253945737606153`*^9, 3.8253945903323355`*^9}, {3.8253947186097145`*^9, 
  3.825394719525268*^9}},
 CellLabel->"In[53]:=",ExpressionUUID->"c57da927-85ed-4620-8f8c-78a668b26667"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"2.3852649688720702`*^-6", ",", 
   RowBox[{"{", 
    RowBox[{
    "1", ",", "2", ",", "4", ",", "5", ",", "6", ",", "7", ",", "8", ",", "9",
      ",", "10"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.825394302958102*^9, 3.8253943188346868`*^9}, {
   3.825394575789767*^9, 3.8253945919021344`*^9}, 3.825394721171859*^9},
 CellLabel->"Out[54]=",ExpressionUUID->"e7434b62-e9aa-49c8-b232-108d2a22527b"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"Range", "[", "10", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Complement", "[", 
   RowBox[{"%", ",", 
    RowBox[{"{", "3", "}"}]}], "]"}], "//", "RepeatedTiming"}]}], "Input",
 CellChangeTimes->{{3.8253943420585256`*^9, 3.8253943505443487`*^9}, {
  3.8253945787623806`*^9, 3.8253945947535095`*^9}, {3.825394725232049*^9, 
  3.8253947261874475`*^9}},
 CellLabel->"In[55]:=",ExpressionUUID->"1438ee28-c534-4c31-aec9-5d05e0ea364d"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"1.8107933044433594`*^-6", ",", 
   RowBox[{"{", 
    RowBox[{
    "1", ",", "2", ",", "4", ",", "5", ",", "6", ",", "7", ",", "8", ",", "9",
      ",", "10"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.8253943536769667`*^9, {3.82539458038298*^9, 3.825394596159746*^9}, 
   3.825394727556782*^9},
 CellLabel->"Out[56]=",ExpressionUUID->"aaf7eb4f-1837-4e6f-abb4-bd64135201a7"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"aptest", "=", 
   RowBox[{"{", 
    RowBox[{"1", ",", "2", ",", "3"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"AppendTo", "[", 
   RowBox[{"aptest", ",", "4"}], "]"}], "//", "RepeatedTiming"}]}], "Input",
 CellChangeTimes->{{3.8253950221205316`*^9, 3.8253950706690326`*^9}},
 CellLabel->"In[59]:=",ExpressionUUID->"ee3f44cb-71fe-443e-ad42-6a79ab1efc93"],

Cell[BoxData[
 InterpretationBox[
  TagBox[
   FrameBox[GridBox[{
      {
       ItemBox[
        TagBox[
         RowBox[{"{", 
          RowBox[{"0.00008584522705078125`", ",", 
           RowBox[{"{", 
            RowBox[{
            "1", ",", "2", ",", "3", ",", "4", ",", "4", ",", "4", ",", "4", 
             ",", "4", ",", "4", ",", "4", ",", "4", ",", "4", ",", "4", ",", 
             "4", ",", "4", ",", "4", ",", "4", ",", "4", ",", "4", ",", "4", 
             ",", "4", ",", "4", ",", "4", ",", "4", ",", "4", ",", "4", ",", 
             "4", ",", "4", ",", "4", ",", "4", ",", "4", ",", "4", ",", "4", 
             ",", "4", ",", "4", ",", "4", ",", "4", ",", "4", ",", "4", ",", 
             "4", ",", "4", ",", "4", ",", "4", ",", "4", ",", "4", ",", "4", 
             ",", "4", ",", "4", ",", "4", ",", "4", ",", "4", ",", "4", ",", 
             "4", ",", "4", ",", "4", ",", "4", ",", "4", ",", "4", ",", "4", 
             ",", "4", ",", "4", ",", "4", ",", "4", ",", "4", ",", "4", ",", 
             "4", ",", "4", ",", "4", ",", "4", ",", "4", ",", "4", ",", "4", 
             ",", "4", ",", "4", ",", "4", ",", "4", ",", "4", ",", "4", ",", 
             "4", ",", "4", ",", "4", ",", "4", ",", "4", ",", "4", ",", "4", 
             ",", "4", ",", "4", ",", "4", ",", "4", ",", "4", ",", "4", ",", 
             "4", ",", 
             TemplateBox[{"32588"},
              "OutputSizeLimit`Skeleton"], ",", "4", ",", "4", ",", "4", ",", 
             "4", ",", "4", ",", "4", ",", "4", ",", "4", ",", "4", ",", "4", 
             ",", "4", ",", "4", ",", "4", ",", "4", ",", "4", ",", "4", ",", 
             "4", ",", "4", ",", "4", ",", "4", ",", "4", ",", "4", ",", "4", 
             ",", "4", ",", "4", ",", "4", ",", "4", ",", "4", ",", "4", ",", 
             "4", ",", "4", ",", "4", ",", "4", ",", "4", ",", "4", ",", "4", 
             ",", "4", ",", "4", ",", "4", ",", "4", ",", "4", ",", "4", ",", 
             "4", ",", "4", ",", "4", ",", "4", ",", "4", ",", "4", ",", "4", 
             ",", "4", ",", "4", ",", "4", ",", "4", ",", "4", ",", "4", ",", 
             "4", ",", "4", ",", "4", ",", "4", ",", "4", ",", "4", ",", "4", 
             ",", "4", ",", "4", ",", "4", ",", "4", ",", "4", ",", "4", ",", 
             "4", ",", "4", ",", "4", ",", "4", ",", "4", ",", "4", ",", "4", 
             ",", "4", ",", "4", ",", "4", ",", "4", ",", "4", ",", "4", ",", 
             "4", ",", "4", ",", "4", ",", "4", ",", "4", ",", "4", ",", "4", 
             ",", "4", ",", "4", ",", "4"}], "}"}]}], "}"}],
         Short[#, 5]& ],
        BaseStyle->{Deployed -> False},
        StripOnInput->False]},
      {GridBox[{
         {
          PaneBox[
           TagBox[
            TooltipBox[
             StyleBox[
              StyleBox[
               DynamicBox[ToBoxes[
                 FEPrivate`FrontEndResource[
                 "FEStrings", "sizeBriefExplanation"], StandardForm],
                ImageSizeCache->{44.1, {2., 6.}}],
               StripOnInput->False,
               DynamicUpdating->True,
               LineSpacing->{1, 2},
               LineIndent->0,
               LinebreakAdjustments->{1., 100, 0, 0, 0}], "OSLText",
              StripOnInput->False],
             StyleBox[
              DynamicBox[
               ToBoxes[
                FEPrivate`FrontEndResource["FEStrings", "sizeExplanation"], 
                StandardForm]], DynamicUpdating -> True, LineIndent -> 0, 
              LinebreakAdjustments -> {1., 100, 0, 0, 0}, 
              LineSpacing -> {1, 2}, StripOnInput -> False]],
            Annotation[#, 
             Style[
              Dynamic[
               FEPrivate`FrontEndResource["FEStrings", "sizeExplanation"]], 
              DynamicUpdating -> True, LineIndent -> 0, 
              LinebreakAdjustments -> {1., 100, 0, 0, 0}, 
              LineSpacing -> {1, 2}], "Tooltip"]& ],
           Alignment->Center,
           BaselinePosition->Baseline,
           ImageSize->{Automatic, {25, Full}}], 
          ButtonBox[
           PaneSelectorBox[{False->
            StyleBox[
             StyleBox[
              DynamicBox[ToBoxes[
                FEPrivate`FrontEndResource["FEStrings", "sizeShowLess"], 
                StandardForm],
               ImageSizeCache->{36.300000000000004`, {1., 6.}}],
              StripOnInput->False,
              DynamicUpdating->True,
              LineSpacing->{1, 2},
              LineIndent->0,
              LinebreakAdjustments->{1., 100, 0, 0, 0}], "OSLControl",
             StripOnInput->False], True->
            StyleBox[
             StyleBox[
              DynamicBox[ToBoxes[
                FEPrivate`FrontEndResource["FEStrings", "sizeShowLess"], 
                StandardForm]],
              StripOnInput->False,
              DynamicUpdating->True,
              LineSpacing->{1, 2},
              LineIndent->0,
              LinebreakAdjustments->{1., 100, 0, 0, 0}], "OSLControlActive",
             StripOnInput->False]}, Dynamic[
             CurrentValue["MouseOver"]],
            Alignment->Center,
            FrameMargins->0,
            ImageSize->{Automatic, {25, Full}}],
           Appearance->None,
           BaselinePosition->Baseline,
           
           ButtonFunction:>OutputSizeLimit`ButtonFunction[
            OutputSizeLimit`Defer, 60, 25258196171467412332, 5/2],
           Enabled->True,
           Evaluator->Automatic,
           Method->"Queued"], 
          ButtonBox[
           PaneSelectorBox[{False->
            StyleBox[
             StyleBox[
              DynamicBox[ToBoxes[
                FEPrivate`FrontEndResource["FEStrings", "sizeShowMore"], 
                StandardForm],
               ImageSizeCache->{42.6, {1., 6.}}],
              StripOnInput->False,
              DynamicUpdating->True,
              LineSpacing->{1, 2},
              LineIndent->0,
              LinebreakAdjustments->{1., 100, 0, 0, 0}], "OSLControl",
             StripOnInput->False], True->
            StyleBox[
             StyleBox[
              DynamicBox[ToBoxes[
                FEPrivate`FrontEndResource["FEStrings", "sizeShowMore"], 
                StandardForm]],
              StripOnInput->False,
              DynamicUpdating->True,
              LineSpacing->{1, 2},
              LineIndent->0,
              LinebreakAdjustments->{1., 100, 0, 0, 0}], "OSLControlActive",
             StripOnInput->False]}, Dynamic[
             CurrentValue["MouseOver"]],
            Alignment->Center,
            FrameMargins->0,
            ImageSize->{Automatic, {25, Full}}],
           Appearance->None,
           BaselinePosition->Baseline,
           
           ButtonFunction:>OutputSizeLimit`ButtonFunction[
            OutputSizeLimit`Defer, 60, 25258196171467412332, 5 2],
           Enabled->True,
           Evaluator->Automatic,
           Method->"Queued"], 
          ButtonBox[
           PaneSelectorBox[{False->
            StyleBox[
             StyleBox[
              DynamicBox[ToBoxes[
                FEPrivate`FrontEndResource["FEStrings", "sizeShowAll"], 
                StandardForm],
               ImageSizeCache->{31.500000000000004`, {1., 6.}}],
              StripOnInput->False,
              DynamicUpdating->True,
              LineSpacing->{1, 2},
              LineIndent->0,
              LinebreakAdjustments->{1., 100, 0, 0, 0}], "OSLControl",
             StripOnInput->False], True->
            StyleBox[
             StyleBox[
              DynamicBox[ToBoxes[
                FEPrivate`FrontEndResource["FEStrings", "sizeShowAll"], 
                StandardForm]],
              StripOnInput->False,
              DynamicUpdating->True,
              LineSpacing->{1, 2},
              LineIndent->0,
              LinebreakAdjustments->{1., 100, 0, 0, 0}], "OSLControlActive",
             StripOnInput->False]}, Dynamic[
             CurrentValue["MouseOver"]],
            Alignment->Center,
            FrameMargins->0,
            ImageSize->{Automatic, {25, Full}}],
           Appearance->None,
           BaselinePosition->Baseline,
           
           ButtonFunction:>OutputSizeLimit`ButtonFunction[
            OutputSizeLimit`Defer, 60, 25258196171467412332, Infinity],
           Enabled->True,
           Evaluator->Automatic,
           Method->"Queued"], 
          ButtonBox[
           PaneSelectorBox[{False->
            StyleBox[
             StyleBox[
              DynamicBox[ToBoxes[
                FEPrivate`FrontEndResource["FEStrings", "sizeChangeLimit"], 
                StandardForm],
               ImageSizeCache->{54.3, {1., 6.}}],
              StripOnInput->False,
              DynamicUpdating->True,
              LineSpacing->{1, 2},
              LineIndent->0,
              LinebreakAdjustments->{1., 100, 0, 0, 0}], "OSLControl",
             StripOnInput->False], True->
            StyleBox[
             StyleBox[
              DynamicBox[ToBoxes[
                FEPrivate`FrontEndResource["FEStrings", "sizeChangeLimit"], 
                StandardForm]],
              StripOnInput->False,
              DynamicUpdating->True,
              LineSpacing->{1, 2},
              LineIndent->0,
              LinebreakAdjustments->{1., 100, 0, 0, 0}], "OSLControlActive",
             StripOnInput->False]}, Dynamic[
             CurrentValue["MouseOver"]],
            Alignment->Center,
            FrameMargins->0,
            ImageSize->{Automatic, {25, Full}}],
           Appearance->None,
           BaselinePosition->Baseline,
           ButtonFunction:>FrontEndExecute[{
              FrontEnd`SetOptions[
              FrontEnd`$FrontEnd, 
               FrontEnd`PreferencesSettings -> {"Page" -> "Advanced"}], 
              FrontEnd`FrontEndToken["PreferencesDialog"]}],
           Evaluator->None,
           Method->"Preemptive"]}
        },
        AutoDelete->False,
        FrameStyle->GrayLevel[0.85],
        GridBoxDividers->{"Columns" -> {False, {True}}},
        GridBoxItemSize->{"Columns" -> {{Automatic}}, "Rows" -> {{Automatic}}},
        GridBoxSpacings->{"Columns" -> {{2}}}]}
     },
     DefaultBaseStyle->"Column",
     GridBoxAlignment->{"Columns" -> {{Left}}, "Rows" -> {{Baseline}}},
     GridBoxDividers->{"Columns" -> {{False}}, "Rows" -> {{False}}},
     GridBoxItemSize->{"Columns" -> {{Automatic}}, "Rows" -> {{1.}}},
     GridBoxSpacings->{"Columns" -> {
         Offset[0.27999999999999997`], {
          Offset[0.5599999999999999]}, 
         Offset[0.27999999999999997`]}, "Rows" -> {
         Offset[0.2], 
         Offset[1.2], {
          Offset[0.4]}, 
         Offset[0.2]}}],
    BaseStyle->"OutputSizeLimit",
    FrameMargins->{{12, 12}, {0, 15}},
    FrameStyle->GrayLevel[0.85],
    RoundingRadius->5,
    StripOnInput->False],
   Deploy,
   DefaultBaseStyle->"Deploy"],
  If[25258196171467412332 === $SessionID, 
   Out[60], Message[
     MessageName[Syntax, "noinfoker"]]; Missing["NotAvailable"]; 
   Null]]], "Output",
 CellChangeTimes->{{3.8253950595935144`*^9, 3.8253950729180155`*^9}},
 CellLabel->"Out[60]=",ExpressionUUID->"1c056646-fe0e-40b9-9823-4536a93cf541"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"Join", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"1", ",", "2", ",", "3"}], "}"}], ",", 
    RowBox[{"{", "4", "}"}]}], "]"}], "//", "RepeatedTiming"}]], "Input",
 CellChangeTimes->{{3.825395084077171*^9, 3.825395094803482*^9}},
 CellLabel->"In[61]:=",ExpressionUUID->"b1acf3c2-8775-4dcc-aeb0-662290be580c"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"1.9678750038146972`*^-7", ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "2", ",", "3", ",", "4"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{3.8253950970704165`*^9},
 CellLabel->"Out[61]=",ExpressionUUID->"a93730aa-2ee1-4e5f-8e1e-e28bdd5a73c4"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"Range", "[", "10", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"MemberQ", "[", 
   RowBox[{"%", ",", "9"}], "]"}], "//", "RepeatedTiming"}]}], "Input",
 CellChangeTimes->{{3.8253952658579507`*^9, 3.8253953212079034`*^9}},
 CellLabel->"In[68]:=",ExpressionUUID->"11cbd907-23a2-491f-982c-1d3008dc2da7"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"1.8851131439208983`*^-6", ",", "True"}], "}"}]], "Output",
 CellChangeTimes->{{3.8253952843325615`*^9, 3.8253953235586133`*^9}},
 CellLabel->"Out[69]=",ExpressionUUID->"6bdb06c1-473b-44f1-aa1e-b167e0533201"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Take", "[", 
  RowBox[{
   RowBox[{"{", "}"}], ",", 
   RowBox[{"UpTo", "[", "1", "]"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.825395449416082*^9, 3.8253954559770823`*^9}},
 CellLabel->"In[71]:=",ExpressionUUID->"40f5a1f3-6358-49d7-af05-13711e821a80"],

Cell[BoxData[
 RowBox[{"{", "}"}]], "Output",
 CellChangeTimes->{3.825395456249442*^9},
 CellLabel->"Out[71]=",ExpressionUUID->"6a1b98df-11ab-45a4-b947-8a3c50ce5e3c"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Cases", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "1", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"2", ",", "2", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "1", ",", "3"}], "}"}]}], "}"}], ",", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"1", ",", "x_", ",", "y_"}], "}"}], "\[RuleDelayed]", 
    RowBox[{"{", 
     RowBox[{"x", ",", "y"}], "}"}]}], ",", "1", ",", "1"}], "]"}]], "Input",
 CellChangeTimes->{{3.825397175276518*^9, 3.825397200793216*^9}, {
  3.825397281882391*^9, 3.82539733395811*^9}},
 CellLabel->"In[88]:=",ExpressionUUID->"6652efb4-087d-4bde-96cf-46a7529d58b8"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"{", 
   RowBox[{"1", ",", "2"}], "}"}], "}"}]], "Output",
 CellChangeTimes->{
  3.825397201084489*^9, {3.8253972870545516`*^9, 3.8253973342413864`*^9}},
 CellLabel->"Out[88]=",ExpressionUUID->"e6ad1acf-6ac4-4994-8300-e284aa76cac6"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"{", 
   RowBox[{"ts1", ",", "ts2"}], "}"}], "=", 
  RowBox[{"{", "}"}]}]], "Input",
 CellChangeTimes->{{3.825397589748042*^9, 3.825397597766615*^9}},
 CellLabel->"In[90]:=",ExpressionUUID->"6182bb20-3480-4318-a70b-16e570c7b6f1"],

Cell[BoxData[
 TemplateBox[{
  "Set", "shape", 
   "\"Lists \\!\\(\\*RowBox[{\\\"{\\\", RowBox[{\\\"ts1\\\", \\\",\\\", \
\\\"ts2\\\"}], \\\"}\\\"}]\\) and \\!\\(\\*RowBox[{\\\"{\\\", \\\"}\\\"}]\\) \
are not the same shape.\"", 2, 90, 1, 25258196171467412332, "Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{3.8253975982932177`*^9},
 CellLabel->
  "During evaluation of \
In[90]:=",ExpressionUUID->"86b506d5-8b69-413a-b2d5-caaaef70b178"],

Cell[BoxData[
 RowBox[{"{", "}"}]], "Output",
 CellChangeTimes->{3.825397598350029*^9},
 CellLabel->"Out[90]=",ExpressionUUID->"26c01aee-0075-44b4-ba4e-e49aee607f2b"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"?", "Equal"}]], "Input",
 CellChangeTimes->{{3.825402252589616*^9, 3.825402254072648*^9}},
 CellLabel->
  "In[109]:=",ExpressionUUID->"934e2db9-c958-4b31-a9c3-d17148ab0be7"],

Cell[BoxData[
 InterpretationBox[
  StyleBox[
   FrameBox[
    DynamicModuleBox[{System`InformationDump`open$$ = False, 
     System`InformationDump`mouseOver$$ = False}, 
     PaneSelectorBox[{True->
      TagBox[GridBox[{
         {
          ItemBox[
           PaneBox[
            StyleBox["\<\" Symbol\"\>", "InformationTitleText",
             StripOnInput->False,
             BaseStyle -> None],
            FrameMargins->{{4, 0}, {-1, 1}}],
           BaseStyle->"InformationTitleBackground",
           StripOnInput->False], 
          ItemBox[
           PaneBox[
            TooltipBox[
             ButtonBox[
              PaneSelectorBox[{False->
               
               DynamicBox[FEPrivate`FrontEndResource[
                "FEBitmaps", "InformationHelpIcon"]], True->
               
               DynamicBox[FEPrivate`FrontEndResource[
                "FEBitmaps", "InformationHelpIconHot"]]}, Dynamic[
                CurrentValue["MouseOver"]]],
              Appearance->None,
              BaseStyle->"Link",
              ButtonData->"paclet:ref/Equal",
              ButtonNote->"paclet:ref/Equal"],
             "\"paclet:ref/Equal\""],
            FrameMargins->{{0, 4}, {0, 2}}],
           BaseStyle->"InformationTitleBackground",
           StripOnInput->False]},
         {
          ItemBox[
           PaneBox[
            
            StyleBox["\<\"\\!\\(\\*RowBox[{StyleBox[\\\"lhs\\\", \\\"TI\\\"], \
\\\"==\\\", StyleBox[\\\"rhs\\\", \\\"TI\\\"]}]\\) returns True if \
\\!\\(\\*StyleBox[\\\"lhs\\\", \\\"TI\\\"]\\) and \\!\\(\\*StyleBox[\\\"rhs\\\
\", \\\"TI\\\"]\\) are identical. \"\>", "InformationUsageText",
             StripOnInput->False,
             LineSpacing->{1.5, 1.5, 3.}],
            FrameMargins->{{10, 10}, {8, 10}}],
           BaseStyle->"InformationUsageSubtitleBackground",
           StripOnInput->False], 
          ItemBox["\<\"\"\>",
           BaseStyle->"InformationUsageSubtitleBackground",
           StripOnInput->False]},
         {
          PaneBox[GridBox[{
             {
              
              DynamicModuleBox[{System`InformationDump`open$$ = {
               False, False, False, False, False, False}}, 
               StyleBox[GridBox[{
                  {
                   TagBox[
                    TooltipBox[
                    StyleBox["\<\" Documentation\"\>", "InformationRowLabel",
                    StripOnInput->False],
                    "\"Documentation\"",
                    TooltipStyle->"TextStyling"],
                    Annotation[#, "Documentation", "Tooltip"]& ], 
                   TemplateBox[{
                    
                    TemplateBox[{
                    "\"Local \[RightGuillemet]\"", "paclet:ref/Equal", 
                    "paclet:ref/Equal", "Link", {
                    RGBColor[0.9686274509803922, 0.4666666666666667, 0.]}, 
                    BaseStyle -> {
                    RGBColor[0.0784313725490196, 0.1568627450980392, 0.6]}}, 
                    "HyperlinkTemplate"], "\"  \"", 
                    StyleBox[
                    "\"|\"", "InformationRowLabel", StripOnInput -> False], 
                    "\"  \"", 
                    TemplateBox[{"\"Web \[RightGuillemet]\"", {
                    URL[
                    "http://reference.wolfram.com/language/ref/Equal.html"], 
                    None}, "http://reference.wolfram.com/language/ref/Equal.\
html", "Hyperlink", {
                    RGBColor[0.9686274509803922, 0.4666666666666667, 0.]}, 
                    BaseStyle -> {
                    RGBColor[0.0784313725490196, 0.1568627450980392, 0.6]}}, 
                    "HyperlinkTemplate"]},
                    "RowDefault"]},
                  {
                   TagBox[
                    TooltipBox[
                    StyleBox["\<\" Attributes\"\>", "InformationRowLabel",
                    StripOnInput->False],
                    "\"Attributes\"",
                    TooltipStyle->"TextStyling"],
                    Annotation[#, "Attributes", "Tooltip"]& ], 
                   RowBox[{"{", "Protected", "}"}]},
                  {
                   TagBox[
                    TooltipBox[
                    StyleBox["\<\" Full Name\"\>", "InformationRowLabel",
                    StripOnInput->False],
                    "\"FullName\"",
                    TooltipStyle->"TextStyling"],
                    
                    Annotation[#, "FullName", 
                    "Tooltip"]& ], "\<\"System`Equal\"\>"}
                 },
                 AutoDelete->False,
                 GridBoxAlignment->{"Columns" -> {Right, Left}},
                 GridBoxDividers->None,
                 GridBoxItemSize->{"Columns" -> {Automatic, Automatic}},
                 GridBoxSpacings->{"Columns" -> {
                    Offset[0.27999999999999997`], {
                    Offset[0.5599999999999999]}, 
                    Offset[0.27999999999999997`]}, "Rows" -> {
                    Offset[0.2], {
                    Offset[0.8]}, 
                    Offset[0.2]}}], "DialogStyle",
                StripOnInput->False],
               DynamicModuleValues:>{}]}
            },
            DefaultBaseStyle->"Column",
            GridBoxAlignment->{"Columns" -> {{Left}}},
            GridBoxDividers->{"Columns" -> {{False}}, "Rows" -> {{False}}},
            
            GridBoxItemSize->{
             "Columns" -> {{Automatic}}, "Rows" -> {{Automatic}}},
            GridBoxSpacings->{"Columns" -> {
                Offset[0.27999999999999997`], {
                 Offset[0.5599999999999999]}, 
                Offset[0.27999999999999997`]}, "Rows" -> {
                Offset[0.2], {
                 Offset[3.6]}, 
                Offset[0.2]}}],
           FrameMargins->{{6, 6}, {6, 3}}], ""},
         {
          ItemBox[
           TagBox[
            ButtonBox[
             PaneSelectorBox[{False->
              
              DynamicBox[FEPrivate`FrontEndResource[
               "FEBitmaps", "UpPointerOpener"]], True->
              
              DynamicBox[FEPrivate`FrontEndResource[
               "FEBitmaps", "UpPointerOpenerHot"]]}, Dynamic[
              System`InformationDump`mouseOver$$]],
             Alignment->Left,
             Appearance->{"Default" -> None},
             
             ButtonFunction:>FEPrivate`Set[
              System`InformationDump`open$$, False],
             Evaluator->Automatic,
             FrameMargins->{{9, 0}, {0, 0}},
             ImageMargins->0,
             ImageSize->Full,
             Method->"Preemptive"],
            
            EventHandlerTag[{
             "MouseEntered" :> 
              FEPrivate`Set[System`InformationDump`mouseOver$$, True], 
              "MouseExited" :> 
              FEPrivate`Set[System`InformationDump`mouseOver$$, False], 
              Method -> "Preemptive", PassEventsDown -> Automatic, 
              PassEventsUp -> True}]],
           BaseStyle->"InformationTitleBackground",
           StripOnInput->False], "\[SpanFromLeft]"}
        },
        AutoDelete->False,
        FrameStyle->Directive[
          GrayLevel[0.8], 
          Thickness[Tiny]],
        GridBoxAlignment->{"Columns" -> {Left, Right}, "Rows" -> {{Center}}},
        GridBoxDividers->{
         "Columns" -> {{None}}, "Rows" -> {False, {True}, False}},
        GridBoxItemSize->{
         "Columns" -> {{Automatic}}, "Rows" -> {{Automatic}}}],
       "Grid"], False->
      TagBox[GridBox[{
         {
          ItemBox[
           PaneBox[
            StyleBox["\<\" Symbol\"\>", "InformationTitleText",
             StripOnInput->False],
            FrameMargins->{{4, 0}, {-1, 1}}],
           BaseStyle->"InformationTitleBackground",
           StripOnInput->False], 
          ItemBox[
           PaneBox[
            TooltipBox[
             ButtonBox[
              PaneSelectorBox[{False->
               
               DynamicBox[FEPrivate`FrontEndResource[
                "FEBitmaps", "InformationHelpIcon"],
                
                ImageSizeCache->{
                 11.700000000000001`, {4., 7.700000000000001}}], True->
               DynamicBox[FEPrivate`FrontEndResource[
                "FEBitmaps", "InformationHelpIconHot"],
                
                ImageSizeCache->{
                 11.700000000000001`, {4., 7.700000000000001}}]}, Dynamic[
                CurrentValue["MouseOver"]]],
              Appearance->None,
              BaseStyle->"Link",
              ButtonData->"paclet:ref/Equal",
              ButtonNote->"paclet:ref/Equal"],
             "\"paclet:ref/Equal\""],
            FrameMargins->{{0, 4}, {0, 2}}],
           BaseStyle->"InformationTitleBackground",
           StripOnInput->False]},
         {
          ItemBox[
           PaneBox[
            
            StyleBox["\<\"\\!\\(\\*RowBox[{StyleBox[\\\"lhs\\\", \\\"TI\\\"], \
\\\"==\\\", StyleBox[\\\"rhs\\\", \\\"TI\\\"]}]\\) returns True if \
\\!\\(\\*StyleBox[\\\"lhs\\\", \\\"TI\\\"]\\) and \\!\\(\\*StyleBox[\\\"rhs\\\
\", \\\"TI\\\"]\\) are identical. \"\>", "InformationUsageText",
             StripOnInput->False,
             LineSpacing->{1.5, 1.5, 3.}],
            FrameMargins->{{10, 10}, {8, 10}}],
           BaseStyle->"InformationUsageSubtitleBackground",
           StripOnInput->False], 
          ItemBox["\<\"\"\>",
           BaseStyle->"InformationUsageSubtitleBackground",
           StripOnInput->False]},
         {
          ItemBox[
           TagBox[
            ButtonBox[
             PaneSelectorBox[{False->
              
              DynamicBox[FEPrivate`FrontEndResource[
               "FEBitmaps", "DownPointerOpener"],
               ImageSizeCache->{9., {3., 6.}}], True->
              
              DynamicBox[FEPrivate`FrontEndResource[
               "FEBitmaps", "DownPointerOpenerHot"],
               ImageSizeCache->{9., {3., 6.}}]}, Dynamic[
              System`InformationDump`mouseOver$$]],
             Alignment->Left,
             Appearance->{"Default" -> None},
             
             ButtonFunction:>FEPrivate`Set[
              System`InformationDump`open$$, True],
             Evaluator->Automatic,
             FrameMargins->{{9, 0}, {0, 0}},
             ImageMargins->0,
             ImageSize->Full,
             Method->"Preemptive"],
            
            EventHandlerTag[{
             "MouseEntered" :> 
              FEPrivate`Set[System`InformationDump`mouseOver$$, True], 
              "MouseExited" :> 
              FEPrivate`Set[System`InformationDump`mouseOver$$, False], 
              Method -> "Preemptive", PassEventsDown -> Automatic, 
              PassEventsUp -> True}]],
           BaseStyle->"InformationTitleBackground",
           StripOnInput->False], "\[SpanFromLeft]"}
        },
        AutoDelete->False,
        FrameStyle->Directive[
          GrayLevel[0.8], 
          Thickness[Tiny]],
        GridBoxAlignment->{"Columns" -> {Left, Right}, "Rows" -> {{Center}}},
        GridBoxDividers->{
         "Columns" -> {{None}}, "Rows" -> {False, {True}, False}},
        GridBoxItemSize->{
         "Columns" -> {{Automatic}}, "Rows" -> {{Automatic}}}],
       "Grid"]}, Dynamic[System`InformationDump`open$$],
      BaselinePosition->Baseline,
      FrameMargins->0,
      ImageSize->Automatic],
     DynamicModuleValues:>{}],
    BaseStyle->"InformationGridFrame",
    StripOnInput->False], "InformationGridPlain",
   StripOnInput->False],
  InformationData[
   Association[
   "ObjectType" -> "Symbol", "Usage" -> 
    "\!\(\*RowBox[{StyleBox[\"lhs\", \"TI\"], \"==\", StyleBox[\"rhs\", \
\"TI\"]}]\) returns True if \!\(\*StyleBox[\"lhs\", \"TI\"]\) and \
\!\(\*StyleBox[\"rhs\", \"TI\"]\) are identical. ", "Documentation" -> 
    Association[
     "Local" -> "paclet:ref/Equal", "Web" -> 
      "http://reference.wolfram.com/language/ref/Equal.html"], "OwnValues" -> 
    None, "UpValues" -> None, "DownValues" -> None, "SubValues" -> None, 
    "DefaultValues" -> None, "NValues" -> None, "FormatValues" -> None, 
    "Options" -> None, "Attributes" -> {Protected}, "FullName" -> 
    "System`Equal"], False]]], "Output",
 CellChangeTimes->{3.825402254558383*^9},
 CellLabel->
  "Out[109]=",ExpressionUUID->"36daa1ce-2aee-42ab-8f13-036902dbb534"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Testing something different", "Subsubsection",
 CellChangeTimes->{{3.8254011981703568`*^9, 
  3.825401204103485*^9}},ExpressionUUID->"1a42caf6-ecd1-4078-93f7-\
d8d96e3258a9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"chtest", " ", "/:", " ", 
   RowBox[{"List", "[", 
    RowBox[{"x___", ",", 
     RowBox[{"chtest", "[", 
      RowBox[{"{", 
       RowBox[{"i_", ",", "j_", ",", "k_"}], "}"}], "]"}], ",", "y___", ",", 
     RowBox[{"chtest", "[", 
      RowBox[{"{", 
       RowBox[{"q_", ",", "j_", ",", "l_"}], "}"}], "]"}], ",", "z___"}], 
    "]"}], ":=", 
   RowBox[{"List", "[", 
    RowBox[{"x", ",", 
     RowBox[{"chtest", "[", 
      RowBox[{"{", 
       RowBox[{"i", ",", "j", ",", "k"}], "}"}], "]"}], ",", 
     RowBox[{"chtest", "[", 
      RowBox[{"q", ",", "j", ",", "l"}], "]"}], ",", "y", ",", "z"}], "]"}]}],
   ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"chtest", " ", "/:", " ", 
   RowBox[{"List", "[", 
    RowBox[{"x___", ",", 
     RowBox[{"chtest", "[", 
      RowBox[{"{", 
       RowBox[{"i_", ",", "j_", ",", "k_"}], "}"}], "]"}], ",", "y___", ",", 
     RowBox[{"chtest", "[", 
      RowBox[{"{", 
       RowBox[{"i_", ",", "q_", ",", "l_"}], "}"}], "]"}], ",", "z___"}], 
    "]"}], ":=", 
   RowBox[{"List", "[", 
    RowBox[{"x", ",", 
     RowBox[{"chtest", "[", 
      RowBox[{"{", 
       RowBox[{"i", ",", "j", ",", "k"}], "}"}], "]"}], ",", 
     RowBox[{"chtest", "[", 
      RowBox[{"i", ",", "q", ",", "l"}], "]"}], ",", "y", ",", "z"}], "]"}]}],
   ";"}]}], "Input",
 CellChangeTimes->{{3.8254012091250005`*^9, 3.8254012784819565`*^9}, {
  3.8254013198552465`*^9, 3.8254013369874287`*^9}, {3.825401378986096*^9, 
  3.8254014173624997`*^9}, {3.8254014739283757`*^9, 3.825401513591259*^9}},
 CellLabel->
  "In[104]:=",ExpressionUUID->"e80c69f6-57d0-4ad4-8beb-f0021af4229a"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "2", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "1", ",", "4"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "2", ",", "1"}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "2", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "2", ",", "1"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "3", ",", "4"}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "3", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "1", ",", "4"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "2", ",", "1"}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "3", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "2", ",", "1"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "3", ",", "4"}], "}"}]}], "}"}]}], "}"}]], "Input",Exp\
ressionUUID->"0e877e75-6483-4b2c-be6c-18fe1b9be7d0"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "2", ",", "2"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"3", ",", "1", ",", "4"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"3", ",", "2", ",", "1"}], "}"}]}], "}"}], "\[IndentingNewLine]", 
 RowBox[{"chtest", "/@", "%"}]}], "Input",
 CellChangeTimes->{{3.825401435640606*^9, 3.825401450664559*^9}},
 CellLabel->
  "In[106]:=",ExpressionUUID->"2c8c3b84-4866-4186-974d-746c0913a041"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "2", ",", "2"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"3", ",", "1", ",", "4"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"3", ",", "2", ",", "1"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.8254012463518734`*^9, {3.8254014410812445`*^9, 3.825401451316852*^9}, 
   3.8254015206982436`*^9},
 CellLabel->
  "Out[106]=",ExpressionUUID->"aad32081-735c-46b5-b664-dcfdbc149d7a"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"chtest", "[", 
    RowBox[{"{", 
     RowBox[{"1", ",", "1", ",", "3"}], "}"}], "]"}], ",", 
   RowBox[{"chtest", "[", 
    RowBox[{"1", ",", "2", ",", "2"}], "]"}], ",", 
   RowBox[{"chtest", "[", 
    RowBox[{"3", ",", "1", ",", "4"}], "]"}], ",", 
   RowBox[{"chtest", "[", 
    RowBox[{"3", ",", "2", ",", "1"}], "]"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.8254012463518734`*^9, {3.8254014410812445`*^9, 3.825401451316852*^9}, 
   3.825401520704262*^9},
 CellLabel->
  "Out[107]=",ExpressionUUID->"8377fbd8-bca1-4454-92b9-9aa68794121b"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"Clear", "[", "chtest", "]"}]], "Input",
 CellChangeTimes->{{3.825401662125265*^9, 3.825401665204036*^9}},
 CellLabel->
  "In[108]:=",ExpressionUUID->"f0fd5e93-da43-4133-bef6-e71ee95820d8"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"pr", "=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"1", ",", "2", ",", "2"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"3", ",", "1", ",", "4"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"3", ",", "2", ",", "1"}], "}"}]}], "}"}]}]], "Input",
 CellChangeTimes->{{3.8254031269352255`*^9, 3.8254031316425667`*^9}},
 CellLabel->
  "In[110]:=",ExpressionUUID->"6990a7c7-b42e-45d2-a8ba-3cbeec4052b1"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "2", ",", "2"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"3", ",", "1", ",", "4"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"3", ",", "2", ",", "1"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{3.8254031326059856`*^9},
 CellLabel->
  "Out[110]=",ExpressionUUID->"40d40b63-3b3b-4ab0-ab14-0331848988b7"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"chtest", " ", "reorders", " ", "the", " ", "terms"}], 
  "*)"}]], "Input",
 CellChangeTimes->{{3.8254104415280056`*^9, 
  3.8254104604339056`*^9}},ExpressionUUID->"139855ac-b014-4bd7-bcf2-\
f8fb88d4ccd6"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Pair", " ", "up", " ", "everything", " ", "by", " ", "contracted", " ", 
    "square", " ", "brackets"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"chtest", " ", "/:", " ", 
     RowBox[{"List", "[", 
      RowBox[{"x1___", ",", 
       RowBox[{"chtest", "[", 
        RowBox[{"{", 
         RowBox[{"i_", ",", "j_", ",", "k_"}], "}"}], "]"}], ",", "x2___", 
       ",", 
       RowBox[{"chtest", "[", 
        RowBox[{"{", 
         RowBox[{"q_", ",", "j_", ",", "l_"}], "}"}], "]"}], ",", "x3___"}], 
      "]"}], ":=", 
     RowBox[{"List", "[", 
      RowBox[{"x1", ",", "x2", ",", "x3", ",", 
       RowBox[{"chtest", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"i", ",", "j", ",", "k"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"q", ",", "j", ",", "l"}], "}"}]}], "]"}]}], "]"}]}], ";"}],
    "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Further", " ", "connect", " ", "by", " ", "contracted", " ", "angles"}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"chtest", " ", "/:", " ", 
     RowBox[{"List", "[", 
      RowBox[{"x1___", ",", 
       RowBox[{"chtest", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"i_", ",", "j_", ",", "k_"}], "}"}], ",", "y1___"}], "]"}], 
       ",", "x2___", ",", 
       RowBox[{"chtest", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"i_", ",", "q_", ",", "l_"}], "}"}], ",", "y2___"}], "]"}], 
       ",", "x3___"}], "]"}], ":=", 
     RowBox[{"List", "[", 
      RowBox[{"x1", ",", "x2", ",", "x3", ",", 
       RowBox[{"chtest", "[", 
        RowBox[{
         RowBox[{"Sequence", "@@", 
          RowBox[{"Reverse", "[", 
           RowBox[{"{", "y2", "}"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "q", ",", "l"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "j", ",", "k"}], "}"}], ",", "y1"}], "]"}]}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"chtest", " ", "/:", " ", 
     RowBox[{"List", "[", 
      RowBox[{"x1___", ",", 
       RowBox[{"chtest", "[", 
        RowBox[{"y1___", ",", 
         RowBox[{"{", 
          RowBox[{"i_", ",", "j_", ",", "k_"}], "}"}]}], "]"}], ",", "x2___", 
       ",", 
       RowBox[{"chtest", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"i_", ",", "q_", ",", "l_"}], "}"}], ",", "y2___"}], "]"}], 
       ",", "x3___"}], "]"}], ":=", 
     RowBox[{"List", "[", 
      RowBox[{"x1", ",", "x2", ",", "x3", ",", 
       RowBox[{"chtest", "[", 
        RowBox[{"y1", ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "j", ",", "k"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "q", ",", "l"}], "}"}], ",", "y2"}], "]"}]}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"chtest", " ", "/:", " ", 
     RowBox[{"List", "[", 
      RowBox[{"x1___", ",", 
       RowBox[{"chtest", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"i_", ",", "q_", ",", "l_"}], "}"}], ",", "y2___"}], "]"}], 
       ",", "x2___", ",", 
       RowBox[{"chtest", "[", 
        RowBox[{"y1___", ",", 
         RowBox[{"{", 
          RowBox[{"i_", ",", "j_", ",", "k_"}], "}"}]}], "]"}], ",", 
       "x3___"}], "]"}], ":=", 
     RowBox[{"List", "[", 
      RowBox[{"x1", ",", "x2", ",", "x3", ",", 
       RowBox[{"chtest", "[", 
        RowBox[{"y1", ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "j", ",", "k"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "q", ",", "l"}], "}"}], ",", "y2"}], "]"}]}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"chtest", " ", "/:", " ", 
     RowBox[{"List", "[", 
      RowBox[{"x1___", ",", 
       RowBox[{"chtest", "[", 
        RowBox[{"y1___", ",", 
         RowBox[{"{", 
          RowBox[{"i_", ",", "j_", ",", "k_"}], "}"}]}], "]"}], ",", "x2___", 
       ",", 
       RowBox[{"chtest", "[", 
        RowBox[{"y2___", ",", 
         RowBox[{"{", 
          RowBox[{"i_", ",", "q_", ",", "l_"}], "}"}]}], "]"}], ",", 
       "x3___"}], "]"}], ":=", 
     RowBox[{"List", "[", 
      RowBox[{"x1", ",", "x2", ",", "x3", ",", 
       RowBox[{"chtest", "[", 
        RowBox[{"y1", ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "j", ",", "k"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "q", ",", "l"}], "}"}], ",", 
         RowBox[{"Sequence", "@@", 
          RowBox[{"Reverse", "[", 
           RowBox[{"{", "y2", "}"}], "]"}]}]}], "]"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]"}]}]], "Input",
 CellChangeTimes->{{3.825403206149293*^9, 3.8254032252651596`*^9}, {
   3.825403255669839*^9, 3.8254033252178206`*^9}, 3.825403380687515*^9, {
   3.82540893299856*^9, 3.8254090034364834`*^9}, {3.825409034106453*^9, 
   3.8254091585344543`*^9}, {3.82540919679412*^9, 3.8254094222950306`*^9}, {
   3.825409667901141*^9, 
   3.8254097067761097`*^9}},ExpressionUUID->"04c1305b-82d3-4284-85c0-\
b2c5021aa8b4"],

Cell[CellGroupData[{

Cell[BoxData[{"pr", "\[IndentingNewLine]", 
 RowBox[{"chtest", "/@", "pr"}]}], "Input",
 CellChangeTimes->{{3.825403328792269*^9, 3.82540333410207*^9}, {
  3.825409474725757*^9, 3.825409477432564*^9}, {3.8254097288600965`*^9, 
  3.825409731593785*^9}},
 CellLabel->
  "In[125]:=",ExpressionUUID->"e956a5e6-2131-40ba-a5ed-df528465286b"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "2", ",", "2"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"3", ",", "1", ",", "4"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"3", ",", "2", ",", "1"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{3.8254033344162188`*^9, 3.825403382753935*^9, 
  3.8254094253039923`*^9, 3.825409479482073*^9, 3.8254097329142513`*^9},
 CellLabel->
  "Out[125]=",ExpressionUUID->"93ba216b-85c5-4841-b307-24b0e3dd627c"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"chtest", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"3", ",", "2", ",", "1"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"1", ",", "2", ",", "2"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"3", ",", "1", ",", "4"}], "}"}]}], "]"}], "}"}]], "Output",
 CellChangeTimes->{3.8254033344162188`*^9, 3.825403382753935*^9, 
  3.8254094253039923`*^9, 3.825409479482073*^9, 3.825409732928212*^9},
 CellLabel->
  "Out[126]=",ExpressionUUID->"6cb832d2-4b57-49c7-8646-c632fca92208"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"1", ",", "2", ",", "2"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"3", ",", "1", ",", "4"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"3", ",", "2", ",", "1"}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"1", ",", "2", ",", "2"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"3", ",", "2", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"3", ",", "3", ",", "4"}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"1", ",", "3", ",", "2"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"3", ",", "1", ",", "4"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"3", ",", "2", ",", "1"}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"1", ",", "3", ",", "2"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"3", ",", "2", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"3", ",", "3", ",", "4"}], "}"}]}], "}"}]}], "}"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"chtest", "/@", "i"}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", "%"}], "}"}]}], "]"}], "//", 
  "RepeatedTiming"}]}], "Input",
 CellChangeTimes->{{3.8254101766354094`*^9, 3.8254101890721493`*^9}, {
  3.8254104005070477`*^9, 3.825410403200899*^9}},
 CellLabel->
  "In[129]:=",ExpressionUUID->"edaf0a29-2230-43c0-b19b-3b4947ff4ddf"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.0000921243408203125`", ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"chtest", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"3", ",", "2", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "2", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "1", ",", "4"}], "}"}]}], "]"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"chtest", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "2", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "2", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "3", ",", "4"}], "}"}]}], "]"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"chtest", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "3", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "1", ",", "4"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "2", ",", "1"}], "}"}]}], "]"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"chtest", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "3", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "3", ",", "4"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "2", ",", "1"}], "}"}]}], "]"}], "}"}]}], "}"}]}], 
  "}"}]], "Output",
 CellChangeTimes->{3.8254101899588175`*^9, 3.8254104051686296`*^9},
 CellLabel->
  "Out[130]=",ExpressionUUID->"780bd8cd-1167-4c49-8dbc-714a00633a1c"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
   "If", " ", "chtests", " ", "starts", " ", "with", " ", "two", " ", "terms",
     " ", "like", " ", 
    RowBox[{"{", 
     RowBox[{"_", ",", "i", ",", "_"}], "}"}]}], ",", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"_", ",", "i", ",", "_"}], "}"}], " ", "then", " ", "the", " ", 
    "first", " ", "entry", " ", "of", " ", "the", " ", "chain", " ", "is", 
    " ", "an", " ", "angle"}], ",", " ", 
   RowBox[{"if", " ", "it", " ", "is", " ", "like", " ", 
    RowBox[{"{", 
     RowBox[{"i", ",", "_", ",", "_"}], "}"}]}], ",", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"i", ",", "_", ",", "_"}], "}"}], " ", "then", " ", "it", " ", 
    "is", " ", "a", " ", "square"}]}], "*)"}]], "Input",
 CellChangeTimes->{{3.8254105258561697`*^9, 
  3.8254105860577173`*^9}},ExpressionUUID->"f0e91637-cd13-4925-910e-\
138d91724ef8"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Block", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
    "exp", ",", "agbrackets", ",", "sqbrackets", ",", "type1", ",", "type2", 
     ",", "locexp", ",", "first", ",", "last"}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"exp", "=", 
     RowBox[{"List", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"3", ",", "2", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "2", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1", ",", "3"}], "}"}]}], "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"agbrackets", "=", 
     RowBox[{"List", "@@@", 
      RowBox[{"{", 
       RowBox[{
        TemplateBox[{"1", "2"},
         "SpinorAngleBracket",
         DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
            RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
         InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
            RowBox[{#, ",", #2}], "]"}]& )], ",", 
        TemplateBox[{"5", "6"},
         "SpinorAngleBracket",
         DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
            RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
         InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
            RowBox[{#, ",", #2}], "]"}]& )], ",", 
        TemplateBox[{"3", "4"},
         "SpinorAngleBracket",
         DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
            RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
         InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
            RowBox[{#, ",", #2}], "]"}]& )], ",", 
        TemplateBox[{"2", "4"},
         "SpinorAngleBracket",
         DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
            RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
         InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
            RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"sqbrackets", "=", 
     RowBox[{"List", "@@@", 
      RowBox[{"{", 
       RowBox[{
        TemplateBox[{"1", "4"},
         "SpinorSquareBracket",
         DisplayFunction->(RowBox[{"[", 
            RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
         InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
            RowBox[{#, ",", #2}], "]"}]& )], ",", 
        TemplateBox[{"2", "3"},
         "SpinorSquareBracket",
         DisplayFunction->(RowBox[{"[", 
            RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
         InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
            RowBox[{#, ",", #2}], "]"}]& )], ",", 
        TemplateBox[{"2", "4"},
         "SpinorSquareBracket",
         DisplayFunction->(RowBox[{"[", 
            RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
         InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
            RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}]}], ";", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
     "Find", " ", "type", " ", "of", " ", "the", " ", "first", " ", "entry", 
      " ", "and", " ", "extract", " ", "information", " ", "accordingly"}], 
     "*)"}], "\[IndentingNewLine]", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"exp", "[", 
        RowBox[{"[", 
         RowBox[{"1", ",", "1"}], "]"}], "]"}], "\[Equal]", 
       RowBox[{"exp", "[", 
        RowBox[{"[", 
         RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"type1", "=", "$square"}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Since", " ", "square", " ", "chains", " ", "are", " ", "by", " ", 
         "construction", " ", "method", " ", "always", " ", "even", " ", 
         "this", " ", "also", " ", "terminates", " ", "with", " ", "square"}],
         "*)"}], "\[IndentingNewLine]", 
       RowBox[{"type2", "=", "$square"}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"First", " ", "entry", " ", "of", " ", "the", " ", "chain"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"first", "=", 
        RowBox[{"First", "@", "exp"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"first", "=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Last", "@", "first"}], "\[Equal]", "2"}], "||", 
           RowBox[{
            RowBox[{"Last", "@", "first"}], "\[Equal]", "3"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"Last", "@", 
           RowBox[{"sqbrackets", "[", 
            RowBox[{"[", 
             RowBox[{"first", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"First", "@", 
           RowBox[{"sqbrackets", "[", 
            RowBox[{"[", 
             RowBox[{"first", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}]}]}], 
         "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"build", " ", "internal", " ", "chain"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"locexp", "=", 
        RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"locexp", "=", 
           RowBox[{"Join", "[", 
            RowBox[{"locexp", ",", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Last", "@", "i"}], "\[Equal]", "2"}], "||", 
                RowBox[{
                 RowBox[{"Last", "@", "i"}], "\[Equal]", "4"}]}], ",", 
               RowBox[{"agbrackets", "[", 
                RowBox[{"[", 
                 RowBox[{"First", "@", "i"}], "]"}], "]"}], ",", 
               RowBox[{"Reverse", "@", 
                RowBox[{"(", 
                 RowBox[{"agbrackets", "[", 
                  RowBox[{"[", 
                   RowBox[{"First", "@", "i"}], "]"}], "]"}], ")"}]}]}], 
              "]"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"Last", "@", 
            RowBox[{"Transpose", "@", 
             RowBox[{"Partition", "[", 
              RowBox[{"exp", ",", "2"}], "]"}]}]}]}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Extract", " ", "last", " ", "entry", " ", "of", " ", 
         RowBox[{"chain", ".", " ", "Recall"}], " ", "that", " ", "chains", 
         " ", "starting", " ", "with", " ", "square", " ", "are", " ", 
         "always", " ", "even", " ", "in", " ", 
         RowBox[{"length", "."}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"last", "=", 
        RowBox[{"Last", "@", "exp"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"last", "=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Last", "@", "last"}], "\[Equal]", "2"}], "||", 
           RowBox[{
            RowBox[{"Last", "@", "last"}], "\[Equal]", "3"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"Last", "@", 
           RowBox[{"sqbrackets", "[", 
            RowBox[{"[", 
             RowBox[{"last", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"First", "@", 
           RowBox[{"sqbrackets", "[", 
            RowBox[{"[", 
             RowBox[{"last", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}]}]}], 
         "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"type1", "=", "$angle"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"First", " ", "entry", " ", "of", " ", "the", " ", "chain"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"first", "=", 
        RowBox[{"First", "@", "exp"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"first", "=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Last", "@", "first"}], "\[Equal]", "1"}], "||", 
           RowBox[{
            RowBox[{"Last", "@", "first"}], "\[Equal]", "3"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"Last", "@", 
           RowBox[{"agbrackets", "[", 
            RowBox[{"[", 
             RowBox[{"first", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"First", "@", 
           RowBox[{"agbrackets", "[", 
            RowBox[{"[", 
             RowBox[{"first", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}]}]}], 
         "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"first", "//", "Echo"}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"build", " ", "internal", " ", "chain"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"locexp", "=", 
        RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"exp", "//", "Echo"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"locexp", "=", 
           RowBox[{
            RowBox[{"Join", "[", 
             RowBox[{"locexp", ",", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"Last", "@", "i"}], "\[Equal]", "1"}], "||", 
                 RowBox[{
                  RowBox[{"Last", "@", "i"}], "\[Equal]", "4"}]}], ",", 
                RowBox[{"sqbrackets", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], ",", 
                RowBox[{"Reverse", "@", 
                 RowBox[{"(", 
                  RowBox[{"sqbrackets", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], ")"}]}]}], 
               "]"}]}], "]"}], "//", "Echo"}]}], ";"}], "\[IndentingNewLine]",
          ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"Echo", "@", 
            RowBox[{"Last", "@", 
             RowBox[{"Transpose", "@", 
              RowBox[{"Partition", "[", 
               RowBox[{"exp", ",", "2"}], "]"}]}]}]}]}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
          RowBox[{
          "Angle", " ", "chains", " ", "can", " ", "be", " ", "even", " ", 
           RowBox[{"\[LeftAngleBracket]", "...", "\[RightAngleBracket]"}], 
           " ", "or", " ", "odd", " ", 
           RowBox[{"\[LeftAngleBracket]", "..."}]}], "]"}], ",", " ", 
         RowBox[{
         "in", " ", "the", " ", "former", " ", "case", " ", "we", " ", "need",
           " ", "still", " ", "to", " ", "get", " ", "the", " ", "last", " ", 
          "entry", " ", "of", " ", "the", " ", 
          RowBox[{"chain", ".", " ", "In"}], " ", "the", " ", "latter", " ", 
          "case", " ", "it", " ", "is", " ", "the", " ", "last", " ", "term", 
          " ", "in", " ", 
          RowBox[{"locexp", ".", " ", "Notice"}], " ", "that", " ", 
          "traces"}], ",", " ", 
         RowBox[{
         "despite", " ", "being", " ", "of", " ", "the", " ", "odd", " ", 
          "form", " ", "have", " ", "an", " ", "even", " ", 
          "representation"}], ",", " ", 
         RowBox[{
         "so", " ", "these", " ", "need", " ", "a", " ", "separate", " ", 
          "account"}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"OddQ", "[", 
          RowBox[{"Length", "[", "exp", "]"}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"type2", "=", "$square"}], ";", "\[IndentingNewLine]", 
          RowBox[{"last", "=", 
           RowBox[{"Last", "@", "locexp"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"locexp", "=", 
           RowBox[{"Most", "@", "locexp"}]}], ";"}], "\[IndentingNewLine]", 
         ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"type2", "=", "$angle"}], ";", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{"Extract", " ", "last", " ", "entry", " ", "of", " ", 
            RowBox[{"chain", "."}]}], "*)"}], "\[IndentingNewLine]", 
          RowBox[{"last", "=", 
           RowBox[{"Last", "@", "exp"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"last", "=", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"Last", "@", "last"}], "\[Equal]", "1"}], "||", 
              RowBox[{
               RowBox[{"Last", "@", "last"}], "\[Equal]", "3"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"Last", "@", 
              RowBox[{"agbrackets", "[", 
               RowBox[{"[", 
                RowBox[{"last", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"First", "@", 
              RowBox[{"agbrackets", "[", 
               RowBox[{"[", 
                RowBox[{"last", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}]}]}], 
            "\[IndentingNewLine]", "]"}]}], ";"}]}], "\[IndentingNewLine]", 
        "]"}], ";"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
    RowBox[{"locexp", "//", "Echo"}], ";", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
     "If", " ", "the", " ", "number", " ", "of", " ", "entries", " ", "is", 
      " ", "even", " ", "then", " ", "we", " ", "have", " ", 
      RowBox[{"either", " ", "[", "...", "]"}], " ", "or", " ", 
      RowBox[{"\[LeftAngleBracket]", "...", "\[RightAngleBracket]"}], " ", 
      "and", " ", "extracting", " ", "information", " ", "is", " ", 
      RowBox[{"simple", ".", " ", "If"}], " ", "it", " ", "is", " ", "odd", 
      " ", "we", " ", "take", " ", "the", " ", "simple", " ", "even", " ", 
      "case", " ", "and", " ", "add", " ", "an", " ", "extra", " ", 
      RowBox[{"piece", ".", " ", "Because"}], " ", "of", " ", "how", " ", 
      "we", " ", "built", " ", "things", " ", "off", " ", "terms", " ", 
      "always", " ", "start", " ", "with", " ", "an", " ", "angle"}], "*)"}], 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{"-", "1"}], ")"}], "^", 
      RowBox[{"Count", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Last", "/@", "exp"}], "}"}], ",", 
        RowBox[{"3", "|", "4"}], ",", "\[Infinity]"}], "]"}]}], "*", 
     RowBox[{"Chain", "[", 
      RowBox[{
      "type1", ",", "first", ",", "locexp", ",", "last", ",", "type2"}], 
      "]"}]}]}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellChangeTimes->{{3.825411235136856*^9, 3.8254113972629223`*^9}, {
   3.8254116837018023`*^9, 3.8254117254461527`*^9}, {3.82541178679806*^9, 
   3.8254118126818323`*^9}, {3.825412452788884*^9, 3.825412458201715*^9}, {
   3.8254124899308534`*^9, 3.825412508049444*^9}, {3.8254126086443925`*^9, 
   3.8254126986934924`*^9}, {3.825412742456442*^9, 3.825412744029234*^9}, {
   3.8254128015184736`*^9, 3.8254128612327485`*^9}, {3.8254129534401293`*^9, 
   3.8254129593763075`*^9}, {3.8254132378819804`*^9, 3.825413251398906*^9}, {
   3.825413284237026*^9, 3.825413378897833*^9}, {3.825413420826745*^9, 
   3.8254134772258654`*^9}, {3.8254135078209796`*^9, 3.825413517391382*^9}, {
   3.825413751371624*^9, 3.8254137852579126`*^9}, 3.8254143501412597`*^9, {
   3.8254144051251945`*^9, 3.825414619042941*^9}, {3.8254146947215443`*^9, 
   3.8254146981792994`*^9}, {3.82541477393468*^9, 3.8254147785353265`*^9}, {
   3.8254157084114523`*^9, 3.8254157492931633`*^9}, {3.8254158103109646`*^9, 
   3.8254158855558186`*^9}, {3.825415949083871*^9, 3.8254159798127103`*^9}, {
   3.825416200215234*^9, 3.8254162065163813`*^9}, {3.8254162628835735`*^9, 
   3.8254162910462556`*^9}, {3.8254164782814627`*^9, 
   3.8254165094042497`*^9}, {3.8254165953823094`*^9, 
   3.8254167134882727`*^9}, {3.825416788784876*^9, 3.8254169429405675`*^9}, {
   3.825416996049532*^9, 3.8254171261565485`*^9}, {3.825417178836279*^9, 
   3.825417286643221*^9}, {3.825417499906838*^9, 3.8254175468891773`*^9}, {
   3.8254175881876993`*^9, 3.8254175967837305`*^9}, {3.82541764817328*^9, 
   3.825417649005011*^9}, 3.8254177141457767`*^9, {3.8254177491362424`*^9, 
   3.8254177912064204`*^9}, {3.825418021877463*^9, 3.8254180326925335`*^9}, {
   3.8254182189723077`*^9, 3.825418222954637*^9}, {3.825418279982128*^9, 
   3.8254182899444733`*^9}, {3.82541833791712*^9, 3.8254183414586487`*^9}, {
   3.8254184662958107`*^9, 3.8254184825523195`*^9}, {3.8254186242363634`*^9, 
   3.825418675463832*^9}, {3.8254187482831182`*^9, 3.8254187721223545`*^9}, {
   3.8254188638160877`*^9, 3.825418891211836*^9}, {3.8254197452959995`*^9, 
   3.825419752121743*^9}, 3.825420096374939*^9},
 CellLabel->
  "In[201]:=",ExpressionUUID->"7d7df5d9-c52b-472e-827f-02194f0462ec"],

Cell[CellGroupData[{

Cell[BoxData["4"], "Echo",
 CellChangeTimes->{
  3.8254200967998066`*^9},ExpressionUUID->"78286f15-8dcf-4789-8da3-\
8623a538f2c5"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"3", ",", "2", ",", "1"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "2", ",", "2"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "1", ",", "3"}], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.8254200969464192`*^9},ExpressionUUID->"b8035799-d048-45ad-866a-\
c6bc88dc4c4c"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"{", 
   RowBox[{"1", ",", "2", ",", "2"}], "}"}], "}"}]], "Echo",
 CellChangeTimes->{
  3.8254200970321813`*^9},ExpressionUUID->"d8f38770-26e1-46cb-827d-\
c9b2ebed7d76"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"3", ",", "2"}], "}"}]], "Echo",
 CellChangeTimes->{
  3.8254200971129665`*^9},ExpressionUUID->"03cfc8eb-2142-4728-ab01-\
e74a0732dafc"],

Cell[BoxData[
 RowBox[{"{", "3", "}"}]], "Echo",
 CellChangeTimes->{
  3.82542009719375*^9},ExpressionUUID->"2a540245-3b5a-4b46-909f-22a93025aadf"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"-", 
  TemplateBox[{"4", 
    RowBox[{"{", "3", "}"}], "2"},
   "AngleSquareChain",
   DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
   InterpretationFunction->(
    RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square", 
      "]"}]& )]}]], "Output",
 CellChangeTimes->{{3.825414442943535*^9, 3.8254144933678274`*^9}, 
   3.8254146200561953`*^9, 3.825414698818543*^9, {3.825415716190685*^9, 
   3.825415749840684*^9}, {3.8254158115755663`*^9, 3.8254158861821012`*^9}, 
   3.8254159813356023`*^9, 3.8254162070648584`*^9, 3.8254166000266776`*^9, 
   3.8254167144177523`*^9, 3.825417287970672*^9, 3.8254175509732027`*^9, 
   3.8254175975097437`*^9, 3.8254176505259333`*^9, 3.825417714708312*^9, {
   3.8254177524680185`*^9, 3.8254177919244475`*^9}, 3.82541803362*^9, 
   3.8254182492323203`*^9, 3.8254182947974877`*^9, 3.8254183426534615`*^9, 
   3.825418489578521*^9, 3.8254186817440367`*^9, 3.8254188921483164`*^9, 
   3.825419753090138*^9, 3.8254200972735357`*^9},
 CellLabel->
  "Out[201]=",ExpressionUUID->"0d7596f4-f669-441e-8160-ddb3437b3564"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Table", "[", 
  RowBox[{"i", ",", 
   RowBox[{"{", 
    RowBox[{"i", ",", "1", ",", "12", ",", "2"}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.825412176505603*^9, 3.8254122115474997`*^9}},
 CellLabel->
  "In[136]:=",ExpressionUUID->"b2019390-4da6-4079-9c88-d7a8cbe082d7"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"1", ",", "3", ",", "5", ",", "7", ",", "9", ",", "11"}], 
  "}"}]], "Output",
 CellChangeTimes->{{3.825412189920854*^9, 3.825412196162549*^9}, 
   3.825412231833192*^9},
 CellLabel->
  "Out[136]=",ExpressionUUID->"69f7a46a-6c62-4a3d-a544-8eb78a558922"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"First", "@", 
  RowBox[{"Transpose", "@", 
   RowBox[{"Partition", "[", 
    RowBox[{
     RowBox[{"Range", "[", "10", "]"}], ",", "2"}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.8254143772078176`*^9, 3.8254143949563446`*^9}},
 CellLabel->
  "In[165]:=",ExpressionUUID->"ddbdbe22-58cd-4ff5-bcfb-9a79ddca10c2"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"1", ",", "3", ",", "5", ",", "7", ",", "9"}], "}"}]], "Output",
 CellChangeTimes->{{3.825414383384328*^9, 3.8254143953672442`*^9}},
 CellLabel->
  "Out[165]=",ExpressionUUID->"022c1e1a-4df0-466f-a8ee-4cd6cde611da"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Once more, with feeling", "Subsubsection",
 CellChangeTimes->{{3.825427792218657*^9, 3.825427800288084*^9}, {
  3.8254278885476007`*^9, 
  3.825427891258351*^9}},ExpressionUUID->"216fa49c-0a59-469f-b560-\
0ae576ec029e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"chtest", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"3", ",", "2", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "2", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "1", ",", "4"}], "}"}]}], "]"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"chtest", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "2", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "2", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "3", ",", "4"}], "}"}]}], "]"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"chtest", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "3", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "1", ",", "4"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "2", ",", "1"}], "}"}]}], "]"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"chtest", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "3", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "3", ",", "4"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "2", ",", "1"}], "}"}]}], "]"}], "}"}]}], "}"}], 
  "}"}]], "Input",ExpressionUUID->"eaee92b0-b0c0-427b-9216-84be8264f03b"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Block", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
    "exp", ",", "agbrackets", ",", "sqbrackets", ",", "locexp", ",", "type1", 
     ",", "type2", ",", "chain"}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"exp", "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"3", ",", "2", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "2", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "1", ",", "4"}], "}"}]}], "}"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"agbrackets", "=", 
     RowBox[{"List", "@@@", 
      RowBox[{"{", 
       RowBox[{
        TemplateBox[{"1", "2"},
         "SpinorAngleBracket",
         DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
            RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
         InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
            RowBox[{#, ",", #2}], "]"}]& )], ",", 
        TemplateBox[{"5", "6"},
         "SpinorAngleBracket",
         DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
            RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
         InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
            RowBox[{#, ",", #2}], "]"}]& )], ",", 
        TemplateBox[{"3", "4"},
         "SpinorAngleBracket",
         DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
            RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
         InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
            RowBox[{#, ",", #2}], "]"}]& )], ",", 
        TemplateBox[{"2", "4"},
         "SpinorAngleBracket",
         DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
            RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
         InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
            RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"sqbrackets", "=", 
     RowBox[{"List", "@@@", 
      RowBox[{"{", 
       RowBox[{
        TemplateBox[{"1", "4"},
         "SpinorSquareBracket",
         DisplayFunction->(RowBox[{"[", 
            RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
         InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
            RowBox[{#, ",", #2}], "]"}]& )], ",", 
        TemplateBox[{"2", "3"},
         "SpinorSquareBracket",
         DisplayFunction->(RowBox[{"[", 
            RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
         InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
            RowBox[{#, ",", #2}], "]"}]& )], ",", 
        TemplateBox[{"2", "4"},
         "SpinorSquareBracket",
         DisplayFunction->(RowBox[{"[", 
            RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
         InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
            RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"locexp", "=", 
     RowBox[{
      RowBox[{"Transpose", "@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Part", "[", 
             RowBox[{"agbrackets", ",", "#1"}], "]"}], ",", 
            RowBox[{"Part", "[", 
             RowBox[{"sqbrackets", ",", "#2"}], "]"}], ",", "#3"}], "}"}], 
          "&"}], "@@", 
         RowBox[{"Transpose", "@", "exp"}]}], ")"}]}], "//", "Echo"}]}], ";", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{"See", " ", "who", " ", "starts", " ", "the", " ", "chain"}], 
      ",", " ", 
      RowBox[{
      "angle", " ", "or", " ", "square", " ", "and", " ", "proceed", " ", 
       "accordingly"}]}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"exp", "[", 
        RowBox[{"[", 
         RowBox[{"1", ",", "1"}], "]"}], "]"}], "\[Equal]", 
       RowBox[{"exp", "[", 
        RowBox[{"[", 
         RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"type1", "=", "$square"}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "squares", " ", "only", " ", "start", " ", "the", " ", "chain", " ", 
         "when", " ", "they", " ", "also", " ", "finish", " ", "it"}], "*)"}],
        "\[IndentingNewLine]", 
       RowBox[{"type2", "=", "$square"}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "Pick", " ", "only", " ", "the", " ", "square", " ", "brackets", " ",
           "of", " ", "the", " ", "relevant", " ", "pieces"}], ",", " ", 
         RowBox[{
         "the", " ", "beginning", " ", "and", " ", "then", " ", "one", " ", 
          "every", " ", "two", " ", 
          RowBox[{"contractions", ".", " ", "Order"}], " ", "is", " ", 
          "given", " ", "by", " ", "the", " ", "contraction", " ", 
          RowBox[{"type", ".", " ", "Recall"}], " ", "that", " ", "the", " ", 
          "first", " ", "contraction", " ", "is", " ", "different", " ", 
          "from", " ", "the", " ", "rest", " ", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
            "due", " ", "to", " ", "the", " ", "skipping", " ", "of", " ", 
             "the", " ", "non"}], "-", 
            RowBox[{"relevant", " ", "terms"}]}], ")"}]}]}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"chain", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"Drop", "[", 
           RowBox[{"#", ",", 
            RowBox[{"{", 
             RowBox[{"3", ",", 
              RowBox[{"Length", "[", "exp", "]"}], ",", "2"}], "}"}]}], "]"}],
           "&"}], "@", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"Drop", "[", 
             RowBox[{"#", ",", "1"}], "]"}], "&"}], "/@", "locexp"}], 
          ")"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"chain", "=", 
        RowBox[{"Flatten", "@", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Last", "@", "#"}], "\[Equal]", "2"}], "||", 
                RowBox[{
                 RowBox[{"Last", "@", "#"}], "\[Equal]", "3"}]}], ",", 
               RowBox[{"Reverse", "@", 
                RowBox[{"First", "@", "#"}]}], ",", 
               RowBox[{"First", "@", "#"}]}], "]"}], "&"}], "@", 
            RowBox[{"First", "@", "chain"}]}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Last", "@", "#"}], "\[Equal]", "1"}], "||", 
                RowBox[{
                 RowBox[{"Last", "@", "#"}], "\[Equal]", "4"}]}], ",", 
               RowBox[{"Reverse", "@", 
                RowBox[{"First", "@", "#"}]}], ",", 
               RowBox[{"First", "@", "#"}]}], "]"}], "&"}], "/@", 
            RowBox[{"Rest", "@", "chain"}]}]}], "}"}]}]}], ";"}], 
      "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"type1", "=", "$angle"}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "Angle", " ", "chains", " ", "can", " ", "be", " ", "even", " ", 
          "or", " ", "odd", " ", "in", " ", "the", " ", "number", " ", "of", 
          " ", "contractions"}], ",", " ", 
         RowBox[{"so", " ", "we", " ", "distinguish", " ", "these", " ", 
          RowBox[{"cases", ".", " ", "Also"}]}], ",", " ", 
         RowBox[{
         "traces", " ", "can", " ", "be", " ", "represented", " ", "by", " ", 
          "odd", " ", "contractions", " ", "but", " ", "appear", " ", "as", 
          " ", "even", " ", "due", " ", "to", " ", "their", " ", 
          "cyclicity"}], ",", " ", 
         RowBox[{
         "so", " ", "we", " ", "have", " ", "to", " ", "rewrite", " ", 
          "them"}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"EvenQ", "[", 
           RowBox[{"Length", "[", "exp", "]"}], "]"}], "&&", 
          RowBox[{
           RowBox[{"First", "@", 
            RowBox[{"Last", "@", "exp"}]}], "==", 
           RowBox[{"First", "@", 
            RowBox[{"First", "@", "exp"}]}]}]}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"locexp", "=", 
           RowBox[{
            RowBox[{"Most", "@", "locexp"}], "//", "Echo"}]}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "If", " ", "we", " ", "are", " ", "dealing", " ", "with", " ", "a", 
          " ", "genuinely", " ", "even", " ", "chain", " ", "just", " ", 
          "procede", " ", "as", " ", "in", " ", "the", " ", "square", " ", 
          "case"}], ",", " ", 
         RowBox[{
         "in", " ", "the", " ", "odd", " ", "case", " ", "we", " ", "are", 
          " ", "missing", " ", "the", " ", "information", " ", "about", " ", 
          "the", " ", "last", " ", "square", " ", "chain"}]}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"chain", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"Drop", "[", 
           RowBox[{"#", ",", 
            RowBox[{"{", 
             RowBox[{"3", ",", 
              RowBox[{"Length", "[", "locexp", "]"}], ",", "2"}], "}"}]}], 
           "]"}], "&"}], "@", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"Drop", "[", 
             RowBox[{"#", ",", 
              RowBox[{"{", "2", "}"}]}], "]"}], "&"}], "/@", "locexp"}], 
          ")"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"chain", "=", 
        RowBox[{"Echo", "@", 
         RowBox[{"Flatten", "@", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"Last", "@", "#"}], "\[Equal]", "1"}], "||", 
                 RowBox[{
                  RowBox[{"Last", "@", "#"}], "\[Equal]", "3"}]}], ",", 
                RowBox[{"Reverse", "@", 
                 RowBox[{"First", "@", "#"}]}], ",", 
                RowBox[{"First", "@", "#"}]}], "]"}], "&"}], "@", 
             RowBox[{"First", "@", "chain"}]}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"Last", "@", "#"}], "\[Equal]", "2"}], "||", 
                 RowBox[{
                  RowBox[{"Last", "@", "#"}], "\[Equal]", "4"}]}], ",", 
                RowBox[{"Reverse", "@", 
                 RowBox[{"First", "@", "#"}]}], ",", 
                RowBox[{"First", "@", "#"}]}], "]"}], "&"}], "/@", 
             RowBox[{"Rest", "@", "chain"}]}]}], "}"}]}]}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"EvenQ", "[", 
          RowBox[{"Length", "[", "locexp", "]"}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"type2", "=", "$angle"}], ";"}], "\[IndentingNewLine]", ",",
          "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"type2", "=", "$square"}], ";", "\[IndentingNewLine]", 
          RowBox[{"chain", "=", 
           RowBox[{"Flatten", "@", 
            RowBox[{"{", 
             RowBox[{"chain", ",", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"Last", "@", 
                   RowBox[{"Last", "@", "locexp"}]}], "\[Equal]", "2"}], "||", 
                 RowBox[{
                  RowBox[{"Last", "@", 
                   RowBox[{"Last", "@", "locexp"}]}], "\[Equal]", "3"}]}], 
                ",", 
                RowBox[{"locexp", "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "2", ",", "2"}], "]"}], "]"}], 
                ",", 
                RowBox[{"locexp", "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "2", ",", "1"}], "]"}], "]"}]}], 
               "]"}]}], "}"}]}]}], ";"}]}], "\[IndentingNewLine]", "]"}], 
       ";"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}], ";", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
     "The", " ", "sign", " ", "is", " ", "given", " ", "by", " ", "counting", 
      " ", "the", " ", "number", " ", "of", " ", "swaps", " ", "in", " ", 
      "exp"}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{"-", "1"}], ")"}], "^", 
      RowBox[{"Count", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Last", "/@", "exp"}], "}"}], ",", 
        RowBox[{"3", "|", "4"}], ",", "\[Infinity]"}], "]"}]}], "*", 
     RowBox[{"Chain", "[", 
      RowBox[{"type1", ",", 
       RowBox[{"First", "@", "chain"}], ",", 
       RowBox[{"chain", "[", 
        RowBox[{"[", 
         RowBox[{"2", ";;", 
          RowBox[{"-", "2"}]}], "]"}], "]"}], ",", 
       RowBox[{"Last", "@", "chain"}], ",", "type2"}], "]"}]}]}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellChangeTimes->{{3.8254212214023037`*^9, 3.8254212936759977`*^9}, {
   3.825421334339183*^9, 3.8254213766230907`*^9}, {3.8254217934276185`*^9, 
   3.8254218991642585`*^9}, 3.825421963597967*^9, {3.8254220174479465`*^9, 
   3.8254222402647476`*^9}, {3.8254222791617684`*^9, 3.82542232332865*^9}, {
   3.8254223633575783`*^9, 3.825422364914377*^9}, {3.8254226931185594`*^9, 
   3.825422876469904*^9}, {3.82542291278581*^9, 3.825422945410542*^9}, {
   3.825423204093251*^9, 3.825423362322393*^9}, {3.8254233959055367`*^9, 
   3.825423600533579*^9}, {3.8254260995787506`*^9, 3.8254262193316727`*^9}, {
   3.8254262634217434`*^9, 3.8254262637478714`*^9}, {3.8254262941655674`*^9, 
   3.825426294700091*^9}, {3.8254263945470314`*^9, 3.8254264565452557`*^9}, {
   3.8254264935273457`*^9, 3.825426591915146*^9}, 3.8254270265277557`*^9, {
   3.825427065393803*^9, 3.8254270833587594`*^9}, {3.825427140180791*^9, 
   3.8254271423629208`*^9}, {3.8254271738816586`*^9, 3.825427180872924*^9}, {
   3.8254272140422087`*^9, 3.8254272824082007`*^9}, {3.8254273435845947`*^9, 
   3.8254273517358*^9}, {3.825427386597537*^9, 3.825427396475134*^9}, {
   3.8254276385496206`*^9, 3.8254277029972477`*^9}, 3.8254277633149195`*^9},
 CellLabel->
  "In[235]:=",ExpressionUUID->"1a0c1dc5-a260-4bd5-8907-c24fb45a9d8a"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"3", ",", "4"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"2", ",", "3"}], "}"}], ",", "1"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"2", ",", "3"}], "}"}], ",", "2"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "4"}], "}"}], ",", "3"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"3", ",", "4"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "4"}], "}"}], ",", "4"}], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.825427765666662*^9},ExpressionUUID->"d8ce40b2-9991-4bcf-a23f-\
303a665bc528"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"3", ",", "4"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"2", ",", "3"}], "}"}], ",", "1"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"2", ",", "3"}], "}"}], ",", "2"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "4"}], "}"}], ",", "3"}], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.8254277657554326`*^9},ExpressionUUID->"1412e7bb-6361-4881-83f4-\
4c20b2ef6152"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"4", ",", "3", ",", "2", ",", "1"}], "}"}]], "Echo",
 CellChangeTimes->{
  3.825427765840201*^9},ExpressionUUID->"0edefba7-07f5-45b3-9fb1-\
6037a6622791"]
}, Open  ]],

Cell[BoxData[
 TemplateBox[{"4", 
   RowBox[{"{", 
     RowBox[{"3", ",", "2", ",", "1"}], "}"}], "4"},
  "AngleSquareChain",
  DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
  InterpretationFunction->(
   RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square", 
     "]"}]& )]], "Output",
 CellChangeTimes->{
  3.825422071618042*^9, {3.8254221274774103`*^9, 3.8254221542248745`*^9}, 
   3.8254223241613755`*^9, 3.825422365609555*^9, {3.825422853268998*^9, 
   3.825422877118207*^9}, {3.825422928505723*^9, 3.8254229467100286`*^9}, {
   3.8254232077155457`*^9, 3.8254232297366114`*^9}, {3.825423352845709*^9, 
   3.8254233628938274`*^9}, 3.825427027516073*^9, {3.8254270669516373`*^9, 
   3.8254270839291897`*^9}, 3.8254271431408806`*^9, 3.8254271817076902`*^9, {
   3.8254272168986006`*^9, 3.8254272529639187`*^9}, 3.825427283368596*^9, {
   3.8254273740440726`*^9, 3.8254273987848997`*^9}, 3.8254277045730324`*^9, 
   3.8254277659199495`*^9},
 CellLabel->
  "Out[235]=",ExpressionUUID->"f8af10dd-847a-4671-b090-ac2e23d53468"]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"listToChain", "[", 
   RowBox[{"exp_List", ",", "ag_List", ",", "sq_List"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "agbrackets", ",", "sqbrackets", ",", "locexp", ",", "type1", ",", 
      "type2", ",", "chain"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"agbrackets", "=", 
      RowBox[{"List", "@@@", "ag"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"sqbrackets", "=", 
      RowBox[{"List", "@@@", "sq"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"locexp", "=", 
      RowBox[{"Transpose", "@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Part", "[", 
             RowBox[{"agbrackets", ",", "#1"}], "]"}], ",", 
            RowBox[{"Part", "[", 
             RowBox[{"sqbrackets", ",", "#2"}], "]"}], ",", "#3"}], "}"}], 
          "&"}], "@@", 
         RowBox[{"Transpose", "@", "exp"}]}], ")"}]}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"See", " ", "who", " ", "starts", " ", "the", " ", "chain"}], 
       ",", " ", 
       RowBox[{
       "angle", " ", "or", " ", "square", " ", "and", " ", "proceed", " ", 
        "accordingly"}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"exp", "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "1"}], "]"}], "]"}], "\[Equal]", 
        RowBox[{"exp", "[", 
         RowBox[{"[", 
          RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"type1", "=", "$square"}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "squares", " ", "only", " ", "start", " ", "the", " ", "chain", " ", 
          "when", " ", "they", " ", "also", " ", "finish", " ", "it"}], 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{"type2", "=", "$square"}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
          "Pick", " ", "only", " ", "the", " ", "square", " ", "brackets", 
           " ", "of", " ", "the", " ", "relevant", " ", "pieces"}], ",", " ", 
          RowBox[{
          "the", " ", "beginning", " ", "and", " ", "then", " ", "one", " ", 
           "every", " ", "two", " ", 
           RowBox[{"contractions", ".", " ", "Order"}], " ", "is", " ", 
           "given", " ", "by", " ", "the", " ", "contraction", " ", 
           RowBox[{"type", ".", " ", "Recall"}], " ", "that", " ", "the", " ",
            "first", " ", "contraction", " ", "is", " ", "different", " ", 
           "from", " ", "the", " ", "rest", " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
             "due", " ", "to", " ", "the", " ", "skipping", " ", "of", " ", 
              "the", " ", "non"}], "-", 
             RowBox[{"relevant", " ", "terms"}]}], ")"}]}]}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"chain", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Drop", "[", 
            RowBox[{"#", ",", 
             RowBox[{"{", 
              RowBox[{"3", ",", 
               RowBox[{"Length", "[", "exp", "]"}], ",", "2"}], "}"}]}], 
            "]"}], "&"}], "@", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"Drop", "[", 
              RowBox[{"#", ",", "1"}], "]"}], "&"}], "/@", "locexp"}], 
           ")"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"chain", "=", 
         RowBox[{"Flatten", "@", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"Last", "@", "#"}], "\[Equal]", "2"}], "||", 
                 RowBox[{
                  RowBox[{"Last", "@", "#"}], "\[Equal]", "3"}]}], ",", 
                RowBox[{"Reverse", "@", 
                 RowBox[{"First", "@", "#"}]}], ",", 
                RowBox[{"First", "@", "#"}]}], "]"}], "&"}], "@", 
             RowBox[{"First", "@", "chain"}]}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"Last", "@", "#"}], "\[Equal]", "1"}], "||", 
                 RowBox[{
                  RowBox[{"Last", "@", "#"}], "\[Equal]", "4"}]}], ",", 
                RowBox[{"Reverse", "@", 
                 RowBox[{"First", "@", "#"}]}], ",", 
                RowBox[{"First", "@", "#"}]}], "]"}], "&"}], "/@", 
             RowBox[{"Rest", "@", "chain"}]}]}], "}"}]}]}], ";"}], 
       "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"type1", "=", "$angle"}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
          "Angle", " ", "chains", " ", "can", " ", "be", " ", "even", " ", 
           "or", " ", "odd", " ", "in", " ", "the", " ", "number", " ", "of", 
           " ", "contractions"}], ",", " ", 
          RowBox[{"so", " ", "we", " ", "distinguish", " ", "these", " ", 
           RowBox[{"cases", ".", " ", "Also"}]}], ",", " ", 
          RowBox[{
          "traces", " ", "can", " ", "be", " ", "represented", " ", "by", " ",
            "odd", " ", "contractions", " ", "but", " ", "appear", " ", "as", 
           " ", "even", " ", "due", " ", "to", " ", "their", " ", 
           "cyclicity"}], ",", " ", 
          RowBox[{
          "so", " ", "we", " ", "have", " ", "to", " ", "rewrite", " ", 
           "them"}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"EvenQ", "[", 
            RowBox[{"Length", "[", "exp", "]"}], "]"}], "&&", 
           RowBox[{
            RowBox[{"First", "@", 
             RowBox[{"Last", "@", "exp"}]}], "==", 
            RowBox[{"First", "@", 
             RowBox[{"First", "@", "exp"}]}]}]}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"locexp", "=", 
            RowBox[{"Most", "@", "locexp"}]}], ";"}]}], "\[IndentingNewLine]",
          "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
          "If", " ", "we", " ", "are", " ", "dealing", " ", "with", " ", "a", 
           " ", "genuinely", " ", "even", " ", "chain", " ", "just", " ", 
           "procede", " ", "as", " ", "in", " ", "the", " ", "square", " ", 
           "case"}], ",", " ", 
          RowBox[{
          "in", " ", "the", " ", "odd", " ", "case", " ", "we", " ", "are", 
           " ", "missing", " ", "the", " ", "information", " ", "about", " ", 
           "the", " ", "last", " ", "square", " ", "chain"}]}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"chain", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Drop", "[", 
            RowBox[{"#", ",", 
             RowBox[{"{", 
              RowBox[{"3", ",", 
               RowBox[{"Length", "[", "locexp", "]"}], ",", "2"}], "}"}]}], 
            "]"}], "&"}], "@", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"Drop", "[", 
              RowBox[{"#", ",", 
               RowBox[{"{", "2", "}"}]}], "]"}], "&"}], "/@", "locexp"}], 
           ")"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"chain", "=", 
         RowBox[{"Flatten", "@", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"Last", "@", "#"}], "\[Equal]", "1"}], "||", 
                 RowBox[{
                  RowBox[{"Last", "@", "#"}], "\[Equal]", "3"}]}], ",", 
                RowBox[{"Reverse", "@", 
                 RowBox[{"First", "@", "#"}]}], ",", 
                RowBox[{"First", "@", "#"}]}], "]"}], "&"}], "@", 
             RowBox[{"First", "@", "chain"}]}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"Last", "@", "#"}], "\[Equal]", "2"}], "||", 
                 RowBox[{
                  RowBox[{"Last", "@", "#"}], "\[Equal]", "4"}]}], ",", 
                RowBox[{"Reverse", "@", 
                 RowBox[{"First", "@", "#"}]}], ",", 
                RowBox[{"First", "@", "#"}]}], "]"}], "&"}], "/@", 
             RowBox[{"Rest", "@", "chain"}]}]}], "}"}]}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"EvenQ", "[", 
           RowBox[{"Length", "[", "locexp", "]"}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"type2", "=", "$angle"}], ";"}], "\[IndentingNewLine]", 
          ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"type2", "=", "$square"}], ";", "\[IndentingNewLine]", 
           RowBox[{"chain", "=", 
            RowBox[{"Flatten", "@", 
             RowBox[{"{", 
              RowBox[{"chain", ",", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"Last", "@", 
                    RowBox[{"Last", "@", "locexp"}]}], "\[Equal]", "2"}], "||", 
                  RowBox[{
                   RowBox[{"Last", "@", 
                    RowBox[{"Last", "@", "locexp"}]}], "\[Equal]", "3"}]}], 
                 ",", 
                 RowBox[{"locexp", "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"-", "1"}], ",", "2", ",", "2"}], "]"}], "]"}], 
                 ",", 
                 RowBox[{"locexp", "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"-", "1"}], ",", "2", ",", "1"}], "]"}], "]"}]}], 
                "]"}]}], "}"}]}]}], ";"}]}], "\[IndentingNewLine]", "]"}], 
        ";"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "The", " ", "sign", " ", "is", " ", "given", " ", "by", " ", "counting",
        " ", "the", " ", "number", " ", "of", " ", "swaps", " ", "in", " ", 
       "exp"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{"-", "1"}], ")"}], "^", 
       RowBox[{"Count", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"Last", "/@", "exp"}], "}"}], ",", 
         RowBox[{"3", "|", "4"}], ",", "\[Infinity]"}], "]"}]}], "*", 
      RowBox[{"Chain", "[", 
       RowBox[{"type1", ",", 
        RowBox[{"First", "@", "chain"}], ",", 
        RowBox[{"chain", "[", 
         RowBox[{"[", 
          RowBox[{"2", ";;", 
           RowBox[{"-", "2"}]}], "]"}], "]"}], ",", 
        RowBox[{"Last", "@", "chain"}], ",", "type2"}], "]"}]}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.825427981810141*^9, 3.825428041279039*^9}, {
  3.8254281025553417`*^9, 3.825428122271041*^9}},
 CellLabel->
  "In[238]:=",ExpressionUUID->"8ba7b346-46ef-456d-9f85-4ee7b513aae4"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"listToChain", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"3", ",", "2", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"1", ",", "2", ",", "2"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"3", ",", "1", ",", "4"}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      TemplateBox[{"1", "2"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], ",", 
      TemplateBox[{"5", "6"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], ",", 
      TemplateBox[{"3", "4"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], ",", 
      TemplateBox[{"2", "4"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      TemplateBox[{"1", "4"},
       "SpinorSquareBracket",
       DisplayFunction->(RowBox[{"[", 
          RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], ",", 
      TemplateBox[{"2", "3"},
       "SpinorSquareBracket",
       DisplayFunction->(RowBox[{"[", 
          RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], ",", 
      TemplateBox[{"2", "4"},
       "SpinorSquareBracket",
       DisplayFunction->(RowBox[{"[", 
          RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}], "]"}], "//", 
  "RepeatedTiming"}]], "Input",
 CellChangeTimes->{{3.825428063261281*^9, 3.825428091077055*^9}, {
  3.8254281345462484`*^9, 3.8254281377911696`*^9}},
 CellLabel->
  "In[240]:=",ExpressionUUID->"9ab6e93e-84c1-42d9-b65e-477eb647d1c8"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.00005687552490234375`", ",", 
   TemplateBox[{"4", 
     RowBox[{"{", 
       RowBox[{"3", ",", "2", ",", "1"}], "}"}], "4"},
    "AngleSquareChain",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square",
        "]"}]& )]}], "}"}]], "Output",
 CellChangeTimes->{
  3.8254280926229024`*^9, {3.82542812862109*^9, 3.825428139267218*^9}},
 CellLabel->
  "Out[240]=",ExpressionUUID->"702a9edf-d5f5-4bc7-8158-8f0d320451c8"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"test", "=", 
  RowBox[{"{", 
   RowBox[{
    TemplateBox[{"1", "2"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"5", "6"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"3", "4"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"1", "4"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"2", "3"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"2", "4"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}]], "Input",
 CellLabel->"In[28]:=",ExpressionUUID->"9bef5b19-e51d-4b1f-a1ae-4ffb69d070e8"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   TemplateBox[{"1", "2"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"5", "6"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"3", "4"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"1", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"2", "3"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"2", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]], "Output",
 CellChangeTimes->{3.8254281688520875`*^9, 3.8254803476958375`*^9},
 CellLabel->"Out[28]=",ExpressionUUID->"8626cb68-070e-4010-a17c-b703923dc779"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"chainLists", "@", "test"}], "\[IndentingNewLine]", 
 RowBox[{"Flatten", "[", 
  RowBox[{
   RowBox[{
    RowBox[{"Map", "[", 
     RowBox[{"chtest", ",", "%", ",", 
      RowBox[{"{", "2", "}"}]}], "]"}], "/.", 
    RowBox[{"chtest", "\[Rule]", "List"}]}], ",", "1"}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"listToChain", "[", 
     RowBox[{"#", ",", 
      RowBox[{"{", 
       RowBox[{
        TemplateBox[{"1", "2"},
         "SpinorAngleBracket",
         DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
            RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
         InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
            RowBox[{#, ",", #2}], "]"}]& )], ",", 
        TemplateBox[{"5", "6"},
         "SpinorAngleBracket",
         DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
            RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
         InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
            RowBox[{#, ",", #2}], "]"}]& )], ",", 
        TemplateBox[{"3", "4"},
         "SpinorAngleBracket",
         DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
            RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
         InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
            RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        TemplateBox[{"1", "4"},
         "SpinorSquareBracket",
         DisplayFunction->(RowBox[{"[", 
            RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
         InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
            RowBox[{#, ",", #2}], "]"}]& )], ",", 
        TemplateBox[{"2", "3"},
         "SpinorSquareBracket",
         DisplayFunction->(RowBox[{"[", 
            RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
         InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
            RowBox[{#, ",", #2}], "]"}]& )], ",", 
        TemplateBox[{"2", "4"},
         "SpinorSquareBracket",
         DisplayFunction->(RowBox[{"[", 
            RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
         InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
            RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}], "]"}], "&"}], "/@", 
   "%"}], "//", "RepeatedTiming"}]}], "Input",
 CellChangeTimes->{{3.825428170009988*^9, 3.8254282180554876`*^9}, {
  3.8254282512078257`*^9, 3.825428342408888*^9}, {3.825480352775219*^9, 
  3.8254803558140903`*^9}},
 CellLabel->"In[32]:=",ExpressionUUID->"b5026e45-767e-41c8-8f2c-696e31a6c720"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "2", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "1", ",", "4"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "2", ",", "1"}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "2", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "2", ",", "1"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "3", ",", "4"}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "3", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "1", ",", "4"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "2", ",", "1"}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "3", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "2", ",", "1"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "3", ",", "4"}], "}"}]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.825428177806137*^9, {3.825428210756012*^9, 3.825428219050789*^9}, {
   3.8254282714786034`*^9, 3.825428343435196*^9}, {3.825480349676507*^9, 
   3.825480356690795*^9}},
 CellLabel->"Out[32]=",ExpressionUUID->"0de31614-8e14-4f70-b978-cb2e18944ffc"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"3", ",", "2", ",", "1"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "2", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "1", ",", "4"}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "2", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "2", ",", "1"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "3", ",", "4"}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "3", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "1", ",", "4"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "2", ",", "1"}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "3", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "3", ",", "4"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "2", ",", "1"}], "}"}]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.825428177806137*^9, {3.825428210756012*^9, 3.825428219050789*^9}, {
   3.8254282714786034`*^9, 3.825428343435196*^9}, {3.825480349676507*^9, 
   3.825480356697758*^9}},
 CellLabel->"Out[33]=",ExpressionUUID->"bd87c354-0946-4b6c-ab77-73c42063048c"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.0002362794921875`", ",", 
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"4", 
       RowBox[{"{", 
         RowBox[{"3", ",", "2", ",", "1"}], "}"}], "4"},
      "AngleSquareChain",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], ",", 
     TemplateBox[{"4", 
       RowBox[{"{", 
         RowBox[{"1", ",", "2", ",", "3", ",", "4"}], "}"}], "2"},
      "SquareSquareChain",
      DisplayFunction->(RowBox[{"[", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$square", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], ",", 
     TemplateBox[{"4", 
       RowBox[{"{", 
         RowBox[{"2", ",", "1", ",", "4", ",", "3"}], "}"}], "2"},
      "SquareSquareChain",
      DisplayFunction->(RowBox[{"[", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$square", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], ",", 
     TemplateBox[{"4", 
       RowBox[{"{", 
         RowBox[{"1", ",", "2", ",", "4", ",", "3"}], "}"}], "2"},
      "SquareSquareChain",
      DisplayFunction->(RowBox[{"[", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$square", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.825428177806137*^9, {3.825428210756012*^9, 3.825428219050789*^9}, {
   3.8254282714786034`*^9, 3.825428343435196*^9}, {3.825480349676507*^9, 
   3.82548035768911*^9}},
 CellLabel->"Out[34]=",ExpressionUUID->"76e33c5b-e22d-4e0d-bdd0-da5992d406e6"]
}, Open  ]]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Putting together the pieces", "Subsection",
 CellChangeTimes->{{3.825428379620329*^9, 
  3.8254283852952046`*^9}},ExpressionUUID->"b2a0ece9-b0e0-4b5b-9328-\
845a37f9d27a"],

Cell[BoxData[
 RowBox[{"test", "=", 
  RowBox[{"{", 
   RowBox[{
    TemplateBox[{"1", "2"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"5", "6"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"3", "4"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"1", "4"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"2", "3"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"2", "4"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}]], "Input",ExpressionUUID->\
"180ce67d-b833-4000-8b57-6079ee901700"],

Cell[CellGroupData[{

Cell["Auxiliary", "Subsubsection",
 CellChangeTimes->{{3.8251640036608715`*^9, 
  3.825164005188548*^9}},ExpressionUUID->"6c2addd5-4caf-494a-bba5-\
fe110de92bff"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
   "Modified", " ", "weight", " ", "function", " ", "swapping", " ", "cases", 
    " ", "1", " ", "and", " ", "3"}], ",", " ", 
   RowBox[{
   "so", " ", "that", " ", "angle", " ", "test", " ", "still", " ", "forbids",
     " ", "even", " ", "cases", " ", "and", " ", "square", " ", "test", " ", 
    "forbids", " ", "summing", " ", "to", " ", "5", " ", 
    RowBox[{"i", ".", "e", ".", " ", "the"}], " ", "cobination", " ", "of", 
    " ", "1", " ", "with", " ", "4", " ", "and", " ", "2", " ", "with", " ", 
    "3"}]}], "*)"}]], "Input",
 CellChangeTimes->{{3.8251432012240033`*^9, 3.8251432910807285`*^9}},
 CellLabel->
  "In[420]:=",ExpressionUUID->"d5e98609-40f9-4e18-9863-b54f4095e4ad"],

Cell[BoxData[
 RowBox[{
  RowBox[{"weight", "[", 
   RowBox[{
    RowBox[{"SpinorAngleBracket", "[", 
     RowBox[{"i_", ",", "j_"}], "]"}], ",", 
    RowBox[{"SpinorSquareBracket", "[", 
     RowBox[{"k_", ",", "l_"}], "]"}]}], "]"}], ":=", 
  RowBox[{"Which", "[", 
   RowBox[{
    RowBox[{"i", "===", "k"}], ",", "3", ",", 
    RowBox[{"j", "===", "k"}], ",", "2", ",", 
    RowBox[{"i", "===", "l"}], ",", "1", ",", 
    RowBox[{"j", "===", "l"}], ",", "4", ",", "True", ",", "0"}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.825143302413413*^9, 3.8251433054851465`*^9}},
 CellLabel->
  "In[421]:=",ExpressionUUID->"40a9fed7-7ca3-42bd-a11a-7bef5decedc4"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "sqtest", " ", "checks", " ", "whther", " ", "all", " ", "the", " ", 
   "contractions", " ", "with", " ", "the", " ", "square", " ", "brackets", 
   " ", "are", " ", 
   RowBox[{"possible", ".", " ", "In"}], " ", "particular", " ", "you", " ", 
   "cannot", " ", "have", " ", "the", " ", "same", " ", "square", " ", 
   "bracket", " ", "whose", " ", "first", " ", "label", " ", "contract", " ", 
   "more", " ", "than", " ", "one", " ", "angle", " ", 
   RowBox[{"bracket", ".", " ", "This"}], " ", "is", " ", "checked", " ", 
   "by", " ", "looking", " ", "at", " ", "the", " ", 
   RowBox[{"labels", ".", " ", "The"}], " ", "implemented", " ", "test", " ", 
   "condition", " ", "proved", " ", "to", " ", "be", " ", "the", " ", 
   "fasted", " ", "I", " ", "could", " ", "find"}], "*)"}]], "Input",
 CellChangeTimes->{{3.825144134234501*^9, 3.82514417318128*^9}, {
  3.82514424038459*^9, 3.825144265550265*^9}, {3.825144692019476*^9, 
  3.825144705975103*^9}},
 CellLabel->
  "In[422]:=",ExpressionUUID->"ca294ee3-45ac-456c-a145-cb7366cdbe9a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"sqtest", "[", "exp_List", "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"Equal", "[", 
       RowBox[{
        RowBox[{"Length", "@", "#"}], ",", 
        RowBox[{"Length", "@", 
         RowBox[{"DeleteCases", "[", 
          RowBox[{"#", ",", 
           RowBox[{"_", "?", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"!", 
               RowBox[{"MatchQ", "[", 
                RowBox[{"#", ",", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"_", ",", "i_", ",", "j_"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"_", ",", "k_", ",", "l_"}], "}"}]}], "}"}], "/;", 
                    RowBox[{
                    RowBox[{"j", "\[NotEqual]", "l"}], "&&", 
                    RowBox[{
                    RowBox[{"j", "+", "l"}], "\[NotEqual]", "5"}]}]}], ")"}], 
                  "|", 
                  RowBox[{"{", 
                   RowBox[{"{", 
                    RowBox[{"_", ",", "_", ",", "_"}], "}"}], "}"}]}]}], 
                "]"}]}], "&"}], ")"}]}]}], "]"}]}]}], "]"}], "&"}], "@", 
     RowBox[{"GatherBy", "[", 
      RowBox[{"#", ",", 
       RowBox[{
        RowBox[{"Part", "[", 
         RowBox[{"#", ",", "2"}], "]"}], "&"}]}], "]"}]}], "&"}], "@", 
   RowBox[{"Flatten", "[", 
    RowBox[{"exp", ",", "1"}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.8251649220877457`*^9, 3.8251649884554443`*^9}},
 CellLabel->
  "In[423]:=",ExpressionUUID->"2ffe182a-c16b-414b-9dca-1516d45792c7"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "The", " ", "next", " ", "functions", " ", "build", " ", "all", " ", "the", 
   " ", "possible", " ", "pairings", " ", "of", " ", "contractions", " ", 
   "testing", " ", "the", " ", "square", " ", 
   RowBox[{"brackets", ".", " ", "I"}], " ", "use", " ", "Outer", " ", 
   "instead", " ", "of", " ", "Tuples", " ", "because", " ", "like", " ", 
   "this", " ", "I", " ", "can", " ", "perform", " ", "the", " ", "test", " ",
    "at", " ", "each", " ", "step", " ", "and", " ", "not", " ", "just", " ", 
   "at", " ", "the", " ", 
   RowBox[{"end", ".", " ", "For"}], " ", "large", " ", "number", " ", "of", 
   " ", "possible", " ", "contractions", " ", "with", " ", "many", " ", 
   "cancellations", " ", "this", " ", "should", " ", "speed", " ", "up", " ", 
   "the", " ", 
   RowBox[{"process", ".", " ", "In"}], " ", "simple", " ", "cases", " ", 
   "it", " ", "might", " ", "be", " ", "slower"}], "*)"}]], "Input",
 CellChangeTimes->{{3.8251532734611387`*^9, 3.825153351078512*^9}, {
  3.825153525268777*^9, 3.825153530183632*^9}},
 CellLabel->
  "In[424]:=",ExpressionUUID->"5f497da6-7756-4aec-ab0d-d698dfb20fb0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"pairing", "[", 
   RowBox[{"x_", ",", "y_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"sqtest", "[", "#", "]"}], ",", "#", ",", 
      RowBox[{"Nothing", "[", "]"}]}], "]"}], "&"}], "@", 
   RowBox[{"Join", "[", 
    RowBox[{"x", ",", 
     RowBox[{"{", "y", "}"}]}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.82514478020856*^9, 3.8251447833053293`*^9}, {
  3.825144817546748*^9, 3.8251448402901435`*^9}, {3.8251449372617846`*^9, 
  3.8251449992519736`*^9}, {3.825150697782158*^9, 3.825150698843295*^9}},
 CellLabel->
  "In[425]:=",ExpressionUUID->"a5349cfb-aaee-4c59-a6f0-4732c13d1392"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "If", " ", "exp", " ", "has", " ", "length", " ", "one", " ", "return", 
    " ", "exp"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"allpairings", "[", 
      RowBox[{"{", "exp_List", "}"}], "]"}], ":=", 
     RowBox[{"{", "exp", "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"allpairings", "[", "exp_List", "]"}], ":=", 
     RowBox[{"Fold", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"Outer", "[", 
           RowBox[{"pairing", ",", "#1", ",", "#2", ",", "1"}], "]"}], ",", 
          "1"}], "]"}], "&"}], ",", 
       RowBox[{
        RowBox[{
         RowBox[{"{", "#", "}"}], "&"}], "/@", 
        RowBox[{"(", 
         RowBox[{"First", "@", "exp"}], ")"}]}], ",", 
       RowBox[{"exp", "[", 
        RowBox[{"[", 
         RowBox[{"2", ";;"}], "]"}], "]"}]}], "]"}]}], ";"}]}]}]], "Input",
 CellChangeTimes->{{3.82515294362909*^9, 3.825152985796472*^9}, {
  3.8254974509768333`*^9, 3.8254974632071238`*^9}, {3.8254975192059264`*^9, 
  3.8254975596278133`*^9}, {3.825497784988903*^9, 3.825497785739949*^9}},
 CellLabel->
  "In[426]:=",ExpressionUUID->"e5da7451-8b61-40d0-95bf-f643b09aa71a"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "allpairings", " ", "again", " ", "with", " ", "Tuples", " ", "and", " ", 
   "check", " ", "at", " ", "the", " ", "end"}], "*)"}]], "Input",
 CellChangeTimes->{{3.825153269438916*^9, 3.82515327089896*^9}, {
  3.8251533804978204`*^9, 3.825153392141677*^9}, {3.8254809051915317`*^9, 
  3.825480905945515*^9}},
 CellLabel->
  "In[428]:=",ExpressionUUID->"7e4f76cb-e3f8-479a-a374-a3a06cb5800e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"allpairingsTuples", "[", "exp_List", "]"}], ":=", 
  RowBox[{"DeleteCases", "[", 
   RowBox[{
    RowBox[{"Tuples", "@", "exp"}], ",", 
    RowBox[{"_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"!", 
        RowBox[{"sqtest", "[", "#", "]"}]}], "&"}], ")"}]}]}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.825153395367054*^9, 3.8251534576026335`*^9}, 
   3.8251534900530086`*^9},
 CellLabel->
  "In[429]:=",ExpressionUUID->"8e42a1b3-13a1-4ffe-ab31-71de6c5b4145"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"chtest", " ", "reorders", " ", "the", " ", "terms"}], 
  "*)"}]], "Input",
 CellChangeTimes->{{3.8254104415280056`*^9, 3.8254104604339056`*^9}},
 CellLabel->
  "In[430]:=",ExpressionUUID->"ea061cc6-3cd9-4bfe-a3b1-5d420fc4d1fa"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Pair", " ", "up", " ", "everything", " ", "by", " ", "contracted", " ", 
    "square", " ", "brackets"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"chtest", " ", "/:", " ", 
     RowBox[{"List", "[", 
      RowBox[{"x1___", ",", 
       RowBox[{"chtest", "[", 
        RowBox[{"{", 
         RowBox[{"i_", ",", "j_", ",", "k_"}], "}"}], "]"}], ",", "x2___", 
       ",", 
       RowBox[{"chtest", "[", 
        RowBox[{"{", 
         RowBox[{"q_", ",", "j_", ",", "l_"}], "}"}], "]"}], ",", "x3___"}], 
      "]"}], ":=", 
     RowBox[{"List", "[", 
      RowBox[{"x1", ",", "x2", ",", "x3", ",", 
       RowBox[{"chtest", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"i", ",", "j", ",", "k"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"q", ",", "j", ",", "l"}], "}"}]}], "]"}]}], "]"}]}], ";"}],
    "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Further", " ", "connect", " ", "by", " ", "contracted", " ", "angles"}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"chtest", " ", "/:", " ", 
     RowBox[{"List", "[", 
      RowBox[{"x1___", ",", 
       RowBox[{"chtest", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"i_", ",", "j_", ",", "k_"}], "}"}], ",", "y1___"}], "]"}], 
       ",", "x2___", ",", 
       RowBox[{"chtest", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"i_", ",", "q_", ",", "l_"}], "}"}], ",", "y2___"}], "]"}], 
       ",", "x3___"}], "]"}], ":=", 
     RowBox[{"List", "[", 
      RowBox[{"x1", ",", "x2", ",", "x3", ",", 
       RowBox[{"chtest", "[", 
        RowBox[{
         RowBox[{"Sequence", "@@", 
          RowBox[{"Reverse", "[", 
           RowBox[{"{", "y2", "}"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "q", ",", "l"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "j", ",", "k"}], "}"}], ",", "y1"}], "]"}]}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"chtest", " ", "/:", " ", 
     RowBox[{"List", "[", 
      RowBox[{"x1___", ",", 
       RowBox[{"chtest", "[", 
        RowBox[{"y1___", ",", 
         RowBox[{"{", 
          RowBox[{"i_", ",", "j_", ",", "k_"}], "}"}]}], "]"}], ",", "x2___", 
       ",", 
       RowBox[{"chtest", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"i_", ",", "q_", ",", "l_"}], "}"}], ",", "y2___"}], "]"}], 
       ",", "x3___"}], "]"}], ":=", 
     RowBox[{"List", "[", 
      RowBox[{"x1", ",", "x2", ",", "x3", ",", 
       RowBox[{"chtest", "[", 
        RowBox[{"y1", ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "j", ",", "k"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "q", ",", "l"}], "}"}], ",", "y2"}], "]"}]}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"chtest", " ", "/:", " ", 
     RowBox[{"List", "[", 
      RowBox[{"x1___", ",", 
       RowBox[{"chtest", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"i_", ",", "q_", ",", "l_"}], "}"}], ",", "y2___"}], "]"}], 
       ",", "x2___", ",", 
       RowBox[{"chtest", "[", 
        RowBox[{"y1___", ",", 
         RowBox[{"{", 
          RowBox[{"i_", ",", "j_", ",", "k_"}], "}"}]}], "]"}], ",", 
       "x3___"}], "]"}], ":=", 
     RowBox[{"List", "[", 
      RowBox[{"x1", ",", "x2", ",", "x3", ",", 
       RowBox[{"chtest", "[", 
        RowBox[{"y1", ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "j", ",", "k"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "q", ",", "l"}], "}"}], ",", "y2"}], "]"}]}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"chtest", " ", "/:", " ", 
     RowBox[{"List", "[", 
      RowBox[{"x1___", ",", 
       RowBox[{"chtest", "[", 
        RowBox[{"y1___", ",", 
         RowBox[{"{", 
          RowBox[{"i_", ",", "j_", ",", "k_"}], "}"}]}], "]"}], ",", "x2___", 
       ",", 
       RowBox[{"chtest", "[", 
        RowBox[{"y2___", ",", 
         RowBox[{"{", 
          RowBox[{"i_", ",", "q_", ",", "l_"}], "}"}]}], "]"}], ",", 
       "x3___"}], "]"}], ":=", 
     RowBox[{"List", "[", 
      RowBox[{"x1", ",", "x2", ",", "x3", ",", 
       RowBox[{"chtest", "[", 
        RowBox[{"y1", ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "j", ",", "k"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "q", ",", "l"}], "}"}], ",", 
         RowBox[{"Sequence", "@@", 
          RowBox[{"Reverse", "[", 
           RowBox[{"{", "y2", "}"}], "]"}]}]}], "]"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]"}]}]], "Input",
 CellChangeTimes->{{3.825403206149293*^9, 3.8254032252651596`*^9}, {
   3.825403255669839*^9, 3.8254033252178206`*^9}, 3.825403380687515*^9, {
   3.82540893299856*^9, 3.8254090034364834`*^9}, {3.825409034106453*^9, 
   3.8254091585344543`*^9}, {3.82540919679412*^9, 3.8254094222950306`*^9}, {
   3.825409667901141*^9, 3.8254097067761097`*^9}},
 CellLabel->
  "In[431]:=",ExpressionUUID->"f496a6c6-9130-4f15-a504-1b2b7809100f"]
}, Closed]],

Cell[CellGroupData[{

Cell["From list of brackets to list of chains", "Subsubsection",
 CellChangeTimes->{{3.8254284765411015`*^9, 
  3.8254284892640715`*^9}},ExpressionUUID->"1a0a0f87-986d-4f0a-bbba-\
313738323f4e"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"chainLists", "[", "exp_List", "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ag", ",", "sq", ",", "allchains", ",", "local"}], "}"}], ",", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Split", " ", "square", " ", "from", " ", 
       RowBox[{"angles", ".", " ", "The"}], " ", "expression", " ", "comes", 
       " ", "from", " ", "a", " ", "Times", " ", "so", " ", "it", " ", "will",
        " ", "already", " ", "be", " ", "ordered", " ", "with", " ", "angles",
        " ", "first"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"ag", ",", "sq"}], "}"}], "=", 
       RowBox[{"SplitBy", "[", 
        RowBox[{"exp", ",", "Head"}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "allcontractions", " ", "gives", " ", "all", " ", "the", " ", 
         "possible", " ", "contractions", " ", "of", " ", "the", " ", 
         "angles", " ", "with", " ", "the", " ", 
         RowBox[{"squares", ".", " ", "Angles"}], " ", "are", " ", "labelled",
          " ", "by", " ", "row", " ", "in", " ", "matrix"}], ",", " ", 
        RowBox[{"squares", " ", "by", " ", "explicit", " ", "label", " ", 
         RowBox[{"(", 
          RowBox[{
          "in", " ", "order", " ", "to", " ", "avoid", " ", "gigantic", " ", 
           "matrices"}], ")"}], " ", "and", " ", "second", " ", "label", " ", 
         "is", " ", 
         RowBox[{"weight", ".", " ", "We"}], " ", "remove", " ", "all", " ", 
         "the", " ", "terms", " ", "signaling", " ", "no", " ", "possible", 
         " ", "contraction"}]}], "*)"}], "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"allchains", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"DeleteCases", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", "}"}]}], "]"}], "&"}], "@", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"DeleteCases", "[", 
            RowBox[{"#", ",", 
             RowBox[{"{", 
              RowBox[{"_", ",", "_", ",", "0"}], "}"}]}], "]"}], "&"}], "/@", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"i", ",", "j", ",", 
              RowBox[{"weight", "[", 
               RowBox[{
                RowBox[{"ag", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], ",", 
                RowBox[{"sq", "[", 
                 RowBox[{"[", "j", "]"}], "]"}]}], "]"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", 
              RowBox[{"Length", "[", "ag", "]"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", 
              RowBox[{"Length", "[", "sq", "]"}]}], "}"}]}], "]"}]}], 
         ")"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Next", " ", "out", " ", "of", " ", "the", " ", "possible", " ", 
         "contractions", " ", "on", " ", "the", " ", "single", " ", "row", 
         " ", "we", " ", "take", " ", "pairs", " ", "of", " ", "compatible", 
         " ", "contractions"}], ",", " ", 
        RowBox[{
        "so", " ", "first", " ", "take", " ", "Subsets", " ", "grouping", " ",
          "by", " ", "2"}], ",", " ", 
        RowBox[{
        "then", " ", "delete", " ", "those", " ", "whose", " ", "associated", 
         " ", "weight", " ", "sum", " ", "is", " ", 
         RowBox[{"even", ".", " ", "The"}], " ", "weights", " ", "have", " ", 
         "been", " ", "assigned", " ", "exactly", " ", "in", " ", "such", " ",
          "a", " ", "way", " ", "that", " ", "these", " ", "are", " ", "the", 
         " ", "forbidden", " ", 
         RowBox[{"cases", ".", " ", "Then"}], " ", "take", " ", "all", " ", 
         "the", " ", "possible", " ", "combinations", " ", "of", " ", "the", 
         " ", "allowed", " ", "contractions"}]}], "*)"}], 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"allchains", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "#", "]"}], ">", "1"}], ",", 
           RowBox[{"Subsets", "[", 
            RowBox[{"#", ",", 
             RowBox[{"{", "2", "}"}]}], "]"}], ",", 
           RowBox[{"{", "#", "}"}]}], "]"}], "&"}], "/@", "allchains"}]}], 
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"allchains", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{"#", ",", "1"}], "]"}], "&"}], "/@", 
        RowBox[{"allpairings", "@", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"DeleteCases", "[", 
             RowBox[{"#", ",", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"_", ",", "_", ",", "j_"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"_", ",", "_", ",", "l_"}], "}"}]}], "}"}], "/;", 
               RowBox[{"EvenQ", "[", 
                RowBox[{"j", "+", "l"}], "]"}]}]}], "]"}], "&"}], "/@", 
           "allchains"}], ")"}]}]}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Along", " ", "with", " ", "the", " ", "chains", " ", "return", " ", 
        "also", " ", "a", " ", "list", " ", "of", " ", "the", " ", 
        "uncontracted", " ", "brackets"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"{", 
        RowBox[{"allchains", ",", 
         RowBox[{"Flatten", "/@", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Part", "[", 
                RowBox[{"ag", ",", "#1"}], "]"}], ",", 
               RowBox[{"Part", "[", 
                RowBox[{"sq", ",", "#2"}], "]"}]}], "}"}], "&"}], "@@@", 
            RowBox[{"Apply", "[", 
             RowBox[{"Complement", ",", 
              RowBox[{"Map", "[", 
               RowBox[{"Transpose", ",", 
                RowBox[{"Flatten", "[", 
                 RowBox[{
                  RowBox[{"Outer", "[", 
                   RowBox[{"List", ",", 
                    RowBox[{"Sequence", "@@", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Range", "@", 
                    RowBox[{"Length", "[", "ag", "]"}]}], ",", 
                    RowBox[{"Range", "@", 
                    RowBox[{"Length", "[", "sq", "]"}]}]}], "}"}], "}"}], ",", 
                    RowBox[{"Most", "/@", 
                    RowBox[{"Transpose", "/@", "allchains"}]}]}], "}"}]}], 
                    ",", "1"}], "]"}], ",", "1"}], "]"}]}], "]"}], ",", 
              RowBox[{"{", "2", "}"}]}], "]"}]}], ")"}]}]}], "}"}], "]"}]}]}],
     "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.8250489430100217`*^9, 3.825048947557375*^9}, {
   3.825049006710558*^9, 3.825049074556138*^9}, {3.8250491522231135`*^9, 
   3.825049205602866*^9}, {3.8250493818461633`*^9, 3.825049814208542*^9}, {
   3.825049852800672*^9, 3.8250498620017524`*^9}, {3.8250499163703876`*^9, 
   3.8250499500710087`*^9}, {3.82504998443499*^9, 3.825050003109603*^9}, {
   3.8250500743860774`*^9, 3.825050100389584*^9}, {3.825050130990181*^9, 
   3.825050131387205*^9}, {3.825050177893777*^9, 3.8250502022576065`*^9}, {
   3.8250506517982974`*^9, 3.825050746326376*^9}, {3.8250507938855376`*^9, 
   3.825050812487685*^9}, {3.8250508531843452`*^9, 3.82505086522179*^9}, {
   3.8250509146979876`*^9, 3.8250509157083936`*^9}, {3.825050983177038*^9, 
   3.8250509994868546`*^9}, {3.825051208589814*^9, 3.825051275511667*^9}, {
   3.8250513206147437`*^9, 3.8250513872885685`*^9}, {3.8250516078658533`*^9, 
   3.8250516136252956`*^9}, {3.8250517664954624`*^9, 3.825051770127508*^9}, {
   3.8250518206059294`*^9, 3.825051846123903*^9}, {3.825051925183688*^9, 
   3.8250519275589724`*^9}, {3.8250523483729095`*^9, 3.825052352449723*^9}, {
   3.825052392481635*^9, 3.8250523984448338`*^9}, {3.825052437336427*^9, 
   3.825052465391181*^9}, {3.825052497635206*^9, 3.8250525056443415`*^9}, {
   3.8250551240297585`*^9, 3.8250551605496454`*^9}, {3.8250552065227757`*^9, 
   3.825055268474984*^9}, {3.8250553032400627`*^9, 3.8250553584779854`*^9}, {
   3.8250554520502043`*^9, 3.8250554584306774`*^9}, {3.8250717449311457`*^9, 
   3.8250717647580194`*^9}, {3.8250763235261602`*^9, 
   3.8250763491618614`*^9}, {3.8250764189852667`*^9, 3.825076423588516*^9}, {
   3.825076779954033*^9, 3.8250768100281878`*^9}, {3.8250768501310673`*^9, 
   3.8250768548213673`*^9}, {3.8250768890118275`*^9, 3.825076942722869*^9}, {
   3.8250773419806757`*^9, 3.8250773921179256`*^9}, {3.8250774271969995`*^9, 
   3.825077612206614*^9}, {3.825077747295968*^9, 3.8250777885611854`*^9}, {
   3.8250781889449973`*^9, 3.8250782151625633`*^9}, {3.8251438352850637`*^9, 
   3.82514383712908*^9}, {3.8251441896322765`*^9, 3.8251442314135733`*^9}, {
   3.825153560815752*^9, 3.8251536205818815`*^9}, {3.8251580243172936`*^9, 
   3.8251581095729237`*^9}, {3.82515814455998*^9, 3.8251581642060394`*^9}, {
   3.825158198404315*^9, 3.825158230124658*^9}, {3.8251582675244884`*^9, 
   3.825158291352307*^9}, {3.8251583283322268`*^9, 3.8251583451283407`*^9}, {
   3.8251584192524185`*^9, 3.8251584349104805`*^9}, {3.8251584815404825`*^9, 
   3.8251585461280966`*^9}, {3.8251586173523707`*^9, 
   3.8251586336186314`*^9}, {3.8251587018732376`*^9, 
   3.8251587045390205`*^9}, {3.825158943880517*^9, 3.8251589511095767`*^9}, {
   3.8251589817399063`*^9, 3.825158983405657*^9}, {3.8251590218583217`*^9, 
   3.825159174009163*^9}, {3.8251592157534723`*^9, 3.8251592599342685`*^9}, {
   3.8251592924849544`*^9, 3.8251592998090887`*^9}, {3.825159357707556*^9, 
   3.825159384902178*^9}, {3.825159933483389*^9, 3.825159966965823*^9}, {
   3.8251636129103165`*^9, 3.8251636185563736`*^9}, {3.8251637260802183`*^9, 
   3.825163730467022*^9}, {3.8251641256215105`*^9, 3.825164230318243*^9}, {
   3.8251643559017973`*^9, 3.825164363862764*^9}, {3.825164442803305*^9, 
   3.825164463449709*^9}, {3.8251650639291334`*^9, 3.8251650955606136`*^9}, {
   3.825165781109802*^9, 3.825165920450986*^9}, {3.8251661111327715`*^9, 
   3.8251661127612123`*^9}, {3.825166146117394*^9, 3.8251661475695477`*^9}, {
   3.8251661783039894`*^9, 3.825166195292718*^9}, {3.8251662735647707`*^9, 
   3.825166353105399*^9}, {3.825166396016432*^9, 3.825166406853433*^9}, {
   3.825168220344531*^9, 3.8251682462652087`*^9}, {3.825168398490062*^9, 
   3.8251684537508097`*^9}, {3.8251686053692865`*^9, 3.8251686392856116`*^9}, 
   3.825480861456559*^9, {3.825481009751027*^9, 3.8254810470533085`*^9}, {
   3.8254811199403114`*^9, 3.8254811417599497`*^9}, {3.825481225780012*^9, 
   3.8254812685981145`*^9}, {3.825481333157443*^9, 3.825481367525523*^9}, {
   3.825481435047923*^9, 3.8254815109160023`*^9}, {3.825481934167982*^9, 
   3.8254819965581093`*^9}, {3.8254820392230053`*^9, 
   3.8254820918732376`*^9}, {3.8254821992799644`*^9, 3.825482273506331*^9}, {
   3.8254823084638324`*^9, 3.8254823508375516`*^9}, {3.8254824156422234`*^9, 
   3.825482455622239*^9}, {3.8254825529279313`*^9, 3.8254826589856634`*^9}, {
   3.825482907711004*^9, 3.8254829358083735`*^9}, {3.82548298293696*^9, 
   3.8254831186647434`*^9}, {3.825483206109913*^9, 3.825483301061756*^9}, {
   3.8254833650645723`*^9, 3.8254833703434534`*^9}, {3.8254835515946727`*^9, 
   3.825483663512661*^9}, {3.8255089393111*^9, 3.825508942909109*^9}},
 CellLabel->
  "In[436]:=",ExpressionUUID->"91c47b70-5963-42eb-80fe-a9d70fc30a89"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "Giving", " ", "angles", " ", "and", " ", "squares", " ", "separated", " ", 
   "as", " ", "an", " ", "input"}], "*)"}]], "Input",
 CellChangeTimes->{{3.825484041237546*^9, 3.825484055608059*^9}},
 CellLabel->
  "In[437]:=",ExpressionUUID->"7b8e43b2-1521-4652-ad2e-419c48e0b60e"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"chainLists", "[", 
    RowBox[{"ag_List", ",", "sq_List"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "allchains", "}"}], ",", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
       "allcontractions", " ", "gives", " ", "all", " ", "the", " ", 
        "possible", " ", "contractions", " ", "of", " ", "the", " ", "angles",
         " ", "with", " ", "the", " ", 
        RowBox[{"squares", ".", " ", "Angles"}], " ", "are", " ", "labelled", 
        " ", "by", " ", "row", " ", "in", " ", "matrix"}], ",", " ", 
       RowBox[{"squares", " ", "by", " ", "explicit", " ", "label", " ", 
        RowBox[{"(", 
         RowBox[{
         "in", " ", "order", " ", "to", " ", "avoid", " ", "gigantic", " ", 
          "matrices"}], ")"}], " ", "and", " ", "second", " ", "label", " ", 
        "is", " ", 
        RowBox[{"weight", ".", " ", "We"}], " ", "remove", " ", "all", " ", 
        "the", " ", "terms", " ", "signaling", " ", "no", " ", "possible", 
        " ", "contraction"}]}], "*)"}], "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"allchains", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"DeleteCases", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", "}"}]}], "]"}], "&"}], "@", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"DeleteCases", "[", 
            RowBox[{"#", ",", 
             RowBox[{"{", 
              RowBox[{"_", ",", "_", ",", "0"}], "}"}]}], "]"}], "&"}], "/@", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"i", ",", "j", ",", 
              RowBox[{"weight", "[", 
               RowBox[{
                RowBox[{"ag", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], ",", 
                RowBox[{"sq", "[", 
                 RowBox[{"[", "j", "]"}], "]"}]}], "]"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", 
              RowBox[{"Length", "[", "ag", "]"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", 
              RowBox[{"Length", "[", "sq", "]"}]}], "}"}]}], "]"}]}], 
         ")"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Next", " ", "out", " ", "of", " ", "the", " ", "possible", " ", 
         "contractions", " ", "on", " ", "the", " ", "single", " ", "row", 
         " ", "we", " ", "take", " ", "pairs", " ", "of", " ", "compatibel", 
         " ", "contractions"}], ",", " ", 
        RowBox[{
        "so", " ", "first", " ", "take", " ", "Subsets", " ", "grouping", " ",
          "by", " ", "2"}], ",", " ", 
        RowBox[{
        "then", " ", "delete", " ", "those", " ", "whose", " ", "associated", 
         " ", "weight", " ", "sum", " ", "is", " ", 
         RowBox[{"even", ".", " ", "The"}], " ", "weights", " ", "have", " ", 
         "been", " ", "assigned", " ", "exactly", " ", "in", " ", "such", " ",
          "a", " ", "way", " ", "that", " ", "these", " ", "are", " ", "the", 
         " ", "forbidden", " ", 
         RowBox[{"cases", ".", " ", "Then"}], " ", "take", " ", "all", " ", 
         "the", " ", "possible", " ", "combinations", " ", "of", " ", "the", 
         " ", "allowed", " ", "contractions"}]}], "*)"}], 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"allchains", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "#", "]"}], ">", "1"}], ",", 
           RowBox[{"Subsets", "[", 
            RowBox[{"#", ",", 
             RowBox[{"{", "2", "}"}]}], "]"}], ",", 
           RowBox[{"{", "#", "}"}]}], "]"}], "&"}], "/@", "allchains"}]}], 
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"allchains", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{"#", ",", "1"}], "]"}], "&"}], "/@", 
        RowBox[{"allpairings", "@", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"DeleteCases", "[", 
             RowBox[{"#", ",", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"_", ",", "_", ",", "j_"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"_", ",", "_", ",", "l_"}], "}"}]}], "}"}], "/;", 
               RowBox[{"EvenQ", "[", 
                RowBox[{"j", "+", "l"}], "]"}]}]}], "]"}], "&"}], "/@", 
           "allchains"}], ")"}]}]}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Along", " ", "with", " ", "the", " ", "chains", " ", "return", " ", 
        "also", " ", "a", " ", "list", " ", "of", " ", "the", " ", 
        "uncontracted", " ", "brackets"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"{", 
        RowBox[{"allchains", ",", 
         RowBox[{"Flatten", "/@", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Part", "[", 
                RowBox[{"ag", ",", "#1"}], "]"}], ",", 
               RowBox[{"Part", "[", 
                RowBox[{"sq", ",", "#2"}], "]"}]}], "}"}], "&"}], "@@@", 
            RowBox[{"Apply", "[", 
             RowBox[{"Complement", ",", 
              RowBox[{"Map", "[", 
               RowBox[{"Transpose", ",", 
                RowBox[{"Flatten", "[", 
                 RowBox[{
                  RowBox[{"Outer", "[", 
                   RowBox[{"List", ",", 
                    RowBox[{"Sequence", "@@", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Range", "@", 
                    RowBox[{"Length", "[", "ag", "]"}]}], ",", 
                    RowBox[{"Range", "@", 
                    RowBox[{"Length", "[", "sq", "]"}]}]}], "}"}], "}"}], ",", 
                    RowBox[{"Most", "/@", 
                    RowBox[{"Transpose", "/@", "allchains"}]}]}], "}"}]}], 
                    ",", "1"}], "]"}], ",", "1"}], "]"}]}], "]"}], ",", 
              RowBox[{"{", "2", "}"}]}], "]"}]}], ")"}]}]}], "}"}], "]"}]}]}],
     "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.8250489430100217`*^9, 3.825048947557375*^9}, {
   3.825049006710558*^9, 3.825049074556138*^9}, {3.8250491522231135`*^9, 
   3.825049205602866*^9}, {3.8250493818461633`*^9, 3.825049814208542*^9}, {
   3.825049852800672*^9, 3.8250498620017524`*^9}, {3.8250499163703876`*^9, 
   3.8250499500710087`*^9}, {3.82504998443499*^9, 3.825050003109603*^9}, {
   3.8250500743860774`*^9, 3.825050100389584*^9}, {3.825050130990181*^9, 
   3.825050131387205*^9}, {3.825050177893777*^9, 3.8250502022576065`*^9}, {
   3.8250506517982974`*^9, 3.825050746326376*^9}, {3.8250507938855376`*^9, 
   3.825050812487685*^9}, {3.8250508531843452`*^9, 3.82505086522179*^9}, {
   3.8250509146979876`*^9, 3.8250509157083936`*^9}, {3.825050983177038*^9, 
   3.8250509994868546`*^9}, {3.825051208589814*^9, 3.825051275511667*^9}, {
   3.8250513206147437`*^9, 3.8250513872885685`*^9}, {3.8250516078658533`*^9, 
   3.8250516136252956`*^9}, {3.8250517664954624`*^9, 3.825051770127508*^9}, {
   3.8250518206059294`*^9, 3.825051846123903*^9}, {3.825051925183688*^9, 
   3.8250519275589724`*^9}, {3.8250523483729095`*^9, 3.825052352449723*^9}, {
   3.825052392481635*^9, 3.8250523984448338`*^9}, {3.825052437336427*^9, 
   3.825052465391181*^9}, {3.825052497635206*^9, 3.8250525056443415`*^9}, {
   3.8250551240297585`*^9, 3.8250551605496454`*^9}, {3.8250552065227757`*^9, 
   3.825055268474984*^9}, {3.8250553032400627`*^9, 3.8250553584779854`*^9}, {
   3.8250554520502043`*^9, 3.8250554584306774`*^9}, {3.8250717449311457`*^9, 
   3.8250717647580194`*^9}, {3.8250763235261602`*^9, 
   3.8250763491618614`*^9}, {3.8250764189852667`*^9, 3.825076423588516*^9}, {
   3.825076779954033*^9, 3.8250768100281878`*^9}, {3.8250768501310673`*^9, 
   3.8250768548213673`*^9}, {3.8250768890118275`*^9, 3.825076942722869*^9}, {
   3.8250773419806757`*^9, 3.8250773921179256`*^9}, {3.8250774271969995`*^9, 
   3.825077612206614*^9}, {3.825077747295968*^9, 3.8250777885611854`*^9}, {
   3.8250781889449973`*^9, 3.8250782151625633`*^9}, {3.8251438352850637`*^9, 
   3.82514383712908*^9}, {3.8251441896322765`*^9, 3.8251442314135733`*^9}, {
   3.825153560815752*^9, 3.8251536205818815`*^9}, {3.8251580243172936`*^9, 
   3.8251581095729237`*^9}, {3.82515814455998*^9, 3.8251581642060394`*^9}, {
   3.825158198404315*^9, 3.825158230124658*^9}, {3.8251582675244884`*^9, 
   3.825158291352307*^9}, {3.8251583283322268`*^9, 3.8251583451283407`*^9}, {
   3.8251584192524185`*^9, 3.8251584349104805`*^9}, {3.8251584815404825`*^9, 
   3.8251585461280966`*^9}, {3.8251586173523707`*^9, 
   3.8251586336186314`*^9}, {3.8251587018732376`*^9, 
   3.8251587045390205`*^9}, {3.825158943880517*^9, 3.8251589511095767`*^9}, {
   3.8251589817399063`*^9, 3.825158983405657*^9}, {3.8251590218583217`*^9, 
   3.825159174009163*^9}, {3.8251592157534723`*^9, 3.8251592599342685`*^9}, {
   3.8251592924849544`*^9, 3.8251592998090887`*^9}, {3.825159357707556*^9, 
   3.825159384902178*^9}, {3.825159933483389*^9, 3.825159966965823*^9}, {
   3.8251636129103165`*^9, 3.8251636185563736`*^9}, {3.8251637260802183`*^9, 
   3.825163730467022*^9}, {3.8251641256215105`*^9, 3.825164230318243*^9}, {
   3.8251643559017973`*^9, 3.825164363862764*^9}, {3.825164442803305*^9, 
   3.825164463449709*^9}, {3.8251650639291334`*^9, 3.8251650955606136`*^9}, {
   3.825165781109802*^9, 3.825165920450986*^9}, {3.8251661111327715`*^9, 
   3.8251661127612123`*^9}, {3.825166146117394*^9, 3.8251661475695477`*^9}, {
   3.8251661783039894`*^9, 3.825166195292718*^9}, {3.8251662735647707`*^9, 
   3.825166353105399*^9}, {3.825166396016432*^9, 3.825166406853433*^9}, {
   3.825168220344531*^9, 3.8251682462652087`*^9}, {3.825168398490062*^9, 
   3.8251684537508097`*^9}, {3.8251686053692865`*^9, 3.8251686392856116`*^9}, 
   3.825480861456559*^9, {3.825481009751027*^9, 3.8254810470533085`*^9}, {
   3.8254811199403114`*^9, 3.8254811417599497`*^9}, {3.825481225780012*^9, 
   3.8254812685981145`*^9}, {3.825481333157443*^9, 3.825481367525523*^9}, {
   3.825481435047923*^9, 3.8254815109160023`*^9}, {3.825481934167982*^9, 
   3.8254819965581093`*^9}, {3.8254820392230053`*^9, 
   3.8254820918732376`*^9}, {3.8254821992799644`*^9, 3.825482273506331*^9}, {
   3.8254823084638324`*^9, 3.8254823508375516`*^9}, {3.8254824156422234`*^9, 
   3.825482455622239*^9}, {3.8254825529279313`*^9, 3.8254826589856634`*^9}, {
   3.825482907711004*^9, 3.8254829358083735`*^9}, {3.82548298293696*^9, 
   3.8254831186647434`*^9}, {3.825483206109913*^9, 3.825483301061756*^9}, {
   3.8254833650645723`*^9, 3.8254833703434534`*^9}, {3.8254835515946727`*^9, 
   3.825483663512661*^9}, {3.8254839748476024`*^9, 3.825483989234126*^9}, {
   3.8254969605087333`*^9, 3.8254969612846017`*^9}, {3.8254971182778587`*^9, 
   3.8254971233403196`*^9}, 3.8254971713818274`*^9},
 CellLabel->
  "In[438]:=",ExpressionUUID->"a3168480-0ecc-4024-8546-8ca2fcbcedd6"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"chainLists", "@@", 
  RowBox[{"GatherBy", "[", 
   RowBox[{"test", ",", "Head"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.82548099240028*^9, 3.825480996313964*^9}, {
  3.8254839960848017`*^9, 3.825484026263542*^9}},
 CellLabel->
  "In[439]:=",ExpressionUUID->"bc76d82d-9e85-4bbd-8952-cd09d84e914f"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "2", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "1", ",", "4"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "2", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "2", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "2", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "3", ",", "4"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "3", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "1", ",", "4"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "2", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "3", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "2", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "3", ",", "4"}], "}"}]}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       TemplateBox[{"5", "6"},
        "SpinorAngleBracket",
        DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
           RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
        InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
           RowBox[{#, ",", #2}], "]"}]& )], ",", 
       TemplateBox[{"2", "4"},
        "SpinorSquareBracket",
        DisplayFunction->(RowBox[{"[", 
           RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
        InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
           RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
     RowBox[{"{", 
      TemplateBox[{"5", "6"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], "}"}], ",", 
     RowBox[{"{", 
      TemplateBox[{"5", "6"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], "}"}], ",", 
     RowBox[{"{", 
      TemplateBox[{"5", "6"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], "}"}]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.8254809970051146`*^9, {3.8254810338366103`*^9, 3.8254810493710566`*^9}, 
   3.82548127078826*^9, {3.825481356062179*^9, 3.8254813691412325`*^9}, {
   3.8254814683947325`*^9, 3.8254815119442525`*^9}, {3.8254819589427147`*^9, 
   3.8254819710672855`*^9}, 3.8254820585343866`*^9, 3.82548210157028*^9, {
   3.8254822139387026`*^9, 3.825482231865755*^9}, {3.8254822666227407`*^9, 
   3.825482274768985*^9}, {3.825482321439126*^9, 3.825482352126053*^9}, {
   3.8254824253950825`*^9, 3.825482457802412*^9}, {3.825482573637538*^9, 
   3.8254826029230757`*^9}, {3.8254826367232065`*^9, 3.8254826608247414`*^9}, 
   3.8254829213096137`*^9, 3.825483017031799*^9, 3.825483080399226*^9, {
   3.825483111844986*^9, 3.825483120556713*^9}, 3.8254832087069125`*^9, {
   3.8254832390717335`*^9, 3.8254833024072*^9}, 3.825483372476746*^9, {
   3.8254835556298776`*^9, 3.825483577690875*^9}, 3.82548362556122*^9, 
   3.8254837182941384`*^9, {3.8254840061713142`*^9, 3.8254840272439175`*^9}, 
   3.8255096372819624`*^9},
 CellLabel->
  "Out[439]=",ExpressionUUID->"d58062ee-3160-491a-83e8-87d898356f94"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"chtest", "/@", 
  RowBox[{"First", "@", "%"}]}]], "Input",
 CellChangeTimes->{{3.8254837076855173`*^9, 3.8254837164491205`*^9}},
 CellLabel->
  "In[440]:=",ExpressionUUID->"7ec7cc69-4b32-49e6-9b75-462c343813bf"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"chtest", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"1", ",", "2", ",", "2"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"3", ",", "1", ",", "4"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"3", ",", "2", ",", "1"}], "}"}]}], "}"}], "]"}], ",", 
   RowBox[{"chtest", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"1", ",", "2", ",", "2"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"3", ",", "2", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"3", ",", "3", ",", "4"}], "}"}]}], "}"}], "]"}], ",", 
   RowBox[{"chtest", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"1", ",", "3", ",", "2"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"3", ",", "1", ",", "4"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"3", ",", "2", ",", "1"}], "}"}]}], "}"}], "]"}], ",", 
   RowBox[{"chtest", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"1", ",", "3", ",", "2"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"3", ",", "2", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"3", ",", "3", ",", "4"}], "}"}]}], "}"}], "]"}]}], 
  "}"}]], "Output",
 CellChangeTimes->{3.825483719132897*^9, 3.825509637376007*^9},
 CellLabel->
  "Out[440]=",ExpressionUUID->"c11ced7a-220e-484e-9707-6a564512e841"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["From list of chains to actual chains", "Subsubsection",
 CellChangeTimes->{{3.825428496527643*^9, 
  3.825428502128663*^9}},ExpressionUUID->"65046466-2484-4f5a-89b6-\
a0bb83b201de"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "If", " ", "the", " ", "chain", " ", "is", " ", "given", " ", "by", " ", 
   "a", " ", "single", " ", "conraction", " ", "then", " ", "that", " ", "is",
    " ", "an", " ", "especially", " ", "simple", " ", "case", " ", "which", 
   " ", "we", " ", "treat", " ", "on", " ", "its", " ", "own"}], 
  "*)"}]], "Input",
 CellChangeTimes->{{3.825485567788789*^9, 3.825485594494353*^9}},
 CellLabel->
  "In[441]:=",ExpressionUUID->"6e45bf3a-13e5-4261-80c1-187cfdc98fd8"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"listToChain", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{"i_", ",", "j_", ",", "k_"}], "}"}], "}"}], ",", "ag_List", 
     ",", "sq_List"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"x1", ",", "x2", ",", "y1", ",", "y2"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"x1", ",", "x2"}], "}"}], "=", 
       RowBox[{"List", "@@", 
        RowBox[{"ag", "[", 
         RowBox[{"[", "i", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"y1", ",", "y2"}], "}"}], "=", 
       RowBox[{"List", "@@", 
        RowBox[{"sq", "[", 
         RowBox[{"[", "j", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Which", "[", 
       RowBox[{
        RowBox[{"k", "\[Equal]", "1"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Chain", "[", 
         RowBox[{"$angle", ",", "x2", ",", 
          RowBox[{"{", "x1", "}"}], ",", "y1", ",", "$square"}], "]"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"k", "\[Equal]", "2"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Chain", "[", 
         RowBox[{"$angle", ",", "x1", ",", 
          RowBox[{"{", "x2", "}"}], ",", "y2", ",", "$square"}], "]"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"k", "\[Equal]", "3"}], ",", "\[IndentingNewLine]", 
        RowBox[{"-", 
         RowBox[{"Chain", "[", 
          RowBox[{"$angle", ",", "x2", ",", 
           RowBox[{"{", "x1", "}"}], ",", "y2", ",", "$square"}], "]"}]}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{"k", "\[Equal]", "4"}], ",", "\[IndentingNewLine]", 
        RowBox[{"-", 
         RowBox[{"Chain", "[", 
          RowBox[{"$angle", ",", "x1", ",", 
           RowBox[{"{", "x2", "}"}], ",", "y1", ",", "$square"}], "]"}]}]}], 
       "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.8254855965488625`*^9, 3.8254856196730456`*^9}, {
  3.825485802522991*^9, 3.825485850910524*^9}, {3.8254860025310507`*^9, 
  3.825486099376978*^9}, {3.825486129688952*^9, 3.825486146807111*^9}},
 CellLabel->
  "In[442]:=",ExpressionUUID->"4839dbf0-2cb2-4e82-bb60-a1028ac7b425"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"General", " ", "case"}], "*)"}]], "Input",
 CellChangeTimes->{{3.8254861805348997`*^9, 3.825486184890253*^9}},
 CellLabel->
  "In[443]:=",ExpressionUUID->"39cde670-d708-4c04-9810-9301562b80b5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"listToChain", "[", 
   RowBox[{"exp_List", ",", "ag_List", ",", "sq_List"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "agbrackets", ",", "sqbrackets", ",", "locexp", ",", "type1", ",", 
      "type2", ",", "chain"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"agbrackets", "=", 
      RowBox[{"List", "@@@", "ag"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"sqbrackets", "=", 
      RowBox[{"List", "@@@", "sq"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"locexp", "=", 
      RowBox[{"Transpose", "@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Part", "[", 
             RowBox[{"agbrackets", ",", "#1"}], "]"}], ",", 
            RowBox[{"Part", "[", 
             RowBox[{"sqbrackets", ",", "#2"}], "]"}], ",", "#3"}], "}"}], 
          "&"}], "@@", 
         RowBox[{"Transpose", "@", "exp"}]}], ")"}]}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"See", " ", "who", " ", "starts", " ", "the", " ", "chain"}], 
       ",", " ", 
       RowBox[{
       "angle", " ", "or", " ", "square", " ", "and", " ", "proceed", " ", 
        RowBox[{"accordingly", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"exp", "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "1"}], "]"}], "]"}], "\[Equal]", 
        RowBox[{"exp", "[", 
         RowBox[{"[", 
          RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"type1", "=", "$square"}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "squares", " ", "only", " ", "start", " ", "the", " ", "chain", " ", 
          "when", " ", "they", " ", "also", " ", "finish", " ", "it"}], 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{"type2", "=", "$square"}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
          "Pick", " ", "only", " ", "the", " ", "square", " ", "brackets", 
           " ", "of", " ", "the", " ", "relevant", " ", "pieces"}], ",", " ", 
          RowBox[{
          "the", " ", "beginning", " ", "and", " ", "then", " ", "one", " ", 
           "every", " ", "two", " ", 
           RowBox[{"contractions", ".", " ", "Order"}], " ", "is", " ", 
           "given", " ", "by", " ", "the", " ", "contraction", " ", 
           RowBox[{"type", ".", " ", "Recall"}], " ", "that", " ", "the", " ",
            "first", " ", "contraction", " ", "is", " ", "different", " ", 
           "from", " ", "the", " ", "rest", " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
             "due", " ", "to", " ", "the", " ", "skipping", " ", "of", " ", 
              "the", " ", "non"}], "-", 
             RowBox[{"relevant", " ", "terms"}]}], ")"}]}]}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"chain", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Drop", "[", 
            RowBox[{"#", ",", 
             RowBox[{"{", 
              RowBox[{"3", ",", 
               RowBox[{"Length", "[", "exp", "]"}], ",", "2"}], "}"}]}], 
            "]"}], "&"}], "@", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"Drop", "[", 
              RowBox[{"#", ",", "1"}], "]"}], "&"}], "/@", "locexp"}], 
           ")"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"chain", "=", 
         RowBox[{"Flatten", "@", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"Last", "@", "#"}], "\[Equal]", "2"}], "||", 
                 RowBox[{
                  RowBox[{"Last", "@", "#"}], "\[Equal]", "3"}]}], ",", 
                RowBox[{"Reverse", "@", 
                 RowBox[{"First", "@", "#"}]}], ",", 
                RowBox[{"First", "@", "#"}]}], "]"}], "&"}], "@", 
             RowBox[{"First", "@", "chain"}]}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"Last", "@", "#"}], "\[Equal]", "1"}], "||", 
                 RowBox[{
                  RowBox[{"Last", "@", "#"}], "\[Equal]", "4"}]}], ",", 
                RowBox[{"Reverse", "@", 
                 RowBox[{"First", "@", "#"}]}], ",", 
                RowBox[{"First", "@", "#"}]}], "]"}], "&"}], "/@", 
             RowBox[{"Rest", "@", "chain"}]}]}], "}"}]}]}], ";"}], 
       "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"type1", "=", "$angle"}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
          "Angle", " ", "chains", " ", "can", " ", "be", " ", "even", " ", 
           "or", " ", "odd", " ", "in", " ", "the", " ", "number", " ", "of", 
           " ", "contractions"}], ",", " ", 
          RowBox[{"so", " ", "we", " ", "distinguish", " ", "these", " ", 
           RowBox[{"cases", ".", " ", "Also"}]}], ",", " ", 
          RowBox[{
          "traces", " ", "can", " ", "be", " ", "represented", " ", "by", " ",
            "odd", " ", "contractions", " ", "but", " ", "appear", " ", "as", 
           " ", "even", " ", "due", " ", "to", " ", "their", " ", 
           "cyclicity"}], ",", " ", 
          RowBox[{
          "so", " ", "we", " ", "have", " ", "to", " ", "rewrite", " ", 
           "them"}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"EvenQ", "[", 
            RowBox[{"Length", "[", "exp", "]"}], "]"}], "&&", 
           RowBox[{
            RowBox[{"First", "@", 
             RowBox[{"Last", "@", "exp"}]}], "==", 
            RowBox[{"First", "@", 
             RowBox[{"First", "@", "exp"}]}]}]}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"locexp", "=", 
            RowBox[{"Most", "@", "locexp"}]}], ";"}]}], "\[IndentingNewLine]",
          "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
          "If", " ", "we", " ", "are", " ", "dealing", " ", "with", " ", "a", 
           " ", "genuinely", " ", "even", " ", "chain", " ", "just", " ", 
           "procede", " ", "as", " ", "in", " ", "the", " ", "square", " ", 
           "case"}], ",", " ", 
          RowBox[{
          "in", " ", "the", " ", "odd", " ", "case", " ", "we", " ", "are", 
           " ", "missing", " ", "the", " ", "information", " ", "about", " ", 
           "the", " ", "last", " ", "square", " ", "chain"}]}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"chain", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Drop", "[", 
            RowBox[{"#", ",", 
             RowBox[{"{", 
              RowBox[{"3", ",", 
               RowBox[{"Length", "[", "locexp", "]"}], ",", "2"}], "}"}]}], 
            "]"}], "&"}], "@", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"Drop", "[", 
              RowBox[{"#", ",", 
               RowBox[{"{", "2", "}"}]}], "]"}], "&"}], "/@", "locexp"}], 
           ")"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"chain", "=", 
         RowBox[{"Flatten", "@", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"Last", "@", "#"}], "\[Equal]", "1"}], "||", 
                 RowBox[{
                  RowBox[{"Last", "@", "#"}], "\[Equal]", "3"}]}], ",", 
                RowBox[{"Reverse", "@", 
                 RowBox[{"First", "@", "#"}]}], ",", 
                RowBox[{"First", "@", "#"}]}], "]"}], "&"}], "@", 
             RowBox[{"First", "@", "chain"}]}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"Last", "@", "#"}], "\[Equal]", "2"}], "||", 
                 RowBox[{
                  RowBox[{"Last", "@", "#"}], "\[Equal]", "4"}]}], ",", 
                RowBox[{"Reverse", "@", 
                 RowBox[{"First", "@", "#"}]}], ",", 
                RowBox[{"First", "@", "#"}]}], "]"}], "&"}], "/@", 
             RowBox[{"Rest", "@", "chain"}]}]}], "}"}]}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"EvenQ", "[", 
           RowBox[{"Length", "[", "locexp", "]"}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"type2", "=", "$angle"}], ";"}], "\[IndentingNewLine]", 
          ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"type2", "=", "$square"}], ";", "\[IndentingNewLine]", 
           RowBox[{"chain", "=", 
            RowBox[{"Flatten", "@", 
             RowBox[{"{", 
              RowBox[{"chain", ",", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"Last", "@", 
                    RowBox[{"Last", "@", "locexp"}]}], "\[Equal]", "2"}], "||", 
                  RowBox[{
                   RowBox[{"Last", "@", 
                    RowBox[{"Last", "@", "locexp"}]}], "\[Equal]", "3"}]}], 
                 ",", 
                 RowBox[{"locexp", "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"-", "1"}], ",", "2", ",", "2"}], "]"}], "]"}], 
                 ",", 
                 RowBox[{"locexp", "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"-", "1"}], ",", "2", ",", "1"}], "]"}], "]"}]}], 
                "]"}]}], "}"}]}]}], ";"}]}], "\[IndentingNewLine]", "]"}], 
        ";"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "The", " ", "sign", " ", "is", " ", "given", " ", "by", " ", "counting",
        " ", "the", " ", "number", " ", "of", " ", "swaps", " ", "in", " ", 
       "exp"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{"-", "1"}], ")"}], "^", 
       RowBox[{"Count", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"Last", "/@", "exp"}], "}"}], ",", 
         RowBox[{"3", "|", "4"}], ",", "\[Infinity]"}], "]"}]}], "*", 
      RowBox[{"Chain", "[", 
       RowBox[{"type1", ",", 
        RowBox[{"First", "@", "chain"}], ",", 
        RowBox[{"chain", "[", 
         RowBox[{"[", 
          RowBox[{"2", ";;", 
           RowBox[{"-", "2"}]}], "]"}], "]"}], ",", 
        RowBox[{"Last", "@", "chain"}], ",", "type2"}], "]"}]}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.825427981810141*^9, 3.825428041279039*^9}, {
  3.8254281025553417`*^9, 3.825428122271041*^9}, {3.825485315756899*^9, 
  3.8254853681278005`*^9}, {3.825485560691764*^9, 3.8254855651697865`*^9}},
 CellLabel->
  "In[444]:=",ExpressionUUID->"60064356-76ec-4196-8b44-cfcfff5a9862"]
}, Closed]],

Cell[CellGroupData[{

Cell["From list of brackets to list of chains and brackets", "Subsubsection",
 CellChangeTimes->{{3.8254285219127855`*^9, 
  3.82542853618164*^9}},ExpressionUUID->"8452286b-c8d1-4acd-9a5e-\
a1e47a222ebc"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
   "The", " ", "part", " ", "with", " ", "the", " ", "chains", " ", "does", 
    " ", "not", " ", "take", " ", "into", " ", "account", " ", "what", " ", 
    "is", " ", "left", " ", "uncontracted"}], ",", " ", 
   RowBox[{
   "we", " ", "have", " ", "to", " ", "put", " ", "that", " ", "back", " ", 
    "in"}]}], "*)"}]], "Input",
 CellChangeTimes->{{3.8254285843379655`*^9, 3.8254286107533035`*^9}},
 CellLabel->
  "In[445]:=",ExpressionUUID->"d912bb70-ab71-40c4-92dd-76c4349cbc0f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"allchains", "[", "exp_List", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ag", ",", "sq", ",", "chains"}], "}"}], ",", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
     "If", " ", "only", " ", "angles", " ", "or", " ", "squares", " ", "are", 
      " ", "present", " ", "then", " ", "no", " ", "contraction", " ", "is", 
      " ", "possible", " ", "and", " ", "we", " ", "return", " ", "$Failed"}],
      "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "#", "]"}], "\[Equal]", "2"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{
           "GatherBy", " ", "does", " ", "not", " ", "have", " ", "a", " ", 
            "definite", " ", "order"}], ",", " ", 
           RowBox[{
           "in", " ", "any", " ", "case", " ", "we", " ", "assume", " ", 
            "that", " ", "the", " ", "heads", " ", "are", " ", "correct"}]}], 
          "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"ag", ",", "sq"}], "}"}], "=", "#"}], ",", 
         "\[IndentingNewLine]", ",", 
         RowBox[{"Return", "[", "$Failed", "]"}]}], "]"}], "&"}], "@", 
      RowBox[{"GatherBy", "[", 
       RowBox[{"exp", ",", "Head"}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Find", " ", "the", " ", "possible", " ", "chain", " ", 
       "contractions"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"chains", "=", 
      RowBox[{"chainLists", "[", 
       RowBox[{"ag", ",", "sq"}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Apply", " ", "chtest", " ", "to", " ", "the", " ", "chains", " ", 
       "for", " ", "grouping"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"chains", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Map", "[", 
         RowBox[{"chtest", ",", 
          RowBox[{"First", "@", "chains"}], ",", 
          RowBox[{"{", "2", "}"}]}], "]"}], ",", 
        RowBox[{"Last", "@", "chains"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Now", " ", "every", " ", "chtest", " ", "contains", " ", "a", " ", 
       "List", " ", "corresponding", " ", "to", " ", "a", " ", 
       RowBox[{"chain", ".", " ", "Go"}], " ", "from", " ", "lists", " ", 
       "to", " ", 
       RowBox[{"Chain", ":"}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"chains", "=", 
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", "chtest", "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"chtest", "[", "x__", "]"}], ":=", 
          RowBox[{"listToChain", "[", 
           RowBox[{
            RowBox[{"{", "x", "}"}], ",", "ag", ",", "sq"}], "]"}]}], ";", 
         "\[IndentingNewLine]", "chains"}]}], "\[IndentingNewLine]", "]"}]}], 
     ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Return", " ", "the", " ", "chains", " ", "listed", " ", "along", " ", 
       "with", " ", "the", " ", "uncontracted", " ", "brackets"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"Flatten", "/@", 
      RowBox[{"Transpose", "@", "chains"}]}]}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.825428545852772*^9, 3.825428558999685*^9}, {
  3.825428616165783*^9, 3.825428634026789*^9}, {3.8254837849349003`*^9, 
  3.825483824789893*^9}, {3.825484070389521*^9, 3.825484193742139*^9}, {
  3.8254842713575478`*^9, 3.825484309515499*^9}, {3.8254843988206325`*^9, 
  3.825484434244007*^9}, {3.8254844981091967`*^9, 3.825484816312722*^9}, {
  3.825484847574107*^9, 3.825484909591547*^9}, {3.82548515422689*^9, 
  3.825485174418892*^9}, {3.8254861635882273`*^9, 3.825486167122774*^9}, {
  3.825495947368666*^9, 3.825496071486745*^9}, {3.825496104802637*^9, 
  3.8254961105383005`*^9}},
 CellLabel->
  "In[446]:=",ExpressionUUID->"b680f7da-270a-41c9-98f0-249540a93a90"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "Taking", " ", "into", " ", "account", " ", "that", " ", "GatherBy", " ", 
   "does", " ", "not", " ", "have", " ", "a", " ", "specific", " ", "order", 
   " ", "for", " ", "the", " ", "heads"}], "*)"}]], "Input",
 CellChangeTimes->{{3.825496147859478*^9, 3.825496169613296*^9}},
 CellLabel->
  "In[447]:=",ExpressionUUID->"e333a459-650f-473c-8e2b-530308b260c5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"allchains", "[", "exp_List", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ag", ",", "sq", ",", "chains"}], "}"}], ",", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
     "If", " ", "only", " ", "angles", " ", "or", " ", "squares", " ", "are", 
      " ", "present", " ", "then", " ", "no", " ", "contraction", " ", "is", 
      " ", "possible", " ", "and", " ", "we", " ", "return", " ", "$Failed"}],
      "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "#", "]"}], "\[Equal]", "2"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{
           "GatherBy", " ", "does", " ", "not", " ", "have", " ", "a", " ", 
            "definite", " ", "order"}], ",", " ", 
           RowBox[{
           "in", " ", "any", " ", "case", " ", "we", " ", "assume", " ", 
            "that", " ", "the", " ", "heads", " ", "are", " ", "correct"}]}], 
          "*)"}], "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Head", "@", 
              RowBox[{"First", "@", 
               RowBox[{"First", "@", "#"}]}]}], "===", "SpinorAngleBracket"}],
             ")"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"ag", ",", "sq"}], "}"}], "=", "#"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"sq", ",", "ag"}], "}"}], "=", "#"}]}], 
          "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", ",", 
         RowBox[{"Return", "[", "$Failed", "]"}]}], "]"}], "&"}], "@", 
      RowBox[{"GatherBy", "[", 
       RowBox[{"exp", ",", "Head"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"ag", ",", "sq"}], "}"}], "//", "Echo"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Find", " ", "the", " ", "possible", " ", "chain", " ", 
       "contractions"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"chains", "=", 
      RowBox[{"chainLists", "[", 
       RowBox[{"ag", ",", "sq"}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Apply", " ", "chtest", " ", "to", " ", "the", " ", "chains", " ", 
       "for", " ", "grouping"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"chains", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Map", "[", 
         RowBox[{"chtest", ",", 
          RowBox[{"First", "@", "chains"}], ",", 
          RowBox[{"{", "2", "}"}]}], "]"}], ",", 
        RowBox[{"Last", "@", "chains"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Now", " ", "every", " ", "chtest", " ", "contains", " ", "a", " ", 
       "List", " ", "corresponding", " ", "to", " ", "a", " ", 
       RowBox[{"chain", ".", " ", "Go"}], " ", "from", " ", "lists", " ", 
       "to", " ", 
       RowBox[{"Chain", ":"}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"chains", "=", 
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", "chtest", "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"chtest", "[", "x__", "]"}], ":=", 
          RowBox[{"listToChain", "[", 
           RowBox[{
            RowBox[{"{", "x", "}"}], ",", "ag", ",", "sq"}], "]"}]}], ";", 
         "\[IndentingNewLine]", "chains"}]}], "\[IndentingNewLine]", "]"}]}], 
     ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Return", " ", "the", " ", "chains", " ", "listed", " ", "along", " ", 
       "with", " ", "the", " ", "uncontracted", " ", "brackets"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"Flatten", "/@", 
      RowBox[{"Transpose", "@", "chains"}]}]}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.825428545852772*^9, 3.825428558999685*^9}, {
  3.825428616165783*^9, 3.825428634026789*^9}, {3.8254837849349003`*^9, 
  3.825483824789893*^9}, {3.825484070389521*^9, 3.825484193742139*^9}, {
  3.8254842713575478`*^9, 3.825484309515499*^9}, {3.8254843988206325`*^9, 
  3.825484434244007*^9}, {3.8254844981091967`*^9, 3.825484816312722*^9}, {
  3.825484847574107*^9, 3.825484909591547*^9}, {3.82548515422689*^9, 
  3.825485174418892*^9}, {3.8254861635882273`*^9, 3.825486167122774*^9}, {
  3.825495947368666*^9, 3.825496071486745*^9}, {3.8254962514907503`*^9, 
  3.825496257695156*^9}, {3.825496329714532*^9, 3.825496361629798*^9}, {
  3.8254963927904625`*^9, 3.825496445723893*^9}, {3.825496496856082*^9, 
  3.8254965038763046`*^9}},
 CellLabel->
  "In[448]:=",ExpressionUUID->"41cb2d4c-648f-4514-bba9-73acf7e3f521"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"test", "=", 
  RowBox[{"{", 
   RowBox[{
    TemplateBox[{"1", "2"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"5", "6"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"3", "4"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"1", "4"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"2", "3"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"2", "4"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}]], "Input",
 CellLabel->
  "In[449]:=",ExpressionUUID->"fc79584b-3046-44dc-ab67-2616a3bfe5b8"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   TemplateBox[{"1", "2"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"5", "6"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"3", "4"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"1", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"2", "3"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"2", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]], "Output",
 CellChangeTimes->{3.825485088438201*^9, 3.8254963633541484`*^9, 
  3.825509637653912*^9},
 CellLabel->
  "Out[449]=",ExpressionUUID->"97772328-afea-4c86-8fb4-27fc116e3de4"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"allchains", "[", "test", "]"}]], "Input",
 CellChangeTimes->{{3.8254818763845277`*^9, 3.825481884158746*^9}, {
  3.8254838313095007`*^9, 3.825483843267521*^9}, {3.8254841462132635`*^9, 
  3.8254841471657143`*^9}, {3.825484914302948*^9, 3.825484924027936*^9}, {
  3.825496343296206*^9, 3.825496343608376*^9}},
 CellLabel->
  "In[450]:=",ExpressionUUID->"a0085437-d114-47cd-b2e0-d98dc3a8fc66"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "2"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"5", "6"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"3", "4"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "4"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"2", "3"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"2", "4"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.8255096377470646`*^9},ExpressionUUID->"2831418e-ea37-411a-959f-\
da926e7423d9"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"4", 
       RowBox[{"{", 
         RowBox[{"3", ",", "2", ",", "1"}], "}"}], "4"},
      "AngleSquareChain",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], ",", 
     TemplateBox[{"5", "6"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"2", "4"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"4", 
       RowBox[{"{", 
         RowBox[{"1", ",", "2", ",", "3", ",", "4"}], "}"}], "2"},
      "SquareSquareChain",
      DisplayFunction->(RowBox[{"[", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$square", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], ",", 
     TemplateBox[{"5", "6"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"4", 
       RowBox[{"{", 
         RowBox[{"2", ",", "1", ",", "4", ",", "3"}], "}"}], "2"},
      "SquareSquareChain",
      DisplayFunction->(RowBox[{"[", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$square", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], ",", 
     TemplateBox[{"5", "6"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"4", 
       RowBox[{"{", 
         RowBox[{"1", ",", "2", ",", "4", ",", "3"}], "}"}], "2"},
      "SquareSquareChain",
      DisplayFunction->(RowBox[{"[", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$square", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], ",", 
     TemplateBox[{"5", "6"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{3.8254964246412888`*^9, 3.8254964893571877`*^9, 
  3.8255096378423624`*^9},
 CellLabel->
  "Out[450]=",ExpressionUUID->"8e1ebbc5-c756-4aad-8348-ad55991d9c29"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"prova", "=", 
  RowBox[{"{", 
   RowBox[{
    TemplateBox[{"1", "2"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"2", "3"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"1", "4"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"4", "5"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}]], "Input",
 CellChangeTimes->{{3.825485096175505*^9, 3.8254851271666145`*^9}},
 CellLabel->
  "In[451]:=",ExpressionUUID->"e9a7c8eb-3463-40fa-a5c2-faf253885df0"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   TemplateBox[{"1", "2"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"2", "3"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"1", "4"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"4", "5"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]], "Output",
 CellChangeTimes->{3.825485128101116*^9, 3.825509637974825*^9},
 CellLabel->
  "Out[451]=",ExpressionUUID->"4725719c-0ce1-44f9-8c17-7c0b835627e6"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"allchains", "@", "prova"}], "//", "RepeatedTiming"}]], "Input",
 CellChangeTimes->{{3.825485129243062*^9, 3.8254851344049067`*^9}, {
  3.825486220470051*^9, 3.8254862234401054`*^9}},
 CellLabel->
  "In[452]:=",ExpressionUUID->"9d6cb130-0d8d-4481-9e61-e19b364f3dcd"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "2"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"1", "4"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"2", "3"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"4", "5"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.825509638070943*^9},ExpressionUUID->"4c79cf57-c962-4995-9d71-\
048e39e452f1"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "2"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"1", "4"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"2", "3"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"4", "5"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.8255096381636324`*^9},ExpressionUUID->"58a6d42b-bb35-4859-85c0-\
15b4cad8b6c8"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "2"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"1", "4"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"2", "3"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"4", "5"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.8255096382563696`*^9},ExpressionUUID->"d060be8b-abaf-46d7-89f5-\
4f497354c5ac"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "2"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"1", "4"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"2", "3"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"4", "5"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.825509638343913*^9},ExpressionUUID->"8186a925-35b2-4864-ace8-\
b57b67836ce7"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "2"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"1", "4"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"2", "3"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"4", "5"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.8255096384368734`*^9},ExpressionUUID->"faacd632-1887-4e24-a47a-\
bf6d0e0d4816"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "2"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"1", "4"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"2", "3"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"4", "5"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.8255096385212917`*^9},ExpressionUUID->"86add15f-481d-46de-8612-\
bf703c6df85e"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "2"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"1", "4"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"2", "3"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"4", "5"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.825509638604788*^9},ExpressionUUID->"b7f25055-09b4-4210-b42f-\
1abe3f11cdf2"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "2"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"1", "4"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"2", "3"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"4", "5"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.825509638687727*^9},ExpressionUUID->"4edfbbf1-1a4d-4580-9bff-\
c01a3fa9fc45"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "2"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"1", "4"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"2", "3"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"4", "5"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.8255096387719617`*^9},ExpressionUUID->"42e5e9fd-ccf1-47fb-a571-\
93893d6b6aaf"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "2"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"1", "4"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"2", "3"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"4", "5"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.8255096388597336`*^9},ExpressionUUID->"e9c3877a-ef5b-4ac3-8573-\
9f8317f36445"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "2"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"1", "4"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"2", "3"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"4", "5"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.8255096389445047`*^9},ExpressionUUID->"57e989b6-0ca2-4899-80b8-\
be5b3e3f1769"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "2"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"1", "4"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"2", "3"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"4", "5"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.8255096390297747`*^9},ExpressionUUID->"e44047b8-04b6-4ea7-95a5-\
ef1bd99637b7"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "2"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"1", "4"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"2", "3"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"4", "5"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.8255096391200075`*^9},ExpressionUUID->"bf2bbba2-a6e0-4dad-bdfa-\
a3dca61513f7"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "2"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"1", "4"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"2", "3"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"4", "5"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.825509639204955*^9},ExpressionUUID->"a948dc96-3ad0-4d21-894c-\
4cd58eaf7815"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "2"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"1", "4"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"2", "3"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"4", "5"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.825509639288726*^9},ExpressionUUID->"b70357ce-4535-4ced-a577-\
810f7998b70b"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "2"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"1", "4"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"2", "3"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"4", "5"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.825509639375743*^9},ExpressionUUID->"2458674f-f589-42fa-aa50-\
9dc73e9b6dce"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.086061025`", ",", 
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{
      TemplateBox[{"1", 
        RowBox[{"{", "2", "}"}], "3"},
       "AngleSquareChain",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
       InterpretationFunction->(
        RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
          "$square", "]"}]& )], ",", 
      TemplateBox[{"1", 
        RowBox[{"{", "4", "}"}], "5"},
       "AngleSquareChain",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
       InterpretationFunction->(
        RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
          "$square", "]"}]& )]}], "}"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.825485134946457*^9, 3.8254851797685723`*^9}, 
   3.8254853327075357`*^9, 3.8254861074763393`*^9, 3.8254861526206026`*^9, {
   3.825486196729587*^9, 3.825486225233307*^9}, 3.825509639461748*^9},
 CellLabel->
  "Out[452]=",ExpressionUUID->"eaeb8385-6185-4f70-8040-5ce0fa2ed3ec"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"prova2", "=", 
  RowBox[{"{", 
   RowBox[{
    TemplateBox[{"1", "2"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"2", "3"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"3", "4"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}]], "Input",
 CellChangeTimes->{{3.8254854377326326`*^9, 3.8254854525261126`*^9}},
 CellLabel->
  "In[453]:=",ExpressionUUID->"85f5271c-0218-4175-9197-1b55faa1d412"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   TemplateBox[{"1", "2"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"2", "3"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"3", "4"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]], "Output",
 CellChangeTimes->{3.825485453466549*^9, 3.8254861976301804`*^9, 
  3.825509639569883*^9},
 CellLabel->
  "Out[453]=",ExpressionUUID->"834e52a6-3138-46bb-8e12-3271b462ab7a"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"allchains", "@", "prova2"}], "//", "RepeatedTiming"}]], "Input",
 CellChangeTimes->{{3.8254854546424446`*^9, 3.8254854597756767`*^9}, {
  3.8254862022478285`*^9, 3.8254862053166323`*^9}},
 CellLabel->
  "In[454]:=",ExpressionUUID->"4692eebf-9f19-4b5a-aeeb-d17b20523c37"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "2"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"3", "4"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    TemplateBox[{"2", "3"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.8255096396527095`*^9},ExpressionUUID->"9cb6855f-9e43-47cd-a433-\
b9a1c83606be"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "2"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"3", "4"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    TemplateBox[{"2", "3"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.8255096397398167`*^9},ExpressionUUID->"f82fec73-1dd3-4d6e-a621-\
3c5596a6e74a"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "2"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"3", "4"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    TemplateBox[{"2", "3"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.8255096398339396`*^9},ExpressionUUID->"11b4a14c-339d-4c79-8b43-\
867ef8ed4d5b"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "2"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"3", "4"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    TemplateBox[{"2", "3"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.825509639921692*^9},ExpressionUUID->"cb29385b-f240-4555-8b1d-\
c78075b14b1a"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "2"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"3", "4"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    TemplateBox[{"2", "3"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.825509640009034*^9},ExpressionUUID->"c5eefa16-668f-4e54-996f-\
b3509f50a254"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "2"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"3", "4"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    TemplateBox[{"2", "3"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.8255096400987797`*^9},ExpressionUUID->"6f8cca48-979f-42bf-86d4-\
4e80fa674331"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "2"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"3", "4"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    TemplateBox[{"2", "3"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.8255096401815586`*^9},ExpressionUUID->"41bf9e97-4595-4849-a364-\
2429fc975ac4"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "2"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"3", "4"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    TemplateBox[{"2", "3"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.8255096402735405`*^9},ExpressionUUID->"507d9718-690c-4e2a-aace-\
5e9e74c44fdb"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "2"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"3", "4"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    TemplateBox[{"2", "3"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.825509640359311*^9},ExpressionUUID->"17d8c758-7ab3-4317-9023-\
f8d31f1b67b2"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "2"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"3", "4"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    TemplateBox[{"2", "3"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.8255096404456353`*^9},ExpressionUUID->"69f661fc-614b-4809-b0d0-\
c3534ae15804"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "2"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"3", "4"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    TemplateBox[{"2", "3"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.825509640536071*^9},ExpressionUUID->"cb896140-b74e-4881-8e9d-\
a49375f14f0e"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "2"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"3", "4"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    TemplateBox[{"2", "3"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.825509640621808*^9},ExpressionUUID->"6a967725-a32f-4a25-969d-\
7bf313794ee6"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "2"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"3", "4"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    TemplateBox[{"2", "3"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.825509640703559*^9},ExpressionUUID->"451819da-6987-4a74-90e1-\
8523f48c9af5"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "2"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"3", "4"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    TemplateBox[{"2", "3"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.825509640786828*^9},ExpressionUUID->"9920e70b-2554-4531-b8d3-\
47ae56985c76"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "2"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"3", "4"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    TemplateBox[{"2", "3"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.825509640873839*^9},ExpressionUUID->"94229278-2670-42db-948e-\
abffcbeec1ef"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "2"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"3", "4"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    TemplateBox[{"2", "3"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.8255096409576178`*^9},ExpressionUUID->"ca463b4f-a1af-419f-b115-\
3fb8ff0967d4"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.0860298375`", ",", 
   RowBox[{"{", 
    RowBox[{"{", 
     TemplateBox[{"1", 
       RowBox[{"{", 
         RowBox[{"2", ",", "3"}], "}"}], "4"},
      "AngleAngleChain",
      DisplayFunction->(
       RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
         "$angle", "]"}]& )], "}"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.8254854603561635`*^9, {3.8254861919663277`*^9, 3.8254862072075195`*^9}, 
   3.825509641043806*^9},
 CellLabel->
  "Out[454]=",ExpressionUUID->"238bc93f-4d2b-4f43-9f50-dbbd5f8524a9"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "In", " ", "order", " ", "to", " ", "properly", " ", "take", " ", "into", 
   " ", "account", " ", "powers", " ", "we", " ", "need", " ", "to", " ", 
   "remove", " ", "redundant", " ", 
   RowBox[{"terms", ".", " ", "In"}], " ", "the", " ", "sense", " ", "that", 
   " ", "if", " ", "you", " ", "have", " ", 
   RowBox[{
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{"i", " ", "j"}], "\[RightAngleBracket]"}], "^", "5"}], " ", 
   "but", " ", "only", " ", "3", " ", "possible", " ", "contractions", " ", 
   "for", " ", "this", " ", "bracket", " ", "then", " ", "the", " ", "two", 
   " ", "extra", " ", "terms", " ", "can", " ", "be", " ", "removed", " ", 
   "from", " ", "the", " ", "contraction", " ", "record"}], "*)"}]], "Input",
 CellLabel->
  "In[455]:=",ExpressionUUID->"deedf6cd-2eed-4668-8cc4-83b069cf288a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"allchains", "[", "exp_List", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "ag", ",", "sq", ",", "chains", ",", "agpowers", ",", "sqpowers", ",", 
      "residual"}], "}"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
     "If", " ", "only", " ", "angles", " ", "or", " ", "squares", " ", "are", 
      " ", "present", " ", "then", " ", "no", " ", "contraction", " ", "is", 
      " ", "possible", " ", "and", " ", "we", " ", "return", " ", "$Failed"}],
      "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "#", "]"}], "\[Equal]", "2"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{
           "GatherBy", " ", "does", " ", "not", " ", "have", " ", "a", " ", 
            "definite", " ", "order"}], ",", " ", 
           RowBox[{
           "in", " ", "any", " ", "case", " ", "we", " ", "assume", " ", 
            "that", " ", "the", " ", "heads", " ", "are", " ", "correct"}]}], 
          "*)"}], "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Head", "@", 
              RowBox[{"First", "@", 
               RowBox[{"First", "@", "#"}]}]}], "===", "SpinorAngleBracket"}],
             ")"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"ag", ",", "sq"}], "}"}], "=", "#"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"sq", ",", "ag"}], "}"}], "=", "#"}]}], 
          "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", ",", 
         RowBox[{"Return", "[", "$Failed", "]"}]}], "]"}], "&"}], "@", 
      RowBox[{"GatherBy", "[", 
       RowBox[{"exp", ",", "Head"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"ag", ",", "sq"}], "}"}], "//", "Echo"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Take", " ", "into", " ", "account", " ", 
       RowBox[{"powers", ":"}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Find", " ", "the", " ", "powers"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"agpowers", ",", "sqpowers"}], "}"}], "=", 
      RowBox[{
       RowBox[{
        RowBox[{"Select", "[", 
         RowBox[{
          RowBox[{"Tally", "[", "#", "]"}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"Last", "@", "#"}], ">", "1"}], "&"}]}], "]"}], "&"}], "/@", 
       RowBox[{"{", 
        RowBox[{"ag", ",", "sq"}], "}"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"residual", "=", 
      RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "agpowers", "]"}], ">", "0"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"#", ">", "0"}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"ag", "=", 
                 RowBox[{"DeleteCases", "[", 
                  RowBox[{"ag", ",", 
                   RowBox[{"First", "@", "i"}], ",", "1", ",", "#"}], "]"}]}],
                 ";", "\[IndentingNewLine]", 
                RowBox[{"residual", "=", 
                 RowBox[{"Join", "[", 
                  RowBox[{"residual", ",", 
                   RowBox[{"ConstantArray", "[", 
                    RowBox[{
                    RowBox[{"First", "@", "i"}], ",", "#"}], "]"}]}], 
                  "]"}]}]}]}], "]"}], "&"}], "@", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"Last", "@", "i"}], "-", 
              RowBox[{"Count", "[", 
               RowBox[{"sq", ",", 
                RowBox[{"_", "?", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"!", 
                    RowBox[{"FreeQ", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"Alternatives", "@@", 
                    RowBox[{"First", "@", "i"}]}]}], "]"}]}], "&"}], 
                  ")"}]}]}], "]"}]}], ")"}]}], ";"}], "\[IndentingNewLine]", 
          ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "agpowers"}], "}"}]}], "]"}], ";"}]}], 
      "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "sqpowers", "]"}], ">", "0"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"#", ">", "0"}], ",", 
               RowBox[{
                RowBox[{"sq", "=", 
                 RowBox[{"DeleteCases", "[", 
                  RowBox[{"sq", ",", 
                   RowBox[{"First", "@", "i"}], ",", "1", ",", "#"}], "]"}]}],
                 ";", "\[IndentingNewLine]", 
                RowBox[{"residual", "=", 
                 RowBox[{"Join", "[", 
                  RowBox[{"residual", ",", 
                   RowBox[{"ConstantArray", "[", 
                    RowBox[{
                    RowBox[{"First", "@", "i"}], ",", "#"}], "]"}]}], 
                  "]"}]}]}]}], "]"}], "&"}], "@", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"Last", "@", "i"}], "-", 
              RowBox[{"Count", "[", 
               RowBox[{"ag", ",", 
                RowBox[{"_", "?", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"!", 
                    RowBox[{"FreeQ", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"Alternatives", "@@", 
                    RowBox[{"First", "@", "i"}]}]}], "]"}]}], "&"}], 
                  ")"}]}]}], "]"}]}], ")"}]}], ";"}], "\[IndentingNewLine]", 
          ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "sqpowers"}], "}"}]}], "]"}], ";"}]}], 
      "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Find", " ", "the", " ", "possible", " ", "chain", " ", 
       "contractions"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"chains", "=", 
      RowBox[{"chainLists", "[", 
       RowBox[{"ag", ",", "sq"}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Apply", " ", "chtest", " ", "to", " ", "the", " ", "chains", " ", 
       "for", " ", "grouping"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"chains", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Map", "[", 
         RowBox[{"chtest", ",", 
          RowBox[{"First", "@", "chains"}], ",", 
          RowBox[{"{", "2", "}"}]}], "]"}], ",", 
        RowBox[{"Last", "@", "chains"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Now", " ", "every", " ", "chtest", " ", "contains", " ", "a", " ", 
       "List", " ", "corresponding", " ", "to", " ", "a", " ", 
       RowBox[{"chain", ".", " ", "Go"}], " ", "from", " ", "lists", " ", 
       "to", " ", 
       RowBox[{"Chain", ":"}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"chains", "=", 
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", "chtest", "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"chtest", "[", "x__", "]"}], ":=", 
          RowBox[{"listToChain", "[", 
           RowBox[{
            RowBox[{"{", "x", "}"}], ",", "ag", ",", "sq"}], "]"}]}], ";", 
         "\[IndentingNewLine]", "chains"}]}], "\[IndentingNewLine]", "]"}]}], 
     ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
       "Return", " ", "the", " ", "chains", " ", "listed", " ", "along", " ", 
        "with", " ", "the", " ", "uncontracted", " ", "brackets"}], ",", " ", 
       RowBox[{
       "also", " ", "adding", " ", "in", " ", "the", " ", "residual", " ", 
        "terms", " ", "coming", " ", "from", " ", "exceeding", " ", 
        "powers"}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "@", "residual"}], ">", "0"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"Join", "[", 
          RowBox[{"#", ",", "residual"}], "]"}], "&"}], "/@", 
        RowBox[{"Flatten", "/@", 
         RowBox[{"Transpose", "@", "chains"}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{"Flatten", "/@", 
        RowBox[{"Transpose", "@", "chains"}]}]}], "\[IndentingNewLine]", 
      "]"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGAQB2IQ/dLTmiO34Y1j9t/7nCBawo9VEESX3nYQBtFbXsky
dgDpc26SbCD6a9kZFRA9a7+5CYjmKHxtC6J/1G1wAtHznW75gugX59yDQHRX
nXMUiL7EyNUEosXiP7WC6C9vN/WC6PVO7mtA9IT0s+tA9KFLRVqdQPrI28dg
WvZM9sdeIJ01+T1DH5C22pIvDqJ32JlJgOiiu2aKINpP3UQVRFd4S2qCaCWt
7fogmi1V2gxEb+D6A6bF3beHTgbSxyIlokD0hmmvY0H0xo1dcSB6x+bXqSB6
hWZ5AYgOu1NSA6K/XWupA9FTmY92g+gTQYcng+iS6JbZIPqX8YyVIJrr6szN
IFq968EBEL2S5f9DEK2f8P4liAYAKIrACA==
  "],
 CellLabel->
  "In[456]:=",ExpressionUUID->"7734c69b-75b3-484b-8600-70f34e828b3b"]
}, Closed]],

Cell[CellGroupData[{

Cell["Select minimal chains and traces from allchains", "Subsubsection",
 CellChangeTimes->{{3.825486381767641*^9, 
  3.8254863917659545`*^9}},ExpressionUUID->"8052a3c8-73b8-46b5-9fe7-\
dddbd75ab013"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "Chainweight", " ", "assigns", " ", "a", " ", "weight", " ", "to", " ", "a",
    " ", "list", " ", "of", " ", "chains"}], "*)"}]], "Input",
 CellChangeTimes->{{3.8254869890897303`*^9, 3.8254869990191746`*^9}, {
  3.8254870320617943`*^9, 3.825487051029065*^9}},
 CellLabel->
  "In[457]:=",ExpressionUUID->"a462f114-9d0b-43f6-96cd-114263012475"],

Cell[BoxData[
 RowBox[{"Clear", "[", "chainweight", "]"}]], "Input",
 CellChangeTimes->{{3.8254876344168243`*^9, 3.8254876511719384`*^9}},
 CellLabel->
  "In[458]:=",ExpressionUUID->"85870fe5-c417-4f63-83d8-3778ff724dbf"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"chainCrit", "=", "ShortestChain"}]], "Input",
 CellChangeTimes->{{3.825487626527975*^9, 3.8254876270156183`*^9}},
 CellLabel->
  "In[459]:=",ExpressionUUID->"1b16e721-4f74-41fb-b647-65b76dfce782"],

Cell[BoxData["ShortestChain"], "Output",
 CellChangeTimes->{{3.8254876281176696`*^9, 3.8254876524306097`*^9}, 
   3.8255096412587585`*^9},
 CellLabel->
  "Out[459]=",ExpressionUUID->"e0eb5613-1541-4829-aaab-990c31c7906c"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"define", " ", "a", " ", "weight", " ", "function"}], 
  "*)"}]], "Input",
 CellChangeTimes->{{3.825487709854581*^9, 3.825487715988179*^9}},
 CellLabel->
  "In[460]:=",ExpressionUUID->"3bd6c34d-889b-4796-9f4c-82e05a8ae5ce"],

Cell[BoxData[
 RowBox[{"Which", "[", 
  RowBox[{
   RowBox[{"chainCrit", "===", "ShortestChain"}], ",", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"chainweight", "[", "chain_List", "]"}], ":=", 
    RowBox[{"Length", "@", "chain"}]}], ",", "\[IndentingNewLine]", 
   RowBox[{"chainCrit", "===", "MostTraces"}], ",", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"chainweight", "[", "chain_List", "]"}], ":=", 
    RowBox[{"Length", "@", 
     RowBox[{"Cases", "[", 
      RowBox[{"chain", ",", 
       RowBox[{
        RowBox[{"Chain", "[", 
         RowBox[{"$angle", ",", "x_", ",", 
          RowBox[{"{", "__", "}"}], ",", "x_", ",", "$square"}], "]"}], 
        "\[RuleDelayed]", "1"}]}], "]"}]}]}], ",", "\[IndentingNewLine]", 
   "True", ",", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"chainweight", "[", "chain_List", "]"}], ":=", 
    RowBox[{"Length", "@", "chain"}]}]}], "\[IndentingNewLine]", 
  "]"}]], "Input",
 CellChangeTimes->{{3.8254869731393137`*^9, 3.825486987177904*^9}, 
   3.8254870549575567`*^9, {3.825487093060649*^9, 3.8254872367822437`*^9}, {
   3.8254874196554976`*^9, 3.8254874544861145`*^9}, {3.825487541357767*^9, 
   3.825487615953205*^9}},
 CellLabel->
  "In[461]:=",ExpressionUUID->"a9ac5df5-776e-440d-8b17-85694f705b4b"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "Out", " ", "of", " ", "a", " ", "list", " ", "of", " ", "possible", " ", 
   "chains", " ", "select", " ", "the", " ", "one", " ", "maximizing", " ", 
   "the", " ", "given", " ", "criterion"}], "*)"}]], "Input",
 CellChangeTimes->{{3.8254877189472647`*^9, 3.825487741390235*^9}},
 CellLabel->
  "In[462]:=",ExpressionUUID->"ab1ed76f-a29a-4b80-881a-6c356ee2bfb0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"chainselect", "[", "chains_List", "]"}], ":=", 
  RowBox[{"Times", "@@", 
   RowBox[{"Last", "@", 
    RowBox[{"SortBy", "[", 
     RowBox[{"chains", ",", "chainweight"}], "]"}]}]}]}]], "Input",
 CellChangeTimes->{{3.825486907143811*^9, 3.825486942903185*^9}, {
   3.825487658497347*^9, 3.825487659149603*^9}, 3.82548775313183*^9, {
   3.8254879498177977`*^9, 3.825487983229432*^9}},
 CellLabel->
  "In[463]:=",ExpressionUUID->"efccb277-206b-4fa5-8a8e-dd1cb52546d2"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "To", " ", "make", " ", "it", " ", "faster", " ", "we", " ", "remove", " ", 
   "the", " ", "internediate", " ", "function", " ", "and", " ", "make", " ", 
   "it", " ", "so", " ", "that", " ", "the", " ", "definition", " ", "of", 
   " ", "the", " ", "selection", " ", "function", " ", "itself", " ", "is", 
   " ", "based", " ", "on", " ", "the", " ", "criterion", " ", "given"}], 
  "*)"}]], "Input",
 CellChangeTimes->{{3.8254883997799854`*^9, 3.825488433908698*^9}},
 CellLabel->
  "In[464]:=",ExpressionUUID->"e7e44f90-a923-45d8-99cf-c7393c092bda"],

Cell[BoxData[
 RowBox[{"Clear", "[", 
  RowBox[{"chainselect", ",", "chainweight"}], "]"}]], "Input",
 CellChangeTimes->{{3.8254882963529525`*^9, 3.825488304723565*^9}},
 CellLabel->
  "In[465]:=",ExpressionUUID->"7aa7b9df-419b-45d6-9f21-e1732c5c64e8"],

Cell[BoxData[
 RowBox[{"Which", "[", 
  RowBox[{
   RowBox[{"chainCrit", "===", "ShortestChain"}], ",", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"chainselect", "[", "chains_List", "]"}], ":=", 
    RowBox[{"Times", "@@", 
     RowBox[{"Last", "@", 
      RowBox[{"SortBy", "[", 
       RowBox[{"chains", ",", "Length"}], "]"}]}]}]}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"chainCrit", "===", "LongestChain"}], ",", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"chainselect", "[", "chains_List", "]"}], ":=", 
    RowBox[{"Times", "@@", 
     RowBox[{"First", "@", 
      RowBox[{"SortBy", "[", 
       RowBox[{"chains", ",", "Length"}], "]"}]}]}]}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"chainCrit", "===", "MostTraces"}], ",", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"chainselect", "[", "chains_List", "]"}], ":=", 
    RowBox[{"Times", "@@", 
     RowBox[{"Last", "@", 
      RowBox[{"SortBy", "[", 
       RowBox[{"chains", ",", 
        RowBox[{
         RowBox[{"Length", "@", 
          RowBox[{"Cases", "[", 
           RowBox[{"#", ",", 
            RowBox[{
             RowBox[{"Chain", "[", 
              RowBox[{"$angle", ",", "x_", ",", 
               RowBox[{"{", "__", "}"}], ",", "x_", ",", "$square"}], "]"}], 
             "\[RuleDelayed]", "1"}]}], "]"}]}], "&"}]}], "]"}]}]}]}], ",", 
   "\[IndentingNewLine]", "True", ",", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"chainselect", "[", "chains_List", "]"}], ":=", 
    RowBox[{"Times", "@@", 
     RowBox[{"Last", "@", 
      RowBox[{"SortBy", "[", 
       RowBox[{"chains", ",", "Length"}], "]"}]}]}]}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellChangeTimes->{{3.8254881015100737`*^9, 3.825488291106983*^9}},
 CellLabel->
  "In[466]:=",ExpressionUUID->"17ba8366-ef2b-4780-aead-be227b8af89d"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"chainCrit", "=", "ShortestChain"}]], "Input",
 CellChangeTimes->{{3.8254883399802656`*^9, 3.8254883498186045`*^9}},
 CellLabel->
  "In[467]:=",ExpressionUUID->"820b5970-2616-4f10-8efd-bb226218f417"],

Cell[BoxData["ShortestChain"], "Output",
 CellChangeTimes->{3.825488350362153*^9, 3.825509641536521*^9},
 CellLabel->
  "Out[467]=",ExpressionUUID->"ad30e6ba-d6a3-4b70-9496-a46594aa9947"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"allchains", "@", "test"}], "\[IndentingNewLine]", 
 RowBox[{"chainselect", "@", "%"}]}], "Input",
 CellChangeTimes->{{3.825488004201346*^9, 3.825488009905081*^9}, {
  3.8254883326299562`*^9, 3.825488333485691*^9}},
 CellLabel->
  "In[468]:=",ExpressionUUID->"fe18f618-66ff-46b6-8da4-e3aa71a03bf0"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "2"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"5", "6"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"3", "4"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "4"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"2", "3"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"2", "4"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.8255096416226673`*^9},ExpressionUUID->"91697afe-069f-4143-80ab-\
61ceb06cf51e"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"4", 
       RowBox[{"{", 
         RowBox[{"3", ",", "2", ",", "1"}], "}"}], "4"},
      "AngleSquareChain",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], ",", 
     TemplateBox[{"5", "6"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"2", "4"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"4", 
       RowBox[{"{", 
         RowBox[{"1", ",", "2", ",", "3", ",", "4"}], "}"}], "2"},
      "SquareSquareChain",
      DisplayFunction->(RowBox[{"[", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$square", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], ",", 
     TemplateBox[{"5", "6"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"4", 
       RowBox[{"{", 
         RowBox[{"2", ",", "1", ",", "4", ",", "3"}], "}"}], "2"},
      "SquareSquareChain",
      DisplayFunction->(RowBox[{"[", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$square", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], ",", 
     TemplateBox[{"5", "6"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"4", 
       RowBox[{"{", 
         RowBox[{"1", ",", "2", ",", "4", ",", "3"}], "}"}], "2"},
      "SquareSquareChain",
      DisplayFunction->(RowBox[{"[", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$square", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], ",", 
     TemplateBox[{"5", "6"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.825488010345901*^9, {3.8254883090100975`*^9, 3.8254883511739783`*^9}, 
   3.8255096416541433`*^9},
 CellLabel->
  "Out[468]=",ExpressionUUID->"6a9b9256-a97e-471a-b373-9874945bbad4"],

Cell[BoxData[
 RowBox[{
  TemplateBox[{"4", 
    RowBox[{"{", 
      RowBox[{"3", ",", "2", ",", "1"}], "}"}], "4"},
   "AngleSquareChain",
   DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
   InterpretationFunction->(
    RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square", 
      "]"}]& )], " ", 
  TemplateBox[{"5", "6"},
   "SpinorAngleBracket",
   DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
      RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
   InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
      RowBox[{#, ",", #2}], "]"}]& )], " ", 
  TemplateBox[{"2", "4"},
   "SpinorSquareBracket",
   DisplayFunction->(RowBox[{"[", 
      RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
   InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
      RowBox[{#, ",", #2}], "]"}]& )]}]], "Output",
 CellChangeTimes->{
  3.825488010345901*^9, {3.8254883090100975`*^9, 3.8254883511739783`*^9}, 
   3.8255096416611223`*^9},
 CellLabel->
  "Out[469]=",ExpressionUUID->"15ec1cc9-875d-4e44-a773-1b219f35135b"]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"chainCrit", "=", "LongestChain"}], ";"}]], "Input",
 CellChangeTimes->{{3.8254883399802656`*^9, 3.825488364059517*^9}},
 CellLabel->
  "In[470]:=",ExpressionUUID->"5f99946c-b03f-4090-a85a-29dcf572ba3f"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"allchains", "@", "test"}], "\[IndentingNewLine]", 
 RowBox[{"chainselect", "@", "%"}]}], "Input",
 CellChangeTimes->{{3.825488004201346*^9, 3.825488009905081*^9}, {
  3.8254883326299562`*^9, 3.825488333485691*^9}},
 CellLabel->
  "In[471]:=",ExpressionUUID->"cfa5074d-c8f9-4263-93f7-8a311b7db743"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "2"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"5", "6"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"3", "4"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "4"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"2", "3"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"2", "4"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.825509641769919*^9},ExpressionUUID->"ba8b9470-73ef-4800-8277-\
07a42d462703"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"4", 
       RowBox[{"{", 
         RowBox[{"3", ",", "2", ",", "1"}], "}"}], "4"},
      "AngleSquareChain",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], ",", 
     TemplateBox[{"5", "6"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"2", "4"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"4", 
       RowBox[{"{", 
         RowBox[{"1", ",", "2", ",", "3", ",", "4"}], "}"}], "2"},
      "SquareSquareChain",
      DisplayFunction->(RowBox[{"[", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$square", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], ",", 
     TemplateBox[{"5", "6"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"4", 
       RowBox[{"{", 
         RowBox[{"2", ",", "1", ",", "4", ",", "3"}], "}"}], "2"},
      "SquareSquareChain",
      DisplayFunction->(RowBox[{"[", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$square", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], ",", 
     TemplateBox[{"5", "6"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"4", 
       RowBox[{"{", 
         RowBox[{"1", ",", "2", ",", "4", ",", "3"}], "}"}], "2"},
      "SquareSquareChain",
      DisplayFunction->(RowBox[{"[", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$square", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], ",", 
     TemplateBox[{"5", "6"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.825488010345901*^9, {3.8254883090100975`*^9, 3.8254883735980015`*^9}, 
   3.8255096418043103`*^9},
 CellLabel->
  "Out[471]=",ExpressionUUID->"19680402-3118-419f-8ae2-8f918556bca6"],

Cell[BoxData[
 RowBox[{
  TemplateBox[{"4", 
    RowBox[{"{", 
      RowBox[{"3", ",", "2", ",", "1"}], "}"}], "4"},
   "AngleSquareChain",
   DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
   InterpretationFunction->(
    RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square", 
      "]"}]& )], " ", 
  TemplateBox[{"5", "6"},
   "SpinorAngleBracket",
   DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
      RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
   InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
      RowBox[{#, ",", #2}], "]"}]& )], " ", 
  TemplateBox[{"2", "4"},
   "SpinorSquareBracket",
   DisplayFunction->(RowBox[{"[", 
      RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
   InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
      RowBox[{#, ",", #2}], "]"}]& )]}]], "Output",
 CellChangeTimes->{
  3.825488010345901*^9, {3.8254883090100975`*^9, 3.8254883735980015`*^9}, 
   3.8255096418113384`*^9},
 CellLabel->
  "Out[472]=",ExpressionUUID->"aa02e0b3-4b8c-4bc6-8cca-7b1248db794d"]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"chainCrit", "=", "MostTraces"}], ";"}]], "Input",
 CellChangeTimes->{{3.8254883399802656`*^9, 3.825488386739854*^9}},
 CellLabel->
  "In[473]:=",ExpressionUUID->"c51781ff-4d19-480f-aa72-13db1b37f0ce"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"allchains", "@", "test"}], "\[IndentingNewLine]", 
 RowBox[{"chainselect", "@", "%"}]}], "Input",
 CellChangeTimes->{{3.825488004201346*^9, 3.825488009905081*^9}, {
  3.8254883326299562`*^9, 3.825488333485691*^9}},
 CellLabel->
  "In[474]:=",ExpressionUUID->"ee58a566-6c50-4b45-b71a-8729e79c5abd"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "2"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"5", "6"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"3", "4"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "4"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"2", "3"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"2", "4"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.8255096419235516`*^9},ExpressionUUID->"265f2564-6cce-4d6c-ac0e-\
07ba94315bc2"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"4", 
       RowBox[{"{", 
         RowBox[{"3", ",", "2", ",", "1"}], "}"}], "4"},
      "AngleSquareChain",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], ",", 
     TemplateBox[{"5", "6"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"2", "4"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"4", 
       RowBox[{"{", 
         RowBox[{"1", ",", "2", ",", "3", ",", "4"}], "}"}], "2"},
      "SquareSquareChain",
      DisplayFunction->(RowBox[{"[", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$square", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], ",", 
     TemplateBox[{"5", "6"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"4", 
       RowBox[{"{", 
         RowBox[{"2", ",", "1", ",", "4", ",", "3"}], "}"}], "2"},
      "SquareSquareChain",
      DisplayFunction->(RowBox[{"[", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$square", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], ",", 
     TemplateBox[{"5", "6"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"4", 
       RowBox[{"{", 
         RowBox[{"1", ",", "2", ",", "4", ",", "3"}], "}"}], "2"},
      "SquareSquareChain",
      DisplayFunction->(RowBox[{"[", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$square", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], ",", 
     TemplateBox[{"5", "6"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.825488010345901*^9, {3.8254883090100975`*^9, 3.825488393274377*^9}, 
   3.8255096419548774`*^9},
 CellLabel->
  "Out[474]=",ExpressionUUID->"1d3e1e56-5ac2-442a-a7b1-a19cb898f9ba"],

Cell[BoxData[
 RowBox[{
  TemplateBox[{"4", 
    RowBox[{"{", 
      RowBox[{"3", ",", "2", ",", "1"}], "}"}], "4"},
   "AngleSquareChain",
   DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
   InterpretationFunction->(
    RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square", 
      "]"}]& )], " ", 
  TemplateBox[{"5", "6"},
   "SpinorAngleBracket",
   DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
      RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
   InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
      RowBox[{#, ",", #2}], "]"}]& )], " ", 
  TemplateBox[{"2", "4"},
   "SpinorSquareBracket",
   DisplayFunction->(RowBox[{"[", 
      RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
   InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
      RowBox[{#, ",", #2}], "]"}]& )]}]], "Output",
 CellChangeTimes->{
  3.825488010345901*^9, {3.8254883090100975`*^9, 3.825488393274377*^9}, 
   3.825509641962854*^9},
 CellLabel->
  "Out[475]=",ExpressionUUID->"012526bf-3b90-482b-b9c0-14e6563e5a55"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["From expression to chain, ToChain", "Subsubsection",
 CellChangeTimes->{{3.8254862683280478`*^9, 3.8254862781318703`*^9}, {
  3.8254955571846952`*^9, 
  3.825495562410774*^9}},ExpressionUUID->"630a1b70-f92b-49ef-89ba-\
e56ef2fbea85"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "Whenever", " ", "I", " ", "have", " ", "Times", " ", "or", " ", "Times", 
   " ", "combined", " ", "with", " ", "inverse", " ", "Power", " ", "of", " ",
    "angle", " ", "and", " ", "square", " ", "brackets", " ", "we", " ", 
   "need", " ", "to", " ", "extract", " ", "these", " ", "and", " ", "feed", 
   " ", "then", " ", "into", " ", "the", " ", "function", " ", "which", " ", 
   "makes", " ", "the", " ", "chains"}], "*)"}]], "Input",
 CellChangeTimes->{{3.8254885702111387`*^9, 
  3.825488621015255*^9}},ExpressionUUID->"4ea58205-b8ee-4f45-b6a8-\
46780a08123d"],

Cell[CellGroupData[{

Cell[BoxData["test"], "Input",
 CellChangeTimes->{{3.8254887386685762`*^9, 3.8254887392051415`*^9}},
 CellLabel->
  "In[279]:=",ExpressionUUID->"30ed8222-e192-4ab9-88fd-7ab6a1e8331e"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   TemplateBox[{"1", "2"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"5", "6"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"3", "4"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"1", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"2", "3"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"2", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]], "Output",
 CellChangeTimes->{3.8254887400219545`*^9},
 CellLabel->
  "Out[279]=",ExpressionUUID->"ad797ea1-0c64-4a4a-b62f-8988fab2693b"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"3", "*", "a", "*", 
   RowBox[{"Times", "@@", "test"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"prova", "=", 
  RowBox[{
   RowBox[{"%", "/", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       TemplateBox[{"6", "7"},
        "SpinorAngleBracket",
        DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
           RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
        InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
           RowBox[{#, ",", #2}], "]"}]& )], "^", "2"}], 
      TemplateBox[{"7", "8"},
       "SpinorSquareBracket",
       DisplayFunction->(RowBox[{"[", 
          RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )]}], ")"}]}], "*", 
   RowBox[{
    TemplateBox[{"9", "10"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "^", "3"}]}]}]}], "Input",
 CellChangeTimes->{{3.825488741634642*^9, 3.825488757622882*^9}, {
  3.8254889821781387`*^9, 3.82548898357303*^9}, {3.8254890853442116`*^9, 
  3.8254891143874836`*^9}, {3.8254891878160076`*^9, 3.825489188338653*^9}, {
  3.825489678604452*^9, 3.8254896846422467`*^9}},
 CellLabel->
  "In[304]:=",ExpressionUUID->"8b47e858-e091-4790-9263-8cd59d154b97"],

Cell[BoxData[
 FractionBox[
  RowBox[{"3", " ", "a", " ", 
   TemplateBox[{"1", "2"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], " ", 
   TemplateBox[{"3", "4"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], " ", 
   TemplateBox[{"5", "6"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], " ", 
   SuperscriptBox[
    TemplateBox[{"9", "10"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "3"], " ", 
   TemplateBox[{"1", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], " ", 
   TemplateBox[{"2", "3"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], " ", 
   TemplateBox[{"2", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}], 
  RowBox[{
   SuperscriptBox[
    TemplateBox[{"6", "7"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "2"], " ", 
   TemplateBox[{"7", "8"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}]]], "Output",
 CellChangeTimes->{{3.825488748749619*^9, 3.825488758281173*^9}, 
   3.8254889846212263`*^9, {3.825489111422414*^9, 3.825489114887182*^9}, 
   3.8254891887724485`*^9, 3.8254896853363895`*^9},
 CellLabel->
  "Out[305]=",ExpressionUUID->"dd13d04f-4336-46e7-8e50-388aeafa46fa"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
   "Possible", " ", "options", " ", "for", " ", "ChainSelecion", " ", "are", 
    " ", "\"\<ShortestChain\>\""}], ",", " ", "\"\<LongestChain\>\"", ",", 
   " ", "\"\<MostTraces\>\""}], "*)"}]], "Input",
 CellChangeTimes->{{3.8255095289669137`*^9, 
  3.825509568724924*^9}},ExpressionUUID->"66686e37-c00c-4320-88d8-\
9fa8f08799d5"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"Options", "[", "ToChainNew", "]"}], "=", 
  RowBox[{"{", 
   RowBox[{"ChainSelection", "->", "\"\<ShortestChain\>\""}], 
   "}"}]}]], "Input",
 CellChangeTimes->{{3.8255094588937373`*^9, 3.825509492088255*^9}, 
   3.8255095261173553`*^9},
 CellLabel->
  "In[417]:=",ExpressionUUID->"362d2017-69d7-48d2-b7e8-6e339f5fc88b"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"ChainSelection", "\[Rule]", "\<\"ShortestChain\"\>"}], 
  "}"}]], "Output",
 CellChangeTimes->{3.825509575870757*^9},
 CellLabel->
  "Out[417]=",ExpressionUUID->"08eaafd9-cb94-4bed-895f-9a5fa2448801"]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"ToChainNew", "[", 
   RowBox[{"exp_", ",", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "locexp", ",", "tochain", ",", "tochaininv", ",", "chainCrit", ",", 
      "chainselect"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"locexp", "=", "exp"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"Power", ",", "Times"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"f_", "[", "x__", "]"}], ",", 
            RowBox[{"p_", "?", "Negative"}]}], "]"}], "/;", 
          RowBox[{
           RowBox[{"f", "\[Equal]", "SpinorAngleBracket"}], "||", 
           RowBox[{"f", "\[Equal]", "SpinorSquareBracket"}], "||", 
           RowBox[{"f", "\[Equal]", "Chain"}]}]}], ":=", 
         RowBox[{"tochaininv", "[", 
          RowBox[{"Sequence", "@@", 
           RowBox[{"ConstantArray", "[", 
            RowBox[{
             RowBox[{"f", "[", "x", "]"}], ",", 
             RowBox[{"-", "p"}]}], "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"f_", "[", "x__", "]"}], ",", "p_"}], "]"}], "/;", 
          RowBox[{
           RowBox[{"f", "\[Equal]", "SpinorAngleBracket"}], "||", 
           RowBox[{"f", "\[Equal]", "SpinorSquareBracket"}], "||", 
           RowBox[{"f", "\[Equal]", "Chain"}]}]}], ":=", 
         RowBox[{"tochain", "[", 
          RowBox[{"Sequence", "@@", 
           RowBox[{"ConstantArray", "[", 
            RowBox[{
             RowBox[{"f", "[", "x", "]"}], ",", "p"}], "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"Times", "[", 
           RowBox[{"z___", ",", 
            RowBox[{"f_", "[", "x__", "]"}], ",", "y___"}], "]"}], "/;", 
          RowBox[{
           RowBox[{"f", "\[Equal]", "SpinorAngleBracket"}], "||", 
           RowBox[{"f", "\[Equal]", "SpinorSquareBracket"}], "||", 
           RowBox[{"f", "\[Equal]", "Chain"}]}]}], ":=", 
         RowBox[{"Times", "[", 
          RowBox[{"z", ",", 
           RowBox[{"tochain", "[", 
            RowBox[{"f", "[", "x", "]"}], "]"}], ",", "y"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"locexp", "=", "locexp"}], ";"}]}], "\[IndentingNewLine]", 
      "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"tochain", " ", "/:", " ", 
      RowBox[{"Times", "[", 
       RowBox[{
        RowBox[{"tochain", "[", "x__", "]"}], ",", 
        RowBox[{"tochain", "[", "y__", "]"}], ",", "z___"}], "]"}], ":=", 
      RowBox[{"Times", "[", 
       RowBox[{
        RowBox[{"tochain", "[", 
         RowBox[{"x", ",", "y"}], "]"}], ",", "z"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"tochaininv", " ", "/:", " ", 
      RowBox[{"Times", "[", 
       RowBox[{
        RowBox[{"tochaininv", "[", "x__", "]"}], ",", 
        RowBox[{"tochaininv", "[", "y__", "]"}], ",", "z___"}], "]"}], ":=", 
      RowBox[{"Times", "[", 
       RowBox[{
        RowBox[{"tochaininv", "[", 
         RowBox[{"x", ",", "y"}], "]"}], ",", "z"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"locexp", "=", 
      RowBox[{"locexp", "//", "Echo"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Basing", " ", "on", " ", "the", " ", "options", " ", "we", " ", 
       "decide", " ", "which", " ", "chain", " ", "we", " ", "want", " ", 
       "to", " ", "pick"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"chainCrit", "=", 
      RowBox[{"OptionValue", "[", "ChainSelection", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Which", "[", 
      RowBox[{
       RowBox[{"chainCrit", "===", "\"\<ShortestChain\>\""}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"chainselect", "[", "chains_List", "]"}], ":=", 
        RowBox[{"Times", "@@", 
         RowBox[{"Last", "@", 
          RowBox[{"SortBy", "[", 
           RowBox[{"chains", ",", "Length"}], "]"}]}]}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"chainCrit", "===", "\"\<LongestChain\>\""}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"chainselect", "[", "chains_List", "]"}], ":=", 
        RowBox[{"Times", "@@", 
         RowBox[{"First", "@", 
          RowBox[{"SortBy", "[", 
           RowBox[{"chains", ",", "Length"}], "]"}]}]}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"chainCrit", "===", "\"\<MostTraces\>\""}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"chainselect", "[", "chains_List", "]"}], ":=", 
        RowBox[{"Times", "@@", 
         RowBox[{"Last", "@", 
          RowBox[{"SortBy", "[", 
           RowBox[{"chains", ",", 
            RowBox[{
             RowBox[{"Length", "@", 
              RowBox[{"Cases", "[", 
               RowBox[{"#", ",", 
                RowBox[{
                 RowBox[{"Chain", "[", 
                  RowBox[{"$angle", ",", "x_", ",", 
                   RowBox[{"{", "__", "}"}], ",", "x_", ",", "$square"}], 
                  "]"}], "\[RuleDelayed]", "1"}]}], "]"}]}], "&"}]}], 
           "]"}]}]}]}], ",", "\[IndentingNewLine]", "True", ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"chainselect", "[", "chains_List", "]"}], ":=", 
        RowBox[{"Times", "@@", 
         RowBox[{"Last", "@", 
          RowBox[{"SortBy", "[", 
           RowBox[{"chains", ",", "Length"}], "]"}]}]}]}]}], 
      "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"tochain", "[", "x__", "]"}], ":=", 
      RowBox[{"chainselect", "@", 
       RowBox[{"allchains", "[", 
        RowBox[{"{", "x", "}"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"tochaininv", "[", "x__", "]"}], ":=", 
      RowBox[{"Power", "[", 
       RowBox[{
        RowBox[{"chainselect", "@", 
         RowBox[{"allchains", "[", 
          RowBox[{"{", "x", "}"}], "]"}]}], ",", 
        RowBox[{"-", "1"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     "locexp"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.8254887650510125`*^9, 3.825488832532528*^9}, {
  3.8254888741641765`*^9, 3.8254889635844154`*^9}, {3.8254891487097425`*^9, 
  3.8254891616519876`*^9}, {3.8254892176402397`*^9, 3.8254892553842926`*^9}, {
  3.8254894345413313`*^9, 3.8254895951886625`*^9}, {3.8254896258644576`*^9, 
  3.82548970618064*^9}, {3.825489741647839*^9, 3.8254897665192575`*^9}, {
  3.825489876730536*^9, 3.825489892248026*^9}, {3.8254899525946283`*^9, 
  3.8254901990813465`*^9}, {3.8254902443303328`*^9, 3.825490246840576*^9}, {
  3.825490344653962*^9, 3.8254903561222887`*^9}, {3.825490541106159*^9, 
  3.8254906666948195`*^9}, {3.8254907252771287`*^9, 3.825490968276554*^9}, {
  3.8254952843254743`*^9, 3.825495425095032*^9}, {3.825495629149803*^9, 
  3.8254957616893425`*^9}, {3.825509316058922*^9, 3.825509371002432*^9}, {
  3.825509404345188*^9, 3.8255095195820017`*^9}, {3.8255095903799944`*^9, 
  3.825509594570346*^9}},
 CellLabel->
  "In[476]:=",ExpressionUUID->"a9d88f5f-f677-4297-ace9-4f1b701895af"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ToChainNew", "[", "prova", "]"}]], "Input",
 CellChangeTimes->{{3.8255096133745127`*^9, 3.8255096186811485`*^9}},
 CellLabel->
  "In[477]:=",ExpressionUUID->"ff036ee4-42a4-4207-b368-f6a8818f642b"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   TemplateBox[{"1", "2"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"2", "3"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"1", "4"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"4", "5"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.8255096511569824`*^9},ExpressionUUID->"f5a8d17c-5748-4b4d-a254-\
401096cbcafe"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   TemplateBox[{"1", "2"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"2", "3"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"1", "4"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"4", "5"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]], "Output",
 CellChangeTimes->{3.82550962012195*^9, 3.8255096512100844`*^9},
 CellLabel->
  "Out[477]=",ExpressionUUID->"a5ac3c0c-64fc-41f3-9e89-bf5882aaa446"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "THERE", " ", "ARE", " ", "ISSUES", " ", "WITH", " ", "MUTUALLY", " ", 
   "EXCLUSIVE", " ", "TERM", " ", "CONTRACTIONS", " ", "LIKE", " ", 
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"7", "8"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"6", "7"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"7", "9"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}], "*)"}]], "Input",
 CellChangeTimes->{{3.825497962519591*^9, 3.8254979950684786`*^9}, {
  3.825498175622398*^9, 3.825498206131804*^9}, {3.8255047219866457`*^9, 
  3.82550475080145*^9}, {3.825508566320238*^9, 
  3.825508624141839*^9}},ExpressionUUID->"4010967c-d7b0-4bc1-849f-\
baa07b850318"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Cleanin up things and fixing residual problems", "Section",
 CellChangeTimes->{{3.8255096809244137`*^9, 
  3.825509696318774*^9}},ExpressionUUID->"fbdc9e81-0947-4cfa-9168-\
76dea3d0f855"],

Cell[CellGroupData[{

Cell["Auxiliary", "Subsection",
 CellChangeTimes->{{3.8251640036608715`*^9, 
  3.825164005188548*^9}},ExpressionUUID->"3dfaa763-3452-4eff-b21d-\
75b3c683735d"],

Cell[CellGroupData[{

Cell["Weight", "Subsubsection",
 CellChangeTimes->{{3.825509725786583*^9, 
  3.8255097266838255`*^9}},ExpressionUUID->"61749fa7-933d-4cd6-9080-\
b3eca79341f0"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
   "Modified", " ", "weight", " ", "function", " ", "swapping", " ", "cases", 
    " ", "1", " ", "and", " ", "3"}], ",", " ", 
   RowBox[{
   "so", " ", "that", " ", "angle", " ", "test", " ", "still", " ", "forbids",
     " ", "even", " ", "cases", " ", "and", " ", "square", " ", "test", " ", 
    "forbids", " ", "summing", " ", "to", " ", "5", " ", 
    RowBox[{"i", ".", "e", ".", " ", "the"}], " ", "cobination", " ", "of", 
    " ", "1", " ", "with", " ", "4", " ", "and", " ", "2", " ", "with", " ", 
    "3"}]}], "*)"}]], "Input",
 CellChangeTimes->{{3.8251432012240033`*^9, 3.8251432910807285`*^9}},
 CellLabel->
  "In[420]:=",ExpressionUUID->"8ef71ebb-102c-4405-a637-ec2926861218"],

Cell[BoxData[
 RowBox[{
  RowBox[{"weight", "[", 
   RowBox[{
    RowBox[{"SpinorAngleBracket", "[", 
     RowBox[{"i_", ",", "j_"}], "]"}], ",", 
    RowBox[{"SpinorSquareBracket", "[", 
     RowBox[{"k_", ",", "l_"}], "]"}]}], "]"}], ":=", 
  RowBox[{"Which", "[", 
   RowBox[{
    RowBox[{"i", "===", "k"}], ",", "3", ",", 
    RowBox[{"j", "===", "k"}], ",", "2", ",", 
    RowBox[{"i", "===", "l"}], ",", "1", ",", 
    RowBox[{"j", "===", "l"}], ",", "4", ",", "True", ",", "0"}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.825143302413413*^9, 3.8251433054851465`*^9}},
 CellLabel->
  "In[421]:=",ExpressionUUID->"ae2957f6-8ca3-4329-a169-7532c0c29a82"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "sqtest", " ", "checks", " ", "whther", " ", "all", " ", "the", " ", 
   "contractions", " ", "with", " ", "the", " ", "square", " ", "brackets", 
   " ", "are", " ", 
   RowBox[{"possible", ".", " ", "In"}], " ", "particular", " ", "you", " ", 
   "cannot", " ", "have", " ", "the", " ", "same", " ", "square", " ", 
   "bracket", " ", "whose", " ", "first", " ", "label", " ", "contract", " ", 
   "more", " ", "than", " ", "one", " ", "angle", " ", 
   RowBox[{"bracket", ".", " ", "This"}], " ", "is", " ", "checked", " ", 
   "by", " ", "looking", " ", "at", " ", "the", " ", 
   RowBox[{"labels", ".", " ", "The"}], " ", "implemented", " ", "test", " ", 
   "condition", " ", "proved", " ", "to", " ", "be", " ", "the", " ", 
   "fasted", " ", "I", " ", "could", " ", "find"}], "*)"}]], "Input",
 CellChangeTimes->{{3.825144134234501*^9, 3.82514417318128*^9}, {
  3.82514424038459*^9, 3.825144265550265*^9}, {3.825144692019476*^9, 
  3.825144705975103*^9}},
 CellLabel->
  "In[422]:=",ExpressionUUID->"1c3a8a5e-9dc1-49a6-bbf4-1e6879e5339b"]
}, Open  ]],

Cell[CellGroupData[{

Cell["sqtest", "Subsubsection",
 CellChangeTimes->{{3.825509730391565*^9, 
  3.8255097315669026`*^9}},ExpressionUUID->"25ed176c-c2fd-48f7-8491-\
e7e21beff502"],

Cell[BoxData[
 RowBox[{
  RowBox[{"sqtest", "[", "exp_List", "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"Equal", "[", 
       RowBox[{
        RowBox[{"Length", "@", "#"}], ",", 
        RowBox[{"Length", "@", 
         RowBox[{"DeleteCases", "[", 
          RowBox[{"#", ",", 
           RowBox[{"_", "?", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"!", 
               RowBox[{"MatchQ", "[", 
                RowBox[{"#", ",", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"_", ",", "i_", ",", "j_"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"_", ",", "k_", ",", "l_"}], "}"}]}], "}"}], "/;", 
                    RowBox[{
                    RowBox[{"j", "\[NotEqual]", "l"}], "&&", 
                    RowBox[{
                    RowBox[{"j", "+", "l"}], "\[NotEqual]", "5"}]}]}], ")"}], 
                  "|", 
                  RowBox[{"{", 
                   RowBox[{"{", 
                    RowBox[{"_", ",", "_", ",", "_"}], "}"}], "}"}]}]}], 
                "]"}]}], "&"}], ")"}]}]}], "]"}]}]}], "]"}], "&"}], "@", 
     RowBox[{"GatherBy", "[", 
      RowBox[{"#", ",", 
       RowBox[{
        RowBox[{"Part", "[", 
         RowBox[{"#", ",", "2"}], "]"}], "&"}]}], "]"}]}], "&"}], "@", 
   RowBox[{"Flatten", "[", 
    RowBox[{"exp", ",", "1"}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.8251649220877457`*^9, 3.8251649884554443`*^9}},
 CellLabel->
  "In[423]:=",ExpressionUUID->"1114befe-b57f-4776-bed3-f26e598104d3"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "The", " ", "next", " ", "functions", " ", "build", " ", "all", " ", "the", 
   " ", "possible", " ", "pairings", " ", "of", " ", "contractions", " ", 
   "testing", " ", "the", " ", "square", " ", 
   RowBox[{"brackets", ".", " ", "I"}], " ", "use", " ", "Outer", " ", 
   "instead", " ", "of", " ", "Tuples", " ", "because", " ", "like", " ", 
   "this", " ", "I", " ", "can", " ", "perform", " ", "the", " ", "test", " ",
    "at", " ", "each", " ", "step", " ", "and", " ", "not", " ", "just", " ", 
   "at", " ", "the", " ", 
   RowBox[{"end", ".", " ", "For"}], " ", "large", " ", "number", " ", "of", 
   " ", "possible", " ", "contractions", " ", "with", " ", "many", " ", 
   "cancellations", " ", "this", " ", "should", " ", "speed", " ", "up", " ", 
   "the", " ", 
   RowBox[{"process", ".", " ", "In"}], " ", "simple", " ", "cases", " ", 
   "it", " ", "might", " ", "be", " ", "slower"}], "*)"}]], "Input",
 CellChangeTimes->{{3.8251532734611387`*^9, 3.825153351078512*^9}, {
  3.825153525268777*^9, 3.825153530183632*^9}},
 CellLabel->
  "In[424]:=",ExpressionUUID->"4a03dc37-75e2-46e4-92ee-0ec38f19b0da"]
}, Open  ]],

Cell[CellGroupData[{

Cell["chtest", "Subsubsection",
 CellChangeTimes->{{3.825509762535918*^9, 
  3.8255097652892165`*^9}},ExpressionUUID->"25d92da2-87ae-42b0-8ec8-\
cc4892d5c535"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"chtest", " ", "reorders", " ", "the", " ", "terms"}], 
  "*)"}]], "Input",
 CellChangeTimes->{{3.8254104415280056`*^9, 3.8254104604339056`*^9}},
 CellLabel->
  "In[430]:=",ExpressionUUID->"dd93ecaf-9307-4033-9fa1-2c77713727c3"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Pair", " ", "up", " ", "everything", " ", "by", " ", "contracted", " ", 
    "square", " ", "brackets"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"chtest", " ", "/:", " ", 
     RowBox[{"List", "[", 
      RowBox[{"x1___", ",", 
       RowBox[{"chtest", "[", 
        RowBox[{"{", 
         RowBox[{"i_", ",", "j_", ",", "k_"}], "}"}], "]"}], ",", "x2___", 
       ",", 
       RowBox[{"chtest", "[", 
        RowBox[{"{", 
         RowBox[{"q_", ",", "j_", ",", "l_"}], "}"}], "]"}], ",", "x3___"}], 
      "]"}], ":=", 
     RowBox[{"List", "[", 
      RowBox[{"x1", ",", "x2", ",", "x3", ",", 
       RowBox[{"chtest", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"i", ",", "j", ",", "k"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"q", ",", "j", ",", "l"}], "}"}]}], "]"}]}], "]"}]}], ";"}],
    "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Further", " ", "connect", " ", "by", " ", "contracted", " ", "angles"}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"chtest", " ", "/:", " ", 
     RowBox[{"List", "[", 
      RowBox[{"x1___", ",", 
       RowBox[{"chtest", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"i_", ",", "j_", ",", "k_"}], "}"}], ",", "y1___"}], "]"}], 
       ",", "x2___", ",", 
       RowBox[{"chtest", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"i_", ",", "q_", ",", "l_"}], "}"}], ",", "y2___"}], "]"}], 
       ",", "x3___"}], "]"}], ":=", 
     RowBox[{"List", "[", 
      RowBox[{"x1", ",", "x2", ",", "x3", ",", 
       RowBox[{"chtest", "[", 
        RowBox[{
         RowBox[{"Sequence", "@@", 
          RowBox[{"Reverse", "[", 
           RowBox[{"{", "y2", "}"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "q", ",", "l"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "j", ",", "k"}], "}"}], ",", "y1"}], "]"}]}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"chtest", " ", "/:", " ", 
     RowBox[{"List", "[", 
      RowBox[{"x1___", ",", 
       RowBox[{"chtest", "[", 
        RowBox[{"y1___", ",", 
         RowBox[{"{", 
          RowBox[{"i_", ",", "j_", ",", "k_"}], "}"}]}], "]"}], ",", "x2___", 
       ",", 
       RowBox[{"chtest", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"i_", ",", "q_", ",", "l_"}], "}"}], ",", "y2___"}], "]"}], 
       ",", "x3___"}], "]"}], ":=", 
     RowBox[{"List", "[", 
      RowBox[{"x1", ",", "x2", ",", "x3", ",", 
       RowBox[{"chtest", "[", 
        RowBox[{"y1", ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "j", ",", "k"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "q", ",", "l"}], "}"}], ",", "y2"}], "]"}]}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"chtest", " ", "/:", " ", 
     RowBox[{"List", "[", 
      RowBox[{"x1___", ",", 
       RowBox[{"chtest", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"i_", ",", "q_", ",", "l_"}], "}"}], ",", "y2___"}], "]"}], 
       ",", "x2___", ",", 
       RowBox[{"chtest", "[", 
        RowBox[{"y1___", ",", 
         RowBox[{"{", 
          RowBox[{"i_", ",", "j_", ",", "k_"}], "}"}]}], "]"}], ",", 
       "x3___"}], "]"}], ":=", 
     RowBox[{"List", "[", 
      RowBox[{"x1", ",", "x2", ",", "x3", ",", 
       RowBox[{"chtest", "[", 
        RowBox[{"y1", ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "j", ",", "k"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "q", ",", "l"}], "}"}], ",", "y2"}], "]"}]}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"chtest", " ", "/:", " ", 
     RowBox[{"List", "[", 
      RowBox[{"x1___", ",", 
       RowBox[{"chtest", "[", 
        RowBox[{"y1___", ",", 
         RowBox[{"{", 
          RowBox[{"i_", ",", "j_", ",", "k_"}], "}"}]}], "]"}], ",", "x2___", 
       ",", 
       RowBox[{"chtest", "[", 
        RowBox[{"y2___", ",", 
         RowBox[{"{", 
          RowBox[{"i_", ",", "q_", ",", "l_"}], "}"}]}], "]"}], ",", 
       "x3___"}], "]"}], ":=", 
     RowBox[{"List", "[", 
      RowBox[{"x1", ",", "x2", ",", "x3", ",", 
       RowBox[{"chtest", "[", 
        RowBox[{"y1", ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "j", ",", "k"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "q", ",", "l"}], "}"}], ",", 
         RowBox[{"Sequence", "@@", 
          RowBox[{"Reverse", "[", 
           RowBox[{"{", "y2", "}"}], "]"}]}]}], "]"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]"}]}]], "Input",
 CellChangeTimes->{{3.825403206149293*^9, 3.8254032252651596`*^9}, {
   3.825403255669839*^9, 3.8254033252178206`*^9}, 3.825403380687515*^9, {
   3.82540893299856*^9, 3.8254090034364834`*^9}, {3.825409034106453*^9, 
   3.8254091585344543`*^9}, {3.82540919679412*^9, 3.8254094222950306`*^9}, {
   3.825409667901141*^9, 3.8254097067761097`*^9}},
 CellLabel->
  "In[431]:=",ExpressionUUID->"b2cd1fd0-aad8-4cf2-b0bb-3a15ff063909"]
}, Open  ]],

Cell[CellGroupData[{

Cell["pairing", "Subsubsection",
 CellChangeTimes->{{3.8255097565295987`*^9, 
  3.8255097575718827`*^9}},ExpressionUUID->"07b81952-73ec-40af-b643-\
cfb69a7b5870"],

Cell[BoxData[
 RowBox[{
  RowBox[{"pairing", "[", 
   RowBox[{"x_", ",", "y_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"sqtest", "[", "#", "]"}], ",", "#", ",", 
      RowBox[{"Nothing", "[", "]"}]}], "]"}], "&"}], "@", 
   RowBox[{"Join", "[", 
    RowBox[{"x", ",", 
     RowBox[{"{", "y", "}"}]}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.82514478020856*^9, 3.8251447833053293`*^9}, {
  3.825144817546748*^9, 3.8251448402901435`*^9}, {3.8251449372617846`*^9, 
  3.8251449992519736`*^9}, {3.825150697782158*^9, 3.825150698843295*^9}},
 CellLabel->
  "In[425]:=",ExpressionUUID->"8c011e60-95dd-4324-b294-97da57630339"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "If", " ", "exp", " ", "has", " ", "length", " ", "one", " ", "return", 
    " ", "exp"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"allpairings", "[", 
      RowBox[{"{", "exp_List", "}"}], "]"}], ":=", 
     RowBox[{"{", "exp", "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"allpairings", "[", "exp_List", "]"}], ":=", 
     RowBox[{"Fold", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"Outer", "[", 
           RowBox[{"pairing", ",", "#1", ",", "#2", ",", "1"}], "]"}], ",", 
          "1"}], "]"}], "&"}], ",", 
       RowBox[{
        RowBox[{
         RowBox[{"{", "#", "}"}], "&"}], "/@", 
        RowBox[{"(", 
         RowBox[{"First", "@", "exp"}], ")"}]}], ",", 
       RowBox[{"exp", "[", 
        RowBox[{"[", 
         RowBox[{"2", ";;"}], "]"}], "]"}]}], "]"}]}], ";"}]}]}]], "Input",
 CellChangeTimes->{{3.82515294362909*^9, 3.825152985796472*^9}, {
  3.8254974509768333`*^9, 3.8254974632071238`*^9}, {3.8254975192059264`*^9, 
  3.8254975596278133`*^9}, {3.825497784988903*^9, 3.825497785739949*^9}},
 CellLabel->
  "In[426]:=",ExpressionUUID->"6d53efdd-4cd6-4b83-ad7a-a9f20415f639"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "allpairings", " ", "again", " ", "with", " ", "Tuples", " ", "and", " ", 
   "check", " ", "at", " ", "the", " ", "end"}], "*)"}]], "Input",
 CellChangeTimes->{{3.825153269438916*^9, 3.82515327089896*^9}, {
  3.8251533804978204`*^9, 3.825153392141677*^9}, {3.8254809051915317`*^9, 
  3.825480905945515*^9}},
 CellLabel->
  "In[428]:=",ExpressionUUID->"753dc270-8117-4e1f-ada4-451ed5b5d89a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"allpairingsTuples", "[", "exp_List", "]"}], ":=", 
  RowBox[{"DeleteCases", "[", 
   RowBox[{
    RowBox[{"Tuples", "@", "exp"}], ",", 
    RowBox[{"_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"!", 
        RowBox[{"sqtest", "[", "#", "]"}]}], "&"}], ")"}]}]}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.825153395367054*^9, 3.8251534576026335`*^9}, 
   3.8251534900530086`*^9},
 CellLabel->
  "In[429]:=",ExpressionUUID->"adbf1474-7b6c-4ac0-946b-9a26a53baf3a"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Pairing with self-threading function", "Subsubsection",
 CellChangeTimes->{{3.825510448848082*^9, 
  3.825510460429348*^9}},ExpressionUUID->"8142cac2-7421-42b3-b15e-\
9e3ccc97a7ee"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "2", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "3", ",", "2"}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"3", ",", "1", ",", "4"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "2", ",", "1"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "3", ",", "4"}], "}"}]}], "}"}]}], "}"}]], "Input",
 CellLabel->
  "In[480]:=",ExpressionUUID->"fa7cbd8b-9be1-4785-a8e8-6c41b862ed93"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "2", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "3", ",", "2"}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"3", ",", "1", ",", "4"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "2", ",", "1"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "3", ",", "4"}], "}"}]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{3.8255105643363085`*^9},
 CellLabel->
  "Out[480]=",ExpressionUUID->"f98b1b36-e3d3-42bf-a5c3-154ca79bc5cf"]
}, Open  ]],

Cell[BoxData[{
 RowBox[{"Clear", "[", "incompatible", "]"}], "\[IndentingNewLine]", 
 RowBox[{"incompatible", " ", "/:", " ", 
  RowBox[{"List", "[", 
   RowBox[{"x___", ",", 
    RowBox[{"incompatible", "[", "y__", "]"}], ",", "z___"}], "]"}], ":=", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"x", ",", "i", ",", "z"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", 
      RowBox[{"{", "y", "}"}]}], "}"}]}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.825510692131963*^9, 3.8255107831578045`*^9}, {
  3.8255128351280823`*^9, 3.825512876910648*^9}},
 CellLabel->
  "In[505]:=",ExpressionUUID->"8a3f05d9-235c-4a62-94d8-9c3fc7bfa83b"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "2", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "3", ",", "2"}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"3", ",", "1", ",", "4"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "2", ",", "1"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "3", ",", "4"}], "}"}]}], "}"}]}], 
  "}"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"incompatible", "@@@", 
    RowBox[{"GatherBy", "[", 
     RowBox[{"#", ",", 
      RowBox[{
       RowBox[{"OddQ", "@", 
        RowBox[{"Last", "@", "#"}]}], "&"}]}], "]"}]}], "&"}], "/@", 
  "%"}]}], "Input",
 CellChangeTimes->{{3.825510578798032*^9, 3.825510679108218*^9}, {
  3.8255110486955776`*^9, 3.8255110818825436`*^9}},
 CellLabel->
  "In[507]:=",ExpressionUUID->"b84ee920-7f52-41bf-baa6-9d44f65cce13"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "2", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "3", ",", "2"}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"3", ",", "1", ",", "4"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "2", ",", "1"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "3", ",", "4"}], "}"}]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.8255106070032825`*^9, 3.825510679727611*^9}, 
   3.8255107912067337`*^9, {3.8255110636173844`*^9, 3.8255110824172697`*^9}, {
   3.8255128594124846`*^9, 3.8255128789532256`*^9}},
 CellLabel->
  "Out[507]=",ExpressionUUID->"58010cd2-ff57-49ca-aa38-984b1606a82e"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "2", ",", "2"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "3", ",", "2"}], "}"}]}], "}"}]}], "}"}], "}"}], 
   ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"3", ",", "1", ",", "4"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "2", ",", "1"}], "}"}]}], "}"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"3", ",", "3", ",", "4"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "2", ",", "1"}], "}"}]}], "}"}], "}"}]}], "}"}]}], 
  "}"}]], "Output",
 CellChangeTimes->{{3.8255106070032825`*^9, 3.825510679727611*^9}, 
   3.8255107912067337`*^9, {3.8255110636173844`*^9, 3.8255110824172697`*^9}, {
   3.8255128594124846`*^9, 3.825512878976161*^9}},
 CellLabel->
  "Out[508]=",ExpressionUUID->"79af3ece-104f-44eb-a019-dfd6d8c9be1e"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"incompatible", "@@@", 
  RowBox[{"GatherBy", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "1", ",", "4"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"1", ",", "2", ",", "2"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"1", ",", "3", ",", "2"}], "}"}]}], "}"}], ",", 
    RowBox[{
     RowBox[{"OddQ", "@", 
      RowBox[{"Last", "@", "#"}]}], "&"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.8255108186888185`*^9, 3.8255108192509375`*^9}},
 CellLabel->
  "In[489]:=",ExpressionUUID->"8249e68c-c604-418c-8e10-65a3537682c6"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{"1", ",", "1", ",", "4"}], "}"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{"1", ",", "2", ",", "2"}], "}"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{"1", ",", "3", ",", "2"}], "}"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{3.825510819994892*^9},
 CellLabel->
  "Out[489]=",ExpressionUUID->"d90b0462-fcef-4357-9692-d8678226ecb2"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Block", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"exp", ",", "local"}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Every", " ", "row", " ", "gives", " ", "all", " ", "possible", " ", 
     "contractions", " ", "of", " ", "a", " ", "given", " ", "angle", " ", 
     "bracket"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"exp", "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "2", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "3", ",", "2"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"3", ",", "1", ",", "4"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "2", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "3", ",", "4"}], "}"}]}], "}"}]}], "}"}]}], ";", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
     "Single", " ", "out", " ", "incompatible", " ", "contractions", " ", 
      "and", " ", "pair", " ", "them", " ", "up"}], "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"g", "@@@", 
        RowBox[{"Echo", "@", 
         RowBox[{"GatherBy", "[", 
          RowBox[{"#", ",", 
           RowBox[{
            RowBox[{"OddQ", "@", 
             RowBox[{"Last", "@", "#"}]}], "&"}]}], "]"}]}]}], "&"}], "/@", 
      "exp"}], "//", "Echo"}], ";", "\[IndentingNewLine]", 
    RowBox[{"Flatten", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"incompatible", "@@@", 
         RowBox[{"GatherBy", "[", 
          RowBox[{"#", ",", 
           RowBox[{
            RowBox[{"OddQ", "@", 
             RowBox[{"Last", "@", "#"}]}], "&"}]}], "]"}]}], "&"}], "/@", 
       "exp"}], ",", "1"}], "]"}]}]}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}]], "Input",
 CellChangeTimes->{{3.825511098184574*^9, 3.825511129290164*^9}, {
  3.82551160726138*^9, 3.8255116584139247`*^9}, {3.8255117360267696`*^9, 
  3.825511750788599*^9}, {3.825512660256589*^9, 3.825512720082258*^9}, {
  3.825513014489129*^9, 3.825513020797017*^9}},
 CellLabel->
  "In[509]:=",ExpressionUUID->"36842584-be4a-4e3f-8144-c16d8f198184"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{"1", ",", "1", ",", "3"}], "}"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "2", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "3", ",", "2"}], "}"}]}], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.825513021736991*^9},ExpressionUUID->"d2d6c11f-4cfe-47c7-80d4-\
caaf3ede69e5"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"3", ",", "1", ",", "4"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "3", ",", "4"}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{"3", ",", "2", ",", "1"}], "}"}], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.825513021897848*^9},ExpressionUUID->"1c8ebf01-b8b7-429c-9773-\
bd154449280d"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"g", "[", 
      RowBox[{"{", 
       RowBox[{"1", ",", "1", ",", "3"}], "}"}], "]"}], ",", 
     RowBox[{"g", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "2", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "3", ",", "2"}], "}"}]}], "]"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"g", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"3", ",", "1", ",", "4"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "3", ",", "4"}], "}"}]}], "]"}], ",", 
     RowBox[{"g", "[", 
      RowBox[{"{", 
       RowBox[{"3", ",", "2", ",", "1"}], "}"}], "]"}]}], "}"}]}], 
  "}"}]], "Echo",
 CellChangeTimes->{
  3.825513022053439*^9},ExpressionUUID->"af7a6268-bc9a-4212-ba8f-\
c75e18d75a1f"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "2", ",", "2"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "3", ",", "2"}], "}"}]}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"3", ",", "1", ",", "4"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"3", ",", "2", ",", "1"}], "}"}]}], "}"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"3", ",", "3", ",", "4"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"3", ",", "2", ",", "1"}], "}"}]}], "}"}], "}"}]}], 
  "}"}]], "Output",
 CellChangeTimes->{
  3.825511750894208*^9, {3.825512663267494*^9, 3.825512720881318*^9}, 
   3.8255130221685643`*^9},
 CellLabel->
  "Out[509]=",ExpressionUUID->"24be7384-a74f-4465-b5c6-05a6f3a59f71"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
   "THIS", " ", "DOES", " ", "CLEARLY", " ", "MESS", " ", "UP", " ", "THE", 
    " ", "STRUCTURE", " ", "OF", " ", "THE", " ", "LISTS"}], ",", " ", 
   RowBox[{
    RowBox[{"BETTER", " ", "AVOID"}], "..."}]}], "*)"}]], "Input",
 CellChangeTimes->{{3.825513048280667*^9, 
  3.8255130732320733`*^9}},ExpressionUUID->"40c7d932-d2b0-405f-a8c8-\
71b50c26d01d"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Block", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"exp", ",", "local"}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Every", " ", "row", " ", "gives", " ", "all", " ", "possible", " ", 
     "contractions", " ", "of", " ", "a", " ", "given", " ", "angle", " ", 
     "bracket"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"exp", "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "2", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "3", ",", "2"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"3", ",", "1", ",", "4"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "2", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "3", ",", "4"}], "}"}]}], "}"}]}], "}"}]}], ";", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
     "Single", " ", "out", " ", "incompatible", " ", "contractions", " ", 
      "and", " ", "pair", " ", "them", " ", "up", " ", "for", " ", "each", 
      " ", "individual", " ", "angle", " ", "bracket"}], "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Echo", "[", 
               RowBox[{"#", ",", "\"\<name\>\""}], "]"}], "&"}], "@", "#"}], 
            "]"}], ">", "1"}], ",", 
          RowBox[{"Flatten", "[", 
           RowBox[{
            RowBox[{"Outer", "[", 
             RowBox[{"List", ",", 
              RowBox[{"Echo", "@", 
               RowBox[{"First", "@", "#"}]}], ",", 
              RowBox[{"Echo", "@", 
               RowBox[{"Last", "@", "#"}]}], ",", "1"}], "]"}], ",", "1"}], 
           "]"}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"{", "#", "}"}], "&"}], "/@", "#"}]}], "]"}], "&"}], "/@", 
       RowBox[{"Echo", "[", 
        RowBox[{"#", ",", "\"\<gathered\>\""}], "]"}]}], "&"}], "@", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"GatherBy", "[", 
         RowBox[{"#", ",", 
          RowBox[{
           RowBox[{"OddQ", "@", 
            RowBox[{"Last", "@", "#"}]}], "&"}]}], "]"}], "&"}], "/@", 
       "exp"}], ")"}]}]}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "Pair", " ", "the", " ", "angle", " ", "bracket", " ", "contractions", 
     " ", "among", " ", "each", " ", 
     RowBox[{"other", ".", " ", "HERE"}], " ", "WE", " ", "NEED", " ", "TO", 
     " ", "TEST", " ", "THE", " ", "SQUARE", " ", "BRACKETS"}], ",", " ", 
    RowBox[{
    "ALSO", " ", "WE", " ", "NEED", " ", "TO", " ", "MAKE", " ", "SURE", " ", 
     "THAT", " ", "IF", " ", "A", " ", "GIVEN", " ", "ANGLE", " ", 
     "CONTRACTION", " ", "IS", " ", "THE", " ", "ONLY", " ", "POSSIBLE", " ", 
     "AND", " ", "IS", " ", "MUTUALLY", " ", "EXCLUSIVE", " ", "WITH", " ", 
     "ONE", " ", "OF", " ", "THE", " ", "ALREADY", " ", "CONSIDERED", " ", 
     "CONTRACTIONS", " ", "THEN", " ", "WE", " ", "NEED", " ", "TO", " ", 
     "CREATE", " ", "TWO", " ", "LISTS"}], ",", " ", 
    RowBox[{
    "ONE", " ", "FOR", " ", "EACH", " ", "OF", " ", "THE", " ", "CONSIDERED", 
     " ", "CONTRACTIONS"}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellChangeTimes->{{3.8255133165366473`*^9, 3.825513456203559*^9}, {
  3.8255135238899436`*^9, 
  3.8255137541565704`*^9}},ExpressionUUID->"77c2a842-80ca-4cc9-84df-\
12d1c983d6c8"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  TagBox["\<\"gathered\"\>",
   "EchoLabel"], "  ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1", ",", "3"}], "}"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "2", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "3", ",", "2"}], "}"}]}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"3", ",", "1", ",", "4"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "3", ",", "4"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"{", 
        RowBox[{"3", ",", "2", ",", "1"}], "}"}], "}"}]}], "}"}]}], 
   "}"}]}]], "Echo",
 CellChangeTimes->{
  3.825513619150031*^9},ExpressionUUID->"33c1b274-4ba9-4f5b-87f0-\
2b9d82427101"],

Cell[BoxData[
 RowBox[{
  TagBox["\<\"name\"\>",
   "EchoLabel"], "  ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{"1", ",", "1", ",", "3"}], "}"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "2", ",", "2"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"1", ",", "3", ",", "2"}], "}"}]}], "}"}]}], "}"}]}]], "Echo",
 CellChangeTimes->{
  3.8255136192462673`*^9},ExpressionUUID->"4b13c53f-3081-4fb6-9c03-\
a72e9259b53a"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"{", 
   RowBox[{"1", ",", "1", ",", "3"}], "}"}], "}"}]], "Echo",
 CellChangeTimes->{
  3.825513619351898*^9},ExpressionUUID->"e7b9400b-2ce3-4423-8e13-\
98a176f95060"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"1", ",", "2", ",", "2"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "3", ",", "2"}], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.825513619451372*^9},ExpressionUUID->"6f055203-f3c6-4f7c-a991-\
b1c366361ffa"],

Cell[BoxData[
 RowBox[{
  TagBox["\<\"name\"\>",
   "EchoLabel"], "  ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"3", ",", "1", ",", "4"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"3", ",", "3", ",", "4"}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{"3", ",", "2", ",", "1"}], "}"}], "}"}]}], "}"}]}]], "Echo",
 CellChangeTimes->{
  3.8255136195600834`*^9},ExpressionUUID->"aa51cc58-fdb4-41b8-92b3-\
73129ce63f01"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"3", ",", "1", ",", "4"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"3", ",", "3", ",", "4"}], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.825513619669744*^9},ExpressionUUID->"08bb6433-a2d7-4c07-b17d-\
4cdf6b965a80"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"{", 
   RowBox[{"3", ",", "2", ",", "1"}], "}"}], "}"}]], "Echo",
 CellChangeTimes->{
  3.8255136197784133`*^9},ExpressionUUID->"d329b1fc-f632-43aa-8707-\
61230c2a81ac"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "2", ",", "2"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "3", ",", "2"}], "}"}]}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"3", ",", "1", ",", "4"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "2", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"3", ",", "3", ",", "4"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "2", ",", "1"}], "}"}]}], "}"}]}], "}"}]}], 
  "}"}]], "Output",
 CellChangeTimes->{{3.825513319529458*^9, 3.825513329216549*^9}, {
  3.825513411880952*^9, 3.825513457474638*^9}, {3.8255135281254044`*^9, 
  3.825513580007787*^9}, {3.8255136109162564`*^9, 3.8255136198930387`*^9}},
 CellLabel->
  "Out[521]=",ExpressionUUID->"3d446e91-2373-4f55-a546-163129f30038"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["From list of brackets to list of chains", "Subsubsection",
 CellChangeTimes->{{3.8254284765411015`*^9, 
  3.8254284892640715`*^9}},ExpressionUUID->"b4d5db34-6e1d-43f5-a1c3-\
e847400c23af"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "Giving", " ", "angles", " ", "and", " ", "squares", " ", "separated", " ", 
   "as", " ", "an", " ", "input"}], "*)"}]], "Input",
 CellChangeTimes->{{3.825484041237546*^9, 3.825484055608059*^9}},
 CellLabel->
  "In[437]:=",ExpressionUUID->"3dbbe892-9064-4782-82fc-02e2cce2e6d0"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"chainLists", "[", 
    RowBox[{"ag_List", ",", "sq_List"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "allchains", "}"}], ",", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
       "allcontractions", " ", "gives", " ", "all", " ", "the", " ", 
        "possible", " ", "contractions", " ", "of", " ", "the", " ", "angles",
         " ", "with", " ", "the", " ", 
        RowBox[{"squares", ".", " ", "Angles"}], " ", "are", " ", "labelled", 
        " ", "by", " ", "row", " ", "in", " ", "matrix"}], ",", " ", 
       RowBox[{"squares", " ", "by", " ", "explicit", " ", "label", " ", 
        RowBox[{"(", 
         RowBox[{
         "in", " ", "order", " ", "to", " ", "avoid", " ", "gigantic", " ", 
          "matrices"}], ")"}], " ", "and", " ", "second", " ", "label", " ", 
        "is", " ", 
        RowBox[{"weight", ".", " ", "We"}], " ", "remove", " ", "all", " ", 
        "the", " ", "terms", " ", "signaling", " ", "no", " ", "possible", 
        " ", "contraction"}]}], "*)"}], "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"allchains", "=", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"DeleteCases", "[", 
           RowBox[{"#", ",", 
            RowBox[{"{", "}"}]}], "]"}], "&"}], "@", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"DeleteCases", "[", 
             RowBox[{"#", ",", 
              RowBox[{"{", 
               RowBox[{"_", ",", "_", ",", "0"}], "}"}]}], "]"}], "&"}], "/@", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"i", ",", "j", ",", 
               RowBox[{"weight", "[", 
                RowBox[{
                 RowBox[{"ag", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], ",", 
                 RowBox[{"sq", "[", 
                  RowBox[{"[", "j", "]"}], "]"}]}], "]"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", 
               RowBox[{"Length", "[", "ag", "]"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"j", ",", 
               RowBox[{"Length", "[", "sq", "]"}]}], "}"}]}], "]"}]}], 
          ")"}]}], "//", "Echo"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Next", " ", "out", " ", "of", " ", "the", " ", "possible", " ", 
         "contractions", " ", "on", " ", "the", " ", "single", " ", "row", 
         " ", "we", " ", "take", " ", "pairs", " ", "of", " ", "compatibel", 
         " ", "contractions"}], ",", " ", 
        RowBox[{
        "so", " ", "first", " ", "take", " ", "Subsets", " ", "grouping", " ",
          "by", " ", "2"}], ",", " ", 
        RowBox[{
        "then", " ", "delete", " ", "those", " ", "whose", " ", "associated", 
         " ", "weight", " ", "sum", " ", "is", " ", 
         RowBox[{"even", ".", " ", "The"}], " ", "weights", " ", "have", " ", 
         "been", " ", "assigned", " ", "exactly", " ", "in", " ", "such", " ",
          "a", " ", "way", " ", "that", " ", "these", " ", "are", " ", "the", 
         " ", "forbidden", " ", 
         RowBox[{"cases", ".", " ", "Then"}], " ", "take", " ", "all", " ", 
         "the", " ", "possible", " ", "combinations", " ", "of", " ", "the", 
         " ", "allowed", " ", "contractions"}]}], "*)"}], 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"allchains", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "#", "]"}], ">", "1"}], ",", 
           RowBox[{"Subsets", "[", 
            RowBox[{"#", ",", 
             RowBox[{"{", "2", "}"}]}], "]"}], ",", 
           RowBox[{"{", "#", "}"}]}], "]"}], "&"}], "/@", "allchains"}]}], 
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"allchains", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{"#", ",", "1"}], "]"}], "&"}], "/@", 
        RowBox[{"allpairings", "@", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"DeleteCases", "[", 
             RowBox[{"#", ",", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"_", ",", "_", ",", "j_"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"_", ",", "_", ",", "l_"}], "}"}]}], "}"}], "/;", 
               RowBox[{"EvenQ", "[", 
                RowBox[{"j", "+", "l"}], "]"}]}]}], "]"}], "&"}], "/@", 
           "allchains"}], ")"}]}]}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Along", " ", "with", " ", "the", " ", "chains", " ", "return", " ", 
        "also", " ", "a", " ", "list", " ", "of", " ", "the", " ", 
        "uncontracted", " ", "brackets"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"{", 
        RowBox[{"allchains", ",", 
         RowBox[{"Flatten", "/@", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Part", "[", 
                RowBox[{"ag", ",", "#1"}], "]"}], ",", 
               RowBox[{"Part", "[", 
                RowBox[{"sq", ",", "#2"}], "]"}]}], "}"}], "&"}], "@@@", 
            RowBox[{"Apply", "[", 
             RowBox[{"Complement", ",", 
              RowBox[{"Map", "[", 
               RowBox[{"Transpose", ",", 
                RowBox[{"Flatten", "[", 
                 RowBox[{
                  RowBox[{"Outer", "[", 
                   RowBox[{"List", ",", 
                    RowBox[{"Sequence", "@@", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Range", "@", 
                    RowBox[{"Length", "[", "ag", "]"}]}], ",", 
                    RowBox[{"Range", "@", 
                    RowBox[{"Length", "[", "sq", "]"}]}]}], "}"}], "}"}], ",", 
                    RowBox[{"Most", "/@", 
                    RowBox[{"Transpose", "/@", "allchains"}]}]}], "}"}]}], 
                    ",", "1"}], "]"}], ",", "1"}], "]"}]}], "]"}], ",", 
              RowBox[{"{", "2", "}"}]}], "]"}]}], ")"}]}]}], "}"}], "]"}]}]}],
     "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.8250489430100217`*^9, 3.825048947557375*^9}, {
   3.825049006710558*^9, 3.825049074556138*^9}, {3.8250491522231135`*^9, 
   3.825049205602866*^9}, {3.8250493818461633`*^9, 3.825049814208542*^9}, {
   3.825049852800672*^9, 3.8250498620017524`*^9}, {3.8250499163703876`*^9, 
   3.8250499500710087`*^9}, {3.82504998443499*^9, 3.825050003109603*^9}, {
   3.8250500743860774`*^9, 3.825050100389584*^9}, {3.825050130990181*^9, 
   3.825050131387205*^9}, {3.825050177893777*^9, 3.8250502022576065`*^9}, {
   3.8250506517982974`*^9, 3.825050746326376*^9}, {3.8250507938855376`*^9, 
   3.825050812487685*^9}, {3.8250508531843452`*^9, 3.82505086522179*^9}, {
   3.8250509146979876`*^9, 3.8250509157083936`*^9}, {3.825050983177038*^9, 
   3.8250509994868546`*^9}, {3.825051208589814*^9, 3.825051275511667*^9}, {
   3.8250513206147437`*^9, 3.8250513872885685`*^9}, {3.8250516078658533`*^9, 
   3.8250516136252956`*^9}, {3.8250517664954624`*^9, 3.825051770127508*^9}, {
   3.8250518206059294`*^9, 3.825051846123903*^9}, {3.825051925183688*^9, 
   3.8250519275589724`*^9}, {3.8250523483729095`*^9, 3.825052352449723*^9}, {
   3.825052392481635*^9, 3.8250523984448338`*^9}, {3.825052437336427*^9, 
   3.825052465391181*^9}, {3.825052497635206*^9, 3.8250525056443415`*^9}, {
   3.8250551240297585`*^9, 3.8250551605496454`*^9}, {3.8250552065227757`*^9, 
   3.825055268474984*^9}, {3.8250553032400627`*^9, 3.8250553584779854`*^9}, {
   3.8250554520502043`*^9, 3.8250554584306774`*^9}, {3.8250717449311457`*^9, 
   3.8250717647580194`*^9}, {3.8250763235261602`*^9, 
   3.8250763491618614`*^9}, {3.8250764189852667`*^9, 3.825076423588516*^9}, {
   3.825076779954033*^9, 3.8250768100281878`*^9}, {3.8250768501310673`*^9, 
   3.8250768548213673`*^9}, {3.8250768890118275`*^9, 3.825076942722869*^9}, {
   3.8250773419806757`*^9, 3.8250773921179256`*^9}, {3.8250774271969995`*^9, 
   3.825077612206614*^9}, {3.825077747295968*^9, 3.8250777885611854`*^9}, {
   3.8250781889449973`*^9, 3.8250782151625633`*^9}, {3.8251438352850637`*^9, 
   3.82514383712908*^9}, {3.8251441896322765`*^9, 3.8251442314135733`*^9}, {
   3.825153560815752*^9, 3.8251536205818815`*^9}, {3.8251580243172936`*^9, 
   3.8251581095729237`*^9}, {3.82515814455998*^9, 3.8251581642060394`*^9}, {
   3.825158198404315*^9, 3.825158230124658*^9}, {3.8251582675244884`*^9, 
   3.825158291352307*^9}, {3.8251583283322268`*^9, 3.8251583451283407`*^9}, {
   3.8251584192524185`*^9, 3.8251584349104805`*^9}, {3.8251584815404825`*^9, 
   3.8251585461280966`*^9}, {3.8251586173523707`*^9, 
   3.8251586336186314`*^9}, {3.8251587018732376`*^9, 
   3.8251587045390205`*^9}, {3.825158943880517*^9, 3.8251589511095767`*^9}, {
   3.8251589817399063`*^9, 3.825158983405657*^9}, {3.8251590218583217`*^9, 
   3.825159174009163*^9}, {3.8251592157534723`*^9, 3.8251592599342685`*^9}, {
   3.8251592924849544`*^9, 3.8251592998090887`*^9}, {3.825159357707556*^9, 
   3.825159384902178*^9}, {3.825159933483389*^9, 3.825159966965823*^9}, {
   3.8251636129103165`*^9, 3.8251636185563736`*^9}, {3.8251637260802183`*^9, 
   3.825163730467022*^9}, {3.8251641256215105`*^9, 3.825164230318243*^9}, {
   3.8251643559017973`*^9, 3.825164363862764*^9}, {3.825164442803305*^9, 
   3.825164463449709*^9}, {3.8251650639291334`*^9, 3.8251650955606136`*^9}, {
   3.825165781109802*^9, 3.825165920450986*^9}, {3.8251661111327715`*^9, 
   3.8251661127612123`*^9}, {3.825166146117394*^9, 3.8251661475695477`*^9}, {
   3.8251661783039894`*^9, 3.825166195292718*^9}, {3.8251662735647707`*^9, 
   3.825166353105399*^9}, {3.825166396016432*^9, 3.825166406853433*^9}, {
   3.825168220344531*^9, 3.8251682462652087`*^9}, {3.825168398490062*^9, 
   3.8251684537508097`*^9}, {3.8251686053692865`*^9, 3.8251686392856116`*^9}, 
   3.825480861456559*^9, {3.825481009751027*^9, 3.8254810470533085`*^9}, {
   3.8254811199403114`*^9, 3.8254811417599497`*^9}, {3.825481225780012*^9, 
   3.8254812685981145`*^9}, {3.825481333157443*^9, 3.825481367525523*^9}, {
   3.825481435047923*^9, 3.8254815109160023`*^9}, {3.825481934167982*^9, 
   3.8254819965581093`*^9}, {3.8254820392230053`*^9, 
   3.8254820918732376`*^9}, {3.8254821992799644`*^9, 3.825482273506331*^9}, {
   3.8254823084638324`*^9, 3.8254823508375516`*^9}, {3.8254824156422234`*^9, 
   3.825482455622239*^9}, {3.8254825529279313`*^9, 3.8254826589856634`*^9}, {
   3.825482907711004*^9, 3.8254829358083735`*^9}, {3.82548298293696*^9, 
   3.8254831186647434`*^9}, {3.825483206109913*^9, 3.825483301061756*^9}, {
   3.8254833650645723`*^9, 3.8254833703434534`*^9}, {3.8254835515946727`*^9, 
   3.825483663512661*^9}, {3.8254839748476024`*^9, 3.825483989234126*^9}, {
   3.8254969605087333`*^9, 3.8254969612846017`*^9}, {3.8254971182778587`*^9, 
   3.8254971233403196`*^9}, 3.8254971713818274`*^9, {3.825510514708335*^9, 
   3.825510517246787*^9}},
 CellLabel->
  "In[478]:=",ExpressionUUID->"f9bb6dd1-1128-40d4-9a53-768ee7a57122"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"chainLists", "@@", 
  RowBox[{"GatherBy", "[", 
   RowBox[{"test", ",", "Head"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.82548099240028*^9, 3.825480996313964*^9}, {
  3.8254839960848017`*^9, 3.825484026263542*^9}},
 CellLabel->
  "In[479]:=",ExpressionUUID->"3a290735-fe40-466d-b6a3-9a56724e671f"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "2", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "3", ",", "2"}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"3", ",", "1", ",", "4"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "2", ",", "1"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "3", ",", "4"}], "}"}]}], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.8255105222150354`*^9},ExpressionUUID->"3fe489dd-1834-427b-830f-\
193aa5503da5"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "2", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "1", ",", "4"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "2", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "2", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "2", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "3", ",", "4"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "3", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "1", ",", "4"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "2", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "3", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "2", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "3", ",", "4"}], "}"}]}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       TemplateBox[{"5", "6"},
        "SpinorAngleBracket",
        DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
           RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
        InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
           RowBox[{#, ",", #2}], "]"}]& )], ",", 
       TemplateBox[{"2", "4"},
        "SpinorSquareBracket",
        DisplayFunction->(RowBox[{"[", 
           RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
        InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
           RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
     RowBox[{"{", 
      TemplateBox[{"5", "6"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], "}"}], ",", 
     RowBox[{"{", 
      TemplateBox[{"5", "6"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], "}"}], ",", 
     RowBox[{"{", 
      TemplateBox[{"5", "6"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], "}"}]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.8254809970051146`*^9, {3.8254810338366103`*^9, 3.8254810493710566`*^9}, 
   3.82548127078826*^9, {3.825481356062179*^9, 3.8254813691412325`*^9}, {
   3.8254814683947325`*^9, 3.8254815119442525`*^9}, {3.8254819589427147`*^9, 
   3.8254819710672855`*^9}, 3.8254820585343866`*^9, 3.82548210157028*^9, {
   3.8254822139387026`*^9, 3.825482231865755*^9}, {3.8254822666227407`*^9, 
   3.825482274768985*^9}, {3.825482321439126*^9, 3.825482352126053*^9}, {
   3.8254824253950825`*^9, 3.825482457802412*^9}, {3.825482573637538*^9, 
   3.8254826029230757`*^9}, {3.8254826367232065`*^9, 3.8254826608247414`*^9}, 
   3.8254829213096137`*^9, 3.825483017031799*^9, 3.825483080399226*^9, {
   3.825483111844986*^9, 3.825483120556713*^9}, 3.8254832087069125`*^9, {
   3.8254832390717335`*^9, 3.8254833024072*^9}, 3.825483372476746*^9, {
   3.8254835556298776`*^9, 3.825483577690875*^9}, 3.82548362556122*^9, 
   3.8254837182941384`*^9, {3.8254840061713142`*^9, 3.8254840272439175`*^9}, 
   3.8255096372819624`*^9, 3.825510522321663*^9},
 CellLabel->
  "Out[479]=",ExpressionUUID->"49c22c19-9962-4b0b-ae0d-72ceda53eae8"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"chtest", "/@", 
  RowBox[{"First", "@", "%"}]}]], "Input",
 CellChangeTimes->{{3.8254837076855173`*^9, 3.8254837164491205`*^9}},
 CellLabel->
  "In[440]:=",ExpressionUUID->"206cc607-c30e-4799-9d14-fe8bf79d22ea"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"chtest", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"1", ",", "2", ",", "2"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"3", ",", "1", ",", "4"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"3", ",", "2", ",", "1"}], "}"}]}], "}"}], "]"}], ",", 
   RowBox[{"chtest", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"1", ",", "2", ",", "2"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"3", ",", "2", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"3", ",", "3", ",", "4"}], "}"}]}], "}"}], "]"}], ",", 
   RowBox[{"chtest", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"1", ",", "3", ",", "2"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"3", ",", "1", ",", "4"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"3", ",", "2", ",", "1"}], "}"}]}], "}"}], "]"}], ",", 
   RowBox[{"chtest", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"1", ",", "3", ",", "2"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"3", ",", "2", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"3", ",", "3", ",", "4"}], "}"}]}], "}"}], "]"}]}], 
  "}"}]], "Output",
 CellChangeTimes->{3.825483719132897*^9, 3.825509637376007*^9},
 CellLabel->
  "Out[440]=",ExpressionUUID->"0fcaed83-10a9-4ab1-a656-6f3f6fe81881"]
}, Open  ]]
}, Closed]]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Again", "Section",
 CellChangeTimes->{{3.825762943495719*^9, 
  3.8257629442956324`*^9}},ExpressionUUID->"1eb813e5-eb86-422b-80ef-\
1b0d78428a57"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"New", " ", 
    RowBox[{"concept", ":", " ", 
     RowBox[{
     "we", " ", "start", " ", "from", " ", "a", " ", "product", " ", "of", 
      " ", "brackets", " ", "and", " ", "chains"}]}]}], ",", " ", 
   RowBox[{
   "extract", " ", "the", " ", "helicity", " ", "weight", " ", "and", " ", 
    "determin", " ", "the", " ", "number", " ", "of", " ", "momenta", " ", 
    "to", " ", "be", " ", "formed", " ", 
    RowBox[{"(", 
     RowBox[{
     "each", " ", "connection", " ", "is", " ", "a", " ", "momentum", " ", 
      "of", " ", "course"}], ")"}], " ", "and", " ", "then", " ", "take", " ",
     "the", " ", "combinatorics", " ", "of", " ", "that"}]}], "*)"}]], "Input",
 CellChangeTimes->{{3.8257629474142704`*^9, 3.8257629793996973`*^9}, {
  3.8257631818692102`*^9, 
  3.825763248456066*^9}},ExpressionUUID->"2a3c4fd2-45b2-418c-ab38-\
1c6fa90075f4"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"test", "=", 
  RowBox[{"{", 
   RowBox[{
    TemplateBox[{"1", "2"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"5", "6"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"3", "4"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"1", "4"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"2", "3"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"2", "4"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}]], "Input",
 CellChangeTimes->{{3.8257632526777706`*^9, 3.825763266619485*^9}},
 CellLabel->"In[10]:=",ExpressionUUID->"f20cf379-ca3a-421a-848c-496ccd712607"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   TemplateBox[{"1", "2"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"5", "6"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"3", "4"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"1", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"2", "3"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"2", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]], "Output",
 CellChangeTimes->{3.825763268136423*^9, 3.826002668444623*^9, 
  3.826082537490675*^9, 3.826085867862112*^9, 3.8261042886547623`*^9},
 CellLabel->"Out[10]=",ExpressionUUID->"81f60468-6fa7-4ca0-a37b-212619715b74"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"test2", "=", 
  RowBox[{"{", 
   RowBox[{
    TemplateBox[{"1", "2"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"1", "4"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"1", "3"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}]], "Input",
 CellChangeTimes->{{3.8257632691647234`*^9, 3.825763291986484*^9}},
 CellLabel->"In[11]:=",ExpressionUUID->"38ec4194-d329-4742-8103-47d748fdbad7"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   TemplateBox[{"1", "2"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"1", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"1", "3"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]], "Output",
 CellChangeTimes->{3.825763292770361*^9, 3.826002669082876*^9, 
  3.8260825377200556`*^9, 3.8260858680630293`*^9, 3.826104288930026*^9},
 CellLabel->"Out[11]=",ExpressionUUID->"e3ea542e-756b-409a-9ec8-1fd67d8920bf"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"test3", "=", 
  RowBox[{"{", 
   RowBox[{
    TemplateBox[{"1", "2"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"1", "4"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"1", "3"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    RowBox[{"Chain", "[", 
     RowBox[{"$angle", ",", "4", ",", 
      RowBox[{"{", 
       RowBox[{"5", ",", "6"}], "}"}], ",", "7", ",", "$angle"}], "]"}]}], 
   "}"}]}]], "Input",
 CellChangeTimes->{{3.8257634102601304`*^9, 3.8257634370134525`*^9}},
 CellLabel->"In[12]:=",ExpressionUUID->"9e89401b-8e02-49d3-9905-182a02de9c6e"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   TemplateBox[{"1", "2"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"1", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"1", "3"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"4", 
     RowBox[{"{", 
       RowBox[{"5", ",", "6"}], "}"}], "7"},
    "AngleAngleChain",
    DisplayFunction->(
     RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle", 
       "]"}]& )]}], "}"}]], "Output",
 CellChangeTimes->{3.825763438073924*^9, 3.8260026696444073`*^9, 
  3.826082537805793*^9, 3.826085868162299*^9, 3.826104289055721*^9},
 CellLabel->"Out[12]=",ExpressionUUID->"15cadca2-c1fd-4e8a-89f4-39b2dabd7da9"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"test4", "=", 
  RowBox[{"{", 
   RowBox[{
    TemplateBox[{"1", "2"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"1", "4"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"1", "2"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}]], "Input",
 CellChangeTimes->{{3.826002765206852*^9, 3.8260027714601316`*^9}},
 CellLabel->"In[13]:=",ExpressionUUID->"6a251773-c528-4082-99ba-411cc6bd9662"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   TemplateBox[{"1", "2"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"1", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"1", "2"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]], "Output",
 CellChangeTimes->{3.826002772399602*^9, 3.826082537890567*^9, 
  3.8260858682667027`*^9, 3.826104289177362*^9},
 CellLabel->"Out[13]=",ExpressionUUID->"570d70dd-bb95-4de5-832a-c7608d40195c"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"test5", "=", 
  RowBox[{"{", 
   RowBox[{
    TemplateBox[{"1", "2"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"5", "6"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"3", "4"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"1", "4"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"2", "3"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"2", "4"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"2", "6"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}]], "Input",
 CellChangeTimes->{{3.826004370524476*^9, 3.826004399395281*^9}},
 CellLabel->"In[14]:=",ExpressionUUID->"84baecbc-9ad0-49c2-9a65-a66861a26e2f"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   TemplateBox[{"1", "2"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"5", "6"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"3", "4"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"1", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"2", "3"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"2", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"2", "6"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]], "Output",
 CellChangeTimes->{3.8260044009321566`*^9, 3.8260825379763374`*^9, 
  3.826085868365754*^9, 3.826104289295081*^9},
 CellLabel->"Out[14]=",ExpressionUUID->"f5a6a4d6-b654-4b85-82e1-a5d7d83ab15a"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"test6", "=", 
  RowBox[{"{", 
   RowBox[{
    TemplateBox[{"1", "2"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"2", "3"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"3", "4"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}]], "Input",
 CellChangeTimes->{{3.8260226606039057`*^9, 3.826022675643494*^9}},
 CellLabel->"In[15]:=",ExpressionUUID->"ed116a17-dc09-4749-8be7-8c6a24956418"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   TemplateBox[{"1", "2"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"2", "3"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"3", "4"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]], "Output",
 CellChangeTimes->{3.8260226766288967`*^9, 3.826082538060113*^9, 
  3.8260858684637356`*^9, 3.826104289418726*^9},
 CellLabel->"Out[15]=",ExpressionUUID->"79312cf0-c931-48c3-9357-bcd07be4d16d"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"test7", "=", 
  RowBox[{"{", 
   RowBox[{
    TemplateBox[{"1", "2"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"2", "3"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"3", "4"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"4", "5"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"5", "6"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}]], "Input",
 CellChangeTimes->{{3.826024419292904*^9, 3.8260244443916616`*^9}},
 CellLabel->"In[16]:=",ExpressionUUID->"21eb3548-77e6-4f9f-a817-0f2bd2ffe3f4"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   TemplateBox[{"1", "2"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"2", "3"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"3", "4"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"4", "5"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"5", "6"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]], "Output",
 CellChangeTimes->{3.8260244485854797`*^9, 3.8260825381438885`*^9, 
  3.826085868555739*^9, 3.826104289535405*^9},
 CellLabel->"Out[16]=",ExpressionUUID->"a8870eed-cb9d-45ce-9f74-a0297b9665cd"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"test8", "=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"Chain", "[", 
     RowBox[{"$angle", ",", "1", ",", 
      RowBox[{"{", "2", "}"}], ",", "3", ",", "$square"}], "]"}], ",", 
    TemplateBox[{"3", "4"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"5", "6"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}]], "Input",
 CellChangeTimes->{{3.826086064118992*^9, 3.8260861126721992`*^9}},
 CellLabel->"In[17]:=",ExpressionUUID->"353623b9-0e80-4477-ac0b-9e63727d9452"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   TemplateBox[{"1", 
     RowBox[{"{", "2", "}"}], "3"},
    "AngleSquareChain",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square",
        "]"}]& )], ",", 
   TemplateBox[{"3", "4"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"5", "6"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]], "Output",
 CellChangeTimes->{3.8260861138243246`*^9, 3.826104289647107*^9},
 CellLabel->"Out[17]=",ExpressionUUID->"bed984a3-60c6-49a9-ba09-f128cedabe3b"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Extracting \[OpenCurlyDoubleQuote]helicity weight\
\[CloseCurlyDoubleQuote]", "Subsection",
 CellChangeTimes->{{3.825763386272174*^9, 
  3.825763392406499*^9}},ExpressionUUID->"3c299e33-1dee-41a4-9a80-\
62ef7b720a17"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
   "Auxiliary", " ", "function", " ", "to", " ", "test", " ", "for", " ", 
    "duplicates", " ", "in", " ", "a", " ", "list"}], ",", " ", 
   RowBox[{
   "returns", " ", "False", " ", "if", " ", "there", " ", "are", " ", "no", 
    " ", "duplicates"}]}], "*)"}]], "Input",
 CellChangeTimes->{{3.825768477952244*^9, 
  3.825768502537095*^9}},ExpressionUUID->"8a620c00-cb93-45c1-a063-\
22266a9b0b16"],

Cell[BoxData[
 RowBox[{
  RowBox[{"duplicatesQ", " ", "=", " ", 
   RowBox[{
    RowBox[{"0", " ", "===", 
     RowBox[{"Signature", "@", "#"}]}], "&"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.825768375158662*^9, 3.825768420305456*^9}},
 CellLabel->"In[9]:=",ExpressionUUID->"93b68b0e-132d-4641-8fc8-706d0ebfb360"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
   "Auxiliary", " ", "function", " ", "for", " ", "testing", " ", "if", " ", 
    "a", " ", "contraction", " ", "is", " ", "possible"}], ",", " ", 
   RowBox[{
    RowBox[{"i", ".", "e", ".", " ", "if"}], " ", "every", " ", "bracket", 
    " ", "appears", " ", "at", " ", "most", " ", "once"}]}], "*)"}]], "Input",
 CellChangeTimes->{{3.825768686925809*^9, 3.825768698761897*^9}, {
  3.8257687466477566`*^9, 3.8257687555509386`*^9}},
 CellLabel->"In[10]:=",ExpressionUUID->"f0145306-b514-4698-959f-56afc2c1f5c4"],

Cell[BoxData[
 RowBox[{
  RowBox[{"feasibilitytest", " ", "=", 
   RowBox[{
    RowBox[{"Or", "@@", " ", 
     RowBox[{"duplicatesQ", "/@", 
      RowBox[{"Transpose", "@", 
       RowBox[{"(", 
        RowBox[{"First", "/@", 
         RowBox[{"Transpose", "/@", "#"}]}], ")"}]}]}]}], "&"}]}], 
  ";"}]], "Input",
 CellLabel->"In[11]:=",ExpressionUUID->"b74b620b-b7c7-465e-a54e-5973dd1f6382"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"The", " ", "function"}], "*)"}]], "Input",
 CellChangeTimes->{{3.8257689564147863`*^9, 3.8257689603724966`*^9}},
 CellLabel->"In[12]:=",ExpressionUUID->"821256e4-99e2-4841-92af-b6ef121b38a3"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Module", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
    "exp", ",", "ag", ",", "sq", ",", "ch", ",", "connections", ",", 
     "momenta", ",", "candidatecontractions", ",", "chains"}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"exp", "=", 
     RowBox[{"test", "//", "Echo"}]}], ";", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{
      "Gather", " ", "by", " ", "angle", " ", "and", " ", "square", " ", 
       "head"}], ",", " ", 
      RowBox[{
      "chains", " ", "are", " ", "converted", " ", "into", " ", "angles", " ",
        "and", " ", "squares", " ", "and", " ", "in", " ", "case", " ", 
       "mixed", " ", "chains", " ", "are", " ", "found", " ", "an", " ", 
       "appropriate", " ", "connection", " ", "is", " ", 
       RowBox[{"added", ".", " ", "We"}], " ", "take", " ", "care", " ", "of",
        " ", "chains", " ", "later", " ", "on"}]}], "*)"}], 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{
      "Angle", " ", "and", " ", "square", " ", "chains", " ", "are", " ", 
       "no", " ", "problem"}], ",", " ", 
      RowBox[{
      "the", " ", "only", " ", "troublesome", " ", "are", " ", "the", " ", 
       "mixed", " ", "chains"}], ",", " ", 
      RowBox[{"these", " ", "are", " ", "kept", " ", "separate"}]}], "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", "Chain", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"Chain", "[", 
         RowBox[{"$angle", ",", "x_", ",", "y_", ",", "z_", ",", "$angle"}], 
         "]"}], ":=", 
        RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{"x", ",", "y", ",", "z"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Chain", "[", 
         RowBox[{"$square", ",", "x_", ",", "y_", ",", "z_", ",", "$square"}],
          "]"}], ":=", 
        RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{"x", ",", "y", ",", "z"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"ag", ",", "sq", ",", "ch"}], "}"}], "=", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Flatten", "[", 
              RowBox[{"#", ",", "1"}], "]"}], "&"}], "/@", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Select", "[", 
               RowBox[{"#", ",", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Head", "@", 
                    RowBox[{"First", "@", "#"}]}], "===", 
                   "SpinorAngleBracket"}], "&"}], ")"}]}], "]"}], ",", 
              RowBox[{"Select", "[", 
               RowBox[{"#", ",", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Head", "@", 
                    RowBox[{"First", "@", "#"}]}], "===", 
                   "SpinorSquareBracket"}], "&"}], ")"}]}], "]"}], ",", 
              RowBox[{"Select", "[", 
               RowBox[{"#", ",", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Head", "@", 
                    RowBox[{"First", "@", "#"}]}], "===", "Chain"}], "&"}], 
                 ")"}]}], "]"}]}], "}"}]}], "&"}], "@", 
          RowBox[{"GatherBy", "[", 
           RowBox[{"exp", ",", "Head"}], "]"}]}], "//", "Echo"}]}], ";"}]}], 
     "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
     "STILL", " ", "NEED", " ", "TO", " ", "TAKE", " ", "CARE", " ", "OF", 
      " ", "MIXED", " ", "CHAINS"}], "*)"}], "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
     "Find", " ", "the", " ", "momenta", " ", "and", " ", "their", " ", 
      "number"}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"SpinorAngleBracket", ",", "SpinorSquareBracket"}], "}"}], ",",
       "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{"x_", ",", "y_", ",", "z_"}], "]"}], ":=", 
        RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{"x", ",", "z"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{"x_", ",", "y_", ",", "z_"}], "]"}], ":=", 
        RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{"x", ",", "z"}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "These", " ", "are", " ", "the", " ", "momenta", " ", "and", " ", 
          "their", " ", 
          RowBox[{"multiplicities", ".", " ", "They"}], " ", "are", " ", 
          "found", " ", "by", " ", "extracting", " ", "all", " ", "the", " ", 
          "labels", " ", "from", " ", "the", " ", "brackest"}], ",", " ", 
         RowBox[{
         "then", " ", "counting", " ", "the", " ", "labels", " ", "and", " ", 
          "looking", " ", "at", " ", "those", " ", "which", " ", "appear", 
          " ", "both", " ", "as", " ", "angle", " ", "and", " ", 
          RowBox[{"squares", ".", " ", "Then"}], " ", "we", " ", "take", " ", 
          "the", " ", "minimum", " ", "between", " ", "the", " ", "angle", 
          " ", "and", " ", "square", " ", "appearences"}], ",", " ", 
         RowBox[{
         "the", " ", "mismatch", " ", "gives", " ", "the", " ", "helicity", 
          " ", "weight", " ", "which", " ", "we", " ", "do", " ", "not", " ", 
          "need", " ", "right", " ", "now"}], ",", " ", 
         RowBox[{
         "the", " ", "rest", " ", "is", " ", "the", " ", "number", " ", "of", 
          " ", "momenta", " ", "which", " ", "can", " ", "be", " ", 
          RowBox[{"formed", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"momenta", "=", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"First", "@", "#1"}], ",", 
                    RowBox[{"Min", "@", "#2"}]}], "}"}], "&"}], "@@@", 
                  RowBox[{"Transpose", "/@", 
                   RowBox[{"Echo", "[", 
                    RowBox[{"#", ",", "\"\<momenta2\>\""}], "]"}]}]}], "&"}], 
                "@", 
                RowBox[{"First", "@", 
                 RowBox[{"Select", "[", 
                  RowBox[{"#", ",", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "@", 
                    RowBox[{"First", "@", "#"}]}], "\[Equal]", "2"}], "&"}], 
                    ")"}]}], "]"}]}]}], "&"}], "@", 
              RowBox[{"Echo", "@", 
               RowBox[{"GatherBy", "[", 
                RowBox[{"#", ",", "Length"}], "]"}]}]}], "&"}], "@", 
            RowBox[{"Echo", "[", 
             RowBox[{"#", ",", "\"\<momenta1\>\""}], "]"}]}], "&"}], "@", 
          RowBox[{"GatherBy", "[", 
           RowBox[{
            RowBox[{"Join", "@@", 
             RowBox[{"Tally", "/@", 
              RowBox[{"Flatten", "/@", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"List", "@@@", "ag"}], ",", 
                 RowBox[{"List", "@@@", "sq"}]}], "}"}]}]}]}], ",", "First"}],
            "]"}]}], "//", 
         RowBox[{
          RowBox[{"Echo", "[", 
           RowBox[{"#", ",", "\"\<momenta3\>\""}], "]"}], "&"}]}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Extract", " ", "the", " ", "positions", " ", "of", " ", "the", " ", 
         "brackets", " ", "containg", " ", "each", " ", "momentum", " ", 
         "and", " ", "then", " ", "pair", " ", "them"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"candidatecontractions", "=", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"#", ",", "1"}], "]"}], "&"}], "/@", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"Outer", "[", 
              RowBox[{"List", ",", "#1", ",", "#2", ",", "1"}], "]"}], "&"}], 
            "@@@", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Position", "[", 
                  RowBox[{"ag", ",", "#"}], "]"}], ",", 
                 RowBox[{"Position", "[", 
                  RowBox[{"sq", ",", "#"}], "]"}]}], "}"}], "&"}], "/@", 
              RowBox[{"First", "@", 
               RowBox[{"Transpose", "@", "momenta"}]}]}], ")"}]}], ")"}]}], "//", 
         RowBox[{
          RowBox[{"Echo", "[", 
           RowBox[{"#", ",", "\"\<candidates\>\""}], "]"}], "&"}]}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Out", " ", "of", " ", "the", " ", "candidatecontractions", " ", "I", 
         " ", "have", " ", "to", " ", "select", " ", "subsets", " ", "with", 
         " ", "number", " ", "of", " ", "elements", " ", "given", " ", "by", 
         " ", "the", " ", "multiplicity", " ", "of", " ", "the", " ", "given",
          " ", "momentum", " ", "and", " ", "then", " ", "apply", " ", "a", 
         " ", "feasibility", " ", 
         RowBox[{"check", ":", " ", 
          RowBox[{
          "every", " ", "bracket", " ", "can", " ", "only", " ", "appear", 
           " ", "once", " ", "per", " ", 
           RowBox[{"momentum", "."}]}]}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"chains", "=", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Subsets", "[", 
            RowBox[{"#1", ",", 
             RowBox[{"{", "#2", "}"}]}], "]"}], "&"}], "@@@", 
          RowBox[{"Transpose", "@", 
           RowBox[{"{", 
            RowBox[{"candidatecontractions", ",", 
             RowBox[{"Last", "@", 
              RowBox[{"Transpose", "@", "momenta"}]}]}], "}"}]}]}], "//", 
         RowBox[{
          RowBox[{"Echo", "[", 
           RowBox[{"#", ",", "\"\<subsets\>\""}], "]"}], "&"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Apply", " ", 
         RowBox[{"check", ":"}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"chains", "=", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"DeleteCases", "[", 
            RowBox[{"#", ",", "feasibilitytest"}], "]"}], "&"}], "/@", 
          "chains"}], "//", 
         RowBox[{
          RowBox[{"Echo", "[", 
           RowBox[{"#", ",", "\"\<checked\>\""}], "]"}], "&"}]}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Out", " ", "of", " ", "these", " ", "we", " ", "need", " ", "to", 
         " ", "take", " ", "all", " ", "possible", " ", 
         RowBox[{"combinations", "."}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"chains", "=", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"#", ",", "1"}], "]"}], "&"}], "/@", 
          RowBox[{"Tuples", "@", "chains"}]}], "//", 
         RowBox[{
          RowBox[{"Echo", "[", 
           RowBox[{"#", ",", "\"\<chains flattened\>\""}], "]"}], "&"}]}]}], 
       ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
     "Reoreder", " ", "list", " ", "such", " ", "that", " ", "the", " ", 
      "structure", " ", "of", " ", "contracted", " ", "chains", " ", "is", 
      " ", "visible"}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{"chains", "=", 
     RowBox[{
      RowBox[{"Apply", "[", 
       RowBox[{"chorder", ",", 
        RowBox[{
         RowBox[{
          RowBox[{"Echo", "@", 
           RowBox[{"GatherBy", "[", 
            RowBox[{"#", ",", 
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", 
                RowBox[{"2", ",", "1"}], "]"}], "]"}], "&"}]}], "]"}]}], 
          "&"}], "/@", "chains"}], ",", 
        RowBox[{"{", "2", "}"}]}], "]"}], "//", 
      RowBox[{
       RowBox[{"Echo", "[", 
        RowBox[{"#", ",", "\"\<gathered\>\""}], "]"}], "&"}]}]}], ";"}]}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "Next", " ", "convert", " ", "to", " ", "chains", " ", "the", " ", 
    "single", " ", "parts"}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellChangeTimes->{{3.8257633957912083`*^9, 3.8257634072963395`*^9}, {
   3.825763442862852*^9, 3.825763446351156*^9}, {3.825763486450094*^9, 
   3.8257635122415795`*^9}, {3.825763545946443*^9, 3.8257635531560407`*^9}, {
   3.825763672555443*^9, 3.8257638105948033`*^9}, {3.8257640810355697`*^9, 
   3.8257641464532704`*^9}, {3.82576418876536*^9, 3.825764215337344*^9}, {
   3.8257644483513255`*^9, 3.8257645586709557`*^9}, {3.8257646282616673`*^9, 
   3.825764693162859*^9}, {3.825764749745613*^9, 3.82576493781892*^9}, {
   3.825764997654073*^9, 3.8257650023714886`*^9}, {3.8257651501945305`*^9, 
   3.8257652667679486`*^9}, {3.825765304994318*^9, 3.8257653190431633`*^9}, {
   3.8257653508255634`*^9, 3.825765353233629*^9}, {3.8257655451785936`*^9, 
   3.8257655915084543`*^9}, {3.8257656322962666`*^9, 
   3.8257657563802586`*^9}, {3.825766025982182*^9, 3.8257660365339117`*^9}, {
   3.8257661451371183`*^9, 3.825766286607415*^9}, {3.825766444878257*^9, 
   3.82576644511648*^9}, {3.825766497546246*^9, 3.825766503200699*^9}, {
   3.825766554867244*^9, 3.825766555004475*^9}, {3.825766594525688*^9, 
   3.8257666108283033`*^9}, {3.825766742074042*^9, 3.8257667822709713`*^9}, {
   3.8257668459360886`*^9, 3.8257669069201145`*^9}, {3.8257672166526003`*^9, 
   3.8257673544507656`*^9}, 3.8257674843213873`*^9, {3.8257675192376137`*^9, 
   3.825767607078309*^9}, {3.825767678174508*^9, 3.8257677014093294`*^9}, {
   3.8257677388576*^9, 3.825767756847411*^9}, {3.825768519654298*^9, 
   3.8257685612169685`*^9}, {3.8257685928356175`*^9, 
   3.8257685952883987`*^9}, {3.825768632327431*^9, 3.825768646643256*^9}, {
   3.825768971151866*^9, 3.825769002936179*^9}, {3.825769062075291*^9, 
   3.8257690942332215`*^9}, {3.82576916178439*^9, 3.8257691797055006`*^9}, {
   3.8257692187511683`*^9, 3.825769218946212*^9}, {3.8257693469402475`*^9, 
   3.8257693662467365`*^9}, 3.825769396762868*^9, 3.825769557182871*^9, {
   3.8257702302108583`*^9, 3.825770274562928*^9}, {3.8257703349656343`*^9, 
   3.8257704469528246`*^9}, {3.826002688040179*^9, 3.8260026975647497`*^9}, 
   3.8260027776355925`*^9, {3.826002815314828*^9, 3.826002848445173*^9}, {
   3.8260029316801357`*^9, 3.8260029524275894`*^9}, {3.826003047244032*^9, 
   3.826003117895957*^9}, {3.826003152626075*^9, 3.826003157795253*^9}, 
   3.8260044063048105`*^9, {3.82600449235362*^9, 3.8260045212773123`*^9}, {
   3.8260045551756516`*^9, 3.826004578331665*^9}, {3.826005677693948*^9, 
   3.8260057003972406`*^9}, {3.8260067164563046`*^9, 3.826006797051367*^9}, {
   3.8260068870818424`*^9, 3.8260069150071464`*^9}, {3.8260074604606285`*^9, 
   3.8260074938034487`*^9}, {3.8260126681374197`*^9, 3.826012672379222*^9}, {
   3.8260127137335997`*^9, 3.8260127139580154`*^9}, {3.826013333525933*^9, 
   3.82601333584968*^9}, {3.8260193852957973`*^9, 3.8260193954725823`*^9}, {
   3.826022689071634*^9, 3.8260226894905167`*^9}, {3.826022781298962*^9, 
   3.8260227887769585`*^9}, {3.826022841303457*^9, 3.8260228786455946`*^9}, {
   3.8260229652728443`*^9, 3.8260229672845087`*^9}, {3.826022999095434*^9, 
   3.826023124027236*^9}, {3.826024460490654*^9, 3.8260244607140465`*^9}, 
   3.8260250563703103`*^9},
 CellLabel->"In[13]:=",ExpressionUUID->"a21a3d0d-9bd5-49c3-9267-621f0f12747d"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   TemplateBox[{"1", "2"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"5", "6"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"3", "4"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"1", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"2", "3"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"2", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.8260825472336087`*^9},ExpressionUUID->"bbbfaeef-6e9e-4c36-a67d-\
11d3591e1ed2"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "2"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"5", "6"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"3", "4"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "4"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"2", "3"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"2", "4"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.826082547341324*^9},ExpressionUUID->"02de7fc0-ff3e-4c09-9837-\
b9e1ebe324c8"],

Cell[BoxData[
 RowBox[{
  TagBox["\<\"momenta1\"\>",
   "EchoLabel"], "  ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"1", ",", "1"}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"2", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{"5", ",", "1"}], "}"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{"6", ",", "1"}], "}"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"3", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"3", ",", "1"}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"4", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"4", ",", "2"}], "}"}]}], "}"}]}], "}"}]}]], "Echo",
 CellChangeTimes->{
  3.8260825474221277`*^9},ExpressionUUID->"24ff5344-4a6a-4d59-86ee-\
109df420a356"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"2", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"3", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"4", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"4", ",", "2"}], "}"}]}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{"5", ",", "1"}], "}"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{"6", ",", "1"}], "}"}], "}"}]}], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.8260825475148253`*^9},ExpressionUUID->"3975fd84-b5af-431b-b9e3-\
19799bca0d60"],

Cell[BoxData[
 RowBox[{
  TagBox["\<\"momenta2\"\>",
   "EchoLabel"], "  ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"1", ",", "1"}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"2", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"3", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"3", ",", "1"}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"4", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"4", ",", "2"}], "}"}]}], "}"}]}], "}"}]}]], "Echo",
 CellChangeTimes->{
  3.8260825475926175`*^9},ExpressionUUID->"62749d3c-ed29-4e85-8b1e-\
55ea3be9e9de"],

Cell[BoxData[
 RowBox[{
  TagBox["\<\"momenta3\"\>",
   "EchoLabel"], "  ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"1", ",", "1"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"2", ",", "1"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"3", ",", "1"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"4", ",", "1"}], "}"}]}], "}"}]}]], "Echo",
 CellChangeTimes->{
  3.826082547665454*^9},ExpressionUUID->"9bd1be80-fce5-46e2-8906-\
e39fcbfd50f9"],

Cell[BoxData[
 RowBox[{
  TagBox["\<\"candidates\"\>",
   "EchoLabel"], "  ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}]}], "}"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "1"}], "}"}]}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"3", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2"}], "}"}]}], "}"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"3", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "2"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"3", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "2"}], "}"}]}], "}"}]}], "}"}]}], "}"}]}]], "Echo",
 CellChangeTimes->{
  3.826082547743249*^9},ExpressionUUID->"36eeec0a-2b5f-44cc-93cd-\
132023387e24"],

Cell[BoxData[
 RowBox[{
  TagBox["\<\"subsets\"\>",
   "EchoLabel"], "  ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "1"}], "}"}]}], "}"}], "}"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "1"}], "}"}]}], "}"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "1"}], "}"}]}], "}"}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"3", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "2"}], "}"}]}], "}"}], "}"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"3", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "2"}], "}"}]}], "}"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"3", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "2"}], "}"}]}], "}"}], "}"}]}], "}"}]}], 
   "}"}]}]], "Echo",
 CellChangeTimes->{
  3.8260825478270216`*^9},ExpressionUUID->"e2750471-622a-4a26-b4f4-\
2a858898e5d4"],

Cell[BoxData[
 RowBox[{
  TagBox["\<\"checked\"\>",
   "EchoLabel"], "  ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "1"}], "}"}]}], "}"}], "}"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "1"}], "}"}]}], "}"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "1"}], "}"}]}], "}"}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"3", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "2"}], "}"}]}], "}"}], "}"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"3", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "2"}], "}"}]}], "}"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"3", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "2"}], "}"}]}], "}"}], "}"}]}], "}"}]}], 
   "}"}]}]], "Echo",
 CellChangeTimes->{
  3.826082547908805*^9},ExpressionUUID->"1e2ee083-d584-4ec3-b4f9-\
c53a71c3daf8"],

Cell[BoxData[
 RowBox[{
  TagBox["\<\"chains flattened\"\>",
   "EchoLabel"], "  ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "1"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"3", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"3", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "2"}], "}"}]}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "1"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"3", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"3", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "2"}], "}"}]}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "1"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "1"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"3", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"3", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "2"}], "}"}]}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "1"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "1"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"3", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"3", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "2"}], "}"}]}], "}"}]}], "}"}]}], "}"}]}]], "Echo",
 CellChangeTimes->{
  3.8260825479935455`*^9},ExpressionUUID->"2df19dab-8715-4d60-894b-\
39c2898889a6"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"3", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "2"}], "}"}]}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"3", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2"}], "}"}]}], "}"}]}], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.826082548075327*^9},ExpressionUUID->"35e55a37-e71a-40d7-b2b1-\
5e56ef97a374"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"1", ",", "1"}], "}"}]}], "}"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"3", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2"}], "}"}]}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"3", ",", "2"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"3", ",", "2"}], "}"}]}], "}"}], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.826082548156166*^9},ExpressionUUID->"7be4ac81-586a-4c7c-a9d7-\
98aba55e9238"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"3", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "2"}], "}"}]}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "2"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"3", ",", "1"}], "}"}]}], "}"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"3", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"2", ",", "2"}], "}"}]}], "}"}], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.8260825482279496`*^9},ExpressionUUID->"7de44875-aff4-41bc-b02b-\
8155211a765f"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"1", ",", "1"}], "}"}]}], "}"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"3", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "2"}], "}"}]}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"3", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"2", ",", "2"}], "}"}]}], "}"}], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.8260825483057623`*^9},ExpressionUUID->"435426cc-f162-4d9f-8513-\
40914dcdfc63"],

Cell[BoxData[
 RowBox[{
  TagBox["\<\"gathered\"\>",
   "EchoLabel"], "  ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"chorder", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"1", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "1"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"3", ",", "2"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "2"}], "}"}]}], "}"}]}], "]"}], ",", 
      RowBox[{"chorder", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"1", ",", "2"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"3", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "2"}], "}"}]}], "}"}]}], "]"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"chorder", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "1"}], "}"}]}], "}"}], "]"}], ",", 
      RowBox[{"chorder", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"1", ",", "2"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"3", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "2"}], "}"}]}], "}"}]}], "]"}], ",", 
      RowBox[{"chorder", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"3", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "2"}], "}"}]}], "}"}], "]"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"chorder", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"1", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "1"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"3", ",", "2"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "2"}], "}"}]}], "}"}]}], "]"}], ",", 
      RowBox[{"chorder", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "1"}], "}"}]}], "}"}], "]"}], ",", 
      RowBox[{"chorder", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"3", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "2"}], "}"}]}], "}"}], "]"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"chorder", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "1"}], "}"}]}], "}"}], "]"}], ",", 
      RowBox[{"chorder", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"1", ",", "2"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"3", ",", "1"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"3", ",", "2"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"3", ",", "2"}], "}"}]}], "}"}]}], "]"}], ",", 
      RowBox[{"chorder", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"3", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "2"}], "}"}]}], "}"}], "]"}]}], "}"}]}], 
   "}"}]}]], "Echo",
 CellChangeTimes->{
  3.826082548383501*^9},ExpressionUUID->"22a31e8d-5474-42f2-8815-\
b1ec20b28d9e"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"%", "//", "Length"}]], "Input",
 CellChangeTimes->{{3.825769371198123*^9, 3.8257693738103685`*^9}},
 CellLabel->
  "In[145]:=",ExpressionUUID->"ff667d10-61ed-41b3-9733-c268739ee965"],

Cell[BoxData["4"], "Output",
 CellChangeTimes->{3.825769374142414*^9, 3.825770281160123*^9},
 CellLabel->
  "Out[145]=",ExpressionUUID->"85051ad9-a91e-457e-a92a-d2a577c1d136"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Flatten", "@", 
  RowBox[{"Map", "[", 
   RowBox[{"chorder", ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "1"}], "}"}]}], "}"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "1"}], "}"}]}], "}"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"3", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "2"}], "}"}]}], "}"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"3", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "2"}], "}"}]}], "}"}], "}"}]}], "}"}], ",", 
    RowBox[{"{", "2", "}"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.825770486697937*^9, 3.8257705467595925`*^9}, {
  3.825770591744958*^9, 3.8257706562134714`*^9}},
 CellLabel->
  "In[157]:=",ExpressionUUID->"9151977c-cb43-491f-b539-f61de64f6276"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"chorder", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"1", ",", "1"}], "}"}]}], "}"}], "]"}], ",", 
   RowBox[{"chorder", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "2"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"2", ",", "1"}], "}"}]}], "}"}], "]"}], ",", 
   RowBox[{"chorder", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"3", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"2", ",", "2"}], "}"}]}], "}"}], "]"}], ",", 
   RowBox[{"chorder", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"3", ",", "2"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"1", ",", "2"}], "}"}]}], "}"}], "]"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.825770490439049*^9, {3.8257705364442315`*^9, 3.825770547255804*^9}, {
   3.8257705924138503`*^9, 3.825770656684388*^9}},
 CellLabel->
  "Out[157]=",ExpressionUUID->"a600b45b-1853-4c07-87f2-202b4d369de5"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"Flatten", "[", 
  RowBox[{
   RowBox[{"Flatten", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"1", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "1"}], "}"}]}], "}"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"1", ",", "2"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "1"}], "}"}]}], "}"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"3", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "2"}], "}"}]}], "}"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"3", ",", "2"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "2"}], "}"}]}], "}"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", "2", "}"}]}], "]"}], ",", "1"}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"SortBy", "[", 
  RowBox[{"%", ",", 
   RowBox[{"Apply", "[", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"#1", "[", 
         RowBox[{"[", 
          RowBox[{"2", ",", "1"}], "]"}], "]"}], "==", 
        RowBox[{"#2", "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "1"}], "]"}], "]"}]}], "&"}], ")"}], ",", "2"}], 
    "]"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.825771074788083*^9, 3.825771167478261*^9}, {
  3.8257712108172674`*^9, 3.8257712477421093`*^9}, {3.8257715953958836`*^9, 
  3.825771603786815*^9}, {3.825771662569083*^9, 3.8257717311112804`*^9}, {
  3.8257717832376885`*^9, 
  3.825771850665353*^9}},ExpressionUUID->"6a47fcdf-26f3-468a-a677-\
2302a92d38bb"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "1"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "1"}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"3", ",", "1"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"3", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "2"}], "}"}]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.8257710781834025`*^9, 3.8257711677761173`*^9}, {
   3.8257712140404816`*^9, 3.8257712481311054`*^9}, 3.825771604387789*^9, 
   3.825771696877592*^9, {3.8257718188787317`*^9, 3.8257718463356504`*^9}},
 CellLabel->
  "Out[175]=",ExpressionUUID->"db74fdb2-424c-4783-b13c-3b42c766908c"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "1"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "1"}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"3", ",", "1"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"3", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "2"}], "}"}]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.8257710781834025`*^9, 3.8257711677761173`*^9}, {
   3.8257712140404816`*^9, 3.8257712481311054`*^9}, 3.825771604387789*^9, 
   3.825771696877592*^9, {3.8257718188787317`*^9, 3.8257718463575597`*^9}},
 CellLabel->
  "Out[176]=",ExpressionUUID->"c8816a38-50af-4888-a047-17d8302b8105"]
}, Open  ]],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.825771615433422*^9, 3.8257716171626596`*^9}, {
  3.8257716586687284`*^9, 
  3.825771661059161*^9}},ExpressionUUID->"a3864c98-b3a4-46c1-8587-\
ccb5219f8e12"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"Flatten", "[", 
  RowBox[{
   RowBox[{"Flatten", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"1", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "1"}], "}"}]}], "}"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"1", ",", "2"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "1"}], "}"}]}], "}"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"3", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "2"}], "}"}]}], "}"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"3", ",", "2"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "2"}], "}"}]}], "}"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", "2", "}"}]}], "]"}], ",", "1"}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"Sort", "[", 
  RowBox[{"%", ",", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{"#2", "[", 
       RowBox[{"[", 
        RowBox[{"1", ",", "1"}], "]"}], "]"}], "==", 
      RowBox[{"#1", "[", 
       RowBox[{"[", 
        RowBox[{"2", ",", "1"}], "]"}], "]"}]}], "&"}], ")"}]}], 
  "]"}]}], "Input",
 CellChangeTimes->{{3.8257719864605966`*^9, 3.825772012144107*^9}, {
  3.82577214263914*^9, 3.8257721585879602`*^9}, {3.8257722692682467`*^9, 
  3.8257722791436415`*^9}, {3.825772372453107*^9, 3.825772380190401*^9}},
 CellLabel->
  "In[192]:=",ExpressionUUID->"15c21077-cb16-4408-b63b-2eb2775c1046"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "1"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "1"}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"3", ",", "1"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"3", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "2"}], "}"}]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.825771991760956*^9, 3.8257720129626155`*^9}, {
   3.825772145402423*^9, 3.8257721596347694`*^9}, 3.8257722798398595`*^9, {
   3.8257723732207985`*^9, 3.82577238072169*^9}},
 CellLabel->
  "Out[192]=",ExpressionUUID->"7c6b41ff-812c-4d95-bf9f-227d97345679"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"3", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "2"}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"3", ",", "1"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "1"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "1"}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"2", ",", "1"}], "}"}]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.825771991760956*^9, 3.8257720129626155`*^9}, {
   3.825772145402423*^9, 3.8257721596347694`*^9}, 3.8257722798398595`*^9, {
   3.8257723732207985`*^9, 3.8257723807327037`*^9}},
 CellLabel->
  "Out[193]=",ExpressionUUID->"0a2d596a-67e4-4d3c-8a4f-aa9876a1d7de"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Sort", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"1", ",", "3", ",", "4", ",", "2", ",", "1"}], "}"}], ",", 
   RowBox[{
    RowBox[{"#2", "\[Equal]", "#1"}], "&"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.8257722895447664`*^9, 3.8257723100992723`*^9}},
 CellLabel->
  "In[189]:=",ExpressionUUID->"5c502dee-2905-44a4-b345-588944af9c4a"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"3", ",", "1", ",", "1", ",", "2", ",", "4"}], "}"}]], "Output",
 CellChangeTimes->{3.8257723105413265`*^9},
 CellLabel->
  "Out[189]=",ExpressionUUID->"88955751-eceb-419a-aa70-03a59ed61a93"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
   "THERE", " ", "MUST", " ", "BE", " ", "A", " ", "WAY", " ", "OF", " ", 
    "SORTING", " ", "THROUGH", " ", "SORT"}], "..."}], "*)"}]], "Input",
 CellChangeTimes->{{3.82577240176153*^9, 
  3.825772423262288*^9}},ExpressionUUID->"342da5c9-82c2-450b-8e17-\
895f96ed8406"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "REMEMBER", " ", "THAT", " ", "YOU", " ", "STILL", " ", "HAVE", " ", "TO", 
   " ", "TAKE", " ", "INTO", " ", "ACCOUNT", " ", "MIXED", " ", 
   RowBox[{"CHAINS", ".", " ", "ALSO"}], " ", "IT", " ", "MIGHT", " ", "BE", 
   " ", "GOOD", " ", "TO", " ", "FIND", " ", "A", " ", "WAY", " ", "OF", " ", 
   "AVOIDING", " ", "REDUNDANCIES", " ", "WHEN", " ", "POWERS", " ", "ARE", 
   " ", "PRESENT"}], "*)"}]], "Input",
 CellChangeTimes->{{3.825772424529853*^9, 
  3.8257724595895395`*^9}},ExpressionUUID->"e3b5d3ef-7bac-42f6-bdcd-\
9a145c15d1ec"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"GatherBy", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"3", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"3", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "2"}], "}"}]}], "}"}]}], "}"}], ",", 
   RowBox[{
    RowBox[{"#", "[", 
     RowBox[{"[", 
      RowBox[{"1", ",", "1"}], "]"}], "]"}], "&"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.826003755046545*^9, 3.826003787239187*^9}, {
  3.826003824676614*^9, 3.8260038874806123`*^9}, {3.8260039192436867`*^9, 
  3.826003955788731*^9}, {3.8260039926939754`*^9, 3.826004037986882*^9}, {
  3.8260041374468727`*^9, 3.826004146591362*^9}},
 CellLabel->"In[39]:=",ExpressionUUID->"517a29ba-ac55-4fa6-a375-d08159f6986c"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "1"}], "}"}]}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"3", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"3", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "2"}], "}"}]}], "}"}]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.8260037877079287`*^9, {3.8260038317217417`*^9, 3.8260038878486614`*^9}, {
   3.82600392152337*^9, 3.8260039281107464`*^9}, 3.8260039962704487`*^9, {
   3.8260041380362425`*^9, 3.826004147148909*^9}},
 CellLabel->"Out[39]=",ExpressionUUID->"171eb547-8b1b-48d0-aa76-792fd7c58287"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Chainorder", "Subsubsection",
 CellChangeTimes->{{3.8260125555951595`*^9, 
  3.826012557581846*^9}},ExpressionUUID->"a7c43109-42e9-496c-bf56-\
a0f846fd36a5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "We", " ", "assume", " ", "everything", " ", "to", " ", "be", " ", 
    "already", " ", "paired", " ", "up", " ", "by", " ", "contracted", " ", 
    "angle", " ", 
    RowBox[{"brackets", ".", " ", "Further"}], " ", "connect", " ", "by", " ",
     "contracted", " ", "angles"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"chorder", " ", "/:", " ", 
     RowBox[{"List", "[", 
      RowBox[{"x1___", ",", 
       RowBox[{"chorder", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i1_", ",", "j1_"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i2_", ",", "j2_"}], "}"}]}], "}"}], ",", "y1___"}], 
        "]"}], ",", "x2___", ",", 
       RowBox[{"chorder", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i1_", ",", "j3_"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i4_", ",", "j4_"}], "}"}]}], "}"}], ",", "y2___"}], 
        "]"}], ",", "x3___"}], "]"}], ":=", 
     RowBox[{"List", "[", 
      RowBox[{"x1", ",", "x2", ",", "x3", ",", 
       RowBox[{"chorder", "[", 
        RowBox[{
         RowBox[{"Sequence", "@@", 
          RowBox[{"Reverse", "[", 
           RowBox[{"{", "y2", "}"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i1", ",", "j3"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i4", ",", "j4"}], "}"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i1", ",", "j1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i2", ",", "j2"}], "}"}]}], "}"}], ",", "y1"}], "]"}]}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"chorder", " ", "/:", " ", 
     RowBox[{"List", "[", 
      RowBox[{"x1___", ",", 
       RowBox[{"chorder", "[", 
        RowBox[{"y1___", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i1_", ",", "j1_"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i2_", ",", "j2_"}], "}"}]}], "}"}]}], "]"}], ",", 
       "x2___", ",", 
       RowBox[{"chorder", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i1_", ",", "j3_"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i4_", ",", "j4_"}], "}"}]}], "}"}], ",", "y2___"}], 
        "]"}], ",", "x3___"}], "]"}], ":=", 
     RowBox[{"List", "[", 
      RowBox[{"x1", ",", "x2", ",", "x3", ",", 
       RowBox[{"chorder", "[", 
        RowBox[{"y1", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i1", ",", "j1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i2", ",", "j2"}], "}"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i1", ",", "j3"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i4", ",", "j4"}], "}"}]}], "}"}], ",", "y2"}], "]"}]}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"chorder", " ", "/:", " ", 
     RowBox[{"List", "[", 
      RowBox[{"x1___", ",", 
       RowBox[{"chorder", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i1_", ",", "j3_"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i4_", ",", "j4_"}], "}"}]}], "}"}], ",", "y2___"}], 
        "]"}], ",", "x2___", ",", 
       RowBox[{"chorder", "[", 
        RowBox[{"y1___", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i1_", ",", "j1_"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i2_", ",", "j2_"}], "}"}]}], "}"}]}], "]"}], ",", 
       "x3___"}], "]"}], ":=", 
     RowBox[{"List", "[", 
      RowBox[{"x1", ",", "x2", ",", "x3", ",", 
       RowBox[{"chorder", "[", 
        RowBox[{"y1", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i1", ",", "j1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i2", ",", "j2"}], "}"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i1", ",", "j3"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i4", ",", "j4"}], "}"}]}], "}"}], ",", "y2"}], "]"}]}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"chorder", " ", "/:", " ", 
     RowBox[{"List", "[", 
      RowBox[{"x1___", ",", 
       RowBox[{"chorder", "[", 
        RowBox[{"y1___", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i1_", ",", "j1_"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i2_", ",", "j2_"}], "}"}]}], "}"}]}], "]"}], ",", 
       "x2___", ",", 
       RowBox[{"chorder", "[", 
        RowBox[{"y2___", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i1_", ",", "j3_"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i4_", ",", "j4_"}], "}"}]}], "}"}]}], "]"}], ",", 
       "x3___"}], "]"}], ":=", 
     RowBox[{"List", "[", 
      RowBox[{"x1", ",", "x2", ",", "x3", ",", 
       RowBox[{"chorder", "[", 
        RowBox[{"y1", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i1", ",", "j1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i2", ",", "j2"}], "}"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i1", ",", "j3"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i4", ",", "j4"}], "}"}]}], "}"}], ",", 
         RowBox[{"Sequence", "@@", 
          RowBox[{"Reverse", "[", 
           RowBox[{"{", "y2", "}"}], "]"}]}]}], "]"}]}], "]"}]}], 
    ";"}]}]}]], "Input",
 CellChangeTimes->{{3.8260070499276323`*^9, 3.826007167214939*^9}, {
   3.8260072010095673`*^9, 3.826007391987771*^9}, 3.8260129796303873`*^9},
 CellLabel->"In[14]:=",ExpressionUUID->"38dc32b6-3ac9-4ab2-a744-d8c132ec655e"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Chainbuilder", "Subsubsection",
 CellChangeTimes->{{3.8260125598777037`*^9, 3.826012562792856*^9}, {
  3.826023629186164*^9, 3.82602363001096*^9}, {3.826024373973124*^9, 
  3.8260243741955414`*^9}},ExpressionUUID->"933b4225-2f3c-42b9-9e79-\
ea24c328882e"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "This", " ", "\"\<function\>\"", " ", "converts", " ", "lists", " ", "of", 
   " ", "brackets", " ", "into", " ", "a", " ", 
   RowBox[{"chain", ".", " ", "Needs"}], " ", "to", " ", "be", " ", 
   "embedded", " ", "in", " ", "previous", " ", "code"}], "*)"}]], "Input",
 CellChangeTimes->{{3.826012565846687*^9, 
  3.826012605428874*^9}},ExpressionUUID->"5e5a19e5-5af1-4768-94d8-\
b9810f7972ed"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "We", " ", "assume", " ", "traces", " ", "have", " ", "been", " ", 
   "converted", " ", "from", " ", "even", " ", "to", " ", "odd", " ", 
   "number", " ", "of", " ", "contractions"}], "*)"}]], "Input",
 CellChangeTimes->{{3.8260129539481306`*^9, 
  3.8260129736095467`*^9}},ExpressionUUID->"b8a0a99c-3972-4141-9b26-\
3998adc288d3"],

Cell[BoxData[
 RowBox[{"Clear", "[", 
  RowBox[{"ChainBuilder", ",", "auxChainBuilder"}], "]"}]], "Input",
 CellChangeTimes->{{3.8260232383335066`*^9, 3.826023245855423*^9}},
 CellLabel->"In[18]:=",ExpressionUUID->"1e78ad1e-828a-4f7a-9e41-b42123c9991a"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"Single", " ", 
    RowBox[{"chain", ".", " ", "I"}], " ", 
    RowBox[{"think", "/", "hope"}], " ", "that", " ", "the", " ", "use", " ", 
    "of", " ", "a", " ", "Length", " ", "test", " ", "intesad", " ", "of", 
    " ", "a", " ", "direct", " ", "pattern", " ", "matching", " ", "increses",
     " ", "speed"}], ",", " ", 
   RowBox[{
   "this", " ", "is", " ", "the", " ", "reason", " ", "why", " ", 
    "introduced", " ", "an", " ", "auxiliary", " ", "function"}]}], 
  "*)"}]], "Input",
 CellChangeTimes->{{3.8260182069100523`*^9, 3.826018212246825*^9}, {
  3.826018632840867*^9, 3.826018633518033*^9}, {3.826018892912298*^9, 
  3.826018926300989*^9}},ExpressionUUID->"26fd9663-70dc-452c-909b-\
941953bba6cb"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ChainBuilder", "[", 
    RowBox[{"exp_List", ",", "ag_List", ",", "sq_List"}], "]"}], "/;", 
   RowBox[{
    RowBox[{"Length", "@", "exp"}], "===", "1"}]}], ":=", 
  RowBox[{"Flatten", "[", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"auxChainBuilder", "[", 
      RowBox[{"exp", ",", "ag", ",", "sq"}], "]"}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Part", "[", 
              RowBox[{"ag", ",", "#"}], "]"}], "&"}], "/@", "#1"}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"Part", "[", 
              RowBox[{"sq", ",", "#"}], "]"}], "&"}], "/@", "#2"}]}], "}"}], 
         "&"}], "@@", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Complement", "[", 
           RowBox[{
            RowBox[{"Range", "@", 
             RowBox[{"Length", "@", "ag"}]}], ",", "#1"}], "]"}], ",", 
          RowBox[{"Complement", "[", 
           RowBox[{
            RowBox[{"Range", "@", 
             RowBox[{"Length", "@", "sq"}]}], ",", "#2"}], "]"}]}], "}"}]}], 
       "&"}], "@@", 
      RowBox[{"Map", "[", 
       RowBox[{"First", ",", 
        RowBox[{"Transpose", "@", "exp"}], ",", 
        RowBox[{"{", "2", "}"}]}], "]"}]}]}], "}"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.826018635510704*^9, 3.826018708158472*^9}, {
  3.8260188131256943`*^9, 3.8260188488382072`*^9}, {3.8260190708753104`*^9, 
  3.826019085432239*^9}, {3.826019466312961*^9, 3.8260194699841948`*^9}},
 CellLabel->"In[19]:=",ExpressionUUID->"7861e8b5-1ee7-4e4b-a94b-71ea3791e20d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"auxChainBuilder", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"i1_", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"i2_", ",", "1"}], "}"}]}], "}"}], "}"}], ",", "ag_", ",", 
     "sq_"}], "]"}], ":=", 
   RowBox[{"-", 
    RowBox[{"Chain", "[", 
     RowBox[{"$angle", ",", 
      RowBox[{"Last", "@", 
       RowBox[{"ag", "[", 
        RowBox[{"[", "i1", "]"}], "]"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"First", "@", 
        RowBox[{"ag", "[", 
         RowBox[{"[", "i1", "]"}], "]"}]}], "}"}], ",", 
      RowBox[{"Last", "@", 
       RowBox[{"sq", "[", 
        RowBox[{"[", "i2", "]"}], "]"}]}], ",", "$square"}], "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"auxChainBuilder", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"i1_", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"i2_", ",", "2"}], "}"}]}], "}"}], "}"}], ",", "ag_", ",", 
     "sq_"}], "]"}], ":=", 
   RowBox[{"Chain", "[", 
    RowBox[{"$angle", ",", 
     RowBox[{"Last", "@", 
      RowBox[{"ag", "[", 
       RowBox[{"[", "i1", "]"}], "]"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"First", "@", 
       RowBox[{"ag", "[", 
        RowBox[{"[", "i1", "]"}], "]"}]}], "}"}], ",", 
     RowBox[{"First", "@", 
      RowBox[{"sq", "[", 
       RowBox[{"[", "i2", "]"}], "]"}]}], ",", "$square"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"auxChainBuilder", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"i1_", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"i2_", ",", "1"}], "}"}]}], "}"}], "}"}], ",", "ag_", ",", 
     "sq_"}], "]"}], ":=", 
   RowBox[{"Chain", "[", 
    RowBox[{"$angle", ",", 
     RowBox[{"First", "@", 
      RowBox[{"ag", "[", 
       RowBox[{"[", "i1", "]"}], "]"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"Last", "@", 
       RowBox[{"ag", "[", 
        RowBox[{"[", "i1", "]"}], "]"}]}], "}"}], ",", 
     RowBox[{"Last", "@", 
      RowBox[{"sq", "[", 
       RowBox[{"[", "i2", "]"}], "]"}]}], ",", "$square"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"auxChainBuilder", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"i1_", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"i2_", ",", "2"}], "}"}]}], "}"}], "}"}], ",", "ag_", ",", 
     "sq_"}], "]"}], ":=", 
   RowBox[{"-", 
    RowBox[{"Chain", "[", 
     RowBox[{"$angle", ",", 
      RowBox[{"First", "@", 
       RowBox[{"ag", "[", 
        RowBox[{"[", "i1", "]"}], "]"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"Last", "@", 
        RowBox[{"ag", "[", 
         RowBox[{"[", "i1", "]"}], "]"}]}], "}"}], ",", 
      RowBox[{"First", "@", 
       RowBox[{"sq", "[", 
        RowBox[{"[", "i2", "]"}], "]"}]}], ",", "$square"}], "]"}]}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.8260188509674816`*^9, 3.8260188868415856`*^9}, {
  3.8260189307590666`*^9, 3.826019028612403*^9}, {3.8260191014553823`*^9, 
  3.826019176964985*^9}, {3.8260192866326337`*^9, 3.826019375256654*^9}},
 CellLabel->"In[20]:=",ExpressionUUID->"ebe55d40-ac7f-43c6-826c-4e01f894bf35"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"ChainBuilder", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}]}], "}"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      TemplateBox[{"1", "2"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], ",", 
      TemplateBox[{"1", "3"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
    RowBox[{"{", 
     TemplateBox[{"1", "4"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], "}"}]}], "]"}], "//", 
  "RepeatedTiming"}]], "Input",
 CellChangeTimes->{{3.8260194108045216`*^9, 3.8260194314153023`*^9}, {
  3.826023658031014*^9, 3.826023660562191*^9}},
 CellLabel->
  "In[191]:=",ExpressionUUID->"cf237e59-253a-442c-9bfb-e3ac7abd70dd"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.00002129873046875`", ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", 
      TemplateBox[{"2", 
        RowBox[{"{", "1", "}"}], "4"},
       "AngleSquareChain",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
       InterpretationFunction->(
        RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
          "$square", "]"}]& )]}], ",", 
     TemplateBox[{"1", "3"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.8260194327278223`*^9, 3.8260194736783133`*^9, 3.826023250730378*^9, {
   3.826023654176322*^9, 3.826023662300575*^9}, 3.8260241660961123`*^9},
 CellLabel->
  "Out[191]=",ExpressionUUID->"52bc1c0c-b1f0-4205-898f-40cb62264527"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"Even", " ", "angle", " ", "chains"}], "*)"}]], "Input",
 CellChangeTimes->{{3.8260169373704567`*^9, 
  3.826016947848482*^9}},ExpressionUUID->"748865f4-9a49-4768-8521-\
9cd3d8d69897"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ChainBuilder", "[", 
     RowBox[{"exp_List", ",", "ag_List", ",", "sq_List"}], "]"}], "/;", 
    RowBox[{
     RowBox[{"EvenQ", "@", 
      RowBox[{"Length", "@", "exp"}]}], "&&", 
     RowBox[{
      RowBox[{"exp", "[", 
       RowBox[{"[", 
        RowBox[{"1", ",", "2", ",", "1"}], "]"}], "]"}], "===", 
      RowBox[{"exp", "[", 
       RowBox[{"[", 
        RowBox[{"2", ",", "2", ",", "1"}], "]"}], "]"}]}]}]}], ":=", 
   RowBox[{"Flatten", "@", 
    RowBox[{"(", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"-", "1"}], ")"}], "^", 
        RowBox[{"Count", "[", 
         RowBox[{
          RowBox[{"Last", "/@", 
           RowBox[{"Total", "/@", "exp"}]}], ",", 
          RowBox[{"2", "|", "4"}], ",", "2"}], "]"}]}], ",", 
       RowBox[{
        RowBox[{
         RowBox[{"Chain", "[", 
          RowBox[{"$angle", ",", 
           RowBox[{"First", "@", "#"}], ",", 
           RowBox[{"Rest", "@", 
            RowBox[{"Most", "@", "#"}]}], ",", 
           RowBox[{"Last", "@", "#"}], ",", "$angle"}], "]"}], "&"}], "@", 
        RowBox[{"Flatten", "@", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Last", "@", "#"}], "\[Equal]", "1"}], ",", 
                  RowBox[{"Reverse", "@", 
                   RowBox[{"First", "@", "#"}]}], ",", 
                  RowBox[{"First", "@", "#"}]}], "]"}], "&"}], "@", 
               RowBox[{"First", "@", "#"}]}], ",", 
              RowBox[{
               RowBox[{
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Last", "@", "#"}], "\[Equal]", "2"}], ",", 
                  RowBox[{"Reverse", "@", 
                   RowBox[{"First", "@", "#"}]}], ",", 
                  RowBox[{"First", "@", "#"}]}], "]"}], "&"}], "/@", 
               RowBox[{"Rest", "@", "#"}]}]}], "}"}], "&"}], "@", 
           RowBox[{"Transpose", "@", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"Part", "[", 
                    RowBox[{
                    RowBox[{"List", "@@@", "ag"}], ",", "#"}], "]"}], "&"}], "/@",
                   "#1"}], ",", "#2"}], "}"}], "&"}], "@@", 
              RowBox[{"Transpose", "@", 
               RowBox[{"(", 
                RowBox[{"First", "/@", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Length", "@", "exp"}], ">", "2"}], ",", 
                   RowBox[{"Drop", "[", 
                    RowBox[{"exp", ",", 
                    RowBox[{"{", 
                    RowBox[{"3", ",", 
                    RowBox[{"Length", "[", "exp", "]"}], ",", "2"}], "}"}]}], 
                    "]"}], ",", "exp"}], "]"}]}], ")"}]}]}], ")"}]}]}], 
          ")"}]}]}], ",", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"Part", "[", 
                RowBox[{"ag", ",", "#"}], "]"}], "&"}], "/@", "#1"}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"Part", "[", 
                RowBox[{"sq", ",", "#"}], "]"}], "&"}], "/@", "#2"}]}], "}"}],
            "&"}], "@@", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Complement", "[", 
             RowBox[{
              RowBox[{"Range", "@", 
               RowBox[{"Length", "@", "ag"}]}], ",", "#1"}], "]"}], ",", 
            RowBox[{"Complement", "[", 
             RowBox[{
              RowBox[{"Range", "@", 
               RowBox[{"Length", "@", "sq"}]}], ",", "#2"}], "]"}]}], "}"}]}],
          "&"}], "@@", 
        RowBox[{"Map", "[", 
         RowBox[{"First", ",", 
          RowBox[{"Transpose", "@", "exp"}], ",", 
          RowBox[{"{", "2", "}"}]}], "]"}]}]}], "}"}], ")"}]}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.826016932154456*^9, 3.8260170078470078`*^9}, {
  3.826020628678008*^9, 3.8260207116339197`*^9}, {3.826020821819213*^9, 
  3.826020929865259*^9}, {3.826021309850788*^9, 3.826021381351551*^9}, {
  3.826023532817912*^9, 3.826023534340789*^9}, {3.8260240614111233`*^9, 
  3.8260240968463435`*^9}, {3.8260242769406075`*^9, 3.8260242800204268`*^9}, {
  3.8260245262617297`*^9, 3.82602452735382*^9}, {3.826024791651778*^9, 
  3.826024792033706*^9}, {3.8260256495477037`*^9, 3.826025652991495*^9}},
 CellLabel->"In[24]:=",ExpressionUUID->"05ace628-fc58-427c-a025-d42fd6f03892"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ChainBuilder", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"2", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "2"}], "}"}]}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "2"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"3", "4"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    TemplateBox[{"2", "3"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.8260231491361094`*^9, 3.826023172764867*^9}},
 CellLabel->"In[25]:=",ExpressionUUID->"5dad9e7f-02df-451c-ab61-2434c702c1b3"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"1", ",", 
   TemplateBox[{"1", 
     RowBox[{"{", 
       RowBox[{"2", ",", "3"}], "}"}], "4"},
    "AngleAngleChain",
    DisplayFunction->(
     RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle", 
       "]"}]& )]}], "}"}]], "Output",
 CellChangeTimes->{
  3.826023174977999*^9, 3.826023261158498*^9, 3.826023536035254*^9, {
   3.826024100850621*^9, 3.82602411266005*^9}, 3.826024169360345*^9, 
   3.8260243240466533`*^9, 3.8260245301383524`*^9, 3.826024793585606*^9, 
   3.8260825677776613`*^9},
 CellLabel->"Out[25]=",ExpressionUUID->"0ae52211-a964-46a9-8e0f-dfdd4afca944"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"ChainBuilder", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "1"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"2", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "2"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"2", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"3", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "2"}], "}"}]}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      TemplateBox[{"1", "2"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], ",", 
      TemplateBox[{"3", "4"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], ",", 
      TemplateBox[{"5", "6"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      TemplateBox[{"2", "3"},
       "SpinorSquareBracket",
       DisplayFunction->(RowBox[{"[", 
          RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], ",", 
      TemplateBox[{"4", "5"},
       "SpinorSquareBracket",
       DisplayFunction->(RowBox[{"[", 
          RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}], "]"}], "//", 
  "RepeatedTiming"}]], "Input",
 CellChangeTimes->{{3.8260244774223657`*^9, 3.8260245056089306`*^9}, {
  3.826024798927304*^9, 3.826024801302513*^9}},
 CellLabel->"In[26]:=",ExpressionUUID->"f0537cd5-1fe7-42ca-a678-62b17bb190e0"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.000058601025390625`", ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", 
     TemplateBox[{"1", 
       RowBox[{"{", 
         RowBox[{"2", ",", "3", ",", "4", ",", "5"}], "}"}], "6"},
      "AngleAngleChain",
      DisplayFunction->(
       RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
         "$angle", "]"}]& )]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.8260245079526577`*^9, 3.8260245314168987`*^9}, {
   3.8260247944991093`*^9, 3.826024802616987*^9}, 3.82608257042558*^9},
 CellLabel->"Out[26]=",ExpressionUUID->"955d46b2-3ff4-4f2e-8d4d-d793d9317836"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"Even", " ", "square", " ", "chains"}], "*)"}]], "Input",
 CellChangeTimes->{{3.8260169373704567`*^9, 3.826016947848482*^9}, {
   3.826017092506524*^9, 3.8260170932904243`*^9}, {3.8260175219838657`*^9, 
   3.826017565832575*^9}, 
   3.8260241863369937`*^9},ExpressionUUID->"da451f92-a30a-4666-bdbc-\
0b08a9395d6a"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ChainBuilder", "[", 
     RowBox[{"exp_List", ",", "ag_List", ",", "sq_List"}], "]"}], "/;", 
    RowBox[{
     RowBox[{"EvenQ", "@", 
      RowBox[{"Length", "@", "exp"}]}], "&&", 
     RowBox[{
      RowBox[{"exp", "[", 
       RowBox[{"[", 
        RowBox[{"1", ",", "2", ",", "1"}], "]"}], "]"}], "\[NotEqual]", 
      RowBox[{"exp", "[", 
       RowBox[{"[", 
        RowBox[{"2", ",", "2", ",", "1"}], "]"}], "]"}]}]}]}], ":=", 
   RowBox[{"Flatten", "@", 
    RowBox[{"(", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"-", "1"}], ")"}], "^", 
        RowBox[{"Count", "[", 
         RowBox[{
          RowBox[{"Last", "/@", 
           RowBox[{"Total", "/@", "exp"}]}], ",", 
          RowBox[{"2", "|", "4"}], ",", "2"}], "]"}]}], ",", 
       RowBox[{
        RowBox[{
         RowBox[{"Chain", "[", 
          RowBox[{"$square", ",", 
           RowBox[{"First", "@", "#"}], ",", 
           RowBox[{"Rest", "@", 
            RowBox[{"Most", "@", "#"}]}], ",", 
           RowBox[{"Last", "@", "#"}], ",", "$square"}], "]"}], "&"}], "@", 
        RowBox[{"Flatten", "@", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Last", "@", "#"}], "\[Equal]", "1"}], ",", 
                  RowBox[{"Reverse", "@", 
                   RowBox[{"First", "@", "#"}]}], ",", 
                  RowBox[{"First", "@", "#"}]}], "]"}], "&"}], "@", 
               RowBox[{"First", "@", "#"}]}], ",", 
              RowBox[{
               RowBox[{
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Last", "@", "#"}], "\[Equal]", "2"}], ",", 
                  RowBox[{"Reverse", "@", 
                   RowBox[{"First", "@", "#"}]}], ",", 
                  RowBox[{"First", "@", "#"}]}], "]"}], "&"}], "/@", 
               RowBox[{"Rest", "@", "#"}]}]}], "}"}], "&"}], "@", 
           RowBox[{"Transpose", "@", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"Part", "[", 
                    RowBox[{
                    RowBox[{"List", "@@@", "sq"}], ",", "#"}], "]"}], "&"}], "/@",
                   "#1"}], ",", "#2"}], "}"}], "&"}], "@@", 
              RowBox[{"Transpose", "@", 
               RowBox[{"(", 
                RowBox[{"Last", "/@", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Length", "@", "exp"}], ">", "2"}], ",", 
                   RowBox[{"Drop", "[", 
                    RowBox[{"exp", ",", 
                    RowBox[{"{", 
                    RowBox[{"3", ",", 
                    RowBox[{"Length", "[", "exp", "]"}], ",", "2"}], "}"}]}], 
                    "]"}], ",", "exp"}], "]"}]}], ")"}]}]}], ")"}]}]}], 
          ")"}]}]}], ",", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"Part", "[", 
                RowBox[{"ag", ",", "#"}], "]"}], "&"}], "/@", "#1"}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"Part", "[", 
                RowBox[{"sq", ",", "#"}], "]"}], "&"}], "/@", "#2"}]}], "}"}],
            "&"}], "@@", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Complement", "[", 
             RowBox[{
              RowBox[{"Range", "@", 
               RowBox[{"Length", "@", "ag"}]}], ",", "#1"}], "]"}], ",", 
            RowBox[{"Complement", "[", 
             RowBox[{
              RowBox[{"Range", "@", 
               RowBox[{"Length", "@", "sq"}]}], ",", "#2"}], "]"}]}], "}"}]}],
          "&"}], "@@", 
        RowBox[{"Map", "[", 
         RowBox[{"First", ",", 
          RowBox[{"Transpose", "@", "exp"}], ",", 
          RowBox[{"{", "2", "}"}]}], "]"}]}]}], "}"}], ")"}]}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.826016932154456*^9, 3.8260170078470078`*^9}, {
   3.8260171094831157`*^9, 3.826017122447441*^9}, 3.8260171734839916`*^9, {
   3.826017338304161*^9, 3.826017341530475*^9}, {3.8260175705319853`*^9, 
   3.8260175778994865`*^9}, {3.8260176834531775`*^9, 3.826017684590139*^9}, {
   3.8260179019727182`*^9, 3.8260179135257654`*^9}, {3.8260181116199913`*^9, 
   3.8260181725170794`*^9}, {3.8260207312683816`*^9, 
   3.8260207383773813`*^9}, {3.826020916675541*^9, 3.8260209345317783`*^9}, 
   3.826021397771637*^9, {3.82602143577693*^9, 3.826021436022274*^9}, {
   3.8260241443413153`*^9, 3.826024154953878*^9}, {3.8260242008272276`*^9, 
   3.826024213551198*^9}},
 CellLabel->"In[29]:=",ExpressionUUID->"de592eb5-e0e7-4e54-b586-a4321e986cca"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"ChainBuilder", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "1"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"3", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"3", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "2"}], "}"}]}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      TemplateBox[{"1", "2"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], ",", 
      TemplateBox[{"5", "6"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], ",", 
      TemplateBox[{"3", "4"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      TemplateBox[{"1", "4"},
       "SpinorSquareBracket",
       DisplayFunction->(RowBox[{"[", 
          RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], ",", 
      TemplateBox[{"2", "3"},
       "SpinorSquareBracket",
       DisplayFunction->(RowBox[{"[", 
          RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], ",", 
      TemplateBox[{"2", "4"},
       "SpinorSquareBracket",
       DisplayFunction->(RowBox[{"[", 
          RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}], "]"}], "//", 
  "RepeatedTiming"}]], "Input",
 CellChangeTimes->{
  3.826017155247757*^9, {3.826017185601581*^9, 3.826017188490857*^9}, {
   3.8260240331466646`*^9, 3.8260240404262486`*^9}},
 CellLabel->"In[30]:=",ExpressionUUID->"b1c2b205-68d8-48c8-9678-7e77d0ed140a"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.00006431116943359374`", ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", 
     TemplateBox[{"4", 
       RowBox[{"{", 
         RowBox[{"1", ",", "2", ",", "3", ",", "4"}], "}"}], "2"},
      "SquareSquareChain",
      DisplayFunction->(RowBox[{"[", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$square", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], ",", 
     TemplateBox[{"5", "6"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.8260171762186613`*^9, 3.826017189273761*^9}, 
   3.8260173433326936`*^9, 3.826017579047406*^9, 3.826017686536911*^9, {
   3.8260179041399117`*^9, 3.826017915512488*^9}, {3.8260181650908985`*^9, 
   3.8260181740160675`*^9}, 3.8260214014487777`*^9, 3.826021437652953*^9, {
   3.8260240303272443`*^9, 3.8260240418384523`*^9}, 3.826082594418425*^9},
 CellLabel->"Out[30]=",ExpressionUUID->"3603dfed-8eef-424d-9ae8-5100bb124fdb"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"Odd", " ", "length", " ", 
   RowBox[{"chains", ".", " ", "Just"}], " ", "like", " ", "in", " ", "the", 
   " ", "even", " ", "case", " ", "with", " ", "an", " ", "addition", " ", 
   "of", " ", "a", " ", "final", " ", "bracket"}], "*)"}]], "Input",
 CellChangeTimes->{{3.82602142830996*^9, 3.826021462332954*^9}, {
  3.826021520748663*^9, 3.8260215261462283`*^9}, {3.8260215813476377`*^9, 
  3.826021586155781*^9}},ExpressionUUID->"73529045-2b0c-40f0-a382-\
ecdc23c3e03d"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ChainBuilder", "[", 
     RowBox[{"exp_List", ",", "ag_List", ",", "sq_List"}], "]"}], "/;", 
    RowBox[{"OddQ", "@", 
     RowBox[{"Length", "@", "exp"}]}]}], ":=", 
   RowBox[{"Flatten", "@", 
    RowBox[{"(", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"-", "1"}], ")"}], "^", 
        RowBox[{"Count", "[", 
         RowBox[{
          RowBox[{"Last", "/@", 
           RowBox[{"Total", "/@", "exp"}]}], ",", 
          RowBox[{"2", "|", "4"}], ",", "2"}], "]"}]}], ",", 
       RowBox[{
        RowBox[{
         RowBox[{"Chain", "[", 
          RowBox[{"$angle", ",", 
           RowBox[{"First", "@", "#"}], ",", 
           RowBox[{"Rest", "@", "#"}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Last", "@", "#"}], "\[Equal]", "1"}], ",", 
               RowBox[{"sq", "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"First", "@", "#"}], ",", "2"}], "]"}], "]"}], ",", 
               RowBox[{"sq", "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"First", "@", "#"}], ",", "1"}], "]"}], "]"}]}], 
              "]"}], "&"}], "@", 
            RowBox[{"Last", "@", 
             RowBox[{"Last", "@", "exp"}]}]}], ",", "$square"}], "]"}], "&"}],
         "@", 
        RowBox[{"Flatten", "@", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Last", "@", "#"}], "\[Equal]", "1"}], ",", 
                  RowBox[{"Reverse", "@", 
                   RowBox[{"First", "@", "#"}]}], ",", 
                  RowBox[{"First", "@", "#"}]}], "]"}], "&"}], "@", 
               RowBox[{"First", "@", "#"}]}], ",", 
              RowBox[{
               RowBox[{
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Last", "@", "#"}], "\[Equal]", "2"}], ",", 
                  RowBox[{"Reverse", "@", 
                   RowBox[{"First", "@", "#"}]}], ",", 
                  RowBox[{"First", "@", "#"}]}], "]"}], "&"}], "/@", 
               RowBox[{"Rest", "@", "#"}]}]}], "}"}], "&"}], "@", 
           RowBox[{"Transpose", "@", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"Part", "[", 
                    RowBox[{
                    RowBox[{"List", "@@@", "ag"}], ",", "#"}], "]"}], "&"}], "/@",
                   "#1"}], ",", "#2"}], "}"}], "&"}], "@@", 
              RowBox[{"Transpose", "@", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"First", "/@", 
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "@", "#"}], ">", "2"}], ",", 
                    RowBox[{"Drop", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"{", 
                    RowBox[{"3", ",", 
                    RowBox[{"Length", "[", "#", "]"}], ",", "2"}], "}"}]}], 
                    "]"}], ",", "#"}], "]"}]}], "&"}], "@", 
                 RowBox[{"Most", "@", "exp"}]}], ")"}]}]}], ")"}]}]}], 
          ")"}]}]}], ",", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"Part", "[", 
                RowBox[{"ag", ",", "#"}], "]"}], "&"}], "/@", "#1"}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"Part", "[", 
                RowBox[{"sq", ",", "#"}], "]"}], "&"}], "/@", "#2"}]}], "}"}],
            "&"}], "@@", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Complement", "[", 
             RowBox[{
              RowBox[{"Range", "@", 
               RowBox[{"Length", "@", "ag"}]}], ",", "#1"}], "]"}], ",", 
            RowBox[{"Complement", "[", 
             RowBox[{
              RowBox[{"Range", "@", 
               RowBox[{"Length", "@", "sq"}]}], ",", "#2"}], "]"}]}], "}"}]}],
          "&"}], "@@", 
        RowBox[{"Map", "[", 
         RowBox[{"First", ",", 
          RowBox[{"Transpose", "@", "exp"}], ",", 
          RowBox[{"{", "2", "}"}]}], "]"}]}]}], "}"}], ")"}]}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.8260216087393756`*^9, 3.8260216105345163`*^9}, {
   3.8260216411018143`*^9, 3.826021649320826*^9}, {3.8260216882796326`*^9, 
   3.8260216885588737`*^9}, {3.82602205078306*^9, 3.826022119532297*^9}, {
   3.8260222129414186`*^9, 3.826022223157128*^9}, {3.826022259557787*^9, 
   3.826022261758092*^9}, {3.8260225340882826`*^9, 3.8260225358386135`*^9}, 
   3.8260246230875807`*^9, {3.8260246567595153`*^9, 3.8260246693478823`*^9}, {
   3.826024779659837*^9, 3.8260247799041996`*^9}, {3.826025678964079*^9, 
   3.826025680505955*^9}, 3.826025739216875*^9},
 CellLabel->"In[31]:=",ExpressionUUID->"4e86c2e9-5cad-4dac-8a83-cc7d8863d383"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"ChainBuilder", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"3", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "1"}], "}"}]}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      TemplateBox[{"1", "2"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], ",", 
      TemplateBox[{"5", "6"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], ",", 
      TemplateBox[{"3", "4"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      TemplateBox[{"1", "4"},
       "SpinorSquareBracket",
       DisplayFunction->(RowBox[{"[", 
          RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], ",", 
      TemplateBox[{"2", "3"},
       "SpinorSquareBracket",
       DisplayFunction->(RowBox[{"[", 
          RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], ",", 
      TemplateBox[{"2", "4"},
       "SpinorSquareBracket",
       DisplayFunction->(RowBox[{"[", 
          RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}], "]"}], "//", 
  "RepeatedTiming"}]], "Input",
 CellChangeTimes->{{3.8260248092981386`*^9, 3.8260248108978643`*^9}},
 CellLabel->"In[32]:=",ExpressionUUID->"14d9b329-15f7-4151-8acd-86380034d9b6"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.0000603884521484375`", ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1"}], ",", 
     TemplateBox[{"4", 
       RowBox[{"{", 
         RowBox[{"3", ",", "2", ",", "1"}], "}"}], "4"},
      "AngleSquareChain",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], ",", 
     TemplateBox[{"5", "6"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"2", "4"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{3.8260246954320745`*^9, 3.8260247812555647`*^9, 
  3.8260248122093306`*^9, 3.826082601741823*^9},
 CellLabel->"Out[32]=",ExpressionUUID->"461a2d81-2a30-4bee-a39c-cc64377b3a19"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Chainbuilder again", "Subsubsection",
 CellChangeTimes->{{3.8260125598777037`*^9, 3.826012562792856*^9}, {
  3.826023629186164*^9, 3.82602363001096*^9}, {3.826024373973124*^9, 
  3.8260243741955414`*^9}, {3.8260850236758184`*^9, 
  3.826085024590727*^9}},ExpressionUUID->"1c2fbff2-b82d-4219-af41-\
b8486056a63a"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "The", " ", "uncontracted", " ", "brackets", " ", "need", " ", "to", " ", 
   "be", " ", "taken", " ", "care", " ", "of", " ", "prior", " ", "to", " ", 
   "the", " ", "use", " ", "of", " ", "this", " ", "function"}], 
  "*)"}]], "Input",
 CellChangeTimes->{{3.826085025948245*^9, 3.8260850474955254`*^9}},
 CellLabel->"In[53]:=",ExpressionUUID->"80422f3a-6b14-4b44-a000-0e803a1161d2"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "This", " ", "\"\<function\>\"", " ", "converts", " ", "lists", " ", "of", 
   " ", "brackets", " ", "into", " ", "a", " ", 
   RowBox[{"chain", ".", " ", "Needs"}], " ", "to", " ", "be", " ", 
   "embedded", " ", "in", " ", "previous", " ", "code"}], "*)"}]], "Input",
 CellChangeTimes->{{3.826012565846687*^9, 3.826012605428874*^9}},
 CellLabel->"In[54]:=",ExpressionUUID->"a7d43a4b-6ee6-4d09-858d-8d765dd58de6"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "We", " ", "assume", " ", "traces", " ", "have", " ", "been", " ", 
   "converted", " ", "from", " ", "even", " ", "to", " ", "odd", " ", 
   "number", " ", "of", " ", "contractions"}], "*)"}]], "Input",
 CellChangeTimes->{{3.8260129539481306`*^9, 3.8260129736095467`*^9}},
 CellLabel->"In[55]:=",ExpressionUUID->"f266d55a-0b4d-4e40-8330-cb7aa5a197a4"],

Cell[BoxData[
 RowBox[{"Clear", "[", 
  RowBox[{"ChainBuilder", ",", "auxChainBuilder"}], "]"}]], "Input",
 CellChangeTimes->{{3.8260232383335066`*^9, 3.826023245855423*^9}},
 CellLabel->"In[56]:=",ExpressionUUID->"c335c40d-1c38-4844-8374-4b15ca80e422"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"Single", " ", 
    RowBox[{"chain", ".", " ", "I"}], " ", 
    RowBox[{"think", "/", "hope"}], " ", "that", " ", "the", " ", "use", " ", 
    "of", " ", "a", " ", "Length", " ", "test", " ", "intesad", " ", "of", 
    " ", "a", " ", "direct", " ", "pattern", " ", "matching", " ", "increses",
     " ", "speed"}], ",", " ", 
   RowBox[{
   "this", " ", "is", " ", "the", " ", "reason", " ", "why", " ", 
    "introduced", " ", "an", " ", "auxiliary", " ", "function"}]}], 
  "*)"}]], "Input",
 CellChangeTimes->{{3.8260182069100523`*^9, 3.826018212246825*^9}, {
  3.826018632840867*^9, 3.826018633518033*^9}, {3.826018892912298*^9, 
  3.826018926300989*^9}},
 CellLabel->"In[57]:=",ExpressionUUID->"f7c342ac-7c96-4113-bd34-6cc26730cb4e"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ChainBuilder", "[", 
    RowBox[{"exp_List", ",", "ag_List", ",", "sq_List"}], "]"}], "/;", 
   RowBox[{
    RowBox[{"Length", "@", "exp"}], "===", "1"}]}], ":=", 
  RowBox[{"auxChainBuilder", "[", 
   RowBox[{"exp", ",", "ag", ",", "sq"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.826018635510704*^9, 3.826018708158472*^9}, {
  3.8260188131256943`*^9, 3.8260188488382072`*^9}, {3.8260190708753104`*^9, 
  3.826019085432239*^9}, {3.826019466312961*^9, 3.8260194699841948`*^9}, {
  3.8260850699631805`*^9, 3.826085074180394*^9}},
 CellLabel->"In[58]:=",ExpressionUUID->"a4714f37-72b0-4bc9-858b-02d39144d024"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"auxChainBuilder", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"i1_", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"i2_", ",", "1"}], "}"}]}], "}"}], "}"}], ",", "ag_", ",", 
     "sq_"}], "]"}], ":=", 
   RowBox[{"-", 
    RowBox[{"Chain", "[", 
     RowBox[{"$angle", ",", 
      RowBox[{"Last", "@", 
       RowBox[{"ag", "[", 
        RowBox[{"[", "i1", "]"}], "]"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"First", "@", 
        RowBox[{"ag", "[", 
         RowBox[{"[", "i1", "]"}], "]"}]}], "}"}], ",", 
      RowBox[{"Last", "@", 
       RowBox[{"sq", "[", 
        RowBox[{"[", "i2", "]"}], "]"}]}], ",", "$square"}], "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"auxChainBuilder", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"i1_", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"i2_", ",", "2"}], "}"}]}], "}"}], "}"}], ",", "ag_", ",", 
     "sq_"}], "]"}], ":=", 
   RowBox[{"Chain", "[", 
    RowBox[{"$angle", ",", 
     RowBox[{"Last", "@", 
      RowBox[{"ag", "[", 
       RowBox[{"[", "i1", "]"}], "]"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"First", "@", 
       RowBox[{"ag", "[", 
        RowBox[{"[", "i1", "]"}], "]"}]}], "}"}], ",", 
     RowBox[{"First", "@", 
      RowBox[{"sq", "[", 
       RowBox[{"[", "i2", "]"}], "]"}]}], ",", "$square"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"auxChainBuilder", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"i1_", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"i2_", ",", "1"}], "}"}]}], "}"}], "}"}], ",", "ag_", ",", 
     "sq_"}], "]"}], ":=", 
   RowBox[{"Chain", "[", 
    RowBox[{"$angle", ",", 
     RowBox[{"First", "@", 
      RowBox[{"ag", "[", 
       RowBox[{"[", "i1", "]"}], "]"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"Last", "@", 
       RowBox[{"ag", "[", 
        RowBox[{"[", "i1", "]"}], "]"}]}], "}"}], ",", 
     RowBox[{"Last", "@", 
      RowBox[{"sq", "[", 
       RowBox[{"[", "i2", "]"}], "]"}]}], ",", "$square"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"auxChainBuilder", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"i1_", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"i2_", ",", "2"}], "}"}]}], "}"}], "}"}], ",", "ag_", ",", 
     "sq_"}], "]"}], ":=", 
   RowBox[{"-", 
    RowBox[{"Chain", "[", 
     RowBox[{"$angle", ",", 
      RowBox[{"First", "@", 
       RowBox[{"ag", "[", 
        RowBox[{"[", "i1", "]"}], "]"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"Last", "@", 
        RowBox[{"ag", "[", 
         RowBox[{"[", "i1", "]"}], "]"}]}], "}"}], ",", 
      RowBox[{"First", "@", 
       RowBox[{"sq", "[", 
        RowBox[{"[", "i2", "]"}], "]"}]}], ",", "$square"}], "]"}]}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.8260188509674816`*^9, 3.8260188868415856`*^9}, {
  3.8260189307590666`*^9, 3.826019028612403*^9}, {3.8260191014553823`*^9, 
  3.826019176964985*^9}, {3.8260192866326337`*^9, 3.826019375256654*^9}},
 CellLabel->"In[59]:=",ExpressionUUID->"f3a22890-47a2-4b77-89df-1624da60bd41"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"ChainBuilder", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}]}], "}"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      TemplateBox[{"1", "2"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], ",", 
      TemplateBox[{"1", "3"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
    RowBox[{"{", 
     TemplateBox[{"1", "4"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], "}"}]}], "]"}], "//", 
  "RepeatedTiming"}]], "Input",
 CellChangeTimes->{{3.8260194108045216`*^9, 3.8260194314153023`*^9}, {
  3.826023658031014*^9, 3.826023660562191*^9}},
 CellLabel->"In[63]:=",ExpressionUUID->"5fbe4e67-822f-4d6a-82e4-f8fdfe8b0f0e"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"6.170393371582031`*^-6", ",", 
   RowBox[{"-", 
    TemplateBox[{"2", 
      RowBox[{"{", "1", "}"}], "4"},
     "AngleSquareChain",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
     InterpretationFunction->(
      RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
        "$square", "]"}]& )]}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.8260194327278223`*^9, 3.8260194736783133`*^9, 3.826023250730378*^9, {
   3.826023654176322*^9, 3.826023662300575*^9}, 3.8260241660961123`*^9, 
   3.8260852240798388`*^9},
 CellLabel->"Out[63]=",ExpressionUUID->"31041024-580f-446e-95b1-d324a1a4fd1a"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"Even", " ", "angle", " ", "chains"}], "*)"}]], "Input",
 CellChangeTimes->{{3.8260169373704567`*^9, 3.826016947848482*^9}},
 CellLabel->"In[64]:=",ExpressionUUID->"1f944bce-78c2-4fbd-bb57-2ae2deb8651c"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ChainBuilder", "[", 
     RowBox[{"exp_List", ",", "ag_List", ",", "sq_List"}], "]"}], "/;", 
    RowBox[{
     RowBox[{"EvenQ", "@", 
      RowBox[{"Length", "@", "exp"}]}], "&&", 
     RowBox[{
      RowBox[{"exp", "[", 
       RowBox[{"[", 
        RowBox[{"1", ",", "2", ",", "1"}], "]"}], "]"}], "===", 
      RowBox[{"exp", "[", 
       RowBox[{"[", 
        RowBox[{"2", ",", "2", ",", "1"}], "]"}], "]"}]}]}]}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{"-", "1"}], ")"}], "^", 
     RowBox[{"Count", "[", 
      RowBox[{
       RowBox[{"Last", "/@", 
        RowBox[{"Total", "/@", "exp"}]}], ",", 
       RowBox[{"2", "|", "4"}], ",", "2"}], "]"}]}], "*", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"Chain", "[", 
        RowBox[{"$angle", ",", 
         RowBox[{"First", "@", "#"}], ",", 
         RowBox[{"Rest", "@", 
          RowBox[{"Most", "@", "#"}]}], ",", 
         RowBox[{"Last", "@", "#"}], ",", "$angle"}], "]"}], "&"}], "@", 
      RowBox[{"Flatten", "@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Last", "@", "#"}], "\[Equal]", "1"}], ",", 
                RowBox[{"Reverse", "@", 
                 RowBox[{"First", "@", "#"}]}], ",", 
                RowBox[{"First", "@", "#"}]}], "]"}], "&"}], "@", 
             RowBox[{"First", "@", "#"}]}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Last", "@", "#"}], "\[Equal]", "2"}], ",", 
                RowBox[{"Reverse", "@", 
                 RowBox[{"First", "@", "#"}]}], ",", 
                RowBox[{"First", "@", "#"}]}], "]"}], "&"}], "/@", 
             RowBox[{"Rest", "@", "#"}]}]}], "}"}], "&"}], "@", 
         RowBox[{"Transpose", "@", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Part", "[", 
                  RowBox[{
                   RowBox[{"List", "@@@", "ag"}], ",", "#"}], "]"}], "&"}], "/@",
                 "#1"}], ",", "#2"}], "}"}], "&"}], "@@", 
            RowBox[{"Transpose", "@", 
             RowBox[{"(", 
              RowBox[{"First", "/@", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Length", "@", "exp"}], ">", "2"}], ",", 
                 RowBox[{"Drop", "[", 
                  RowBox[{"exp", ",", 
                   RowBox[{"{", 
                    RowBox[{"3", ",", 
                    RowBox[{"Length", "[", "exp", "]"}], ",", "2"}], "}"}]}], 
                  "]"}], ",", "exp"}], "]"}]}], ")"}]}]}], ")"}]}]}], 
        ")"}]}]}], ")"}]}]}], ";"}]], "Input",
 CellChangeTimes->{{3.826016932154456*^9, 3.8260170078470078`*^9}, {
  3.826020628678008*^9, 3.8260207116339197`*^9}, {3.826020821819213*^9, 
  3.826020929865259*^9}, {3.826021309850788*^9, 3.826021381351551*^9}, {
  3.826023532817912*^9, 3.826023534340789*^9}, {3.8260240614111233`*^9, 
  3.8260240968463435`*^9}, {3.8260242769406075`*^9, 3.8260242800204268`*^9}, {
  3.8260245262617297`*^9, 3.82602452735382*^9}, {3.826024791651778*^9, 
  3.826024792033706*^9}, {3.8260256495477037`*^9, 3.826025652991495*^9}, {
  3.826085112281683*^9, 3.826085134046756*^9}},
 CellLabel->"In[65]:=",ExpressionUUID->"b3206d82-2e7d-4b48-93d2-93040dbb9fa9"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ChainBuilder", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"2", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "2"}], "}"}]}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "2"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"3", "4"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    TemplateBox[{"2", "3"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.8260231491361094`*^9, 3.826023172764867*^9}},
 CellLabel->"In[66]:=",ExpressionUUID->"2689bf15-c105-4548-9b26-4faec881df69"],

Cell[BoxData[
 TemplateBox[{"1", 
   RowBox[{"{", 
     RowBox[{"2", ",", "3"}], "}"}], "4"},
  "AngleAngleChain",
  DisplayFunction->(
   RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
  InterpretationFunction->(
   RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle", 
     "]"}]& )]], "Output",
 CellChangeTimes->{
  3.826023174977999*^9, 3.826023261158498*^9, 3.826023536035254*^9, {
   3.826024100850621*^9, 3.82602411266005*^9}, 3.826024169360345*^9, 
   3.8260243240466533`*^9, 3.8260245301383524`*^9, 3.826024793585606*^9, 
   3.8260825677776613`*^9, 3.826085139866314*^9, 3.8260852242592783`*^9},
 CellLabel->"Out[66]=",ExpressionUUID->"9044bf5e-f146-4bf8-9cc1-e8a3e1d82d83"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"ChainBuilder", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "1"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"2", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "2"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"2", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"3", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "2"}], "}"}]}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      TemplateBox[{"1", "2"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], ",", 
      TemplateBox[{"3", "4"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], ",", 
      TemplateBox[{"5", "6"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      TemplateBox[{"2", "3"},
       "SpinorSquareBracket",
       DisplayFunction->(RowBox[{"[", 
          RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], ",", 
      TemplateBox[{"4", "5"},
       "SpinorSquareBracket",
       DisplayFunction->(RowBox[{"[", 
          RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}], "]"}], "//", 
  "RepeatedTiming"}]], "Input",
 CellChangeTimes->{{3.8260244774223657`*^9, 3.8260245056089306`*^9}, {
  3.826024798927304*^9, 3.826024801302513*^9}},
 CellLabel->"In[67]:=",ExpressionUUID->"3254437a-feb0-4908-9d84-dd895fe44624"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.00004310906982421875`", ",", 
   TemplateBox[{"1", 
     RowBox[{"{", 
       RowBox[{"2", ",", "3", ",", "4", ",", "5"}], "}"}], "6"},
    "AngleAngleChain",
    DisplayFunction->(
     RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle", 
       "]"}]& )]}], "}"}]], "Output",
 CellChangeTimes->{{3.8260245079526577`*^9, 3.8260245314168987`*^9}, {
   3.8260247944991093`*^9, 3.826024802616987*^9}, 3.82608257042558*^9, 
   3.826085146751342*^9, 3.826085225739122*^9},
 CellLabel->"Out[67]=",ExpressionUUID->"842c52a4-3a86-48f9-b15f-67b1f9483468"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"Even", " ", "square", " ", "chains"}], "*)"}]], "Input",
 CellChangeTimes->{{3.8260169373704567`*^9, 3.826016947848482*^9}, {
   3.826017092506524*^9, 3.8260170932904243`*^9}, {3.8260175219838657`*^9, 
   3.826017565832575*^9}, 3.8260241863369937`*^9},
 CellLabel->"In[68]:=",ExpressionUUID->"78b2eca3-c651-422a-a7e1-7c1636604b58"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ChainBuilder", "[", 
     RowBox[{"exp_List", ",", "ag_List", ",", "sq_List"}], "]"}], "/;", 
    RowBox[{
     RowBox[{"EvenQ", "@", 
      RowBox[{"Length", "@", "exp"}]}], "&&", 
     RowBox[{
      RowBox[{"exp", "[", 
       RowBox[{"[", 
        RowBox[{"1", ",", "2", ",", "1"}], "]"}], "]"}], "\[NotEqual]", 
      RowBox[{"exp", "[", 
       RowBox[{"[", 
        RowBox[{"2", ",", "2", ",", "1"}], "]"}], "]"}]}]}]}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{"-", "1"}], ")"}], "^", 
     RowBox[{"Count", "[", 
      RowBox[{
       RowBox[{"Last", "/@", 
        RowBox[{"Total", "/@", "exp"}]}], ",", 
       RowBox[{"2", "|", "4"}], ",", "2"}], "]"}]}], "*", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"Chain", "[", 
        RowBox[{"$square", ",", 
         RowBox[{"First", "@", "#"}], ",", 
         RowBox[{"Rest", "@", 
          RowBox[{"Most", "@", "#"}]}], ",", 
         RowBox[{"Last", "@", "#"}], ",", "$square"}], "]"}], "&"}], "@", 
      RowBox[{"Flatten", "@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Last", "@", "#"}], "\[Equal]", "1"}], ",", 
                RowBox[{"Reverse", "@", 
                 RowBox[{"First", "@", "#"}]}], ",", 
                RowBox[{"First", "@", "#"}]}], "]"}], "&"}], "@", 
             RowBox[{"First", "@", "#"}]}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Last", "@", "#"}], "\[Equal]", "2"}], ",", 
                RowBox[{"Reverse", "@", 
                 RowBox[{"First", "@", "#"}]}], ",", 
                RowBox[{"First", "@", "#"}]}], "]"}], "&"}], "/@", 
             RowBox[{"Rest", "@", "#"}]}]}], "}"}], "&"}], "@", 
         RowBox[{"Transpose", "@", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Part", "[", 
                  RowBox[{
                   RowBox[{"List", "@@@", "sq"}], ",", "#"}], "]"}], "&"}], "/@",
                 "#1"}], ",", "#2"}], "}"}], "&"}], "@@", 
            RowBox[{"Transpose", "@", 
             RowBox[{"(", 
              RowBox[{"Last", "/@", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Length", "@", "exp"}], ">", "2"}], ",", 
                 RowBox[{"Drop", "[", 
                  RowBox[{"exp", ",", 
                   RowBox[{"{", 
                    RowBox[{"3", ",", 
                    RowBox[{"Length", "[", "exp", "]"}], ",", "2"}], "}"}]}], 
                  "]"}], ",", "exp"}], "]"}]}], ")"}]}]}], ")"}]}]}], 
        ")"}]}]}], ")"}]}]}], ";"}]], "Input",
 CellChangeTimes->{{3.826016932154456*^9, 3.8260170078470078`*^9}, {
   3.8260171094831157`*^9, 3.826017122447441*^9}, 3.8260171734839916`*^9, {
   3.826017338304161*^9, 3.826017341530475*^9}, {3.8260175705319853`*^9, 
   3.8260175778994865`*^9}, {3.8260176834531775`*^9, 3.826017684590139*^9}, {
   3.8260179019727182`*^9, 3.8260179135257654`*^9}, {3.8260181116199913`*^9, 
   3.8260181725170794`*^9}, {3.8260207312683816`*^9, 
   3.8260207383773813`*^9}, {3.826020916675541*^9, 3.8260209345317783`*^9}, 
   3.826021397771637*^9, {3.82602143577693*^9, 3.826021436022274*^9}, {
   3.8260241443413153`*^9, 3.826024154953878*^9}, {3.8260242008272276`*^9, 
   3.826024213551198*^9}, {3.826085162504323*^9, 3.8260851754192305`*^9}},
 CellLabel->"In[69]:=",ExpressionUUID->"c9218999-c805-42e3-b3cd-189f9f843517"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"ChainBuilder", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "1"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"3", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"3", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "2"}], "}"}]}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      TemplateBox[{"1", "2"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], ",", 
      TemplateBox[{"5", "6"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], ",", 
      TemplateBox[{"3", "4"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      TemplateBox[{"1", "4"},
       "SpinorSquareBracket",
       DisplayFunction->(RowBox[{"[", 
          RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], ",", 
      TemplateBox[{"2", "3"},
       "SpinorSquareBracket",
       DisplayFunction->(RowBox[{"[", 
          RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], ",", 
      TemplateBox[{"2", "4"},
       "SpinorSquareBracket",
       DisplayFunction->(RowBox[{"[", 
          RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}], "]"}], "//", 
  "RepeatedTiming"}]], "Input",
 CellChangeTimes->{
  3.826017155247757*^9, {3.826017185601581*^9, 3.826017188490857*^9}, {
   3.8260240331466646`*^9, 3.8260240404262486`*^9}},
 CellLabel->"In[70]:=",ExpressionUUID->"252cf876-68f7-40c8-8675-30928afe0f4f"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.0000458142822265625`", ",", 
   TemplateBox[{"4", 
     RowBox[{"{", 
       RowBox[{"1", ",", "2", ",", "3", ",", "4"}], "}"}], "2"},
    "SquareSquareChain",
    DisplayFunction->(RowBox[{"[", #, #2, #3, "]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$square", ",", #, ",", #2, ",", #3, ",", 
       "$square", "]"}]& )]}], "}"}]], "Output",
 CellChangeTimes->{{3.8260171762186613`*^9, 3.826017189273761*^9}, 
   3.8260173433326936`*^9, 3.826017579047406*^9, 3.826017686536911*^9, {
   3.8260179041399117`*^9, 3.826017915512488*^9}, {3.8260181650908985`*^9, 
   3.8260181740160675`*^9}, 3.8260214014487777`*^9, 3.826021437652953*^9, {
   3.8260240303272443`*^9, 3.8260240418384523`*^9}, 3.826082594418425*^9, 
   3.826085179741973*^9, 3.826085227411187*^9},
 CellLabel->"Out[70]=",ExpressionUUID->"0015ce6f-4ac8-4384-b4dc-819d037c8d16"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"Odd", " ", "length", " ", 
   RowBox[{"chains", ".", " ", "Just"}], " ", "like", " ", "in", " ", "the", 
   " ", "even", " ", "case", " ", "with", " ", "an", " ", "addition", " ", 
   "of", " ", "a", " ", "final", " ", "bracket"}], "*)"}]], "Input",
 CellChangeTimes->{{3.82602142830996*^9, 3.826021462332954*^9}, {
  3.826021520748663*^9, 3.8260215261462283`*^9}, {3.8260215813476377`*^9, 
  3.826021586155781*^9}},
 CellLabel->"In[71]:=",ExpressionUUID->"8ba31588-f887-4e99-af7e-72203fa5e2fe"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ChainBuilder", "[", 
     RowBox[{"exp_List", ",", "ag_List", ",", "sq_List"}], "]"}], "/;", 
    RowBox[{"OddQ", "@", 
     RowBox[{"Length", "@", "exp"}]}]}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{"-", "1"}], ")"}], "^", 
     RowBox[{"Count", "[", 
      RowBox[{
       RowBox[{"Last", "/@", 
        RowBox[{"Total", "/@", "exp"}]}], ",", 
       RowBox[{"2", "|", "4"}], ",", "2"}], "]"}]}], "*", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"Chain", "[", 
        RowBox[{"$angle", ",", 
         RowBox[{"First", "@", "#"}], ",", 
         RowBox[{"Rest", "@", "#"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Last", "@", "#"}], "\[Equal]", "1"}], ",", 
             RowBox[{"sq", "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"First", "@", "#"}], ",", "2"}], "]"}], "]"}], ",", 
             RowBox[{"sq", "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"First", "@", "#"}], ",", "1"}], "]"}], "]"}]}], 
            "]"}], "&"}], "@", 
          RowBox[{"Last", "@", 
           RowBox[{"Last", "@", "exp"}]}]}], ",", "$square"}], "]"}], "&"}], 
      "@", 
      RowBox[{"Flatten", "@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Last", "@", "#"}], "\[Equal]", "1"}], ",", 
                RowBox[{"Reverse", "@", 
                 RowBox[{"First", "@", "#"}]}], ",", 
                RowBox[{"First", "@", "#"}]}], "]"}], "&"}], "@", 
             RowBox[{"First", "@", "#"}]}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Last", "@", "#"}], "\[Equal]", "2"}], ",", 
                RowBox[{"Reverse", "@", 
                 RowBox[{"First", "@", "#"}]}], ",", 
                RowBox[{"First", "@", "#"}]}], "]"}], "&"}], "/@", 
             RowBox[{"Rest", "@", "#"}]}]}], "}"}], "&"}], "@", 
         RowBox[{"Transpose", "@", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Part", "[", 
                  RowBox[{
                   RowBox[{"List", "@@@", "ag"}], ",", "#"}], "]"}], "&"}], "/@",
                 "#1"}], ",", "#2"}], "}"}], "&"}], "@@", 
            RowBox[{"Transpose", "@", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"First", "/@", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Length", "@", "#"}], ">", "2"}], ",", 
                   RowBox[{"Drop", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"{", 
                    RowBox[{"3", ",", 
                    RowBox[{"Length", "[", "#", "]"}], ",", "2"}], "}"}]}], 
                    "]"}], ",", "#"}], "]"}]}], "&"}], "@", 
               RowBox[{"Most", "@", "exp"}]}], ")"}]}]}], ")"}]}]}], 
        ")"}]}]}], ")"}]}]}], ";"}]], "Input",
 CellChangeTimes->{{3.8260216087393756`*^9, 3.8260216105345163`*^9}, {
   3.8260216411018143`*^9, 3.826021649320826*^9}, {3.8260216882796326`*^9, 
   3.8260216885588737`*^9}, {3.82602205078306*^9, 3.826022119532297*^9}, {
   3.8260222129414186`*^9, 3.826022223157128*^9}, {3.826022259557787*^9, 
   3.826022261758092*^9}, {3.8260225340882826`*^9, 3.8260225358386135`*^9}, 
   3.8260246230875807`*^9, {3.8260246567595153`*^9, 3.8260246693478823`*^9}, {
   3.826024779659837*^9, 3.8260247799041996`*^9}, {3.826025678964079*^9, 
   3.826025680505955*^9}, 3.826025739216875*^9, {3.826085190536023*^9, 
   3.826085203176607*^9}},
 CellLabel->"In[72]:=",ExpressionUUID->"7202d8f1-dee6-428b-8367-6802daa93fa0"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"ChainBuilder", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"3", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "1"}], "}"}]}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      TemplateBox[{"1", "2"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], ",", 
      TemplateBox[{"5", "6"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], ",", 
      TemplateBox[{"3", "4"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      TemplateBox[{"1", "4"},
       "SpinorSquareBracket",
       DisplayFunction->(RowBox[{"[", 
          RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], ",", 
      TemplateBox[{"2", "3"},
       "SpinorSquareBracket",
       DisplayFunction->(RowBox[{"[", 
          RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], ",", 
      TemplateBox[{"2", "4"},
       "SpinorSquareBracket",
       DisplayFunction->(RowBox[{"[", 
          RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}], "]"}], "//", 
  "RepeatedTiming"}]], "Input",
 CellChangeTimes->{{3.8260248092981386`*^9, 3.8260248108978643`*^9}},
 CellLabel->"In[73]:=",ExpressionUUID->"da6d5413-8603-471d-b3ee-8549b138c6d4"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.000042319525146484376`", ",", 
   RowBox[{"-", 
    TemplateBox[{"4", 
      RowBox[{"{", 
        RowBox[{"3", ",", "2", ",", "1"}], "}"}], "4"},
     "AngleSquareChain",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
     InterpretationFunction->(
      RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
        "$square", "]"}]& )]}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.8260246954320745`*^9, 3.8260247812555647`*^9, 3.8260248122093306`*^9, 
   3.826082601741823*^9, {3.8260852102022343`*^9, 3.826085228969079*^9}},
 CellLabel->"Out[73]=",ExpressionUUID->"94ba0b40-5c0d-434d-baa7-31a625eb4332"]
}, Open  ]]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["List of brackets to list of chains", "Subsection",
 CellChangeTimes->{{3.82602488767048*^9, 
  3.826024896436037*^9}},ExpressionUUID->"0abf6bda-6483-44c8-92e3-\
379763ba6124"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
   "Auxiliary", " ", "function", " ", "to", " ", "test", " ", "for", " ", 
    "duplicates", " ", "in", " ", "a", " ", "list"}], ",", " ", 
   RowBox[{
   "returns", " ", "False", " ", "if", " ", "there", " ", "are", " ", "no", 
    " ", "duplicates"}]}], "*)"}]], "Input",
 CellChangeTimes->{{3.825768477952244*^9, 
  3.825768502537095*^9}},ExpressionUUID->"8ea67f67-5b15-4f2c-9bfd-\
4cd49ca67edf"],

Cell[BoxData[
 RowBox[{
  RowBox[{"duplicatesQ", " ", "=", " ", 
   RowBox[{
    RowBox[{"0", " ", "===", 
     RowBox[{"Signature", "@", "#"}]}], "&"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.825768375158662*^9, 3.825768420305456*^9}},
 CellLabel->"In[5]:=",ExpressionUUID->"901a06ee-ab37-4212-91e6-50c6a82ff3ce"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
   "Auxiliary", " ", "function", " ", "for", " ", "testing", " ", "if", " ", 
    "a", " ", "contraction", " ", "is", " ", "possible"}], ",", " ", 
   RowBox[{
    RowBox[{"i", ".", "e", ".", " ", "if"}], " ", "every", " ", "bracket", 
    " ", "appears", " ", "at", " ", "most", " ", "once"}]}], "*)"}]], "Input",
 CellChangeTimes->{{3.825768686925809*^9, 3.825768698761897*^9}, {
  3.8257687466477566`*^9, 
  3.8257687555509386`*^9}},ExpressionUUID->"11037868-3643-4f4f-824c-\
ca66ac48de92"],

Cell[BoxData[
 RowBox[{
  RowBox[{"feasibilitytest", " ", "=", 
   RowBox[{
    RowBox[{"Or", "@@", " ", 
     RowBox[{"duplicatesQ", "/@", 
      RowBox[{"Transpose", "@", 
       RowBox[{"(", 
        RowBox[{"First", "/@", 
         RowBox[{"Transpose", "/@", "#"}]}], ")"}]}]}]}], "&"}]}], 
  ";"}]], "Input",
 CellLabel->"In[6]:=",ExpressionUUID->"a12ee71a-b263-4820-b4d1-5ec0abe5a7b0"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"The", " ", "function"}], "*)"}]], "Input",
 CellChangeTimes->{{3.8257689564147863`*^9, 
  3.8257689603724966`*^9}},ExpressionUUID->"315250b5-021d-4dc5-b455-\
82764f41220d"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Module", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
    "exp", ",", "ag", ",", "sq", ",", "ch", ",", "connections", ",", 
     "momenta", ",", "candidatecontractions", ",", "chains"}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"exp", "=", 
     RowBox[{"test", "//", "Echo"}]}], ";", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{
      "Gather", " ", "by", " ", "angle", " ", "and", " ", "square", " ", 
       "head"}], ",", " ", 
      RowBox[{
      "chains", " ", "are", " ", "converted", " ", "into", " ", "angles", " ",
        "and", " ", "squares", " ", "and", " ", "in", " ", "case", " ", 
       "mixed", " ", "chains", " ", "are", " ", "found", " ", "an", " ", 
       "appropriate", " ", "connection", " ", "is", " ", 
       RowBox[{"added", ".", " ", "We"}], " ", "take", " ", "care", " ", "of",
        " ", "chains", " ", "later", " ", "on"}]}], "*)"}], 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{
      "Angle", " ", "and", " ", "square", " ", "chains", " ", "are", " ", 
       "no", " ", "problem"}], ",", " ", 
      RowBox[{
      "the", " ", "only", " ", "troublesome", " ", "are", " ", "the", " ", 
       "mixed", " ", "chains"}], ",", " ", 
      RowBox[{"these", " ", "are", " ", "kept", " ", "separate"}]}], "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", "Chain", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"Chain", "[", 
         RowBox[{"$angle", ",", "x_", ",", "y_", ",", "z_", ",", "$angle"}], 
         "]"}], ":=", 
        RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{"x", ",", "y", ",", "z"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Chain", "[", 
         RowBox[{"$square", ",", "x_", ",", "y_", ",", "z_", ",", "$square"}],
          "]"}], ":=", 
        RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{"x", ",", "y", ",", "z"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"ag", ",", "sq", ",", "ch"}], "}"}], "=", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Flatten", "[", 
              RowBox[{"#", ",", "1"}], "]"}], "&"}], "/@", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Select", "[", 
               RowBox[{"#", ",", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Head", "@", 
                    RowBox[{"First", "@", "#"}]}], "===", 
                   "SpinorAngleBracket"}], "&"}], ")"}]}], "]"}], ",", 
              RowBox[{"Select", "[", 
               RowBox[{"#", ",", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Head", "@", 
                    RowBox[{"First", "@", "#"}]}], "===", 
                   "SpinorSquareBracket"}], "&"}], ")"}]}], "]"}], ",", 
              RowBox[{"Select", "[", 
               RowBox[{"#", ",", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Head", "@", 
                    RowBox[{"First", "@", "#"}]}], "===", "Chain"}], "&"}], 
                 ")"}]}], "]"}]}], "}"}]}], "&"}], "@", 
          RowBox[{"GatherBy", "[", 
           RowBox[{"exp", ",", "Head"}], "]"}]}], "//", "Echo"}]}], ";"}]}], 
     "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
     "STILL", " ", "NEED", " ", "TO", " ", "TAKE", " ", "CARE", " ", "OF", 
      " ", "MIXED", " ", "CHAINS"}], "*)"}], "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
     "Find", " ", "the", " ", "momenta", " ", "and", " ", "their", " ", 
      "number"}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"SpinorAngleBracket", ",", "SpinorSquareBracket"}], "}"}], ",",
       "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{"x_", ",", "y_", ",", "z_"}], "]"}], ":=", 
        RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{"x", ",", "z"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{"x_", ",", "y_", ",", "z_"}], "]"}], ":=", 
        RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{"x", ",", "z"}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "These", " ", "are", " ", "the", " ", "momenta", " ", "and", " ", 
          "their", " ", 
          RowBox[{"multiplicities", ".", " ", "They"}], " ", "are", " ", 
          "found", " ", "by", " ", "extracting", " ", "all", " ", "the", " ", 
          "labels", " ", "from", " ", "the", " ", "brackest"}], ",", " ", 
         RowBox[{
         "then", " ", "counting", " ", "the", " ", "labels", " ", "and", " ", 
          "looking", " ", "at", " ", "those", " ", "which", " ", "appear", 
          " ", "both", " ", "as", " ", "angle", " ", "and", " ", 
          RowBox[{"squares", ".", " ", "Then"}], " ", "we", " ", "take", " ", 
          "the", " ", "minimum", " ", "between", " ", "the", " ", "angle", 
          " ", "and", " ", "square", " ", "appearences"}], ",", " ", 
         RowBox[{
         "the", " ", "mismatch", " ", "gives", " ", "the", " ", "helicity", 
          " ", "weight", " ", "which", " ", "we", " ", "do", " ", "not", " ", 
          "need", " ", "right", " ", "now"}], ",", " ", 
         RowBox[{
         "the", " ", "rest", " ", "is", " ", "the", " ", "number", " ", "of", 
          " ", "momenta", " ", "which", " ", "can", " ", "be", " ", 
          RowBox[{"formed", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"momenta", "=", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"First", "@", "#1"}], ",", 
                    RowBox[{"Min", "@", "#2"}]}], "}"}], "&"}], "@@@", 
                  RowBox[{"Transpose", "/@", 
                   RowBox[{"Echo", "[", 
                    RowBox[{"#", ",", "\"\<momenta2\>\""}], "]"}]}]}], "&"}], 
                "@", 
                RowBox[{"First", "@", 
                 RowBox[{"Select", "[", 
                  RowBox[{"#", ",", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "@", 
                    RowBox[{"First", "@", "#"}]}], "\[Equal]", "2"}], "&"}], 
                    ")"}]}], "]"}]}]}], "&"}], "@", 
              RowBox[{"Echo", "@", 
               RowBox[{"GatherBy", "[", 
                RowBox[{"#", ",", "Length"}], "]"}]}]}], "&"}], "@", 
            RowBox[{"Echo", "[", 
             RowBox[{"#", ",", "\"\<momenta1\>\""}], "]"}]}], "&"}], "@", 
          RowBox[{"GatherBy", "[", 
           RowBox[{
            RowBox[{"Join", "@@", 
             RowBox[{"Tally", "/@", 
              RowBox[{"Flatten", "/@", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"List", "@@@", "ag"}], ",", 
                 RowBox[{"List", "@@@", "sq"}]}], "}"}]}]}]}], ",", "First"}],
            "]"}]}], "//", 
         RowBox[{
          RowBox[{"Echo", "[", 
           RowBox[{"#", ",", "\"\<momenta3\>\""}], "]"}], "&"}]}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Extract", " ", "the", " ", "positions", " ", "of", " ", "the", " ", 
         "brackets", " ", "containg", " ", "each", " ", "momentum", " ", 
         "and", " ", "then", " ", "pair", " ", "them"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"candidatecontractions", "=", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"#", ",", "1"}], "]"}], "&"}], "/@", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"Outer", "[", 
              RowBox[{"List", ",", "#1", ",", "#2", ",", "1"}], "]"}], "&"}], 
            "@@@", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Position", "[", 
                  RowBox[{"ag", ",", "#"}], "]"}], ",", 
                 RowBox[{"Position", "[", 
                  RowBox[{"sq", ",", "#"}], "]"}]}], "}"}], "&"}], "/@", 
              RowBox[{"First", "@", 
               RowBox[{"Transpose", "@", "momenta"}]}]}], ")"}]}], ")"}]}], "//", 
         RowBox[{
          RowBox[{"Echo", "[", 
           RowBox[{"#", ",", "\"\<candidates\>\""}], "]"}], "&"}]}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Out", " ", "of", " ", "the", " ", "candidatecontractions", " ", "I", 
         " ", "have", " ", "to", " ", "select", " ", "subsets", " ", "with", 
         " ", "number", " ", "of", " ", "elements", " ", "given", " ", "by", 
         " ", "the", " ", "multiplicity", " ", "of", " ", "the", " ", "given",
          " ", "momentum", " ", "and", " ", "then", " ", "apply", " ", "a", 
         " ", "feasibility", " ", 
         RowBox[{"check", ":", " ", 
          RowBox[{
          "every", " ", "bracket", " ", "can", " ", "only", " ", "appear", 
           " ", "once", " ", "per", " ", 
           RowBox[{"momentum", "."}]}]}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"chains", "=", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Subsets", "[", 
            RowBox[{"#1", ",", 
             RowBox[{"{", "#2", "}"}]}], "]"}], "&"}], "@@@", 
          RowBox[{"Transpose", "@", 
           RowBox[{"{", 
            RowBox[{"candidatecontractions", ",", 
             RowBox[{"Last", "@", 
              RowBox[{"Transpose", "@", "momenta"}]}]}], "}"}]}]}], "//", 
         RowBox[{
          RowBox[{"Echo", "[", 
           RowBox[{"#", ",", "\"\<subsets\>\""}], "]"}], "&"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Apply", " ", 
         RowBox[{"check", ":"}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"chains", "=", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"DeleteCases", "[", 
            RowBox[{"#", ",", "feasibilitytest"}], "]"}], "&"}], "/@", 
          "chains"}], "//", 
         RowBox[{
          RowBox[{"Echo", "[", 
           RowBox[{"#", ",", "\"\<checked\>\""}], "]"}], "&"}]}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Out", " ", "of", " ", "these", " ", "we", " ", "need", " ", "to", 
         " ", "take", " ", "all", " ", "possible", " ", 
         RowBox[{"combinations", "."}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"chains", "=", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"#", ",", "1"}], "]"}], "&"}], "/@", 
          RowBox[{"Tuples", "@", "chains"}]}], "//", 
         RowBox[{
          RowBox[{"Echo", "[", 
           RowBox[{"#", ",", "\"\<chains flattened\>\""}], "]"}], "&"}]}]}], 
       ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
     "Reoreder", " ", "list", " ", "such", " ", "that", " ", "the", " ", 
      "structure", " ", "of", " ", "contracted", " ", "chains", " ", "is", 
      " ", "visible"}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{"chains", "=", 
     RowBox[{
      RowBox[{"Apply", "[", 
       RowBox[{"chorder", ",", 
        RowBox[{
         RowBox[{
          RowBox[{"Echo", "@", 
           RowBox[{"GatherBy", "[", 
            RowBox[{"#", ",", 
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", 
                RowBox[{"2", ",", "1"}], "]"}], "]"}], "&"}]}], "]"}]}], 
          "&"}], "/@", "chains"}], ",", 
        RowBox[{"{", "2", "}"}]}], "]"}], "//", 
      RowBox[{
       RowBox[{"Echo", "[", 
        RowBox[{"#", ",", "\"\<gathered\>\""}], "]"}], "&"}]}]}], ";", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
     "Next", " ", "convert", " ", "to", " ", "chains", " ", "the", " ", 
      "single", " ", "parts"}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", "chorder", "}"}], ",", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Next", " ", "we", " ", "transformtraces", " ", "from", " ", "even", 
        " ", "to", " ", "odd", " ", "chains", " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
          "so", " ", "far", " ", "we", " ", "counted", " ", "the", " ", 
           "number", " ", "of", " ", "momenta"}], ",", " ", 
          RowBox[{
          "now", " ", "we", " ", "count", " ", "the", " ", "number", " ", 
           "of", " ", "connections"}]}], ")"}]}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"chorder", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"i1_", ",", "j1_"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"i2_", ",", "j2_"}], "}"}]}], "}"}], ",", "x__", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"i1_", ",", "_"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"_", ",", "_"}], "}"}]}], "}"}]}], "]"}], ":=", 
        RowBox[{"chorder", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"i1", ",", "j1"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"i2", ",", "j2"}], "}"}]}], "}"}], ",", "x"}], "]"}]}], 
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Build", " ", "the", " ", "chains"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"chorder", "[", "exp__", "]"}], ":=", 
        RowBox[{"ChainBuilder", "[", 
         RowBox[{
          RowBox[{"{", "exp", "}"}], ",", "ag", ",", "sq"}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{"#", ",", "1"}], "]"}], "&"}], "/@", "chains"}]}]}], 
     "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}]], "Input",
 CellChangeTimes->{{3.8257633957912083`*^9, 3.8257634072963395`*^9}, {
   3.825763442862852*^9, 3.825763446351156*^9}, {3.825763486450094*^9, 
   3.8257635122415795`*^9}, {3.825763545946443*^9, 3.8257635531560407`*^9}, {
   3.825763672555443*^9, 3.8257638105948033`*^9}, {3.8257640810355697`*^9, 
   3.8257641464532704`*^9}, {3.82576418876536*^9, 3.825764215337344*^9}, {
   3.8257644483513255`*^9, 3.8257645586709557`*^9}, {3.8257646282616673`*^9, 
   3.825764693162859*^9}, {3.825764749745613*^9, 3.82576493781892*^9}, {
   3.825764997654073*^9, 3.8257650023714886`*^9}, {3.8257651501945305`*^9, 
   3.8257652667679486`*^9}, {3.825765304994318*^9, 3.8257653190431633`*^9}, {
   3.8257653508255634`*^9, 3.825765353233629*^9}, {3.8257655451785936`*^9, 
   3.8257655915084543`*^9}, {3.8257656322962666`*^9, 
   3.8257657563802586`*^9}, {3.825766025982182*^9, 3.8257660365339117`*^9}, {
   3.8257661451371183`*^9, 3.825766286607415*^9}, {3.825766444878257*^9, 
   3.82576644511648*^9}, {3.825766497546246*^9, 3.825766503200699*^9}, {
   3.825766554867244*^9, 3.825766555004475*^9}, {3.825766594525688*^9, 
   3.8257666108283033`*^9}, {3.825766742074042*^9, 3.8257667822709713`*^9}, {
   3.8257668459360886`*^9, 3.8257669069201145`*^9}, {3.8257672166526003`*^9, 
   3.8257673544507656`*^9}, 3.8257674843213873`*^9, {3.8257675192376137`*^9, 
   3.825767607078309*^9}, {3.825767678174508*^9, 3.8257677014093294`*^9}, {
   3.8257677388576*^9, 3.825767756847411*^9}, {3.825768519654298*^9, 
   3.8257685612169685`*^9}, {3.8257685928356175`*^9, 
   3.8257685952883987`*^9}, {3.825768632327431*^9, 3.825768646643256*^9}, {
   3.825768971151866*^9, 3.825769002936179*^9}, {3.825769062075291*^9, 
   3.8257690942332215`*^9}, {3.82576916178439*^9, 3.8257691797055006`*^9}, {
   3.8257692187511683`*^9, 3.825769218946212*^9}, {3.8257693469402475`*^9, 
   3.8257693662467365`*^9}, 3.825769396762868*^9, 3.825769557182871*^9, {
   3.8257702302108583`*^9, 3.825770274562928*^9}, {3.8257703349656343`*^9, 
   3.8257704469528246`*^9}, {3.826002688040179*^9, 3.8260026975647497`*^9}, 
   3.8260027776355925`*^9, {3.826002815314828*^9, 3.826002848445173*^9}, {
   3.8260029316801357`*^9, 3.8260029524275894`*^9}, {3.826003047244032*^9, 
   3.826003117895957*^9}, {3.826003152626075*^9, 3.826003157795253*^9}, 
   3.8260044063048105`*^9, {3.82600449235362*^9, 3.8260045212773123`*^9}, {
   3.8260045551756516`*^9, 3.826004578331665*^9}, {3.826005677693948*^9, 
   3.8260057003972406`*^9}, {3.8260067164563046`*^9, 3.826006797051367*^9}, {
   3.8260068870818424`*^9, 3.8260069150071464`*^9}, {3.8260074604606285`*^9, 
   3.8260074938034487`*^9}, {3.8260126681374197`*^9, 3.826012672379222*^9}, {
   3.8260127137335997`*^9, 3.8260127139580154`*^9}, {3.826013333525933*^9, 
   3.82601333584968*^9}, {3.8260193852957973`*^9, 3.8260193954725823`*^9}, {
   3.826022689071634*^9, 3.8260226894905167`*^9}, {3.826022781298962*^9, 
   3.8260227887769585`*^9}, {3.826022841303457*^9, 3.8260228786455946`*^9}, {
   3.8260229652728443`*^9, 3.8260229672845087`*^9}, {3.826022999095434*^9, 
   3.826023124027236*^9}, {3.826024460490654*^9, 3.8260244607140465`*^9}, {
   3.8260249007006288`*^9, 3.826024992751486*^9}, {3.826025115673659*^9, 
   3.8260252152194633`*^9}, {3.8260252977077894`*^9, 3.8260253043588543`*^9}},
 CellLabel->
  "In[217]:=",ExpressionUUID->"6f7df21a-61a7-4fa4-8f0c-8138ef1a15da"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   TemplateBox[{"1", "2"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"5", "6"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"3", "4"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"1", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"2", "3"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"2", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.826025304989166*^9},ExpressionUUID->"ef19cebe-0416-46b6-be87-\
9cebf3ff0077"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "2"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"5", "6"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"3", "4"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "4"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"2", "3"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"2", "4"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.826025305049003*^9},ExpressionUUID->"09dac705-d96d-457c-8ed9-\
2f806d499c08"],

Cell[BoxData[
 RowBox[{
  TagBox["\<\"momenta1\"\>",
   "EchoLabel"], "  ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"1", ",", "1"}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"2", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{"5", ",", "1"}], "}"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{"6", ",", "1"}], "}"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"3", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"3", ",", "1"}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"4", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"4", ",", "2"}], "}"}]}], "}"}]}], "}"}]}]], "Echo",
 CellChangeTimes->{
  3.8260253051228065`*^9},ExpressionUUID->"5b9eaf87-ef73-446c-aa72-\
c3b0eb6e124a"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"2", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"3", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"4", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"4", ",", "2"}], "}"}]}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{"5", ",", "1"}], "}"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{"6", ",", "1"}], "}"}], "}"}]}], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.826025305181649*^9},ExpressionUUID->"515bc58f-f558-45ac-aed2-\
835ff1f7a5d7"],

Cell[BoxData[
 RowBox[{
  TagBox["\<\"momenta2\"\>",
   "EchoLabel"], "  ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"1", ",", "1"}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"2", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"3", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"3", ",", "1"}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"4", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"4", ",", "2"}], "}"}]}], "}"}]}], "}"}]}]], "Echo",
 CellChangeTimes->{
  3.8260253052374606`*^9},ExpressionUUID->"783f1a47-69b1-4067-b544-\
72603872824e"],

Cell[BoxData[
 RowBox[{
  TagBox["\<\"momenta3\"\>",
   "EchoLabel"], "  ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"1", ",", "1"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"2", ",", "1"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"3", ",", "1"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"4", ",", "1"}], "}"}]}], "}"}]}]], "Echo",
 CellChangeTimes->{
  3.826025305292353*^9},ExpressionUUID->"13d3a610-00a0-4efe-a1a9-\
5fabf09a250c"],

Cell[BoxData[
 RowBox[{
  TagBox["\<\"candidates\"\>",
   "EchoLabel"], "  ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}]}], "}"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "1"}], "}"}]}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"3", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2"}], "}"}]}], "}"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"3", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "2"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"3", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "2"}], "}"}]}], "}"}]}], "}"}]}], "}"}]}]], "Echo",
 CellChangeTimes->{
  3.826025305349164*^9},ExpressionUUID->"23c30912-fa52-46af-a394-\
677bfdcb405c"],

Cell[BoxData[
 RowBox[{
  TagBox["\<\"subsets\"\>",
   "EchoLabel"], "  ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "1"}], "}"}]}], "}"}], "}"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "1"}], "}"}]}], "}"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "1"}], "}"}]}], "}"}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"3", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "2"}], "}"}]}], "}"}], "}"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"3", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "2"}], "}"}]}], "}"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"3", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "2"}], "}"}]}], "}"}], "}"}]}], "}"}]}], 
   "}"}]}]], "Echo",
 CellChangeTimes->{
  3.8260253054010224`*^9},ExpressionUUID->"da767dba-72bd-491d-84cb-\
45958f1dd371"],

Cell[BoxData[
 RowBox[{
  TagBox["\<\"checked\"\>",
   "EchoLabel"], "  ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "1"}], "}"}]}], "}"}], "}"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "1"}], "}"}]}], "}"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "1"}], "}"}]}], "}"}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"3", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "2"}], "}"}]}], "}"}], "}"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"3", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "2"}], "}"}]}], "}"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"3", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "2"}], "}"}]}], "}"}], "}"}]}], "}"}]}], 
   "}"}]}]], "Echo",
 CellChangeTimes->{
  3.8260253054528847`*^9},ExpressionUUID->"bbceabc1-1e15-4b49-9bf9-\
880680026365"],

Cell[BoxData[
 RowBox[{
  TagBox["\<\"chains flattened\"\>",
   "EchoLabel"], "  ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "1"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"3", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"3", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "2"}], "}"}]}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "1"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"3", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"3", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "2"}], "}"}]}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "1"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "1"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"3", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"3", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "2"}], "}"}]}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "1"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "1"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"3", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"3", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "2"}], "}"}]}], "}"}]}], "}"}]}], "}"}]}]], "Echo",
 CellChangeTimes->{
  3.8260253055047865`*^9},ExpressionUUID->"7f7f8b62-396f-402b-b9aa-\
8955ea551a6f"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"3", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "2"}], "}"}]}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"3", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2"}], "}"}]}], "}"}]}], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.826025305554655*^9},ExpressionUUID->"1a0ec3b8-ebea-4d7e-8101-\
24bc8e9db81e"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"1", ",", "1"}], "}"}]}], "}"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"3", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2"}], "}"}]}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"3", ",", "2"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"3", ",", "2"}], "}"}]}], "}"}], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.8260253055995264`*^9},ExpressionUUID->"ab25d15c-f7d0-44f0-b412-\
4dda7125dd5a"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"3", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "2"}], "}"}]}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "2"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"3", ",", "1"}], "}"}]}], "}"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"3", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"2", ",", "2"}], "}"}]}], "}"}], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.826025305632406*^9},ExpressionUUID->"fb73a9fa-aa23-4ec2-aa4c-\
5ee9ae722c2a"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"1", ",", "1"}], "}"}]}], "}"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"3", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "2"}], "}"}]}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"3", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"2", ",", "2"}], "}"}]}], "}"}], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.826025305669344*^9},ExpressionUUID->"860fe5bb-ace3-438d-97d5-\
d5f8c6539cb2"],

Cell[BoxData[
 RowBox[{
  TagBox["\<\"gathered\"\>",
   "EchoLabel"], "  ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"chorder", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"3", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "1"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"3", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "2"}], "}"}]}], "}"}]}], "]"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"chorder", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "1"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"3", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"3", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "2"}], "}"}]}], "}"}]}], "]"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"chorder", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "1"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "1"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"3", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "2"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"3", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "2"}], "}"}]}], "}"}]}], "]"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"chorder", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "1"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "1"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"3", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "2"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"3", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "2"}], "}"}]}], "}"}]}], "]"}], "}"}]}], 
   "}"}]}]], "Echo",
 CellChangeTimes->{
  3.826025305704248*^9},ExpressionUUID->"b5bbe8ae-ba2f-400c-984a-\
f80b9213f1bb"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1"}], ",", 
     TemplateBox[{"4", 
       RowBox[{"{", 
         RowBox[{"3", ",", "2", ",", "1"}], "}"}], "4"},
      "AngleSquareChain",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], ",", 
     TemplateBox[{"5", "6"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"2", "4"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", 
     TemplateBox[{"4", 
       RowBox[{"{", 
         RowBox[{"1", ",", "2", ",", "3", ",", "4"}], "}"}], "2"},
      "SquareSquareChain",
      DisplayFunction->(RowBox[{"[", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$square", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], ",", 
     TemplateBox[{"5", "6"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", 
     TemplateBox[{"4", 
       RowBox[{"{", 
         RowBox[{"2", ",", "1", ",", "4", ",", "3"}], "}"}], "2"},
      "SquareSquareChain",
      DisplayFunction->(RowBox[{"[", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$square", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], ",", 
     TemplateBox[{"5", "6"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", 
     TemplateBox[{"4", 
       RowBox[{"{", 
         RowBox[{"1", ",", "2", ",", "4", ",", "3"}], "}"}], "2"},
      "SquareSquareChain",
      DisplayFunction->(RowBox[{"[", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$square", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], ",", 
     TemplateBox[{"5", "6"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.826025204066283*^9, 3.826025216725422*^9}, 
   3.8260252586243563`*^9, 3.826025305740157*^9},
 CellLabel->
  "Out[217]=",ExpressionUUID->"bd2c1a21-d4eb-443a-b2fd-1583b505191e"]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"AllChains", "[", "exp_List", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "ag", ",", "sq", ",", "ch", ",", "connections", ",", "momenta", ",", 
      "candidatecontractions", ",", "chains"}], "}"}], ",", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{
      "Gather", " ", "by", " ", "angle", " ", "and", " ", "square", " ", 
       "head"}], ",", " ", 
      RowBox[{
      "chains", " ", "are", " ", "converted", " ", "into", " ", "angles", " ",
        "and", " ", "squares", " ", "and", " ", "in", " ", "case", " ", 
       "mixed", " ", "chains", " ", "are", " ", "found", " ", "an", " ", 
       "appropriate", " ", "connection", " ", "is", " ", 
       RowBox[{"added", ".", " ", "We"}], " ", "take", " ", "care", " ", "of",
        " ", "chains", " ", "later", " ", "on"}]}], "*)"}], 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{
      "Angle", " ", "and", " ", "square", " ", "chains", " ", "are", " ", 
       "no", " ", "problem"}], ",", " ", 
      RowBox[{
      "the", " ", "only", " ", "troublesome", " ", "are", " ", "the", " ", 
       "mixed", " ", "chains"}], ",", " ", 
      RowBox[{"these", " ", "are", " ", "kept", " ", "separate"}]}], "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", "Chain", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"Chain", "[", 
          RowBox[{"$angle", ",", "x_", ",", "y_", ",", "z_", ",", "$angle"}], 
          "]"}], ":=", 
         RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{"x", ",", "y", ",", "z"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Chain", "[", 
          RowBox[{
          "$square", ",", "x_", ",", "y_", ",", "z_", ",", "$square"}], "]"}],
          ":=", 
         RowBox[{"SpinorSquareBracket", "[", 
          RowBox[{"x", ",", "y", ",", "z"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"ag", ",", "sq", ",", "ch"}], "}"}], "=", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Flatten", "[", 
              RowBox[{"#", ",", "1"}], "]"}], "&"}], "/@", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Select", "[", 
               RowBox[{"#", ",", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Head", "@", 
                    RowBox[{"First", "@", "#"}]}], "===", 
                   "SpinorAngleBracket"}], "&"}], ")"}]}], "]"}], ",", 
              RowBox[{"Select", "[", 
               RowBox[{"#", ",", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Head", "@", 
                    RowBox[{"First", "@", "#"}]}], "===", 
                   "SpinorSquareBracket"}], "&"}], ")"}]}], "]"}], ",", 
              RowBox[{"Select", "[", 
               RowBox[{"#", ",", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Head", "@", 
                    RowBox[{"First", "@", "#"}]}], "===", "Chain"}], "&"}], 
                 ")"}]}], "]"}]}], "}"}]}], "&"}], "@", 
          RowBox[{"GatherBy", "[", 
           RowBox[{"exp", ",", "Head"}], "]"}]}]}], ";"}]}], 
      "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "STILL", " ", "NEED", " ", "TO", " ", "TAKE", " ", "CARE", " ", "OF", 
       " ", "MIXED", " ", "CHAINS"}], "*)"}], "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Find", " ", "the", " ", "momenta", " ", "and", " ", "their", " ", 
       "number"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"SpinorAngleBracket", ",", "SpinorSquareBracket"}], "}"}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"SpinorSquareBracket", "[", 
          RowBox[{"x_", ",", "y_", ",", "z_"}], "]"}], ":=", 
         RowBox[{"SpinorSquareBracket", "[", 
          RowBox[{"x", ",", "z"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{"x_", ",", "y_", ",", "z_"}], "]"}], ":=", 
         RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{"x", ",", "z"}], "]"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
          "These", " ", "are", " ", "the", " ", "momenta", " ", "and", " ", 
           "their", " ", 
           RowBox[{"multiplicities", ".", " ", "They"}], " ", "are", " ", 
           "found", " ", "by", " ", "extracting", " ", "all", " ", "the", " ",
            "labels", " ", "from", " ", "the", " ", "brackest"}], ",", " ", 
          RowBox[{
          "then", " ", "counting", " ", "the", " ", "labels", " ", "and", " ",
            "looking", " ", "at", " ", "those", " ", "which", " ", "appear", 
           " ", "both", " ", "as", " ", "angle", " ", "and", " ", 
           RowBox[{"squares", ".", " ", "Then"}], " ", "we", " ", "take", " ",
            "the", " ", "minimum", " ", "between", " ", "the", " ", "angle", 
           " ", "and", " ", "square", " ", "appearences"}], ",", " ", 
          RowBox[{
          "the", " ", "mismatch", " ", "gives", " ", "the", " ", "helicity", 
           " ", "weight", " ", "which", " ", "we", " ", "do", " ", "not", " ",
            "need", " ", "right", " ", "now"}], ",", " ", 
          RowBox[{
          "the", " ", "rest", " ", "is", " ", "the", " ", "number", " ", "of",
            " ", "momenta", " ", "which", " ", "can", " ", "be", " ", 
           RowBox[{"formed", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"momenta", "=", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"First", "@", "#1"}], ",", 
                 RowBox[{"Min", "@", "#2"}]}], "}"}], "&"}], "@@@", 
              RowBox[{"Transpose", "/@", 
               RowBox[{"First", "@", 
                RowBox[{"Select", "[", 
                 RowBox[{"#", ",", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Length", "@", 
                    RowBox[{"First", "@", "#"}]}], "\[Equal]", "2"}], "&"}], 
                   ")"}]}], "]"}]}]}]}], "&"}], "@", 
            RowBox[{"GatherBy", "[", 
             RowBox[{"#", ",", "Length"}], "]"}]}], "&"}], "@", 
          RowBox[{"GatherBy", "[", 
           RowBox[{
            RowBox[{"Join", "@@", 
             RowBox[{"Tally", "/@", 
              RowBox[{"Flatten", "/@", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"List", "@@@", "ag"}], ",", 
                 RowBox[{"List", "@@@", "sq"}]}], "}"}]}]}]}], ",", "First"}],
            "]"}]}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Extract", " ", "the", " ", "positions", " ", "of", " ", "the", " ", 
          "brackets", " ", "containg", " ", "each", " ", "momentum", " ", 
          "and", " ", "then", " ", "pair", " ", "them"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"candidatecontractions", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"#", ",", "1"}], "]"}], "&"}], "/@", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"Outer", "[", 
              RowBox[{"List", ",", "#1", ",", "#2", ",", "1"}], "]"}], "&"}], 
            "@@@", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Position", "[", 
                  RowBox[{"ag", ",", "#"}], "]"}], ",", 
                 RowBox[{"Position", "[", 
                  RowBox[{"sq", ",", "#"}], "]"}]}], "}"}], "&"}], "/@", 
              RowBox[{"First", "@", 
               RowBox[{"Transpose", "@", "momenta"}]}]}], ")"}]}], ")"}]}]}], 
        ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Out", " ", "of", " ", "the", " ", "candidatecontractions", " ", "I",
           " ", "have", " ", "to", " ", "select", " ", "subsets", " ", "with",
           " ", "number", " ", "of", " ", "elements", " ", "given", " ", "by",
           " ", "the", " ", "multiplicity", " ", "of", " ", "the", " ", 
          "given", " ", "momentum", " ", "and", " ", "then", " ", "apply", 
          " ", "a", " ", "feasibility", " ", 
          RowBox[{"check", ":", " ", 
           RowBox[{
           "every", " ", "bracket", " ", "can", " ", "only", " ", "appear", 
            " ", "once", " ", "per", " ", 
            RowBox[{"momentum", "."}]}]}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"chains", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Subsets", "[", 
            RowBox[{"#1", ",", 
             RowBox[{"{", "#2", "}"}]}], "]"}], "&"}], "@@@", 
          RowBox[{"Transpose", "@", 
           RowBox[{"{", 
            RowBox[{"candidatecontractions", ",", 
             RowBox[{"Last", "@", 
              RowBox[{"Transpose", "@", "momenta"}]}]}], "}"}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"Apply", " ", 
          RowBox[{"check", ":"}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"chains", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"DeleteCases", "[", 
            RowBox[{"#", ",", "feasibilitytest"}], "]"}], "&"}], "/@", 
          "chains"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Out", " ", "of", " ", "these", " ", "we", " ", "need", " ", "to", 
          " ", "take", " ", "all", " ", "possible", " ", 
          RowBox[{"combinations", "."}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"chains", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"#", ",", "1"}], "]"}], "&"}], "/@", 
          RowBox[{"Tuples", "@", "chains"}]}]}], ";"}]}], 
      "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Reoreder", " ", "list", " ", "such", " ", "that", " ", "the", " ", 
       "structure", " ", "of", " ", "contracted", " ", "chains", " ", "is", 
       " ", "visible"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"chains", "=", 
      RowBox[{"Apply", "[", 
       RowBox[{"chorder", ",", 
        RowBox[{
         RowBox[{
          RowBox[{"GatherBy", "[", 
           RowBox[{"#", ",", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "1"}], "]"}], "]"}], "&"}]}], "]"}], "&"}], "/@",
          "chains"}], ",", 
        RowBox[{"{", "2", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Next", " ", "convert", " ", "to", " ", "chains", " ", "the", " ", 
       "single", " ", "parts"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", "chorder", "}"}], ",", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Next", " ", "we", " ", "transformtraces", " ", "from", " ", "even", 
         " ", "to", " ", "odd", " ", "chains", " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
           "so", " ", "far", " ", "we", " ", "counted", " ", "the", " ", 
            "number", " ", "of", " ", "momenta"}], ",", " ", 
           RowBox[{
           "now", " ", "we", " ", "count", " ", "the", " ", "number", " ", 
            "of", " ", "connections"}]}], ")"}]}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"chorder", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"i1_", ",", "j1_"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"i2_", ",", "j2_"}], "}"}]}], "}"}], ",", "x__", ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"i1_", ",", "_"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"_", ",", "_"}], "}"}]}], "}"}]}], "]"}], ":=", 
         RowBox[{"chorder", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"i1", ",", "j1"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"i2", ",", "j2"}], "}"}]}], "}"}], ",", "x"}], "]"}]}], 
        ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"Build", " ", "the", " ", "chains"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"chorder", "[", "x__", "]"}], ":=", 
         RowBox[{"ChainBuilder", "[", 
          RowBox[{
           RowBox[{"{", "x", "}"}], ",", "ag", ",", "sq"}], "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", "chains"}]}], 
      "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.82602532892715*^9, 3.8260253376788387`*^9}, {
   3.826025368438622*^9, 3.8260254472448244`*^9}, {3.8260254837581787`*^9, 
   3.826025484046398*^9}, 3.8260258337719784`*^9},
 CellLabel->"In[33]:=",ExpressionUUID->"2b40b1f7-3086-4b7b-9c33-ea48fd1ececf"],

Cell[CellGroupData[{

Cell[BoxData["test"], "Input",
 CellChangeTimes->{{3.8260254998810053`*^9, 3.826025500223092*^9}},
 CellLabel->
  "In[223]:=",ExpressionUUID->"05cc91c9-5d94-4433-a677-4d993f0bb749"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   TemplateBox[{"1", "2"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"5", "6"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"3", "4"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"1", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"2", "3"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"2", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]], "Output",
 CellChangeTimes->{3.8260255010579014`*^9},
 CellLabel->
  "Out[223]=",ExpressionUUID->"5a0dfac8-46ba-4b9f-89db-bf73cb712dc0"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"AllChains", "[", "test", "]"}]], "Input",
 CellChangeTimes->{{3.8260254551636076`*^9, 3.8260254591669345`*^9}},
 CellLabel->
  "In[221]:=",ExpressionUUID->"e3c32ef3-ffb4-4597-88f5-ed701c7f0df5"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1"}], ",", 
     TemplateBox[{"4", 
       RowBox[{"{", 
         RowBox[{"3", ",", "2", ",", "1"}], "}"}], "4"},
      "AngleSquareChain",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], ",", 
     TemplateBox[{"5", "6"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"2", "4"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", 
     TemplateBox[{"4", 
       RowBox[{"{", 
         RowBox[{"1", ",", "2", ",", "3", ",", "4"}], "}"}], "2"},
      "SquareSquareChain",
      DisplayFunction->(RowBox[{"[", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$square", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], ",", 
     TemplateBox[{"5", "6"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", 
     TemplateBox[{"4", 
       RowBox[{"{", 
         RowBox[{"2", ",", "1", ",", "4", ",", "3"}], "}"}], "2"},
      "SquareSquareChain",
      DisplayFunction->(RowBox[{"[", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$square", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], ",", 
     TemplateBox[{"5", "6"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", 
     TemplateBox[{"4", 
       RowBox[{"{", 
         RowBox[{"1", ",", "2", ",", "4", ",", "3"}], "}"}], "2"},
      "SquareSquareChain",
      DisplayFunction->(RowBox[{"[", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$square", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], ",", 
     TemplateBox[{"5", "6"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.826025461475757*^9, 3.826025485708953*^9}},
 CellLabel->
  "Out[221]=",ExpressionUUID->"f1eadefb-a288-48fa-9655-032925cb9c90"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData["test2"], "Input",
 CellChangeTimes->{{3.8260255032919188`*^9, 3.826025504227438*^9}},
 CellLabel->
  "In[224]:=",ExpressionUUID->"13268e88-1c7a-4d2f-853d-80f7f26ce26f"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   TemplateBox[{"1", "2"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"1", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"1", "3"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]], "Output",
 CellChangeTimes->{3.826025504611405*^9},
 CellLabel->
  "Out[224]=",ExpressionUUID->"93e164b2-360a-4ea2-87c6-8c87e261474a"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"AllChains", "[", "test2", "]"}]], "Input",
 CellChangeTimes->{{3.8260254900593295`*^9, 3.8260254943109074`*^9}},
 CellLabel->
  "In[222]:=",ExpressionUUID->"6788363f-d879-4bce-a957-94d300b58388"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", 
      TemplateBox[{"2", 
        RowBox[{"{", "1", "}"}], "4"},
       "AngleSquareChain",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
       InterpretationFunction->(
        RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
          "$square", "]"}]& )]}], ",", 
     TemplateBox[{"1", "3"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", 
      TemplateBox[{"3", 
        RowBox[{"{", "1", "}"}], "4"},
       "AngleSquareChain",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
       InterpretationFunction->(
        RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
          "$square", "]"}]& )]}], ",", 
     TemplateBox[{"1", "2"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{3.8260254947048526`*^9},
 CellLabel->
  "Out[222]=",ExpressionUUID->"ca1e1585-c5c1-4f89-a635-e6a264891228"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData["test3"], "Input",
 CellChangeTimes->{{3.8260255169822655`*^9, 3.8260255177153487`*^9}},
 CellLabel->
  "In[225]:=",ExpressionUUID->"4782b7ff-af8b-4fc9-84e5-f2d395ab9d4c"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   TemplateBox[{"1", "2"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"1", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"1", "3"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"4", 
     RowBox[{"{", 
       RowBox[{"5", ",", "6"}], "}"}], "7"},
    "AngleAngleChain",
    DisplayFunction->(
     RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle", 
       "]"}]& )]}], "}"}]], "Output",
 CellChangeTimes->{3.8260255178270063`*^9},
 CellLabel->
  "Out[225]=",ExpressionUUID->"07ba6c80-b3e9-4c9d-840c-ad33a4448d36"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"AllChains", "[", "test3", "]"}]], "Input",
 CellChangeTimes->{{3.8260255198974724`*^9, 3.8260255467138*^9}},
 CellLabel->
  "In[227]:=",ExpressionUUID->"1fff6da2-e51b-49aa-ab97-d1116e83c9e9"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1"}], ",", 
     TemplateBox[{"2", 
       RowBox[{"{", 
         RowBox[{"1", ",", "4", ",", "5", ",", "6"}], "}"}], "7"},
      "AngleAngleChain",
      DisplayFunction->(
       RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
         "$angle", "]"}]& )], ",", 
     TemplateBox[{"1", "3"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1"}], ",", 
     TemplateBox[{"3", 
       RowBox[{"{", 
         RowBox[{"1", ",", "4", ",", "5", ",", "6"}], "}"}], "7"},
      "AngleAngleChain",
      DisplayFunction->(
       RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
         "$angle", "]"}]& )], ",", 
     TemplateBox[{"1", "2"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.826025525526415*^9, 3.826025547238373*^9}},
 CellLabel->
  "Out[227]=",ExpressionUUID->"80c3b473-73c2-4f41-a980-0004f6a83bc9"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData["test4"], "Input",
 CellChangeTimes->{{3.8260255726055403`*^9, 3.826025573931985*^9}},
 CellLabel->
  "In[228]:=",ExpressionUUID->"2ecb74eb-c962-47da-8f6d-bb02fd6861b1"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   TemplateBox[{"1", "2"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"1", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"1", "2"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]], "Output",
 CellChangeTimes->{3.826025574319951*^9},
 CellLabel->
  "Out[228]=",ExpressionUUID->"1abf0823-d407-4b0c-b7b8-9d6edd64fb53"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"AllChains", "@", "test4"}]], "Input",
 CellChangeTimes->{{3.826025577398731*^9, 3.826025582061247*^9}},
 CellLabel->
  "In[229]:=",ExpressionUUID->"4c8f6b8f-63d5-4d95-a02d-f3bc18ba0046"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", 
      TemplateBox[{"2", 
        RowBox[{"{", "1", "}"}], "4"},
       "AngleSquareChain",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
       InterpretationFunction->(
        RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
          "$square", "]"}]& )]}], ",", 
     TemplateBox[{"1", "2"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", 
      TemplateBox[{"2", 
        RowBox[{"{", "1", "}"}], "4"},
       "AngleSquareChain",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
       InterpretationFunction->(
        RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
          "$square", "]"}]& )]}], ",", 
     TemplateBox[{"1", "2"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{3.8260255825080533`*^9},
 CellLabel->
  "Out[229]=",ExpressionUUID->"80bf2753-f121-4014-8a12-12faefc10505"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData["test5"], "Input",
 CellChangeTimes->{{3.826025593238316*^9, 3.8260255940062904`*^9}},
 CellLabel->
  "In[230]:=",ExpressionUUID->"6bd051f4-ac10-4c1b-8cf2-7d97b22c6aa6"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   TemplateBox[{"1", "2"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"5", "6"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"3", "4"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"1", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"2", "3"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"2", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"2", "6"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]], "Output",
 CellChangeTimes->{3.8260255945946827`*^9},
 CellLabel->
  "Out[230]=",ExpressionUUID->"ba008d04-5f25-400e-aaa8-c50d00850f9f"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"AllChains", "@", "test5"}]], "Input",
 CellChangeTimes->{{3.826025596843689*^9, 3.8260255997678456`*^9}},
 CellLabel->"In[79]:=",ExpressionUUID->"a446b497-51ec-4811-82a3-d275dd2c0035"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", 
       RowBox[{"{", "2", "}"}], "4"},
      "AngleSquareChain",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], ",", 
     RowBox[{"-", 
      TemplateBox[{"4", 
        RowBox[{"{", 
          RowBox[{"3", ",", "2", ",", "1"}], "}"}], "4"},
       "AngleSquareChain",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
       InterpretationFunction->(
        RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
          "$square", "]"}]& )]}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"-", 
     TemplateBox[{"1", 
       RowBox[{"{", 
         RowBox[{"2", ",", "4", ",", "3"}], "}"}], "2"},
      "AngleSquareChain",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    TemplateBox[{"4", 
      RowBox[{"{", 
        RowBox[{"3", ",", "2", ",", "6", ",", "1"}], "}"}], "2"},
     "AngleAngleChain",
     DisplayFunction->(
      RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(
      RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle",
         "]"}]& )], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"-", 
     TemplateBox[{"2", 
       RowBox[{"{", 
         RowBox[{"1", ",", "2", ",", "1", ",", "3", ",", "4"}], "}"}], "2"},
      "AngleSquareChain",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", 
      TemplateBox[{"6", 
        RowBox[{"{", "2", "}"}], "4"},
       "AngleSquareChain",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
       InterpretationFunction->(
        RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
          "$square", "]"}]& )]}], ",", 
     RowBox[{"-", 
      TemplateBox[{"4", 
        RowBox[{"{", 
          RowBox[{"3", ",", "2", ",", "1"}], "}"}], "4"},
       "AngleSquareChain",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
       InterpretationFunction->(
        RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
          "$square", "]"}]& )]}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"-", 
     TemplateBox[{"6", 
       RowBox[{"{", 
         RowBox[{"2", ",", "4", ",", "3", ",", "2", ",", "1"}], "}"}], "4"},
      "AngleSquareChain",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"-", 
     TemplateBox[{"6", 
       RowBox[{"{", 
         RowBox[{"2", ",", "3", ",", "4", ",", "1", ",", "2"}], "}"}], "4"},
      "AngleSquareChain",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"-", 
     TemplateBox[{"6", 
       RowBox[{"{", 
         RowBox[{"2", ",", "3", ",", "4", ",", "2", ",", "1"}], "}"}], "4"},
      "AngleSquareChain",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"-", 
     TemplateBox[{"6", 
       RowBox[{"{", 
         RowBox[{"2", ",", "2", ",", "1", ",", "4", ",", "3"}], "}"}], "2"},
      "AngleSquareChain",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"-", 
     TemplateBox[{"2", 
       RowBox[{"{", 
         RowBox[{"1", ",", "2", ",", "1", ",", "4", ",", "3"}], "}"}], "2"},
      "AngleSquareChain",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    TemplateBox[{"2", 
      RowBox[{"{", 
        RowBox[{"1", ",", "4", ",", "3", ",", "2", ",", "6"}], "}"}], "4"},
     "AngleSquareChain",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
     InterpretationFunction->(
      RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
        "$square", "]"}]& )], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", 
      TemplateBox[{"2", 
        RowBox[{"{", "1", "}"}], "4"},
       "AngleSquareChain",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
       InterpretationFunction->(
        RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
          "$square", "]"}]& )]}], ",", 
     RowBox[{"-", 
      TemplateBox[{"3", 
        RowBox[{"{", 
          RowBox[{"4", ",", "2", ",", "6"}], "}"}], "3"},
       "AngleSquareChain",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
       InterpretationFunction->(
        RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
          "$square", "]"}]& )]}]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{3.826025600408176*^9, 3.826025690123219*^9, 
  3.8260258051784816`*^9, 3.8260258390778217`*^9, 3.8260854156714516`*^9},
 CellLabel->"Out[79]=",ExpressionUUID->"e9268e4b-04b2-4637-aeb5-d9ad24c60851"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
   "THERE", " ", "IS", " ", "DEFINITELY", " ", "SOMETHING", " ", "WRONG"}], 
   ",", " ", 
   RowBox[{
   "WHY", " ", "ARE", " ", "THERE", " ", "SO", " ", "MANY", " ", 
    "UNCONTRACTED", " ", 
    RowBox[{"SPINORS", "?"}]}]}], "*)"}]], "Input",
 CellChangeTimes->{{3.826025905357293*^9, 
  3.826025922758808*^9}},ExpressionUUID->"a4319ac6-26ef-4d2b-81e6-\
0f47d0d2d97d"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
   "Auxiliary", " ", "function", " ", "to", " ", "test", " ", "for", " ", 
    "duplicates", " ", "in", " ", "a", " ", "list"}], ",", " ", 
   RowBox[{
   "returns", " ", "False", " ", "if", " ", "there", " ", "are", " ", "no", 
    " ", "duplicates"}]}], "*)"}]], "Input",
 CellChangeTimes->{{3.825768477952244*^9, 
  3.825768502537095*^9}},ExpressionUUID->"d4b2b5b1-1100-400c-8d76-\
f79a79792601"],

Cell[BoxData[
 RowBox[{
  RowBox[{"duplicatesQ", " ", "=", " ", 
   RowBox[{
    RowBox[{"0", " ", "===", 
     RowBox[{"Signature", "@", "#"}]}], "&"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.825768375158662*^9, 3.825768420305456*^9}},
 CellLabel->"In[5]:=",ExpressionUUID->"2707c172-17ba-4246-a014-d1d425c308cf"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
   "Auxiliary", " ", "function", " ", "for", " ", "testing", " ", "if", " ", 
    "a", " ", "contraction", " ", "is", " ", "possible"}], ",", " ", 
   RowBox[{
    RowBox[{"i", ".", "e", ".", " ", "if"}], " ", "every", " ", "bracket", 
    " ", "appears", " ", "at", " ", "most", " ", "once"}]}], "*)"}]], "Input",
 CellChangeTimes->{{3.825768686925809*^9, 3.825768698761897*^9}, {
  3.8257687466477566`*^9, 
  3.8257687555509386`*^9}},ExpressionUUID->"604b71e2-449d-4863-9d3e-\
b355a8e96a30"],

Cell[BoxData[
 RowBox[{
  RowBox[{"feasibilitytest", " ", "=", 
   RowBox[{
    RowBox[{"Or", "@@", " ", 
     RowBox[{"duplicatesQ", "/@", 
      RowBox[{"Transpose", "@", 
       RowBox[{"(", 
        RowBox[{"First", "/@", 
         RowBox[{"Transpose", "/@", "#"}]}], ")"}]}]}]}], "&"}]}], 
  ";"}]], "Input",
 CellLabel->"In[6]:=",ExpressionUUID->"dcd0d7ca-3c92-4952-9c26-b173aa55daa3"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Module", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
    "exp", ",", "ag", ",", "sq", ",", "ch", ",", "connections", ",", 
     "momenta", ",", "candidatecontractions", ",", "chains"}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"exp", "=", 
     RowBox[{"test5", "//", "Echo"}]}], ";", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{
      "Gather", " ", "by", " ", "angle", " ", "and", " ", "square", " ", 
       "head"}], ",", " ", 
      RowBox[{
      "chains", " ", "are", " ", "converted", " ", "into", " ", "angles", " ",
        "and", " ", "squares", " ", "and", " ", "in", " ", "case", " ", 
       "mixed", " ", "chains", " ", "are", " ", "found", " ", "an", " ", 
       "appropriate", " ", "connection", " ", "is", " ", 
       RowBox[{"added", ".", " ", "We"}], " ", "take", " ", "care", " ", "of",
        " ", "chains", " ", "later", " ", "on"}]}], "*)"}], 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{
      "Angle", " ", "and", " ", "square", " ", "chains", " ", "are", " ", 
       "no", " ", "problem"}], ",", " ", 
      RowBox[{
      "the", " ", "only", " ", "troublesome", " ", "are", " ", "the", " ", 
       "mixed", " ", "chains"}], ",", " ", 
      RowBox[{"these", " ", "are", " ", "kept", " ", "separate"}]}], "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", "Chain", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"Chain", "[", 
         RowBox[{"$angle", ",", "x_", ",", "y_", ",", "z_", ",", "$angle"}], 
         "]"}], ":=", 
        RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{"x", ",", "y", ",", "z"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Chain", "[", 
         RowBox[{"$square", ",", "x_", ",", "y_", ",", "z_", ",", "$square"}],
          "]"}], ":=", 
        RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{"x", ",", "y", ",", "z"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"ag", ",", "sq", ",", "ch"}], "}"}], "=", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Flatten", "[", 
              RowBox[{"#", ",", "1"}], "]"}], "&"}], "/@", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Select", "[", 
               RowBox[{"#", ",", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Head", "@", 
                    RowBox[{"First", "@", "#"}]}], "===", 
                   "SpinorAngleBracket"}], "&"}], ")"}]}], "]"}], ",", 
              RowBox[{"Select", "[", 
               RowBox[{"#", ",", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Head", "@", 
                    RowBox[{"First", "@", "#"}]}], "===", 
                   "SpinorSquareBracket"}], "&"}], ")"}]}], "]"}], ",", 
              RowBox[{"Select", "[", 
               RowBox[{"#", ",", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Head", "@", 
                    RowBox[{"First", "@", "#"}]}], "===", "Chain"}], "&"}], 
                 ")"}]}], "]"}]}], "}"}]}], "&"}], "@", 
          RowBox[{"GatherBy", "[", 
           RowBox[{"exp", ",", "Head"}], "]"}]}], "//", "Echo"}]}], ";"}]}], 
     "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
     "STILL", " ", "NEED", " ", "TO", " ", "TAKE", " ", "CARE", " ", "OF", 
      " ", "MIXED", " ", "CHAINS"}], "*)"}], "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
     "Find", " ", "the", " ", "momenta", " ", "and", " ", "their", " ", 
      "number"}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"SpinorAngleBracket", ",", "SpinorSquareBracket"}], "}"}], ",",
       "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{"x_", ",", "y_", ",", "z_"}], "]"}], ":=", 
        RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{"x", ",", "z"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{"x_", ",", "y_", ",", "z_"}], "]"}], ":=", 
        RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{"x", ",", "z"}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "These", " ", "are", " ", "the", " ", "momenta", " ", "and", " ", 
          "their", " ", 
          RowBox[{"multiplicities", ".", " ", "They"}], " ", "are", " ", 
          "found", " ", "by", " ", "extracting", " ", "all", " ", "the", " ", 
          "labels", " ", "from", " ", "the", " ", "brackest"}], ",", " ", 
         RowBox[{
         "then", " ", "counting", " ", "the", " ", "labels", " ", "and", " ", 
          "looking", " ", "at", " ", "those", " ", "which", " ", "appear", 
          " ", "both", " ", "as", " ", "angle", " ", "and", " ", 
          RowBox[{"squares", ".", " ", "Then"}], " ", "we", " ", "take", " ", 
          "the", " ", "minimum", " ", "between", " ", "the", " ", "angle", 
          " ", "and", " ", "square", " ", "appearences"}], ",", " ", 
         RowBox[{
         "the", " ", "mismatch", " ", "gives", " ", "the", " ", "helicity", 
          " ", "weight", " ", "which", " ", "we", " ", "do", " ", "not", " ", 
          "need", " ", "right", " ", "now"}], ",", " ", 
         RowBox[{
         "the", " ", "rest", " ", "is", " ", "the", " ", "number", " ", "of", 
          " ", "momenta", " ", "which", " ", "can", " ", "be", " ", 
          RowBox[{"formed", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"momenta", "=", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"First", "@", "#1"}], ",", 
                    RowBox[{"Min", "@", "#2"}]}], "}"}], "&"}], "@@@", 
                  RowBox[{"Transpose", "/@", 
                   RowBox[{"Echo", "[", 
                    RowBox[{"#", ",", "\"\<momenta2\>\""}], "]"}]}]}], "&"}], 
                "@", 
                RowBox[{"First", "@", 
                 RowBox[{"Select", "[", 
                  RowBox[{"#", ",", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "@", 
                    RowBox[{"First", "@", "#"}]}], "\[Equal]", "2"}], "&"}], 
                    ")"}]}], "]"}]}]}], "&"}], "@", 
              RowBox[{"Echo", "@", 
               RowBox[{"GatherBy", "[", 
                RowBox[{"#", ",", "Length"}], "]"}]}]}], "&"}], "@", 
            RowBox[{"Echo", "[", 
             RowBox[{"#", ",", "\"\<momenta1\>\""}], "]"}]}], "&"}], "@", 
          RowBox[{"GatherBy", "[", 
           RowBox[{
            RowBox[{"Join", "@@", 
             RowBox[{"Tally", "/@", 
              RowBox[{"Flatten", "/@", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"List", "@@@", "ag"}], ",", 
                 RowBox[{"List", "@@@", "sq"}]}], "}"}]}]}]}], ",", "First"}],
            "]"}]}], "//", 
         RowBox[{
          RowBox[{"Echo", "[", 
           RowBox[{"#", ",", "\"\<momenta3\>\""}], "]"}], "&"}]}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Extract", " ", "the", " ", "positions", " ", "of", " ", "the", " ", 
         "brackets", " ", "containg", " ", "each", " ", "momentum", " ", 
         "and", " ", "then", " ", "pair", " ", "them"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"candidatecontractions", "=", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"#", ",", "1"}], "]"}], "&"}], "/@", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"Outer", "[", 
              RowBox[{"List", ",", "#1", ",", "#2", ",", "1"}], "]"}], "&"}], 
            "@@@", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Position", "[", 
                  RowBox[{"ag", ",", "#"}], "]"}], ",", 
                 RowBox[{"Position", "[", 
                  RowBox[{"sq", ",", "#"}], "]"}]}], "}"}], "&"}], "/@", 
              RowBox[{"First", "@", 
               RowBox[{"Transpose", "@", "momenta"}]}]}], ")"}]}], ")"}]}], "//", 
         RowBox[{
          RowBox[{"Echo", "[", 
           RowBox[{"#", ",", "\"\<candidates\>\""}], "]"}], "&"}]}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Out", " ", "of", " ", "the", " ", "candidatecontractions", " ", "I", 
         " ", "have", " ", "to", " ", "select", " ", "subsets", " ", "with", 
         " ", "number", " ", "of", " ", "elements", " ", "given", " ", "by", 
         " ", "the", " ", "multiplicity", " ", "of", " ", "the", " ", "given",
          " ", "momentum", " ", "and", " ", "then", " ", "apply", " ", "a", 
         " ", "feasibility", " ", 
         RowBox[{"check", ":", " ", 
          RowBox[{
          "every", " ", "bracket", " ", "can", " ", "only", " ", "appear", 
           " ", "once", " ", "per", " ", 
           RowBox[{"momentum", "."}]}]}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"chains", "=", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Subsets", "[", 
            RowBox[{"#1", ",", 
             RowBox[{"{", "#2", "}"}]}], "]"}], "&"}], "@@@", 
          RowBox[{"Transpose", "@", 
           RowBox[{"{", 
            RowBox[{"candidatecontractions", ",", 
             RowBox[{"Last", "@", 
              RowBox[{"Transpose", "@", "momenta"}]}]}], "}"}]}]}], "//", 
         RowBox[{
          RowBox[{"Echo", "[", 
           RowBox[{"#", ",", "\"\<subsets\>\""}], "]"}], "&"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Apply", " ", 
         RowBox[{"check", ":"}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"chains", "=", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"DeleteCases", "[", 
            RowBox[{"#", ",", 
             RowBox[{"_", "?", "feasibilitytest"}]}], "]"}], "&"}], "/@", 
          "chains"}], "//", 
         RowBox[{
          RowBox[{"Echo", "[", 
           RowBox[{"#", ",", "\"\<checked\>\""}], "]"}], "&"}]}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Out", " ", "of", " ", "these", " ", "we", " ", "need", " ", "to", 
         " ", "take", " ", "all", " ", "possible", " ", 
         RowBox[{"combinations", "."}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"chains", "=", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"#", ",", "1"}], "]"}], "&"}], "/@", 
          RowBox[{"Tuples", "@", "chains"}]}], "//", 
         RowBox[{
          RowBox[{"Echo", "[", 
           RowBox[{"#", ",", "\"\<chains flattened\>\""}], "]"}], "&"}]}]}], 
       ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
     "Reoreder", " ", "list", " ", "such", " ", "that", " ", "the", " ", 
      "structure", " ", "of", " ", "contracted", " ", "chains", " ", "is", 
      " ", "visible"}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{"chains", "=", 
       RowBox[{
        RowBox[{"Apply", "[", 
         RowBox[{"chorder", ",", 
          RowBox[{
           RowBox[{
            RowBox[{"Echo", "@", 
             RowBox[{"GatherBy", "[", 
              RowBox[{"#", ",", 
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", 
                  RowBox[{"2", ",", "1"}], "]"}], "]"}], "&"}]}], "]"}]}], 
            "&"}], "/@", "chains"}], ",", 
          RowBox[{"{", "2", "}"}]}], "]"}], "//", 
        RowBox[{
         RowBox[{"Echo", "[", 
          RowBox[{"#", ",", "\"\<gathered\>\""}], "]"}], "&"}]}]}], ";"}], 
     "*)"}], "\[IndentingNewLine]", 
    RowBox[{"chains", "=", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Apply", "[", 
         RowBox[{"chorder", ",", 
          RowBox[{
           RowBox[{
            RowBox[{"Echo", "@", 
             RowBox[{"GatherBy", "[", 
              RowBox[{"#", ",", 
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", 
                  RowBox[{"2", ",", "1"}], "]"}], "]"}], "&"}]}], "]"}]}], 
            "&"}], "/@", "chains"}], ",", 
          RowBox[{"{", "2", "}"}]}], "]"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"Flatten", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"Part", "[", 
                    RowBox[{"ag", ",", "#"}], "]"}], "&"}], "/@", "#1"}], ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Part", "[", 
                    RowBox[{"sq", ",", "#"}], "]"}], "&"}], "/@", "#2"}]}], 
                 "}"}], "&"}], "@@", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Complement", "[", 
                  RowBox[{
                   RowBox[{"Range", "@", 
                    RowBox[{"Length", "@", "ag"}]}], ",", "#1"}], "]"}], ",", 
                 RowBox[{"Complement", "[", 
                  RowBox[{
                   RowBox[{"Range", "@", 
                    RowBox[{"Length", "@", "sq"}]}], ",", "#2"}], "]"}]}], 
                "}"}]}], "&"}], "@@", 
             RowBox[{"Map", "[", 
              RowBox[{"First", ",", 
               RowBox[{"Transpose", "@", "#"}], ",", 
               RowBox[{"{", "2", "}"}]}], "]"}]}], ")"}]}], "&"}], "/@", 
         "chains"}]}], "}"}], "//", 
      RowBox[{
       RowBox[{"Echo", "[", 
        RowBox[{"#", ",", "\"\<gathered\>\""}], "]"}], "&"}]}]}], ";", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
     "Next", " ", "convert", " ", "to", " ", "chains", " ", "the", " ", 
      "single", " ", "parts"}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", "chorder", "}"}], ",", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Next", " ", "we", " ", "transformtraces", " ", "from", " ", "even", 
        " ", "to", " ", "odd", " ", "chains", " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
          "so", " ", "far", " ", "we", " ", "counted", " ", "the", " ", 
           "number", " ", "of", " ", "momenta"}], ",", " ", 
          RowBox[{
          "now", " ", "we", " ", "count", " ", "the", " ", "number", " ", 
           "of", " ", "connections"}]}], ")"}]}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"chorder", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"i1_", ",", "j1_"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"i2_", ",", "j2_"}], "}"}]}], "}"}], ",", "x__", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"i1_", ",", "_"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"_", ",", "_"}], "}"}]}], "}"}]}], "]"}], ":=", 
        RowBox[{"chorder", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"i1", ",", "j1"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"i2", ",", "j2"}], "}"}]}], "}"}], ",", "x"}], "]"}]}], 
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Build", " ", "the", " ", "chains"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"chorder", "[", "exp__", "]"}], ":=", 
        RowBox[{"ChainBuilder", "[", 
         RowBox[{
          RowBox[{"{", "exp", "}"}], ",", "ag", ",", "sq"}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Flatten", "/@", 
        RowBox[{"Transpose", "@", "chains"}]}]}]}], "\[IndentingNewLine]", 
     "]"}]}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellChangeTimes->{{3.8257633957912083`*^9, 3.8257634072963395`*^9}, {
   3.825763442862852*^9, 3.825763446351156*^9}, {3.825763486450094*^9, 
   3.8257635122415795`*^9}, {3.825763545946443*^9, 3.8257635531560407`*^9}, {
   3.825763672555443*^9, 3.8257638105948033`*^9}, {3.8257640810355697`*^9, 
   3.8257641464532704`*^9}, {3.82576418876536*^9, 3.825764215337344*^9}, {
   3.8257644483513255`*^9, 3.8257645586709557`*^9}, {3.8257646282616673`*^9, 
   3.825764693162859*^9}, {3.825764749745613*^9, 3.82576493781892*^9}, {
   3.825764997654073*^9, 3.8257650023714886`*^9}, {3.8257651501945305`*^9, 
   3.8257652667679486`*^9}, {3.825765304994318*^9, 3.8257653190431633`*^9}, {
   3.8257653508255634`*^9, 3.825765353233629*^9}, {3.8257655451785936`*^9, 
   3.8257655915084543`*^9}, {3.8257656322962666`*^9, 
   3.8257657563802586`*^9}, {3.825766025982182*^9, 3.8257660365339117`*^9}, {
   3.8257661451371183`*^9, 3.825766286607415*^9}, {3.825766444878257*^9, 
   3.82576644511648*^9}, {3.825766497546246*^9, 3.825766503200699*^9}, {
   3.825766554867244*^9, 3.825766555004475*^9}, {3.825766594525688*^9, 
   3.8257666108283033`*^9}, {3.825766742074042*^9, 3.8257667822709713`*^9}, {
   3.8257668459360886`*^9, 3.8257669069201145`*^9}, {3.8257672166526003`*^9, 
   3.8257673544507656`*^9}, 3.8257674843213873`*^9, {3.8257675192376137`*^9, 
   3.825767607078309*^9}, {3.825767678174508*^9, 3.8257677014093294`*^9}, {
   3.8257677388576*^9, 3.825767756847411*^9}, {3.825768519654298*^9, 
   3.8257685612169685`*^9}, {3.8257685928356175`*^9, 
   3.8257685952883987`*^9}, {3.825768632327431*^9, 3.825768646643256*^9}, {
   3.825768971151866*^9, 3.825769002936179*^9}, {3.825769062075291*^9, 
   3.8257690942332215`*^9}, {3.82576916178439*^9, 3.8257691797055006`*^9}, {
   3.8257692187511683`*^9, 3.825769218946212*^9}, {3.8257693469402475`*^9, 
   3.8257693662467365`*^9}, 3.825769396762868*^9, 3.825769557182871*^9, {
   3.8257702302108583`*^9, 3.825770274562928*^9}, {3.8257703349656343`*^9, 
   3.8257704469528246`*^9}, {3.826002688040179*^9, 3.8260026975647497`*^9}, 
   3.8260027776355925`*^9, {3.826002815314828*^9, 3.826002848445173*^9}, {
   3.8260029316801357`*^9, 3.8260029524275894`*^9}, {3.826003047244032*^9, 
   3.826003117895957*^9}, {3.826003152626075*^9, 3.826003157795253*^9}, 
   3.8260044063048105`*^9, {3.82600449235362*^9, 3.8260045212773123`*^9}, {
   3.8260045551756516`*^9, 3.826004578331665*^9}, {3.826005677693948*^9, 
   3.8260057003972406`*^9}, {3.8260067164563046`*^9, 3.826006797051367*^9}, {
   3.8260068870818424`*^9, 3.8260069150071464`*^9}, {3.8260074604606285`*^9, 
   3.8260074938034487`*^9}, {3.8260126681374197`*^9, 3.826012672379222*^9}, {
   3.8260127137335997`*^9, 3.8260127139580154`*^9}, {3.826013333525933*^9, 
   3.82601333584968*^9}, {3.8260193852957973`*^9, 3.8260193954725823`*^9}, {
   3.826022689071634*^9, 3.8260226894905167`*^9}, {3.826022781298962*^9, 
   3.8260227887769585`*^9}, {3.826022841303457*^9, 3.8260228786455946`*^9}, {
   3.8260229652728443`*^9, 3.8260229672845087`*^9}, {3.826022999095434*^9, 
   3.826023124027236*^9}, {3.826024460490654*^9, 3.8260244607140465`*^9}, {
   3.8260249007006288`*^9, 3.826024992751486*^9}, {3.826025115673659*^9, 
   3.8260252152194633`*^9}, {3.8260252977077894`*^9, 
   3.8260253043588543`*^9}, {3.8260259285951433`*^9, 3.826025938742057*^9}, 
   3.826026005061675*^9, {3.826082835121312*^9, 3.8260828355501657`*^9}, {
   3.826084679541315*^9, 3.82608472472686*^9}, 3.8260847868046994`*^9, {
   3.8260848478171673`*^9, 3.8260848722882547`*^9}, {3.826084916568669*^9, 
   3.8260849177708845`*^9}, {3.8260849559702187`*^9, 3.826084969967075*^9}, {
   3.826085297292142*^9, 3.8260853094581733`*^9}, {3.826085348231701*^9, 
   3.8260853693404255`*^9}},
 CellLabel->"In[77]:=",ExpressionUUID->"9c45040b-3b38-4f83-9713-ce6ec2a51360"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   TemplateBox[{"1", "2"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"5", "6"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"3", "4"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"1", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"2", "3"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"2", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"2", "6"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.8260853702761965`*^9},ExpressionUUID->"db69ae52-afad-4692-8e83-\
5adf25f109ad"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "2"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"5", "6"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"3", "4"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"2", "6"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "4"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"2", "3"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"2", "4"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.826085370344103*^9},ExpressionUUID->"ae3e21f1-87a3-4583-82fa-\
5501fdca0421"],

Cell[BoxData[
 RowBox[{
  TagBox["\<\"momenta1\"\>",
   "EchoLabel"], "  ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"1", ",", "1"}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"2", ",", "2"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{"5", ",", "1"}], "}"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{"6", ",", "2"}], "}"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"3", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"3", ",", "1"}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"4", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"4", ",", "2"}], "}"}]}], "}"}]}], "}"}]}]], "Echo",
 CellChangeTimes->{
  3.826085370438753*^9},ExpressionUUID->"3efc8a58-aaed-4b92-9b1c-\
ae9b16680f1a"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"2", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"3", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"4", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"4", ",", "2"}], "}"}]}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{"5", ",", "1"}], "}"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{"6", ",", "2"}], "}"}], "}"}]}], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.8260853705441103`*^9},ExpressionUUID->"c0b50170-c127-4162-8cbe-\
d258862db91d"],

Cell[BoxData[
 RowBox[{
  TagBox["\<\"momenta2\"\>",
   "EchoLabel"], "  ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"1", ",", "1"}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"2", ",", "2"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"3", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"3", ",", "1"}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"4", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"4", ",", "2"}], "}"}]}], "}"}]}], "}"}]}]], "Echo",
 CellChangeTimes->{
  3.826085370638286*^9},ExpressionUUID->"cffde93d-2655-4449-94ee-\
7d26d4e6b541"],

Cell[BoxData[
 RowBox[{
  TagBox["\<\"momenta3\"\>",
   "EchoLabel"], "  ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"1", ",", "1"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"2", ",", "2"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"3", ",", "1"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"4", ",", "1"}], "}"}]}], "}"}]}]], "Echo",
 CellChangeTimes->{
  3.8260853707261114`*^9},ExpressionUUID->"aaab8f3f-1561-4df0-8f18-\
ab2e49470e8f"],

Cell[BoxData[
 RowBox[{
  TagBox["\<\"candidates\"\>",
   "EchoLabel"], "  ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}]}], "}"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "1"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"4", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"4", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "1"}], "}"}]}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"3", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2"}], "}"}]}], "}"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"3", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "2"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"3", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "2"}], "}"}]}], "}"}]}], "}"}]}], "}"}]}]], "Echo",
 CellChangeTimes->{
  3.8260853708180923`*^9},ExpressionUUID->"34265166-eb9e-422e-b7d6-\
488202891c10"],

Cell[BoxData[
 RowBox[{
  TagBox["\<\"subsets\"\>",
   "EchoLabel"], "  ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "1"}], "}"}]}], "}"}], "}"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"1", ",", "2"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"1", ",", "2"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"3", ",", "1"}], "}"}]}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"1", ",", "2"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"4", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "1"}], "}"}]}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"1", ",", "2"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"4", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"3", ",", "1"}], "}"}]}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"1", ",", "2"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"3", ",", "1"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"4", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "1"}], "}"}]}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"1", ",", "2"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"3", ",", "1"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"4", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"3", ",", "1"}], "}"}]}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"4", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"4", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"3", ",", "1"}], "}"}]}], "}"}]}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"3", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "2"}], "}"}]}], "}"}], "}"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"3", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "2"}], "}"}]}], "}"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"3", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "2"}], "}"}]}], "}"}], "}"}]}], "}"}]}], 
   "}"}]}]], "Echo",
 CellChangeTimes->{
  3.8260853709133873`*^9},ExpressionUUID->"91cdab64-4a46-4944-8dc2-\
bf627dc031b7"],

Cell[BoxData[
 RowBox[{
  TagBox["\<\"checked\"\>",
   "EchoLabel"], "  ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "1"}], "}"}]}], "}"}], "}"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"1", ",", "2"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"4", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"3", ",", "1"}], "}"}]}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"1", ",", "2"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"3", ",", "1"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"4", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "1"}], "}"}]}], "}"}]}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"3", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "2"}], "}"}]}], "}"}], "}"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"3", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "2"}], "}"}]}], "}"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"3", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "2"}], "}"}]}], "}"}], "}"}]}], "}"}]}], 
   "}"}]}]], "Echo",
 CellChangeTimes->{
  3.826085371008261*^9},ExpressionUUID->"00cad49b-d165-4ce6-bf07-\
4df81ca26748"],

Cell[BoxData[
 RowBox[{
  TagBox["\<\"chains flattened\"\>",
   "EchoLabel"], "  ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "1"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"4", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "1"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"3", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"3", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "2"}], "}"}]}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "1"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"4", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "1"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"3", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"3", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "2"}], "}"}]}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "1"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "1"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"4", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"3", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"3", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "2"}], "}"}]}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "1"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "1"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"4", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"3", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"3", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "2"}], "}"}]}], "}"}]}], "}"}]}], "}"}]}]], "Echo",
 CellChangeTimes->{
  3.826085371104422*^9},ExpressionUUID->"33e4d838-9bc5-4b82-aea6-\
0a23c2ce2cf0"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"3", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "2"}], "}"}]}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"3", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2"}], "}"}]}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"4", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"3", ",", "1"}], "}"}]}], "}"}], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.826085371201838*^9},ExpressionUUID->"05172b02-aa5e-4b68-95ef-\
4a45bdc616c6"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"1", ",", "1"}], "}"}]}], "}"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"3", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2"}], "}"}]}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"4", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"3", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "2"}], "}"}]}], "}"}]}], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.826085371301429*^9},ExpressionUUID->"3aa66a5e-6c1c-42cd-9cfe-\
2e07b788c16e"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"3", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "2"}], "}"}]}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "2"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"3", ",", "1"}], "}"}]}], "}"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"4", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"3", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2"}], "}"}]}], "}"}]}], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.826085371390958*^9},ExpressionUUID->"e3542ab4-69ff-448f-936a-\
96bf18cd52c0"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"1", ",", "1"}], "}"}]}], "}"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"3", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "2"}], "}"}]}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"4", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"3", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2"}], "}"}]}], "}"}]}], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.8260853714857635`*^9},ExpressionUUID->"0ed6005e-045e-485a-8397-\
fdcc6e99a2b2"],

Cell[BoxData[
 RowBox[{
  TagBox["\<\"gathered\"\>",
   "EchoLabel"], "  ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"chorder", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"4", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"3", ",", "1"}], "}"}]}], "}"}], "]"}], ",", 
        RowBox[{"chorder", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"3", ",", "1"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"1", ",", "2"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"1", ",", "1"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"1", ",", "1"}], "}"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"3", ",", "2"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"1", ",", "2"}], "}"}]}], "}"}]}], "]"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"chorder", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"4", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"3", ",", "1"}], "}"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"3", ",", "2"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"3", ",", "2"}], "}"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"3", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"1", ",", "2"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"1", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "1"}], "}"}]}], "}"}]}], "]"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"chorder", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"4", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"3", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"3", ",", "2"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "2"}], "}"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"1", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "1"}], "}"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"1", ",", "2"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"3", ",", "1"}], "}"}]}], "}"}]}], "]"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"chorder", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"4", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"3", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"3", ",", "2"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"3", ",", "2"}], "}"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"1", ",", "2"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"3", ",", "1"}], "}"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"1", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "1"}], "}"}]}], "}"}]}], "]"}], "}"}]}], "}"}], 
    ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       TemplateBox[{"5", "6"},
        "SpinorAngleBracket",
        DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
           RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
        InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
           RowBox[{#, ",", #2}], "]"}]& )], "}"}], ",", 
      RowBox[{"{", 
       TemplateBox[{"5", "6"},
        "SpinorAngleBracket",
        DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
           RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
        InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
           RowBox[{#, ",", #2}], "]"}]& )], "}"}], ",", 
      RowBox[{"{", 
       TemplateBox[{"5", "6"},
        "SpinorAngleBracket",
        DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
           RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
        InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
           RowBox[{#, ",", #2}], "]"}]& )], "}"}], ",", 
      RowBox[{"{", 
       TemplateBox[{"5", "6"},
        "SpinorAngleBracket",
        DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
           RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
        InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
           RowBox[{#, ",", #2}], "]"}]& )], "}"}]}], "}"}]}], "}"}]}]], "Echo",
 CellChangeTimes->{
  3.8260853715805626`*^9},ExpressionUUID->"0eaecc8c-df5a-4666-a74d-\
8514b42a89d8"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", 
      TemplateBox[{"6", 
        RowBox[{"{", "2", "}"}], "4"},
       "AngleSquareChain",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
       InterpretationFunction->(
        RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
          "$square", "]"}]& )]}], ",", 
     RowBox[{"-", 
      TemplateBox[{"4", 
        RowBox[{"{", 
          RowBox[{"3", ",", "2", ",", "1"}], "}"}], "4"},
       "AngleSquareChain",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
       InterpretationFunction->(
        RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
          "$square", "]"}]& )]}], ",", 
     TemplateBox[{"5", "6"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", 
      TemplateBox[{"6", 
        RowBox[{"{", 
          RowBox[{"2", ",", "4", ",", "3", ",", "2", ",", "1"}], "}"}], "4"},
       "AngleSquareChain",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
       InterpretationFunction->(
        RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
          "$square", "]"}]& )]}], ",", 
     TemplateBox[{"5", "6"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", 
      TemplateBox[{"6", 
        RowBox[{"{", 
          RowBox[{"2", ",", "3", ",", "4", ",", "1", ",", "2"}], "}"}], "4"},
       "AngleSquareChain",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
       InterpretationFunction->(
        RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
          "$square", "]"}]& )]}], ",", 
     TemplateBox[{"5", "6"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", 
      TemplateBox[{"6", 
        RowBox[{"{", 
          RowBox[{"2", ",", "3", ",", "4", ",", "2", ",", "1"}], "}"}], "4"},
       "AngleSquareChain",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
       InterpretationFunction->(
        RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
          "$square", "]"}]& )]}], ",", 
     TemplateBox[{"5", "6"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.82602593023579*^9, 3.8260259406389627`*^9}, 
   3.82602600688079*^9, 3.8260828379836564`*^9, 3.8260848788808136`*^9, 
   3.8260849765435467`*^9, 3.826085249450061*^9, 3.826085311979315*^9, {
   3.826085352968969*^9, 3.82608537167177*^9}},
 CellLabel->"Out[77]=",ExpressionUUID->"4bc84e82-5f2b-401a-a1d6-de8f89c55a7c"]
}, Open  ]],

Cell[BoxData[{
 RowBox[{"Clear", "[", "AllChains", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"AllChains", "[", "exp_List", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "ag", ",", "sq", ",", "ch", ",", "connections", ",", "momenta", ",", 
      "candidatecontractions", ",", "chains"}], "}"}], ",", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{
      "Gather", " ", "by", " ", "angle", " ", "and", " ", "square", " ", 
       "head"}], ",", " ", 
      RowBox[{
      "chains", " ", "are", " ", "converted", " ", "into", " ", "angles", " ",
        "and", " ", "squares", " ", "and", " ", "in", " ", "case", " ", 
       "mixed", " ", "chains", " ", "are", " ", "found", " ", "an", " ", 
       "appropriate", " ", "connection", " ", "is", " ", 
       RowBox[{"added", ".", " ", "We"}], " ", "take", " ", "care", " ", "of",
        " ", "chains", " ", "later", " ", "on"}]}], "*)"}], 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{
      "Angle", " ", "and", " ", "square", " ", "chains", " ", "are", " ", 
       "no", " ", "problem"}], ",", " ", 
      RowBox[{
      "the", " ", "only", " ", "troublesome", " ", "are", " ", "the", " ", 
       "mixed", " ", "chains"}], ",", " ", 
      RowBox[{"these", " ", "are", " ", "kept", " ", "separate"}]}], "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", "Chain", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"Chain", "[", 
          RowBox[{"$angle", ",", "x_", ",", "y_", ",", "z_", ",", "$angle"}], 
          "]"}], ":=", 
         RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{"x", ",", "y", ",", "z"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Chain", "[", 
          RowBox[{
          "$square", ",", "x_", ",", "y_", ",", "z_", ",", "$square"}], "]"}],
          ":=", 
         RowBox[{"SpinorSquareBracket", "[", 
          RowBox[{"x", ",", "y", ",", "z"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"ag", ",", "sq", ",", "ch"}], "}"}], "=", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Flatten", "[", 
              RowBox[{"#", ",", "1"}], "]"}], "&"}], "/@", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Select", "[", 
               RowBox[{"#", ",", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Head", "@", 
                    RowBox[{"First", "@", "#"}]}], "===", 
                   "SpinorAngleBracket"}], "&"}], ")"}]}], "]"}], ",", 
              RowBox[{"Select", "[", 
               RowBox[{"#", ",", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Head", "@", 
                    RowBox[{"First", "@", "#"}]}], "===", 
                   "SpinorSquareBracket"}], "&"}], ")"}]}], "]"}], ",", 
              RowBox[{"Select", "[", 
               RowBox[{"#", ",", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Head", "@", 
                    RowBox[{"First", "@", "#"}]}], "===", "Chain"}], "&"}], 
                 ")"}]}], "]"}]}], "}"}]}], "&"}], "@", 
          RowBox[{"GatherBy", "[", 
           RowBox[{"exp", ",", "Head"}], "]"}]}]}], ";"}]}], 
      "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "STILL", " ", "NEED", " ", "TO", " ", "TAKE", " ", "CARE", " ", "OF", 
       " ", "MIXED", " ", "CHAINS"}], "*)"}], "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Find", " ", "the", " ", "momenta", " ", "and", " ", "their", " ", 
       "number"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"SpinorAngleBracket", ",", "SpinorSquareBracket"}], "}"}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"SpinorSquareBracket", "[", 
          RowBox[{"x_", ",", "y_", ",", "z_"}], "]"}], ":=", 
         RowBox[{"SpinorSquareBracket", "[", 
          RowBox[{"x", ",", "z"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{"x_", ",", "y_", ",", "z_"}], "]"}], ":=", 
         RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{"x", ",", "z"}], "]"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
          "These", " ", "are", " ", "the", " ", "momenta", " ", "and", " ", 
           "their", " ", 
           RowBox[{"multiplicities", ".", " ", "They"}], " ", "are", " ", 
           "found", " ", "by", " ", "extracting", " ", "all", " ", "the", " ",
            "labels", " ", "from", " ", "the", " ", "brackest"}], ",", " ", 
          RowBox[{
          "then", " ", "counting", " ", "the", " ", "labels", " ", "and", " ",
            "looking", " ", "at", " ", "those", " ", "which", " ", "appear", 
           " ", "both", " ", "as", " ", "angle", " ", "and", " ", 
           RowBox[{"squares", ".", " ", "Then"}], " ", "we", " ", "take", " ",
            "the", " ", "minimum", " ", "between", " ", "the", " ", "angle", 
           " ", "and", " ", "square", " ", "appearences"}], ",", " ", 
          RowBox[{
          "the", " ", "mismatch", " ", "gives", " ", "the", " ", "helicity", 
           " ", "weight", " ", "which", " ", "we", " ", "do", " ", "not", " ",
            "need", " ", "right", " ", "now"}], ",", " ", 
          RowBox[{
          "the", " ", "rest", " ", "is", " ", "the", " ", "number", " ", "of",
            " ", "momenta", " ", "which", " ", "can", " ", "be", " ", 
           RowBox[{"formed", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"momenta", "=", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"First", "@", "#1"}], ",", 
                 RowBox[{"Min", "@", "#2"}]}], "}"}], "&"}], "@@@", 
              RowBox[{"Transpose", "/@", 
               RowBox[{"First", "@", 
                RowBox[{"Select", "[", 
                 RowBox[{"#", ",", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Length", "@", 
                    RowBox[{"First", "@", "#"}]}], "\[Equal]", "2"}], "&"}], 
                   ")"}]}], "]"}]}]}]}], "&"}], "@", 
            RowBox[{"GatherBy", "[", 
             RowBox[{"#", ",", "Length"}], "]"}]}], "&"}], "@", 
          RowBox[{"GatherBy", "[", 
           RowBox[{
            RowBox[{"Join", "@@", 
             RowBox[{"Tally", "/@", 
              RowBox[{"Flatten", "/@", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"List", "@@@", "ag"}], ",", 
                 RowBox[{"List", "@@@", "sq"}]}], "}"}]}]}]}], ",", "First"}],
            "]"}]}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Extract", " ", "the", " ", "positions", " ", "of", " ", "the", " ", 
          "brackets", " ", "containg", " ", "each", " ", "momentum", " ", 
          "and", " ", "then", " ", "pair", " ", "them"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"candidatecontractions", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"#", ",", "1"}], "]"}], "&"}], "/@", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"Outer", "[", 
              RowBox[{"List", ",", "#1", ",", "#2", ",", "1"}], "]"}], "&"}], 
            "@@@", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Position", "[", 
                  RowBox[{"ag", ",", "#"}], "]"}], ",", 
                 RowBox[{"Position", "[", 
                  RowBox[{"sq", ",", "#"}], "]"}]}], "}"}], "&"}], "/@", 
              RowBox[{"First", "@", 
               RowBox[{"Transpose", "@", "momenta"}]}]}], ")"}]}], ")"}]}]}], 
        ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Out", " ", "of", " ", "the", " ", "candidatecontractions", " ", "I",
           " ", "have", " ", "to", " ", "select", " ", "subsets", " ", "with",
           " ", "number", " ", "of", " ", "elements", " ", "given", " ", "by",
           " ", "the", " ", "multiplicity", " ", "of", " ", "the", " ", 
          "given", " ", "momentum", " ", "and", " ", "then", " ", "apply", 
          " ", "a", " ", "feasibility", " ", 
          RowBox[{"check", ":", " ", 
           RowBox[{
           "every", " ", "bracket", " ", "can", " ", "only", " ", "appear", 
            " ", "once", " ", "per", " ", 
            RowBox[{"momentum", "."}]}]}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"chains", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Subsets", "[", 
            RowBox[{"#1", ",", 
             RowBox[{"{", "#2", "}"}]}], "]"}], "&"}], "@@@", 
          RowBox[{"Transpose", "@", 
           RowBox[{"{", 
            RowBox[{"candidatecontractions", ",", 
             RowBox[{"Last", "@", 
              RowBox[{"Transpose", "@", "momenta"}]}]}], "}"}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"Apply", " ", 
          RowBox[{"check", ":"}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"chains", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"DeleteCases", "[", 
            RowBox[{"#", ",", 
             RowBox[{"_", "?", "feasibilitytest"}]}], "]"}], "&"}], "/@", 
          "chains"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Out", " ", "of", " ", "these", " ", "we", " ", "need", " ", "to", 
          " ", "take", " ", "all", " ", "possible", " ", 
          RowBox[{"combinations", "."}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"chains", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"#", ",", "1"}], "]"}], "&"}], "/@", 
          RowBox[{"Tuples", "@", "chains"}]}]}], ";"}]}], 
      "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Reoreder", " ", "list", " ", "such", " ", "that", " ", "the", " ", 
       "structure", " ", "of", " ", "contracted", " ", "chains", " ", "is", 
       " ", "visible"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"chains", "=", 
        RowBox[{
         RowBox[{"Apply", "[", 
          RowBox[{"chorder", ",", 
           RowBox[{
            RowBox[{
             RowBox[{"Echo", "@", 
              RowBox[{"GatherBy", "[", 
               RowBox[{"#", ",", 
                RowBox[{
                 RowBox[{"#", "[", 
                  RowBox[{"[", 
                   RowBox[{"2", ",", "1"}], "]"}], "]"}], "&"}]}], "]"}]}], 
             "&"}], "/@", "chains"}], ",", 
           RowBox[{"{", "2", "}"}]}], "]"}], "//", 
         RowBox[{
          RowBox[{"Echo", "[", 
           RowBox[{"#", ",", "\"\<gathered\>\""}], "]"}], "&"}]}]}], ";"}], 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"chains", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Apply", "[", 
         RowBox[{"chorder", ",", 
          RowBox[{
           RowBox[{
            RowBox[{"GatherBy", "[", 
             RowBox[{"#", ",", 
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", 
                 RowBox[{"2", ",", "1"}], "]"}], "]"}], "&"}]}], "]"}], "&"}],
            "/@", "chains"}], ",", 
          RowBox[{"{", "2", "}"}]}], "]"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"Flatten", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"Part", "[", 
                    RowBox[{"ag", ",", "#"}], "]"}], "&"}], "/@", "#1"}], ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Part", "[", 
                    RowBox[{"sq", ",", "#"}], "]"}], "&"}], "/@", "#2"}]}], 
                 "}"}], "&"}], "@@", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Complement", "[", 
                  RowBox[{
                   RowBox[{"Range", "@", 
                    RowBox[{"Length", "@", "ag"}]}], ",", "#1"}], "]"}], ",", 
                 RowBox[{"Complement", "[", 
                  RowBox[{
                   RowBox[{"Range", "@", 
                    RowBox[{"Length", "@", "sq"}]}], ",", "#2"}], "]"}]}], 
                "}"}]}], "&"}], "@@", 
             RowBox[{"Map", "[", 
              RowBox[{"First", ",", 
               RowBox[{"Transpose", "@", "#"}], ",", 
               RowBox[{"{", "2", "}"}]}], "]"}]}], ")"}]}], "&"}], "/@", 
         "chains"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Next", " ", "convert", " ", "to", " ", "chains", " ", "the", " ", 
       "single", " ", "parts"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", "chorder", "}"}], ",", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Next", " ", "we", " ", "transformtraces", " ", "from", " ", "even", 
         " ", "to", " ", "odd", " ", "chains", " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
           "so", " ", "far", " ", "we", " ", "counted", " ", "the", " ", 
            "number", " ", "of", " ", "momenta"}], ",", " ", 
           RowBox[{
           "now", " ", "we", " ", "count", " ", "the", " ", "number", " ", 
            "of", " ", "connections"}]}], ")"}]}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"chorder", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"i1_", ",", "j1_"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"i2_", ",", "j2_"}], "}"}]}], "}"}], ",", "x__", ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"i1_", ",", "_"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"_", ",", "_"}], "}"}]}], "}"}]}], "]"}], ":=", 
         RowBox[{"chorder", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"i1", ",", "j1"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"i2", ",", "j2"}], "}"}]}], "}"}], ",", "x"}], "]"}]}], 
        ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"Build", " ", "the", " ", "chains"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"chorder", "[", "x__", "]"}], ":=", 
         RowBox[{"ChainBuilder", "[", 
          RowBox[{
           RowBox[{"{", "x", "}"}], ",", "ag", ",", "sq"}], "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"Flatten", "/@", 
         RowBox[{"Transpose", "@", "chains"}]}]}]}], "\[IndentingNewLine]", 
      "]"}]}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.8260854674909954`*^9, 3.8260855958631334`*^9}},
 CellLabel->"In[83]:=",ExpressionUUID->"19e95b48-46f7-4530-9445-3054af918569"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"AllChains", "[", "test", "]"}], "//", "RepeatedTiming"}]], "Input",
 CellChangeTimes->{{3.826085572734249*^9, 3.8260856042762227`*^9}},
 CellLabel->"In[86]:=",ExpressionUUID->"ff9a93be-2f9b-425f-a824-88199b4526bb"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.00077399619140625`", ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"-", 
        TemplateBox[{"4", 
          RowBox[{"{", 
            RowBox[{"3", ",", "2", ",", "1"}], "}"}], "4"},
         "AngleSquareChain",
         DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
         InterpretationFunction->(
          RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
            "$square", "]"}]& )]}], ",", 
       TemplateBox[{"5", "6"},
        "SpinorAngleBracket",
        DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
           RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
        InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
           RowBox[{#, ",", #2}], "]"}]& )], ",", 
       TemplateBox[{"2", "4"},
        "SpinorSquareBracket",
        DisplayFunction->(RowBox[{"[", 
           RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
        InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
           RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       TemplateBox[{"4", 
         RowBox[{"{", 
           RowBox[{"1", ",", "2", ",", "3", ",", "4"}], "}"}], "2"},
        "SquareSquareChain",
        DisplayFunction->(RowBox[{"[", #, #2, #3, "]"}]& ),
        InterpretationFunction->(
         RowBox[{"Chain", "[", "$square", ",", #, ",", #2, ",", #3, ",", 
           "$square", "]"}]& )], ",", 
       TemplateBox[{"5", "6"},
        "SpinorAngleBracket",
        DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
           RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
        InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
           RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       TemplateBox[{"4", 
         RowBox[{"{", 
           RowBox[{"2", ",", "1", ",", "4", ",", "3"}], "}"}], "2"},
        "SquareSquareChain",
        DisplayFunction->(RowBox[{"[", #, #2, #3, "]"}]& ),
        InterpretationFunction->(
         RowBox[{"Chain", "[", "$square", ",", #, ",", #2, ",", #3, ",", 
           "$square", "]"}]& )], ",", 
       TemplateBox[{"5", "6"},
        "SpinorAngleBracket",
        DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
           RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
        InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
           RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       TemplateBox[{"4", 
         RowBox[{"{", 
           RowBox[{"1", ",", "2", ",", "4", ",", "3"}], "}"}], "2"},
        "SquareSquareChain",
        DisplayFunction->(RowBox[{"[", #, #2, #3, "]"}]& ),
        InterpretationFunction->(
         RowBox[{"Chain", "[", "$square", ",", #, ",", #2, ",", #3, ",", 
           "$square", "]"}]& )], ",", 
       TemplateBox[{"5", "6"},
        "SpinorAngleBracket",
        DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
           RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
        InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
           RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}], "}"}]}], 
  "}"}]], "Output",
 CellChangeTimes->{{3.826085577677802*^9, 3.8260856061790605`*^9}},
 CellLabel->"Out[86]=",ExpressionUUID->"9fdf4d7d-209a-455d-8cec-0b7cca6e212f"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"AllChains", "[", "test5", "]"}]], "Input",
 CellChangeTimes->{{3.8260856234979157`*^9, 3.826085627395957*^9}},
 CellLabel->"In[87]:=",ExpressionUUID->"0ba7ca99-503c-43f6-a675-164e09923def"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", 
      TemplateBox[{"6", 
        RowBox[{"{", "2", "}"}], "4"},
       "AngleSquareChain",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
       InterpretationFunction->(
        RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
          "$square", "]"}]& )]}], ",", 
     RowBox[{"-", 
      TemplateBox[{"4", 
        RowBox[{"{", 
          RowBox[{"3", ",", "2", ",", "1"}], "}"}], "4"},
       "AngleSquareChain",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
       InterpretationFunction->(
        RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
          "$square", "]"}]& )]}], ",", 
     TemplateBox[{"5", "6"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", 
      TemplateBox[{"6", 
        RowBox[{"{", 
          RowBox[{"2", ",", "4", ",", "3", ",", "2", ",", "1"}], "}"}], "4"},
       "AngleSquareChain",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
       InterpretationFunction->(
        RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
          "$square", "]"}]& )]}], ",", 
     TemplateBox[{"5", "6"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", 
      TemplateBox[{"6", 
        RowBox[{"{", 
          RowBox[{"2", ",", "3", ",", "4", ",", "1", ",", "2"}], "}"}], "4"},
       "AngleSquareChain",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
       InterpretationFunction->(
        RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
          "$square", "]"}]& )]}], ",", 
     TemplateBox[{"5", "6"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", 
      TemplateBox[{"6", 
        RowBox[{"{", 
          RowBox[{"2", ",", "3", ",", "4", ",", "2", ",", "1"}], "}"}], "4"},
       "AngleSquareChain",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
       InterpretationFunction->(
        RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
          "$square", "]"}]& )]}], ",", 
     TemplateBox[{"5", "6"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{3.8260856277182045`*^9},
 CellLabel->"Out[87]=",ExpressionUUID->"2c9d953f-1303-4ec9-ab95-89a32dc408c0"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "With", " ", "mixed", " ", "chains", " ", "in", " ", "the", " ", "game"}], 
  "*)"}]], "Input",
 CellChangeTimes->{{3.8260860218662634`*^9, 
  3.826086032538863*^9}},ExpressionUUID->"2b7ad543-32b2-442e-876e-\
b397c67b688d"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"test8", "=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"Chain", "[", 
     RowBox[{"$angle", ",", "1", ",", 
      RowBox[{"{", "2", "}"}], ",", "3", ",", "$square"}], "]"}], ",", 
    TemplateBox[{"3", "4"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"5", "6"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}]], "Input",
 CellChangeTimes->{{3.826086064118992*^9, 3.8260861126721992`*^9}},
 CellLabel->"In[47]:=",ExpressionUUID->"7fb3fb6e-a4b0-47db-b348-aaa8b73b4b25"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   TemplateBox[{"1", 
     RowBox[{"{", "2", "}"}], "3"},
    "AngleSquareChain",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square",
        "]"}]& )], ",", 
   TemplateBox[{"3", "4"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"5", "6"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]], "Output",
 CellChangeTimes->{3.8260861138243246`*^9},
 CellLabel->"Out[47]=",ExpressionUUID->"affdc8e3-532f-48f1-961f-328fe6f9dcb9"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Module", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
    "exp", ",", "ag", ",", "sq", ",", "ch", ",", "connections", ",", 
     "momenta", ",", "candidatecontractions", ",", "chains", ",", "pp", ",", 
     "unique", ",", "sign"}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"exp", "=", 
     RowBox[{"test8", "//", "Echo"}]}], ";", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{
      "Gather", " ", "by", " ", "angle", " ", "and", " ", "square", " ", 
       "head"}], ",", " ", 
      RowBox[{
      "chains", " ", "are", " ", "converted", " ", "into", " ", "angles", " ",
        "and", " ", "squares", " ", "and", " ", "in", " ", "case", " ", 
       "mixed", " ", "chains", " ", "are", " ", "found", " ", "an", " ", 
       "appropriate", " ", "connection", " ", "is", " ", 
       RowBox[{"added", ".", " ", "We"}], " ", "take", " ", "care", " ", "of",
        " ", "chains", " ", "later", " ", "on"}]}], "*)"}], 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{
      "Angle", " ", "and", " ", "square", " ", "chains", " ", "are", " ", 
       "no", " ", "problem"}], ",", " ", 
      RowBox[{
      "the", " ", "only", " ", "troublesome", " ", "are", " ", "the", " ", 
       "mixed", " ", "chains"}], ",", " ", 
      RowBox[{"these", " ", "are", " ", "kept", " ", "separate"}]}], "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", "Chain", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"Chain", "[", 
         RowBox[{"$angle", ",", "x_", ",", "y_", ",", "z_", ",", "$angle"}], 
         "]"}], ":=", 
        RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{"x", ",", "y", ",", "z"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Chain", "[", 
         RowBox[{"$square", ",", "x_", ",", "y_", ",", "z_", ",", "$square"}],
          "]"}], ":=", 
        RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{"x", ",", "y", ",", "z"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"ag", ",", "sq", ",", "ch"}], "}"}], "=", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Flatten", "[", 
              RowBox[{"#", ",", "1"}], "]"}], "&"}], "/@", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Select", "[", 
               RowBox[{"#", ",", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Head", "@", 
                    RowBox[{"First", "@", "#"}]}], "===", 
                   "SpinorAngleBracket"}], "&"}], ")"}]}], "]"}], ",", 
              RowBox[{"Select", "[", 
               RowBox[{"#", ",", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Head", "@", 
                    RowBox[{"First", "@", "#"}]}], "===", 
                   "SpinorSquareBracket"}], "&"}], ")"}]}], "]"}], ",", 
              RowBox[{"Select", "[", 
               RowBox[{"#", ",", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Head", "@", 
                    RowBox[{"First", "@", "#"}]}], "===", "Chain"}], "&"}], 
                 ")"}]}], "]"}]}], "}"}]}], "&"}], "@", 
          RowBox[{"GatherBy", "[", 
           RowBox[{"exp", ",", "Head"}], "]"}]}], "//", "Echo"}]}], ";"}]}], 
     "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{
      "In", " ", "order", " ", "to", " ", "take", " ", "care", " ", "of", " ",
        "mixed", " ", "chains", " ", "in", " ", "a", " ", "simple", " ", 
       "way", " ", "we", " ", "decompose", " ", "them", " ", "into", " ", 
       "an", " ", "angle", " ", "and", " ", "square", " ", "bracket", " ", 
       "and", " ", "add", " ", "a", " ", "fixed", " ", "connection", " ", 
       "to", " ", "the", " ", "list", " ", "of", " ", "connections"}], ",", 
      " ", 
      RowBox[{"the", " ", "rest", " ", "follows", " ", "automatically"}]}], 
     "*)"}], "\[IndentingNewLine]", 
    RowBox[{"sign", "=", "1"}], ";", "\[IndentingNewLine]", 
    RowBox[{"Do", "[", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
       "Decomposition", " ", "into", " ", "angle", " ", "and", " ", "square", 
        " ", "is", " ", "done", " ", "by", " ", "introducing", " ", "a", " ", 
        "unique", " ", "label", " ", "fro", " ", "each", " ", "chain"}], ",", 
       " ", 
       RowBox[{
       "so", " ", "that", " ", "later", " ", "on", " ", "when", " ", 
        "contractions", " ", "are", " ", "performed", " ", "there", " ", 
        "will", " ", "be", " ", "exactly", " ", "for", " ", "each", " ", "of",
         " ", 
        RowBox[{"these", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"ag", "=", 
        RowBox[{"Join", "[", 
         RowBox[{"ag", ",", 
          RowBox[{"{", 
           RowBox[{"SpinorAngleBracket", "[", 
            RowBox[{
             RowBox[{"i", "[", 
              RowBox[{"[", "2", "]"}], "]"}], ",", 
             RowBox[{"Most", "@", 
              RowBox[{"i", "[", 
               RowBox[{"[", "3", "]"}], "]"}]}], ",", 
             RowBox[{"unique", "=", 
              RowBox[{"pp", "[", 
               RowBox[{
                RowBox[{"Last", "@", 
                 RowBox[{"i", "[", 
                  RowBox[{"[", "3", "]"}], "]"}]}], ",", 
                RowBox[{"Unique", "[", "]"}]}], "]"}]}]}], "]"}], "}"}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"OrderedQ", "[", 
          RowBox[{"{", 
           RowBox[{"unique", ",", 
            RowBox[{"i", "[", 
             RowBox[{"[", "4", "]"}], "]"}]}], "}"}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"sq", "=", 
           RowBox[{"Join", "[", 
            RowBox[{"sq", ",", 
             RowBox[{"{", 
              RowBox[{"SpinorSquareBracket", "[", 
               RowBox[{"unique", ",", 
                RowBox[{"i", "[", 
                 RowBox[{"[", "4", "]"}], "]"}]}], "]"}], "}"}]}], "]"}]}], 
          ";"}], "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
          "Sign", " ", "keeps", " ", "track", " ", "of", " ", "signs", " ", 
           "since", " ", "the", " ", "arguments", " ", "of", " ", "the", " ", 
           "brackets", " ", "need", " ", "to", " ", "be", " ", "correctly", 
           " ", "ordered", " ", 
           RowBox[{"(", 
            RowBox[{
            "this", " ", "was", " ", "an", " ", "initial", " ", "assumption", 
             " ", "on", " ", "the", " ", "input", " ", "list", " ", "so", " ",
              "it", " ", "must", " ", "be", " ", "mantained"}], ")"}]}], 
          "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"sign", "=", 
           RowBox[{
            RowBox[{"-", "1"}], "*", "sign"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"sq", "=", 
           RowBox[{"Join", "[", 
            RowBox[{"sq", ",", 
             RowBox[{"{", 
              RowBox[{"SpinorSquareBracket", "[", 
               RowBox[{
                RowBox[{"i", "[", 
                 RowBox[{"[", "4", "]"}], "]"}], ",", "unique"}], "]"}], 
              "}"}]}], "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";"}], 
      "\[IndentingNewLine]", ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", "ch"}], "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
     "Find", " ", "the", " ", "momenta", " ", "and", " ", "their", " ", 
      "number"}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"SpinorAngleBracket", ",", "SpinorSquareBracket"}], "}"}], ",",
       "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{"x_", ",", "y_", ",", "z_"}], "]"}], ":=", 
        RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{"x", ",", "z"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{"x_", ",", "y_", ",", "z_"}], "]"}], ":=", 
        RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{"x", ",", "z"}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "These", " ", "are", " ", "the", " ", "momenta", " ", "and", " ", 
          "their", " ", 
          RowBox[{"multiplicities", ".", " ", "They"}], " ", "are", " ", 
          "found", " ", "by", " ", "extracting", " ", "all", " ", "the", " ", 
          "labels", " ", "from", " ", "the", " ", "brackest"}], ",", " ", 
         RowBox[{
         "then", " ", "counting", " ", "the", " ", "labels", " ", "and", " ", 
          "looking", " ", "at", " ", "those", " ", "which", " ", "appear", 
          " ", "both", " ", "as", " ", "angle", " ", "and", " ", 
          RowBox[{"squares", ".", " ", "Then"}], " ", "we", " ", "take", " ", 
          "the", " ", "minimum", " ", "between", " ", "the", " ", "angle", 
          " ", "and", " ", "square", " ", "appearences"}], ",", " ", 
         RowBox[{
         "the", " ", "mismatch", " ", "gives", " ", "the", " ", "helicity", 
          " ", "weight", " ", "which", " ", "we", " ", "do", " ", "not", " ", 
          "need", " ", "right", " ", "now"}], ",", " ", 
         RowBox[{
         "the", " ", "rest", " ", "is", " ", "the", " ", "number", " ", "of", 
          " ", "momenta", " ", "which", " ", "can", " ", "be", " ", 
          RowBox[{"formed", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", 
           RowBox[{"momenta", "=", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"Select", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "@", 
                    RowBox[{"First", "@", "#"}]}], "\[Equal]", "2"}], "&"}], 
                    ")"}]}], "]"}], "&"}], "@", 
                  RowBox[{"Echo", "@", 
                   RowBox[{"GatherBy", "[", 
                    RowBox[{"#", ",", "Length"}], "]"}]}]}], "&"}], "@", 
                RowBox[{"Echo", "[", 
                 RowBox[{"#", ",", "\"\<momenta1\>\""}], "]"}]}], "&"}], "@", 
              RowBox[{"GatherBy", "[", 
               RowBox[{
                RowBox[{"Join", "@@", 
                 RowBox[{"Tally", "/@", 
                  RowBox[{"Flatten", "/@", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"List", "@@@", "ag"}], ",", 
                    RowBox[{"List", "@@@", "sq"}]}], "}"}]}]}]}], ",", 
                "First"}], "]"}]}], "//", 
             RowBox[{
              RowBox[{"Echo", "[", 
               RowBox[{"#", ",", "\"\<momenta3\>\""}], "]"}], "&"}]}]}], 
           "]"}], ">", "0"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"momenta", "=", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"First", "@", "#1"}], ",", 
                 RowBox[{"Min", "@", "#2"}]}], "}"}], "&"}], "@@@", 
              RowBox[{"Transpose", "/@", 
               RowBox[{"Echo", "[", 
                RowBox[{"#", ",", "\"\<momenta2\>\""}], "]"}]}]}], "&"}], "@", 
            RowBox[{"First", "@", "momenta"}]}]}], ";"}], 
         "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{
            RowBox[{"If", " ", "momenta", " ", "has", " ", "length"}], "=", 
            RowBox[{
            "0", " ", "no", " ", "momenta", " ", "are", " ", "presents"}]}], 
           ",", " ", 
           RowBox[{
           "no", " ", "contractions", " ", "can", " ", "be", " ", "made", " ",
             "and", " ", "we", " ", "return", " ", "the", " ", "input", " ", 
            "list", " ", "as", " ", "it", " ", "is"}]}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Return", "[", "exp", "]"}], ";"}]}], "\[IndentingNewLine]",
         "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Extract", " ", "the", " ", "positions", " ", "of", " ", "the", " ", 
         "brackets", " ", "containg", " ", "each", " ", "momentum", " ", 
         "and", " ", "then", " ", "pair", " ", "them"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"candidatecontractions", "=", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"#", ",", "1"}], "]"}], "&"}], "/@", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"Outer", "[", 
              RowBox[{"List", ",", "#1", ",", "#2", ",", "1"}], "]"}], "&"}], 
            "@@@", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Position", "[", 
                  RowBox[{"ag", ",", "#"}], "]"}], ",", 
                 RowBox[{"Position", "[", 
                  RowBox[{"sq", ",", "#"}], "]"}]}], "}"}], "&"}], "/@", 
              RowBox[{"First", "@", 
               RowBox[{"Transpose", "@", "momenta"}]}]}], ")"}]}], ")"}]}], "//", 
         RowBox[{
          RowBox[{"Echo", "[", 
           RowBox[{"#", ",", "\"\<candidates\>\""}], "]"}], "&"}]}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Out", " ", "of", " ", "the", " ", "candidatecontractions", " ", "I", 
         " ", "have", " ", "to", " ", "select", " ", "subsets", " ", "with", 
         " ", "number", " ", "of", " ", "elements", " ", "given", " ", "by", 
         " ", "the", " ", "multiplicity", " ", "of", " ", "the", " ", "given",
          " ", "momentum", " ", "and", " ", "then", " ", "apply", " ", "a", 
         " ", "feasibility", " ", 
         RowBox[{"check", ":", " ", 
          RowBox[{
          "every", " ", "bracket", " ", "can", " ", "only", " ", "appear", 
           " ", "once", " ", "per", " ", 
           RowBox[{"momentum", "."}]}]}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"chains", "=", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Subsets", "[", 
            RowBox[{"#1", ",", 
             RowBox[{"{", "#2", "}"}]}], "]"}], "&"}], "@@@", 
          RowBox[{"Transpose", "@", 
           RowBox[{"{", 
            RowBox[{"candidatecontractions", ",", 
             RowBox[{"Last", "@", 
              RowBox[{"Transpose", "@", "momenta"}]}]}], "}"}]}]}], "//", 
         RowBox[{
          RowBox[{"Echo", "[", 
           RowBox[{"#", ",", "\"\<subsets\>\""}], "]"}], "&"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Apply", " ", 
         RowBox[{"check", ":"}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"chains", "=", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"DeleteCases", "[", 
            RowBox[{"#", ",", 
             RowBox[{"_", "?", "feasibilitytest"}]}], "]"}], "&"}], "/@", 
          "chains"}], "//", 
         RowBox[{
          RowBox[{"Echo", "[", 
           RowBox[{"#", ",", "\"\<checked\>\""}], "]"}], "&"}]}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Out", " ", "of", " ", "these", " ", "we", " ", "need", " ", "to", 
         " ", "take", " ", "all", " ", "possible", " ", 
         RowBox[{"combinations", "."}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"chains", "=", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"#", ",", "1"}], "]"}], "&"}], "/@", 
          RowBox[{"Tuples", "@", "chains"}]}], "//", 
         RowBox[{
          RowBox[{"Echo", "[", 
           RowBox[{"#", ",", "\"\<chains flattened\>\""}], "]"}], "&"}]}]}], 
       ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
     "Reoreder", " ", "list", " ", "such", " ", "that", " ", "the", " ", 
      "structure", " ", "of", " ", "contracted", " ", "chains", " ", "is", 
      " ", "visible"}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{"chains", "=", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Apply", "[", 
         RowBox[{"chorder", ",", 
          RowBox[{
           RowBox[{
            RowBox[{"Echo", "@", 
             RowBox[{"GatherBy", "[", 
              RowBox[{"#", ",", 
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", 
                  RowBox[{"2", ",", "1"}], "]"}], "]"}], "&"}]}], "]"}]}], 
            "&"}], "/@", "chains"}], ",", 
          RowBox[{"{", "2", "}"}]}], "]"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"Flatten", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"sign", ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Part", "[", 
                    RowBox[{"ag", ",", "#"}], "]"}], "&"}], "/@", "#1"}], ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Part", "[", 
                    RowBox[{"sq", ",", "#"}], "]"}], "&"}], "/@", "#2"}]}], 
                 "}"}], "&"}], "@@", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Complement", "[", 
                  RowBox[{
                   RowBox[{"Range", "@", 
                    RowBox[{"Length", "@", "ag"}]}], ",", "#1"}], "]"}], ",", 
                 RowBox[{"Complement", "[", 
                  RowBox[{
                   RowBox[{"Range", "@", 
                    RowBox[{"Length", "@", "sq"}]}], ",", "#2"}], "]"}]}], 
                "}"}]}], "&"}], "@@", 
             RowBox[{"Map", "[", 
              RowBox[{"First", ",", 
               RowBox[{"Transpose", "@", "#"}], ",", 
               RowBox[{"{", "2", "}"}]}], "]"}]}], ")"}]}], "&"}], "/@", 
         "chains"}]}], "}"}], "//", 
      RowBox[{
       RowBox[{"Echo", "[", 
        RowBox[{"#", ",", "\"\<gathered\>\""}], "]"}], "&"}]}]}], ";", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
     "Next", " ", "convert", " ", "to", " ", "chains", " ", "the", " ", 
      "single", " ", "parts"}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", "chorder", "}"}], ",", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Next", " ", "we", " ", "transformtraces", " ", "from", " ", "even", 
        " ", "to", " ", "odd", " ", "chains", " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
          "so", " ", "far", " ", "we", " ", "counted", " ", "the", " ", 
           "number", " ", "of", " ", "momenta"}], ",", " ", 
          RowBox[{
          "now", " ", "we", " ", "count", " ", "the", " ", "number", " ", 
           "of", " ", "connections"}]}], ")"}]}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"chorder", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"i1_", ",", "j1_"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"i2_", ",", "j2_"}], "}"}]}], "}"}], ",", "x__", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"i1_", ",", "_"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"_", ",", "_"}], "}"}]}], "}"}]}], "]"}], ":=", 
        RowBox[{"chorder", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"i1", ",", "j1"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"i2", ",", "j2"}], "}"}]}], "}"}], ",", "x"}], "]"}]}], 
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Build", " ", "the", " ", "chains"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"chorder", "[", "exp__", "]"}], ":=", 
        RowBox[{"ChainBuilder", "[", 
         RowBox[{
          RowBox[{"{", "exp", "}"}], ",", "ag", ",", "sq"}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Reconvert", " ", "unique", " ", "labels", " ", "for", " ", "mixed", 
         " ", "chains", " ", "into", " ", "original", " ", "labels"}], "*)"}],
        "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"pp", "[", 
         RowBox[{"x_", ",", "_"}], "]"}], ":=", "x"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Flatten", "/@", 
        RowBox[{"Transpose", "@", "chains"}]}]}]}], "\[IndentingNewLine]", 
     "]"}]}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellChangeTimes->{{3.8257633957912083`*^9, 3.8257634072963395`*^9}, {
   3.825763442862852*^9, 3.825763446351156*^9}, {3.825763486450094*^9, 
   3.8257635122415795`*^9}, {3.825763545946443*^9, 3.8257635531560407`*^9}, {
   3.825763672555443*^9, 3.8257638105948033`*^9}, {3.8257640810355697`*^9, 
   3.8257641464532704`*^9}, {3.82576418876536*^9, 3.825764215337344*^9}, {
   3.8257644483513255`*^9, 3.8257645586709557`*^9}, {3.8257646282616673`*^9, 
   3.825764693162859*^9}, {3.825764749745613*^9, 3.82576493781892*^9}, {
   3.825764997654073*^9, 3.8257650023714886`*^9}, {3.8257651501945305`*^9, 
   3.8257652667679486`*^9}, {3.825765304994318*^9, 3.8257653190431633`*^9}, {
   3.8257653508255634`*^9, 3.825765353233629*^9}, {3.8257655451785936`*^9, 
   3.8257655915084543`*^9}, {3.8257656322962666`*^9, 
   3.8257657563802586`*^9}, {3.825766025982182*^9, 3.8257660365339117`*^9}, {
   3.8257661451371183`*^9, 3.825766286607415*^9}, {3.825766444878257*^9, 
   3.82576644511648*^9}, {3.825766497546246*^9, 3.825766503200699*^9}, {
   3.825766554867244*^9, 3.825766555004475*^9}, {3.825766594525688*^9, 
   3.8257666108283033`*^9}, {3.825766742074042*^9, 3.8257667822709713`*^9}, {
   3.8257668459360886`*^9, 3.8257669069201145`*^9}, {3.8257672166526003`*^9, 
   3.8257673544507656`*^9}, 3.8257674843213873`*^9, {3.8257675192376137`*^9, 
   3.825767607078309*^9}, {3.825767678174508*^9, 3.8257677014093294`*^9}, {
   3.8257677388576*^9, 3.825767756847411*^9}, {3.825768519654298*^9, 
   3.8257685612169685`*^9}, {3.8257685928356175`*^9, 
   3.8257685952883987`*^9}, {3.825768632327431*^9, 3.825768646643256*^9}, {
   3.825768971151866*^9, 3.825769002936179*^9}, {3.825769062075291*^9, 
   3.8257690942332215`*^9}, {3.82576916178439*^9, 3.8257691797055006`*^9}, {
   3.8257692187511683`*^9, 3.825769218946212*^9}, {3.8257693469402475`*^9, 
   3.8257693662467365`*^9}, 3.825769396762868*^9, 3.825769557182871*^9, {
   3.8257702302108583`*^9, 3.825770274562928*^9}, {3.8257703349656343`*^9, 
   3.8257704469528246`*^9}, {3.826002688040179*^9, 3.8260026975647497`*^9}, 
   3.8260027776355925`*^9, {3.826002815314828*^9, 3.826002848445173*^9}, {
   3.8260029316801357`*^9, 3.8260029524275894`*^9}, {3.826003047244032*^9, 
   3.826003117895957*^9}, {3.826003152626075*^9, 3.826003157795253*^9}, 
   3.8260044063048105`*^9, {3.82600449235362*^9, 3.8260045212773123`*^9}, {
   3.8260045551756516`*^9, 3.826004578331665*^9}, {3.826005677693948*^9, 
   3.8260057003972406`*^9}, {3.8260067164563046`*^9, 3.826006797051367*^9}, {
   3.8260068870818424`*^9, 3.8260069150071464`*^9}, {3.8260074604606285`*^9, 
   3.8260074938034487`*^9}, {3.8260126681374197`*^9, 3.826012672379222*^9}, {
   3.8260127137335997`*^9, 3.8260127139580154`*^9}, {3.826013333525933*^9, 
   3.82601333584968*^9}, {3.8260193852957973`*^9, 3.8260193954725823`*^9}, {
   3.826022689071634*^9, 3.8260226894905167`*^9}, {3.826022781298962*^9, 
   3.8260227887769585`*^9}, {3.826022841303457*^9, 3.8260228786455946`*^9}, {
   3.8260229652728443`*^9, 3.8260229672845087`*^9}, {3.826022999095434*^9, 
   3.826023124027236*^9}, {3.826024460490654*^9, 3.8260244607140465`*^9}, {
   3.8260249007006288`*^9, 3.826024992751486*^9}, {3.826025115673659*^9, 
   3.8260252152194633`*^9}, {3.8260252977077894`*^9, 
   3.8260253043588543`*^9}, {3.8260259285951433`*^9, 3.826025938742057*^9}, 
   3.826026005061675*^9, {3.826082835121312*^9, 3.8260828355501657`*^9}, {
   3.826084679541315*^9, 3.82608472472686*^9}, 3.8260847868046994`*^9, {
   3.8260848478171673`*^9, 3.8260848722882547`*^9}, {3.826084916568669*^9, 
   3.8260849177708845`*^9}, {3.8260849559702187`*^9, 3.826084969967075*^9}, {
   3.826085297292142*^9, 3.8260853094581733`*^9}, {3.826085348231701*^9, 
   3.8260853693404255`*^9}, {3.8260861250294886`*^9, 
   3.8260861254669843`*^9}, {3.8260863982943273`*^9, 
   3.8260864028130226`*^9}, {3.8260865579180875`*^9, 3.826086598524506*^9}, {
   3.8260866363353157`*^9, 3.8260866770439453`*^9}, {3.826086835025049*^9, 
   3.8260869378986597`*^9}, {3.8260869679237432`*^9, 3.826086986661147*^9}, {
   3.8260870287013893`*^9, 3.8260870632604246`*^9}, {3.8260872737392473`*^9, 
   3.8260873321681943`*^9}, {3.826088829812373*^9, 3.826089008437137*^9}, {
   3.8260890442247577`*^9, 3.8260890590568*^9}, {3.826089463549985*^9, 
   3.8260896024230795`*^9}, {3.8260896480492887`*^9, 3.826089668833843*^9}, {
   3.8260899303306036`*^9, 3.826089931717492*^9}},
 CellLabel->"In[82]:=",ExpressionUUID->"13e8ffc4-cc19-4012-a9dc-3d87c02c4bc1"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   TemplateBox[{"1", 
     RowBox[{"{", "2", "}"}], "3"},
    "AngleSquareChain",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
    InterpretationFunction->(
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square",
        "]"}]& )], ",", 
   TemplateBox[{"3", "4"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], ",", 
   TemplateBox[{"5", "6"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.8260899332676153`*^9},ExpressionUUID->"eecd9a29-9c17-480d-86cb-\
b9953b40c95a"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    TemplateBox[{"3", "4"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "}"}], ",", 
   RowBox[{"{", 
    TemplateBox[{"5", "6"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"Chain", "[", 
     RowBox[{"$angle", ",", "1", ",", 
      RowBox[{"{", "2", "}"}], ",", "3", ",", "$square"}], "]"}], "}"}]}], 
  "}"}]], "Echo",
 CellChangeTimes->{
  3.826089933350329*^9},ExpressionUUID->"f322f312-b439-42c3-9822-\
b10d6a5248d6"],

Cell[BoxData[
 RowBox[{
  TagBox["\<\"momenta1\"\>",
   "EchoLabel"], "  ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"3", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"3", ",", "1"}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{"4", ",", "1"}], "}"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{"1", ",", "1"}], "}"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"pp$35086", "[", 
         RowBox[{"2", ",", "$15"}], "]"}], ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"pp$35086", "[", 
         RowBox[{"2", ",", "$15"}], "]"}], ",", "1"}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{"5", ",", "1"}], "}"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{"6", ",", "1"}], "}"}], "}"}]}], "}"}]}]], "Echo",
 CellChangeTimes->{
  3.826089933438342*^9},ExpressionUUID->"ec0c10db-7c0a-42bf-b579-\
7c02bb78a8f8"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"3", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"pp$35086", "[", 
          RowBox[{"2", ",", "$15"}], "]"}], ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"pp$35086", "[", 
          RowBox[{"2", ",", "$15"}], "]"}], ",", "1"}], "}"}]}], "}"}]}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{"4", ",", "1"}], "}"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{"1", ",", "1"}], "}"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{"5", ",", "1"}], "}"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{"6", ",", "1"}], "}"}], "}"}]}], "}"}]}], "}"}]], "Echo",
 CellChangeTimes->{
  3.826089933523123*^9},ExpressionUUID->"5bd64d05-382e-4d95-aca6-\
d683a7972fd5"],

Cell[BoxData[
 RowBox[{
  TagBox["\<\"momenta3\"\>",
   "EchoLabel"], "  ", 
  RowBox[{"{", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"3", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"pp$35086", "[", 
          RowBox[{"2", ",", "$15"}], "]"}], ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"pp$35086", "[", 
          RowBox[{"2", ",", "$15"}], "]"}], ",", "1"}], "}"}]}], "}"}]}], 
    "}"}], "}"}]}]], "Echo",
 CellChangeTimes->{
  3.8260899336168137`*^9},ExpressionUUID->"bec576e7-4dab-4a0d-9090-\
ec1f981d3ad5"],

Cell[BoxData[
 RowBox[{
  TagBox["\<\"momenta2\"\>",
   "EchoLabel"], "  ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"3", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"3", ",", "1"}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"pp$35086", "[", 
         RowBox[{"2", ",", "$15"}], "]"}], ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"pp$35086", "[", 
         RowBox[{"2", ",", "$15"}], "]"}], ",", "1"}], "}"}]}], "}"}]}], 
   "}"}]}]], "Echo",
 CellChangeTimes->{
  3.8260899337066927`*^9},ExpressionUUID->"13c23b83-14d8-4340-90b6-\
495ff86179ef"],

Cell[BoxData[
 RowBox[{
  TagBox["\<\"candidates\"\>",
   "EchoLabel"], "  ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "1"}], "}"}]}], "}"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"2", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2"}], "}"}]}], "}"}], "}"}]}], "}"}]}]], "Echo",
 CellChangeTimes->{
  3.8260899337985826`*^9},ExpressionUUID->"e9f7bf02-85b2-4863-9690-\
454eb8cd5c3b"],

Cell[BoxData[
 RowBox[{
  TagBox["\<\"subsets\"\>",
   "EchoLabel"], "  ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "1"}], "}"}]}], "}"}], "}"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"2", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "2"}], "}"}]}], "}"}], "}"}], "}"}]}], 
   "}"}]}]], "Echo",
 CellChangeTimes->{
  3.826089933889449*^9},ExpressionUUID->"ce48168d-3a6b-4020-bbcf-\
d8110ba31d08"],

Cell[BoxData[
 RowBox[{
  TagBox["\<\"checked\"\>",
   "EchoLabel"], "  ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "1"}], "}"}]}], "}"}], "}"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"2", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "2"}], "}"}]}], "}"}], "}"}], "}"}]}], 
   "}"}]}]], "Echo",
 CellChangeTimes->{
  3.8260899339772882`*^9},ExpressionUUID->"bce700e4-15ac-4bc5-9a3a-\
f25e295f2d54"],

Cell[BoxData[
 RowBox[{
  TagBox["\<\"chains flattened\"\>",
   "EchoLabel"], "  ", 
  RowBox[{"{", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"2", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2"}], "}"}]}], "}"}]}], "}"}], "}"}]}]], "Echo",
 CellChangeTimes->{
  3.8260899340713882`*^9},ExpressionUUID->"6fd8f9a6-e6bc-4006-81ff-\
1c7f32c9f5a1"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"2", ",", "2"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"2", ",", "2"}], "}"}]}], "}"}]}], "}"}], "}"}]], "Echo",
 CellChangeTimes->{
  3.8260899341559277`*^9},ExpressionUUID->"747fc2c0-dd83-4dfe-ab1d-\
ebf18cb43cd9"],

Cell[BoxData[
 RowBox[{
  TagBox["\<\"gathered\"\>",
   "EchoLabel"], "  ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{"chorder", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"1", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"2", ",", "2"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "2"}], "}"}]}], "}"}]}], "]"}], "}"}], "}"}], 
    ",", 
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"-", "1"}], ",", 
       TemplateBox[{"5", "6"},
        "SpinorSquareBracket",
        DisplayFunction->(RowBox[{"[", 
           RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
        InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
           RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], "}"}]}], "}"}]}]], "Echo",
 CellChangeTimes->{
  3.826089934248454*^9},ExpressionUUID->"712a221b-9978-47b6-888b-\
5bfabe08d3e6"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"{", 
   RowBox[{
    TemplateBox[{"4", 
      RowBox[{"{", 
        RowBox[{"3", ",", "2"}], "}"}], "1"},
     "AngleAngleChain",
     DisplayFunction->(
      RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(
      RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle",
         "]"}]& )], ",", 
    RowBox[{"-", "1"}], ",", 
    TemplateBox[{"5", "6"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], "}"}]], "Output",
 CellChangeTimes->{{3.82602593023579*^9, 3.8260259406389627`*^9}, 
   3.82602600688079*^9, 3.8260828379836564`*^9, 3.8260848788808136`*^9, 
   3.8260849765435467`*^9, 3.826085249450061*^9, 3.826085311979315*^9, {
   3.826085352968969*^9, 3.82608537167177*^9}, 3.826086128446933*^9, 
   3.826086685350293*^9, 3.8260890100965166`*^9, 3.82608906059863*^9, 
   3.826089605682438*^9, 3.8260899343349743`*^9},
 CellLabel->"Out[82]=",ExpressionUUID->"997962f6-cf2c-4ebf-a0b8-4cd755c5af67"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["AllChains", "Subsection",
 CellChangeTimes->{{3.826085697466988*^9, 
  3.8260856996539493`*^9}},ExpressionUUID->"6ac43564-ffa6-4144-8116-\
76a7d13f20ef"],

Cell[CellGroupData[{

Cell["Auxiliary", "Subsubsection",
 CellChangeTimes->{{3.826085814342921*^9, 
  3.826085816002061*^9}},ExpressionUUID->"03faa4f3-3223-470c-a928-\
c0af0107a0d2"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
   "Auxiliary", " ", "function", " ", "to", " ", "test", " ", "for", " ", 
    "duplicates", " ", "in", " ", "a", " ", "list"}], ",", " ", 
   RowBox[{
   "returns", " ", "False", " ", "if", " ", "there", " ", "are", " ", "no", 
    " ", "duplicates"}]}], "*)"}]], "Input",
 CellChangeTimes->{{3.825768477952244*^9, 3.825768502537095*^9}},
 CellLabel->"In[9]:=",ExpressionUUID->"1a303b3a-4a05-45c9-8894-ec18f6fb3425"],

Cell[BoxData[
 RowBox[{
  RowBox[{"duplicatesQ", " ", "=", " ", 
   RowBox[{
    RowBox[{"0", " ", "===", 
     RowBox[{"Signature", "@", "#"}]}], "&"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.825768375158662*^9, 3.825768420305456*^9}},
 CellLabel->"In[10]:=",ExpressionUUID->"6fa8236b-8708-429b-8ab0-ec274bfb7f90"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
   "Auxiliary", " ", "function", " ", "for", " ", "testing", " ", "if", " ", 
    "a", " ", "contraction", " ", "is", " ", "possible"}], ",", " ", 
   RowBox[{
    RowBox[{"i", ".", "e", ".", " ", "if"}], " ", "every", " ", "bracket", 
    " ", "appears", " ", "at", " ", "most", " ", "once"}]}], "*)"}]], "Input",
 CellChangeTimes->{{3.825768686925809*^9, 3.825768698761897*^9}, {
  3.8257687466477566`*^9, 3.8257687555509386`*^9}},
 CellLabel->"In[11]:=",ExpressionUUID->"0c18ab0b-2438-42e3-a12f-a36973d541e3"],

Cell[BoxData[
 RowBox[{
  RowBox[{"feasibilitytest", " ", "=", 
   RowBox[{
    RowBox[{"Or", "@@", " ", 
     RowBox[{"duplicatesQ", "/@", 
      RowBox[{"Transpose", "@", 
       RowBox[{"(", 
        RowBox[{"First", "/@", 
         RowBox[{"Transpose", "/@", "#"}]}], ")"}]}]}]}], "&"}]}], 
  ";"}]], "Input",
 CellLabel->"In[12]:=",ExpressionUUID->"2f1f27ba-906e-480f-b28a-4d710a006de4"]
}, Closed]],

Cell[CellGroupData[{

Cell["Chainorder", "Subsubsection",
 CellChangeTimes->{{3.8260125555951595`*^9, 
  3.826012557581846*^9}},ExpressionUUID->"dbea6423-3bbe-426e-80e5-\
16d596d1e50d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "We", " ", "assume", " ", "everything", " ", "to", " ", "be", " ", 
    "already", " ", "paired", " ", "up", " ", "by", " ", "contracted", " ", 
    "angle", " ", 
    RowBox[{"brackets", ".", " ", "Further"}], " ", "connect", " ", "by", " ",
     "contracted", " ", "angles"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"chorder", " ", "/:", " ", 
     RowBox[{"List", "[", 
      RowBox[{"x1___", ",", 
       RowBox[{"chorder", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i1_", ",", "j1_"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i2_", ",", "j2_"}], "}"}]}], "}"}], ",", "y1___"}], 
        "]"}], ",", "x2___", ",", 
       RowBox[{"chorder", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i1_", ",", "j3_"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i4_", ",", "j4_"}], "}"}]}], "}"}], ",", "y2___"}], 
        "]"}], ",", "x3___"}], "]"}], ":=", 
     RowBox[{"List", "[", 
      RowBox[{"x1", ",", "x2", ",", "x3", ",", 
       RowBox[{"chorder", "[", 
        RowBox[{
         RowBox[{"Sequence", "@@", 
          RowBox[{"Reverse", "[", 
           RowBox[{"{", "y2", "}"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i1", ",", "j3"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i4", ",", "j4"}], "}"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i1", ",", "j1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i2", ",", "j2"}], "}"}]}], "}"}], ",", "y1"}], "]"}]}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"chorder", " ", "/:", " ", 
     RowBox[{"List", "[", 
      RowBox[{"x1___", ",", 
       RowBox[{"chorder", "[", 
        RowBox[{"y1___", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i1_", ",", "j1_"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i2_", ",", "j2_"}], "}"}]}], "}"}]}], "]"}], ",", 
       "x2___", ",", 
       RowBox[{"chorder", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i1_", ",", "j3_"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i4_", ",", "j4_"}], "}"}]}], "}"}], ",", "y2___"}], 
        "]"}], ",", "x3___"}], "]"}], ":=", 
     RowBox[{"List", "[", 
      RowBox[{"x1", ",", "x2", ",", "x3", ",", 
       RowBox[{"chorder", "[", 
        RowBox[{"y1", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i1", ",", "j1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i2", ",", "j2"}], "}"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i1", ",", "j3"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i4", ",", "j4"}], "}"}]}], "}"}], ",", "y2"}], "]"}]}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"chorder", " ", "/:", " ", 
     RowBox[{"List", "[", 
      RowBox[{"x1___", ",", 
       RowBox[{"chorder", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i1_", ",", "j3_"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i4_", ",", "j4_"}], "}"}]}], "}"}], ",", "y2___"}], 
        "]"}], ",", "x2___", ",", 
       RowBox[{"chorder", "[", 
        RowBox[{"y1___", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i1_", ",", "j1_"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i2_", ",", "j2_"}], "}"}]}], "}"}]}], "]"}], ",", 
       "x3___"}], "]"}], ":=", 
     RowBox[{"List", "[", 
      RowBox[{"x1", ",", "x2", ",", "x3", ",", 
       RowBox[{"chorder", "[", 
        RowBox[{"y1", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i1", ",", "j1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i2", ",", "j2"}], "}"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i1", ",", "j3"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i4", ",", "j4"}], "}"}]}], "}"}], ",", "y2"}], "]"}]}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"chorder", " ", "/:", " ", 
     RowBox[{"List", "[", 
      RowBox[{"x1___", ",", 
       RowBox[{"chorder", "[", 
        RowBox[{"y1___", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i1_", ",", "j1_"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i2_", ",", "j2_"}], "}"}]}], "}"}]}], "]"}], ",", 
       "x2___", ",", 
       RowBox[{"chorder", "[", 
        RowBox[{"y2___", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i1_", ",", "j3_"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i4_", ",", "j4_"}], "}"}]}], "}"}]}], "]"}], ",", 
       "x3___"}], "]"}], ":=", 
     RowBox[{"List", "[", 
      RowBox[{"x1", ",", "x2", ",", "x3", ",", 
       RowBox[{"chorder", "[", 
        RowBox[{"y1", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i1", ",", "j1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i2", ",", "j2"}], "}"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i1", ",", "j3"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i4", ",", "j4"}], "}"}]}], "}"}], ",", 
         RowBox[{"Sequence", "@@", 
          RowBox[{"Reverse", "[", 
           RowBox[{"{", "y2", "}"}], "]"}]}]}], "]"}]}], "]"}]}], 
    ";"}]}]}]], "Input",
 CellChangeTimes->{{3.8260070499276323`*^9, 3.826007167214939*^9}, {
   3.8260072010095673`*^9, 3.826007391987771*^9}, 3.8260129796303873`*^9},
 CellLabel->"In[13]:=",ExpressionUUID->"9b7785cc-c688-4855-bf4d-d5180e0e4fb7"]
}, Closed]],

Cell[CellGroupData[{

Cell["Chainbuilder", "Subsubsection",
 CellChangeTimes->{{3.8260125598777037`*^9, 3.826012562792856*^9}, {
  3.826023629186164*^9, 3.82602363001096*^9}, {3.826024373973124*^9, 
  3.8260243741955414`*^9}, {3.8260850236758184`*^9, 3.826085024590727*^9}, {
  3.826085771750812*^9, 
  3.826085772501088*^9}},ExpressionUUID->"968317ad-76a7-4ae8-b8fc-\
9cd50b09e6a5"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "The", " ", "uncontracted", " ", "brackets", " ", "need", " ", "to", " ", 
   "be", " ", "taken", " ", "care", " ", "of", " ", "prior", " ", "to", " ", 
   "the", " ", "use", " ", "of", " ", "this", " ", "function"}], 
  "*)"}]], "Input",
 CellChangeTimes->{{3.826085025948245*^9, 3.8260850474955254`*^9}},
 CellLabel->"In[17]:=",ExpressionUUID->"7f10ed73-a334-444e-90b4-d5b97d68f5b2"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "This", " ", "\"\<function\>\"", " ", "converts", " ", "lists", " ", "of", 
   " ", "brackets", " ", "into", " ", "a", " ", 
   RowBox[{"chain", ".", " ", "Needs"}], " ", "to", " ", "be", " ", 
   "embedded", " ", "in", " ", "previous", " ", "code"}], "*)"}]], "Input",
 CellChangeTimes->{{3.826012565846687*^9, 3.826012605428874*^9}},
 CellLabel->"In[18]:=",ExpressionUUID->"1acb2a78-6b53-45c7-9311-949c1cbaf04e"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "We", " ", "assume", " ", "traces", " ", "have", " ", "been", " ", 
   "converted", " ", "from", " ", "even", " ", "to", " ", "odd", " ", 
   "number", " ", "of", " ", "contractions"}], "*)"}]], "Input",
 CellChangeTimes->{{3.8260129539481306`*^9, 3.8260129736095467`*^9}},
 CellLabel->"In[19]:=",ExpressionUUID->"54d1b74c-d2d4-4eb6-afb7-c7ab8c3f8475"],

Cell[BoxData[
 RowBox[{"Clear", "[", 
  RowBox[{"ChainBuilder", ",", "auxChainBuilder"}], "]"}]], "Input",
 CellChangeTimes->{{3.8260232383335066`*^9, 3.826023245855423*^9}},
 CellLabel->"In[20]:=",ExpressionUUID->"5ab43999-ce2a-4e46-b2ff-00b7be95d076"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"Single", " ", 
    RowBox[{"chain", ".", " ", "I"}], " ", 
    RowBox[{"think", "/", "hope"}], " ", "that", " ", "the", " ", "use", " ", 
    "of", " ", "a", " ", "Length", " ", "test", " ", "intesad", " ", "of", 
    " ", "a", " ", "direct", " ", "pattern", " ", "matching", " ", "increses",
     " ", "speed"}], ",", " ", 
   RowBox[{
   "this", " ", "is", " ", "the", " ", "reason", " ", "why", " ", 
    "introduced", " ", "an", " ", "auxiliary", " ", "function"}]}], 
  "*)"}]], "Input",
 CellChangeTimes->{{3.8260182069100523`*^9, 3.826018212246825*^9}, {
  3.826018632840867*^9, 3.826018633518033*^9}, {3.826018892912298*^9, 
  3.826018926300989*^9}},
 CellLabel->"In[21]:=",ExpressionUUID->"44eb6dce-fcff-4f86-9076-c33389a06d85"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ChainBuilder", "[", 
    RowBox[{"exp_List", ",", "ag_List", ",", "sq_List"}], "]"}], "/;", 
   RowBox[{
    RowBox[{"Length", "@", "exp"}], "===", "1"}]}], ":=", 
  RowBox[{"auxChainBuilder", "[", 
   RowBox[{"exp", ",", "ag", ",", "sq"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.826018635510704*^9, 3.826018708158472*^9}, {
  3.8260188131256943`*^9, 3.8260188488382072`*^9}, {3.8260190708753104`*^9, 
  3.826019085432239*^9}, {3.826019466312961*^9, 3.8260194699841948`*^9}, {
  3.8260850699631805`*^9, 3.826085074180394*^9}},
 CellLabel->"In[22]:=",ExpressionUUID->"308c997b-cc1a-4df2-bc5f-82f73ad12270"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"auxChainBuilder", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"i1_", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"i2_", ",", "1"}], "}"}]}], "}"}], "}"}], ",", "ag_", ",", 
     "sq_"}], "]"}], ":=", 
   RowBox[{"-", 
    RowBox[{"Chain", "[", 
     RowBox[{"$angle", ",", 
      RowBox[{"Last", "@", 
       RowBox[{"ag", "[", 
        RowBox[{"[", "i1", "]"}], "]"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"First", "@", 
        RowBox[{"ag", "[", 
         RowBox[{"[", "i1", "]"}], "]"}]}], "}"}], ",", 
      RowBox[{"Last", "@", 
       RowBox[{"sq", "[", 
        RowBox[{"[", "i2", "]"}], "]"}]}], ",", "$square"}], "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"auxChainBuilder", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"i1_", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"i2_", ",", "2"}], "}"}]}], "}"}], "}"}], ",", "ag_", ",", 
     "sq_"}], "]"}], ":=", 
   RowBox[{"Chain", "[", 
    RowBox[{"$angle", ",", 
     RowBox[{"Last", "@", 
      RowBox[{"ag", "[", 
       RowBox[{"[", "i1", "]"}], "]"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"First", "@", 
       RowBox[{"ag", "[", 
        RowBox[{"[", "i1", "]"}], "]"}]}], "}"}], ",", 
     RowBox[{"First", "@", 
      RowBox[{"sq", "[", 
       RowBox[{"[", "i2", "]"}], "]"}]}], ",", "$square"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"auxChainBuilder", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"i1_", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"i2_", ",", "1"}], "}"}]}], "}"}], "}"}], ",", "ag_", ",", 
     "sq_"}], "]"}], ":=", 
   RowBox[{"Chain", "[", 
    RowBox[{"$angle", ",", 
     RowBox[{"First", "@", 
      RowBox[{"ag", "[", 
       RowBox[{"[", "i1", "]"}], "]"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"Last", "@", 
       RowBox[{"ag", "[", 
        RowBox[{"[", "i1", "]"}], "]"}]}], "}"}], ",", 
     RowBox[{"Last", "@", 
      RowBox[{"sq", "[", 
       RowBox[{"[", "i2", "]"}], "]"}]}], ",", "$square"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"auxChainBuilder", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"i1_", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"i2_", ",", "2"}], "}"}]}], "}"}], "}"}], ",", "ag_", ",", 
     "sq_"}], "]"}], ":=", 
   RowBox[{"-", 
    RowBox[{"Chain", "[", 
     RowBox[{"$angle", ",", 
      RowBox[{"First", "@", 
       RowBox[{"ag", "[", 
        RowBox[{"[", "i1", "]"}], "]"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"Last", "@", 
        RowBox[{"ag", "[", 
         RowBox[{"[", "i1", "]"}], "]"}]}], "}"}], ",", 
      RowBox[{"First", "@", 
       RowBox[{"sq", "[", 
        RowBox[{"[", "i2", "]"}], "]"}]}], ",", "$square"}], "]"}]}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.8260188509674816`*^9, 3.8260188868415856`*^9}, {
  3.8260189307590666`*^9, 3.826019028612403*^9}, {3.8260191014553823`*^9, 
  3.826019176964985*^9}, {3.8260192866326337`*^9, 3.826019375256654*^9}},
 CellLabel->"In[23]:=",ExpressionUUID->"fc2a828d-9477-40c3-8751-5f947af66fce"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ChainBuilder", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"1", ",", "1"}], "}"}]}], "}"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "2"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"1", "3"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    TemplateBox[{"1", "4"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.8260194108045216`*^9, 3.8260194314153023`*^9}, {
  3.826023658031014*^9, 3.826023660562191*^9}, {3.826085766350062*^9, 
  3.8260857666706586`*^9}},
 CellLabel->"In[27]:=",ExpressionUUID->"2ee7bc45-4369-47bf-9e0a-45ef6c92ca84"],

Cell[BoxData[
 RowBox[{"-", 
  TemplateBox[{"2", 
    RowBox[{"{", "1", "}"}], "4"},
   "AngleSquareChain",
   DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
   InterpretationFunction->(
    RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square", 
      "]"}]& )]}]], "Output",
 CellChangeTimes->{
  3.8260194327278223`*^9, 3.8260194736783133`*^9, 3.826023250730378*^9, {
   3.826023654176322*^9, 3.826023662300575*^9}, 3.8260241660961123`*^9, 
   3.8260852240798388`*^9, 3.826085875217265*^9},
 CellLabel->"Out[27]=",ExpressionUUID->"c4030031-26ec-4c2a-8b2e-a8d4fd010377"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"Even", " ", "angle", " ", "chains"}], "*)"}]], "Input",
 CellChangeTimes->{{3.8260169373704567`*^9, 3.826016947848482*^9}},
 CellLabel->"In[28]:=",ExpressionUUID->"7d522554-c484-4224-8450-ad2ce2589410"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ChainBuilder", "[", 
     RowBox[{"exp_List", ",", "ag_List", ",", "sq_List"}], "]"}], "/;", 
    RowBox[{
     RowBox[{"EvenQ", "@", 
      RowBox[{"Length", "@", "exp"}]}], "&&", 
     RowBox[{
      RowBox[{"exp", "[", 
       RowBox[{"[", 
        RowBox[{"1", ",", "2", ",", "1"}], "]"}], "]"}], "===", 
      RowBox[{"exp", "[", 
       RowBox[{"[", 
        RowBox[{"2", ",", "2", ",", "1"}], "]"}], "]"}]}]}]}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{"-", "1"}], ")"}], "^", 
     RowBox[{"Count", "[", 
      RowBox[{
       RowBox[{"Last", "/@", 
        RowBox[{"Total", "/@", "exp"}]}], ",", 
       RowBox[{"2", "|", "4"}], ",", "2"}], "]"}]}], "*", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"Chain", "[", 
        RowBox[{"$angle", ",", 
         RowBox[{"First", "@", "#"}], ",", 
         RowBox[{"Rest", "@", 
          RowBox[{"Most", "@", "#"}]}], ",", 
         RowBox[{"Last", "@", "#"}], ",", "$angle"}], "]"}], "&"}], "@", 
      RowBox[{"Flatten", "@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Last", "@", "#"}], "\[Equal]", "1"}], ",", 
                RowBox[{"Reverse", "@", 
                 RowBox[{"First", "@", "#"}]}], ",", 
                RowBox[{"First", "@", "#"}]}], "]"}], "&"}], "@", 
             RowBox[{"First", "@", "#"}]}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Last", "@", "#"}], "\[Equal]", "2"}], ",", 
                RowBox[{"Reverse", "@", 
                 RowBox[{"First", "@", "#"}]}], ",", 
                RowBox[{"First", "@", "#"}]}], "]"}], "&"}], "/@", 
             RowBox[{"Rest", "@", "#"}]}]}], "}"}], "&"}], "@", 
         RowBox[{"Transpose", "@", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Part", "[", 
                  RowBox[{
                   RowBox[{"List", "@@@", "ag"}], ",", "#"}], "]"}], "&"}], "/@",
                 "#1"}], ",", "#2"}], "}"}], "&"}], "@@", 
            RowBox[{"Transpose", "@", 
             RowBox[{"(", 
              RowBox[{"First", "/@", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Length", "@", "exp"}], ">", "2"}], ",", 
                 RowBox[{"Drop", "[", 
                  RowBox[{"exp", ",", 
                   RowBox[{"{", 
                    RowBox[{"3", ",", 
                    RowBox[{"Length", "[", "exp", "]"}], ",", "2"}], "}"}]}], 
                  "]"}], ",", "exp"}], "]"}]}], ")"}]}]}], ")"}]}]}], 
        ")"}]}]}], ")"}]}]}], ";"}]], "Input",
 CellChangeTimes->{{3.826016932154456*^9, 3.8260170078470078`*^9}, {
  3.826020628678008*^9, 3.8260207116339197`*^9}, {3.826020821819213*^9, 
  3.826020929865259*^9}, {3.826021309850788*^9, 3.826021381351551*^9}, {
  3.826023532817912*^9, 3.826023534340789*^9}, {3.8260240614111233`*^9, 
  3.8260240968463435`*^9}, {3.8260242769406075`*^9, 3.8260242800204268`*^9}, {
  3.8260245262617297`*^9, 3.82602452735382*^9}, {3.826024791651778*^9, 
  3.826024792033706*^9}, {3.8260256495477037`*^9, 3.826025652991495*^9}, {
  3.826085112281683*^9, 3.826085134046756*^9}},
 CellLabel->"In[29]:=",ExpressionUUID->"afb48401-2842-4f7f-9a0e-073994cb2639"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ChainBuilder", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"2", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "2"}], "}"}]}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "2"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"3", "4"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    TemplateBox[{"2", "3"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.8260231491361094`*^9, 3.826023172764867*^9}},
 CellLabel->"In[30]:=",ExpressionUUID->"377a6460-5fdb-49d0-9c12-ed02e08e3bfc"],

Cell[BoxData[
 TemplateBox[{"1", 
   RowBox[{"{", 
     RowBox[{"2", ",", "3"}], "}"}], "4"},
  "AngleAngleChain",
  DisplayFunction->(
   RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
  InterpretationFunction->(
   RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle", 
     "]"}]& )]], "Output",
 CellChangeTimes->{
  3.826023174977999*^9, 3.826023261158498*^9, 3.826023536035254*^9, {
   3.826024100850621*^9, 3.82602411266005*^9}, 3.826024169360345*^9, 
   3.8260243240466533`*^9, 3.8260245301383524`*^9, 3.826024793585606*^9, 
   3.8260825677776613`*^9, 3.826085139866314*^9, 3.8260852242592783`*^9, 
   3.826085875335409*^9},
 CellLabel->"Out[30]=",ExpressionUUID->"050d4e01-ba49-415d-9efa-2f17e20ba335"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ChainBuilder", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"2", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "2"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"2", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"3", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2"}], "}"}]}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "2"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"3", "4"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"5", "6"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"2", "3"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"4", "5"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.8260244774223657`*^9, 3.8260245056089306`*^9}, {
  3.826024798927304*^9, 3.826024801302513*^9}, {3.8260857613697467`*^9, 
  3.8260857616668587`*^9}},
 CellLabel->"In[31]:=",ExpressionUUID->"9917159b-b579-4e87-81dd-ab6da980e705"],

Cell[BoxData[
 TemplateBox[{"1", 
   RowBox[{"{", 
     RowBox[{"2", ",", "3", ",", "4", ",", "5"}], "}"}], "6"},
  "AngleAngleChain",
  DisplayFunction->(
   RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
  InterpretationFunction->(
   RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle", 
     "]"}]& )]], "Output",
 CellChangeTimes->{{3.8260245079526577`*^9, 3.8260245314168987`*^9}, {
   3.8260247944991093`*^9, 3.826024802616987*^9}, 3.82608257042558*^9, 
   3.826085146751342*^9, 3.826085225739122*^9, 3.82608587542272*^9},
 CellLabel->"Out[31]=",ExpressionUUID->"a915670c-99b4-491f-a411-53cefeb79c56"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"Even", " ", "square", " ", "chains"}], "*)"}]], "Input",
 CellChangeTimes->{{3.8260169373704567`*^9, 3.826016947848482*^9}, {
   3.826017092506524*^9, 3.8260170932904243`*^9}, {3.8260175219838657`*^9, 
   3.826017565832575*^9}, 3.8260241863369937`*^9},
 CellLabel->"In[32]:=",ExpressionUUID->"6e425556-fe33-421a-8497-66590cf3b605"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ChainBuilder", "[", 
     RowBox[{"exp_List", ",", "ag_List", ",", "sq_List"}], "]"}], "/;", 
    RowBox[{
     RowBox[{"EvenQ", "@", 
      RowBox[{"Length", "@", "exp"}]}], "&&", 
     RowBox[{
      RowBox[{"exp", "[", 
       RowBox[{"[", 
        RowBox[{"1", ",", "2", ",", "1"}], "]"}], "]"}], "\[NotEqual]", 
      RowBox[{"exp", "[", 
       RowBox[{"[", 
        RowBox[{"2", ",", "2", ",", "1"}], "]"}], "]"}]}]}]}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{"-", "1"}], ")"}], "^", 
     RowBox[{"Count", "[", 
      RowBox[{
       RowBox[{"Last", "/@", 
        RowBox[{"Total", "/@", "exp"}]}], ",", 
       RowBox[{"2", "|", "4"}], ",", "2"}], "]"}]}], "*", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"Chain", "[", 
        RowBox[{"$square", ",", 
         RowBox[{"First", "@", "#"}], ",", 
         RowBox[{"Rest", "@", 
          RowBox[{"Most", "@", "#"}]}], ",", 
         RowBox[{"Last", "@", "#"}], ",", "$square"}], "]"}], "&"}], "@", 
      RowBox[{"Flatten", "@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Last", "@", "#"}], "\[Equal]", "1"}], ",", 
                RowBox[{"Reverse", "@", 
                 RowBox[{"First", "@", "#"}]}], ",", 
                RowBox[{"First", "@", "#"}]}], "]"}], "&"}], "@", 
             RowBox[{"First", "@", "#"}]}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Last", "@", "#"}], "\[Equal]", "2"}], ",", 
                RowBox[{"Reverse", "@", 
                 RowBox[{"First", "@", "#"}]}], ",", 
                RowBox[{"First", "@", "#"}]}], "]"}], "&"}], "/@", 
             RowBox[{"Rest", "@", "#"}]}]}], "}"}], "&"}], "@", 
         RowBox[{"Transpose", "@", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Part", "[", 
                  RowBox[{
                   RowBox[{"List", "@@@", "sq"}], ",", "#"}], "]"}], "&"}], "/@",
                 "#1"}], ",", "#2"}], "}"}], "&"}], "@@", 
            RowBox[{"Transpose", "@", 
             RowBox[{"(", 
              RowBox[{"Last", "/@", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Length", "@", "exp"}], ">", "2"}], ",", 
                 RowBox[{"Drop", "[", 
                  RowBox[{"exp", ",", 
                   RowBox[{"{", 
                    RowBox[{"3", ",", 
                    RowBox[{"Length", "[", "exp", "]"}], ",", "2"}], "}"}]}], 
                  "]"}], ",", "exp"}], "]"}]}], ")"}]}]}], ")"}]}]}], 
        ")"}]}]}], ")"}]}]}], ";"}]], "Input",
 CellChangeTimes->{{3.826016932154456*^9, 3.8260170078470078`*^9}, {
   3.8260171094831157`*^9, 3.826017122447441*^9}, 3.8260171734839916`*^9, {
   3.826017338304161*^9, 3.826017341530475*^9}, {3.8260175705319853`*^9, 
   3.8260175778994865`*^9}, {3.8260176834531775`*^9, 3.826017684590139*^9}, {
   3.8260179019727182`*^9, 3.8260179135257654`*^9}, {3.8260181116199913`*^9, 
   3.8260181725170794`*^9}, {3.8260207312683816`*^9, 
   3.8260207383773813`*^9}, {3.826020916675541*^9, 3.8260209345317783`*^9}, 
   3.826021397771637*^9, {3.82602143577693*^9, 3.826021436022274*^9}, {
   3.8260241443413153`*^9, 3.826024154953878*^9}, {3.8260242008272276`*^9, 
   3.826024213551198*^9}, {3.826085162504323*^9, 3.8260851754192305`*^9}},
 CellLabel->"In[33]:=",ExpressionUUID->"c0f7b908-7248-4968-857e-67df1767d01c"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ChainBuilder", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"3", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"3", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "2"}], "}"}]}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "2"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"5", "6"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"3", "4"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "4"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"2", "3"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"2", "4"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{
  3.826017155247757*^9, {3.826017185601581*^9, 3.826017188490857*^9}, {
   3.8260240331466646`*^9, 3.8260240404262486`*^9}, {3.826085757564052*^9, 
   3.8260857578658667`*^9}},
 CellLabel->"In[34]:=",ExpressionUUID->"d217583a-e387-4c67-9e2c-947df15e542f"],

Cell[BoxData[
 TemplateBox[{"4", 
   RowBox[{"{", 
     RowBox[{"1", ",", "2", ",", "3", ",", "4"}], "}"}], "2"},
  "SquareSquareChain",
  DisplayFunction->(RowBox[{"[", #, #2, #3, "]"}]& ),
  InterpretationFunction->(
   RowBox[{"Chain", "[", "$square", ",", #, ",", #2, ",", #3, ",", "$square", 
     "]"}]& )]], "Output",
 CellChangeTimes->{{3.8260171762186613`*^9, 3.826017189273761*^9}, 
   3.8260173433326936`*^9, 3.826017579047406*^9, 3.826017686536911*^9, {
   3.8260179041399117`*^9, 3.826017915512488*^9}, {3.8260181650908985`*^9, 
   3.8260181740160675`*^9}, 3.8260214014487777`*^9, 3.826021437652953*^9, {
   3.8260240303272443`*^9, 3.8260240418384523`*^9}, 3.826082594418425*^9, 
   3.826085179741973*^9, 3.826085227411187*^9, 3.826085875541876*^9},
 CellLabel->"Out[34]=",ExpressionUUID->"ccc77bbe-68d9-4950-b4b4-926e8f0076e8"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"Odd", " ", "length", " ", 
   RowBox[{"chains", ".", " ", "Just"}], " ", "like", " ", "in", " ", "the", 
   " ", "even", " ", "case", " ", "with", " ", "an", " ", "addition", " ", 
   "of", " ", "a", " ", "final", " ", "bracket"}], "*)"}]], "Input",
 CellChangeTimes->{{3.82602142830996*^9, 3.826021462332954*^9}, {
  3.826021520748663*^9, 3.8260215261462283`*^9}, {3.8260215813476377`*^9, 
  3.826021586155781*^9}},
 CellLabel->"In[35]:=",ExpressionUUID->"fdfe0f64-ee77-4ce7-a709-6e5cc7e962cc"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ChainBuilder", "[", 
     RowBox[{"exp_List", ",", "ag_List", ",", "sq_List"}], "]"}], "/;", 
    RowBox[{"OddQ", "@", 
     RowBox[{"Length", "@", "exp"}]}]}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{"-", "1"}], ")"}], "^", 
     RowBox[{"Count", "[", 
      RowBox[{
       RowBox[{"Last", "/@", 
        RowBox[{"Total", "/@", "exp"}]}], ",", 
       RowBox[{"2", "|", "4"}], ",", "2"}], "]"}]}], "*", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"Chain", "[", 
        RowBox[{"$angle", ",", 
         RowBox[{"First", "@", "#"}], ",", 
         RowBox[{"Rest", "@", "#"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Last", "@", "#"}], "\[Equal]", "1"}], ",", 
             RowBox[{"sq", "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"First", "@", "#"}], ",", "2"}], "]"}], "]"}], ",", 
             RowBox[{"sq", "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"First", "@", "#"}], ",", "1"}], "]"}], "]"}]}], 
            "]"}], "&"}], "@", 
          RowBox[{"Last", "@", 
           RowBox[{"Last", "@", "exp"}]}]}], ",", "$square"}], "]"}], "&"}], 
      "@", 
      RowBox[{"Flatten", "@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Last", "@", "#"}], "\[Equal]", "1"}], ",", 
                RowBox[{"Reverse", "@", 
                 RowBox[{"First", "@", "#"}]}], ",", 
                RowBox[{"First", "@", "#"}]}], "]"}], "&"}], "@", 
             RowBox[{"First", "@", "#"}]}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Last", "@", "#"}], "\[Equal]", "2"}], ",", 
                RowBox[{"Reverse", "@", 
                 RowBox[{"First", "@", "#"}]}], ",", 
                RowBox[{"First", "@", "#"}]}], "]"}], "&"}], "/@", 
             RowBox[{"Rest", "@", "#"}]}]}], "}"}], "&"}], "@", 
         RowBox[{"Transpose", "@", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Part", "[", 
                  RowBox[{
                   RowBox[{"List", "@@@", "ag"}], ",", "#"}], "]"}], "&"}], "/@",
                 "#1"}], ",", "#2"}], "}"}], "&"}], "@@", 
            RowBox[{"Transpose", "@", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"First", "/@", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Length", "@", "#"}], ">", "2"}], ",", 
                   RowBox[{"Drop", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"{", 
                    RowBox[{"3", ",", 
                    RowBox[{"Length", "[", "#", "]"}], ",", "2"}], "}"}]}], 
                    "]"}], ",", "#"}], "]"}]}], "&"}], "@", 
               RowBox[{"Most", "@", "exp"}]}], ")"}]}]}], ")"}]}]}], 
        ")"}]}]}], ")"}]}]}], ";"}]], "Input",
 CellChangeTimes->{{3.8260216087393756`*^9, 3.8260216105345163`*^9}, {
   3.8260216411018143`*^9, 3.826021649320826*^9}, {3.8260216882796326`*^9, 
   3.8260216885588737`*^9}, {3.82602205078306*^9, 3.826022119532297*^9}, {
   3.8260222129414186`*^9, 3.826022223157128*^9}, {3.826022259557787*^9, 
   3.826022261758092*^9}, {3.8260225340882826`*^9, 3.8260225358386135`*^9}, 
   3.8260246230875807`*^9, {3.8260246567595153`*^9, 3.8260246693478823`*^9}, {
   3.826024779659837*^9, 3.8260247799041996`*^9}, {3.826025678964079*^9, 
   3.826025680505955*^9}, 3.826025739216875*^9, {3.826085190536023*^9, 
   3.826085203176607*^9}},
 CellLabel->"In[36]:=",ExpressionUUID->"7c76381c-5b2e-42d1-8fd4-4c593776dda1"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ChainBuilder", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"3", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}]}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "2"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"5", "6"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"3", "4"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "4"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"2", "3"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"2", "4"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.8260248092981386`*^9, 3.8260248108978643`*^9}, {
  3.8260857541259575`*^9, 3.8260857551680083`*^9}},
 CellLabel->"In[37]:=",ExpressionUUID->"81c2a341-d8b5-4332-ae3b-fe31dea299fe"],

Cell[BoxData[
 RowBox[{"-", 
  TemplateBox[{"4", 
    RowBox[{"{", 
      RowBox[{"3", ",", "2", ",", "1"}], "}"}], "4"},
   "AngleSquareChain",
   DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
   InterpretationFunction->(
    RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square", 
      "]"}]& )]}]], "Output",
 CellChangeTimes->{
  3.8260246954320745`*^9, 3.8260247812555647`*^9, 3.8260248122093306`*^9, 
   3.826082601741823*^9, {3.8260852102022343`*^9, 3.826085228969079*^9}, 
   3.8260858756681437`*^9},
 CellLabel->"Out[37]=",ExpressionUUID->"ce813d0a-a887-43a0-9b55-d4d2d20af2e5"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["AllChains", "Subsubsection",
 CellChangeTimes->{{3.826085709190898*^9, 
  3.826085711832183*^9}},ExpressionUUID->"817e08ac-680b-4214-a6ea-\
df8f7a7c9529"],

Cell[BoxData[{
 RowBox[{"Clear", "[", "AllChains", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"AllChains", "[", "exp_List", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "ag", ",", "sq", ",", "ch", ",", "connections", ",", "momenta", ",", 
      "candidatecontractions", ",", "chains", ",", "pp", ",", "unique", ",", 
      "sign"}], "}"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{
      "Gather", " ", "by", " ", "angle", " ", "and", " ", "square", " ", 
       "head"}], ",", " ", 
      RowBox[{
      "chains", " ", "are", " ", "converted", " ", "into", " ", "angles", " ",
        "and", " ", "squares", " ", "and", " ", "in", " ", "case", " ", 
       "mixed", " ", "chains", " ", "are", " ", "found", " ", "an", " ", 
       "appropriate", " ", "connection", " ", "is", " ", 
       RowBox[{"added", ".", " ", "We"}], " ", "take", " ", "care", " ", "of",
        " ", "chains", " ", "later", " ", "on"}]}], "*)"}], 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{
      "Angle", " ", "and", " ", "square", " ", "chains", " ", "are", " ", 
       "no", " ", "problem"}], ",", " ", 
      RowBox[{
      "the", " ", "only", " ", "troublesome", " ", "are", " ", "the", " ", 
       "mixed", " ", "chains"}], ",", " ", 
      RowBox[{"these", " ", "are", " ", "kept", " ", "separate"}]}], "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", "Chain", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"Chain", "[", 
          RowBox[{"$angle", ",", "x_", ",", "y_", ",", "z_", ",", "$angle"}], 
          "]"}], ":=", 
         RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{"x", ",", "y", ",", "z"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Chain", "[", 
          RowBox[{
          "$square", ",", "x_", ",", "y_", ",", "z_", ",", "$square"}], "]"}],
          ":=", 
         RowBox[{"SpinorSquareBracket", "[", 
          RowBox[{"x", ",", "y", ",", "z"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"ag", ",", "sq", ",", "ch"}], "}"}], "=", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Flatten", "[", 
              RowBox[{"#", ",", "1"}], "]"}], "&"}], "/@", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Select", "[", 
               RowBox[{"#", ",", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Head", "@", 
                    RowBox[{"First", "@", "#"}]}], "===", 
                   "SpinorAngleBracket"}], "&"}], ")"}]}], "]"}], ",", 
              RowBox[{"Select", "[", 
               RowBox[{"#", ",", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Head", "@", 
                    RowBox[{"First", "@", "#"}]}], "===", 
                   "SpinorSquareBracket"}], "&"}], ")"}]}], "]"}], ",", 
              RowBox[{"Select", "[", 
               RowBox[{"#", ",", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Head", "@", 
                    RowBox[{"First", "@", "#"}]}], "===", "Chain"}], "&"}], 
                 ")"}]}], "]"}]}], "}"}]}], "&"}], "@", 
          RowBox[{"GatherBy", "[", 
           RowBox[{"exp", ",", "Head"}], "]"}]}]}], ";"}]}], 
      "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
       "In", " ", "order", " ", "to", " ", "take", " ", "care", " ", "of", 
        " ", "mixed", " ", "chains", " ", "in", " ", "a", " ", "simple", " ", 
        "way", " ", "we", " ", "decompose", " ", "them", " ", "into", " ", 
        "an", " ", "angle", " ", "and", " ", "square", " ", "bracket", " ", 
        "and", " ", "add", " ", "a", " ", "fixed", " ", "connection", " ", 
        "to", " ", "the", " ", "list", " ", "of", " ", "connections"}], ",", 
       " ", 
       RowBox[{"the", " ", "rest", " ", "follows", " ", "automatically"}]}], 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"sign", "=", "1"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Do", "[", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Decomposition", " ", "into", " ", "angle", " ", "and", " ", "square",
          " ", "is", " ", "done", " ", "by", " ", "introducing", " ", "a", 
         " ", "unique", " ", "label", " ", "fro", " ", "each", " ", "chain"}],
         ",", " ", 
        RowBox[{
        "so", " ", "that", " ", "later", " ", "on", " ", "when", " ", 
         "contractions", " ", "are", " ", "performed", " ", "there", " ", 
         "will", " ", "be", " ", "exactly", " ", "for", " ", "each", " ", 
         "of", " ", 
         RowBox[{"these", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"ag", "=", 
         RowBox[{"Join", "[", 
          RowBox[{"ag", ",", 
           RowBox[{"{", 
            RowBox[{"SpinorAngleBracket", "[", 
             RowBox[{
              RowBox[{"i", "[", 
               RowBox[{"[", "2", "]"}], "]"}], ",", 
              RowBox[{"Most", "@", 
               RowBox[{"i", "[", 
                RowBox[{"[", "3", "]"}], "]"}]}], ",", 
              RowBox[{"unique", "=", 
               RowBox[{"pp", "[", 
                RowBox[{
                 RowBox[{"Last", "@", 
                  RowBox[{"i", "[", 
                   RowBox[{"[", "3", "]"}], "]"}]}], ",", 
                 RowBox[{"Unique", "[", "]"}]}], "]"}]}]}], "]"}], "}"}]}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"OrderedQ", "[", 
           RowBox[{"{", 
            RowBox[{"unique", ",", 
             RowBox[{"i", "[", 
              RowBox[{"[", "4", "]"}], "]"}]}], "}"}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"sq", "=", 
            RowBox[{"Join", "[", 
             RowBox[{"sq", ",", 
              RowBox[{"{", 
               RowBox[{"SpinorSquareBracket", "[", 
                RowBox[{"unique", ",", 
                 RowBox[{"i", "[", 
                  RowBox[{"[", "4", "]"}], "]"}]}], "]"}], "}"}]}], "]"}]}], 
           ";"}], "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
           "Sign", " ", "keeps", " ", "track", " ", "of", " ", "signs", " ", 
            "since", " ", "the", " ", "arguments", " ", "of", " ", "the", " ",
             "brackets", " ", "need", " ", "to", " ", "be", " ", "correctly", 
            " ", "ordered", " ", 
            RowBox[{"(", 
             RowBox[{
             "this", " ", "was", " ", "an", " ", "initial", " ", "assumption",
               " ", "on", " ", "the", " ", "input", " ", "list", " ", "so", 
              " ", "it", " ", "must", " ", "be", " ", "mantained"}], ")"}]}], 
           "*)"}], "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"sign", "=", 
            RowBox[{
             RowBox[{"-", "1"}], "*", "sign"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"sq", "=", 
            RowBox[{"Join", "[", 
             RowBox[{"sq", ",", 
              RowBox[{"{", 
               RowBox[{"SpinorSquareBracket", "[", 
                RowBox[{
                 RowBox[{"i", "[", 
                  RowBox[{"[", "4", "]"}], "]"}], ",", "unique"}], "]"}], 
               "}"}]}], "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";"}],
        "\[IndentingNewLine]", ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "ch"}], "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Find", " ", "the", " ", "momenta", " ", "and", " ", "their", " ", 
       "number"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"SpinorAngleBracket", ",", "SpinorSquareBracket"}], "}"}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"SpinorSquareBracket", "[", 
          RowBox[{"x_", ",", "y_", ",", "z_"}], "]"}], ":=", 
         RowBox[{"SpinorSquareBracket", "[", 
          RowBox[{"x", ",", "z"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{"x_", ",", "y_", ",", "z_"}], "]"}], ":=", 
         RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{"x", ",", "z"}], "]"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
          "These", " ", "are", " ", "the", " ", "momenta", " ", "and", " ", 
           "their", " ", 
           RowBox[{"multiplicities", ".", " ", "They"}], " ", "are", " ", 
           "found", " ", "by", " ", "extracting", " ", "all", " ", "the", " ",
            "labels", " ", "from", " ", "the", " ", "brackest"}], ",", " ", 
          RowBox[{
          "then", " ", "counting", " ", "the", " ", "labels", " ", "and", " ",
            "looking", " ", "at", " ", "those", " ", "which", " ", "appear", 
           " ", "both", " ", "as", " ", "angle", " ", "and", " ", 
           RowBox[{"squares", ".", " ", "Then"}], " ", "we", " ", "take", " ",
            "the", " ", "minimum", " ", "between", " ", "the", " ", "angle", 
           " ", "and", " ", "square", " ", "appearences"}], ",", " ", 
          RowBox[{
          "the", " ", "mismatch", " ", "gives", " ", "the", " ", "helicity", 
           " ", "weight", " ", "which", " ", "we", " ", "do", " ", "not", " ",
            "need", " ", "right", " ", "now"}], ",", " ", 
          RowBox[{
          "the", " ", "rest", " ", "is", " ", "the", " ", "number", " ", "of",
            " ", "momenta", " ", "which", " ", "can", " ", "be", " ", 
           RowBox[{"formed", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", 
            RowBox[{"momenta", "=", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Select", "[", 
                  RowBox[{"#", ",", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "@", 
                    RowBox[{"First", "@", "#"}]}], "\[Equal]", "2"}], "&"}], 
                    ")"}]}], "]"}], "&"}], "@", 
                RowBox[{"GatherBy", "[", 
                 RowBox[{"#", ",", "Length"}], "]"}]}], "&"}], "@", 
              RowBox[{"GatherBy", "[", 
               RowBox[{
                RowBox[{"Join", "@@", 
                 RowBox[{"Tally", "/@", 
                  RowBox[{"Flatten", "/@", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"List", "@@@", "ag"}], ",", 
                    RowBox[{"List", "@@@", "sq"}]}], "}"}]}]}]}], ",", 
                "First"}], "]"}]}]}], "]"}], ">", "0"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"momenta", "=", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"First", "@", "#1"}], ",", 
                RowBox[{"Min", "@", "#2"}]}], "}"}], "&"}], "@@@", 
             RowBox[{"Transpose", "/@", 
              RowBox[{"First", "@", "momenta"}]}]}]}], ";"}], 
          "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{
             RowBox[{"If", " ", "momenta", " ", "has", " ", "length"}], "=", 
             RowBox[{
             "0", " ", "no", " ", "momenta", " ", "are", " ", "presents"}]}], 
            ",", " ", 
            RowBox[{
            "no", " ", "contractions", " ", "can", " ", "be", " ", "made", 
             " ", "and", " ", "we", " ", "return", " ", "the", " ", "input", 
             " ", "list", " ", "as", " ", "it", " ", "is"}]}], "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Return", "[", "exp", "]"}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Extract", " ", "the", " ", "positions", " ", "of", " ", "the", " ", 
          "brackets", " ", "containg", " ", "each", " ", "momentum", " ", 
          "and", " ", "then", " ", "pair", " ", "them"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"candidatecontractions", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"#", ",", "1"}], "]"}], "&"}], "/@", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"Outer", "[", 
              RowBox[{"List", ",", "#1", ",", "#2", ",", "1"}], "]"}], "&"}], 
            "@@@", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Position", "[", 
                  RowBox[{"ag", ",", "#"}], "]"}], ",", 
                 RowBox[{"Position", "[", 
                  RowBox[{"sq", ",", "#"}], "]"}]}], "}"}], "&"}], "/@", 
              RowBox[{"First", "@", 
               RowBox[{"Transpose", "@", "momenta"}]}]}], ")"}]}], ")"}]}]}], 
        ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Out", " ", "of", " ", "the", " ", "candidatecontractions", " ", "I",
           " ", "have", " ", "to", " ", "select", " ", "subsets", " ", "with",
           " ", "number", " ", "of", " ", "elements", " ", "given", " ", "by",
           " ", "the", " ", "multiplicity", " ", "of", " ", "the", " ", 
          "given", " ", "momentum", " ", "and", " ", "then", " ", "apply", 
          " ", "a", " ", "feasibility", " ", 
          RowBox[{"check", ":", " ", 
           RowBox[{
           "every", " ", "bracket", " ", "can", " ", "only", " ", "appear", 
            " ", "once", " ", "per", " ", 
            RowBox[{"momentum", "."}]}]}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"chains", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Subsets", "[", 
            RowBox[{"#1", ",", 
             RowBox[{"{", "#2", "}"}]}], "]"}], "&"}], "@@@", 
          RowBox[{"Transpose", "@", 
           RowBox[{"{", 
            RowBox[{"candidatecontractions", ",", 
             RowBox[{"Last", "@", 
              RowBox[{"Transpose", "@", "momenta"}]}]}], "}"}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"Apply", " ", 
          RowBox[{"check", ":"}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"chains", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"DeleteCases", "[", 
            RowBox[{"#", ",", 
             RowBox[{"_", "?", "feasibilitytest"}]}], "]"}], "&"}], "/@", 
          "chains"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Out", " ", "of", " ", "these", " ", "we", " ", "need", " ", "to", 
          " ", "take", " ", "all", " ", "possible", " ", 
          RowBox[{"combinations", "."}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"chains", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"#", ",", "1"}], "]"}], "&"}], "/@", 
          RowBox[{"Tuples", "@", "chains"}]}]}], ";"}]}], 
      "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Reoreder", " ", "list", " ", "such", " ", "that", " ", "the", " ", 
       "structure", " ", "of", " ", "contracted", " ", "chains", " ", "is", 
       " ", "visible"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"chains", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Apply", "[", 
         RowBox[{"chorder", ",", 
          RowBox[{
           RowBox[{
            RowBox[{"GatherBy", "[", 
             RowBox[{"#", ",", 
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", 
                 RowBox[{"2", ",", "1"}], "]"}], "]"}], "&"}]}], "]"}], "&"}],
            "/@", "chains"}], ",", 
          RowBox[{"{", "2", "}"}]}], "]"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"Flatten", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"Part", "[", 
                    RowBox[{"ag", ",", "#"}], "]"}], "&"}], "/@", "#1"}], ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Part", "[", 
                    RowBox[{"sq", ",", "#"}], "]"}], "&"}], "/@", "#2"}], ",",
                   "sign"}], "}"}], "&"}], "@@", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Complement", "[", 
                  RowBox[{
                   RowBox[{"Range", "@", 
                    RowBox[{"Length", "@", "ag"}]}], ",", "#1"}], "]"}], ",", 
                 RowBox[{"Complement", "[", 
                  RowBox[{
                   RowBox[{"Range", "@", 
                    RowBox[{"Length", "@", "sq"}]}], ",", "#2"}], "]"}]}], 
                "}"}]}], "&"}], "@@", 
             RowBox[{"Map", "[", 
              RowBox[{"First", ",", 
               RowBox[{"Transpose", "@", "#"}], ",", 
               RowBox[{"{", "2", "}"}]}], "]"}]}], ")"}]}], "&"}], "/@", 
         "chains"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Next", " ", "convert", " ", "to", " ", "chains", " ", "the", " ", 
       "single", " ", "parts"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", "chorder", "}"}], ",", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Next", " ", "we", " ", "transformtraces", " ", "from", " ", "even", 
         " ", "to", " ", "odd", " ", "chains", " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
           "so", " ", "far", " ", "we", " ", "counted", " ", "the", " ", 
            "number", " ", "of", " ", "momenta"}], ",", " ", 
           RowBox[{
           "now", " ", "we", " ", "count", " ", "the", " ", "number", " ", 
            "of", " ", "connections"}]}], ")"}]}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"chorder", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"i1_", ",", "j1_"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"i2_", ",", "j2_"}], "}"}]}], "}"}], ",", "x__", ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"i1_", ",", "_"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"_", ",", "_"}], "}"}]}], "}"}]}], "]"}], ":=", 
         RowBox[{"chorder", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"i1", ",", "j1"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"i2", ",", "j2"}], "}"}]}], "}"}], ",", "x"}], "]"}]}], 
        ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"Build", " ", "the", " ", "chains"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"chorder", "[", "x__", "]"}], ":=", 
         RowBox[{"ChainBuilder", "[", 
          RowBox[{
           RowBox[{"{", "x", "}"}], ",", "ag", ",", "sq"}], "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Reconvert", " ", "unique", " ", "labels", " ", "for", " ", "mixed", 
          " ", "chains", " ", "into", " ", "original", " ", "labels"}], 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"pp", "[", 
          RowBox[{"x_", ",", "_"}], "]"}], ":=", "x"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"Flatten", "/@", 
         RowBox[{"Transpose", "@", "chains"}]}]}]}], "\[IndentingNewLine]", 
      "]"}]}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.8260854674909954`*^9, 3.8260855958631334`*^9}, {
  3.8260867239123306`*^9, 3.8260867660992393`*^9}, {3.8260900432791076`*^9, 
  3.826090173559472*^9}, {3.826090240306055*^9, 3.826090244258606*^9}},
 CellLabel->"In[99]:=",ExpressionUUID->"f637b82b-44d3-4e04-bdfe-d9a9f06ff497"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Tests", "Subsubsection",
 CellChangeTimes->{{3.8260858782344847`*^9, 
  3.826085878841017*^9}},ExpressionUUID->"9a32612a-39a8-4fcf-b4e2-\
03f5615d275b"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"AllChains", "@", "test"}], "//", "RepeatedTiming"}]], "Input",
 CellChangeTimes->{{3.8260858805748434`*^9, 3.8260858858326*^9}, {
  3.8260867749757233`*^9, 3.8260867766993356`*^9}},
 CellLabel->"In[2]:=",ExpressionUUID->"b0b94f5d-dadd-4161-b9de-6836aecb94d1"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"2.51705139875412`*^-8", ",", 
   RowBox[{"AllChains", "[", "test", "]"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.82608588681911*^9, 3.8260867389841137`*^9, {3.8260867694463725`*^9, 
   3.8260867787364235`*^9}, {3.826090143144209*^9, 3.8260902121499834`*^9}, 
   3.8260902488927307`*^9, 3.826104276730688*^9},
 CellLabel->"Out[2]=",ExpressionUUID->"ba832ffc-56bd-4da8-a966-81303077353c"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"AllChains", "@", "test2"}]], "Input",
 CellChangeTimes->{{3.8260858887566338`*^9, 3.826085891303673*^9}},
 CellLabel->"In[3]:=",ExpressionUUID->"8b175950-e463-49d0-b8e0-38a562bf662e"],

Cell[BoxData[
 RowBox[{"AllChains", "[", "test2", "]"}]], "Output",
 CellChangeTimes->{3.826085891764777*^9, 3.8260867806939335`*^9, 
  3.826090220633299*^9, 3.8260902533293657`*^9, 3.826104277029885*^9},
 CellLabel->"Out[3]=",ExpressionUUID->"8860ca49-6ba2-4149-90bf-33255da22863"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"AllChains", "@", "test3"}]], "Input",
 CellChangeTimes->{{3.826085893396079*^9, 3.826085896085808*^9}},
 CellLabel->"In[4]:=",ExpressionUUID->"3df008c2-4887-4915-a2ef-8d87ed050852"],

Cell[BoxData[
 RowBox[{"AllChains", "[", "test3", "]"}]], "Output",
 CellChangeTimes->{3.826085896523862*^9, 3.826086781616314*^9, 
  3.8260902221332912`*^9, 3.8260902547698603`*^9, 3.82610427719242*^9},
 CellLabel->"Out[4]=",ExpressionUUID->"8798d2c8-526b-44e6-8b3f-0d220f86f36f"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"AllChains", "@", "test4"}]], "Input",
 CellChangeTimes->{{3.82608590108724*^9, 3.826085904768368*^9}},
 CellLabel->"In[5]:=",ExpressionUUID->"ac1b8ec2-b415-4ed5-b957-9cf1e85da7ae"],

Cell[BoxData[
 RowBox[{"AllChains", "[", "test4", "]"}]], "Output",
 CellChangeTimes->{3.826085905253146*^9, 3.8260867822566714`*^9, 
  3.8260902242892103`*^9, 3.8260902560544477`*^9, 3.8261042773091383`*^9},
 CellLabel->"Out[5]=",ExpressionUUID->"d3102b21-d10c-4dc8-8162-778dd104ab83"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"AllChains", "@", "test5"}]], "Input",
 CellChangeTimes->{{3.826085907356995*^9, 3.826085910274787*^9}},
 CellLabel->"In[6]:=",ExpressionUUID->"d66bb99f-8a92-4e4c-a977-3a6a40b949b7"],

Cell[BoxData[
 RowBox[{"AllChains", "[", "test5", "]"}]], "Output",
 CellChangeTimes->{3.8260859108927145`*^9, 3.826086783019204*^9, 
  3.8260902572387342`*^9, 3.8261042774218035`*^9},
 CellLabel->"Out[6]=",ExpressionUUID->"4ae1eca9-5c75-40d0-b613-067f1141c8f1"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"AllChains", "@", "test6"}]], "Input",
 CellChangeTimes->{{3.826085917661482*^9, 3.826085922655159*^9}},
 CellLabel->"In[7]:=",ExpressionUUID->"ba36343f-7260-4358-80a6-a636a9db8be9"],

Cell[BoxData[
 RowBox[{"AllChains", "[", "test6", "]"}]], "Output",
 CellChangeTimes->{3.826085923631719*^9, 3.826086783749535*^9, 
  3.8260902591134243`*^9, 3.8261042775285206`*^9},
 CellLabel->"Out[7]=",ExpressionUUID->"c5eeedb8-02f6-42c5-b4b3-a85826859333"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"AllChains", "@", "test7"}]], "Input",
 CellChangeTimes->{{3.826085925658977*^9, 3.8260859286426296`*^9}},
 CellLabel->"In[8]:=",ExpressionUUID->"e4099d80-d256-46e0-9783-51dc24612bcc"],

Cell[BoxData[
 RowBox[{"AllChains", "[", "test7", "]"}]], "Output",
 CellChangeTimes->{3.8260859295962453`*^9, 3.8260867843472147`*^9, 
  3.82609026075816*^9, 3.8261042776352663`*^9},
 CellLabel->"Out[8]=",ExpressionUUID->"ed344d7d-608d-46e7-a996-8a98f8477cca"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"AllChains", "@", "test8"}]], "Input",
 CellChangeTimes->{{3.826090262283044*^9, 3.826090266897027*^9}},
 CellLabel->"In[9]:=",ExpressionUUID->"62b711e8-1bc3-4ef2-b178-61a93eddeeb3"],

Cell[BoxData[
 RowBox[{"AllChains", "[", "test8", "]"}]], "Output",
 CellChangeTimes->{3.826090267862179*^9, 3.8261042777409496`*^9},
 CellLabel->"Out[9]=",ExpressionUUID->"17782683-9ad1-42d8-b887-934354e0e554"]
}, Open  ]]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["From expression to lists of brackets", "Subsection",
 CellChangeTimes->{{3.8260904890295258`*^9, 
  3.8260905042689924`*^9}},ExpressionUUID->"a2a9e926-161a-451a-ae3c-\
50d9167a8bb1"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"3", "*", "a", "*", 
   RowBox[{"Times", "@@", "test"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"prova", "=", 
  RowBox[{
   RowBox[{"%", "/", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       TemplateBox[{"6", "7"},
        "SpinorAngleBracket",
        DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
           RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
        InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
           RowBox[{#, ",", #2}], "]"}]& )], "^", "2"}], 
      TemplateBox[{"7", "8"},
       "SpinorSquareBracket",
       DisplayFunction->(RowBox[{"[", 
          RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )]}], ")"}]}], "*", 
   RowBox[{
    TemplateBox[{"9", "10"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "^", "3"}]}]}]}], "Input",
 CellLabel->
  "In[109]:=",ExpressionUUID->"5e67be19-5b9b-4618-b23f-fc01e54dd92a"],

Cell[BoxData[
 FractionBox[
  RowBox[{"3", " ", "a", " ", 
   TemplateBox[{"1", "2"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], " ", 
   TemplateBox[{"3", "4"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], " ", 
   TemplateBox[{"5", "6"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], " ", 
   SuperscriptBox[
    TemplateBox[{"9", "10"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "3"], " ", 
   TemplateBox[{"1", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], " ", 
   TemplateBox[{"2", "3"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], " ", 
   TemplateBox[{"2", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}], 
  RowBox[{
   SuperscriptBox[
    TemplateBox[{"6", "7"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "2"], " ", 
   TemplateBox[{"7", "8"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}]]], "Output",
 CellChangeTimes->{3.8260905116246204`*^9},
 CellLabel->
  "Out[110]=",ExpressionUUID->"690829b1-b2fc-41ad-b960-b64d2d7f3973"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Module", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"exp", ",", "locexp", ",", "tochain", ",", "tochaininv"}], "}"}], 
   ",", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"exp", "=", "prova"}], ";", "\[IndentingNewLine]", 
    RowBox[{"locexp", "=", "exp"}], ";", "\[IndentingNewLine]", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"Power", ",", "Times"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Power", "[", 
          RowBox[{
           RowBox[{"f_", "[", "x__", "]"}], ",", 
           RowBox[{"p_", "?", "Negative"}]}], "]"}], "/;", 
         RowBox[{
          RowBox[{"f", "\[Equal]", "SpinorAngleBracket"}], "||", 
          RowBox[{"f", "\[Equal]", "SpinorSquareBracket"}], "||", 
          RowBox[{"f", "\[Equal]", "Chain"}]}]}], ":=", 
        RowBox[{"tochaininv", "[", 
         RowBox[{"Sequence", "@@", 
          RowBox[{"ConstantArray", "[", 
           RowBox[{
            RowBox[{"f", "[", "x", "]"}], ",", 
            RowBox[{"-", "p"}]}], "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"Power", "[", 
          RowBox[{
           RowBox[{"f_", "[", "x__", "]"}], ",", "p_"}], "]"}], "/;", 
         RowBox[{
          RowBox[{"f", "\[Equal]", "SpinorAngleBracket"}], "||", 
          RowBox[{"f", "\[Equal]", "SpinorSquareBracket"}], "||", 
          RowBox[{"f", "\[Equal]", "Chain"}]}]}], ":=", 
        RowBox[{"tochain", "[", 
         RowBox[{"Sequence", "@@", 
          RowBox[{"ConstantArray", "[", 
           RowBox[{
            RowBox[{"f", "[", "x", "]"}], ",", "p"}], "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"Times", "[", 
          RowBox[{"z___", ",", 
           RowBox[{"f_", "[", "x__", "]"}], ",", "y___"}], "]"}], "/;", 
         RowBox[{
          RowBox[{"f", "\[Equal]", "SpinorAngleBracket"}], "||", 
          RowBox[{"f", "\[Equal]", "SpinorSquareBracket"}], "||", 
          RowBox[{"f", "\[Equal]", "Chain"}]}]}], ":=", 
        RowBox[{"Times", "[", 
         RowBox[{"z", ",", 
          RowBox[{"tochain", "[", 
           RowBox[{"f", "[", "x", "]"}], "]"}], ",", "y"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"locexp", "=", "locexp"}], ";"}]}], "\[IndentingNewLine]", 
     "]"}], ";", "\[IndentingNewLine]", 
    RowBox[{"tochain", " ", "/:", " ", 
     RowBox[{"Times", "[", 
      RowBox[{
       RowBox[{"tochain", "[", "x__", "]"}], ",", 
       RowBox[{"tochain", "[", "y__", "]"}], ",", "z___"}], "]"}], ":=", 
     RowBox[{"Times", "[", 
      RowBox[{
       RowBox[{"tochain", "[", 
        RowBox[{"x", ",", "y"}], "]"}], ",", "z"}], "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"tochaininv", " ", "/:", " ", 
     RowBox[{"Times", "[", 
      RowBox[{
       RowBox[{"tochaininv", "[", "x__", "]"}], ",", 
       RowBox[{"tochaininv", "[", "y__", "]"}], ",", "z___"}], "]"}], ":=", 
     RowBox[{"Times", "[", 
      RowBox[{
       RowBox[{"tochaininv", "[", 
        RowBox[{"x", ",", "y"}], "]"}], ",", "z"}], "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"locexp", "=", 
     RowBox[{"locexp", "//", "Echo"}]}], ";"}]}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellChangeTimes->{{3.826090426302292*^9, 3.8260904602770996`*^9}, {
  3.8260905205119104`*^9, 3.826090538142803*^9}},
 CellLabel->
  "In[111]:=",ExpressionUUID->"f7fd47a3-e78d-429c-ba43-4c3324e96882"],

Cell[BoxData[
 RowBox[{"3", " ", "a", " ", 
  RowBox[{"tochaininv$45796", "[", 
   RowBox[{
    TemplateBox[{"7", "8"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"6", "7"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"6", "7"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )]}], "]"}], " ", 
  RowBox[{"tochain$45796", "[", 
   RowBox[{
    TemplateBox[{"1", "2"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"3", "4"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"5", "6"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"1", "4"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"2", "3"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"2", "4"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"9", "10"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"9", "10"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], ",", 
    TemplateBox[{"9", "10"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )]}], "]"}]}]], "Echo",
 CellChangeTimes->{
  3.8260905404889717`*^9},ExpressionUUID->"2f2baf97-91dc-4972-85ed-\
65c08b2e76f4"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"Options", "[", "ToChainNew", "]"}], "=", 
  RowBox[{"{", 
   RowBox[{"ChainSelection", "->", "\"\<ShortestChain\>\""}], 
   "}"}]}]], "Input",
 CellChangeTimes->{{3.8255094588937373`*^9, 3.825509492088255*^9}, 
   3.8255095261173553`*^9},
 CellLabel->
  "In[112]:=",ExpressionUUID->"bf03ee2d-8c11-4f8a-a7c7-1a45e88b88f9"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"ChainSelection", "\[Rule]", "\<\"ShortestChain\"\>"}], 
  "}"}]], "Output",
 CellChangeTimes->{3.825509575870757*^9, 3.8260906286488495`*^9},
 CellLabel->
  "Out[112]=",ExpressionUUID->"553172c9-acb3-42d3-873d-f99872117df8"]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"ToChainNew", "[", 
   RowBox[{"exp_", ",", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "locexp", ",", "tochain", ",", "tochaininv", ",", "chainCrit", ",", 
      "chainselect"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"locexp", "=", "exp"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"Power", ",", "Times"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"f_", "[", "x__", "]"}], ",", 
            RowBox[{"p_", "?", "Negative"}]}], "]"}], "/;", 
          RowBox[{
           RowBox[{"f", "\[Equal]", "SpinorAngleBracket"}], "||", 
           RowBox[{"f", "\[Equal]", "SpinorSquareBracket"}], "||", 
           RowBox[{"f", "\[Equal]", "Chain"}]}]}], ":=", 
         RowBox[{"tochaininv", "[", 
          RowBox[{"Sequence", "@@", 
           RowBox[{"ConstantArray", "[", 
            RowBox[{
             RowBox[{"f", "[", "x", "]"}], ",", 
             RowBox[{"-", "p"}]}], "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"f_", "[", "x__", "]"}], ",", "p_"}], "]"}], "/;", 
          RowBox[{
           RowBox[{"f", "\[Equal]", "SpinorAngleBracket"}], "||", 
           RowBox[{"f", "\[Equal]", "SpinorSquareBracket"}], "||", 
           RowBox[{"f", "\[Equal]", "Chain"}]}]}], ":=", 
         RowBox[{"tochain", "[", 
          RowBox[{"Sequence", "@@", 
           RowBox[{"ConstantArray", "[", 
            RowBox[{
             RowBox[{"f", "[", "x", "]"}], ",", "p"}], "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"Times", "[", 
           RowBox[{"z___", ",", 
            RowBox[{"f_", "[", "x__", "]"}], ",", "y___"}], "]"}], "/;", 
          RowBox[{
           RowBox[{"f", "\[Equal]", "SpinorAngleBracket"}], "||", 
           RowBox[{"f", "\[Equal]", "SpinorSquareBracket"}], "||", 
           RowBox[{"f", "\[Equal]", "Chain"}]}]}], ":=", 
         RowBox[{"Times", "[", 
          RowBox[{"z", ",", 
           RowBox[{"tochain", "[", 
            RowBox[{"f", "[", "x", "]"}], "]"}], ",", "y"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"locexp", "=", "locexp"}], ";"}]}], "\[IndentingNewLine]", 
      "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"tochain", " ", "/:", " ", 
      RowBox[{"Times", "[", 
       RowBox[{
        RowBox[{"tochain", "[", "x__", "]"}], ",", 
        RowBox[{"tochain", "[", "y__", "]"}], ",", "z___"}], "]"}], ":=", 
      RowBox[{"Times", "[", 
       RowBox[{
        RowBox[{"tochain", "[", 
         RowBox[{"x", ",", "y"}], "]"}], ",", "z"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"tochaininv", " ", "/:", " ", 
      RowBox[{"Times", "[", 
       RowBox[{
        RowBox[{"tochaininv", "[", "x__", "]"}], ",", 
        RowBox[{"tochaininv", "[", "y__", "]"}], ",", "z___"}], "]"}], ":=", 
      RowBox[{"Times", "[", 
       RowBox[{
        RowBox[{"tochaininv", "[", 
         RowBox[{"x", ",", "y"}], "]"}], ",", "z"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"locexp", "=", "locexp"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Basing", " ", "on", " ", "the", " ", "options", " ", "we", " ", 
       "decide", " ", "which", " ", "chain", " ", "we", " ", "want", " ", 
       "to", " ", "pick"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"chainCrit", "=", 
      RowBox[{"OptionValue", "[", "ChainSelection", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Which", "[", 
      RowBox[{
       RowBox[{"chainCrit", "===", "\"\<ShortestChain\>\""}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"chainselect", "[", "chains_List", "]"}], ":=", 
        RowBox[{"Times", "@@", 
         RowBox[{"Last", "@", 
          RowBox[{"SortBy", "[", 
           RowBox[{"chains", ",", "Length"}], "]"}]}]}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"chainCrit", "===", "\"\<LongestChain\>\""}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"chainselect", "[", "chains_List", "]"}], ":=", 
        RowBox[{"Times", "@@", 
         RowBox[{"First", "@", 
          RowBox[{"SortBy", "[", 
           RowBox[{"chains", ",", "Length"}], "]"}]}]}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"chainCrit", "===", "\"\<MostTraces\>\""}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"chainselect", "[", "chains_List", "]"}], ":=", 
        RowBox[{"Times", "@@", 
         RowBox[{"Last", "@", 
          RowBox[{"SortBy", "[", 
           RowBox[{"chains", ",", 
            RowBox[{
             RowBox[{"Length", "@", 
              RowBox[{"Cases", "[", 
               RowBox[{"#", ",", 
                RowBox[{
                 RowBox[{"Chain", "[", 
                  RowBox[{"$angle", ",", "x_", ",", 
                   RowBox[{"{", "__", "}"}], ",", "x_", ",", "$square"}], 
                  "]"}], "\[RuleDelayed]", "1"}]}], "]"}]}], "&"}]}], 
           "]"}]}]}]}], ",", "\[IndentingNewLine]", "True", ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"chainselect", "[", "chains_List", "]"}], ":=", 
        RowBox[{"Times", "@@", 
         RowBox[{"Last", "@", 
          RowBox[{"SortBy", "[", 
           RowBox[{"chains", ",", "Length"}], "]"}]}]}]}]}], 
      "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"tochain", "[", "x__", "]"}], ":=", 
      RowBox[{"chainselect", "@", 
       RowBox[{"AllChains", "[", 
        RowBox[{"{", "x", "}"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"tochaininv", "[", "x__", "]"}], ":=", 
      RowBox[{"Power", "[", 
       RowBox[{
        RowBox[{"chainselect", "@", 
         RowBox[{"AllChains", "[", 
          RowBox[{"{", "x", "}"}], "]"}]}], ",", 
        RowBox[{"-", "1"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     "locexp"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGAQAWIQ/XThwvyuhjeOFVyCFSD6vYNrLYju2FzUAaLNtk2b
D6JF75osBNE3akxWgGgFnzdrQPS0oMDDILqNM+06iF680vo2iD533PUpiJbc
veUliD4098IbEN2bMP0XiL7yvv0PiDZiF2bpBtIpsx4pgWixSV0aIJrh2S0w
7fRWxBREn3rZbAaiV6Qu9gXR36zDYkG07b0VKSC64yZHM4j2zOqa1wukG7mU
N4Bog9NLToJoCX6zWyB6w6PGiilA+o1wQj2IPsHd3QyiD83/NBFEv9I4MwtE
uzkEzQbRVvMrgzY0vnEMLZcIBtHRpbmRIFrPrA5MAwBSI6pt
  "],
 CellLabel->
  "In[115]:=",ExpressionUUID->"6744b29d-e8cc-4cd6-8723-316398603349"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"3", "*", "a", "*", 
   RowBox[{"Times", "@@", "test"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"prova", "=", 
  RowBox[{
   RowBox[{"%", "/", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       TemplateBox[{"6", "7"},
        "SpinorAngleBracket",
        DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
           RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
        InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
           RowBox[{#, ",", #2}], "]"}]& )], "^", "2"}], 
      TemplateBox[{"7", "8"},
       "SpinorSquareBracket",
       DisplayFunction->(RowBox[{"[", 
          RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )]}], ")"}]}], "*", 
   RowBox[{
    TemplateBox[{"9", "10"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "^", "3"}]}]}]}], "Input",ExpressionU\
UID->"2ef72c2f-f320-4092-b02a-df5667ebd122"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"ToChainNew", "[", "prova", "]"}], "//", 
  "RepeatedTiming"}]], "Input",
 CellChangeTimes->{{3.826090657812259*^9, 3.8260906643794637`*^9}, {
  3.8260907110482945`*^9, 3.8260907140958633`*^9}},
 CellLabel->
  "In[117]:=",ExpressionUUID->"41ae963b-b90d-473b-ae5d-90403b105ac1"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.00285350234375`", ",", 
   RowBox[{"-", 
    FractionBox[
     RowBox[{"3", " ", "a", " ", 
      TemplateBox[{"4", 
        RowBox[{"{", 
          RowBox[{"3", ",", "2", ",", "1"}], "}"}], "4"},
       "AngleSquareChain",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
       InterpretationFunction->(
        RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
          "$square", "]"}]& )], " ", 
      TemplateBox[{"5", "6"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], " ", 
      SuperscriptBox[
       TemplateBox[{"9", "10"},
        "SpinorAngleBracket",
        DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
           RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
        InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
           RowBox[{#, ",", #2}], "]"}]& )], "3"], " ", 
      TemplateBox[{"2", "4"},
       "SpinorSquareBracket",
       DisplayFunction->(RowBox[{"[", 
          RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )]}], 
     RowBox[{
      TemplateBox[{"6", 
        RowBox[{"{", "7", "}"}], "8"},
       "AngleSquareChain",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
       InterpretationFunction->(
        RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
          "$square", "]"}]& )], " ", 
      TemplateBox[{"6", "7"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )]}]]}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.8260906652649574`*^9, {3.826090708456194*^9, 3.8260907160306473`*^9}},
 CellLabel->
  "Out[117]=",ExpressionUUID->"665ae75d-aae1-46a2-9236-a8b08bb43550"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"prova", "//", "ToChain"}], "//", "RepeatedTiming"}]], "Input",
 CellChangeTimes->{{3.826090720629075*^9, 3.826090737379736*^9}},
 CellLabel->
  "In[119]:=",ExpressionUUID->"9aac6139-5179-495f-ad96-4bd9fdda7e96"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.00099061953125`", ",", 
   RowBox[{"-", 
    FractionBox[
     RowBox[{"3", " ", "a", " ", 
      TemplateBox[{"2", 
        RowBox[{"{", 
          RowBox[{"4", ",", "3", ",", "2", ",", "1"}], "}"}], "4"},
       "SquareSquareChain",
       DisplayFunction->(RowBox[{"[", #, #2, #3, "]"}]& ),
       InterpretationFunction->(
        RowBox[{"Chain", "[", "$square", ",", #, ",", #2, ",", #3, ",", 
          "$square", "]"}]& )], " ", 
      TemplateBox[{"5", "6"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], " ", 
      SuperscriptBox[
       TemplateBox[{"9", "10"},
        "SpinorAngleBracket",
        DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
           RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
        InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
           RowBox[{#, ",", #2}], "]"}]& )], "3"]}], 
     RowBox[{
      SuperscriptBox[
       TemplateBox[{"6", "7"},
        "SpinorAngleBracket",
        DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
           RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
        InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
           RowBox[{#, ",", #2}], "]"}]& )], "2"], " ", 
      TemplateBox[{"7", "8"},
       "SpinorSquareBracket",
       DisplayFunction->(RowBox[{"[", 
          RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )]}]]}]}], "}"}]], "Output",
 CellChangeTimes->{{3.8260907255700073`*^9, 3.8260907387764635`*^9}},
 CellLabel->
  "Out[119]=",ExpressionUUID->"9c5db727-91f6-4961-bbd9-d3c8032dd269"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"prova", "//", "ToChain2"}], "//", "RepeatedTiming"}]], "Input",
 CellChangeTimes->{{3.8260922301426477`*^9, 3.826092238823534*^9}},
 CellLabel->
  "In[137]:=",ExpressionUUID->"d63de83d-973c-4e38-bfc4-f3decaf51a75"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.00124085078125`", ",", 
   RowBox[{"-", 
    FractionBox[
     RowBox[{"3", " ", "a", " ", 
      TemplateBox[{"2", 
        RowBox[{"{", 
          RowBox[{"4", ",", "3", ",", "2", ",", "1"}], "}"}], "4"},
       "SquareSquareChain",
       DisplayFunction->(RowBox[{"[", #, #2, #3, "]"}]& ),
       InterpretationFunction->(
        RowBox[{"Chain", "[", "$square", ",", #, ",", #2, ",", #3, ",", 
          "$square", "]"}]& )], " ", 
      TemplateBox[{"5", "6"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], " ", 
      SuperscriptBox[
       TemplateBox[{"9", "10"},
        "SpinorAngleBracket",
        DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
           RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
        InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
           RowBox[{#, ",", #2}], "]"}]& )], "3"]}], 
     RowBox[{
      TemplateBox[{"6", 
        RowBox[{"{", "7", "}"}], "8"},
       "AngleSquareChain",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
       InterpretationFunction->(
        RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
          "$square", "]"}]& )], " ", 
      TemplateBox[{"6", "7"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )]}]]}]}], "}"}]], "Output",
 CellChangeTimes->{3.8260922404812455`*^9},
 CellLabel->
  "Out[137]=",ExpressionUUID->"ee57cfa0-ecd2-4d06-88db-0856c140aac6"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
   "The", " ", "new", " ", "algorith", " ", "scales", " ", "very", " ", 
    "badly", " ", "with", " ", "powers", " ", "of", " ", "contracted", " ", 
    "spinors"}], ",", " ", 
   RowBox[{
   "due", " ", "to", " ", "the", " ", "increasing", " ", "combinatorics"}]}], 
  "*)"}]], "Input",
 CellChangeTimes->{{3.82609287496174*^9, 
  3.82609290084047*^9}},ExpressionUUID->"9c538d70-290f-4456-a7f0-\
30801d954ef0"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"prova", "=", 
  FractionBox[
   RowBox[{"3", " ", "a", " ", 
    TemplateBox[{"1", "2"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], " ", 
    RowBox[{
     TemplateBox[{"3", "4"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], "^", "5"}], 
    TemplateBox[{"5", "6"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], " ", 
    SuperscriptBox[
     TemplateBox[{"9", "10"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], "3"], " ", 
    TemplateBox[{"1", "4"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], " ", 
    TemplateBox[{"2", "3"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], " ", 
    TemplateBox[{"2", "4"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )]}], 
   RowBox[{
    SuperscriptBox[
     TemplateBox[{"6", "7"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], "2"], " ", 
    TemplateBox[{"7", "8"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )]}]]}]], "Input",
 CellChangeTimes->{{3.826092661006186*^9, 3.8260926796972055`*^9}},
 CellLabel->
  "In[138]:=",ExpressionUUID->"04aacc1f-f62e-4cff-8962-46a1b20bd32f"],

Cell[BoxData[
 FractionBox[
  RowBox[{"3", " ", "a", " ", 
   TemplateBox[{"1", "2"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], " ", 
   SuperscriptBox[
    TemplateBox[{"3", "4"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "5"], " ", 
   TemplateBox[{"5", "6"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], " ", 
   SuperscriptBox[
    TemplateBox[{"9", "10"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "3"], " ", 
   TemplateBox[{"1", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], " ", 
   TemplateBox[{"2", "3"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], " ", 
   TemplateBox[{"2", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}], 
  RowBox[{
   SuperscriptBox[
    TemplateBox[{"6", "7"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "2"], " ", 
   TemplateBox[{"7", "8"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}]]], "Output",
 CellChangeTimes->{3.8260926803938875`*^9},
 CellLabel->
  "Out[138]=",ExpressionUUID->"e648eee8-fbe7-40dd-99be-ce9a491971ed"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"prova", "//", "ToChainNew"}], "//", "RepeatedTiming"}]], "Input",
 CellChangeTimes->{{3.8260926842625675`*^9, 3.826092696649456*^9}},
 CellLabel->
  "In[140]:=",ExpressionUUID->"f36c3ed0-6268-4522-9107-6732880e52cf"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.027460759375`", ",", 
   FractionBox[
    RowBox[{"3", " ", "a", " ", 
     TemplateBox[{"3", 
       RowBox[{"{", "4", "}"}], "2"},
      "AngleSquareChain",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], " ", 
     TemplateBox[{"4", 
       RowBox[{"{", 
         RowBox[{"3", ",", "2", ",", "1"}], "}"}], "4"},
      "AngleSquareChain",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], " ", 
     SuperscriptBox[
      TemplateBox[{"3", "4"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], "3"], " ", 
     TemplateBox[{"5", "6"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], " ", 
     SuperscriptBox[
      TemplateBox[{"9", "10"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], "3"]}], 
    RowBox[{
     TemplateBox[{"6", 
       RowBox[{"{", "7", "}"}], "8"},
      "AngleSquareChain",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], " ", 
     TemplateBox[{"6", "7"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}]]}], "}"}]], "Output",
 CellChangeTimes->{{3.8260926899388385`*^9, 3.8260926986785913`*^9}},
 CellLabel->
  "Out[140]=",ExpressionUUID->"62981040-c3bd-4a9d-a540-395a183221ea"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"prova", "//", "ToChain2"}], "//", "RepeatedTiming"}]], "Input",
 CellChangeTimes->{{3.8260927019718723`*^9, 3.826092709515093*^9}},
 CellLabel->
  "In[141]:=",ExpressionUUID->"94b1c5dc-32dc-4d4f-9981-48c8787c9897"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.00228884375`", ",", 
   FractionBox[
    RowBox[{"3", " ", "a", " ", 
     TemplateBox[{"3", 
       RowBox[{"{", "4", "}"}], "2"},
      "AngleSquareChain",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], " ", 
     TemplateBox[{"3", 
       RowBox[{"{", 
         RowBox[{"4", ",", "1", ",", "2", ",", "3"}], "}"}], "4"},
      "AngleAngleChain",
      DisplayFunction->(
       RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
         "$angle", "]"}]& )], " ", 
     SuperscriptBox[
      TemplateBox[{"3", "4"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], "2"], " ", 
     TemplateBox[{"5", "6"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], " ", 
     SuperscriptBox[
      TemplateBox[{"9", "10"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], "3"]}], 
    RowBox[{
     TemplateBox[{"6", 
       RowBox[{"{", "7", "}"}], "8"},
      "AngleSquareChain",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], " ", 
     TemplateBox[{"6", "7"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}]]}], "}"}]], "Output",
 CellChangeTimes->{3.8260927110189457`*^9},
 CellLabel->
  "Out[141]=",ExpressionUUID->"2007b4d3-908a-4d1f-9647-f41db3215dc0"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"prova", "=", 
  FractionBox[
   RowBox[{"3", " ", "a", " ", 
    TemplateBox[{"1", "2"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], " ", 
    RowBox[{
     TemplateBox[{"3", "4"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], "^", "9"}], 
    TemplateBox[{"5", "6"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], " ", 
    SuperscriptBox[
     TemplateBox[{"9", "10"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], "3"], " ", 
    TemplateBox[{"1", "4"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], " ", 
    TemplateBox[{"2", "3"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], " ", 
    TemplateBox[{"2", "4"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )]}], 
   RowBox[{
    SuperscriptBox[
     TemplateBox[{"6", "7"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], "2"], " ", 
    TemplateBox[{"7", "8"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )]}]]}]], "Input",
 CellChangeTimes->{{3.826092661006186*^9, 3.8260926796972055`*^9}, {
  3.8260927945023746`*^9, 3.826092794904709*^9}},
 CellLabel->
  "In[142]:=",ExpressionUUID->"fc2854d5-2b49-4365-9a83-ab4058e58e38"],

Cell[BoxData[
 FractionBox[
  RowBox[{"3", " ", "a", " ", 
   TemplateBox[{"1", "2"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], " ", 
   SuperscriptBox[
    TemplateBox[{"3", "4"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "9"], " ", 
   TemplateBox[{"5", "6"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], " ", 
   SuperscriptBox[
    TemplateBox[{"9", "10"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "3"], " ", 
   TemplateBox[{"1", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], " ", 
   TemplateBox[{"2", "3"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], " ", 
   TemplateBox[{"2", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}], 
  RowBox[{
   SuperscriptBox[
    TemplateBox[{"6", "7"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "2"], " ", 
   TemplateBox[{"7", "8"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}]]], "Output",
 CellChangeTimes->{3.8260926803938875`*^9, 3.826092795569131*^9},
 CellLabel->
  "Out[142]=",ExpressionUUID->"7ff93003-24e2-4272-847c-70487da920e9"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"prova", "//", "ToChainNew"}], "//", "RepeatedTiming"}]], "Input",
 CellChangeTimes->{{3.8260926842625675`*^9, 3.826092696649456*^9}},
 CellLabel->
  "In[143]:=",ExpressionUUID->"49fb13ae-90ac-4b3a-a86e-34b75d676606"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.150754275`", ",", 
   FractionBox[
    RowBox[{"3", " ", "a", " ", 
     TemplateBox[{"3", 
       RowBox[{"{", "4", "}"}], "2"},
      "AngleSquareChain",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], " ", 
     TemplateBox[{"4", 
       RowBox[{"{", 
         RowBox[{"3", ",", "2", ",", "1"}], "}"}], "4"},
      "AngleSquareChain",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], " ", 
     SuperscriptBox[
      TemplateBox[{"3", "4"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], "7"], " ", 
     TemplateBox[{"5", "6"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], " ", 
     SuperscriptBox[
      TemplateBox[{"9", "10"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], "3"]}], 
    RowBox[{
     TemplateBox[{"6", 
       RowBox[{"{", "7", "}"}], "8"},
      "AngleSquareChain",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], " ", 
     TemplateBox[{"6", "7"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}]]}], "}"}]], "Output",
 CellChangeTimes->{{3.8260926899388385`*^9, 3.8260926986785913`*^9}, 
   3.8260927993187933`*^9},
 CellLabel->
  "Out[143]=",ExpressionUUID->"fdd6c757-7333-4522-bd04-022887ee6df6"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"prova", "//", "ToChain2"}], "//", "RepeatedTiming"}]], "Input",
 CellChangeTimes->{{3.8260927019718723`*^9, 3.826092709515093*^9}},
 CellLabel->
  "In[144]:=",ExpressionUUID->"497d89e2-db35-482b-a429-b1f7a31b5ecb"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.002232060546875`", ",", 
   FractionBox[
    RowBox[{"3", " ", "a", " ", 
     TemplateBox[{"3", 
       RowBox[{"{", "4", "}"}], "2"},
      "AngleSquareChain",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], " ", 
     TemplateBox[{"3", 
       RowBox[{"{", 
         RowBox[{"4", ",", "1", ",", "2", ",", "3"}], "}"}], "4"},
      "AngleAngleChain",
      DisplayFunction->(
       RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
         "$angle", "]"}]& )], " ", 
     SuperscriptBox[
      TemplateBox[{"3", "4"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], "6"], " ", 
     TemplateBox[{"5", "6"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], " ", 
     SuperscriptBox[
      TemplateBox[{"9", "10"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], "3"]}], 
    RowBox[{
     TemplateBox[{"6", 
       RowBox[{"{", "7", "}"}], "8"},
      "AngleSquareChain",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], " ", 
     TemplateBox[{"6", "7"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}]]}], "}"}]], "Output",
 CellChangeTimes->{3.8260927110189457`*^9, 3.8260928023991604`*^9},
 CellLabel->
  "Out[144]=",ExpressionUUID->"78653999-4216-463d-9450-141cb1a90836"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Removing powers from chain combinatorics", "Subsection",
 CellChangeTimes->{{3.826093215394555*^9, 
  3.826093224151723*^9}},ExpressionUUID->"5a59b38f-d462-4afb-8c72-\
7352834fd501"],

Cell[CellGroupData[{

Cell["Auxiliary", "Subsubsection",
 CellChangeTimes->{{3.826085814342921*^9, 
  3.826085816002061*^9}},ExpressionUUID->"4c7d08ff-3b81-4450-9f9f-\
0ff82df2718c"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
   "Auxiliary", " ", "function", " ", "to", " ", "test", " ", "for", " ", 
    "duplicates", " ", "in", " ", "a", " ", "list"}], ",", " ", 
   RowBox[{
   "returns", " ", "False", " ", "if", " ", "there", " ", "are", " ", "no", 
    " ", "duplicates"}]}], "*)"}]], "Input",
 CellChangeTimes->{{3.825768477952244*^9, 3.825768502537095*^9}},
 CellLabel->"In[9]:=",ExpressionUUID->"4423a820-611d-46ec-9a25-cdfad8d7359e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"duplicatesQ", " ", "=", " ", 
   RowBox[{
    RowBox[{"0", " ", "===", 
     RowBox[{"Signature", "@", "#"}]}], "&"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.825768375158662*^9, 3.825768420305456*^9}},
 CellLabel->"In[10]:=",ExpressionUUID->"a9c4197b-7308-43f7-aad9-aaa5cfe9ee44"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
   "Auxiliary", " ", "function", " ", "for", " ", "testing", " ", "if", " ", 
    "a", " ", "contraction", " ", "is", " ", "possible"}], ",", " ", 
   RowBox[{
    RowBox[{"i", ".", "e", ".", " ", "if"}], " ", "every", " ", "bracket", 
    " ", "appears", " ", "at", " ", "most", " ", "once"}]}], "*)"}]], "Input",
 CellChangeTimes->{{3.825768686925809*^9, 3.825768698761897*^9}, {
  3.8257687466477566`*^9, 3.8257687555509386`*^9}},
 CellLabel->"In[11]:=",ExpressionUUID->"50ef5d0a-b366-40ec-85b0-08317a4505fa"],

Cell[BoxData[
 RowBox[{
  RowBox[{"feasibilitytest", " ", "=", 
   RowBox[{
    RowBox[{"Or", "@@", " ", 
     RowBox[{"duplicatesQ", "/@", 
      RowBox[{"Transpose", "@", 
       RowBox[{"(", 
        RowBox[{"First", "/@", 
         RowBox[{"Transpose", "/@", "#"}]}], ")"}]}]}]}], "&"}]}], 
  ";"}]], "Input",
 CellLabel->"In[12]:=",ExpressionUUID->"69af6dbf-92b1-4bf8-9d0c-b9915c4bf1f3"]
}, Closed]],

Cell[CellGroupData[{

Cell["Chainorder", "Subsubsection",
 CellChangeTimes->{{3.8260125555951595`*^9, 
  3.826012557581846*^9}},ExpressionUUID->"6db576ff-b04f-4163-bddd-\
cba481e13f52"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "We", " ", "assume", " ", "everything", " ", "to", " ", "be", " ", 
    "already", " ", "paired", " ", "up", " ", "by", " ", "contracted", " ", 
    "angle", " ", 
    RowBox[{"brackets", ".", " ", "Further"}], " ", "connect", " ", "by", " ",
     "contracted", " ", "angles"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"chorder", " ", "/:", " ", 
     RowBox[{"List", "[", 
      RowBox[{"x1___", ",", 
       RowBox[{"chorder", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i1_", ",", "j1_"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i2_", ",", "j2_"}], "}"}]}], "}"}], ",", "y1___"}], 
        "]"}], ",", "x2___", ",", 
       RowBox[{"chorder", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i1_", ",", "j3_"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i4_", ",", "j4_"}], "}"}]}], "}"}], ",", "y2___"}], 
        "]"}], ",", "x3___"}], "]"}], ":=", 
     RowBox[{"List", "[", 
      RowBox[{"x1", ",", "x2", ",", "x3", ",", 
       RowBox[{"chorder", "[", 
        RowBox[{
         RowBox[{"Sequence", "@@", 
          RowBox[{"Reverse", "[", 
           RowBox[{"{", "y2", "}"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i1", ",", "j3"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i4", ",", "j4"}], "}"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i1", ",", "j1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i2", ",", "j2"}], "}"}]}], "}"}], ",", "y1"}], "]"}]}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"chorder", " ", "/:", " ", 
     RowBox[{"List", "[", 
      RowBox[{"x1___", ",", 
       RowBox[{"chorder", "[", 
        RowBox[{"y1___", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i1_", ",", "j1_"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i2_", ",", "j2_"}], "}"}]}], "}"}]}], "]"}], ",", 
       "x2___", ",", 
       RowBox[{"chorder", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i1_", ",", "j3_"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i4_", ",", "j4_"}], "}"}]}], "}"}], ",", "y2___"}], 
        "]"}], ",", "x3___"}], "]"}], ":=", 
     RowBox[{"List", "[", 
      RowBox[{"x1", ",", "x2", ",", "x3", ",", 
       RowBox[{"chorder", "[", 
        RowBox[{"y1", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i1", ",", "j1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i2", ",", "j2"}], "}"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i1", ",", "j3"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i4", ",", "j4"}], "}"}]}], "}"}], ",", "y2"}], "]"}]}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"chorder", " ", "/:", " ", 
     RowBox[{"List", "[", 
      RowBox[{"x1___", ",", 
       RowBox[{"chorder", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i1_", ",", "j3_"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i4_", ",", "j4_"}], "}"}]}], "}"}], ",", "y2___"}], 
        "]"}], ",", "x2___", ",", 
       RowBox[{"chorder", "[", 
        RowBox[{"y1___", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i1_", ",", "j1_"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i2_", ",", "j2_"}], "}"}]}], "}"}]}], "]"}], ",", 
       "x3___"}], "]"}], ":=", 
     RowBox[{"List", "[", 
      RowBox[{"x1", ",", "x2", ",", "x3", ",", 
       RowBox[{"chorder", "[", 
        RowBox[{"y1", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i1", ",", "j1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i2", ",", "j2"}], "}"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i1", ",", "j3"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i4", ",", "j4"}], "}"}]}], "}"}], ",", "y2"}], "]"}]}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"chorder", " ", "/:", " ", 
     RowBox[{"List", "[", 
      RowBox[{"x1___", ",", 
       RowBox[{"chorder", "[", 
        RowBox[{"y1___", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i1_", ",", "j1_"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i2_", ",", "j2_"}], "}"}]}], "}"}]}], "]"}], ",", 
       "x2___", ",", 
       RowBox[{"chorder", "[", 
        RowBox[{"y2___", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i1_", ",", "j3_"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i4_", ",", "j4_"}], "}"}]}], "}"}]}], "]"}], ",", 
       "x3___"}], "]"}], ":=", 
     RowBox[{"List", "[", 
      RowBox[{"x1", ",", "x2", ",", "x3", ",", 
       RowBox[{"chorder", "[", 
        RowBox[{"y1", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i1", ",", "j1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i2", ",", "j2"}], "}"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i1", ",", "j3"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i4", ",", "j4"}], "}"}]}], "}"}], ",", 
         RowBox[{"Sequence", "@@", 
          RowBox[{"Reverse", "[", 
           RowBox[{"{", "y2", "}"}], "]"}]}]}], "]"}]}], "]"}]}], 
    ";"}]}]}]], "Input",
 CellChangeTimes->{{3.8260070499276323`*^9, 3.826007167214939*^9}, {
   3.8260072010095673`*^9, 3.826007391987771*^9}, 3.8260129796303873`*^9},
 CellLabel->"In[13]:=",ExpressionUUID->"b20d61aa-bffa-4e54-a5ce-0d45e783fb38"]
}, Closed]],

Cell[CellGroupData[{

Cell["Chainbuilder", "Subsubsection",
 CellChangeTimes->{{3.8260125598777037`*^9, 3.826012562792856*^9}, {
  3.826023629186164*^9, 3.82602363001096*^9}, {3.826024373973124*^9, 
  3.8260243741955414`*^9}, {3.8260850236758184`*^9, 3.826085024590727*^9}, {
  3.826085771750812*^9, 
  3.826085772501088*^9}},ExpressionUUID->"389f2f1b-f595-41c6-8c49-\
a0d548200a66"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "The", " ", "uncontracted", " ", "brackets", " ", "need", " ", "to", " ", 
   "be", " ", "taken", " ", "care", " ", "of", " ", "prior", " ", "to", " ", 
   "the", " ", "use", " ", "of", " ", "this", " ", "function"}], 
  "*)"}]], "Input",
 CellChangeTimes->{{3.826085025948245*^9, 3.8260850474955254`*^9}},
 CellLabel->"In[17]:=",ExpressionUUID->"86836b67-a308-4ca6-b739-fe12925e4e75"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "This", " ", "\"\<function\>\"", " ", "converts", " ", "lists", " ", "of", 
   " ", "brackets", " ", "into", " ", "a", " ", 
   RowBox[{"chain", ".", " ", "Needs"}], " ", "to", " ", "be", " ", 
   "embedded", " ", "in", " ", "previous", " ", "code"}], "*)"}]], "Input",
 CellChangeTimes->{{3.826012565846687*^9, 3.826012605428874*^9}},
 CellLabel->"In[18]:=",ExpressionUUID->"a9b5b3bb-76f3-4876-9068-77702c5014a0"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "We", " ", "assume", " ", "traces", " ", "have", " ", "been", " ", 
   "converted", " ", "from", " ", "even", " ", "to", " ", "odd", " ", 
   "number", " ", "of", " ", "contractions"}], "*)"}]], "Input",
 CellChangeTimes->{{3.8260129539481306`*^9, 3.8260129736095467`*^9}},
 CellLabel->"In[19]:=",ExpressionUUID->"8102c319-dd47-4d51-a951-a3ffc7010920"],

Cell[BoxData[
 RowBox[{"Clear", "[", 
  RowBox[{"ChainBuilder", ",", "auxChainBuilder"}], "]"}]], "Input",
 CellChangeTimes->{{3.8260232383335066`*^9, 3.826023245855423*^9}},
 CellLabel->"In[20]:=",ExpressionUUID->"5c20034e-60a2-4d80-909b-d76a4998a005"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"Single", " ", 
    RowBox[{"chain", ".", " ", "I"}], " ", 
    RowBox[{"think", "/", "hope"}], " ", "that", " ", "the", " ", "use", " ", 
    "of", " ", "a", " ", "Length", " ", "test", " ", "intesad", " ", "of", 
    " ", "a", " ", "direct", " ", "pattern", " ", "matching", " ", "increses",
     " ", "speed"}], ",", " ", 
   RowBox[{
   "this", " ", "is", " ", "the", " ", "reason", " ", "why", " ", 
    "introduced", " ", "an", " ", "auxiliary", " ", "function"}]}], 
  "*)"}]], "Input",
 CellChangeTimes->{{3.8260182069100523`*^9, 3.826018212246825*^9}, {
  3.826018632840867*^9, 3.826018633518033*^9}, {3.826018892912298*^9, 
  3.826018926300989*^9}},
 CellLabel->"In[21]:=",ExpressionUUID->"d01313c0-ba3e-40c6-a1b2-876896d694aa"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ChainBuilder", "[", 
    RowBox[{"exp_List", ",", "ag_List", ",", "sq_List"}], "]"}], "/;", 
   RowBox[{
    RowBox[{"Length", "@", "exp"}], "===", "1"}]}], ":=", 
  RowBox[{"auxChainBuilder", "[", 
   RowBox[{"exp", ",", "ag", ",", "sq"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.826018635510704*^9, 3.826018708158472*^9}, {
  3.8260188131256943`*^9, 3.8260188488382072`*^9}, {3.8260190708753104`*^9, 
  3.826019085432239*^9}, {3.826019466312961*^9, 3.8260194699841948`*^9}, {
  3.8260850699631805`*^9, 3.826085074180394*^9}},
 CellLabel->"In[22]:=",ExpressionUUID->"f6985837-4691-46a1-a7b9-d7858e58299c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"auxChainBuilder", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"i1_", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"i2_", ",", "1"}], "}"}]}], "}"}], "}"}], ",", "ag_", ",", 
     "sq_"}], "]"}], ":=", 
   RowBox[{"-", 
    RowBox[{"Chain", "[", 
     RowBox[{"$angle", ",", 
      RowBox[{"Last", "@", 
       RowBox[{"ag", "[", 
        RowBox[{"[", "i1", "]"}], "]"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"First", "@", 
        RowBox[{"ag", "[", 
         RowBox[{"[", "i1", "]"}], "]"}]}], "}"}], ",", 
      RowBox[{"Last", "@", 
       RowBox[{"sq", "[", 
        RowBox[{"[", "i2", "]"}], "]"}]}], ",", "$square"}], "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"auxChainBuilder", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"i1_", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"i2_", ",", "2"}], "}"}]}], "}"}], "}"}], ",", "ag_", ",", 
     "sq_"}], "]"}], ":=", 
   RowBox[{"Chain", "[", 
    RowBox[{"$angle", ",", 
     RowBox[{"Last", "@", 
      RowBox[{"ag", "[", 
       RowBox[{"[", "i1", "]"}], "]"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"First", "@", 
       RowBox[{"ag", "[", 
        RowBox[{"[", "i1", "]"}], "]"}]}], "}"}], ",", 
     RowBox[{"First", "@", 
      RowBox[{"sq", "[", 
       RowBox[{"[", "i2", "]"}], "]"}]}], ",", "$square"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"auxChainBuilder", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"i1_", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"i2_", ",", "1"}], "}"}]}], "}"}], "}"}], ",", "ag_", ",", 
     "sq_"}], "]"}], ":=", 
   RowBox[{"Chain", "[", 
    RowBox[{"$angle", ",", 
     RowBox[{"First", "@", 
      RowBox[{"ag", "[", 
       RowBox[{"[", "i1", "]"}], "]"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"Last", "@", 
       RowBox[{"ag", "[", 
        RowBox[{"[", "i1", "]"}], "]"}]}], "}"}], ",", 
     RowBox[{"Last", "@", 
      RowBox[{"sq", "[", 
       RowBox[{"[", "i2", "]"}], "]"}]}], ",", "$square"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"auxChainBuilder", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"i1_", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"i2_", ",", "2"}], "}"}]}], "}"}], "}"}], ",", "ag_", ",", 
     "sq_"}], "]"}], ":=", 
   RowBox[{"-", 
    RowBox[{"Chain", "[", 
     RowBox[{"$angle", ",", 
      RowBox[{"First", "@", 
       RowBox[{"ag", "[", 
        RowBox[{"[", "i1", "]"}], "]"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"Last", "@", 
        RowBox[{"ag", "[", 
         RowBox[{"[", "i1", "]"}], "]"}]}], "}"}], ",", 
      RowBox[{"First", "@", 
       RowBox[{"sq", "[", 
        RowBox[{"[", "i2", "]"}], "]"}]}], ",", "$square"}], "]"}]}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.8260188509674816`*^9, 3.8260188868415856`*^9}, {
  3.8260189307590666`*^9, 3.826019028612403*^9}, {3.8260191014553823`*^9, 
  3.826019176964985*^9}, {3.8260192866326337`*^9, 3.826019375256654*^9}},
 CellLabel->"In[23]:=",ExpressionUUID->"e37699a3-dc61-4e41-86f4-ec1dbc96c439"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ChainBuilder", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"1", ",", "1"}], "}"}]}], "}"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "2"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"1", "3"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    TemplateBox[{"1", "4"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.8260194108045216`*^9, 3.8260194314153023`*^9}, {
  3.826023658031014*^9, 3.826023660562191*^9}, {3.826085766350062*^9, 
  3.8260857666706586`*^9}},
 CellLabel->"In[27]:=",ExpressionUUID->"33548b16-3ef6-468b-84e5-ae37775690bd"],

Cell[BoxData[
 RowBox[{"-", 
  TemplateBox[{"2", 
    RowBox[{"{", "1", "}"}], "4"},
   "AngleSquareChain",
   DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
   InterpretationFunction->(
    RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square", 
      "]"}]& )]}]], "Output",
 CellChangeTimes->{
  3.8260194327278223`*^9, 3.8260194736783133`*^9, 3.826023250730378*^9, {
   3.826023654176322*^9, 3.826023662300575*^9}, 3.8260241660961123`*^9, 
   3.8260852240798388`*^9, 3.826085875217265*^9},
 CellLabel->"Out[27]=",ExpressionUUID->"46cf24ca-af80-4921-96c9-8663feb5ded6"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"Even", " ", "angle", " ", "chains"}], "*)"}]], "Input",
 CellChangeTimes->{{3.8260169373704567`*^9, 3.826016947848482*^9}},
 CellLabel->"In[28]:=",ExpressionUUID->"ea32a8f8-5584-457f-8471-ad0ca559b73c"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ChainBuilder", "[", 
     RowBox[{"exp_List", ",", "ag_List", ",", "sq_List"}], "]"}], "/;", 
    RowBox[{
     RowBox[{"EvenQ", "@", 
      RowBox[{"Length", "@", "exp"}]}], "&&", 
     RowBox[{
      RowBox[{"exp", "[", 
       RowBox[{"[", 
        RowBox[{"1", ",", "2", ",", "1"}], "]"}], "]"}], "===", 
      RowBox[{"exp", "[", 
       RowBox[{"[", 
        RowBox[{"2", ",", "2", ",", "1"}], "]"}], "]"}]}]}]}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{"-", "1"}], ")"}], "^", 
     RowBox[{"Count", "[", 
      RowBox[{
       RowBox[{"Last", "/@", 
        RowBox[{"Total", "/@", "exp"}]}], ",", 
       RowBox[{"2", "|", "4"}], ",", "2"}], "]"}]}], "*", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"Chain", "[", 
        RowBox[{"$angle", ",", 
         RowBox[{"First", "@", "#"}], ",", 
         RowBox[{"Rest", "@", 
          RowBox[{"Most", "@", "#"}]}], ",", 
         RowBox[{"Last", "@", "#"}], ",", "$angle"}], "]"}], "&"}], "@", 
      RowBox[{"Flatten", "@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Last", "@", "#"}], "\[Equal]", "1"}], ",", 
                RowBox[{"Reverse", "@", 
                 RowBox[{"First", "@", "#"}]}], ",", 
                RowBox[{"First", "@", "#"}]}], "]"}], "&"}], "@", 
             RowBox[{"First", "@", "#"}]}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Last", "@", "#"}], "\[Equal]", "2"}], ",", 
                RowBox[{"Reverse", "@", 
                 RowBox[{"First", "@", "#"}]}], ",", 
                RowBox[{"First", "@", "#"}]}], "]"}], "&"}], "/@", 
             RowBox[{"Rest", "@", "#"}]}]}], "}"}], "&"}], "@", 
         RowBox[{"Transpose", "@", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Part", "[", 
                  RowBox[{
                   RowBox[{"List", "@@@", "ag"}], ",", "#"}], "]"}], "&"}], "/@",
                 "#1"}], ",", "#2"}], "}"}], "&"}], "@@", 
            RowBox[{"Transpose", "@", 
             RowBox[{"(", 
              RowBox[{"First", "/@", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Length", "@", "exp"}], ">", "2"}], ",", 
                 RowBox[{"Drop", "[", 
                  RowBox[{"exp", ",", 
                   RowBox[{"{", 
                    RowBox[{"3", ",", 
                    RowBox[{"Length", "[", "exp", "]"}], ",", "2"}], "}"}]}], 
                  "]"}], ",", "exp"}], "]"}]}], ")"}]}]}], ")"}]}]}], 
        ")"}]}]}], ")"}]}]}], ";"}]], "Input",
 CellChangeTimes->{{3.826016932154456*^9, 3.8260170078470078`*^9}, {
  3.826020628678008*^9, 3.8260207116339197`*^9}, {3.826020821819213*^9, 
  3.826020929865259*^9}, {3.826021309850788*^9, 3.826021381351551*^9}, {
  3.826023532817912*^9, 3.826023534340789*^9}, {3.8260240614111233`*^9, 
  3.8260240968463435`*^9}, {3.8260242769406075`*^9, 3.8260242800204268`*^9}, {
  3.8260245262617297`*^9, 3.82602452735382*^9}, {3.826024791651778*^9, 
  3.826024792033706*^9}, {3.8260256495477037`*^9, 3.826025652991495*^9}, {
  3.826085112281683*^9, 3.826085134046756*^9}},
 CellLabel->"In[29]:=",ExpressionUUID->"f26c2f80-6442-4caa-906f-0073e2b1c62f"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ChainBuilder", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"2", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "2"}], "}"}]}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "2"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"3", "4"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    TemplateBox[{"2", "3"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.8260231491361094`*^9, 3.826023172764867*^9}},
 CellLabel->"In[30]:=",ExpressionUUID->"ea1093db-6dd0-4300-9297-f3052becc4fd"],

Cell[BoxData[
 TemplateBox[{"1", 
   RowBox[{"{", 
     RowBox[{"2", ",", "3"}], "}"}], "4"},
  "AngleAngleChain",
  DisplayFunction->(
   RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
  InterpretationFunction->(
   RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle", 
     "]"}]& )]], "Output",
 CellChangeTimes->{
  3.826023174977999*^9, 3.826023261158498*^9, 3.826023536035254*^9, {
   3.826024100850621*^9, 3.82602411266005*^9}, 3.826024169360345*^9, 
   3.8260243240466533`*^9, 3.8260245301383524`*^9, 3.826024793585606*^9, 
   3.8260825677776613`*^9, 3.826085139866314*^9, 3.8260852242592783`*^9, 
   3.826085875335409*^9},
 CellLabel->"Out[30]=",ExpressionUUID->"97df4530-2386-4b00-a2e8-b4396f170a2d"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ChainBuilder", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"2", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "2"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"2", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"3", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2"}], "}"}]}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "2"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"3", "4"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"5", "6"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"2", "3"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"4", "5"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.8260244774223657`*^9, 3.8260245056089306`*^9}, {
  3.826024798927304*^9, 3.826024801302513*^9}, {3.8260857613697467`*^9, 
  3.8260857616668587`*^9}},
 CellLabel->"In[31]:=",ExpressionUUID->"08f7b210-53a8-468d-96e4-429a04fe5145"],

Cell[BoxData[
 TemplateBox[{"1", 
   RowBox[{"{", 
     RowBox[{"2", ",", "3", ",", "4", ",", "5"}], "}"}], "6"},
  "AngleAngleChain",
  DisplayFunction->(
   RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
  InterpretationFunction->(
   RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle", 
     "]"}]& )]], "Output",
 CellChangeTimes->{{3.8260245079526577`*^9, 3.8260245314168987`*^9}, {
   3.8260247944991093`*^9, 3.826024802616987*^9}, 3.82608257042558*^9, 
   3.826085146751342*^9, 3.826085225739122*^9, 3.82608587542272*^9},
 CellLabel->"Out[31]=",ExpressionUUID->"c5238256-fbef-494d-b694-df229e412286"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"Even", " ", "square", " ", "chains"}], "*)"}]], "Input",
 CellChangeTimes->{{3.8260169373704567`*^9, 3.826016947848482*^9}, {
   3.826017092506524*^9, 3.8260170932904243`*^9}, {3.8260175219838657`*^9, 
   3.826017565832575*^9}, 3.8260241863369937`*^9},
 CellLabel->"In[32]:=",ExpressionUUID->"f7c080eb-556c-4f2a-8d41-a6ba1d8f24c6"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ChainBuilder", "[", 
     RowBox[{"exp_List", ",", "ag_List", ",", "sq_List"}], "]"}], "/;", 
    RowBox[{
     RowBox[{"EvenQ", "@", 
      RowBox[{"Length", "@", "exp"}]}], "&&", 
     RowBox[{
      RowBox[{"exp", "[", 
       RowBox[{"[", 
        RowBox[{"1", ",", "2", ",", "1"}], "]"}], "]"}], "\[NotEqual]", 
      RowBox[{"exp", "[", 
       RowBox[{"[", 
        RowBox[{"2", ",", "2", ",", "1"}], "]"}], "]"}]}]}]}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{"-", "1"}], ")"}], "^", 
     RowBox[{"Count", "[", 
      RowBox[{
       RowBox[{"Last", "/@", 
        RowBox[{"Total", "/@", "exp"}]}], ",", 
       RowBox[{"2", "|", "4"}], ",", "2"}], "]"}]}], "*", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"Chain", "[", 
        RowBox[{"$square", ",", 
         RowBox[{"First", "@", "#"}], ",", 
         RowBox[{"Rest", "@", 
          RowBox[{"Most", "@", "#"}]}], ",", 
         RowBox[{"Last", "@", "#"}], ",", "$square"}], "]"}], "&"}], "@", 
      RowBox[{"Flatten", "@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Last", "@", "#"}], "\[Equal]", "1"}], ",", 
                RowBox[{"Reverse", "@", 
                 RowBox[{"First", "@", "#"}]}], ",", 
                RowBox[{"First", "@", "#"}]}], "]"}], "&"}], "@", 
             RowBox[{"First", "@", "#"}]}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Last", "@", "#"}], "\[Equal]", "2"}], ",", 
                RowBox[{"Reverse", "@", 
                 RowBox[{"First", "@", "#"}]}], ",", 
                RowBox[{"First", "@", "#"}]}], "]"}], "&"}], "/@", 
             RowBox[{"Rest", "@", "#"}]}]}], "}"}], "&"}], "@", 
         RowBox[{"Transpose", "@", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Part", "[", 
                  RowBox[{
                   RowBox[{"List", "@@@", "sq"}], ",", "#"}], "]"}], "&"}], "/@",
                 "#1"}], ",", "#2"}], "}"}], "&"}], "@@", 
            RowBox[{"Transpose", "@", 
             RowBox[{"(", 
              RowBox[{"Last", "/@", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Length", "@", "exp"}], ">", "2"}], ",", 
                 RowBox[{"Drop", "[", 
                  RowBox[{"exp", ",", 
                   RowBox[{"{", 
                    RowBox[{"3", ",", 
                    RowBox[{"Length", "[", "exp", "]"}], ",", "2"}], "}"}]}], 
                  "]"}], ",", "exp"}], "]"}]}], ")"}]}]}], ")"}]}]}], 
        ")"}]}]}], ")"}]}]}], ";"}]], "Input",
 CellChangeTimes->{{3.826016932154456*^9, 3.8260170078470078`*^9}, {
   3.8260171094831157`*^9, 3.826017122447441*^9}, 3.8260171734839916`*^9, {
   3.826017338304161*^9, 3.826017341530475*^9}, {3.8260175705319853`*^9, 
   3.8260175778994865`*^9}, {3.8260176834531775`*^9, 3.826017684590139*^9}, {
   3.8260179019727182`*^9, 3.8260179135257654`*^9}, {3.8260181116199913`*^9, 
   3.8260181725170794`*^9}, {3.8260207312683816`*^9, 
   3.8260207383773813`*^9}, {3.826020916675541*^9, 3.8260209345317783`*^9}, 
   3.826021397771637*^9, {3.82602143577693*^9, 3.826021436022274*^9}, {
   3.8260241443413153`*^9, 3.826024154953878*^9}, {3.8260242008272276`*^9, 
   3.826024213551198*^9}, {3.826085162504323*^9, 3.8260851754192305`*^9}},
 CellLabel->"In[33]:=",ExpressionUUID->"9a777c49-bb9e-4b73-9154-eb84ed9f84b4"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ChainBuilder", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"3", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"3", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "2"}], "}"}]}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "2"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"5", "6"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"3", "4"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "4"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"2", "3"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"2", "4"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{
  3.826017155247757*^9, {3.826017185601581*^9, 3.826017188490857*^9}, {
   3.8260240331466646`*^9, 3.8260240404262486`*^9}, {3.826085757564052*^9, 
   3.8260857578658667`*^9}},
 CellLabel->"In[34]:=",ExpressionUUID->"10a5ddda-cf15-41ad-877b-2dc5ee871088"],

Cell[BoxData[
 TemplateBox[{"4", 
   RowBox[{"{", 
     RowBox[{"1", ",", "2", ",", "3", ",", "4"}], "}"}], "2"},
  "SquareSquareChain",
  DisplayFunction->(RowBox[{"[", #, #2, #3, "]"}]& ),
  InterpretationFunction->(
   RowBox[{"Chain", "[", "$square", ",", #, ",", #2, ",", #3, ",", "$square", 
     "]"}]& )]], "Output",
 CellChangeTimes->{{3.8260171762186613`*^9, 3.826017189273761*^9}, 
   3.8260173433326936`*^9, 3.826017579047406*^9, 3.826017686536911*^9, {
   3.8260179041399117`*^9, 3.826017915512488*^9}, {3.8260181650908985`*^9, 
   3.8260181740160675`*^9}, 3.8260214014487777`*^9, 3.826021437652953*^9, {
   3.8260240303272443`*^9, 3.8260240418384523`*^9}, 3.826082594418425*^9, 
   3.826085179741973*^9, 3.826085227411187*^9, 3.826085875541876*^9},
 CellLabel->"Out[34]=",ExpressionUUID->"82683ab9-e576-462c-9083-c9c529563537"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"Odd", " ", "length", " ", 
   RowBox[{"chains", ".", " ", "Just"}], " ", "like", " ", "in", " ", "the", 
   " ", "even", " ", "case", " ", "with", " ", "an", " ", "addition", " ", 
   "of", " ", "a", " ", "final", " ", "bracket"}], "*)"}]], "Input",
 CellChangeTimes->{{3.82602142830996*^9, 3.826021462332954*^9}, {
  3.826021520748663*^9, 3.8260215261462283`*^9}, {3.8260215813476377`*^9, 
  3.826021586155781*^9}},
 CellLabel->"In[35]:=",ExpressionUUID->"6e2fe73b-541c-4a01-88ce-aa76d1143c67"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ChainBuilder", "[", 
     RowBox[{"exp_List", ",", "ag_List", ",", "sq_List"}], "]"}], "/;", 
    RowBox[{"OddQ", "@", 
     RowBox[{"Length", "@", "exp"}]}]}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{"-", "1"}], ")"}], "^", 
     RowBox[{"Count", "[", 
      RowBox[{
       RowBox[{"Last", "/@", 
        RowBox[{"Total", "/@", "exp"}]}], ",", 
       RowBox[{"2", "|", "4"}], ",", "2"}], "]"}]}], "*", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"Chain", "[", 
        RowBox[{"$angle", ",", 
         RowBox[{"First", "@", "#"}], ",", 
         RowBox[{"Rest", "@", "#"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Last", "@", "#"}], "\[Equal]", "1"}], ",", 
             RowBox[{"sq", "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"First", "@", "#"}], ",", "2"}], "]"}], "]"}], ",", 
             RowBox[{"sq", "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"First", "@", "#"}], ",", "1"}], "]"}], "]"}]}], 
            "]"}], "&"}], "@", 
          RowBox[{"Last", "@", 
           RowBox[{"Last", "@", "exp"}]}]}], ",", "$square"}], "]"}], "&"}], 
      "@", 
      RowBox[{"Flatten", "@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Last", "@", "#"}], "\[Equal]", "1"}], ",", 
                RowBox[{"Reverse", "@", 
                 RowBox[{"First", "@", "#"}]}], ",", 
                RowBox[{"First", "@", "#"}]}], "]"}], "&"}], "@", 
             RowBox[{"First", "@", "#"}]}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Last", "@", "#"}], "\[Equal]", "2"}], ",", 
                RowBox[{"Reverse", "@", 
                 RowBox[{"First", "@", "#"}]}], ",", 
                RowBox[{"First", "@", "#"}]}], "]"}], "&"}], "/@", 
             RowBox[{"Rest", "@", "#"}]}]}], "}"}], "&"}], "@", 
         RowBox[{"Transpose", "@", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Part", "[", 
                  RowBox[{
                   RowBox[{"List", "@@@", "ag"}], ",", "#"}], "]"}], "&"}], "/@",
                 "#1"}], ",", "#2"}], "}"}], "&"}], "@@", 
            RowBox[{"Transpose", "@", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"First", "/@", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Length", "@", "#"}], ">", "2"}], ",", 
                   RowBox[{"Drop", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"{", 
                    RowBox[{"3", ",", 
                    RowBox[{"Length", "[", "#", "]"}], ",", "2"}], "}"}]}], 
                    "]"}], ",", "#"}], "]"}]}], "&"}], "@", 
               RowBox[{"Most", "@", "exp"}]}], ")"}]}]}], ")"}]}]}], 
        ")"}]}]}], ")"}]}]}], ";"}]], "Input",
 CellChangeTimes->{{3.8260216087393756`*^9, 3.8260216105345163`*^9}, {
   3.8260216411018143`*^9, 3.826021649320826*^9}, {3.8260216882796326`*^9, 
   3.8260216885588737`*^9}, {3.82602205078306*^9, 3.826022119532297*^9}, {
   3.8260222129414186`*^9, 3.826022223157128*^9}, {3.826022259557787*^9, 
   3.826022261758092*^9}, {3.8260225340882826`*^9, 3.8260225358386135`*^9}, 
   3.8260246230875807`*^9, {3.8260246567595153`*^9, 3.8260246693478823`*^9}, {
   3.826024779659837*^9, 3.8260247799041996`*^9}, {3.826025678964079*^9, 
   3.826025680505955*^9}, 3.826025739216875*^9, {3.826085190536023*^9, 
   3.826085203176607*^9}},
 CellLabel->"In[36]:=",ExpressionUUID->"2a5ea438-e277-4380-9ad5-cffa156aecd0"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ChainBuilder", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"3", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}]}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "2"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"5", "6"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"3", "4"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     TemplateBox[{"1", "4"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"2", "3"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], ",", 
     TemplateBox[{"2", "4"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.8260248092981386`*^9, 3.8260248108978643`*^9}, {
  3.8260857541259575`*^9, 3.8260857551680083`*^9}},
 CellLabel->"In[37]:=",ExpressionUUID->"e809fbc0-8b7f-49ba-8047-1c1efb1d9247"],

Cell[BoxData[
 RowBox[{"-", 
  TemplateBox[{"4", 
    RowBox[{"{", 
      RowBox[{"3", ",", "2", ",", "1"}], "}"}], "4"},
   "AngleSquareChain",
   DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
   InterpretationFunction->(
    RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square", 
      "]"}]& )]}]], "Output",
 CellChangeTimes->{
  3.8260246954320745`*^9, 3.8260247812555647`*^9, 3.8260248122093306`*^9, 
   3.826082601741823*^9, {3.8260852102022343`*^9, 3.826085228969079*^9}, 
   3.8260858756681437`*^9},
 CellLabel->"Out[37]=",ExpressionUUID->"c297dc66-541a-4679-a9d3-abb23180bc3c"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["AllChains removing redundant powers", "Subsubsection",
 CellChangeTimes->{{3.826085709190898*^9, 3.826085711832183*^9}, {
  3.8261026447546415`*^9, 
  3.826102652145831*^9}},ExpressionUUID->"1f6cb8f8-7d91-4b06-b110-\
65753d5924a6"],

Cell[BoxData[{
 RowBox[{"Clear", "[", "AllChains", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"AllChains", "[", "exp_List", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "ag", ",", "sq", ",", "ch", ",", "connections", ",", "momenta", ",", 
      "candidatecontractions", ",", "chains", ",", "pp", ",", "unique", ",", 
      "sign", ",", "localbrackets", ",", "labs", ",", "removed"}], "}"}], ",",
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{
      "Gather", " ", "by", " ", "angle", " ", "and", " ", "square", " ", 
       "head"}], ",", " ", 
      RowBox[{
      "chains", " ", "are", " ", "converted", " ", "into", " ", "angles", " ",
        "and", " ", "squares", " ", "and", " ", "in", " ", "case", " ", 
       "mixed", " ", "chains", " ", "are", " ", "found", " ", "an", " ", 
       "appropriate", " ", "connection", " ", "is", " ", 
       RowBox[{"added", ".", " ", "We"}], " ", "take", " ", "care", " ", "of",
        " ", "chains", " ", "later", " ", "on"}]}], "*)"}], 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{
      "Angle", " ", "and", " ", "square", " ", "chains", " ", "are", " ", 
       "no", " ", "problem"}], ",", " ", 
      RowBox[{
      "the", " ", "only", " ", "troublesome", " ", "are", " ", "the", " ", 
       "mixed", " ", "chains"}], ",", " ", 
      RowBox[{"these", " ", "are", " ", "kept", " ", "separate"}]}], "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", "Chain", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"Chain", "[", 
          RowBox[{"$angle", ",", "x_", ",", "y_", ",", "z_", ",", "$angle"}], 
          "]"}], ":=", 
         RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{"x", ",", "y", ",", "z"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Chain", "[", 
          RowBox[{
          "$square", ",", "x_", ",", "y_", ",", "z_", ",", "$square"}], "]"}],
          ":=", 
         RowBox[{"SpinorSquareBracket", "[", 
          RowBox[{"x", ",", "y", ",", "z"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"ag", ",", "sq", ",", "ch"}], "}"}], "=", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Flatten", "[", 
              RowBox[{"#", ",", "1"}], "]"}], "&"}], "/@", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Select", "[", 
               RowBox[{"#", ",", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Head", "@", 
                    RowBox[{"First", "@", "#"}]}], "===", 
                   "SpinorAngleBracket"}], "&"}], ")"}]}], "]"}], ",", 
              RowBox[{"Select", "[", 
               RowBox[{"#", ",", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Head", "@", 
                    RowBox[{"First", "@", "#"}]}], "===", 
                   "SpinorSquareBracket"}], "&"}], ")"}]}], "]"}], ",", 
              RowBox[{"Select", "[", 
               RowBox[{"#", ",", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Head", "@", 
                    RowBox[{"First", "@", "#"}]}], "===", "Chain"}], "&"}], 
                 ")"}]}], "]"}]}], "}"}]}], "&"}], "@", 
          RowBox[{"GatherBy", "[", 
           RowBox[{"exp", ",", "Head"}], "]"}]}]}], ";"}]}], 
      "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
       "In", " ", "order", " ", "to", " ", "take", " ", "care", " ", "of", 
        " ", "mixed", " ", "chains", " ", "in", " ", "a", " ", "simple", " ", 
        "way", " ", "we", " ", "decompose", " ", "them", " ", "into", " ", 
        "an", " ", "angle", " ", "and", " ", "square", " ", "bracket", " ", 
        "and", " ", "add", " ", "a", " ", "fixed", " ", "connection", " ", 
        "to", " ", "the", " ", "list", " ", "of", " ", "connections"}], ",", 
       " ", 
       RowBox[{"the", " ", "rest", " ", "follows", " ", "automatically"}]}], 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"sign", "=", "1"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Do", "[", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Decomposition", " ", "into", " ", "angle", " ", "and", " ", "square",
          " ", "is", " ", "done", " ", "by", " ", "introducing", " ", "a", 
         " ", "unique", " ", "label", " ", "fro", " ", "each", " ", "chain"}],
         ",", " ", 
        RowBox[{
        "so", " ", "that", " ", "later", " ", "on", " ", "when", " ", 
         "contractions", " ", "are", " ", "performed", " ", "there", " ", 
         "will", " ", "be", " ", "exactly", " ", "for", " ", "each", " ", 
         "of", " ", 
         RowBox[{"these", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"ag", "=", 
         RowBox[{"Join", "[", 
          RowBox[{"ag", ",", 
           RowBox[{"{", 
            RowBox[{"SpinorAngleBracket", "[", 
             RowBox[{
              RowBox[{"i", "[", 
               RowBox[{"[", "2", "]"}], "]"}], ",", 
              RowBox[{"Most", "@", 
               RowBox[{"i", "[", 
                RowBox[{"[", "3", "]"}], "]"}]}], ",", 
              RowBox[{"unique", "=", 
               RowBox[{"pp", "[", 
                RowBox[{
                 RowBox[{"Last", "@", 
                  RowBox[{"i", "[", 
                   RowBox[{"[", "3", "]"}], "]"}]}], ",", 
                 RowBox[{"Unique", "[", "]"}]}], "]"}]}]}], "]"}], "}"}]}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"OrderedQ", "[", 
           RowBox[{"{", 
            RowBox[{"unique", ",", 
             RowBox[{"i", "[", 
              RowBox[{"[", "4", "]"}], "]"}]}], "}"}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"sq", "=", 
            RowBox[{"Join", "[", 
             RowBox[{"sq", ",", 
              RowBox[{"{", 
               RowBox[{"SpinorSquareBracket", "[", 
                RowBox[{"unique", ",", 
                 RowBox[{"i", "[", 
                  RowBox[{"[", "4", "]"}], "]"}]}], "]"}], "}"}]}], "]"}]}], 
           ";"}], "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
           "Sign", " ", "keeps", " ", "track", " ", "of", " ", "signs", " ", 
            "since", " ", "the", " ", "arguments", " ", "of", " ", "the", " ",
             "brackets", " ", "need", " ", "to", " ", "be", " ", "correctly", 
            " ", "ordered", " ", 
            RowBox[{"(", 
             RowBox[{
             "this", " ", "was", " ", "an", " ", "initial", " ", "assumption",
               " ", "on", " ", "the", " ", "input", " ", "list", " ", "so", 
              " ", "it", " ", "must", " ", "be", " ", "mantained"}], ")"}]}], 
           "*)"}], "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"sign", "=", 
            RowBox[{
             RowBox[{"-", "1"}], "*", "sign"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"sq", "=", 
            RowBox[{"Join", "[", 
             RowBox[{"sq", ",", 
              RowBox[{"{", 
               RowBox[{"SpinorSquareBracket", "[", 
                RowBox[{
                 RowBox[{"i", "[", 
                  RowBox[{"[", "4", "]"}], "]"}], ",", "unique"}], "]"}], 
               "}"}]}], "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";"}],
        "\[IndentingNewLine]", ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "ch"}], "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Remove", " ", "some", " ", "redundancy", " ", "by", " ", "removing", 
       " ", "unnecessary", " ", "powers"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"SpinorAngleBracket", ",", "SpinorSquareBracket"}], "}"}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"SpinorSquareBracket", "[", 
          RowBox[{"x_", ",", "y_", ",", "z_"}], "]"}], ":=", 
         RowBox[{"SpinorSquareBracket", "[", 
          RowBox[{"x", ",", "z"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{"x_", ",", "y_", ",", "z_"}], "]"}], ":=", 
         RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{"x", ",", "z"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"removed", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "@", "#"}], ">", "0"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"localbrackets", "=", "sq"}], ";", "\[IndentingNewLine]", 
             RowBox[{"Do", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"labs", "=", 
                 RowBox[{"Alternatives", "@@", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"First", "@", "#"}], ",", 
                    RowBox[{"Last", "@", "#"}]}], "}"}], "&"}], "@", 
                    RowBox[{"First", "@", "i"}]}], ")"}]}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{"#", ">", "0"}], ",", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"ag", "=", 
                    RowBox[{"DeleteCases", "[", 
                    RowBox[{"ag", ",", 
                    RowBox[{"First", "@", "i"}], ",", "1", ",", "#"}], 
                    "]"}]}], ";", 
                    RowBox[{"removed", "=", 
                    RowBox[{"Join", "[", 
                    RowBox[{"removed", ",", 
                    RowBox[{"ConstantArray", "[", 
                    RowBox[{
                    RowBox[{"First", "@", "i"}], ",", "#"}], "]"}]}], "]"}]}],
                     ";"}]}], "]"}], "&"}], "@", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"Length", "@", "i"}], "-", 
                   RowBox[{"Count", "[", 
                    RowBox[{"localbrackets", ",", "labs", ",", "2"}], "]"}]}],
                   ")"}]}], ";"}], "\[IndentingNewLine]", ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "#"}], "}"}]}], "]"}], ";"}]}], 
           "\[IndentingNewLine]", "]"}], "&"}], "@", 
         RowBox[{"Select", "[", 
          RowBox[{
           RowBox[{"Gather", "[", "ag", "]"}], ",", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "@", "#"}], ">", "1"}], "&"}], ")"}]}], 
          "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "@", "#"}], ">", "0"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"localbrackets", "=", "ag"}], ";", "\[IndentingNewLine]", 
             RowBox[{"Do", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"labs", "=", 
                 RowBox[{"Alternatives", "@@", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"First", "@", "#"}], ",", 
                    RowBox[{"Last", "@", "#"}]}], "}"}], "&"}], "@", 
                    RowBox[{"First", "@", "i"}]}], ")"}]}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{"#", ">", "0"}], ",", 
                    RowBox[{
                    RowBox[{"sq", "=", 
                    RowBox[{"DeleteCases", "[", 
                    RowBox[{"sq", ",", 
                    RowBox[{"First", "@", "i"}], ",", "1", ",", "#"}], 
                    "]"}]}], ";", 
                    RowBox[{"removed", "=", 
                    RowBox[{"Join", "[", 
                    RowBox[{"removed", ",", 
                    RowBox[{"ConstantArray", "[", 
                    RowBox[{
                    RowBox[{"First", "@", "i"}], ",", "#"}], "]"}]}], "]"}]}],
                     ";"}]}], "]"}], "&"}], "@", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"Length", "@", "i"}], "-", 
                   RowBox[{"Count", "[", 
                    RowBox[{"localbrackets", ",", "labs", ",", "2"}], "]"}]}],
                   ")"}]}], ";"}], "\[IndentingNewLine]", ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "#"}], "}"}]}], "]"}], ";"}]}], 
           "\[IndentingNewLine]", "]"}], "&"}], "@", 
         RowBox[{"Select", "[", 
          RowBox[{
           RowBox[{"Gather", "[", "sq", "]"}], ",", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "@", "#"}], ">", "1"}], "&"}], ")"}]}], 
          "]"}]}], ";"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Find", " ", "the", " ", "momenta", " ", "and", " ", "their", " ", 
       "number"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"SpinorAngleBracket", ",", "SpinorSquareBracket"}], "}"}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"SpinorSquareBracket", "[", 
          RowBox[{"x_", ",", "y_", ",", "z_"}], "]"}], ":=", 
         RowBox[{"SpinorSquareBracket", "[", 
          RowBox[{"x", ",", "z"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{"x_", ",", "y_", ",", "z_"}], "]"}], ":=", 
         RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{"x", ",", "z"}], "]"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
          "These", " ", "are", " ", "the", " ", "momenta", " ", "and", " ", 
           "their", " ", 
           RowBox[{"multiplicities", ".", " ", "They"}], " ", "are", " ", 
           "found", " ", "by", " ", "extracting", " ", "all", " ", "the", " ",
            "labels", " ", "from", " ", "the", " ", "brackest"}], ",", " ", 
          RowBox[{
          "then", " ", "counting", " ", "the", " ", "labels", " ", "and", " ",
            "looking", " ", "at", " ", "those", " ", "which", " ", "appear", 
           " ", "both", " ", "as", " ", "angle", " ", "and", " ", 
           RowBox[{"squares", ".", " ", "Then"}], " ", "we", " ", "take", " ",
            "the", " ", "minimum", " ", "between", " ", "the", " ", "angle", 
           " ", "and", " ", "square", " ", "appearences"}], ",", " ", 
          RowBox[{
          "the", " ", "mismatch", " ", "gives", " ", "the", " ", "helicity", 
           " ", "weight", " ", "which", " ", "we", " ", "do", " ", "not", " ",
            "need", " ", "right", " ", "now"}], ",", " ", 
          RowBox[{
          "the", " ", "rest", " ", "is", " ", "the", " ", "number", " ", "of",
            " ", "momenta", " ", "which", " ", "can", " ", "be", " ", 
           RowBox[{"formed", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", 
            RowBox[{"momenta", "=", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Select", "[", 
                  RowBox[{"#", ",", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "@", 
                    RowBox[{"First", "@", "#"}]}], "\[Equal]", "2"}], "&"}], 
                    ")"}]}], "]"}], "&"}], "@", 
                RowBox[{"GatherBy", "[", 
                 RowBox[{"#", ",", "Length"}], "]"}]}], "&"}], "@", 
              RowBox[{"GatherBy", "[", 
               RowBox[{
                RowBox[{"Join", "@@", 
                 RowBox[{"Tally", "/@", 
                  RowBox[{"Flatten", "/@", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"List", "@@@", "ag"}], ",", 
                    RowBox[{"List", "@@@", "sq"}]}], "}"}]}]}]}], ",", 
                "First"}], "]"}]}]}], "]"}], ">", "0"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"momenta", "=", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"First", "@", "#1"}], ",", 
                RowBox[{"Min", "@", "#2"}]}], "}"}], "&"}], "@@@", 
             RowBox[{"Transpose", "/@", 
              RowBox[{"First", "@", "momenta"}]}]}]}], ";"}], 
          "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{
             RowBox[{"If", " ", "momenta", " ", "has", " ", "length"}], "=", 
             RowBox[{
             "0", " ", "no", " ", "momenta", " ", "are", " ", "presents"}]}], 
            ",", " ", 
            RowBox[{
            "no", " ", "contractions", " ", "can", " ", "be", " ", "made", 
             " ", "and", " ", "we", " ", "return", " ", "the", " ", "input", 
             " ", "list", " ", "as", " ", "it", " ", "is"}]}], "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Return", "[", "exp", "]"}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Extract", " ", "the", " ", "positions", " ", "of", " ", "the", " ", 
          "brackets", " ", "containg", " ", "each", " ", "momentum", " ", 
          "and", " ", "then", " ", "pair", " ", "them"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"candidatecontractions", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"#", ",", "1"}], "]"}], "&"}], "/@", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"Outer", "[", 
              RowBox[{"List", ",", "#1", ",", "#2", ",", "1"}], "]"}], "&"}], 
            "@@@", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Position", "[", 
                  RowBox[{"ag", ",", "#"}], "]"}], ",", 
                 RowBox[{"Position", "[", 
                  RowBox[{"sq", ",", "#"}], "]"}]}], "}"}], "&"}], "/@", 
              RowBox[{"First", "@", 
               RowBox[{"Transpose", "@", "momenta"}]}]}], ")"}]}], ")"}]}]}], 
        ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Out", " ", "of", " ", "the", " ", "candidatecontractions", " ", "I",
           " ", "have", " ", "to", " ", "select", " ", "subsets", " ", "with",
           " ", "number", " ", "of", " ", "elements", " ", "given", " ", "by",
           " ", "the", " ", "multiplicity", " ", "of", " ", "the", " ", 
          "given", " ", "momentum", " ", "and", " ", "then", " ", "apply", 
          " ", "a", " ", "feasibility", " ", 
          RowBox[{"check", ":", " ", 
           RowBox[{
           "every", " ", "bracket", " ", "can", " ", "only", " ", "appear", 
            " ", "once", " ", "per", " ", 
            RowBox[{"momentum", "."}]}]}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"chains", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Subsets", "[", 
            RowBox[{"#1", ",", 
             RowBox[{"{", "#2", "}"}]}], "]"}], "&"}], "@@@", 
          RowBox[{"Transpose", "@", 
           RowBox[{"{", 
            RowBox[{"candidatecontractions", ",", 
             RowBox[{"Last", "@", 
              RowBox[{"Transpose", "@", "momenta"}]}]}], "}"}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"Apply", " ", 
          RowBox[{"check", ":"}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"chains", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"DeleteCases", "[", 
            RowBox[{"#", ",", 
             RowBox[{"_", "?", "feasibilitytest"}]}], "]"}], "&"}], "/@", 
          "chains"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Out", " ", "of", " ", "these", " ", "we", " ", "need", " ", "to", 
          " ", "take", " ", "all", " ", "possible", " ", 
          RowBox[{"combinations", "."}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"chains", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"#", ",", "1"}], "]"}], "&"}], "/@", 
          RowBox[{"Tuples", "@", "chains"}]}]}], ";"}]}], 
      "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Reoreder", " ", "list", " ", "such", " ", "that", " ", "the", " ", 
       "structure", " ", "of", " ", "contracted", " ", "chains", " ", "is", 
       " ", "visible"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"chains", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Apply", "[", 
         RowBox[{"chorder", ",", 
          RowBox[{
           RowBox[{
            RowBox[{"GatherBy", "[", 
             RowBox[{"#", ",", 
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", 
                 RowBox[{"2", ",", "1"}], "]"}], "]"}], "&"}]}], "]"}], "&"}],
            "/@", "chains"}], ",", 
          RowBox[{"{", "2", "}"}]}], "]"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"Flatten", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"Part", "[", 
                    RowBox[{"ag", ",", "#"}], "]"}], "&"}], "/@", "#1"}], ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Part", "[", 
                    RowBox[{"sq", ",", "#"}], "]"}], "&"}], "/@", "#2"}], ",",
                   "removed", ",", "sign"}], "}"}], "&"}], "@@", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Complement", "[", 
                  RowBox[{
                   RowBox[{"Range", "@", 
                    RowBox[{"Length", "@", "ag"}]}], ",", "#1"}], "]"}], ",", 
                 RowBox[{"Complement", "[", 
                  RowBox[{
                   RowBox[{"Range", "@", 
                    RowBox[{"Length", "@", "sq"}]}], ",", "#2"}], "]"}]}], 
                "}"}]}], "&"}], "@@", 
             RowBox[{"Map", "[", 
              RowBox[{"First", ",", 
               RowBox[{"Transpose", "@", "#"}], ",", 
               RowBox[{"{", "2", "}"}]}], "]"}]}], ")"}]}], "&"}], "/@", 
         "chains"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Next", " ", "convert", " ", "to", " ", "chains", " ", "the", " ", 
       "single", " ", "parts"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", "chorder", "}"}], ",", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Next", " ", "we", " ", "transformtraces", " ", "from", " ", "even", 
         " ", "to", " ", "odd", " ", "chains", " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
           "so", " ", "far", " ", "we", " ", "counted", " ", "the", " ", 
            "number", " ", "of", " ", "momenta"}], ",", " ", 
           RowBox[{
           "now", " ", "we", " ", "count", " ", "the", " ", "number", " ", 
            "of", " ", "connections"}]}], ")"}]}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"chorder", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"i1_", ",", "j1_"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"i2_", ",", "j2_"}], "}"}]}], "}"}], ",", "x__", ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"i1_", ",", "_"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"_", ",", "_"}], "}"}]}], "}"}]}], "]"}], ":=", 
         RowBox[{"chorder", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"i1", ",", "j1"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"i2", ",", "j2"}], "}"}]}], "}"}], ",", "x"}], "]"}]}], 
        ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"Build", " ", "the", " ", "chains"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"chorder", "[", "x__", "]"}], ":=", 
         RowBox[{"ChainBuilder", "[", 
          RowBox[{
           RowBox[{"{", "x", "}"}], ",", "ag", ",", "sq"}], "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Reconvert", " ", "unique", " ", "labels", " ", "for", " ", "mixed", 
          " ", "chains", " ", "into", " ", "original", " ", "labels"}], 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"pp", "[", 
          RowBox[{"x_", ",", "_"}], "]"}], ":=", "x"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"Flatten", "/@", 
         RowBox[{"Transpose", "@", "chains"}]}]}]}], "\[IndentingNewLine]", 
      "]"}]}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.8260854674909954`*^9, 3.8260855958631334`*^9}, {
   3.8260867239123306`*^9, 3.8260867660992393`*^9}, {3.8260900432791076`*^9, 
   3.826090173559472*^9}, {3.826090240306055*^9, 3.826090244258606*^9}, {
   3.82610078477164*^9, 3.8261008028586044`*^9}, {3.8261008528526154`*^9, 
   3.826100902939107*^9}, {3.8261009509105825`*^9, 3.8261009534506807`*^9}, {
   3.826101030388116*^9, 3.826101032729392*^9}, 3.8261010688950624`*^9, {
   3.8261015675590625`*^9, 3.8261016883010893`*^9}, {3.826101731816729*^9, 
   3.8261018427729473`*^9}, {3.826101874955703*^9, 3.8261018825972643`*^9}, {
   3.8261019128260098`*^9, 3.826101942453815*^9}, {3.8261020105541677`*^9, 
   3.8261020789262924`*^9}, {3.8261021323723035`*^9, 3.826102310444787*^9}, {
   3.826102455970565*^9, 3.826102532243575*^9}},
 CellLabel->
  "In[199]:=",ExpressionUUID->"6d169553-0836-410e-b653-50fd7ad936e1"]
}, Closed]],

Cell[CellGroupData[{

Cell["ToChainNew", "Subsubsection",
 CellChangeTimes->{{3.82610267776036*^9, 
  3.826102679963483*^9}},ExpressionUUID->"fe49037d-12c7-4d49-8b18-\
74ead97e9394"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"Options", "[", "ToChainNew", "]"}], "=", 
  RowBox[{"{", 
   RowBox[{"ChainSelection", "->", "\"\<ShortestChain\>\""}], 
   "}"}]}]], "Input",
 CellChangeTimes->{{3.8255094588937373`*^9, 3.825509492088255*^9}, 
   3.8255095261173553`*^9},
 CellLabel->
  "In[112]:=",ExpressionUUID->"37665017-8f19-4145-9792-28d8f6df429f"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"ChainSelection", "\[Rule]", "\<\"ShortestChain\"\>"}], 
  "}"}]], "Output",
 CellChangeTimes->{3.825509575870757*^9, 3.8260906286488495`*^9},
 CellLabel->
  "Out[112]=",ExpressionUUID->"8ebb10da-663c-4f44-8232-a43b0f74d557"]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"ToChainNew", "[", 
   RowBox[{"exp_", ",", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "locexp", ",", "tochain", ",", "tochaininv", ",", "chainCrit", ",", 
      "chainselect"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"locexp", "=", "exp"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"Power", ",", "Times"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"f_", "[", "x__", "]"}], ",", 
            RowBox[{"p_", "?", "Negative"}]}], "]"}], "/;", 
          RowBox[{
           RowBox[{"f", "\[Equal]", "SpinorAngleBracket"}], "||", 
           RowBox[{"f", "\[Equal]", "SpinorSquareBracket"}], "||", 
           RowBox[{"f", "\[Equal]", "Chain"}]}]}], ":=", 
         RowBox[{"tochaininv", "[", 
          RowBox[{"Sequence", "@@", 
           RowBox[{"ConstantArray", "[", 
            RowBox[{
             RowBox[{"f", "[", "x", "]"}], ",", 
             RowBox[{"-", "p"}]}], "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"f_", "[", "x__", "]"}], ",", "p_"}], "]"}], "/;", 
          RowBox[{
           RowBox[{"f", "\[Equal]", "SpinorAngleBracket"}], "||", 
           RowBox[{"f", "\[Equal]", "SpinorSquareBracket"}], "||", 
           RowBox[{"f", "\[Equal]", "Chain"}]}]}], ":=", 
         RowBox[{"tochain", "[", 
          RowBox[{"Sequence", "@@", 
           RowBox[{"ConstantArray", "[", 
            RowBox[{
             RowBox[{"f", "[", "x", "]"}], ",", "p"}], "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"Times", "[", 
           RowBox[{"z___", ",", 
            RowBox[{"f_", "[", "x__", "]"}], ",", "y___"}], "]"}], "/;", 
          RowBox[{
           RowBox[{"f", "\[Equal]", "SpinorAngleBracket"}], "||", 
           RowBox[{"f", "\[Equal]", "SpinorSquareBracket"}], "||", 
           RowBox[{"f", "\[Equal]", "Chain"}]}]}], ":=", 
         RowBox[{"Times", "[", 
          RowBox[{"z", ",", 
           RowBox[{"tochain", "[", 
            RowBox[{"f", "[", "x", "]"}], "]"}], ",", "y"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"locexp", "=", "locexp"}], ";"}]}], "\[IndentingNewLine]", 
      "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"tochain", " ", "/:", " ", 
      RowBox[{"Times", "[", 
       RowBox[{
        RowBox[{"tochain", "[", "x__", "]"}], ",", 
        RowBox[{"tochain", "[", "y__", "]"}], ",", "z___"}], "]"}], ":=", 
      RowBox[{"Times", "[", 
       RowBox[{
        RowBox[{"tochain", "[", 
         RowBox[{"x", ",", "y"}], "]"}], ",", "z"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"tochaininv", " ", "/:", " ", 
      RowBox[{"Times", "[", 
       RowBox[{
        RowBox[{"tochaininv", "[", "x__", "]"}], ",", 
        RowBox[{"tochaininv", "[", "y__", "]"}], ",", "z___"}], "]"}], ":=", 
      RowBox[{"Times", "[", 
       RowBox[{
        RowBox[{"tochaininv", "[", 
         RowBox[{"x", ",", "y"}], "]"}], ",", "z"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"locexp", "=", "locexp"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Basing", " ", "on", " ", "the", " ", "options", " ", "we", " ", 
       "decide", " ", "which", " ", "chain", " ", "we", " ", "want", " ", 
       "to", " ", "pick"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"chainCrit", "=", 
      RowBox[{"OptionValue", "[", "ChainSelection", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Which", "[", 
      RowBox[{
       RowBox[{"chainCrit", "===", "\"\<ShortestChain\>\""}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"chainselect", "[", "chains_List", "]"}], ":=", 
        RowBox[{"Times", "@@", 
         RowBox[{"Last", "@", 
          RowBox[{"SortBy", "[", 
           RowBox[{"chains", ",", "Length"}], "]"}]}]}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"chainCrit", "===", "\"\<LongestChain\>\""}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"chainselect", "[", "chains_List", "]"}], ":=", 
        RowBox[{"Times", "@@", 
         RowBox[{"First", "@", 
          RowBox[{"SortBy", "[", 
           RowBox[{"chains", ",", "Length"}], "]"}]}]}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"chainCrit", "===", "\"\<MostTraces\>\""}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"chainselect", "[", "chains_List", "]"}], ":=", 
        RowBox[{"Times", "@@", 
         RowBox[{"Last", "@", 
          RowBox[{"SortBy", "[", 
           RowBox[{"chains", ",", 
            RowBox[{
             RowBox[{"Length", "@", 
              RowBox[{"Cases", "[", 
               RowBox[{"#", ",", 
                RowBox[{
                 RowBox[{"Chain", "[", 
                  RowBox[{"$angle", ",", "x_", ",", 
                   RowBox[{"{", "__", "}"}], ",", "x_", ",", "$square"}], 
                  "]"}], "\[RuleDelayed]", "1"}]}], "]"}]}], "&"}]}], 
           "]"}]}]}]}], ",", "\[IndentingNewLine]", "True", ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"chainselect", "[", "chains_List", "]"}], ":=", 
        RowBox[{"Times", "@@", 
         RowBox[{"Last", "@", 
          RowBox[{"SortBy", "[", 
           RowBox[{"chains", ",", "Length"}], "]"}]}]}]}]}], 
      "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"tochain", "[", "x__", "]"}], ":=", 
      RowBox[{"chainselect", "@", 
       RowBox[{"AllChains", "[", 
        RowBox[{"{", "x", "}"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"tochaininv", "[", "x__", "]"}], ":=", 
      RowBox[{"Power", "[", 
       RowBox[{
        RowBox[{"chainselect", "@", 
         RowBox[{"AllChains", "[", 
          RowBox[{"{", "x", "}"}], "]"}]}], ",", 
        RowBox[{"-", "1"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     "locexp"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGAQAWIQ/XThwvyuhjeOFVyCFSD6vYNrLYju2FzUAaLNtk2b
D6JF75osBNE3akxWgGgFnzdrQPS0oMDDILqNM+06iF680vo2iD533PUpiJbc
veUliD4098IbEN2bMP0XiL7yvv0PiDZiF2bpBtIpsx4pgWixSV0aIJrh2S0w
7fRWxBREn3rZbAaiV6Qu9gXR36zDYkG07b0VKSC64yZHM4j2zOqa1wukG7mU
N4Bog9NLToJoCX6zWyB6w6PGiilA+o1wQj2IPsHd3QyiD83/NBFEv9I4MwtE
uzkEzQbRVvMrgzY0vnEMLZcIBtHRpbmRIFrPrA5MAwBSI6pt
  "],
 CellLabel->
  "In[115]:=",ExpressionUUID->"e88dd18a-3be3-4e20-8992-23cd1ce34509"]
}, Closed]],

Cell[CellGroupData[{

Cell["Tests", "Subsubsection",
 CellChangeTimes->{{3.8261026843447495`*^9, 
  3.8261026854438105`*^9}},ExpressionUUID->"c325fb54-8ad0-437e-90d2-\
d696c9cd0d81"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"prova", "=", 
  FractionBox[
   RowBox[{"3", " ", "a", " ", 
    TemplateBox[{"1", "2"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], " ", 
    RowBox[{
     TemplateBox[{"3", "4"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], "^", "5"}], 
    TemplateBox[{"5", "6"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], " ", 
    SuperscriptBox[
     TemplateBox[{"9", "10"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], "3"], " ", 
    TemplateBox[{"1", "4"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], " ", 
    TemplateBox[{"2", "3"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], " ", 
    TemplateBox[{"2", "4"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )]}], 
   RowBox[{
    SuperscriptBox[
     TemplateBox[{"6", "7"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], "2"], " ", 
    TemplateBox[{"7", "8"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )]}]]}]], "Input",
 CellChangeTimes->{{3.8261023444807663`*^9, 3.8261023527286825`*^9}},
 CellLabel->
  "In[201]:=",ExpressionUUID->"2eba5f99-aec8-4b18-8d22-d3e84ebc0377"],

Cell[BoxData[
 FractionBox[
  RowBox[{"3", " ", "a", " ", 
   TemplateBox[{"1", "2"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], " ", 
   SuperscriptBox[
    TemplateBox[{"3", "4"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "5"], " ", 
   TemplateBox[{"5", "6"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], " ", 
   SuperscriptBox[
    TemplateBox[{"9", "10"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "3"], " ", 
   TemplateBox[{"1", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], " ", 
   TemplateBox[{"2", "3"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], " ", 
   TemplateBox[{"2", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}], 
  RowBox[{
   SuperscriptBox[
    TemplateBox[{"6", "7"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "2"], " ", 
   TemplateBox[{"7", "8"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}]]], "Output",
 CellChangeTimes->{
  3.8261009180987635`*^9, 3.826100958951171*^9, 3.8261010349283705`*^9, 
   3.8261020947499237`*^9, 3.826102278323958*^9, 3.8261023119317765`*^9, {
   3.8261023455908036`*^9, 3.826102353388942*^9}, 3.826102539305642*^9},
 CellLabel->
  "Out[201]=",ExpressionUUID->"fd01df32-3a14-4ecf-ac06-6effdf4fc26b"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"ToChainNew", "[", "prova", "]"}], "//", 
  "RepeatedTiming"}]], "Input",
 CellChangeTimes->{{3.826100918943183*^9, 3.8261009274302635`*^9}, {
  3.826102329235533*^9, 3.8261023322185698`*^9}},
 CellLabel->
  "In[202]:=",ExpressionUUID->"99cc72fd-5d66-4059-a983-6a7a3cb763d4"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.00657303203125`", ",", 
   FractionBox[
    RowBox[{"3", " ", "a", " ", 
     TemplateBox[{"3", 
       RowBox[{"{", "4", "}"}], "2"},
      "AngleSquareChain",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], " ", 
     TemplateBox[{"4", 
       RowBox[{"{", 
         RowBox[{"3", ",", "2", ",", "1"}], "}"}], "4"},
      "AngleSquareChain",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], " ", 
     SuperscriptBox[
      TemplateBox[{"3", "4"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], "3"], " ", 
     TemplateBox[{"5", "6"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], " ", 
     SuperscriptBox[
      TemplateBox[{"9", "10"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], "3"]}], 
    RowBox[{
     TemplateBox[{"6", 
       RowBox[{"{", "7", "}"}], "8"},
      "AngleSquareChain",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], " ", 
     TemplateBox[{"6", "7"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}]]}], "}"}]], "Output",
 CellChangeTimes->{
  3.82610092818904*^9, 3.826100960052968*^9, 3.826101035786045*^9, 
   3.826102096166171*^9, 3.8261022794060507`*^9, {3.8261023132851872`*^9, 
   3.8261023562233124`*^9}, 3.8261025418718085`*^9},
 CellLabel->
  "Out[202]=",ExpressionUUID->"95eb77de-d799-4af2-8ce0-bbdc763f2749"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"prova", "=", 
  FractionBox[
   RowBox[{"3", " ", "a", " ", 
    TemplateBox[{"1", "2"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], " ", 
    RowBox[{
     TemplateBox[{"3", "4"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], "^", "9"}], 
    TemplateBox[{"5", "6"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], " ", 
    SuperscriptBox[
     TemplateBox[{"9", "10"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], "3"], " ", 
    TemplateBox[{"1", "4"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], " ", 
    TemplateBox[{"2", "3"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], " ", 
    TemplateBox[{"2", "4"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )]}], 
   RowBox[{
    SuperscriptBox[
     TemplateBox[{"6", "7"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], "2"], " ", 
    TemplateBox[{"7", "8"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )]}]]}]], "Input",
 CellChangeTimes->{{3.8261023444807663`*^9, 3.8261023650377398`*^9}},
 CellLabel->
  "In[203]:=",ExpressionUUID->"04441769-4cc9-4e29-aed0-a418a523c553"],

Cell[BoxData[
 FractionBox[
  RowBox[{"3", " ", "a", " ", 
   TemplateBox[{"1", "2"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], " ", 
   SuperscriptBox[
    TemplateBox[{"3", "4"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "9"], " ", 
   TemplateBox[{"5", "6"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], " ", 
   SuperscriptBox[
    TemplateBox[{"9", "10"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "3"], " ", 
   TemplateBox[{"1", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], " ", 
   TemplateBox[{"2", "3"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], " ", 
   TemplateBox[{"2", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}], 
  RowBox[{
   SuperscriptBox[
    TemplateBox[{"6", "7"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "2"], " ", 
   TemplateBox[{"7", "8"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}]]], "Output",
 CellChangeTimes->{
  3.8261009180987635`*^9, 3.826100958951171*^9, 3.8261010349283705`*^9, 
   3.8261020947499237`*^9, 3.826102278323958*^9, 3.8261023119317765`*^9, {
   3.8261023455908036`*^9, 3.826102365709941*^9}, 3.8261025449026637`*^9},
 CellLabel->
  "Out[203]=",ExpressionUUID->"d6d05d2a-533b-459c-b117-f07de048f2b0"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"ToChainNew", "[", "prova", "]"}], "//", 
  "RepeatedTiming"}]], "Input",
 CellChangeTimes->{{3.826100918943183*^9, 3.8261009274302635`*^9}, {
  3.826102329235533*^9, 3.8261023322185698`*^9}},
 CellLabel->
  "In[204]:=",ExpressionUUID->"8e600979-26ae-42b2-bf33-87710f6f5c36"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.0064710078125`", ",", 
   FractionBox[
    RowBox[{"3", " ", "a", " ", 
     TemplateBox[{"3", 
       RowBox[{"{", "4", "}"}], "2"},
      "AngleSquareChain",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], " ", 
     TemplateBox[{"4", 
       RowBox[{"{", 
         RowBox[{"3", ",", "2", ",", "1"}], "}"}], "4"},
      "AngleSquareChain",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], " ", 
     SuperscriptBox[
      TemplateBox[{"3", "4"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], "7"], " ", 
     TemplateBox[{"5", "6"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], " ", 
     SuperscriptBox[
      TemplateBox[{"9", "10"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], "3"]}], 
    RowBox[{
     TemplateBox[{"6", 
       RowBox[{"{", "7", "}"}], "8"},
      "AngleSquareChain",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], " ", 
     TemplateBox[{"6", "7"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}]]}], "}"}]], "Output",
 CellChangeTimes->{
  3.82610092818904*^9, 3.826100960052968*^9, 3.826101035786045*^9, 
   3.826102096166171*^9, 3.8261022794060507`*^9, {3.8261023132851872`*^9, 
   3.8261023695905976`*^9}, 3.8261025475844913`*^9},
 CellLabel->
  "Out[204]=",ExpressionUUID->"622ef4e6-94a0-4bc9-9c68-827c15f922f4"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"prova", "=", 
  FractionBox[
   RowBox[{"3", " ", "a", " ", 
    TemplateBox[{"1", "2"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], " ", 
    TemplateBox[{"3", "4"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], 
    TemplateBox[{"5", "6"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], " ", 
    SuperscriptBox[
     TemplateBox[{"9", "10"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], "3"], " ", 
    TemplateBox[{"1", "4"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], " ", 
    RowBox[{
     TemplateBox[{"2", "3"},
      "SpinorSquareBracket",
      DisplayFunction->(RowBox[{"[", 
         RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], "^", "5"}], " ", 
    TemplateBox[{"2", "4"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )]}], 
   RowBox[{
    SuperscriptBox[
     TemplateBox[{"6", "7"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], "2"], " ", 
    TemplateBox[{"7", "8"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )]}]]}]], "Input",
 CellChangeTimes->{{3.8261023444807663`*^9, 3.8261023650377398`*^9}, {
  3.8261023999593377`*^9, 3.8261024067621417`*^9}},
 CellLabel->
  "In[205]:=",ExpressionUUID->"18409565-5e9f-4178-98da-3eb012c8572f"],

Cell[BoxData[
 FractionBox[
  RowBox[{"3", " ", "a", " ", 
   TemplateBox[{"1", "2"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], " ", 
   TemplateBox[{"3", "4"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], " ", 
   TemplateBox[{"5", "6"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], " ", 
   SuperscriptBox[
    TemplateBox[{"9", "10"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "3"], " ", 
   TemplateBox[{"1", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], " ", 
   SuperscriptBox[
    TemplateBox[{"2", "3"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "5"], " ", 
   TemplateBox[{"2", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}], 
  RowBox[{
   SuperscriptBox[
    TemplateBox[{"6", "7"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "2"], " ", 
   TemplateBox[{"7", "8"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}]]], "Output",
 CellChangeTimes->{
  3.8261009180987635`*^9, 3.826100958951171*^9, 3.8261010349283705`*^9, 
   3.8261020947499237`*^9, 3.826102278323958*^9, 3.8261023119317765`*^9, {
   3.8261023455908036`*^9, 3.826102365709941*^9}, 3.826102407307714*^9, 
   3.826102551095107*^9},
 CellLabel->
  "Out[205]=",ExpressionUUID->"21282b8d-7420-4a2e-9d02-da895704637c"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"ToChainNew", "[", "prova", "]"}], "//", 
  "RepeatedTiming"}]], "Input",
 CellChangeTimes->{{3.826100918943183*^9, 3.8261009274302635`*^9}, {
  3.826102329235533*^9, 3.8261023322185698`*^9}},
 CellLabel->
  "In[206]:=",ExpressionUUID->"3ce577d6-b0cb-42d0-ab36-1f821b94e8ac"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.0038791265625`", ",", 
   RowBox[{"-", 
    FractionBox[
     RowBox[{"3", " ", "a", " ", 
      TemplateBox[{"4", 
        RowBox[{"{", 
          RowBox[{"3", ",", "2", ",", "1"}], "}"}], "4"},
       "AngleSquareChain",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
       InterpretationFunction->(
        RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
          "$square", "]"}]& )], " ", 
      TemplateBox[{"5", "6"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], " ", 
      SuperscriptBox[
       TemplateBox[{"9", "10"},
        "SpinorAngleBracket",
        DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
           RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
        InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
           RowBox[{#, ",", #2}], "]"}]& )], "3"], " ", 
      SuperscriptBox[
       TemplateBox[{"2", "3"},
        "SpinorSquareBracket",
        DisplayFunction->(RowBox[{"[", 
           RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
        InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
           RowBox[{#, ",", #2}], "]"}]& )], "4"], " ", 
      TemplateBox[{"2", "4"},
       "SpinorSquareBracket",
       DisplayFunction->(RowBox[{"[", 
          RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )]}], 
     RowBox[{
      TemplateBox[{"6", 
        RowBox[{"{", "7", "}"}], "8"},
       "AngleSquareChain",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
       InterpretationFunction->(
        RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
          "$square", "]"}]& )], " ", 
      TemplateBox[{"6", "7"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )]}]]}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.82610092818904*^9, 3.826100960052968*^9, 3.826101035786045*^9, 
   3.826102096166171*^9, 3.8261022794060507`*^9, {3.8261023132851872`*^9, 
   3.8261023695905976`*^9}, 3.8261024104622774`*^9, 3.8261025554245577`*^9},
 CellLabel->
  "Out[206]=",ExpressionUUID->"7c5dd5da-6abf-4f59-a98d-821711826cab"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"prova", "=", 
  FractionBox[
   RowBox[{"3", " ", "a", " ", 
    TemplateBox[{"1", "2"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], " ", 
    TemplateBox[{"3", "4"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], 
    TemplateBox[{"5", "6"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], " ", 
    SuperscriptBox[
     TemplateBox[{"9", "10"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], "3"], " ", 
    TemplateBox[{"1", "4"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], " ", 
    TemplateBox[{"2", "3"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], " ", 
    TemplateBox[{"2", "4"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )]}], 
   RowBox[{
    SuperscriptBox[
     TemplateBox[{"6", "7"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], "2"], " ", 
    TemplateBox[{"7", "8"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )]}]]}]], "Input",
 CellChangeTimes->{{3.826102569631564*^9, 3.826102569762207*^9}},
 CellLabel->
  "In[207]:=",ExpressionUUID->"4ac89f3e-667a-43d1-9c24-be5f26abb732"],

Cell[BoxData[
 FractionBox[
  RowBox[{"3", " ", "a", " ", 
   TemplateBox[{"1", "2"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], " ", 
   TemplateBox[{"3", "4"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], " ", 
   TemplateBox[{"5", "6"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], " ", 
   SuperscriptBox[
    TemplateBox[{"9", "10"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "3"], " ", 
   TemplateBox[{"1", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], " ", 
   TemplateBox[{"2", "3"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], " ", 
   TemplateBox[{"2", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}], 
  RowBox[{
   SuperscriptBox[
    TemplateBox[{"6", "7"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "2"], " ", 
   TemplateBox[{"7", "8"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}]]], "Output",
 CellChangeTimes->{3.8261025725397778`*^9},
 CellLabel->
  "Out[207]=",ExpressionUUID->"2efd57b0-dad4-4331-9c0c-36f83aff5d1a"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"ToChainNew", "@", "prova"}], "//", "RepeatedTiming"}]], "Input",
 CellChangeTimes->{{3.8261025744426947`*^9, 3.826102586687912*^9}},
 CellLabel->
  "In[209]:=",ExpressionUUID->"c474083f-0f3b-48a8-bc41-615c3ba1a21c"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.002919479296875`", ",", 
   RowBox[{"-", 
    FractionBox[
     RowBox[{"3", " ", "a", " ", 
      TemplateBox[{"4", 
        RowBox[{"{", 
          RowBox[{"3", ",", "2", ",", "1"}], "}"}], "4"},
       "AngleSquareChain",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
       InterpretationFunction->(
        RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
          "$square", "]"}]& )], " ", 
      TemplateBox[{"5", "6"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], " ", 
      SuperscriptBox[
       TemplateBox[{"9", "10"},
        "SpinorAngleBracket",
        DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
           RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
        InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
           RowBox[{#, ",", #2}], "]"}]& )], "3"], " ", 
      TemplateBox[{"2", "4"},
       "SpinorSquareBracket",
       DisplayFunction->(RowBox[{"[", 
          RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )]}], 
     RowBox[{
      TemplateBox[{"6", 
        RowBox[{"{", "7", "}"}], "8"},
       "AngleSquareChain",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
       InterpretationFunction->(
        RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
          "$square", "]"}]& )], " ", 
      TemplateBox[{"6", "7"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )]}]]}]}], "}"}]], "Output",
 CellChangeTimes->{{3.8261025833737693`*^9, 3.82610258854597*^9}},
 CellLabel->
  "Out[209]=",ExpressionUUID->"debc08cf-3d70-4d24-8f32-d0fa0b6d08ea"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Tests from the package", "Subsubsection",
 CellChangeTimes->{{3.8261026843447495`*^9, 3.8261026854438105`*^9}, {
  3.826104202132323*^9, 
  3.8261042052440424`*^9}},ExpressionUUID->"17213529-1353-4233-8fe3-\
b0f79bf058c6"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"prova", "=", 
  FractionBox[
   RowBox[{"3", " ", "a", " ", 
    TemplateBox[{"1", "2"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], " ", 
    RowBox[{
     TemplateBox[{"3", "4"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], "^", "5"}], 
    TemplateBox[{"5", "6"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], " ", 
    SuperscriptBox[
     TemplateBox[{"9", "10"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], "3"], " ", 
    TemplateBox[{"1", "4"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], " ", 
    TemplateBox[{"2", "3"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], " ", 
    TemplateBox[{"2", "4"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )]}], 
   RowBox[{
    SuperscriptBox[
     TemplateBox[{"6", "7"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], "2"], " ", 
    TemplateBox[{"7", "8"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )]}]]}]], "Input",
 CellChangeTimes->{{3.8261023444807663`*^9, 3.8261023527286825`*^9}},
 CellLabel->"In[18]:=",ExpressionUUID->"8c91883a-427d-45e5-8b6e-a93274eca4df"],

Cell[BoxData[
 FractionBox[
  RowBox[{"3", " ", "a", " ", 
   TemplateBox[{"1", "2"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], " ", 
   SuperscriptBox[
    TemplateBox[{"3", "4"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "5"], " ", 
   TemplateBox[{"5", "6"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], " ", 
   SuperscriptBox[
    TemplateBox[{"9", "10"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "3"], " ", 
   TemplateBox[{"1", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], " ", 
   TemplateBox[{"2", "3"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], " ", 
   TemplateBox[{"2", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}], 
  RowBox[{
   SuperscriptBox[
    TemplateBox[{"6", "7"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "2"], " ", 
   TemplateBox[{"7", "8"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}]]], "Output",
 CellChangeTimes->{
  3.8261009180987635`*^9, 3.826100958951171*^9, 3.8261010349283705`*^9, 
   3.8261020947499237`*^9, 3.826102278323958*^9, 3.8261023119317765`*^9, {
   3.8261023455908036`*^9, 3.826102353388942*^9}, 3.826102539305642*^9, 
   3.8261042962634106`*^9},
 CellLabel->"Out[18]=",ExpressionUUID->"c5fad053-66dc-4a56-bbdb-62344f2ab8bf"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"ToChain", "[", "prova", "]"}], "//", "RepeatedTiming"}]], "Input",
 CellChangeTimes->{{3.826100918943183*^9, 3.8261009274302635`*^9}, {
  3.826102329235533*^9, 3.8261023322185698`*^9}, {3.8261042981693707`*^9, 
  3.826104322022562*^9}},
 CellLabel->"In[20]:=",ExpressionUUID->"1d4193ba-7270-4e9e-bc14-9eaf2d5ca295"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.002062368359375`", ",", 
   FractionBox[
    RowBox[{"3", " ", "a", " ", 
     TemplateBox[{"3", 
       RowBox[{"{", "4", "}"}], "2"},
      "AngleSquareChain",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], " ", 
     TemplateBox[{"3", 
       RowBox[{"{", 
         RowBox[{"4", ",", "1", ",", "2"}], "}"}], "3"},
      "AngleSquareChain",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], " ", 
     SuperscriptBox[
      TemplateBox[{"3", "4"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], "3"], " ", 
     TemplateBox[{"5", "6"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], " ", 
     SuperscriptBox[
      TemplateBox[{"9", "10"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], "3"]}], 
    RowBox[{
     TemplateBox[{"6", 
       RowBox[{"{", "7", "}"}], "8"},
      "AngleSquareChain",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], " ", 
     TemplateBox[{"6", "7"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}]]}], "}"}]], "Output",
 CellChangeTimes->{
  3.82610092818904*^9, 3.826100960052968*^9, 3.826101035786045*^9, 
   3.826102096166171*^9, 3.8261022794060507`*^9, {3.8261023132851872`*^9, 
   3.8261023562233124`*^9}, 3.8261025418718085`*^9, {3.8261043024957433`*^9, 
   3.8261043236830735`*^9}},
 CellLabel->"Out[20]=",ExpressionUUID->"6c8df29e-26eb-4e92-969b-0d56d790a01d"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"ToChain", "[", 
   RowBox[{"prova", ",", 
    RowBox[{"ChainSelection", "\[Rule]", "\"\<LongestChain\>\""}]}], "]"}], "//",
   "RepeatedTiming"}]], "Input",
 CellChangeTimes->{{3.8261043474255733`*^9, 3.82610437007802*^9}},
 CellLabel->"In[21]:=",ExpressionUUID->"d5d71e27-7bc4-4f0a-8a3d-791a2430932b"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.00638239140625`", ",", 
   RowBox[{"-", 
    FractionBox[
     RowBox[{"3", " ", "a", " ", 
      TemplateBox[{"3", 
        RowBox[{"{", "4", "}"}], "2"},
       "AngleSquareChain",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
       InterpretationFunction->(
        RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
          "$square", "]"}]& )], " ", 
      TemplateBox[{"4", 
        RowBox[{"{", 
          RowBox[{"3", ",", "2", ",", "1", ",", "4"}], "}"}], "3"},
       "AngleAngleChain",
       DisplayFunction->(
        RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(
        RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
          "$angle", "]"}]& )], " ", 
      SuperscriptBox[
       TemplateBox[{"3", "4"},
        "SpinorAngleBracket",
        DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
           RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
        InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
           RowBox[{#, ",", #2}], "]"}]& )], "2"], " ", 
      TemplateBox[{"5", "6"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], " ", 
      SuperscriptBox[
       TemplateBox[{"9", "10"},
        "SpinorAngleBracket",
        DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
           RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
        InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
           RowBox[{#, ",", #2}], "]"}]& )], "3"]}], 
     RowBox[{
      TemplateBox[{"6", 
        RowBox[{"{", "7", "}"}], "8"},
       "AngleSquareChain",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
       InterpretationFunction->(
        RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
          "$square", "]"}]& )], " ", 
      TemplateBox[{"6", "7"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )]}]]}]}], "}"}]], "Output",
 CellChangeTimes->{3.8261043730490375`*^9},
 CellLabel->"Out[21]=",ExpressionUUID->"2ce5d97d-bba3-448f-b11b-6780eeb38cfa"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"prova", "=", 
  FractionBox[
   RowBox[{"3", " ", "a", " ", 
    TemplateBox[{"1", "2"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], " ", 
    RowBox[{
     TemplateBox[{"3", "4"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], "^", "9"}], 
    TemplateBox[{"5", "6"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], " ", 
    SuperscriptBox[
     TemplateBox[{"9", "10"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], "3"], " ", 
    TemplateBox[{"1", "4"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], " ", 
    TemplateBox[{"2", "3"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], " ", 
    TemplateBox[{"2", "4"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )]}], 
   RowBox[{
    SuperscriptBox[
     TemplateBox[{"6", "7"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], "2"], " ", 
    TemplateBox[{"7", "8"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )]}]]}]], "Input",
 CellChangeTimes->{{3.8261023444807663`*^9, 3.8261023650377398`*^9}},
 CellLabel->"In[22]:=",ExpressionUUID->"8a88c0d0-912c-429c-bc8f-ef4bd1c7449d"],

Cell[BoxData[
 FractionBox[
  RowBox[{"3", " ", "a", " ", 
   TemplateBox[{"1", "2"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], " ", 
   SuperscriptBox[
    TemplateBox[{"3", "4"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "9"], " ", 
   TemplateBox[{"5", "6"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], " ", 
   SuperscriptBox[
    TemplateBox[{"9", "10"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "3"], " ", 
   TemplateBox[{"1", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], " ", 
   TemplateBox[{"2", "3"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], " ", 
   TemplateBox[{"2", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}], 
  RowBox[{
   SuperscriptBox[
    TemplateBox[{"6", "7"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "2"], " ", 
   TemplateBox[{"7", "8"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}]]], "Output",
 CellChangeTimes->{
  3.8261009180987635`*^9, 3.826100958951171*^9, 3.8261010349283705`*^9, 
   3.8261020947499237`*^9, 3.826102278323958*^9, 3.8261023119317765`*^9, {
   3.8261023455908036`*^9, 3.826102365709941*^9}, 3.8261025449026637`*^9, 
   3.8261048333868446`*^9},
 CellLabel->"Out[22]=",ExpressionUUID->"30a81454-3dbf-4a60-b75c-542ce3de7c71"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"ToChain", "[", 
   RowBox[{"prova", ",", 
    RowBox[{"ChainSelection", "\[Rule]", "\"\<MostTraces\>\""}]}], "]"}], "//",
   "RepeatedTiming"}]], "Input",
 CellChangeTimes->{{3.826100918943183*^9, 3.8261009274302635`*^9}, {
  3.826102329235533*^9, 3.8261023322185698`*^9}, {3.8261048347541523`*^9, 
  3.8261048527380543`*^9}},
 CellLabel->"In[23]:=",ExpressionUUID->"059da7c2-504b-436f-8498-3e5f47c3cc95"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.0066467140625`", ",", 
   FractionBox[
    RowBox[{"3", " ", "a", " ", 
     TemplateBox[{"3", 
       RowBox[{"{", "4", "}"}], "2"},
      "AngleSquareChain",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], " ", 
     TemplateBox[{"4", 
       RowBox[{"{", 
         RowBox[{"3", ",", "2", ",", "1"}], "}"}], "4"},
      "AngleSquareChain",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], " ", 
     SuperscriptBox[
      TemplateBox[{"3", "4"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], "7"], " ", 
     TemplateBox[{"5", "6"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], " ", 
     SuperscriptBox[
      TemplateBox[{"9", "10"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], "3"]}], 
    RowBox[{
     TemplateBox[{"6", 
       RowBox[{"{", "7", "}"}], "8"},
      "AngleSquareChain",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], " ", 
     TemplateBox[{"6", "7"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}]]}], "}"}]], "Output",
 CellChangeTimes->{
  3.82610092818904*^9, 3.826100960052968*^9, 3.826101035786045*^9, 
   3.826102096166171*^9, 3.8261022794060507`*^9, {3.8261023132851872`*^9, 
   3.8261023695905976`*^9}, 3.8261025475844913`*^9, 3.8261048552263937`*^9},
 CellLabel->"Out[23]=",ExpressionUUID->"400d8a7b-1d6c-4ade-9119-4c3107a8a763"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"ToChain", "[", "prova", "]"}], "//", "RepeatedTiming"}]], "Input",
 CellChangeTimes->{{3.826100918943183*^9, 3.8261009274302635`*^9}, {
  3.826102329235533*^9, 3.8261023322185698`*^9}, {3.826104867849635*^9, 
  3.826104868293501*^9}},
 CellLabel->"In[24]:=",ExpressionUUID->"efd3242e-8530-454e-b209-5705b2e38911"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.0019783765625`", ",", 
   FractionBox[
    RowBox[{"3", " ", "a", " ", 
     TemplateBox[{"3", 
       RowBox[{"{", "4", "}"}], "2"},
      "AngleSquareChain",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], " ", 
     TemplateBox[{"3", 
       RowBox[{"{", 
         RowBox[{"4", ",", "1", ",", "2"}], "}"}], "3"},
      "AngleSquareChain",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], " ", 
     SuperscriptBox[
      TemplateBox[{"3", "4"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], "7"], " ", 
     TemplateBox[{"5", "6"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], " ", 
     SuperscriptBox[
      TemplateBox[{"9", "10"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], "3"]}], 
    RowBox[{
     TemplateBox[{"6", 
       RowBox[{"{", "7", "}"}], "8"},
      "AngleSquareChain",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
      InterpretationFunction->(
       RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
         "$square", "]"}]& )], " ", 
     TemplateBox[{"6", "7"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )]}]]}], "}"}]], "Output",
 CellChangeTimes->{
  3.82610092818904*^9, 3.826100960052968*^9, 3.826101035786045*^9, 
   3.826102096166171*^9, 3.8261022794060507`*^9, {3.8261023132851872`*^9, 
   3.8261023695905976`*^9}, 3.8261024104622774`*^9, 3.8261025554245577`*^9, 
   3.8261048775407457`*^9},
 CellLabel->"Out[24]=",ExpressionUUID->"733823fd-a33d-4e32-b25c-12906feb1b12"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"prova", "=", 
  FractionBox[
   RowBox[{"3", " ", "a", " ", 
    TemplateBox[{"1", "2"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], " ", 
    TemplateBox[{"3", "4"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], 
    TemplateBox[{"5", "6"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], " ", 
    SuperscriptBox[
     TemplateBox[{"9", "10"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], "3"], " ", 
    TemplateBox[{"1", "4"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], " ", 
    TemplateBox[{"2", "3"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], " ", 
    TemplateBox[{"2", "4"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )]}], 
   RowBox[{
    SuperscriptBox[
     TemplateBox[{"6", "7"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], "2"], " ", 
    TemplateBox[{"7", "8"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )]}]]}]], "Input",
 CellChangeTimes->{{3.826102569631564*^9, 3.826102569762207*^9}},
 CellLabel->"In[25]:=",ExpressionUUID->"d6eafe2d-eb81-478d-aef1-3b224a01dd86"],

Cell[BoxData[
 FractionBox[
  RowBox[{"3", " ", "a", " ", 
   TemplateBox[{"1", "2"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], " ", 
   TemplateBox[{"3", "4"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], " ", 
   TemplateBox[{"5", "6"},
    "SpinorAngleBracket",
    DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], " ", 
   SuperscriptBox[
    TemplateBox[{"9", "10"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "3"], " ", 
   TemplateBox[{"1", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], " ", 
   TemplateBox[{"2", "3"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], " ", 
   TemplateBox[{"2", "4"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}], 
  RowBox[{
   SuperscriptBox[
    TemplateBox[{"6", "7"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], "2"], " ", 
   TemplateBox[{"7", "8"},
    "SpinorSquareBracket",
    DisplayFunction->(RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
    InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )]}]]], "Output",
 CellChangeTimes->{3.8261025725397778`*^9, 3.8261049035092573`*^9},
 CellLabel->"Out[25]=",ExpressionUUID->"edbf9b1a-3afc-4fbf-b9c3-7b51125508b7"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"ToChain", "[", 
   RowBox[{"prova", ",", 
    RowBox[{"ChainSelection", "\[Rule]", "\"\<MostTraces\>\""}]}], "]"}], "//",
   "RepeatedTiming"}]], "Input",
 CellChangeTimes->{{3.8261025744426947`*^9, 3.826102586687912*^9}, {
  3.8261049055717916`*^9, 3.826104928954206*^9}},
 CellLabel->"In[26]:=",ExpressionUUID->"db3a71ea-4eae-434c-b8b6-90f4fb52b41e"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.00287826796875`", ",", 
   RowBox[{"-", 
    FractionBox[
     RowBox[{"3", " ", "a", " ", 
      TemplateBox[{"4", 
        RowBox[{"{", 
          RowBox[{"3", ",", "2", ",", "1"}], "}"}], "4"},
       "AngleSquareChain",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
       InterpretationFunction->(
        RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
          "$square", "]"}]& )], " ", 
      TemplateBox[{"5", "6"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )], " ", 
      SuperscriptBox[
       TemplateBox[{"9", "10"},
        "SpinorAngleBracket",
        DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
           RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
        InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
           RowBox[{#, ",", #2}], "]"}]& )], "3"], " ", 
      TemplateBox[{"2", "4"},
       "SpinorSquareBracket",
       DisplayFunction->(RowBox[{"[", 
          RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )]}], 
     RowBox[{
      TemplateBox[{"6", 
        RowBox[{"{", "7", "}"}], "8"},
       "AngleSquareChain",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
       InterpretationFunction->(
        RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
          "$square", "]"}]& )], " ", 
      TemplateBox[{"6", "7"},
       "SpinorAngleBracket",
       DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
          RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
       InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
          RowBox[{#, ",", #2}], "]"}]& )]}]]}]}], "}"}]], "Output",
 CellChangeTimes->{{3.8261025833737693`*^9, 3.82610258854597*^9}, 
   3.826104931327851*^9},
 CellLabel->"Out[26]=",ExpressionUUID->"105749c7-d40b-4598-8b55-41dbca1b749c"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ToChain", "[", 
  RowBox[{"prova", ",", 
   RowBox[{"ChainSelection", "\[Rule]", "\"\<acaso\>\""}]}], "]"}]], "Input",
 CellChangeTimes->{{3.8261049405102973`*^9, 3.8261049416443005`*^9}},
 CellLabel->"In[29]:=",ExpressionUUID->"eab8fa97-7056-4d41-8ffa-2976beb28498"],

Cell[BoxData[
 TemplateBox[{
  "ToChain", "opt", "\"Unknown option, proceed with ShortestChain\"", 2, 29, 
   2, 25262856875004291890, "Local", "SpinorHelicity4D`ToChain"},
  "MessageTemplate2"]], "Message", "MSG",
 CellChangeTimes->{3.8261049428420563`*^9, 3.8261049761823626`*^9},
 CellLabel->
  "During evaluation of \
In[29]:=",ExpressionUUID->"0c3119c1-60b6-4bc2-926e-750125304cc7"],

Cell[BoxData[
 RowBox[{"-", 
  FractionBox[
   RowBox[{"3", " ", "a", " ", 
    TemplateBox[{"4", 
      RowBox[{"{", 
        RowBox[{"3", ",", "2", ",", "1"}], "}"}], "4"},
     "AngleSquareChain",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
     InterpretationFunction->(
      RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
        "$square", "]"}]& )], " ", 
    TemplateBox[{"5", "6"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )], " ", 
    SuperscriptBox[
     TemplateBox[{"9", "10"},
      "SpinorAngleBracket",
      DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
         RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
      InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
         RowBox[{#, ",", #2}], "]"}]& )], "3"], " ", 
    TemplateBox[{"2", "4"},
     "SpinorSquareBracket",
     DisplayFunction->(RowBox[{"[", 
        RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorSquareBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )]}], 
   RowBox[{
    TemplateBox[{"6", 
      RowBox[{"{", "7", "}"}], "8"},
     "AngleSquareChain",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ),
     InterpretationFunction->(
      RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", 
        "$square", "]"}]& )], " ", 
    TemplateBox[{"6", "7"},
     "SpinorAngleBracket",
     DisplayFunction->(RowBox[{"\[LeftAngleBracket]", 
        RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ),
     InterpretationFunction->(RowBox[{"SpinorAngleBracket", "[", 
        RowBox[{#, ",", #2}], "]"}]& )]}]]}]], "Output",
 CellChangeTimes->{3.826104976200349*^9},
 CellLabel->"Out[29]=",ExpressionUUID->"779f571e-9747-48b5-8c9d-651068bbd578"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"SystemDialogInput", "[", "\"\<Color\>\"", "]"}]], "Input",
 CellChangeTimes->{{3.8261079362959156`*^9, 3.8261079362978773`*^9}},
 CellLabel->"In[30]:=",ExpressionUUID->"f1b48567-bce7-4963-a6d9-0da7947e016c"],

Cell[BoxData[
 InterpretationBox[
  ButtonBox[
   TooltipBox[
    GraphicsBox[{
      {GrayLevel[0], RectangleBox[{0, 0}]}, 
      {GrayLevel[0], RectangleBox[{1, -1}]}, 
      {RGBColor[1, 0, 0], RectangleBox[{0, -1}, {2, 1}]}},
     AspectRatio->1,
     DefaultBaseStyle->"ColorSwatchGraphics",
     Frame->True,
     FrameStyle->RGBColor[0.6666666666666666, 0., 0.],
     FrameTicks->None,
     ImageSize->
      Dynamic[{Automatic, 
        1.35 (CurrentValue["FontCapHeight"]/AbsoluteCurrentValue[
         Magnification])}],
     PlotRangePadding->None],
    StyleBox[
     RowBox[{"RGBColor", "[", 
       RowBox[{"1", ",", "0", ",", "0"}], "]"}], NumberMarks -> False]],
   Appearance->None,
   BaseStyle->{},
   BaselinePosition->Baseline,
   ButtonFunction:>With[{Typeset`box$ = EvaluationBox[]}, 
     If[
      Not[
       AbsoluteCurrentValue["Deployed"]], 
      SelectionMove[Typeset`box$, All, Expression]; 
      FrontEnd`Private`$ColorSelectorInitialAlpha = 1; 
      FrontEnd`Private`$ColorSelectorInitialColor = RGBColor[1, 0, 0]; 
      FrontEnd`Private`$ColorSelectorUseMakeBoxes = True; 
      MathLink`CallFrontEnd[
        FrontEnd`AttachCell[Typeset`box$, 
         FrontEndResource["RGBColorValueSelector"], {0, {Left, Bottom}}, {
         Left, Top}, 
         "ClosingActions" -> {
          "SelectionDeparture", "ParentChanged", "EvaluatorQuit"}]]]],
   DefaultBaseStyle->{},
   Evaluator->Automatic,
   Method->"Preemptive"],
  RGBColor[1, 0, 0],
  Editable->False,
  Selectable->False]], "Output",
 CellChangeTimes->{3.8261079439474497`*^9},
 CellLabel->"Out[30]=",ExpressionUUID->"ac5866eb-50b9-45fa-a3d4-161ef3515772"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Tooltip", "[", 
  RowBox[{"mytest", ",", "\"\<boh\>\""}], "]"}]], "Input",
 CellChangeTimes->{{3.8261080339512897`*^9, 3.8261080634344687`*^9}, {
  3.8261082067135787`*^9, 3.8261082087520943`*^9}},
 CellLabel->"In[32]:=",ExpressionUUID->"e10adc43-ec1c-4b04-b595-ce64e1f1bfde"],

Cell[BoxData[
 TagBox[
  TooltipBox["mytest",
   "\"boh\"",
   TooltipStyle->"TextStyling"],
  Annotation[#, "boh", "Tooltip"]& ]], "Output",
 CellChangeTimes->{3.8261082093814077`*^9},
 CellLabel->"Out[32]=",ExpressionUUID->"f67b2575-4058-4530-aa9b-59979e15ab52"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"DynamicModule", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"x", "=", "Pink"}], "}"}], ",", 
   RowBox[{"Row", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Style", "[", 
       RowBox[{"\"\<Hello\>\"", ",", "x"}], "]"}], ",", 
      RowBox[{"Mouseover", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"x", "=", "Green"}], ";", "\"\<World\>\""}], ",", 
        RowBox[{
         RowBox[{"x", "=", "Blue"}], ";", "\"\<World\>\""}]}], "]"}]}], "}"}],
     "]"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.8261086612424746`*^9, 3.8261086612444687`*^9}},
 CellLabel->"In[33]:=",ExpressionUUID->"5542224f-c383-4301-8319-64b3c6837dcb"],

Cell[BoxData[
 DynamicModuleBox[{$CellContext`x$$ = RGBColor[0, 0, 1]}, 
  TemplateBox[{
    StyleBox["\"Hello\"", 
     RGBColor[1, 0.5, 0.5], StripOnInput -> False], 
    PaneSelectorBox[{False -> "\"World\"", True -> "\"World\""}, 
     Dynamic[
      CurrentValue["MouseOver"]], ImageSize -> Automatic, FrameMargins -> 0]},
   "RowDefault"],
  DynamicModuleValues:>{}]], "Output",
 CellChangeTimes->{3.8261086623116207`*^9},
 CellLabel->"Out[33]=",ExpressionUUID->"ebc0ab3e-7c9a-4922-af4d-c8e39abd871d"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Mouseover", "[", 
  RowBox[{"on", ",", "off"}], "]"}]], "Input",
 CellChangeTimes->{{3.826108730168065*^9, 3.8261087361250935`*^9}},
 CellLabel->"In[34]:=",ExpressionUUID->"8791ab51-a1cf-47bc-8e38-1adcb854eda4"],

Cell[BoxData[
 PaneSelectorBox[{False->"on", True->"off"}, Dynamic[
   CurrentValue["MouseOver"]],
  FrameMargins->0,
  ImageSize->Automatic]], "Output",
 CellChangeTimes->{3.8261087366048098`*^9},
 CellLabel->"Out[34]=",ExpressionUUID->"f1205be2-a4e9-4bbe-9e62-dbb7703dcc3a"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"DynamicModule", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"x", " ", "=", " ", "Pink"}], "}"}], ",", "\n", " ", 
   RowBox[{"Row", "[", 
    RowBox[{"{", "\n", "   ", 
     RowBox[{
      RowBox[{"Dynamic", "@", 
       RowBox[{"Style", "[", 
        RowBox[{"\"\<Hello\>\"", ",", " ", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"MouseAnnotation", "[", "]"}], " ", "===", " ", "1"}], 
           ",", " ", 
           RowBox[{
            RowBox[{"x", " ", "=", " ", "Green"}], ";", " ", "Blue"}], ",", 
           " ", "x"}], "]"}]}], "]"}]}], ",", "\n", "   ", 
      RowBox[{"Annotation", "[", 
       RowBox[{"\"\<World\>\"", ",", " ", "1", ",", " ", "\"\<Mouse\>\""}], 
       "]"}]}], "\n", " ", "}"}], "]"}]}], "\n", "]"}]], "Input",
 CellChangeTimes->{{3.8261087951086917`*^9, 3.8261087951126347`*^9}},
 CellLabel->"In[37]:=",ExpressionUUID->"716b24e0-1646-4874-b895-73b790c69eb9"],

Cell[BoxData[
 DynamicModuleBox[{$CellContext`x$$ = RGBColor[0, 1, 0]}, 
  TemplateBox[{
    DynamicBox[
     ToBoxes[
      Style["Hello", 
       If[
       MouseAnnotation[] === 1, $CellContext`x$$ = Green; 
        Blue, $CellContext`x$$]], StandardForm]], 
    TagBox["\"World\"", Annotation[#, 1, "Mouse"]& ]},
   "RowDefault"],
  DynamicModuleValues:>{}]], "Output",
 CellChangeTimes->{3.8261087961887474`*^9, 3.826109804211634*^9},
 CellLabel->"Out[37]=",ExpressionUUID->"b84ff5c1-4f58-4697-aebf-5e7745c415d2"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}, Open  ]]
},
WindowSize->{750.9, 529.8},
WindowMargins->{{Automatic, 184.20000000000005`}, {
  Automatic, 13.799999999999999`}},
InputAliases->{"intt" -> RowBox[{"\[Integral]", 
     RowBox[{"\[SelectionPlaceholder]", 
       RowBox[{"\[DifferentialD]", "\[Placeholder]"}]}]}], "dintt" -> RowBox[{
     SubsuperscriptBox[
     "\[Integral]", "\[SelectionPlaceholder]", "\[Placeholder]"], 
     RowBox[{"\[Placeholder]", 
       RowBox[{"\[DifferentialD]", "\[Placeholder]"}]}]}], "rintt" -> RowBox[{
     UnderscriptBox["\[Integral]", 
      RowBox[{"\[SelectionPlaceholder]", "\[Element]", "\[Placeholder]"}]], 
     "\[Placeholder]"}], "sumt" -> RowBox[{
     UnderoverscriptBox["\[Sum]", 
      RowBox[{"\[SelectionPlaceholder]", "=", "\[Placeholder]"}], 
      "\[Placeholder]"], "\[Placeholder]"}], "prodt" -> RowBox[{
     UnderoverscriptBox["\[Product]", 
      RowBox[{"\[SelectionPlaceholder]", "=", "\[Placeholder]"}], 
      "\[Placeholder]"], "\[Placeholder]"}], "dt" -> RowBox[{
     SubscriptBox["\[PartialD]", "\[Placeholder]"], " ", 
     "\[SelectionPlaceholder]"}], "cbrt" -> 
  RadicalBox[
   "\[SelectionPlaceholder]", "3", SurdForm -> True, MultilineFunction -> 
    None], "surd" -> 
  RadicalBox[
   "\[SelectionPlaceholder]", "\[Placeholder]", SurdForm -> True, 
    MultilineFunction -> None], "ket" -> 
  TemplateBox[{"\[SelectionPlaceholder]"}, "Ket"], "bra" -> 
  TemplateBox[{"\[SelectionPlaceholder]"}, "Bra"], "braket" -> 
  TemplateBox[{"\[SelectionPlaceholder]", "\[Placeholder]"}, "BraKet"], 
  "delay" -> TemplateBox[{"\[SelectionPlaceholder]"}, "SystemsModelDelay"], 
  "grad" -> RowBox[{
     SubscriptBox["\[Del]", "\[SelectionPlaceholder]"], "\[Placeholder]"}], 
  "del." -> RowBox[{
     SubscriptBox["\[Del]", "\[SelectionPlaceholder]"], ".", 
     "\[Placeholder]"}], "delx" -> RowBox[{
     SubscriptBox["\[Del]", "\[SelectionPlaceholder]"], "\[Cross]", 
     "\[Placeholder]"}], "del2" -> RowBox[{
     SubsuperscriptBox["\[Del]", "\[SelectionPlaceholder]", 2], 
     "\[Placeholder]"}], "kd" -> 
  TemplateBox[{"\[SelectionPlaceholder]"}, "KroneckerDeltaSeq"], "algs" -> 
  TemplateBox[{}, "Algebraics"], "bools" -> TemplateBox[{}, "Booleans"], 
  "comps" -> TemplateBox[{}, "Complexes"], "ints" -> 
  TemplateBox[{}, "Integers"], "pris" -> TemplateBox[{}, "Primes"], "rats" -> 
  TemplateBox[{}, "Rationals"], "reals" -> TemplateBox[{}, "Reals"], "dlim" -> 
  RowBox[{
     UnderscriptBox["\[Limit]", 
      RowBox[{"\[SelectionPlaceholder]", 
        UnderscriptBox["\[Rule]", 
         TemplateBox[{}, "Integers"]], "\[Infinity]"}]], "\[Placeholder]"}], 
  "dMlim" -> RowBox[{
     UnderscriptBox["\[MaxLimit]", 
      RowBox[{"\[SelectionPlaceholder]", 
        UnderscriptBox["\[Rule]", 
         TemplateBox[{}, "Integers"]], "\[Infinity]"}]], "\[Placeholder]"}], 
  "dmlim" -> RowBox[{
     UnderscriptBox["\[MinLimit]", 
      RowBox[{"\[SelectionPlaceholder]", 
        UnderscriptBox["\[Rule]", 
         TemplateBox[{}, "Integers"]], "\[Infinity]"}]], "\[Placeholder]"}], 
  "notation" -> RowBox[{"Notation", "[", 
     RowBox[{
       TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
       "\[DoubleLongLeftRightArrow]", " ", 
       TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
  "notation>" -> RowBox[{"Notation", "[", 
     RowBox[{
       TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
       "\[DoubleLongRightArrow]", " ", 
       TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
  "notation<" -> RowBox[{"Notation", "[", 
     RowBox[{
       TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
       "\[DoubleLongLeftArrow]", " ", 
       TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
  "symb" -> RowBox[{"Symbolize", "[", 
     TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
  "infixnotation" -> RowBox[{"InfixNotation", "[", 
     RowBox[{
       TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
       "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
     RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
       TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
  "pattwraper" -> 
  TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
  "madeboxeswraper" -> 
  TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"], "lu" -> 
  TemplateBox[{"\[SelectionPlaceholder]", "\[SelectionPlaceholder]"}, 
    "SpinorLaUp", DisplayFunction -> (RowBox[{
       SuperscriptBox["\[Lambda]", #2], "[", #, "]"}]& ), 
    InterpretationFunction -> (
     RowBox[{"SpinorUndot", "[", #, "]", "[", "$lam", "]", "[", #2, "]", "[", 
       "Null", "]"}]& )], "ld" -> 
  TemplateBox[{"\[SelectionPlaceholder]", "\[SelectionPlaceholder]"}, 
    "SpinorLaDown", DisplayFunction -> (RowBox[{
       SubscriptBox["\[Lambda]", #2], "[", #, "]"}]& ), 
    InterpretationFunction -> (
     RowBox[{"SpinorUndot", "[", #, "]", "[", "$lam", "]", "[", "Null", "]", 
       "[", #2, "]"}]& )], "muu" -> 
  TemplateBox[{"\[SelectionPlaceholder]", "\[SelectionPlaceholder]"}, 
    "SpinorMuUp", DisplayFunction -> (RowBox[{
       SuperscriptBox["\[Mu]", #2], "[", #, "]"}]& ), 
    InterpretationFunction -> (
     RowBox[{"SpinorUndot", "[", #, "]", "[", "$mu", "]", "[", #2, "]", "[", 
       "Null", "]"}]& )], "mud" -> 
  TemplateBox[{"\[SelectionPlaceholder]", "\[SelectionPlaceholder]"}, 
    "SpinorMuDown", DisplayFunction -> (RowBox[{
       SubscriptBox["\[Mu]", #2], "[", #, "]"}]& ), 
    InterpretationFunction -> (
     RowBox[{"SpinorUndot", "[", #, "]", "[", "$mu", "]", "[", "Null", "]", 
       "[", #2, "]"}]& )], "lp" -> 
  TemplateBox[{"\[SelectionPlaceholder]"}, "SpinorUndotBareL", 
    DisplayFunction -> (RowBox[{"\[Lambda]", "[", #, "]"}]& ), 
    InterpretationFunction -> (
     RowBox[{"SpinorUndotBare", "[", #, "]", "[", "$lam", "]"}]& )], "mp" -> 
  TemplateBox[{"\[SelectionPlaceholder]"}, "SpinorUndotBareM", 
    DisplayFunction -> (RowBox[{"\[Mu]", "[", #, "]"}]& ), 
    InterpretationFunction -> (
     RowBox[{"SpinorUndotBare", "[", #, "]", "[", "$mu", "]"}]& )], "ltu" -> 
  TemplateBox[{"\[SelectionPlaceholder]", "\[SelectionPlaceholder]"}, 
    "SpinorLatUp", DisplayFunction -> (RowBox[{
       SuperscriptBox[
        OverscriptBox["\[Lambda]", "~"], #2], "[", #, "]"}]& ), 
    InterpretationFunction -> (
     RowBox[{"SpinorDot", "[", #, "]", "[", "$lam", "]", "[", #2, "]", "[", 
       "Null", "]"}]& )], "ltd" -> 
  TemplateBox[{"\[SelectionPlaceholder]", "\[SelectionPlaceholder]"}, 
    "SpinorLatDown", DisplayFunction -> (RowBox[{
       SubscriptBox[
        OverscriptBox["\[Lambda]", "~"], #2], "[", #, "]"}]& ), 
    InterpretationFunction -> (
     RowBox[{"SpinorDot", "[", #, "]", "[", "$lam", "]", "[", "Null", "]", 
       "[", #2, "]"}]& )], "mtu" -> 
  TemplateBox[{"\[SelectionPlaceholder]", "\[SelectionPlaceholder]"}, 
    "SpinorMutUp", DisplayFunction -> (RowBox[{
       SuperscriptBox[
        OverscriptBox["\[Mu]", "~"], #2], "[", #, "]"}]& ), 
    InterpretationFunction -> (
     RowBox[{"SpinorDot", "[", #, "]", "[", "$mu", "]", "[", #2, "]", "[", 
       "Null", "]"}]& )], "mtd" -> 
  TemplateBox[{"\[SelectionPlaceholder]", "\[SelectionPlaceholder]"}, 
    "SpinorMutDown", DisplayFunction -> (RowBox[{
       SubscriptBox[
        OverscriptBox["\[Mu]", "~"], #2], "[", #, "]"}]& ), 
    InterpretationFunction -> (
     RowBox[{"SpinorDot", "[", #, "]", "[", "$mu", "]", "[", "Null", "]", 
       "[", #2, "]"}]& )], "ltp" -> 
  TemplateBox[{"\[SelectionPlaceholder]"}, "SpinorDotBareL", 
    DisplayFunction -> (RowBox[{
       OverscriptBox["\[Lambda]", "~"], "[", #, "]"}]& ), 
    InterpretationFunction -> (
     RowBox[{"SpinorDotBare", "[", #, "]", "[", "$lam", "]"}]& )], "mtp" -> 
  TemplateBox[{"\[SelectionPlaceholder]"}, "SpinorDotBareM", 
    DisplayFunction -> (RowBox[{
       OverscriptBox["\[Mu]", "~"], "[", #, "]"}]& ), 
    InterpretationFunction -> (
     RowBox[{"SpinorDotBare", "[", #, "]", "[", "$mu", "]"}]& )], "ab" -> 
  TemplateBox[{"\[SelectionPlaceholder]", "\[Placeholder]"}, 
    "SpinorAngleBracket", DisplayFunction -> (RowBox[{"\[LeftAngleBracket]", 
       RowBox[{#, "\[MediumSpace]", #2}], "\[RightAngleBracket]"}]& ), 
    InterpretationFunction -> (RowBox[{"SpinorAngleBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], "sb" -> 
  TemplateBox[{"\[SelectionPlaceholder]", "\[Placeholder]"}, 
    "SpinorSquareBracket", DisplayFunction -> (RowBox[{"[", 
       RowBox[{#, "\[MediumSpace]", #2}], "]"}]& ), 
    InterpretationFunction -> (RowBox[{"SpinorSquareBracket", "[", 
       RowBox[{#, ",", #2}], "]"}]& )], "cas" -> 
  TemplateBox[{"\[SelectionPlaceholder]", 
     RowBox[{"{", "\[SelectionPlaceholder]", "}"}], 
     "\[SelectionPlaceholder]"}, "AngleSquareChain", 
    DisplayFunction -> (RowBox[{"\[LeftAngleBracket]", #, #2, #3, "]"}]& ), 
    InterpretationFunction -> (
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$square",
        "]"}]& )], "csa" -> TemplateBox[{"\[SelectionPlaceholder]", 
     RowBox[{"{", "\[SelectionPlaceholder]", "}"}], 
     "\[SelectionPlaceholder]"}, "SquareAngleChain", 
    DisplayFunction -> (RowBox[{"[", #, #2, #3, "\[RightAngleBracket]"}]& ), 
    InterpretationFunction -> (
     RowBox[{"Chain", "[", "$square", ",", #, ",", #2, ",", #3, ",", "$angle",
        "]"}]& )], "caa" -> TemplateBox[{"\[SelectionPlaceholder]", 
     RowBox[{"{", "\[SelectionPlaceholder]", "}"}], 
     "\[SelectionPlaceholder]"}, "AngleAngleChain", 
    DisplayFunction -> (
     RowBox[{"\[LeftAngleBracket]", #, #2, #3, "\[RightAngleBracket]"}]& ), 
    InterpretationFunction -> (
     RowBox[{"Chain", "[", "$angle", ",", #, ",", #2, ",", #3, ",", "$angle", 
       "]"}]& )], "css" -> TemplateBox[{"\[SelectionPlaceholder]", 
     RowBox[{"{", "\[SelectionPlaceholder]", "}"}], 
     "\[SelectionPlaceholder]"}, "SquareSquareChain", 
    DisplayFunction -> (RowBox[{"[", #, #2, #3, "]"}]& ), 
    InterpretationFunction -> (
     RowBox[{"Chain", "[", "$square", ",", #, ",", #2, ",", #3, ",", 
       "$square", "]"}]& )], "lcup" -> 
  TemplateBox[{"\[SelectionPlaceholder]", "\[SelectionPlaceholder]"}, 
    "LevicivitaSHUp", DisplayFunction -> (SuperscriptBox["\[Epsilon]", 
      RowBox[{#, #2}]]& ), 
    InterpretationFunction -> (
     RowBox[{"LeviCivitaSH", "[", #, ",", #2, "]", "[", "$up", "]"}]& )], 
  "lcd" -> TemplateBox[{"\[SelectionPlaceholder]", "\[SelectionPlaceholder]"},
     "LevicivitaSHDown", DisplayFunction -> (SubscriptBox["\[Epsilon]", 
      RowBox[{#, #2}]]& ), 
    InterpretationFunction -> (
     RowBox[{"LeviCivitaSH", "[", #, ",", #2, "]", "[", "$down", "]"}]& )]},
Magnification:>0.9 Inherited,
FrontEndVersion->"12.2 for Microsoft Windows (64-bit) (December 12, 2020)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"e56b505b-49e8-4a2e-ae52-0e91b9fc1d69"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 208, 3, 25, "Input",ExpressionUUID->"506cb47d-39ed-4a38-898a-605bf6517c76"],
Cell[CellGroupData[{
Cell[813, 29, 497, 9, 19, "Print",ExpressionUUID->"0fb71339-63a4-41d5-8404-70391e363404"],
Cell[1313, 40, 485, 8, 19, "Print",ExpressionUUID->"f4e99b36-8555-4ee5-bb2c-9c81bface823"],
Cell[1801, 50, 473, 8, 19, "Print",ExpressionUUID->"ad3cf54d-a4a4-4c5b-b5ed-9afc03a244c9"],
Cell[2277, 60, 478, 8, 19, "Print",ExpressionUUID->"bbc260b7-1a6d-4c00-bffa-bee66dcc46d3"],
Cell[2758, 70, 484, 8, 19, "Print",ExpressionUUID->"98b3b544-0fac-4645-8cbf-0af9815382aa"],
Cell[3245, 80, 559, 12, 22, "Print",ExpressionUUID->"878b7500-e788-44a1-800f-4ed127843cfd"],
Cell[3807, 94, 495, 8, 19, "Print",ExpressionUUID->"1e769453-da0e-49b8-bb0b-92c4d3a05fda"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[4351, 108, 163, 3, 48, "Subsection",ExpressionUUID->"9f319fe4-d15e-446d-b3e6-d4eda036544d"],
Cell[4517, 113, 29225, 743, 1297, "Code",ExpressionUUID->"b5811434-59f5-462a-8a1d-040f2559a2ef"]
}, Closed]],
Cell[CellGroupData[{
Cell[33779, 861, 286, 6, 34, "Subsection",ExpressionUUID->"02045f03-8150-4912-bbef-fdc457ed31ae"],
Cell[34068, 869, 617, 14, 43, "Input",ExpressionUUID->"903ecb15-a75d-494c-95e1-8e9621543c61"],
Cell[34688, 885, 305, 7, 25, "Input",ExpressionUUID->"42d86ccd-58b6-466e-88b8-00a66467eddf"],
Cell[34996, 894, 32291, 772, 2182, "Input",ExpressionUUID->"f7de764f-1974-4378-a779-6fbdd1a36778"],
Cell[67290, 1668, 215, 5, 25, "Input",ExpressionUUID->"5be9a473-686a-4fec-a99d-725b7f0842dc"],
Cell[CellGroupData[{
Cell[67530, 1677, 3451, 79, 43, "Input",ExpressionUUID->"bff91f32-56c0-4fd9-876b-c4c56ef5d5e9"],
Cell[70984, 1758, 336, 6, 29, "Output",ExpressionUUID->"9c846ba2-6c33-46f4-90b7-c6b8f4513485"],
Cell[71323, 1766, 336, 6, 29, "Output",ExpressionUUID->"e5c4b270-bd4a-42db-8cb5-64c7a0859713"]
}, Open  ]],
Cell[71674, 1775, 467, 10, 43, "Input",ExpressionUUID->"342ed152-5aca-4f84-b7a9-7ef3dafb2ac8"]
}, Closed]],
Cell[CellGroupData[{
Cell[72178, 1790, 157, 3, 34, "Subsection",ExpressionUUID->"087e8b18-ee52-4e35-b97b-505caf757186"],
Cell[CellGroupData[{
Cell[72360, 1797, 1459, 33, 25, "Input",ExpressionUUID->"00e2790c-fc8b-4ba1-99b0-4f7d3f93ceac"],
Cell[73822, 1832, 470, 11, 29, "Output",ExpressionUUID->"c21544d1-9ee0-43ab-a95b-4bb1144262c2"]
}, Open  ]],
Cell[CellGroupData[{
Cell[74329, 1848, 2765, 62, 47, "Input",ExpressionUUID->"40b49974-2be4-4ab2-84c4-7428f32afa09"],
Cell[77097, 1912, 2745, 62, 50, "Output",ExpressionUUID->"cce3051c-126a-4174-8b75-2c8ebc7403ea"]
}, Open  ]],
Cell[CellGroupData[{
Cell[79879, 1979, 212, 4, 25, "Input",ExpressionUUID->"3b8f27a4-6d6b-453a-99df-61d6792d7f51"],
Cell[80094, 1985, 1766, 41, 49, "Output",ExpressionUUID->"a5680ad4-b1c2-4666-b49f-65eee4090276"]
}, Open  ]],
Cell[CellGroupData[{
Cell[81897, 2031, 214, 4, 25, "Input",ExpressionUUID->"b18b8014-5b6b-43bf-af43-683919eb30e3"],
Cell[82114, 2037, 2194, 49, 49, "Output",ExpressionUUID->"c42d3971-3f00-4b6c-a906-f218c4a5cd59"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[84357, 2092, 162, 3, 34, "Subsection",ExpressionUUID->"4639e365-1b27-4556-ac7b-1973d0f7f38c"],
Cell[CellGroupData[{
Cell[84544, 2099, 1567, 35, 24, "Input",ExpressionUUID->"5c10abe9-dd0d-4049-bda5-d22927182a75"],
Cell[86114, 2136, 1514, 34, 28, "Output",ExpressionUUID->"24d629f7-3372-4bfe-aba8-6635e8c8c781"]
}, Open  ]],
Cell[CellGroupData[{
Cell[87665, 2175, 236, 4, 39, "Subsubsection",ExpressionUUID->"6307244f-0d9c-4f78-9596-f6ab2026485c"],
Cell[87904, 2181, 1242, 36, 94, "Input",ExpressionUUID->"c69d2502-bbc4-4a62-a322-3c95ac2f8b11"],
Cell[89149, 2219, 786, 15, 60, "Input",ExpressionUUID->"9c6dc402-8b7f-409a-a0bf-f68d54b48b47"],
Cell[89938, 2236, 314, 7, 24, "Input",ExpressionUUID->"3227516f-4df5-4de4-a9a9-037a37952cbf"],
Cell[CellGroupData[{
Cell[90277, 2247, 1634, 36, 24, "Input",ExpressionUUID->"98707538-178f-417f-b529-bcb492c4aa9b"],
Cell[91914, 2285, 1539, 34, 28, "Output",ExpressionUUID->"4623f3a3-df96-41f4-b5e0-2d7725c969d3"]
}, Open  ]],
Cell[CellGroupData[{
Cell[93490, 2324, 5469, 133, 456, "Input",ExpressionUUID->"51703f57-3f3c-4265-9d0c-4c567bd8f352"],
Cell[CellGroupData[{
Cell[98984, 2461, 1371, 29, 249, "Echo",ExpressionUUID->"f91d3e45-d755-4361-a0e8-739660614e06"],
Cell[100358, 2492, 203, 5, 21, "Echo",ExpressionUUID->"cc23bbf7-ad08-4848-965f-34821304a783"]
}, Open  ]],
Cell[100576, 2500, 3489, 69, 257, "Output",ExpressionUUID->"132b1441-3ab0-44d7-9fe3-11a02f4a4d3e"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[104114, 2575, 168, 3, 32, "Subsubsection",ExpressionUUID->"912249ee-fc72-4ed0-ab86-cff0394ddc94"],
Cell[CellGroupData[{
Cell[104307, 2582, 3779, 91, 387, "Input",ExpressionUUID->"af5f0a87-f30f-47ac-9370-1b3f2b346e9d"],
Cell[CellGroupData[{
Cell[108111, 2677, 603, 16, 20, "Echo",ExpressionUUID->"1cad9b93-0c47-4b76-b9ef-63f6e056002a"],
Cell[108717, 2695, 1371, 29, 249, "Echo",ExpressionUUID->"3c9b4830-f3ac-41fd-9fa7-e5523fb63016"]
}, Open  ]],
Cell[110103, 2727, 478, 13, 27, "Output",ExpressionUUID->"f1ba2773-1ccf-4122-a5d3-b740a9246d84"]
}, Open  ]],
Cell[CellGroupData[{
Cell[110618, 2745, 954, 26, 59, "Input",ExpressionUUID->"0cbe7b52-8257-4376-95b1-c7e7a7c56614"],
Cell[111575, 2773, 11784, 239, 288, "Output",ExpressionUUID->"6dec06d3-89d7-45f3-9b76-3e3f5f89cafd"]
}, Open  ]],
Cell[CellGroupData[{
Cell[123396, 3017, 997, 27, 59, "Input",ExpressionUUID->"ba7427e0-13d9-499c-b82d-17ca9eaac853"],
Cell[124396, 3046, 5761, 137, 246, "Output",ExpressionUUID->"4a13cd87-d37c-4dd3-b3a2-6f2183b44884"]
}, Open  ]],
Cell[CellGroupData[{
Cell[130194, 3188, 338, 6, 24, "Input",ExpressionUUID->"55e1fa99-7819-4cf7-be8c-bdbee147eaac"],
Cell[130535, 3196, 673, 18, 27, "Output",ExpressionUUID->"4daf376b-92cd-4d57-a8fb-7a25163bbc43"]
}, Open  ]],
Cell[CellGroupData[{
Cell[131245, 3219, 248, 4, 24, "Input",ExpressionUUID->"c6145724-4aa6-4f93-9600-9ec95cbfcf06"],
Cell[131496, 3225, 456, 13, 27, "Output",ExpressionUUID->"1813f673-1e6b-4e48-8147-e229636765f4"]
}, Open  ]],
Cell[CellGroupData[{
Cell[131989, 3243, 307, 6, 24, "Input",ExpressionUUID->"23f72dc8-57fb-412b-847e-ba12062d4603"],
Cell[132299, 3251, 454, 13, 27, "Output",ExpressionUUID->"031d82c9-e8c5-471e-86c2-be41ca357d35"]
}, Open  ]],
Cell[CellGroupData[{
Cell[132790, 3269, 568, 15, 42, "Input",ExpressionUUID->"f9256f8b-c36a-4d85-a45e-462ed8c55f5f"],
Cell[133361, 3286, 1891, 59, 63, "Output",ExpressionUUID->"b37f0950-dbe1-47e1-afe0-bcd771d1ebd2"]
}, Open  ]],
Cell[CellGroupData[{
Cell[135289, 3350, 230, 3, 24, "Input",ExpressionUUID->"c7a79331-08a9-47f1-a690-f6ca8a81972a"],
Cell[135522, 3355, 168, 3, 27, "Output",ExpressionUUID->"929dccdd-58b6-40b8-be53-0719fbca76c3"]
}, Open  ]],
Cell[CellGroupData[{
Cell[135727, 3363, 337, 7, 24, "Input",ExpressionUUID->"ba94c573-dba9-4526-b350-bdd4b40ff2d6"],
Cell[136067, 3372, 797, 23, 99, "Output",ExpressionUUID->"ffef1553-f6ae-44e9-899b-0f1a1157c5cb"]
}, Open  ]],
Cell[CellGroupData[{
Cell[136901, 3400, 346, 8, 24, "Input",ExpressionUUID->"b4212992-f5ed-47f0-a267-ca216df77dc9"],
Cell[137250, 3410, 176, 2, 27, "Output",ExpressionUUID->"c57672ee-57ee-43bc-ad0a-86c1971239ad"]
}, Open  ]],
Cell[CellGroupData[{
Cell[137463, 3417, 285, 6, 24, "Input",ExpressionUUID->"b4c36b18-6cad-4f26-8332-93108dcbbb9b"],
Cell[137751, 3425, 470, 11, 27, "Output",ExpressionUUID->"a9c1819f-c761-4549-aaa3-1e05b38a440a"]
}, Open  ]],
Cell[CellGroupData[{
Cell[138258, 3441, 296, 5, 24, "Input",ExpressionUUID->"2a9c5a6e-0ad8-405b-ac05-d99506333af0"],
Cell[138557, 3448, 1964, 36, 262, "Output",ExpressionUUID->"75f08936-97cc-4a7f-9168-6e73fa40e25a"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[140570, 3490, 164, 3, 32, "Subsubsection",ExpressionUUID->"7492f296-7fec-4e4a-bd74-debbda1683b0"],
Cell[CellGroupData[{
Cell[140759, 3497, 6154, 122, 489, "Input",ExpressionUUID->"0399fcfc-8836-4525-ae74-153f9da49bc4"],
Cell[146916, 3621, 4864, 113, 45, "Output",ExpressionUUID->"f4d826a4-5c1f-47cc-9bc1-d43d57d261e8"]
}, Open  ]],
Cell[151795, 3737, 1318, 40, 93, "Input",ExpressionUUID->"d636984d-00c9-4589-bc6a-fcb5dc25d27d"],
Cell[CellGroupData[{
Cell[153138, 3781, 438, 12, 24, "Input",ExpressionUUID->"ab71000f-b0d9-4454-8cb4-f2f31fc98e9d"],
Cell[153579, 3795, 506, 16, 27, "Output",ExpressionUUID->"fd55b94e-f1f7-479f-94cb-c1bd1998a97e"]
}, Open  ]],
Cell[CellGroupData[{
Cell[154122, 3816, 359, 7, 93, "Input",ExpressionUUID->"2977a116-b1aa-4785-9339-41aa2fa0074d"],
Cell[154484, 3825, 151, 2, 27, "Output",ExpressionUUID->"8aa86add-49db-4d96-a7cd-c6bd389d3395"]
}, Open  ]],
Cell[CellGroupData[{
Cell[154672, 3832, 469, 11, 93, "Input",ExpressionUUID->"c9edb925-f131-48ab-933e-a930d863b390"],
Cell[155144, 3845, 216, 4, 27, "Output",ExpressionUUID->"26556fbe-50f2-4801-8556-185850b0e61d"]
}, Open  ]],
Cell[CellGroupData[{
Cell[155397, 3854, 5600, 116, 405, "Input",ExpressionUUID->"81fa904d-2fd0-4a4a-b982-29a007b78313"],
Cell[CellGroupData[{
Cell[161022, 3974, 4035, 93, 36, "Echo",ExpressionUUID->"f611ebf3-5b12-4c5e-99ec-1e1670463b33"],
Cell[165060, 4069, 334, 10, 20, "Echo",ExpressionUUID->"ed373433-3758-41ae-83fd-d7a3909cb381"],
Cell[165397, 4081, 1569, 53, 36, "Echo",ExpressionUUID->"026e2f3a-317c-421f-84e3-cf78c66ee8a3"]
}, Open  ]],
Cell[166981, 4137, 1899, 59, 45, "Output",ExpressionUUID->"bb856093-e364-42f9-9406-40e5616ffbe9"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[168929, 4202, 175, 3, 32, "Subsubsection",ExpressionUUID->"c83b9bc8-a889-43db-b670-8aef81875226"],
Cell[169107, 4207, 411, 9, 42, "Input",ExpressionUUID->"66da2c89-867b-4535-b1a4-c325a408131b"],
Cell[169521, 4218, 619, 14, 42, "Input",ExpressionUUID->"37f5f5a3-5ebf-4f62-a618-0525010afe2f"],
Cell[170143, 4234, 862, 20, 42, "Input",ExpressionUUID->"79721707-eb73-40b9-a830-995d55f3d369"],
Cell[CellGroupData[{
Cell[171030, 4258, 807, 18, 24, "Input",ExpressionUUID->"996b7989-76e6-4183-873d-58212c93e04c"],
Cell[171840, 4278, 227, 4, 27, "Output",ExpressionUUID->"3f2af635-7f27-4a15-906f-e3ae1f44c762"]
}, Open  ]],
Cell[CellGroupData[{
Cell[172104, 4287, 862, 20, 24, "Input",ExpressionUUID->"33c4c1ec-2c72-4db9-82a6-da91682611b2"],
Cell[172969, 4309, 248, 5, 30, "Output",ExpressionUUID->"f76af337-ca56-4379-a2d2-01156f7cc90a"]
}, Open  ]],
Cell[CellGroupData[{
Cell[173254, 4319, 4578, 95, 351, "Input",ExpressionUUID->"be5312eb-5d8c-42c2-bc48-e0bd48051e5d"],
Cell[CellGroupData[{
Cell[177857, 4418, 603, 16, 20, "Echo",ExpressionUUID->"16fa7437-c8df-49ff-9201-d9c532351125"],
Cell[178463, 4436, 4893, 88, 315, "Echo",ExpressionUUID->"966da4b3-37c4-41c0-b33c-6072a09cf28a"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[183405, 4530, 909, 21, 59, "Input",ExpressionUUID->"f7240d0c-ddaa-4c74-8af0-529670ab2d75"],
Cell[184317, 4553, 7806, 152, 319, "Output",ExpressionUUID->"c13a2e76-a508-4d52-ab7d-2b4bbf05e239"]
}, Open  ]],
Cell[CellGroupData[{
Cell[192160, 4710, 267, 6, 24, "Input",ExpressionUUID->"f46d6d15-b804-4dbf-8509-288290b2364e"],
Cell[192430, 4718, 650, 16, 27, "Output",ExpressionUUID->"4ba6560b-fb44-44a5-86cd-4918e3ddba9a"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[193129, 4740, 162, 3, 32, "Subsubsection",ExpressionUUID->"de860586-2cb6-41d1-acb6-ed069be5e8af"],
Cell[193294, 4745, 858, 19, 42, "Input",ExpressionUUID->"424c7295-37e3-41a5-b5ff-d3b004cdb64d"],
Cell[194155, 4766, 723, 15, 60, "Input",ExpressionUUID->"34940c78-0672-462d-b43e-649f9bc10ff5"],
Cell[194881, 4783, 660, 17, 42, "Input",ExpressionUUID->"914dd246-b2c7-4d65-b69b-e05bb3654750"],
Cell[195544, 4802, 1063, 18, 77, "Input",ExpressionUUID->"6da8ceea-beb8-487a-8446-a584ecae7714"],
Cell[196610, 4822, 1756, 46, 95, "Input",ExpressionUUID->"fa28bb1f-6886-4a2c-a696-2016b74652e3"],
Cell[CellGroupData[{
Cell[198391, 4872, 5864, 133, 474, "Input",ExpressionUUID->"9e257902-84b3-4683-bd15-1cc52d2d6339"],
Cell[CellGroupData[{
Cell[204280, 5009, 611, 21, 21, "Echo",ExpressionUUID->"5af38f11-61ef-40a5-b8cf-de6286959677"],
Cell[204894, 5032, 939, 33, 21, "Echo",ExpressionUUID->"9b30e6f1-cc03-4608-b773-6c35f9168de7"]
}, Open  ]],
Cell[205848, 5068, 2102, 66, 46, "Output",ExpressionUUID->"6555ec82-b4f7-43dc-bed6-69abdff1bd76"]
}, Open  ]],
Cell[CellGroupData[{
Cell[207987, 5139, 292, 6, 24, "Input",ExpressionUUID->"e7f54559-4c53-499a-8848-0accc6cb9773"],
Cell[208282, 5147, 383, 10, 28, "Output",ExpressionUUID->"cd02e435-618c-4ea4-a0f1-c91542941c8b"]
}, Open  ]],
Cell[CellGroupData[{
Cell[208702, 5162, 921, 28, 42, "Input",ExpressionUUID->"89635a87-a60e-40f0-a0cb-ac768243d94c"],
Cell[209626, 5192, 681, 21, 32, "Output",ExpressionUUID->"59372551-d8d1-4191-8781-52364b6b0b9e"]
}, Open  ]],
Cell[CellGroupData[{
Cell[210344, 5218, 928, 28, 42, "Input",ExpressionUUID->"159f63dd-cb26-4b39-a278-30901e037bfa"],
Cell[211275, 5248, 654, 20, 28, "Output",ExpressionUUID->"765c0dbe-bf2a-4cfd-9409-cf6c73b838bb"]
}, Open  ]],
Cell[211944, 5271, 239, 5, 24, "Input",ExpressionUUID->"76043a0c-1fbe-4be2-84ae-142a64b6154e"],
Cell[CellGroupData[{
Cell[212208, 5280, 1056, 35, 24, "Input",ExpressionUUID->"0fa0fbbb-f430-45b6-885d-5cb1c69cd2bb"],
Cell[213267, 5317, 1778, 61, 46, "Output",ExpressionUUID->"2281ac4e-b53b-49ca-91a4-05ecc8e7a680"]
}, Open  ]],
Cell[CellGroupData[{
Cell[215082, 5383, 181, 3, 24, "Input",ExpressionUUID->"5d01a676-f252-4464-9c07-ef9288225849"],
Cell[215266, 5388, 1517, 35, 28, "Output",ExpressionUUID->"58dc5d5d-191d-42ca-a971-5803e178a2d7"]
}, Open  ]],
Cell[CellGroupData[{
Cell[216820, 5428, 1300, 41, 42, "Input",ExpressionUUID->"63354793-4a39-4f37-aa9c-0529a0889ded"],
Cell[218123, 5471, 609, 18, 28, "Output",ExpressionUUID->"4fdcf6e5-4fe1-4f93-889f-2ed0eb332cfe"]
}, Open  ]],
Cell[CellGroupData[{
Cell[218769, 5494, 1448, 45, 42, "Input",ExpressionUUID->"003a66d2-b4c8-48d5-8725-92245b44fd07"],
Cell[220220, 5541, 622, 18, 32, "Output",ExpressionUUID->"9f0be8fa-f5aa-477c-b141-adb716489698"]
}, Open  ]],
Cell[CellGroupData[{
Cell[220879, 5564, 1497, 47, 42, "Input",ExpressionUUID->"84f2f7ba-5ff1-4697-af4b-117cd9974405"],
Cell[222379, 5613, 609, 18, 32, "Output",ExpressionUUID->"f7d89159-cb86-427e-a109-3c6c29e9c8c9"]
}, Open  ]],
Cell[CellGroupData[{
Cell[223025, 5636, 1610, 50, 42, "Input",ExpressionUUID->"85894413-1be8-4cfe-ade6-d07e5a5b7713"],
Cell[224638, 5688, 372, 10, 28, "Output",ExpressionUUID->"eb013b74-137c-4055-b27b-9004a92331cd"]
}, Open  ]],
Cell[CellGroupData[{
Cell[225047, 5703, 1790, 57, 60, "Input",ExpressionUUID->"cb53338c-8231-4dfd-954e-22a1e61b5a41"],
Cell[226840, 5762, 349, 9, 28, "Output",ExpressionUUID->"a9fbd3e2-3683-4401-acb1-8e4ccb21d6a6"]
}, Open  ]],
Cell[CellGroupData[{
Cell[227226, 5776, 1172, 38, 42, "Input",ExpressionUUID->"ec5eb01c-64f5-4110-8138-28e63ac8806e"],
Cell[228401, 5816, 845, 28, 28, "Output",ExpressionUUID->"9698f1a3-bb6c-4774-b534-05a1b710f398"]
}, Open  ]],
Cell[CellGroupData[{
Cell[229283, 5849, 2233, 66, 77, "Input",ExpressionUUID->"1dc08f35-a252-49db-b6ff-70423b06a875"],
Cell[231519, 5917, 665, 18, 28, "Output",ExpressionUUID->"62f74efb-17ed-4a33-8c1b-02d02fc3d159"]
}, Open  ]],
Cell[232199, 5938, 1194, 33, 60, "Input",ExpressionUUID->"14637ad8-abe3-4eaa-ae63-67794bc30e80"],
Cell[233396, 5973, 222, 5, 24, "Input",ExpressionUUID->"bc001efb-ae95-421a-a715-1ca4858ecab0"],
Cell[233621, 5980, 895, 31, 24, "Input",ExpressionUUID->"9edb1ad8-a3f2-45d4-92d2-31f08e66eb81"],
Cell[234519, 6013, 672, 17, 24, "Input",ExpressionUUID->"2dc3eeb3-74b6-43ee-8e61-53646af4bffa"],
Cell[CellGroupData[{
Cell[235216, 6034, 574, 18, 24, "Input",ExpressionUUID->"5d30cf46-dbee-45f7-8d90-b03f998ea3f3"],
Cell[235793, 6054, 510, 17, 28, "Output",ExpressionUUID->"bf7713b7-a018-40da-ba38-eaea1cf5aa3e"]
}, Open  ]],
Cell[CellGroupData[{
Cell[236340, 6076, 2211, 64, 60, "Input",ExpressionUUID->"0fcf4268-41dc-446b-8b9f-bf7f6a8aaf65"],
Cell[238554, 6142, 444, 8, 28, "Output",ExpressionUUID->"75331d55-c619-4aa2-bad4-419208b785a9"]
}, Open  ]],
Cell[CellGroupData[{
Cell[239035, 6155, 1613, 51, 42, "Input",ExpressionUUID->"a1bd5938-b898-4b57-8f53-5fa8729f5dbe"],
Cell[240651, 6208, 247, 5, 32, "Output",ExpressionUUID->"e638ebfd-9497-4629-9a7f-db50363e621b"]
}, Open  ]],
Cell[CellGroupData[{
Cell[240935, 6218, 2159, 71, 60, "Input",ExpressionUUID->"5e449ccd-a4f7-4b92-9e52-c6786643667b"],
Cell[243097, 6291, 1467, 50, 46, "Output",ExpressionUUID->"1d945931-109b-4c05-9138-52ba149e566c"]
}, Open  ]],
Cell[CellGroupData[{
Cell[244601, 6346, 800, 26, 24, "Input",ExpressionUUID->"c0e52826-7bd8-4568-9427-9284c4b3a276"],
Cell[245404, 6374, 699, 23, 28, "Output",ExpressionUUID->"1c625335-bbe8-4dae-98a9-8699e369a990"]
}, Open  ]],
Cell[CellGroupData[{
Cell[246140, 6402, 750, 24, 24, "Input",ExpressionUUID->"ab70e3bd-cc8f-4402-b654-ab8c2f687290"],
Cell[246893, 6428, 156, 3, 28, "Output",ExpressionUUID->"bc65d35f-bab6-45fa-958d-b455a37e8e45"]
}, Open  ]],
Cell[CellGroupData[{
Cell[247086, 6436, 2200, 65, 78, "Input",ExpressionUUID->"55f7af87-74a7-445d-bf9a-08d3233891ab"],
Cell[249289, 6503, 653, 23, 21, "Echo",ExpressionUUID->"1d76d568-5655-4eee-9feb-f602efd6a850"],
Cell[249945, 6528, 254, 4, 28, "Output",ExpressionUUID->"f085ff66-5eba-449f-979d-b40206625993"]
}, Open  ]],
Cell[CellGroupData[{
Cell[250236, 6537, 1371, 44, 42, "Input",ExpressionUUID->"a068d1d7-3c2e-4a62-b371-3e31995c3e08"],
Cell[251610, 6583, 2609, 82, 63, "Output",ExpressionUUID->"d2e12810-ce7a-442d-ad61-88d087581a7c"]
}, Open  ]],
Cell[CellGroupData[{
Cell[254256, 6670, 1118, 36, 42, "Input",ExpressionUUID->"595330d4-d25c-4057-b820-5ca88d10da27"],
Cell[255377, 6708, 1936, 64, 52, "Output",ExpressionUUID->"92256532-92d6-48b1-bfbc-cd9333cbdcc7"]
}, Open  ]],
Cell[CellGroupData[{
Cell[257350, 6777, 547, 15, 24, "Input",ExpressionUUID->"7775cfdd-1a4c-46e1-971f-3a57898fade7"],
Cell[257900, 6794, 729, 22, 28, "Output",ExpressionUUID->"59cf02d0-81e5-429d-97e6-1ace45518a73"]
}, Open  ]],
Cell[CellGroupData[{
Cell[258666, 6821, 426, 11, 24, "Input",ExpressionUUID->"3fea89de-95e3-4e3d-af1d-9d94532bb6f5"],
Cell[259095, 6834, 608, 19, 28, "Output",ExpressionUUID->"f0e0c5bb-5f3f-4d77-bcb2-3005cea9f1f7"]
}, Open  ]],
Cell[259718, 6856, 1645, 55, 42, "Input",ExpressionUUID->"10aa6790-a49d-4ba2-805b-298f99b9549c"],
Cell[CellGroupData[{
Cell[261388, 6915, 1738, 59, 60, "Input",ExpressionUUID->"5d4f8e2b-99a3-47a9-9600-a9d704da6768"],
Cell[263129, 6976, 1550, 52, 46, "Output",ExpressionUUID->"b103c22b-23b0-4993-81f0-b5492b99083c"]
}, Open  ]],
Cell[CellGroupData[{
Cell[264716, 7033, 2257, 70, 77, "Input",ExpressionUUID->"e73f1c67-580c-42e6-a3d0-3f9f229561c3"],
Cell[266976, 7105, 1915, 30, 39, "Message",ExpressionUUID->"5ede203a-d14f-4313-b974-9db8545cb3ff"],
Cell[268894, 7137, 1469, 50, 46, "Output",ExpressionUUID->"b8c5af05-fb52-435d-aee6-67e55eae1299"]
}, Open  ]],
Cell[270378, 7190, 708, 21, 42, "Input",ExpressionUUID->"746802a6-17a9-43dd-b40d-c412ce29ab4c"],
Cell[271089, 7213, 1515, 50, 42, "Input",ExpressionUUID->"931afd0e-46ba-4ad9-b991-37bcb5e5f5d9"],
Cell[CellGroupData[{
Cell[272629, 7267, 259, 6, 24, "Input",ExpressionUUID->"d811694a-8be0-4cf1-8c32-174a72c7958e"],
Cell[272891, 7275, 2717, 88, 81, "Output",ExpressionUUID->"e9cb199e-68db-480b-892a-52df74a572bd"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[275657, 7369, 161, 3, 32, "Subsubsection",ExpressionUUID->"47697295-4836-4330-99a0-eb43c2dec756"],
Cell[275821, 7374, 857, 19, 42, "Input",ExpressionUUID->"56c3bab5-2018-48e3-ac9c-9be2f4c087cf"],
Cell[276681, 7395, 741, 14, 60, "Input",ExpressionUUID->"91f012a2-2e45-41f2-a57b-44a6d32d3176"],
Cell[277425, 7411, 655, 16, 42, "Input",ExpressionUUID->"c11719b0-8546-46e3-be5b-74ceda5deda1"],
Cell[278083, 7429, 1084, 18, 77, "Input",ExpressionUUID->"4a7ef930-c8ec-49e4-8187-cd04adf2d8e8"],
Cell[279170, 7449, 1797, 45, 95, "Input",ExpressionUUID->"b9d9497f-8ba8-4cca-a971-8c6bd8a2d052"],
Cell[280970, 7496, 1158, 19, 77, "Input",ExpressionUUID->"c6cbf0bb-0536-4ace-8337-f3cd2d47f6aa"],
Cell[282131, 7517, 667, 16, 24, "Input",ExpressionUUID->"affe3a6d-127d-4a53-bb28-fa36416aa146"],
Cell[282801, 7535, 703, 20, 42, "Input",ExpressionUUID->"d749cb31-c9f3-4724-a541-fc7b5c92fd7c"],
Cell[283507, 7557, 379, 7, 24, "Input",ExpressionUUID->"071df639-1c8a-4327-b2f7-6eb7beeb7d8f"],
Cell[283889, 7566, 509, 14, 24, "Input",ExpressionUUID->"602629d7-4dae-470b-8d75-c88092fd4753"],
Cell[284401, 7582, 1445, 48, 42, "Input",ExpressionUUID->"7947deff-53ce-472f-9d80-fb7c6b503376"],
Cell[CellGroupData[{
Cell[285871, 7634, 308, 6, 24, "Input",ExpressionUUID->"4babc9ec-eb76-45d2-9330-5aef7e8710bf"],
Cell[286182, 7642, 2757, 88, 81, "Output",ExpressionUUID->"96a4b8d0-5008-4c7c-aefc-47e511d56f21"]
}, Open  ]],
Cell[CellGroupData[{
Cell[288976, 7735, 312, 6, 24, "Input",ExpressionUUID->"ab7cd208-6a52-47bf-968d-859d09c7a39b"],
Cell[289291, 7743, 2765, 88, 81, "Output",ExpressionUUID->"0537d1e0-bbd0-4dc4-9dbe-1b4743bb8c62"]
}, Open  ]],
Cell[CellGroupData[{
Cell[292093, 7836, 1672, 36, 24, "Input",ExpressionUUID->"93619ea9-8a8e-456b-bb5e-f07249f90412"],
Cell[293768, 7874, 1669, 37, 28, "Output",ExpressionUUID->"1f51b806-48c7-4d93-a3d6-61e6247a516d"]
}, Open  ]],
Cell[CellGroupData[{
Cell[295474, 7916, 7850, 185, 646, "Input",ExpressionUUID->"0f44609a-e7c8-4719-bff3-90fa1a6aa2d9"],
Cell[CellGroupData[{
Cell[303349, 8105, 611, 21, 21, "Echo",ExpressionUUID->"f3ac5989-452c-4c04-9201-b69a8dad9c8b"],
Cell[303963, 8128, 941, 33, 21, "Echo",ExpressionUUID->"0efbe208-6fae-49a5-99e6-d2a287eddf93"]
}, Open  ]],
Cell[304919, 8164, 1992, 64, 46, "Output",ExpressionUUID->"3c7ccc92-50e0-4e25-a04b-d4739fbbace4"]
}, Open  ]],
Cell[306926, 8231, 220, 4, 24, "Input",ExpressionUUID->"4f52a366-20cd-4679-806e-17c33a99114e"]
}, Open  ]],
Cell[CellGroupData[{
Cell[307183, 8240, 184, 3, 39, "Subsubsection",ExpressionUUID->"da8b10d0-786b-4cc2-b28d-a51a2bc08eb7"],
Cell[CellGroupData[{
Cell[307392, 8247, 1995, 44, 24, "Input",ExpressionUUID->"fad77fac-0ba8-4bdc-af9d-0a080890ed9c"],
Cell[309390, 8293, 1883, 42, 28, "Output",ExpressionUUID->"f1bb113c-db42-40f9-b3f7-31b8faafc9ff"]
}, Open  ]],
Cell[CellGroupData[{
Cell[311310, 8340, 336, 7, 24, "Input",ExpressionUUID->"f1360857-9435-4618-92b8-605f1aa40388"],
Cell[311649, 8349, 557, 18, 28, "Output",ExpressionUUID->"86020955-0164-4ed5-959a-db5fef796d97"]
}, Open  ]],
Cell[CellGroupData[{
Cell[312243, 8372, 6158, 140, 387, "Input",ExpressionUUID->"9567b47e-0ef8-42af-ad66-6d4479cfc1ae"],
Cell[318404, 8514, 431, 13, 21, "Echo",ExpressionUUID->"090fe2a2-2765-4f65-bfe2-63e84f6863ce"]
}, Open  ]],
Cell[318850, 8530, 156, 3, 24, "Input",ExpressionUUID->"3553c785-41d5-4df5-a98d-0c9d46e4757a"],
Cell[CellGroupData[{
Cell[319031, 8537, 996, 32, 24, "Input",ExpressionUUID->"6cb4bf00-f8b1-4b5b-9c3f-26b4de9e6f11"],
Cell[320030, 8571, 298, 8, 28, "Output",ExpressionUUID->"d9e65f77-a534-417e-bb36-36e438664e73"]
}, Open  ]]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[320389, 8586, 166, 3, 34, "Subsection",ExpressionUUID->"79e49348-546f-4c0b-a877-63124877de7c"],
Cell[CellGroupData[{
Cell[320580, 8593, 162, 3, 40, "Subsubsection",ExpressionUUID->"7349799a-8cf2-4e39-baa0-89990c4a5d29"],
Cell[320745, 8598, 741, 14, 60, "Input",ExpressionUUID->"f0b89020-eb87-489f-b2a6-bde74138c29d"],
Cell[321489, 8614, 655, 16, 42, "Input",ExpressionUUID->"9e47bf8f-f8b5-4586-8109-148afb9caa98"],
Cell[322147, 8632, 1084, 18, 77, "Input",ExpressionUUID->"f1d32236-018d-43b1-81b0-d29ada18b7c8"],
Cell[323234, 8652, 1697, 45, 95, "Input",ExpressionUUID->"09ef332f-33cc-4cfd-b9e4-ad4e9a5cc9de"],
Cell[324934, 8699, 1158, 19, 77, "Input",ExpressionUUID->"e9a61ed0-c242-41b3-a360-66f26bfcca20"],
Cell[326095, 8720, 667, 16, 24, "Input",ExpressionUUID->"9cbf6444-75be-43dd-93e9-3dee8f7dd8bb"],
Cell[326765, 8738, 703, 20, 42, "Input",ExpressionUUID->"6915ba72-a6c7-4387-8eb2-2d49187e538d"],
Cell[327471, 8760, 378, 7, 24, "Input",ExpressionUUID->"02fad05c-d511-489f-b263-c963bbee73cb"],
Cell[327852, 8769, 509, 14, 24, "Input",ExpressionUUID->"9fee38d5-44c5-4da9-973a-2d300fc123e9"]
}, Closed]],
Cell[CellGroupData[{
Cell[328398, 8788, 172, 3, 33, "Subsubsection",ExpressionUUID->"7f839706-9bf5-4180-834d-5539779c8d99"],
Cell[CellGroupData[{
Cell[328595, 8795, 1823, 40, 24, "Input",ExpressionUUID->"9dc83312-1bcb-4361-9c25-66a71a73e659"],
Cell[330421, 8837, 1825, 40, 28, "Output",ExpressionUUID->"491f9ab4-753e-4e56-b158-baab2c1a8ce7"]
}, Open  ]],
Cell[332261, 8880, 7140, 157, 543, "Input",ExpressionUUID->"73820956-7205-4744-83fa-714bba676f0c"],
Cell[CellGroupData[{
Cell[339426, 9041, 179, 2, 24, "Input",ExpressionUUID->"f188a48b-9903-4a3d-a45c-65e237c3b66e"],
Cell[339608, 9045, 1905, 41, 28, "Output",ExpressionUUID->"678ff485-9c0e-489b-970c-6cdf0ccfe6de"]
}, Open  ]],
Cell[CellGroupData[{
Cell[341550, 9091, 211, 3, 24, "Input",ExpressionUUID->"5c2206c0-61d3-4270-8ea1-310a513b20a3"],
Cell[341764, 9096, 1669, 46, 46, "Output",ExpressionUUID->"2bc04dcb-180f-4713-93c3-ed373f95cfb4"]
}, Open  ]],
Cell[343448, 9145, 218, 4, 24, "Input",ExpressionUUID->"cbc60f29-7613-48e7-b9cd-626a5ffa76da"],
Cell[CellGroupData[{
Cell[343691, 9153, 1362, 30, 42, "Input",ExpressionUUID->"820d4616-ce44-4a4e-9947-a6a495108348"],
Cell[345056, 9185, 1413, 31, 28, "Output",ExpressionUUID->"c7b040d1-a120-49a3-9fa3-6f18ed95ba79"],
Cell[346472, 9218, 491, 12, 28, "Output",ExpressionUUID->"41ef3ad6-3fd7-4715-a5a4-ff86659a0ee3"]
}, Open  ]],
Cell[CellGroupData[{
Cell[347000, 9235, 179, 2, 24, "Input",ExpressionUUID->"aef50401-f602-4e9f-b9f9-84f3bb73bdd5"],
Cell[347182, 9239, 1829, 40, 28, "Output",ExpressionUUID->"1cb7119c-e632-4437-8924-172d9db16a39"]
}, Open  ]],
Cell[CellGroupData[{
Cell[349048, 9284, 351, 6, 24, "Input",ExpressionUUID->"c135a4f8-0363-4692-b33c-426a1ba5df7b"],
Cell[349402, 9292, 1802, 50, 46, "Output",ExpressionUUID->"2bb01e87-2454-4914-83a0-3ba35d745dea"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[351253, 9348, 179, 3, 33, "Subsubsection",ExpressionUUID->"66422402-52ed-4dca-bd7b-28a0c26163e2"],
Cell[CellGroupData[{
Cell[351457, 9355, 180, 3, 24, "Input",ExpressionUUID->"91883e36-d022-4335-a9ec-56c28972c02b"],
Cell[351640, 9360, 1806, 41, 28, "Output",ExpressionUUID->"023ac98b-c3ef-44e6-b81f-c5f706204454"]
}, Open  ]],
Cell[CellGroupData[{
Cell[353483, 9406, 1535, 34, 42, "Input",ExpressionUUID->"15fab165-a8f9-4038-97e7-f974e2c98d32"],
Cell[355021, 9442, 1415, 32, 28, "Output",ExpressionUUID->"86cd1233-29f5-4073-a592-05402398db50"],
Cell[356439, 9476, 495, 13, 28, "Output",ExpressionUUID->"46e64888-552c-4312-a8bf-ad4bdea25e32"]
}, Open  ]],
Cell[CellGroupData[{
Cell[356971, 9494, 16343, 339, 1492, "Input",ExpressionUUID->"93c33be6-d962-40b5-8910-03adf08f5e91"],
Cell[CellGroupData[{
Cell[373339, 9837, 293, 9, 21, "Echo",ExpressionUUID->"6da3516a-ff62-41df-b479-b7de56ab8c6d"],
Cell[373635, 9848, 271, 9, 21, "Echo",ExpressionUUID->"cc0bf77c-c872-4932-92f1-32a57c72ab73"],
Cell[373909, 9859, 130, 3, 21, "Echo",ExpressionUUID->"bf0eb77f-e6bc-48df-a365-2c81a312c3d6"],
Cell[374042, 9864, 185, 5, 21, "Echo",ExpressionUUID->"64351556-df69-4783-82a4-bef81f1e2f6d"]
}, Open  ]]
}, Open  ]],
Cell[374254, 9873, 838, 17, 77, "Input",ExpressionUUID->"046dfe26-1d5f-4a75-90cc-c795282d5b01"],
Cell[CellGroupData[{
Cell[375117, 9894, 318, 7, 24, "Input",ExpressionUUID->"9f3d9c57-4905-4f40-96b5-253c5a83dfe2"],
Cell[375438, 9903, 230, 4, 28, "Output",ExpressionUUID->"6ee57057-9a69-4399-90f6-320f85f1afa9"]
}, Open  ]],
Cell[CellGroupData[{
Cell[375705, 9912, 458, 9, 42, "Input",ExpressionUUID->"c57da927-85ed-4620-8f8c-78a668b26667"],
Cell[376166, 9923, 447, 9, 32, "Output",ExpressionUUID->"e7434b62-e9aa-49c8-b232-108d2a22527b"]
}, Open  ]],
Cell[CellGroupData[{
Cell[376650, 9937, 482, 10, 42, "Input",ExpressionUUID->"1438ee28-c534-4c31-aec9-5d05e0ea364d"],
Cell[377135, 9949, 423, 10, 32, "Output",ExpressionUUID->"aaf7eb4f-1837-4e6f-abb4-bd64135201a7"]
}, Open  ]],
Cell[CellGroupData[{
Cell[377595, 9964, 410, 9, 42, "Input",ExpressionUUID->"ee3f44cb-71fe-443e-ad42-6a79ab1efc93"],
Cell[378008, 9975, 11133, 259, 177, "Output",ExpressionUUID->"1c056646-fe0e-40b9-9823-4536a93cf541"]
}, Open  ]],
Cell[CellGroupData[{
Cell[389178, 10239, 349, 8, 24, "Input",ExpressionUUID->"b1acf3c2-8775-4dcc-aeb0-662290be580c"],
Cell[389530, 10249, 287, 6, 32, "Output",ExpressionUUID->"a93730aa-2ee1-4e5f-8e1e-e28bdd5a73c4"]
}, Open  ]],
Cell[CellGroupData[{
Cell[389854, 10260, 350, 7, 42, "Input",ExpressionUUID->"11cbd907-23a2-491f-982c-1d3008dc2da7"],
Cell[390207, 10269, 247, 4, 32, "Output",ExpressionUUID->"6bdb06c1-473b-44f1-aa1e-b167e0533201"]
}, Open  ]],
Cell[CellGroupData[{
Cell[390491, 10278, 278, 6, 24, "Input",ExpressionUUID->"40f5a1f3-6358-49d7-af05-13711e821a80"],
Cell[390772, 10286, 166, 3, 28, "Output",ExpressionUUID->"6a1b98df-11ab-45a4-b947-8a3c50ce5e3c"]
}, Open  ]],
Cell[CellGroupData[{
Cell[390975, 10294, 693, 18, 24, "Input",ExpressionUUID->"6652efb4-087d-4bde-96cf-46a7529d58b8"],
Cell[391671, 10314, 271, 6, 28, "Output",ExpressionUUID->"e6ad1acf-6ac4-4994-8300-e284aa76cac6"]
}, Open  ]],
Cell[CellGroupData[{
Cell[391979, 10325, 263, 6, 24, "Input",ExpressionUUID->"6182bb20-3480-4318-a70b-16e570c7b6f1"],
Cell[392245, 10333, 460, 10, 22, "Message",ExpressionUUID->"86b506d5-8b69-413a-b2d5-caaaef70b178"],
Cell[392708, 10345, 166, 3, 28, "Output",ExpressionUUID->"26c01aee-0075-44b4-ba4e-e49aee607f2b"]
}, Open  ]],
Cell[CellGroupData[{
Cell[392911, 10353, 197, 4, 24, "Input",ExpressionUUID->"934e2db9-c958-4b31-a9c3-d17148ab0be7"],
Cell[393111, 10359, 12272, 298, 90, "Output",ExpressionUUID->"36daa1ce-2aee-42ab-8f13-036902dbb534"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[405432, 10663, 180, 3, 33, "Subsubsection",ExpressionUUID->"1a42caf6-ecd1-4078-93f7-d8d96e3258a9"],
Cell[405615, 10668, 1642, 43, 77, "Input",ExpressionUUID->"e80c69f6-57d0-4ad4-8beb-f0021af4229a"],
Cell[407260, 10713, 1433, 43, 42, "Input",ExpressionUUID->"0e877e75-6483-4b2c-be6c-18fe1b9be7d0"],
Cell[CellGroupData[{
Cell[408718, 10760, 535, 14, 42, "Input",ExpressionUUID->"2c8c3b84-4866-4186-974d-746c0913a041"],
Cell[409256, 10776, 535, 15, 28, "Output",ExpressionUUID->"aad32081-735c-46b5-b664-dcfdbc149d7a"],
Cell[409794, 10793, 599, 16, 28, "Output",ExpressionUUID->"8377fbd8-bca1-4454-92b9-9aa68794121b"]
}, Open  ]],
Cell[410408, 10812, 212, 4, 24, "Input",ExpressionUUID->"f0fd5e93-da43-4133-bef6-e71ee95820d8"],
Cell[CellGroupData[{
Cell[410645, 10820, 514, 14, 24, "Input",ExpressionUUID->"6990a7c7-b42e-45d2-a8ba-3cbeec4052b1"],
Cell[411162, 10836, 456, 13, 28, "Output",ExpressionUUID->"40d40b63-3b3b-4ab0-ab14-0331848988b7"]
}, Open  ]],
Cell[411633, 10852, 245, 6, 24, "Input",ExpressionUUID->"139855ac-b014-4bd7-bcf2-f8fb88d4ccd6"],
Cell[411881, 10860, 5044, 136, 232, "Input",ExpressionUUID->"04c1305b-82d3-4284-85c0-b2c5021aa8b4"],
Cell[CellGroupData[{
Cell[416950, 11000, 335, 6, 42, "Input",ExpressionUUID->"e956a5e6-2131-40ba-a5ed-df528465286b"],
Cell[417288, 11008, 551, 14, 28, "Output",ExpressionUUID->"93ba216b-85c5-4841-b307-24b0e3dd627c"],
Cell[417842, 11024, 591, 15, 28, "Output",ExpressionUUID->"6cb832d2-4b57-49c7-8646-c632fca92208"]
}, Open  ]],
Cell[CellGroupData[{
Cell[418470, 11044, 1849, 55, 60, "Input",ExpressionUUID->"edaf0a29-2230-43c0-b19b-3b4947ff4ddf"],
Cell[420322, 11101, 1865, 52, 81, "Output",ExpressionUUID->"780bd8cd-1167-4c49-8dbc-714a00633a1c"]
}, Open  ]],
Cell[422202, 11156, 879, 22, 60, "Input",ExpressionUUID->"f0e91637-cd13-4925-910e-138d91724ef8"],
Cell[CellGroupData[{
Cell[423106, 11182, 17353, 379, 1320, "Input",ExpressionUUID->"7d7df5d9-c52b-472e-827f-02194f0462ec"],
Cell[CellGroupData[{
Cell[440484, 11565, 130, 3, 21, "Echo",ExpressionUUID->"78286f15-8dcf-4789-8da3-8623a538f2c5"],
Cell[440617, 11570, 362, 11, 21, "Echo",ExpressionUUID->"b8035799-d048-45ad-866a-c6bc88dc4c4c"],
Cell[440982, 11583, 209, 6, 21, "Echo",ExpressionUUID->"d8f38770-26e1-46cb-827d-c9b2ebed7d76"],
Cell[441194, 11591, 175, 5, 21, "Echo",ExpressionUUID->"03cfc8eb-2142-4728-ab01-e74a0732dafc"],
Cell[441372, 11598, 147, 3, 21, "Echo",ExpressionUUID->"2a540245-3b5a-4b46-909f-22a93025aadf"]
}, Open  ]],
Cell[441534, 11604, 1115, 20, 28, "Output",ExpressionUUID->"0d7596f4-f669-441e-8160-ddb3437b3564"]
}, Open  ]],
Cell[CellGroupData[{
Cell[442686, 11629, 302, 7, 24, "Input",ExpressionUUID->"b2019390-4da6-4079-9c88-d7a8cbe082d7"],
Cell[442991, 11638, 292, 7, 28, "Output",ExpressionUUID->"69f7a46a-6c62-4a3d-a544-8eb78a558922"]
}, Open  ]],
Cell[CellGroupData[{
Cell[443320, 11650, 335, 8, 24, "Input",ExpressionUUID->"ddbdbe22-58cd-4ff5-bcfb-9a79ddca10c2"],
Cell[443658, 11660, 254, 5, 28, "Output",ExpressionUUID->"022c1e1a-4df0-466f-a8ee-4cd6cde611da"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[443961, 11671, 225, 4, 33, "Subsubsection",ExpressionUUID->"216fa49c-0a59-469f-b560-0ae576ec029e"],
Cell[444189, 11677, 1673, 48, 77, "Input",ExpressionUUID->"eaee92b0-b0c0-427b-9216-84be8264f03b"],
Cell[CellGroupData[{
Cell[445887, 11729, 14812, 347, 855, "Input",ExpressionUUID->"1a0c1dc5-a260-4bd5-8907-c24fb45a9d8a"],
Cell[CellGroupData[{
Cell[460724, 12080, 853, 29, 21, "Echo",ExpressionUUID->"d8ce40b2-9991-4bcf-a23f-303a665bc528"],
Cell[461580, 12111, 680, 23, 21, "Echo",ExpressionUUID->"1412e7bb-6361-4881-83f4-4c20b2ef6152"],
Cell[462263, 12136, 193, 5, 21, "Echo",ExpressionUUID->"0edefba7-07f5-45b3-9fb1-6037a6622791"]
}, Open  ]],
Cell[462471, 12144, 1068, 20, 28, "Output",ExpressionUUID->"f8af10dd-847a-4671-b090-ac2e23d53468"]
}, Open  ]],
Cell[463554, 12167, 11327, 272, 837, "Input",ExpressionUUID->"8ba7b346-46ef-456d-9f85-4ee7b513aae4"],
Cell[CellGroupData[{
Cell[474906, 12443, 2777, 64, 42, "Input",ExpressionUUID->"9ab6e93e-84c1-42d9-b65e-477eb647d1c8"],
Cell[477686, 12509, 588, 14, 28, "Output",ExpressionUUID->"702a9edf-d5f5-4bc7-8158-8f0d320451c8"]
}, Open  ]],
Cell[CellGroupData[{
Cell[478311, 12528, 1823, 40, 24, "Input",ExpressionUUID->"9bef5b19-e51d-4b1f-a1ae-4ffb69d070e8"],
Cell[480137, 12570, 1829, 40, 28, "Output",ExpressionUUID->"8626cb68-070e-4010-a17c-b703923dc779"]
}, Open  ]],
Cell[CellGroupData[{
Cell[482003, 12615, 2629, 59, 60, "Input",ExpressionUUID->"b5026e45-767e-41c8-8f2c-696e31a6c720"],
Cell[484635, 12676, 1649, 47, 46, "Output",ExpressionUUID->"0de31614-8e14-4f70-b978-cb2e18944ffc"],
Cell[486287, 12725, 1649, 47, 46, "Output",ExpressionUUID->"bd87c354-0946-4b6c-ab77-73c42063048c"],
Cell[487939, 12774, 1749, 41, 28, "Output",ExpressionUUID->"76e33c5b-e22d-4e0d-bdd0-da5992d406e6"]
}, Open  ]]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[489749, 12822, 177, 3, 48, "Subsection",ExpressionUUID->"b2a0ece9-b0e0-4b5b-9328-845a37f9d27a"],
Cell[489929, 12827, 1801, 40, 25, "Input",ExpressionUUID->"180ce67d-b833-4000-8b57-6079ee901700"],
Cell[CellGroupData[{
Cell[491755, 12871, 162, 3, 40, "Subsubsection",ExpressionUUID->"6c2addd5-4caf-494a-bba5-fe110de92bff"],
Cell[491920, 12876, 746, 15, 61, "Input",ExpressionUUID->"d5e98609-40f9-4e18-9863-b54f4095e4ad"],
Cell[492669, 12893, 660, 17, 43, "Input",ExpressionUUID->"40a9fed7-7ca3-42bd-a11a-7bef5decedc4"],
Cell[493332, 12912, 1089, 19, 78, "Input",ExpressionUUID->"ca294ee3-45ac-456c-a145-cb7366cdbe9a"],
Cell[494424, 12933, 1702, 46, 96, "Input",ExpressionUUID->"2ffe182a-c16b-414b-9dca-1516d45792c7"],
Cell[496129, 12981, 1163, 20, 78, "Input",ExpressionUUID->"5f497da6-7756-4aec-ab0d-d698dfb20fb0"],
Cell[497295, 13003, 672, 17, 25, "Input",ExpressionUUID->"a5349cfb-aaee-4c59-a6f0-4732c13d1392"],
Cell[497970, 13022, 1289, 35, 78, "Input",ExpressionUUID->"e5da7451-8b61-40d0-95bf-f643b09aa71a"],
Cell[499262, 13059, 434, 9, 25, "Input",ExpressionUUID->"7e4f76cb-e3f8-479a-a374-a3a06cb5800e"],
Cell[499699, 13070, 513, 15, 25, "Input",ExpressionUUID->"8e42a1b3-13a1-4ffe-ab31-71de6c5b4145"],
Cell[500215, 13087, 268, 6, 25, "Input",ExpressionUUID->"ea061cc6-3cd9-4bfe-a3b1-5d420fc4d1fa"],
Cell[500486, 13095, 5066, 136, 233, "Input",ExpressionUUID->"f496a6c6-9130-4f15-a504-1b2b7809100f"]
}, Closed]],
Cell[CellGroupData[{
Cell[505589, 13236, 194, 3, 33, "Subsubsection",ExpressionUUID->"1a0a0f87-986d-4f0a-bbba-313738323f4e"],
Cell[505786, 13241, 11848, 229, 613, "Input",ExpressionUUID->"91c47b70-5963-42eb-80fe-a9d70fc30a89"],
Cell[517637, 13472, 322, 7, 25, "Input",ExpressionUUID->"7b8e43b2-1521-4652-ad2e-419c48e0b60e"],
Cell[517962, 13481, 11353, 219, 544, "Input",ExpressionUUID->"a3168480-0ecc-4024-8546-8ca2fcbcedd6"],
Cell[CellGroupData[{
Cell[529340, 13704, 323, 7, 27, "Input",ExpressionUUID->"bc76d82d-9e85-4bbd-8952-cd09d84e914f"],
Cell[529666, 13713, 4275, 98, 47, "Output",ExpressionUUID->"d58062ee-3160-491a-83e8-87d898356f94"]
}, Open  ]],
Cell[CellGroupData[{
Cell[533978, 13816, 235, 5, 27, "Input",ExpressionUUID->"7ec7cc69-4b32-49e6-9b75-462c343813bf"],
Cell[534216, 13823, 1703, 50, 47, "Output",ExpressionUUID->"c11ced7a-220e-484e-9707-6a564512e841"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[535968, 13879, 187, 3, 33, "Subsubsection",ExpressionUUID->"65046466-2484-4f5a-89b6-a0bb83b201de"],
Cell[536158, 13884, 507, 10, 43, "Input",ExpressionUUID->"6e45bf3a-13e5-4261-80c1-187cfdc98fd8"],
Cell[536668, 13896, 2305, 56, 233, "Input",ExpressionUUID->"4839dbf0-2cb2-4e82-bb60-a1028ac7b425"],
Cell[538976, 13954, 234, 5, 25, "Input",ExpressionUUID->"39cde670-d708-4c04-9810-9301562b80b5"],
Cell[539213, 13961, 11441, 273, 838, "Input",ExpressionUUID->"60064356-76ec-4196-8b44-cfcfff5a9862"]
}, Closed]],
Cell[CellGroupData[{
Cell[550691, 14239, 204, 3, 33, "Subsubsection",ExpressionUUID->"8452286b-c8d1-4acd-9a5e-a1e47a222ebc"],
Cell[550898, 14244, 537, 12, 27, "Input",ExpressionUUID->"d912bb70-ab71-40c4-92dd-76c4349cbc0f"],
Cell[551438, 14258, 4236, 97, 426, "Input",ExpressionUUID->"b680f7da-270a-41c9-98f0-249540a93a90"],
Cell[555677, 14357, 405, 8, 27, "Input",ExpressionUUID->"e333a459-650f-473c-8e2b-530308b260c5"],
Cell[556085, 14367, 4983, 114, 495, "Input",ExpressionUUID->"41cb2d4c-648f-4514-bba9-73acf7e3f521"],
Cell[CellGroupData[{
Cell[561093, 14485, 1827, 41, 27, "Input",ExpressionUUID->"fc79584b-3046-44dc-ab67-2616a3bfe5b8"],
Cell[562923, 14528, 1856, 42, 30, "Output",ExpressionUUID->"97772328-afea-4c86-8fb4-27fc116e3de4"]
}, Open  ]],
Cell[CellGroupData[{
Cell[564816, 14575, 415, 7, 27, "Input",ExpressionUUID->"a0085437-d114-47cd-b2e0-d98dc3a8fc66"],
Cell[565234, 14584, 1934, 45, 22, "Echo",ExpressionUUID->"2831418e-ea37-411a-959f-da926e7423d9"],
Cell[567171, 14631, 3215, 76, 30, "Output",ExpressionUUID->"8e1ebbc5-c756-4aad-8348-ad55991d9c29"]
}, Open  ]],
Cell[CellGroupData[{
Cell[570423, 14712, 1341, 30, 27, "Input",ExpressionUUID->"e9a7c8eb-3463-40fa-a5c2-faf253885df0"],
Cell[571767, 14744, 1286, 29, 30, "Output",ExpressionUUID->"4725719c-0ce1-44f9-8c17-7c0b835627e6"]
}, Open  ]],
Cell[CellGroupData[{
Cell[573090, 14778, 300, 6, 27, "Input",ExpressionUUID->"9d6cb130-0d8d-4481-9e61-e19b364f3dcd"],
Cell[CellGroupData[{
Cell[573415, 14788, 1365, 33, 22, "Echo",ExpressionUUID->"4c79cf57-c962-4995-9d71-048e39e452f1"],
Cell[574783, 14823, 1367, 33, 22, "Echo",ExpressionUUID->"58a6d42b-bb35-4859-85c0-15b4cad8b6c8"],
Cell[576153, 14858, 1367, 33, 22, "Echo",ExpressionUUID->"d060be8b-abaf-46d7-89f5-4f497354c5ac"],
Cell[577523, 14893, 1365, 33, 22, "Echo",ExpressionUUID->"8186a925-35b2-4864-ace8-b57b67836ce7"],
Cell[578891, 14928, 1367, 33, 22, "Echo",ExpressionUUID->"faacd632-1887-4e24-a47a-bf6d0e0d4816"],
Cell[580261, 14963, 1367, 33, 22, "Echo",ExpressionUUID->"86add15f-481d-46de-8612-bf703c6df85e"],
Cell[581631, 14998, 1365, 33, 22, "Echo",ExpressionUUID->"b7f25055-09b4-4210-b42f-1abe3f11cdf2"],
Cell[582999, 15033, 1365, 33, 22, "Echo",ExpressionUUID->"4edfbbf1-1a4d-4580-9bff-c01a3fa9fc45"],
Cell[584367, 15068, 1367, 33, 22, "Echo",ExpressionUUID->"42e5e9fd-ccf1-47fb-a571-93893d6b6aaf"],
Cell[585737, 15103, 1367, 33, 22, "Echo",ExpressionUUID->"e9c3877a-ef5b-4ac3-8573-9f8317f36445"],
Cell[587107, 15138, 1367, 33, 22, "Echo",ExpressionUUID->"57e989b6-0ca2-4899-80b8-be5b3e3f1769"],
Cell[588477, 15173, 1367, 33, 22, "Echo",ExpressionUUID->"e44047b8-04b6-4ea7-95a5-ef1bd99637b7"],
Cell[589847, 15208, 1367, 33, 22, "Echo",ExpressionUUID->"bf2bbba2-a6e0-4dad-bdfa-a3dca61513f7"],
Cell[591217, 15243, 1365, 33, 22, "Echo",ExpressionUUID->"a948dc96-3ad0-4d21-894c-4cd58eaf7815"],
Cell[592585, 15278, 1365, 33, 22, "Echo",ExpressionUUID->"b70357ce-4535-4ced-a577-810f7998b70b"],
Cell[593953, 15313, 1365, 33, 22, "Echo",ExpressionUUID->"2458674f-f589-42fa-aa50-9dc73e9b6dce"]
}, Open  ]],
Cell[595333, 15349, 1060, 24, 30, "Output",ExpressionUUID->"eaeb8385-6185-4f70-8040-5ce0fa2ed3ec"]
}, Open  ]],
Cell[CellGroupData[{
Cell[596430, 15378, 1084, 24, 27, "Input",ExpressionUUID->"85f5271c-0218-4175-9197-1b55faa1d412"],
Cell[597517, 15404, 1059, 24, 30, "Output",ExpressionUUID->"834e52a6-3138-46bb-8e12-3271b462ab7a"]
}, Open  ]],
Cell[CellGroupData[{
Cell[598613, 15433, 305, 6, 27, "Input",ExpressionUUID->"4692eebf-9f19-4b5a-aeeb-d17b20523c37"],
Cell[CellGroupData[{
Cell[598943, 15443, 1080, 26, 22, "Echo",ExpressionUUID->"9cb6855f-9e43-47cd-a433-b9a1c83606be"],
Cell[600026, 15471, 1080, 26, 22, "Echo",ExpressionUUID->"f82fec73-1dd3-4d6e-a621-3c5596a6e74a"],
Cell[601109, 15499, 1080, 26, 22, "Echo",ExpressionUUID->"11b4a14c-339d-4c79-8b43-867ef8ed4d5b"],
Cell[602192, 15527, 1078, 26, 22, "Echo",ExpressionUUID->"cb29385b-f240-4555-8b1d-c78075b14b1a"],
Cell[603273, 15555, 1078, 26, 22, "Echo",ExpressionUUID->"c5eefa16-668f-4e54-996f-b3509f50a254"],
Cell[604354, 15583, 1080, 26, 22, "Echo",ExpressionUUID->"6f8cca48-979f-42bf-86d4-4e80fa674331"],
Cell[605437, 15611, 1080, 26, 22, "Echo",ExpressionUUID->"41bf9e97-4595-4849-a364-2429fc975ac4"],
Cell[606520, 15639, 1080, 26, 22, "Echo",ExpressionUUID->"507d9718-690c-4e2a-aace-5e9e74c44fdb"],
Cell[607603, 15667, 1078, 26, 22, "Echo",ExpressionUUID->"17d8c758-7ab3-4317-9023-f8d31f1b67b2"],
Cell[608684, 15695, 1080, 26, 22, "Echo",ExpressionUUID->"69f661fc-614b-4809-b0d0-c3534ae15804"],
Cell[609767, 15723, 1078, 26, 22, "Echo",ExpressionUUID->"cb896140-b74e-4881-8e9d-a49375f14f0e"],
Cell[610848, 15751, 1078, 26, 22, "Echo",ExpressionUUID->"6a967725-a32f-4a25-969d-7bf313794ee6"],
Cell[611929, 15779, 1078, 26, 22, "Echo",ExpressionUUID->"451819da-6987-4a74-90e1-8523f48c9af5"],
Cell[613010, 15807, 1078, 26, 22, "Echo",ExpressionUUID->"9920e70b-2554-4531-b8d3-47ae56985c76"],
Cell[614091, 15835, 1078, 26, 22, "Echo",ExpressionUUID->"94229278-2670-42db-948e-abffcbeec1ef"],
Cell[615172, 15863, 1080, 26, 22, "Echo",ExpressionUUID->"ca463b4f-a1af-419f-b115-3fb8ff0967d4"]
}, Open  ]],
Cell[616267, 15892, 689, 18, 30, "Output",ExpressionUUID->"238bc93f-4d2b-4f43-9f50-dbbd5f8524a9"]
}, Open  ]],
Cell[616971, 15913, 865, 16, 61, "Input",ExpressionUUID->"deedf6cd-2eed-4668-8cc4-83b069cf288a"],
Cell[617839, 15931, 9671, 240, 842, "Input",ExpressionUUID->"7734c69b-75b3-484b-8600-70f34e828b3b"]
}, Closed]],
Cell[CellGroupData[{
Cell[627547, 16176, 200, 3, 33, "Subsubsection",ExpressionUUID->"8052a3c8-73b8-46b5-9fe7-dddbd75ab013"],
Cell[627750, 16181, 386, 8, 25, "Input",ExpressionUUID->"a462f114-9d0b-43f6-96cd-114263012475"],
Cell[628139, 16191, 221, 4, 25, "Input",ExpressionUUID->"85870fe5-c417-4f63-83d8-3778ff724dbf"],
Cell[CellGroupData[{
Cell[628385, 16199, 220, 4, 25, "Input",ExpressionUUID->"1b16e721-4f74-41fb-b647-65b76dfce782"],
Cell[628608, 16205, 221, 4, 29, "Output",ExpressionUUID->"e0eb5613-1541-4829-aaab-990c31c7906c"]
}, Open  ]],
Cell[628844, 16212, 263, 6, 25, "Input",ExpressionUUID->"3bd6c34d-889b-4796-9f4c-82e05a8ae5ce"],
Cell[629110, 16220, 1268, 28, 130, "Input",ExpressionUUID->"a9ac5df5-776e-440d-8b17-85694f705b4b"],
Cell[630381, 16250, 407, 8, 25, "Input",ExpressionUUID->"ab1ed76f-a29a-4b80-881a-6c356ee2bfb0"],
Cell[630791, 16260, 501, 11, 25, "Input",ExpressionUUID->"efccb277-206b-4fa5-8a8e-dd1cb52546d2"],
Cell[631295, 16273, 597, 11, 43, "Input",ExpressionUUID->"e7e44f90-a923-45d8-99cf-c7393c092bda"],
Cell[631895, 16286, 252, 5, 25, "Input",ExpressionUUID->"7aa7b9df-419b-45d6-9f21-e1732c5c64e8"],
Cell[632150, 16293, 1809, 45, 181, "Input",ExpressionUUID->"17ba8366-ef2b-4780-aead-be227b8af89d"],
Cell[CellGroupData[{
Cell[633984, 16342, 222, 4, 25, "Input",ExpressionUUID->"820b5970-2616-4f10-8efd-bb226218f417"],
Cell[634209, 16348, 187, 3, 29, "Output",ExpressionUUID->"ad30e6ba-d6a3-4b70-9496-a46594aa9947"]
}, Open  ]],
Cell[CellGroupData[{
Cell[634433, 16356, 322, 6, 43, "Input",ExpressionUUID->"fe18f618-66ff-46b6-8da4-e3aa71a03bf0"],
Cell[634758, 16364, 1934, 45, 22, "Echo",ExpressionUUID->"91697afe-069f-4143-80ab-61ceb06cf51e"],
Cell[636695, 16411, 3243, 77, 47, "Output",ExpressionUUID->"6a9b9256-a97e-471a-b373-9874945bbad4"],
Cell[639941, 16490, 1087, 26, 29, "Output",ExpressionUUID->"15ec1cc9-875d-4e44-a773-1b219f35135b"]
}, Open  ]],
Cell[641043, 16519, 237, 5, 25, "Input",ExpressionUUID->"5f99946c-b03f-4090-a85a-29dcf572ba3f"],
Cell[CellGroupData[{
Cell[641305, 16528, 322, 6, 43, "Input",ExpressionUUID->"cfa5074d-c8f9-4263-93f7-8a311b7db743"],
Cell[641630, 16536, 1932, 45, 22, "Echo",ExpressionUUID->"ba8b9470-73ef-4800-8277-07a42d462703"],
Cell[643565, 16583, 3243, 77, 47, "Output",ExpressionUUID->"19680402-3118-419f-8ae2-8f918556bca6"],
Cell[646811, 16662, 1087, 26, 29, "Output",ExpressionUUID->"aa02e0b3-4b8c-4bc6-8cca-7b1248db794d"]
}, Open  ]],
Cell[647913, 16691, 235, 5, 25, "Input",ExpressionUUID->"c51781ff-4d19-480f-aa72-13db1b37f0ce"],
Cell[CellGroupData[{
Cell[648173, 16700, 322, 6, 43, "Input",ExpressionUUID->"ee58a566-6c50-4b45-b71a-8729e79c5abd"],
Cell[648498, 16708, 1934, 45, 22, "Echo",ExpressionUUID->"265f2564-6cce-4d6c-ac0e-07ba94315bc2"],
Cell[650435, 16755, 3241, 77, 47, "Output",ExpressionUUID->"1d3e1e56-5ac2-442a-a7b1-a19cb898f9ba"],
Cell[653679, 16834, 1083, 26, 29, "Output",ExpressionUUID->"012526bf-3b90-482b-b9c0-14e6563e5a55"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[654811, 16866, 239, 4, 33, "Subsubsection",ExpressionUUID->"630a1b70-f92b-49ef-89ba-e56ef2fbea85"],
Cell[655053, 16872, 613, 11, 43, "Input",ExpressionUUID->"4ea58205-b8ee-4f45-b6a8-46780a08123d"],
Cell[CellGroupData[{
Cell[655691, 16887, 183, 3, 25, "Input",ExpressionUUID->"30ed8222-e192-4ab9-88fd-7ab6a1e8331e"],
Cell[655877, 16892, 1809, 41, 29, "Output",ExpressionUUID->"ad797ea1-0c64-4a4a-b62f-8988fab2693b"]
}, Open  ]],
Cell[CellGroupData[{
Cell[657723, 16938, 1511, 34, 43, "Input",ExpressionUUID->"8b47e858-e091-4790-9263-8cd59d154b97"],
Cell[659237, 16974, 2873, 64, 50, "Output",ExpressionUUID->"dd13d04f-4336-46e7-8e50-388aeafa46fa"]
}, Open  ]],
Cell[662125, 17041, 384, 9, 43, "Input",ExpressionUUID->"66686e37-c00c-4320-88d8-9fa8f08799d5"],
Cell[CellGroupData[{
Cell[662534, 17054, 356, 9, 25, "Input",ExpressionUUID->"362d2017-69d7-48d2-b7e8-6e339f5fc88b"],
Cell[662893, 17065, 240, 6, 29, "Output",ExpressionUUID->"08eaafd9-cb94-4bed-895f-9a5fa2448801"]
}, Open  ]],
Cell[663148, 17074, 7380, 172, 561, "Input",ExpressionUUID->"a9d88f5f-f677-4297-ace9-4f1b701895af"],
Cell[CellGroupData[{
Cell[670553, 17250, 220, 4, 25, "Input",ExpressionUUID->"ff036ee4-42a4-4207-b368-f6a8818f642b"],
Cell[670776, 17256, 1241, 29, 22, "Echo",ExpressionUUID->"f5a8d17c-5748-4b4d-a254-401096cbcafe"],
Cell[672020, 17287, 1287, 29, 29, "Output",ExpressionUUID->"a5ac3c0c-64fc-41f3-9e89-bf5882aaa446"]
}, Open  ]],
Cell[673322, 17319, 1342, 29, 25, "Input",ExpressionUUID->"4010967c-d7b0-4bc1-849f-baa07b850318"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[674713, 17354, 193, 3, 59, "Section",ExpressionUUID->"fbdc9e81-0947-4cfa-9168-76dea3d0f855"],
Cell[CellGroupData[{
Cell[674931, 17361, 159, 3, 48, "Subsection",ExpressionUUID->"3dfaa763-3452-4eff-b21d-75b3c683735d"],
Cell[CellGroupData[{
Cell[675115, 17368, 159, 3, 40, "Subsubsection",ExpressionUUID->"61749fa7-933d-4cd6-9080-b3eca79341f0"],
Cell[675277, 17373, 746, 15, 61, "Input",ExpressionUUID->"8ef71ebb-102c-4405-a637-ec2926861218"],
Cell[676026, 17390, 660, 17, 44, "Input",ExpressionUUID->"ae2957f6-8ca3-4329-a169-7532c0c29a82"],
Cell[676689, 17409, 1089, 19, 78, "Input",ExpressionUUID->"1c3a8a5e-9dc1-49a6-bbf4-1e6879e5339b"]
}, Open  ]],
Cell[CellGroupData[{
Cell[677815, 17433, 159, 3, 40, "Subsubsection",ExpressionUUID->"25ed176c-c2fd-48f7-8491-e7e21beff502"],
Cell[677977, 17438, 1702, 46, 79, "Input",ExpressionUUID->"1114befe-b57f-4776-bed3-f26e598104d3"],
Cell[679682, 17486, 1163, 20, 78, "Input",ExpressionUUID->"4a03dc37-75e2-46e4-92ee-0ec38f19b0da"]
}, Open  ]],
Cell[CellGroupData[{
Cell[680882, 17511, 159, 3, 40, "Subsubsection",ExpressionUUID->"25d92da2-87ae-42b0-8ec8-cc4892d5c535"],
Cell[681044, 17516, 268, 6, 25, "Input",ExpressionUUID->"dd93ecaf-9307-4033-9fa1-2c77713727c3"],
Cell[681315, 17524, 5066, 136, 236, "Input",ExpressionUUID->"b2cd1fd0-aad8-4cf2-b0bb-3a15ff063909"]
}, Open  ]],
Cell[CellGroupData[{
Cell[686418, 17665, 162, 3, 40, "Subsubsection",ExpressionUUID->"07b81952-73ec-40af-b643-cfb69a7b5870"],
Cell[686583, 17670, 672, 17, 27, "Input",ExpressionUUID->"8c011e60-95dd-4324-b294-97da57630339"],
Cell[687258, 17689, 1289, 35, 62, "Input",ExpressionUUID->"6d53efdd-4cd6-4b83-ad7a-a9f20415f639"],
Cell[688550, 17726, 434, 9, 25, "Input",ExpressionUUID->"753dc270-8117-4e1f-ada4-451ed5b5d89a"],
Cell[688987, 17737, 513, 15, 27, "Input",ExpressionUUID->"adbf1474-7b6c-4ac0-946b-9a26a53baf3a"]
}, Open  ]],
Cell[CellGroupData[{
Cell[689537, 17757, 187, 3, 40, "Subsubsection",ExpressionUUID->"8142cac2-7421-42b3-b15e-9e3ccc97a7ee"],
Cell[CellGroupData[{
Cell[689749, 17764, 651, 20, 25, "Input",ExpressionUUID->"fa7cbd8b-9be1-4785-a8e8-6c41b862ed93"],
Cell[690403, 17786, 696, 21, 29, "Output",ExpressionUUID->"f98b1b36-e3d3-42bf-a5c3-154ca79bc5cf"]
}, Open  ]],
Cell[691114, 17810, 665, 16, 44, "Input",ExpressionUUID->"8a3f05d9-235c-4a62-94d8-9c3fc7bfa83b"],
Cell[CellGroupData[{
Cell[691804, 17830, 1032, 32, 43, "Input",ExpressionUUID->"b84ee920-7f52-41bf-baa6-9d44f65cce13"],
Cell[692839, 17864, 852, 23, 29, "Output",ExpressionUUID->"58010cd2-ff57-49ca-aa38-984b1606a82e"],
Cell[693694, 17889, 1309, 40, 29, "Output",ExpressionUUID->"79af3ece-104f-44eb-a019-dfd6d8c9be1e"]
}, Open  ]],
Cell[CellGroupData[{
Cell[695040, 17934, 609, 17, 25, "Input",ExpressionUUID->"8249e68c-c604-418c-8e10-65a3537682c6"],
Cell[695652, 17953, 463, 14, 29, "Output",ExpressionUUID->"d90b0462-fcef-4357-9692-d8678226ecb2"]
}, Open  ]],
Cell[CellGroupData[{
Cell[696152, 17972, 2412, 64, 182, "Input",ExpressionUUID->"36842584-be4a-4e3f-8144-c16d8f198184"],
Cell[CellGroupData[{
Cell[698589, 18040, 433, 14, 22, "Echo",ExpressionUUID->"d2d6c11f-4cfe-47c7-80d4-caaf3ede69e5"],
Cell[699025, 18056, 433, 14, 22, "Echo",ExpressionUUID->"1c8ebf01-b8b7-429c-9773-bd154449280d"],
Cell[699461, 18072, 850, 28, 22, "Echo",ExpressionUUID->"af7a6268-bc9a-4212-ba8f-c75e18d75a1f"]
}, Open  ]],
Cell[700326, 18103, 1121, 36, 29, "Output",ExpressionUUID->"24be7384-a74f-4465-b5c6-05a6f3a59f71"]
}, Open  ]],
Cell[701462, 18142, 408, 10, 25, "Input",ExpressionUUID->"40c7d932-d2b0-405f-a8c8-71b50c26d01d"],
Cell[CellGroupData[{
Cell[701895, 18156, 3797, 95, 251, "Input",ExpressionUUID->"77c2a842-80ca-4cc9-84df-12d1c983d6c8"],
Cell[CellGroupData[{
Cell[705717, 18255, 920, 31, 22, "Echo",ExpressionUUID->"33c1b274-4ba9-4f5b-87f0-2b9d82427101"],
Cell[706640, 18288, 507, 17, 22, "Echo",ExpressionUUID->"4b13c53f-3081-4fb6-9c03-a72e9259b53a"],
Cell[707150, 18307, 207, 6, 22, "Echo",ExpressionUUID->"e7b9400b-2ce3-4423-8e13-98a176f95060"],
Cell[707360, 18315, 291, 9, 22, "Echo",ExpressionUUID->"6f055203-f3c6-4f7c-a991-b1c366361ffa"],
Cell[707654, 18326, 507, 17, 22, "Echo",ExpressionUUID->"aa51cc58-fdb4-41b8-92b3-73129ce63f01"],
Cell[708164, 18345, 291, 9, 22, "Echo",ExpressionUUID->"08bb6433-a2d7-4c07-b17d-4cdf6b965a80"],
Cell[708458, 18356, 209, 6, 22, "Echo",ExpressionUUID->"d329b1fc-f632-43aa-8707-61230c2a81ac"]
}, Open  ]],
Cell[708682, 18365, 1221, 36, 29, "Output",ExpressionUUID->"3d446e91-2373-4f55-a546-163129f30038"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[709952, 18407, 194, 3, 40, "Subsubsection",ExpressionUUID->"b4d5db34-6e1d-43f5-a1c3-e847400c23af"],
Cell[710149, 18412, 322, 7, 24, "Input",ExpressionUUID->"3dbbe892-9064-4782-82fc-02e2cce2e6d0"],
Cell[710474, 18421, 11464, 221, 560, "Input",ExpressionUUID->"f9bb6dd1-1128-40d4-9a53-768ee7a57122"],
Cell[CellGroupData[{
Cell[721963, 18646, 323, 7, 24, "Input",ExpressionUUID->"3a290735-fe40-466d-b6a3-9a56724e671f"],
Cell[722289, 18655, 671, 21, 21, "Echo",ExpressionUUID->"3fe489dd-1834-427b-830f-193aa5503da5"],
Cell[722963, 18678, 4297, 98, 64, "Output",ExpressionUUID->"49c22c19-9962-4b0b-ae0d-72ceda53eae8"]
}, Open  ]],
Cell[CellGroupData[{
Cell[727297, 18781, 235, 5, 24, "Input",ExpressionUUID->"206cc607-c30e-4799-9d14-fe8bf79d22ea"],
Cell[727535, 18788, 1703, 50, 81, "Output",ExpressionUUID->"0fcaed83-10a9-4ab1-a656-6f3f6fe81881"]
}, Open  ]]
}, Closed]]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[729311, 18846, 152, 3, 59, "Section",ExpressionUUID->"1eb813e5-eb86-422b-80ef-1b0d78428a57"],
Cell[729466, 18851, 909, 20, 61, "Input",ExpressionUUID->"2a3c4fd2-45b2-418c-ab38-1c6fa90075f4"],
Cell[CellGroupData[{
Cell[730400, 18875, 1891, 41, 25, "Input",ExpressionUUID->"f20cf379-ca3a-421a-848c-496ccd712607"],
Cell[732294, 18918, 1896, 41, 29, "Output",ExpressionUUID->"81f60468-6fa7-4ca0-a37b-212619715b74"]
}, Open  ]],
Cell[CellGroupData[{
Cell[734227, 18964, 1077, 23, 25, "Input",ExpressionUUID->"38ec4194-d329-4742-8103-47d748fdbad7"],
Cell[735307, 18989, 1101, 23, 29, "Output",ExpressionUUID->"e3ea542e-756b-409a-9ec8-1fd67d8920bf"]
}, Open  ]],
Cell[CellGroupData[{
Cell[736445, 19017, 1248, 28, 25, "Input",ExpressionUUID->"9e89401b-8e02-49d3-9905-182a02de9c6e"],
Cell[737696, 19047, 1440, 32, 29, "Output",ExpressionUUID->"15cadca2-c1fd-4e8a-89f4-39b2dabd7da9"]
}, Open  ]],
Cell[CellGroupData[{
Cell[739173, 19084, 1077, 23, 25, "Input",ExpressionUUID->"6a251773-c528-4082-99ba-411cc6bd9662"],
Cell[740253, 19109, 1077, 23, 29, "Output",ExpressionUUID->"570d70dd-bb95-4de5-832a-c7608d40195c"]
}, Open  ]],
Cell[CellGroupData[{
Cell[741367, 19137, 2185, 47, 25, "Input",ExpressionUUID->"84baecbc-9ad0-49c2-9a65-a66861a26e2f"],
Cell[743555, 19186, 2165, 47, 29, "Output",ExpressionUUID->"f5a6a4d6-b654-4b85-82e1-a5d7d83ab15a"]
}, Open  ]],
Cell[CellGroupData[{
Cell[745757, 19238, 1077, 23, 25, "Input",ExpressionUUID->"ed116a17-dc09-4749-8be7-8c6a24956418"],
Cell[746837, 19263, 1079, 23, 29, "Output",ExpressionUUID->"79312cf0-c931-48c3-9357-bcd07be4d16d"]
}, Open  ]],
Cell[CellGroupData[{
Cell[747953, 19291, 1632, 35, 25, "Input",ExpressionUUID->"21eb3548-77e6-4f9f-a817-0f2bd2ffe3f4"],
Cell[749588, 19328, 1622, 35, 29, "Output",ExpressionUUID->"a8870eed-cb9d-45ce-9f74-a0297b9665cd"]
}, Open  ]],
Cell[CellGroupData[{
Cell[751247, 19368, 920, 20, 25, "Input",ExpressionUUID->"353623b9-0e80-4477-ac0b-9e63727d9452"],
Cell[752170, 19390, 1031, 23, 29, "Output",ExpressionUUID->"bed984a3-60c6-49a9-ba09-f128cedabe3b"]
}, Open  ]],
Cell[CellGroupData[{
Cell[753238, 19418, 223, 4, 48, "Subsection",ExpressionUUID->"3c299e33-1dee-41a4-9a80-62ef7b720a17"],
Cell[753464, 19424, 452, 11, 43, "Input",ExpressionUUID->"8a620c00-cb93-45c1-a063-22266a9b0b16"],
Cell[753919, 19437, 316, 7, 25, "Input",ExpressionUUID->"93b68b0e-132d-4641-8fc8-706d0ebfb360"],
Cell[754238, 19446, 565, 11, 43, "Input",ExpressionUUID->"f0145306-b514-4698-959f-56afc2c1f5c4"],
Cell[754806, 19459, 392, 11, 25, "Input",ExpressionUUID->"b74b620b-b7c7-465e-a54e-5973dd1f6382"],
Cell[755201, 19472, 232, 4, 25, "Input",ExpressionUUID->"821256e4-99e2-4841-92af-b6ef121b38a3"],
Cell[CellGroupData[{
Cell[755458, 19480, 16077, 355, 1078, "Input",ExpressionUUID->"a21a3d0d-9bd5-49c3-9267-621f0f12747d"],
Cell[CellGroupData[{
Cell[771560, 19839, 1784, 41, 22, "Echo",ExpressionUUID->"bbbfaeef-6e9e-4c36-a67d-11d3591e1ed2"],
Cell[773347, 19882, 1961, 46, 22, "Echo",ExpressionUUID->"02de7fc0-ff3e-4c09-9837-b9e1ebe324c8"],
Cell[775311, 19930, 1082, 38, 22, "Echo",ExpressionUUID->"24ff5344-4a6a-4d59-86ee-109df420a356"],
Cell[776396, 19970, 1123, 39, 22, "Echo",ExpressionUUID->"3975fd84-b5af-431b-b9e3-19799bca0d60"],
Cell[777522, 20011, 906, 32, 22, "Echo",ExpressionUUID->"62749d3c-ed29-4e85-8b1e-55ea3be9e9de"],
Cell[778431, 20045, 464, 16, 22, "Echo",ExpressionUUID->"9bd1be80-fce5-46e2-8906-e39fcbfd50f9"],
Cell[778898, 20063, 1440, 50, 36, "Echo",ExpressionUUID->"36eeec0a-2b5f-44cc-93cd-132023387e24"],
Cell[780341, 20115, 1639, 57, 36, "Echo",ExpressionUUID->"e2750471-622a-4a26-b4f4-2a858898e5d4"],
Cell[781983, 20174, 1637, 57, 36, "Echo",ExpressionUUID->"1e2ee083-d584-4ec3-b4f9-c53a71c3daf8"],
Cell[783623, 20233, 3322, 112, 68, "Echo",ExpressionUUID->"2df19dab-8715-4d60-894b-39c2898889a6"],
Cell[786948, 20347, 939, 33, 22, "Echo",ExpressionUUID->"35e55a37-e71a-40d7-b2b1-5e56ef97a374"],
Cell[787890, 20382, 936, 33, 22, "Echo",ExpressionUUID->"7be4ac81-586a-4c7c-a9d7-98aba55e9238"],
Cell[788829, 20417, 938, 33, 22, "Echo",ExpressionUUID->"7de44875-aff4-41bc-b02b-8155211a765f"],
Cell[789770, 20452, 938, 33, 22, "Echo",ExpressionUUID->"435426cc-f162-4d9f-8513-40914dcdfc63"],
Cell[790711, 20487, 3980, 129, 68, "Echo",ExpressionUUID->"22a31e8d-5474-42f2-8815-b1ec20b28d9e"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[794740, 20622, 206, 4, 25, "Input",ExpressionUUID->"ff667d10-61ed-41b3-9733-c268739ee965"],
Cell[794949, 20628, 175, 3, 29, "Output",ExpressionUUID->"85051ad9-a91e-457e-a92a-d2a577c1d136"]
}, Open  ]],
Cell[CellGroupData[{
Cell[795161, 20636, 1247, 38, 43, "Input",ExpressionUUID->"9151977c-cb43-491f-b539-f61de64f6276"],
Cell[796411, 20676, 1105, 35, 47, "Output",ExpressionUUID->"a600b45b-1853-4c07-87f2-202b4d369de5"]
}, Open  ]],
Cell[CellGroupData[{
Cell[797553, 20716, 1843, 56, 61, "Input",ExpressionUUID->"6a47fcdf-26f3-468a-a677-2302a92d38bb"],
Cell[799399, 20774, 1018, 31, 29, "Output",ExpressionUUID->"db74fdb2-424c-4783-b13c-3b42c766908c"],
Cell[800420, 20807, 1018, 31, 29, "Output",ExpressionUUID->"c8816a38-50af-4888-a047-17d8302b8105"]
}, Open  ]],
Cell[801453, 20841, 205, 4, 25, "Input",ExpressionUUID->"a3864c98-b3a4-46c1-8587-ccb5219f8e12"],
Cell[CellGroupData[{
Cell[801683, 20849, 1734, 53, 61, "Input",ExpressionUUID->"15c21077-cb16-4408-b63b-2eb2775c1046"],
Cell[803420, 20904, 991, 31, 29, "Output",ExpressionUUID->"7c6b41ff-812c-4d95-bf9f-227d97345679"],
Cell[804414, 20937, 994, 31, 29, "Output",ExpressionUUID->"0a2d596a-67e4-4d3c-8a4f-aa9876a1d7de"]
}, Open  ]],
Cell[CellGroupData[{
Cell[805445, 20973, 365, 9, 25, "Input",ExpressionUUID->"5c502dee-2905-44a4-b345-588944af9c4a"],
Cell[805813, 20984, 230, 5, 29, "Output",ExpressionUUID->"88955751-eceb-419a-aa70-03a59ed61a93"]
}, Open  ]],
Cell[806058, 20992, 325, 8, 25, "Input",ExpressionUUID->"342da5c9-82c2-450b-8e17-895f96ed8406"],
Cell[806386, 21002, 584, 11, 43, "Input",ExpressionUUID->"e3b5d3ef-7bac-42f6-bdcd-9a145c15d1ec"],
Cell[CellGroupData[{
Cell[806995, 21017, 1269, 37, 25, "Input",ExpressionUUID->"517a29ba-ac55-4fa6-a375-d08159f6986c"],
Cell[808267, 21056, 1142, 35, 29, "Output",ExpressionUUID->"171eb547-8b1b-48d0-aa76-792fd7c58287"]
}, Open  ]],
Cell[CellGroupData[{
Cell[809446, 21096, 163, 3, 40, "Subsubsection",ExpressionUUID->"a7c43109-42e9-496c-bf56-a0f846fd36a5"],
Cell[809612, 21101, 6144, 174, 285, "Input",ExpressionUUID->"38dc32b6-3ac9-4ab2-a744-d8c132ec655e"]
}, Open  ]],
Cell[CellGroupData[{
Cell[815793, 21280, 261, 4, 40, "Subsubsection",ExpressionUUID->"933b4225-2f3c-42b9-9e79-ea24c328882e"],
Cell[816057, 21286, 438, 9, 43, "Input",ExpressionUUID->"5e5a19e5-5af1-4768-94d8-b9810f7972ed"],
Cell[816498, 21297, 376, 8, 25, "Input",ExpressionUUID->"b8a0a99c-3972-4141-9b26-3998adc288d3"],
Cell[816877, 21307, 253, 4, 25, "Input",ExpressionUUID->"1e78ad1e-828a-4f7a-9e41-b42123c9991a"],
Cell[817133, 21313, 768, 16, 43, "Input",ExpressionUUID->"26fd9663-70dc-452c-909b-941953bba6cb"],
Cell[817904, 21331, 1666, 45, 95, "Input",ExpressionUUID->"7861e8b5-1ee7-4e4b-a94b-71ea3791e20d"],
Cell[819573, 21378, 3424, 106, 147, "Input",ExpressionUUID->"ebe55d40-ac7f-43c6-826c-4e01f894bf35"],
Cell[CellGroupData[{
Cell[823022, 21488, 1459, 36, 25, "Input",ExpressionUUID->"cf237e59-253a-442c-9bfb-e3ac7abd70dd"],
Cell[824484, 21526, 1004, 23, 29, "Output",ExpressionUUID->"52bc1c0c-b1f0-4205-898f-40cb62264527"]
}, Open  ]],
Cell[825503, 21552, 224, 5, 25, "Input",ExpressionUUID->"748865f4-9a49-4768-8521-9cd3d8d69897"],
Cell[825730, 21559, 4864, 126, 217, "Input",ExpressionUUID->"05ace628-fc58-427c-a025-d42fd6f03892"],
Cell[CellGroupData[{
Cell[830619, 21689, 1533, 39, 25, "Input",ExpressionUUID->"5dad9e7f-02df-451c-ab61-2434c702c1b3"],
Cell[832155, 21730, 745, 17, 29, "Output",ExpressionUUID->"0ae52211-a964-46a9-8e0f-dfdd4afca944"]
}, Open  ]],
Cell[CellGroupData[{
Cell[832937, 21752, 2627, 67, 43, "Input",ExpressionUUID->"f0537cd5-1fe7-42ca-a678-62b17bb190e0"],
Cell[835567, 21821, 733, 16, 29, "Output",ExpressionUUID->"955d46b2-3ff4-4f2e-8d4d-d793d9317836"]
}, Open  ]],
Cell[836315, 21840, 354, 7, 25, "Input",ExpressionUUID->"da451f92-a30a-4666-bdbc-0b08a9395d6a"],
Cell[836672, 21849, 5041, 129, 217, "Input",ExpressionUUID->"de592eb5-e0e7-4e54-b586-a4321e986cca"],
Cell[CellGroupData[{
Cell[841738, 21982, 2925, 74, 43, "Input",ExpressionUUID->"b1c2b205-68d8-48c8-9678-7e77d0ed140a"],
Cell[844666, 22058, 1220, 24, 29, "Output",ExpressionUUID->"3603dfed-8eef-424d-9ae8-5100bb124fdb"]
}, Open  ]],
Cell[845901, 22085, 514, 9, 25, "Input",ExpressionUUID->"73529045-2b0c-40f0-a382-ecdc23c3e03d"],
Cell[846418, 22096, 5357, 138, 234, "Input",ExpressionUUID->"4e86c2e9-5cad-4dac-8a83-cc7d8863d383"],
Cell[CellGroupData[{
Cell[851800, 22238, 2667, 66, 43, "Input",ExpressionUUID->"14d9b329-15f7-4151-8acd-86380034d9b6"],
Cell[854470, 22306, 1261, 28, 29, "Output",ExpressionUUID->"461a2d81-2a30-4bee-a39c-cc64377b3a19"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[855780, 22340, 318, 5, 33, "Subsubsection",ExpressionUUID->"1c2fbff2-b82d-4219-af41-b8486056a63a"],
Cell[856101, 22347, 428, 8, 25, "Input",ExpressionUUID->"80422f3a-6b14-4b44-a000-0e803a1161d2"],
Cell[856532, 22357, 457, 8, 43, "Input",ExpressionUUID->"a7d43a4b-6ee6-4d09-858d-8d765dd58de6"],
Cell[856992, 22367, 395, 7, 25, "Input",ExpressionUUID->"f266d55a-0b4d-4e40-8330-cb7aa5a197a4"],
Cell[857390, 22376, 253, 4, 25, "Input",ExpressionUUID->"c335c40d-1c38-4844-8374-4b15ca80e422"],
Cell[857646, 22382, 790, 16, 43, "Input",ExpressionUUID->"f7c342ac-7c96-4113-bd34-6cc26730cb4e"],
Cell[858439, 22400, 654, 13, 25, "Input",ExpressionUUID->"a4714f37-72b0-4bc9-858b-02d39144d024"],
Cell[859096, 22415, 3424, 106, 147, "Input",ExpressionUUID->"f3a22890-47a2-4b77-89df-1624da60bd41"],
Cell[CellGroupData[{
Cell[862545, 22525, 1455, 35, 25, "Input",ExpressionUUID->"5fbe4e67-822f-4d6a-82e4-f8fdfe8b0f0e"],
Cell[864003, 22562, 674, 15, 33, "Output",ExpressionUUID->"31041024-580f-446e-95b1-d324a1a4fd1a"]
}, Open  ]],
Cell[864692, 22580, 243, 4, 25, "Input",ExpressionUUID->"1f944bce-78c2-4fbd-bb57-2ae2deb8651c"],
Cell[864938, 22586, 3669, 94, 148, "Input",ExpressionUUID->"b3206d82-2e7d-4b48-93d2-93040dbb9fa9"],
Cell[CellGroupData[{
Cell[868632, 22684, 1533, 39, 25, "Input",ExpressionUUID->"2689bf15-c105-4548-9b26-4faec881df69"],
Cell[870168, 22725, 728, 15, 29, "Output",ExpressionUUID->"9044bf5e-f146-4bf8-9cc1-e8a3e1d82d83"]
}, Open  ]],
Cell[CellGroupData[{
Cell[870933, 22745, 2627, 67, 43, "Input",ExpressionUUID->"3254437a-feb0-4908-9d84-dd895fe44624"],
Cell[873563, 22814, 716, 15, 29, "Output",ExpressionUUID->"842c52a4-3a86-48f9-b15f-67b1f9483468"]
}, Open  ]],
Cell[874294, 22832, 372, 6, 25, "Input",ExpressionUUID->"78b2eca3-c651-422a-a7e1-7c1636604b58"],
Cell[874669, 22840, 3845, 96, 148, "Input",ExpressionUUID->"c9218999-c805-42e3-b3cd-189f9f843517"],
Cell[CellGroupData[{
Cell[878539, 22940, 2925, 74, 43, "Input",ExpressionUUID->"252cf876-68f7-40c8-8675-30928afe0f4f"],
Cell[881467, 23016, 901, 17, 29, "Output",ExpressionUUID->"0015ce6f-4ac8-4384-b4dc-819d037c8d16"]
}, Open  ]],
Cell[882383, 23036, 536, 9, 25, "Input",ExpressionUUID->"8ba31588-f887-4e99-af7e-72203fa5e2fe"],
Cell[882922, 23047, 4134, 106, 165, "Input",ExpressionUUID->"7202d8f1-dee6-428b-8367-6802daa93fa0"],
Cell[CellGroupData[{
Cell[887081, 23157, 2667, 66, 43, "Input",ExpressionUUID->"da6d5413-8603-471d-b3ee-8549b138c6d4"],
Cell[889751, 23225, 689, 15, 29, "Output",ExpressionUUID->"94ba0b40-5c0d-434d-baa7-31a625eb4332"]
}, Open  ]]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[890501, 23247, 181, 3, 34, "Subsection",ExpressionUUID->"0abf6bda-6483-44c8-92e3-379763ba6124"],
Cell[890685, 23252, 452, 11, 43, "Input",ExpressionUUID->"8ea67f67-5b15-4f2c-9bfd-4cd49ca67edf"],
Cell[891140, 23265, 316, 7, 25, "Input",ExpressionUUID->"901a06ee-ab37-4212-91e6-50c6a82ff3ce"],
Cell[891459, 23274, 546, 12, 43, "Input",ExpressionUUID->"11037868-3643-4f4f-824c-ca66ac48de92"],
Cell[892008, 23288, 391, 11, 25, "Input",ExpressionUUID->"a12ee71a-b263-4820-b4d1-5ec0abe5a7b0"],
Cell[892402, 23301, 213, 5, 25, "Input",ExpressionUUID->"315250b5-021d-4dc5-b455-82764f41220d"],
Cell[CellGroupData[{
Cell[892640, 23310, 18355, 413, 1285, "Input",ExpressionUUID->"6f7df21a-61a7-4fa4-8f0c-8138ef1a15da"],
Cell[CellGroupData[{
Cell[911020, 23727, 1782, 41, 22, "Echo",ExpressionUUID->"ef19cebe-0416-46b6-be87-9cebf3ff0077"],
Cell[912805, 23770, 1961, 46, 22, "Echo",ExpressionUUID->"09dac705-d96d-457c-8ed9-2f806d499c08"],
Cell[914769, 23818, 1082, 38, 22, "Echo",ExpressionUUID->"5b9eaf87-ef73-446c-aa72-c3b0eb6e124a"],
Cell[915854, 23858, 1121, 39, 22, "Echo",ExpressionUUID->"515bc58f-f558-45ac-aed2-835ff1f7a5d7"],
Cell[916978, 23899, 906, 32, 22, "Echo",ExpressionUUID->"783f1a47-69b1-4067-b544-72603872824e"],
Cell[917887, 23933, 464, 16, 22, "Echo",ExpressionUUID->"13d3a610-00a0-4efe-a1a9-5fabf09a250c"],
Cell[918354, 23951, 1440, 50, 36, "Echo",ExpressionUUID->"23c30912-fa52-46af-a394-677bfdcb405c"],
Cell[919797, 24003, 1639, 57, 36, "Echo",ExpressionUUID->"da767dba-72bd-491d-84cb-45958f1dd371"],
Cell[921439, 24062, 1639, 57, 36, "Echo",ExpressionUUID->"bbceabc1-1e15-4b49-9bf9-880680026365"],
Cell[923081, 24121, 3322, 112, 68, "Echo",ExpressionUUID->"7f7f8b62-396f-402b-b9aa-8955ea551a6f"],
Cell[926406, 24235, 939, 33, 22, "Echo",ExpressionUUID->"1a0ec3b8-ebea-4d7e-8101-24bc8e9db81e"],
Cell[927348, 24270, 938, 33, 22, "Echo",ExpressionUUID->"ab25d15c-f7d0-44f0-b412-4dda7125dd5a"],
Cell[928289, 24305, 936, 33, 22, "Echo",ExpressionUUID->"fb73a9fa-aa23-4ec2-aa4c-5ee9ae722c2a"],
Cell[929228, 24340, 936, 33, 22, "Echo",ExpressionUUID->"860fe5bb-ace3-438d-97d5-d5f8c6539cb2"],
Cell[930167, 24375, 3564, 117, 68, "Echo",ExpressionUUID->"b5bbe8ae-ba2f-400c-984a-f80b9213f1bb"]
}, Open  ]],
Cell[933746, 24495, 3297, 77, 47, "Output",ExpressionUUID->"bd2c1a21-d4eb-443a-b2fd-1583b505191e"]
}, Open  ]],
Cell[937058, 24575, 13926, 329, 1165, "Input",ExpressionUUID->"2b40b1f7-3086-4b7b-9c33-ea48fd1ececf"],
Cell[CellGroupData[{
Cell[951009, 24908, 181, 3, 25, "Input",ExpressionUUID->"05cc91c9-5d94-4433-a677-4d993f0bb749"],
Cell[951193, 24913, 1809, 41, 29, "Output",ExpressionUUID->"5a0dfac8-46ba-4b9f-89db-bf73cb712dc0"]
}, Open  ]],
Cell[CellGroupData[{
Cell[953039, 24959, 218, 4, 25, "Input",ExpressionUUID->"e3c32ef3-ffb4-4597-88f5-ed701c7f0df5"],
Cell[953260, 24965, 3247, 76, 47, "Output",ExpressionUUID->"f1eadefb-a288-48fa-9655-032925cb9c90"]
}, Open  ]],
Cell[CellGroupData[{
Cell[956544, 25046, 182, 3, 25, "Input",ExpressionUUID->"13268e88-1c7a-4d2f-853d-80f7f26ce26f"],
Cell[956729, 25051, 1010, 23, 29, "Output",ExpressionUUID->"93e164b2-360a-4ea2-87c6-8c87e261474a"]
}, Open  ]],
Cell[CellGroupData[{
Cell[957776, 25079, 219, 4, 25, "Input",ExpressionUUID->"6788363f-d879-4bce-a957-94d300b58388"],
Cell[957998, 25085, 1524, 37, 29, "Output",ExpressionUUID->"ca1e1585-c5c1-4f89-a635-e6a264891228"]
}, Open  ]],
Cell[CellGroupData[{
Cell[959559, 25127, 184, 3, 25, "Input",ExpressionUUID->"4782b7ff-af8b-4fc9-84e5-f2d395ab9d4c"],
Cell[959746, 25132, 1353, 32, 29, "Output",ExpressionUUID->"07ba6c80-b3e9-4c9d-840c-ad33a4448d36"]
}, Open  ]],
Cell[CellGroupData[{
Cell[961136, 25169, 215, 4, 25, "Input",ExpressionUUID->"1fff6da2-e51b-49aa-ab97-d1116e83c9e9"],
Cell[961354, 25175, 1702, 41, 29, "Output",ExpressionUUID->"80c3b473-73c2-4f41-a980-0004f6a83bc9"]
}, Open  ]],
Cell[CellGroupData[{
Cell[963093, 25221, 182, 3, 25, "Input",ExpressionUUID->"2ecb74eb-c962-47da-8f6d-bb02fd6861b1"],
Cell[963278, 25226, 1010, 23, 29, "Output",ExpressionUUID->"1abf0823-d407-4b0c-b7b8-9d6edd64fb53"]
}, Open  ]],
Cell[CellGroupData[{
Cell[964325, 25254, 210, 4, 25, "Input",ExpressionUUID->"4c8f6b8f-63d5-4d95-a02d-f3bc18ba0046"],
Cell[964538, 25260, 1524, 37, 29, "Output",ExpressionUUID->"80bf2753-f121-4014-8a12-12faefc10505"]
}, Open  ]],
Cell[CellGroupData[{
Cell[966099, 25302, 182, 3, 25, "Input",ExpressionUUID->"6bd051f4-ac10-4c1b-8cf2-7d97b22c6aa6"],
Cell[966284, 25307, 2098, 47, 29, "Output",ExpressionUUID->"ba008d04-5f25-400e-aaa8-c50d00850f9f"]
}, Open  ]],
Cell[CellGroupData[{
Cell[968419, 25359, 208, 3, 25, "Input",ExpressionUUID->"a446b497-51ec-4811-82a3-d275dd2c0035"],
Cell[968630, 25364, 6085, 150, 81, "Output",ExpressionUUID->"e9268e4b-04b2-4637-aeb5-d9ad24c60851"]
}, Open  ]],
Cell[974730, 25517, 425, 12, 25, "Input",ExpressionUUID->"a4319ac6-26ef-4d2b-81e6-0f47d0d2d97d"],
Cell[975158, 25531, 452, 11, 43, "Input",ExpressionUUID->"d4b2b5b1-1100-400c-8d76-f79a79792601"],
Cell[975613, 25544, 316, 7, 25, "Input",ExpressionUUID->"2707c172-17ba-4246-a014-d1d425c308cf"],
Cell[975932, 25553, 546, 12, 43, "Input",ExpressionUUID->"604b71e2-449d-4863-9d3e-b355a8e96a30"],
Cell[976481, 25567, 391, 11, 25, "Input",ExpressionUUID->"dcd0d7ca-3c92-4952-9c26-b173aa55daa3"],
Cell[CellGroupData[{
Cell[976897, 25582, 20903, 476, 1372, "Input",ExpressionUUID->"9c45040b-3b38-4f83-9713-ce6ec2a51360"],
Cell[CellGroupData[{
Cell[997825, 26062, 2073, 47, 22, "Echo",ExpressionUUID->"db69ae52-afad-4692-8e83-5adf25f109ad"],
Cell[999901, 26111, 2262, 52, 22, "Echo",ExpressionUUID->"ae3e21f1-87a3-4583-82fa-5501fdca0421"],
Cell[1002166, 26165, 1080, 38, 22, "Echo",ExpressionUUID->"3efc8a58-aaed-4b92-9b1c-ae9b16680f1a"],
Cell[1003249, 26205, 1123, 39, 22, "Echo",ExpressionUUID->"c0b50170-c127-4162-8cbe-d258862db91d"],
Cell[1004375, 26246, 904, 32, 22, "Echo",ExpressionUUID->"cffde93d-2655-4449-94ee-7d26d4e6b541"],
Cell[1005282, 26280, 466, 16, 22, "Echo",ExpressionUUID->"aaab8f3f-1561-4df0-8f18-ab2e49470e8f"],
Cell[1005751, 26298, 1808, 62, 36, "Echo",ExpressionUUID->"34265166-eb9e-422e-b7d6-488202891c10"],
Cell[1007562, 26362, 3817, 127, 68, "Echo",ExpressionUUID->"91cdab64-4a46-4944-8dc2-bf627dc031b7"],
Cell[1011382, 26491, 2075, 71, 36, "Echo",ExpressionUUID->"00cad49b-d165-4ce6-bf07-4df81ca26748"],
Cell[1013460, 26564, 4052, 136, 68, "Echo",ExpressionUUID->"33e4d838-9bc5-4b82-aea6-0a23c2ce2cf0"],
Cell[1017515, 26702, 1134, 40, 22, "Echo",ExpressionUUID->"05172b02-aa5e-4b68-95ef-4a45bdc616c6"],
Cell[1018652, 26744, 1134, 40, 22, "Echo",ExpressionUUID->"3aa66a5e-6c1c-42cd-9cfe-2e07b788c16e"],
Cell[1019789, 26786, 1134, 40, 22, "Echo",ExpressionUUID->"e3542ab4-69ff-448f-936a-96bf18cd52c0"],
Cell[1020926, 26828, 1136, 40, 22, "Echo",ExpressionUUID->"0ed6005e-045e-485a-8397-fdcc6e99a2b2"],
Cell[1022065, 26870, 6113, 175, 99, "Echo",ExpressionUUID->"0eaecc8c-df5a-4666-a74d-8514b42a89d8"]
}, Open  ]],
Cell[1028193, 27048, 3637, 83, 47, "Output",ExpressionUUID->"4bc84e82-5f2b-401a-a1d6-de8f89c55a7c"]
}, Open  ]],
Cell[1031845, 27134, 16110, 389, 1268, "Input",ExpressionUUID->"19e95b48-46f7-4530-9445-3054af918569"],
Cell[CellGroupData[{
Cell[1047980, 27527, 249, 4, 25, "Input",ExpressionUUID->"ff9a93be-2f9b-425f-a824-88199b4526bb"],
Cell[1048232, 27533, 3426, 78, 47, "Output",ExpressionUUID->"9fdf4d7d-209a-455d-8cec-0b7cca6e212f"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1051695, 27616, 213, 3, 25, "Input",ExpressionUUID->"0ba7ca99-503c-43f6-a675-164e09923def"],
Cell[1051911, 27621, 3420, 80, 47, "Output",ExpressionUUID->"2c9d953f-1303-4ec9-ab95-89a32dc408c0"]
}, Open  ]],
Cell[1055346, 27704, 266, 7, 25, "Input",ExpressionUUID->"2b7ad543-32b2-442e-876e-b397c67b688d"],
Cell[CellGroupData[{
Cell[1055637, 27715, 920, 20, 25, "Input",ExpressionUUID->"7fb3fb6e-a4b0-47db-b348-aaa8b73b4b25"],
Cell[1056560, 27737, 1009, 23, 29, "Output",ExpressionUUID->"affdc8e3-532f-48f1-961f-328fe6f9dcb9"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1057606, 27765, 26253, 585, 1820, "Input",ExpressionUUID->"13e8ffc4-cc19-4012-a9dc-3d87c02c4bc1"],
Cell[CellGroupData[{
Cell[1083884, 28354, 988, 24, 22, "Echo",ExpressionUUID->"eecd9a29-9c17-480d-86cb-b9953b40c95a"],
Cell[1084875, 28380, 921, 24, 22, "Echo",ExpressionUUID->"f322f312-b439-42c3-9822-b10d6a5248d6"],
Cell[1085799, 28406, 1060, 36, 36, "Echo",ExpressionUUID->"ec0c10db-7c0a-42bf-b579-7c02bb78a8f8"],
Cell[1086862, 28444, 1104, 38, 36, "Echo",ExpressionUUID->"5bd64d05-382e-4d95-aca6-d683a7972fd5"],
Cell[1087969, 28484, 756, 26, 22, "Echo",ExpressionUUID->"bec576e7-4dab-4a0d-9090-ec1f981d3ad5"],
Cell[1088728, 28512, 714, 25, 22, "Echo",ExpressionUUID->"13c23b83-14d8-4340-90b6-495ff86179ef"],
Cell[1089445, 28539, 628, 22, 22, "Echo",ExpressionUUID->"e9f7bf02-85b2-4863-9690-454eb8cd5c3b"],
Cell[1090076, 28563, 691, 25, 22, "Echo",ExpressionUUID->"ce48168d-3a6b-4020-bbcf-d8110ba31d08"],
Cell[1090770, 28590, 693, 25, 22, "Echo",ExpressionUUID->"bce700e4-15ac-4bc5-9a3a-f25e295f2d54"],
Cell[1091466, 28617, 609, 21, 22, "Echo",ExpressionUUID->"6fd8f9a6-e6bc-4006-81ff-1c7f32c9f5a1"],
Cell[1092078, 28640, 521, 18, 22, "Echo",ExpressionUUID->"747fc2c0-dd83-4dfe-ab1d-ebf18cb43cd9"],
Cell[1092602, 28660, 1101, 35, 22, "Echo",ExpressionUUID->"712a221b-9978-47b6-888b-5bfabe08d3e6"]
}, Open  ]],
Cell[1093718, 28698, 1200, 26, 29, "Output",ExpressionUUID->"997962f6-cf2c-4ebf-a0b8-4cd755c5af67"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[1094967, 28730, 159, 3, 34, "Subsection",ExpressionUUID->"6ac43564-ffa6-4144-8116-76a7d13f20ef"],
Cell[CellGroupData[{
Cell[1095151, 28737, 160, 3, 40, "Subsubsection",ExpressionUUID->"03faa4f3-3223-470c-a928-c0af0107a0d2"],
Cell[1095314, 28742, 470, 10, 43, "Input",ExpressionUUID->"1a303b3a-4a05-45c9-8894-ec18f6fb3425"],
Cell[1095787, 28754, 317, 7, 25, "Input",ExpressionUUID->"6fa8236b-8708-429b-8ab0-ec274bfb7f90"],
Cell[1096107, 28763, 565, 11, 43, "Input",ExpressionUUID->"0c18ab0b-2438-42e3-a12f-a36973d541e3"],
Cell[1096675, 28776, 392, 11, 25, "Input",ExpressionUUID->"2f1f27ba-906e-480f-b28a-4d710a006de4"]
}, Closed]],
Cell[CellGroupData[{
Cell[1097104, 28792, 163, 3, 33, "Subsubsection",ExpressionUUID->"dbea6423-3bbe-426e-80e5-16d596d1e50d"],
Cell[1097270, 28797, 6144, 174, 285, "Input",ExpressionUUID->"9b7785cc-c688-4855-bf4d-d5180e0e4fb7"]
}, Closed]],
Cell[CellGroupData[{
Cell[1103451, 28976, 361, 6, 33, "Subsubsection",ExpressionUUID->"968317ad-76a7-4ae8-b8fc-9cd50b09e6a5"],
Cell[1103815, 28984, 428, 8, 25, "Input",ExpressionUUID->"7f10ed73-a334-444e-90b4-d5b97d68f5b2"],
Cell[1104246, 28994, 457, 8, 43, "Input",ExpressionUUID->"1acb2a78-6b53-45c7-9311-949c1cbaf04e"],
Cell[1104706, 29004, 395, 7, 25, "Input",ExpressionUUID->"54d1b74c-d2d4-4eb6-afb7-c7ab8c3f8475"],
Cell[1105104, 29013, 253, 4, 25, "Input",ExpressionUUID->"5ab43999-ce2a-4e46-b2ff-00b7be95d076"],
Cell[1105360, 29019, 790, 16, 43, "Input",ExpressionUUID->"44eb6dce-fcff-4f86-9076-c33389a06d85"],
Cell[1106153, 29037, 654, 13, 25, "Input",ExpressionUUID->"308c997b-cc1a-4df2-bc5f-82f73ad12270"],
Cell[1106810, 29052, 3424, 106, 147, "Input",ExpressionUUID->"fc2a828d-9477-40c3-8751-5f947af66fce"],
Cell[CellGroupData[{
Cell[1110259, 29162, 1437, 34, 25, "Input",ExpressionUUID->"2ee7bc45-4369-47bf-9e0a-45ef6c92ca84"],
Cell[1111699, 29198, 614, 13, 70, "Output",ExpressionUUID->"c4030031-26ec-4c2a-8b2e-a8d4fd010377"]
}, Open  ]],
Cell[1112328, 29214, 243, 4, 25, "Input",ExpressionUUID->"7d522554-c484-4224-8450-ad2ce2589410"],
Cell[1112574, 29220, 3669, 94, 148, "Input",ExpressionUUID->"afb48401-2842-4f7f-9a0e-073994cb2639"],
Cell[CellGroupData[{
Cell[1116268, 29318, 1533, 39, 25, "Input",ExpressionUUID->"377a6460-5fdb-49d0-9c12-ed02e08e3bfc"],
Cell[1117804, 29359, 754, 16, 70, "Output",ExpressionUUID->"050d4e01-ba49-415d-9efa-2f17e20ba335"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1118595, 29380, 2579, 66, 43, "Input",ExpressionUUID->"9917159b-b579-4e87-81dd-ab6da980e705"],
Cell[1121177, 29448, 652, 13, 70, "Output",ExpressionUUID->"a915670c-99b4-491f-a411-53cefeb79c56"]
}, Open  ]],
Cell[1121844, 29464, 372, 6, 25, "Input",ExpressionUUID->"6e425556-fe33-421a-8497-66590cf3b605"],
Cell[1122219, 29472, 3845, 96, 148, "Input",ExpressionUUID->"c0f7b908-7248-4968-857e-67df1767d01c"],
Cell[CellGroupData[{
Cell[1126089, 29572, 2870, 73, 43, "Input",ExpressionUUID->"d217583a-e387-4c67-9e2c-947df15e542f"],
Cell[1128962, 29647, 841, 15, 70, "Output",ExpressionUUID->"ccc77bbe-68d9-4950-b4b4-926e8f0076e8"]
}, Open  ]],
Cell[1129818, 29665, 536, 9, 25, "Input",ExpressionUUID->"fdfe0f64-ee77-4ce7-a709-6e5cc7e962cc"],
Cell[1130357, 29676, 4134, 106, 165, "Input",ExpressionUUID->"7c76381c-5b2e-42d1-8fd4-4c593776dda1"],
Cell[CellGroupData[{
Cell[1134516, 29786, 2619, 65, 43, "Input",ExpressionUUID->"81c2a341-d8b5-4332-ae3b-fe31dea299fe"],
Cell[1137138, 29853, 631, 14, 70, "Output",ExpressionUUID->"ce813d0a-a887-43a0-9b55-d4d2d20af2e5"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[1137818, 29873, 160, 3, 33, "Subsubsection",ExpressionUUID->"817e08ac-680b-4214-a6ea-df8f7a7c9529"],
Cell[1137981, 29878, 21073, 493, 1751, "Input",ExpressionUUID->"f637b82b-44d3-4e04-bdfe-d9a9f06ff497"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1159091, 30376, 158, 3, 40, "Subsubsection",ExpressionUUID->"9a32612a-39a8-4fcf-b4e2-03f5615d275b"],
Cell[CellGroupData[{
Cell[1159274, 30383, 294, 5, 25, "Input",ExpressionUUID->"b0b94f5d-dadd-4161-b9de-6836aecb94d1"],
Cell[1159571, 30390, 431, 8, 33, "Output",ExpressionUUID->"ba832ffc-56bd-4da8-a966-81303077353c"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1160039, 30403, 207, 3, 25, "Input",ExpressionUUID->"8b175950-e463-49d0-b8e0-38a562bf662e"],
Cell[1160249, 30408, 282, 4, 29, "Output",ExpressionUUID->"8860ca49-6ba2-4149-90bf-33255da22863"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1160568, 30417, 205, 3, 25, "Input",ExpressionUUID->"3df008c2-4887-4915-a2ef-8d87ed050852"],
Cell[1160776, 30422, 281, 4, 29, "Output",ExpressionUUID->"8798d2c8-526b-44e6-8b3f-0d220f86f36f"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1161094, 30431, 204, 3, 25, "Input",ExpressionUUID->"ac1b8ec2-b415-4ed5-b957-9cf1e85da7ae"],
Cell[1161301, 30436, 286, 4, 29, "Output",ExpressionUUID->"d3102b21-d10c-4dc8-8162-778dd104ab83"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1161624, 30445, 205, 3, 25, "Input",ExpressionUUID->"d66bb99f-8a92-4e4c-a977-3a6a40b949b7"],
Cell[1161832, 30450, 262, 4, 29, "Output",ExpressionUUID->"4ae1eca9-5c75-40d0-b613-067f1141c8f1"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1162131, 30459, 205, 3, 25, "Input",ExpressionUUID->"ba36343f-7260-4358-80a6-a636a9db8be9"],
Cell[1162339, 30464, 260, 4, 29, "Output",ExpressionUUID->"c5eeedb8-02f6-42c5-b4b3-a85826859333"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1162636, 30473, 207, 3, 25, "Input",ExpressionUUID->"e4099d80-d256-46e0-9783-51dc24612bcc"],
Cell[1162846, 30478, 261, 4, 29, "Output",ExpressionUUID->"ed344d7d-608d-46e7-a996-8a98f8477cca"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1163144, 30487, 205, 3, 25, "Input",ExpressionUUID->"62b711e8-1bc3-4ef2-b178-61a93eddeeb3"],
Cell[1163352, 30492, 211, 3, 29, "Output",ExpressionUUID->"17782683-9ad1-42d8-b887-934354e0e554"]
}, Open  ]]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[1163624, 30502, 188, 3, 48, "Subsection",ExpressionUUID->"a2a9e926-161a-451a-ae3c-50d9167a8bb1"],
Cell[CellGroupData[{
Cell[1163837, 30509, 1243, 30, 43, "Input",ExpressionUUID->"5e67be19-5b9b-4618-b23f-fc01e54dd92a"],
Cell[1165083, 30541, 2725, 62, 50, "Output",ExpressionUUID->"690829b1-b2fc-41ad-b960-b64d2d7f3973"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1167845, 30608, 3552, 88, 302, "Input",ExpressionUUID->"f7fd47a3-e78d-429c-ba43-4c3324e96882"],
Cell[1171400, 30698, 3666, 80, 36, "Echo",ExpressionUUID->"2f2baf97-91dc-4972-85ed-65c08b2e76f4"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1175103, 30783, 356, 9, 25, "Input",ExpressionUUID->"bf03ee2d-8c11-4f8a-a7c7-1a45e88b88f9"],
Cell[1175462, 30794, 264, 6, 29, "Output",ExpressionUUID->"553172c9-acb3-42d3-873d-f99872117df8"]
}, Open  ]],
Cell[1175741, 30803, 6821, 166, 561, "Input",ExpressionUUID->"6744b29d-e8cc-4cd6-8723-316398603349"],
Cell[1182565, 30971, 1217, 29, 43, "Input",ExpressionUUID->"2ef72c2f-f320-4092-b02a-df5667ebd122"],
Cell[CellGroupData[{
Cell[1183807, 31004, 311, 7, 25, "Input",ExpressionUUID->"41ae963b-b90d-473b-ae5d-90403b105ac1"],
Cell[1184121, 31013, 2232, 50, 49, "Output",ExpressionUUID->"665ae75d-aae1-46a2-9236-a8b08bb43550"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1186390, 31068, 246, 5, 25, "Input",ExpressionUUID->"9aac6139-5179-495f-ad96-4bd9fdda7e96"],
Cell[1186639, 31075, 1924, 43, 50, "Output",ExpressionUUID->"9c5db727-91f6-4961-bbd9-d3c8032dd269"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1188600, 31123, 249, 5, 25, "Input",ExpressionUUID->"d63de83d-973c-4e38-bfc4-f3decaf51a75"],
Cell[1188852, 31130, 1903, 43, 49, "Output",ExpressionUUID->"ee57cfa0-ecd2-4d06-88db-0856c140aac6"]
}, Open  ]],
Cell[1190770, 31176, 465, 12, 43, "Input",ExpressionUUID->"9c538d70-290f-4456-a7f0-30801d954ef0"],
Cell[CellGroupData[{
Cell[1191260, 31192, 2859, 64, 47, "Input",ExpressionUUID->"04aacc1f-f62e-4cff-8962-46a1b20bd32f"],
Cell[1194122, 31258, 2756, 63, 50, "Output",ExpressionUUID->"e648eee8-fbe7-40dd-99be-ce9a491971ed"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1196915, 31326, 251, 5, 25, "Input",ExpressionUUID->"f36c3ed0-6268-4522-9107-6732880e52cf"],
Cell[1197169, 31333, 2515, 56, 49, "Output",ExpressionUUID->"62981040-c3bd-4a9d-a540-395a183221ea"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1199721, 31394, 249, 5, 25, "Input",ExpressionUUID->"94b1c5dc-32dc-4d4f-9981-48c8787c9897"],
Cell[1199973, 31401, 2523, 57, 49, "Output",ExpressionUUID->"2007b4d3-908a-4d1f-9647-f41db3215dc0"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1202533, 31463, 2910, 65, 47, "Input",ExpressionUUID->"fc2854d5-2b49-4365-9a83-ab4058e58e38"],
Cell[1205446, 31530, 2778, 63, 50, "Output",ExpressionUUID->"7ff93003-24e2-4272-847c-70487da920e9"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1208261, 31598, 251, 5, 25, "Input",ExpressionUUID->"49fb13ae-90ac-4b3a-a86e-34b75d676606"],
Cell[1208515, 31605, 2540, 57, 49, "Output",ExpressionUUID->"fdd6c757-7333-4522-bd04-022887ee6df6"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1211092, 31667, 249, 5, 25, "Input",ExpressionUUID->"497d89e2-db35-482b-a429-b1f7a31b5ecb"],
Cell[1211344, 31674, 2551, 57, 49, "Output",ExpressionUUID->"78653999-4216-463d-9450-141cb1a90836"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[1213944, 31737, 188, 3, 34, "Subsection",ExpressionUUID->"5a59b38f-d462-4afb-8c72-7352834fd501"],
Cell[CellGroupData[{
Cell[1214157, 31744, 160, 3, 40, "Subsubsection",ExpressionUUID->"4c7d08ff-3b81-4450-9f9f-0ff82df2718c"],
Cell[1214320, 31749, 470, 10, 43, "Input",ExpressionUUID->"4423a820-611d-46ec-9a25-cdfad8d7359e"],
Cell[1214793, 31761, 317, 7, 25, "Input",ExpressionUUID->"a9c4197b-7308-43f7-aad9-aaa5cfe9ee44"],
Cell[1215113, 31770, 565, 11, 43, "Input",ExpressionUUID->"50ef5d0a-b366-40ec-85b0-08317a4505fa"],
Cell[1215681, 31783, 392, 11, 25, "Input",ExpressionUUID->"69af6dbf-92b1-4bf8-9d0c-b9915c4bf1f3"]
}, Closed]],
Cell[CellGroupData[{
Cell[1216110, 31799, 163, 3, 33, "Subsubsection",ExpressionUUID->"6db576ff-b04f-4163-bddd-cba481e13f52"],
Cell[1216276, 31804, 6144, 174, 285, "Input",ExpressionUUID->"b20d61aa-bffa-4e54-a5ce-0d45e783fb38"]
}, Closed]],
Cell[CellGroupData[{
Cell[1222457, 31983, 361, 6, 33, "Subsubsection",ExpressionUUID->"389f2f1b-f595-41c6-8c49-a0d548200a66"],
Cell[1222821, 31991, 428, 8, 25, "Input",ExpressionUUID->"86836b67-a308-4ca6-b739-fe12925e4e75"],
Cell[1223252, 32001, 457, 8, 43, "Input",ExpressionUUID->"a9b5b3bb-76f3-4876-9068-77702c5014a0"],
Cell[1223712, 32011, 395, 7, 25, "Input",ExpressionUUID->"8102c319-dd47-4d51-a951-a3ffc7010920"],
Cell[1224110, 32020, 253, 4, 25, "Input",ExpressionUUID->"5c20034e-60a2-4d80-909b-d76a4998a005"],
Cell[1224366, 32026, 790, 16, 43, "Input",ExpressionUUID->"d01313c0-ba3e-40c6-a1b2-876896d694aa"],
Cell[1225159, 32044, 654, 13, 25, "Input",ExpressionUUID->"f6985837-4691-46a1-a7b9-d7858e58299c"],
Cell[1225816, 32059, 3424, 106, 147, "Input",ExpressionUUID->"e37699a3-dc61-4e41-86f4-ec1dbc96c439"],
Cell[CellGroupData[{
Cell[1229265, 32169, 1437, 34, 25, "Input",ExpressionUUID->"33548b16-3ef6-468b-84e5-ae37775690bd"],
Cell[1230705, 32205, 614, 13, 29, "Output",ExpressionUUID->"46cf24ca-af80-4921-96c9-8663feb5ded6"]
}, Open  ]],
Cell[1231334, 32221, 243, 4, 25, "Input",ExpressionUUID->"ea32a8f8-5584-457f-8471-ad0ca559b73c"],
Cell[1231580, 32227, 3669, 94, 148, "Input",ExpressionUUID->"f26c2f80-6442-4caa-906f-0073e2b1c62f"],
Cell[CellGroupData[{
Cell[1235274, 32325, 1533, 39, 25, "Input",ExpressionUUID->"ea1093db-6dd0-4300-9297-f3052becc4fd"],
Cell[1236810, 32366, 754, 16, 29, "Output",ExpressionUUID->"97df4530-2386-4b00-a2e8-b4396f170a2d"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1237601, 32387, 2579, 66, 43, "Input",ExpressionUUID->"08f7b210-53a8-468d-96e4-429a04fe5145"],
Cell[1240183, 32455, 652, 13, 29, "Output",ExpressionUUID->"c5238256-fbef-494d-b694-df229e412286"]
}, Open  ]],
Cell[1240850, 32471, 372, 6, 25, "Input",ExpressionUUID->"f7c080eb-556c-4f2a-8d41-a6ba1d8f24c6"],
Cell[1241225, 32479, 3845, 96, 148, "Input",ExpressionUUID->"9a777c49-bb9e-4b73-9154-eb84ed9f84b4"],
Cell[CellGroupData[{
Cell[1245095, 32579, 2870, 73, 43, "Input",ExpressionUUID->"10a5ddda-cf15-41ad-877b-2dc5ee871088"],
Cell[1247968, 32654, 841, 15, 29, "Output",ExpressionUUID->"82683ab9-e576-462c-9083-c9c529563537"]
}, Open  ]],
Cell[1248824, 32672, 536, 9, 25, "Input",ExpressionUUID->"6e2fe73b-541c-4a01-88ce-aa76d1143c67"],
Cell[1249363, 32683, 4134, 106, 165, "Input",ExpressionUUID->"2a5ea438-e277-4380-9ad5-cffa156aecd0"],
Cell[CellGroupData[{
Cell[1253522, 32793, 2619, 65, 43, "Input",ExpressionUUID->"e809fbc0-8b7f-49ba-8047-1c1efb1d9247"],
Cell[1256144, 32860, 631, 14, 29, "Output",ExpressionUUID->"c297dc66-541a-4679-a9d3-abb23180bc3c"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[1256824, 32880, 237, 4, 33, "Subsubsection",ExpressionUUID->"1f6cb8f8-7d91-4b06-b110-65753d5924a6"],
Cell[1257064, 32886, 27682, 644, 2286, "Input",ExpressionUUID->"6d169553-0836-410e-b653-50fd7ad936e1"]
}, Closed]],
Cell[CellGroupData[{
Cell[1284783, 33535, 160, 3, 33, "Subsubsection",ExpressionUUID->"fe49037d-12c7-4d49-8b18-74ead97e9394"],
Cell[CellGroupData[{
Cell[1284968, 33542, 356, 9, 25, "Input",ExpressionUUID->"37665017-8f19-4145-9792-28d8f6df429f"],
Cell[1285327, 33553, 264, 6, 29, "Output",ExpressionUUID->"8ebb10da-663c-4f44-8232-a43b0f74d557"]
}, Open  ]],
Cell[1285606, 33562, 6821, 166, 561, "Input",ExpressionUUID->"e88dd18a-3be3-4e20-8992-23cd1ce34509"]
}, Closed]],
Cell[CellGroupData[{
Cell[1292464, 33733, 160, 3, 33, "Subsubsection",ExpressionUUID->"c325fb54-8ad0-437e-90d2-d696c9cd0d81"],
Cell[CellGroupData[{
Cell[1292649, 33740, 2861, 64, 47, "Input",ExpressionUUID->"2eba5f99-aec8-4b18-8d22-d3e84ebc0377"],
Cell[1295513, 33806, 2953, 66, 50, "Output",ExpressionUUID->"fd01df32-3a14-4ecf-ac06-6effdf4fc26b"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1298503, 33877, 309, 7, 25, "Input",ExpressionUUID->"99cc72fd-5d66-4059-a983-6a7a3cb763d4"],
Cell[1298815, 33886, 2663, 59, 49, "Output",ExpressionUUID->"95eb77de-d799-4af2-8ce0-bbdc763f2749"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1301515, 33950, 2861, 64, 47, "Input",ExpressionUUID->"04441769-4cc9-4e29-aed0-a418a523c553"],
Cell[1304379, 34016, 2955, 66, 50, "Output",ExpressionUUID->"d6d05d2a-533b-459c-b117-f07de048f2b0"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1307371, 34087, 309, 7, 25, "Input",ExpressionUUID->"8e600979-26ae-42b2-bf33-87710f6f5c36"],
Cell[1307683, 34096, 2662, 59, 49, "Output",ExpressionUUID->"622ef4e6-94a0-4bc9-9c68-827c15f922f4"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1310382, 34160, 2914, 65, 47, "Input",ExpressionUUID->"18409565-5e9f-4178-98da-3eb012c8572f"],
Cell[1313299, 34227, 2979, 67, 50, "Output",ExpressionUUID->"21282b8d-7420-4a2e-9d02-da895704637c"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1316315, 34299, 309, 7, 25, "Input",ExpressionUUID->"3ce577d6-b0cb-42d0-ab36-1f821b94e8ac"],
Cell[1316627, 34308, 2682, 59, 49, "Output",ExpressionUUID->"7c5dd5da-6abf-4f59-a98d-821711826cab"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1319346, 34372, 2826, 63, 47, "Input",ExpressionUUID->"4ac89f3e-667a-43d1-9c24-be5f26abb732"],
Cell[1322175, 34437, 2725, 62, 50, "Output",ExpressionUUID->"2efd57b0-dad4-4331-9c0c-36f83aff5d1a"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1324937, 34504, 250, 5, 25, "Input",ExpressionUUID->"c474083f-0f3b-48a8-bc41-615c3ba1a21c"],
Cell[1325190, 34511, 2205, 49, 49, "Output",ExpressionUUID->"debc08cf-3d70-4d24-8f32-d0fa0b6d08ea"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[1327444, 34566, 228, 4, 33, "Subsubsection",ExpressionUUID->"17213529-1353-4233-8fe3-b0f79bf058c6"],
Cell[CellGroupData[{
Cell[1327697, 34574, 2857, 63, 47, "Input",ExpressionUUID->"8c91883a-427d-45e5-8b6e-a93274eca4df"],
Cell[1330557, 34639, 2977, 66, 50, "Output",ExpressionUUID->"c5fad053-66dc-4a56-bbdb-62344f2ab8bf"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1333571, 34710, 350, 6, 25, "Input",ExpressionUUID->"1d4193ba-7270-4e9e-bc14-9eaf2d5ca295"],
Cell[1333924, 34718, 2714, 59, 49, "Output",ExpressionUUID->"6c8df29e-26eb-4e92-969b-0d56d790a01d"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1336675, 34782, 337, 7, 25, "Input",ExpressionUUID->"d5d71e27-7bc4-4f0a-8a3d-791a2430932b"],
Cell[1337015, 34791, 2593, 57, 49, "Output",ExpressionUUID->"2ce5d97d-bba3-448f-b11b-6780eeb38cfa"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1339645, 34853, 2857, 63, 47, "Input",ExpressionUUID->"8a88c0d0-912c-429c-bc8f-ef4bd1c7449d"],
Cell[1342505, 34918, 2979, 66, 50, "Output",ExpressionUUID->"30a81454-3dbf-4a60-b75c-542ce3de7c71"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1345521, 34989, 440, 9, 25, "Input",ExpressionUUID->"059da7c2-504b-436f-8498-3e5f47c3cc95"],
Cell[1345964, 35000, 2682, 58, 49, "Output",ExpressionUUID->"400d8a7b-1d6c-4ade-9119-4c3107a8a763"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1348683, 35063, 348, 6, 25, "Input",ExpressionUUID->"efd3242e-8530-454e-b209-5705b2e38911"],
Cell[1349034, 35071, 2710, 59, 49, "Output",ExpressionUUID->"733823fd-a33d-4e32-b25c-12906feb1b12"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1351781, 35135, 2822, 62, 47, "Input",ExpressionUUID->"d6eafe2d-eb81-478d-aef1-3b224a01dd86"],
Cell[1354606, 35199, 2745, 61, 50, "Output",ExpressionUUID->"edbf9b1a-3afc-4fbf-b9c3-7b51125508b7"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1357388, 35265, 387, 8, 25, "Input",ExpressionUUID->"db3a71ea-4eae-434c-b8b6-90f4fb52b41e"],
Cell[1357778, 35275, 2226, 49, 49, "Output",ExpressionUUID->"105749c7-d40b-4598-8b55-41dbca1b749c"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1360041, 35329, 291, 5, 25, "Input",ExpressionUUID->"eab8fa97-7056-4d41-8ffa-2976beb28498"],
Cell[1360335, 35336, 387, 8, 23, "Message",ExpressionUUID->"0c3119c1-60b6-4bc2-926e-750125304cc7"],
Cell[1360725, 35346, 2026, 46, 49, "Output",ExpressionUUID->"779f571e-9747-48b5-8c9d-651068bbd578"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1362788, 35397, 231, 3, 25, "Input",ExpressionUUID->"f1b48567-bce7-4963-a6d9-0da7947e016c"],
Cell[1363022, 35402, 1653, 45, 29, "Output",ExpressionUUID->"ac5866eb-50b9-45fa-a3d4-161ef3515772"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1364712, 35452, 300, 5, 25, "Input",ExpressionUUID->"e10adc43-ec1c-4b04-b595-ce64e1f1bfde"],
Cell[1365015, 35459, 264, 7, 29, "Output",ExpressionUUID->"f67b2575-4058-4530-aa9b-59979e15ab52"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1365316, 35471, 670, 18, 61, "Input",ExpressionUUID->"5542224f-c383-4301-8319-64b3c6837dcb"],
Cell[1365989, 35491, 507, 11, 30, "Output",ExpressionUUID->"ebc0ab3e-7c9a-4922-af4d-c8e39abd871d"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1366533, 35507, 235, 4, 25, "Input",ExpressionUUID->"8791ab51-a1cf-47bc-8e38-1adcb854eda4"],
Cell[1366771, 35513, 276, 6, 30, "Output",ExpressionUUID->"f1205be2-a4e9-4bbe-9e62-dbb7703dcc3a"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1367084, 35524, 962, 23, 112, "Input",ExpressionUUID->"716b24e0-1646-4874-b895-73b790c69eb9"],
Cell[1368049, 35549, 518, 13, 29, "Output",ExpressionUUID->"b84ff5c1-4f58-4697-aebf-5e7745c415d2"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}
]
*)

